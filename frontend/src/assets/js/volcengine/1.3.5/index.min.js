!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VePlayer=t()}(this,(function(){"use strict";function ownKeys$l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$l(Object(r),!0).forEach((function(t){_defineProperty$j(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$b(){_regeneratorRuntime$b=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(w){s=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i,a,o,s,l=t&&t.prototype instanceof d?t:d,h=Object.create(l.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=_(r,o);if(n){if(n===c)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var l=u(i,a,o);if("normal"===l.type){if(s=o.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(s="completed",o.method="throw",o.arg=l.arg)}}),h}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(w){return{type:"throw",arg:w}}}e.wrap=l;var c={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y($([])));m&&m!==t&&r.call(m,i)&&(p=m);var g=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(i,a,o,s){var l=u(e[i],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function $(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=f,s(g,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},v(b.prototype),s(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new b(l(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(g),s(g,o,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=$,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:$(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}function _typeof$b(e){return(_typeof$b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$d(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void r(u)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$d(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$d(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$k(e,t,r){return t&&_defineProperties$k(e.prototype,t),r&&_defineProperties$k(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$g(e,t)}function _getPrototypeOf$g(e){return(_getPrototypeOf$g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$g(e,t){return(_setPrototypeOf$g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$j(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$6(e,t,r){return(_construct$6=_isNativeReflectConstruct$j()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$g(i,r.prototype),i}).apply(null,arguments)}function _objectWithoutPropertiesLoose$5(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$5(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$5(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$g(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$g(e)}function _createSuper$j(e){var t=_isNativeReflectConstruct$j();return function(){var r,n=_getPrototypeOf$g(e);if(t){var i=_getPrototypeOf$g(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$g(this,r)}}function _superPropBase$4(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$g(e)););return e}function _get$4(){return _get$4="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase$4(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get$4.apply(this,arguments)}function _slicedToArray$7(e,t){return _arrayWithHoles$7(e)||_iterableToArrayLimit$7(e,t)||_unsupportedIterableToArray$f(e,t)||_nonIterableRest$7()}function _toConsumableArray$a(e){return _arrayWithoutHoles$a(e)||_iterableToArray$a(e)||_unsupportedIterableToArray$f(e)||_nonIterableSpread$a()}function _arrayWithoutHoles$a(e){if(Array.isArray(e))return _arrayLikeToArray$f(e)}function _arrayWithHoles$7(e){if(Array.isArray(e))return e}function _iterableToArray$a(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$7(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$f(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$f(e,t):void 0}}function _arrayLikeToArray$f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$7(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper$5(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$f(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}var freeGlobal="object"==("undefined"==typeof global?"undefined":_typeof$b(global))&&global&&global.Object===Object&&global,freeGlobal$1=freeGlobal,freeSelf="object"==("undefined"==typeof self?"undefined":_typeof$b(self))&&self&&self.Object===Object&&self,root=freeGlobal$1||freeSelf||Function("return this")(),root$1=root,_Symbol$6=root$1.Symbol,_Symbol$7=_Symbol$6,objectProto$f=Object.prototype,hasOwnProperty$g=objectProto$f.hasOwnProperty,nativeObjectToString$1=objectProto$f.toString,symToStringTag$1=_Symbol$7?_Symbol$7.toStringTag:void 0;function getRawTag(t){var r=hasOwnProperty$g.call(t,symToStringTag$1),n=t[symToStringTag$1];try{t[symToStringTag$1]=void 0;var i=!0}catch(e){}var a=nativeObjectToString$1.call(t);return i&&(r?t[symToStringTag$1]=n:delete t[symToStringTag$1]),a}var objectProto$e=Object.prototype,nativeObjectToString=objectProto$e.toString;function objectToString$2(e){return nativeObjectToString.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=_Symbol$7?_Symbol$7.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString$2(e)}function isObjectLike(e){return null!=e&&"object"==_typeof$b(e)}var symbolTag$3="[object Symbol]";function isSymbol$d(e){return"symbol"==_typeof$b(e)||isObjectLike(e)&&baseGetTag(e)==symbolTag$3}function arrayMap(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var isArray$e=Array.isArray,isArray$f=isArray$e,INFINITY$2=1/0,symbolProto$2=_Symbol$7?_Symbol$7.prototype:void 0,symbolToString=symbolProto$2?symbolProto$2.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray$f(e))return arrayMap(e,baseToString)+"";if(isSymbol$d(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY$2?"-0":t}var reWhitespace=/\s/;function trimmedEndIndex(e){for(var t=e.length;t--&&reWhitespace.test(e.charAt(t)););return t}var reTrimStart=/^\s+/;function baseTrim(e){return e?e.slice(0,trimmedEndIndex(e)+1).replace(reTrimStart,""):e}function isObject$V(e){var t=_typeof$b(e);return null!=e&&("object"==t||"function"==t)}var NAN=NaN,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber$2(e){if("number"==typeof e)return e;if(isSymbol$d(e))return NAN;if(isObject$V(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject$V(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=baseTrim(e);var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}function identity(e){return e}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$V(e))return!1;var t=baseGetTag(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var coreJsData=root$1["__core-js_shared__"],coreJsData$1=coreJsData,maskSrcKey=(uid2=/[^.]+$/.exec(coreJsData$1&&coreJsData$1.keys&&coreJsData$1.keys.IE_PROTO||""),uid2?"Symbol(src)_1."+uid2:""),uid2;function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource(t){if(null!=t){try{return funcToString$1.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$d=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$f=objectProto$d.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$f).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject$V(e)||isMasked(e))&&(isFunction$2(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var WeakMap$5=getNative(root$1,"WeakMap"),WeakMap$6=WeakMap$5,objectCreate$3=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject$V(t))return{};if(objectCreate$3)return objectCreate$3(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),baseCreate$1=baseCreate;function apply$k(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function noop$3(){}function copyArray(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,r=0;return function(){var n=nativeNow(),i=HOT_SPAN-(n-r);if(r=n,i>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function constant$4(e){return function(){return e}}var defineProperty$y=function(){try{var t=getNative(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),defineProperty$z=defineProperty$y,baseSetToString=defineProperty$z?function(e,t){return defineProperty$z(e,"toString",{configurable:!0,enumerable:!1,value:constant$4(t),writable:!0})}:identity,baseSetToString$1=baseSetToString,setToString=shortOut(baseSetToString$1),setToString$1=setToString;function arrayEach(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function baseFindIndex(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function baseIsNaN(e){return e!=e}function strictIndexOf(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function baseIndexOf(e,t,r){return t==t?strictIndexOf(e,t,r):baseFindIndex(e,baseIsNaN,r)}function arrayIncludes$2(e,t){return!!(null==e?0:e.length)&&baseIndexOf(e,t,0)>-1}var MAX_SAFE_INTEGER$5=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=_typeof$b(e);return!!(t=null==t?MAX_SAFE_INTEGER$5:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue(e,t,r){"__proto__"==t&&defineProperty$z?defineProperty$z(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function eq(e,t){return e===t||e!=e&&t!=t}var objectProto$c=Object.prototype,hasOwnProperty$e=objectProto$c.hasOwnProperty;function assignValue(e,t,r){var n=e[t];hasOwnProperty$e.call(e,t)&&eq(n,r)&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}function copyObject(e,t,r,n){var i=!r;r||(r={});for(var a=-1,o=t.length;++a<o;){var s=t[a],l=n?n(r[s],e[s],s,r,e):void 0;void 0===l&&(l=e[s]),i?baseAssignValue(r,s,l):assignValue(r,s,l)}return r}var nativeMax$1=Math.max;function overRest(e,t,r){return t=nativeMax$1(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=nativeMax$1(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),apply$k(e,this,s)}}function baseRest(e,t){return setToString$1(overRest(e,t,identity),e+"")}var MAX_SAFE_INTEGER$4=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$4}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction$2(e)}function isIterateeCall(e,t,r){if(!isObject$V(r))return!1;var n=_typeof$b(t);return!!("number"==n?isArrayLike(r)&&isIndex(t,r.length):"string"==n&&t in r)&&eq(r[t],e)}function createAssigner(e){return baseRest((function(t,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(a=e.length>3&&"function"==typeof a?(i--,a):void 0,o&&isIterateeCall(r[0],r[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,a)}return t}))}var objectProto$b=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$b)}function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var argsTag$3="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag$3}var objectProto$a=Object.prototype,hasOwnProperty$d=objectProto$a.hasOwnProperty,propertyIsEnumerable$3=objectProto$a.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$d.call(e,"callee")&&!propertyIsEnumerable$3.call(e,"callee")},isArguments$1=isArguments;function stubFalse(){return!1}var freeExports$2="object"==("undefined"==typeof exports?"undefined":_typeof$b(exports))&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==("undefined"==typeof module?"undefined":_typeof$b(module))&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$7=moduleExports$2?root$1.Buffer:void 0,nativeIsBuffer=Buffer$7?Buffer$7.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,isBuffer$1=isBuffer,argsTag$2="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$1="[object Function]",mapTag$5="[object Map]",numberTag$3="[object Number]",objectTag$3="[object Object]",regexpTag$3="[object RegExp]",setTag$5="[object Set]",stringTag$3="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$2]=typedArrayTags[arrayTag$2]=typedArrayTags[arrayBufferTag$3]=typedArrayTags[boolTag$3]=typedArrayTags[dataViewTag$4]=typedArrayTags[dateTag$3]=typedArrayTags[errorTag$2]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$5]=typedArrayTags[numberTag$3]=typedArrayTags[objectTag$3]=typedArrayTags[regexpTag$3]=typedArrayTags[setTag$5]=typedArrayTags[stringTag$3]=typedArrayTags[weakMapTag$2]=!1;var freeExports$1="object"==("undefined"==typeof exports?"undefined":_typeof$b(exports))&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==("undefined"==typeof module?"undefined":_typeof$b(module))&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal$1.process,nodeUtil=function(){try{var t=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return t||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeUtil$1=nodeUtil,nodeIsTypedArray=nodeUtil$1&&nodeUtil$1.isTypedArray,isTypedArray$4=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,isTypedArray$5=isTypedArray$4,objectProto$9=Object.prototype,hasOwnProperty$c=objectProto$9.hasOwnProperty;function arrayLikeKeys(e,t){var r=isArray$f(e),n=!r&&isArguments$1(e),i=!r&&!n&&isBuffer$1(e),a=!r&&!n&&!i&&isTypedArray$5(e),o=r||n||i||a,s=o?baseTimes(e.length,String):[],l=s.length;for(var u in e)!t&&!hasOwnProperty$c.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,l))||s.push(u);return s}function overArg(e,t){return function(r){return e(t(r))}}var nativeKeys$2=overArg(Object.keys,Object),nativeKeys$3=nativeKeys$2,objectProto$8=Object.prototype,hasOwnProperty$b=objectProto$8.hasOwnProperty;function baseKeys(e){if(!isPrototype$1(e))return nativeKeys$3(e);var t=[];for(var r in Object(e))hasOwnProperty$b.call(e,r)&&"constructor"!=r&&t.push(r);return t}function keys$b(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}var objectProto$7=Object.prototype,hasOwnProperty$a=objectProto$7.hasOwnProperty,assign$7=createAssigner((function(e,t){if(isPrototype$1(t)||isArrayLike(t))copyObject(t,keys$b(t),e);else for(var r in t)hasOwnProperty$a.call(t,r)&&assignValue(e,r,t[r])})),assign$8=assign$7;function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var objectProto$6=Object.prototype,hasOwnProperty$9=objectProto$6.hasOwnProperty;function baseKeysIn(e){if(!isObject$V(e))return nativeKeysIn(e);var t=isPrototype$1(e),r=[];for(var n in e)("constructor"!=n||!t&&hasOwnProperty$9.call(e,n))&&r.push(n);return r}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,!0):baseKeysIn(e)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray$f(e))return!1;var r=_typeof$b(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol$d(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var nativeCreate=getNative(Object,"create"),nativeCreate$1=nativeCreate;function hashClear(){this.__data__=nativeCreate$1?nativeCreate$1(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$5=Object.prototype,hasOwnProperty$8=objectProto$5.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate$1){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$8.call(t,e)?t[e]:void 0}var objectProto$4=Object.prototype,hasOwnProperty$7=objectProto$4.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate$1?void 0!==t[e]:hasOwnProperty$7.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate$1&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;var arrayProto=Array.prototype,splice$2=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice$2.call(t,r,1),--this.size,!0)}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root$1,"Map"),Map$2=Map$1;function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$2||ListCache),string:new Hash}}function isKeyable(e){var t=_typeof$b(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT$2="Expected a function";function memoize(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT$2);var r=function r(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(memoize.Cache||MapCache),r}memoize.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize(e,(function(e){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),e})),r=t.cache;return t}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,(function(e,r,n,i){t.push(n?i.replace(reEscapeChar,"$1"):r||e)})),t})),stringToPath$1=stringToPath;function toString$S(e){return null==e?"":baseToString(e)}function castPath(e,t){return isArray$f(e)?e:isKey(e,t)?[e]:stringToPath$1(toString$S(e))}var INFINITY$1=1/0;function toKey(e){if("string"==typeof e||isSymbol$d(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}function baseGet(e,t){for(var r=0,n=(t=castPath(t,e)).length;null!=e&&r<n;)e=e[toKey(t[r++])];return r&&r==n?e:void 0}function get$4(e,t,r){var n=null==e?void 0:baseGet(e,t);return void 0===n?r:n}function arrayPush(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var getPrototype=overArg(Object.getPrototypeOf,Object),getPrototype$1=getPrototype;function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE$1=200;function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var n=r.__data__;if(!Map$2||n.length<LARGE_ARRAY_SIZE$1-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function baseAssign(e,t){return e&&copyObject(t,keys$b(t),e)}function baseAssignIn(e,t){return e&&copyObject(t,keysIn(t),e)}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var freeExports="object"==("undefined"==typeof exports?"undefined":_typeof$b(exports))&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==("undefined"==typeof module?"undefined":_typeof$b(module))&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer$6=moduleExports?root$1.Buffer:void 0,allocUnsafe=Buffer$6?Buffer$6.allocUnsafe:void 0;function cloneBuffer(e,t){if(t)return e.slice();var r=e.length,n=allocUnsafe?allocUnsafe(r):new e.constructor(r);return e.copy(n),n}function arrayFilter(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function stubArray(){return[]}var objectProto$3=Object.prototype,propertyIsEnumerable$2=objectProto$3.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols$1?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols$1(e),(function(t){return propertyIsEnumerable$2.call(e,t)})))}:stubArray,getSymbols$1=getSymbols;function copySymbols(e,t){return copyObject(e,getSymbols$1(e),t)}var nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols?function(e){for(var t=[];e;)arrayPush(t,getSymbols$1(e)),e=getPrototype$1(e);return t}:stubArray,getSymbolsIn$1=getSymbolsIn;function copySymbolsIn(e,t){return copyObject(e,getSymbolsIn$1(e),t)}function baseGetAllKeys(e,t,r){var n=t(e);return isArray$f(e)?n:arrayPush(n,r(e))}function getAllKeys(e){return baseGetAllKeys(e,keys$b,getSymbols$1)}function getAllKeysIn(e){return baseGetAllKeys(e,keysIn,getSymbolsIn$1)}var DataView$5=getNative(root$1,"DataView"),DataView$6=DataView$5,Promise$3=getNative(root$1,"Promise"),Promise$4=Promise$3,Set$1=getNative(root$1,"Set"),Set$2=Set$1,mapTag$4="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$4="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$3="[object DataView]",dataViewCtorString=toSource(DataView$6),mapCtorString=toSource(Map$2),promiseCtorString=toSource(Promise$4),setCtorString=toSource(Set$2),weakMapCtorString=toSource(WeakMap$6),getTag=baseGetTag;(DataView$6&&getTag(new DataView$6(new ArrayBuffer(1)))!=dataViewTag$3||Map$2&&getTag(new Map$2)!=mapTag$4||Promise$4&&getTag(Promise$4.resolve())!=promiseTag||Set$2&&getTag(new Set$2)!=setTag$4||WeakMap$6&&getTag(new WeakMap$6)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),r=t==objectTag$2?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$3;case mapCtorString:return mapTag$4;case promiseCtorString:return promiseTag;case setCtorString:return setTag$4;case weakMapCtorString:return weakMapTag$1}return t});var getTag$1=getTag,objectProto$2=Object.prototype,hasOwnProperty$6=objectProto$2.hasOwnProperty;function initCloneArray(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$6.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Uint8Array$5=root$1.Uint8Array,Uint8Array$6=Uint8Array$5;function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array$6(t).set(new Uint8Array$6(e)),t}function cloneDataView(e,t){var r=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var reFlags=/\w*$/;function cloneRegExp(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto$1=_Symbol$7?_Symbol$7.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}function cloneTypedArray(e,t){var r=t?cloneArrayBuffer(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var boolTag$2="[object Boolean]",dateTag$2="[object Date]",mapTag$3="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(e,t,r){var n=e.constructor;switch(t){case arrayBufferTag$2:return cloneArrayBuffer(e);case boolTag$2:case dateTag$2:return new n(+e);case dataViewTag$2:return cloneDataView(e,r);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e,r);case mapTag$3:return new n;case numberTag$2:case stringTag$2:return new n(e);case regexpTag$2:return cloneRegExp(e);case setTag$3:return new n;case symbolTag$2:return cloneSymbol(e)}}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype$1(e)?{}:baseCreate$1(getPrototype$1(e))}var mapTag$2="[object Map]";function baseIsMap(e){return isObjectLike(e)&&getTag$1(e)==mapTag$2}var nodeIsMap=nodeUtil$1&&nodeUtil$1.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,isMap$1=isMap,setTag$2="[object Set]";function baseIsSet(e){return isObjectLike(e)&&getTag$1(e)==setTag$2}var nodeIsSet=nodeUtil$1&&nodeUtil$1.isSet,isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,isSet$1=isSet,CLONE_DEEP_FLAG$1=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG$1=4,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag$1="[object Map]",numberTag$1="[object Number]",objectTag$1="[object Object]",regexpTag$1="[object RegExp]",setTag$1="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};function baseClone(e,t,r,n,i,a){var o,s=t&CLONE_DEEP_FLAG$1,l=t&CLONE_FLAT_FLAG,u=t&CLONE_SYMBOLS_FLAG$1;if(r&&(o=i?r(e,n,i,a):r(e)),void 0!==o)return o;if(!isObject$V(e))return e;var c=isArray$f(e);if(c){if(o=initCloneArray(e),!s)return copyArray(e,o)}else{var d=getTag$1(e),h=d==funcTag||d==genTag;if(isBuffer$1(e))return cloneBuffer(e,s);if(d==objectTag$1||d==argsTag$1||h&&!i){if(o=l||h?{}:initCloneObject(e),!s)return l?copySymbolsIn(e,baseAssignIn(o,e)):copySymbols(e,baseAssign(o,e))}else{if(!cloneableTags[d])return i?e:{};o=initCloneByTag(e,d,s)}}a||(a=new Stack);var f=a.get(e);if(f)return f;a.set(e,o),isSet$1(e)?e.forEach((function(n){o.add(baseClone(n,t,r,n,e,a))})):isMap$1(e)&&e.forEach((function(n,i){o.set(i,baseClone(n,t,r,i,e,a))}));var p=c?void 0:(u?l?getAllKeysIn:getAllKeys:l?keysIn:keys$b)(e);return arrayEach(p||e,(function(n,i){p&&(n=e[i=n]),assignValue(o,i,baseClone(n,t,r,i,e,a))})),o}cloneableTags[argsTag$1]=cloneableTags[arrayTag$1]=cloneableTags[arrayBufferTag$1]=cloneableTags[dataViewTag$1]=cloneableTags[boolTag$1]=cloneableTags[dateTag$1]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag$1]=cloneableTags[numberTag$1]=cloneableTags[objectTag$1]=cloneableTags[regexpTag$1]=cloneableTags[setTag$1]=cloneableTags[stringTag$1]=cloneableTags[symbolTag$1]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag$1]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeep(e){return baseClone(e,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function arraySome(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function cacheHas(e,t){return e.has(t)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays(e,t,r,n,i,a){var o=r&COMPARE_PARTIAL_FLAG$5,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(e),c=a.get(t);if(u&&c)return u==t&&c==e;var d=-1,h=!0,f=r&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(a.set(e,t),a.set(t,e);++d<s;){var p=e[d],y=t[d];if(n)var m=o?n(y,p,d,t,e,a):n(p,y,d,e,t,a);if(void 0!==m){if(m)continue;h=!1;break}if(f){if(!arraySome(t,(function(e,t){if(!cacheHas(f,t)&&(p===e||i(p,e,r,n,a)))return f.push(t)}))){h=!1;break}}else if(p!==y&&!i(p,y,r,n,a)){h=!1;break}}return a.delete(e),a.delete(t),h}function mapToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}var COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",symbolProto=_Symbol$7?_Symbol$7.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag(e,t,r,n,i,a,o){switch(r){case dataViewTag:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!a(new Uint8Array$6(e),new Uint8Array$6(t)));case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag:var s=mapToArray;case setTag:var l=n&COMPARE_PARTIAL_FLAG$4;if(s||(s=setToArray),e.size!=t.size&&!l)return!1;var u=o.get(e);if(u)return u==t;n|=COMPARE_UNORDERED_FLAG$2,o.set(e,t);var c=equalArrays(s(e),s(t),n,i,a,o);return o.delete(e),c;case symbolTag:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$5=objectProto$1.hasOwnProperty;function equalObjects(e,t,r,n,i,a){var o=r&COMPARE_PARTIAL_FLAG$3,s=getAllKeys(e),l=s.length;if(l!=getAllKeys(t).length&&!o)return!1;for(var u=l;u--;){var c=s[u];if(!(o?c in t:hasOwnProperty$5.call(t,c)))return!1}var d=a.get(e),h=a.get(t);if(d&&h)return d==t&&h==e;var f=!0;a.set(e,t),a.set(t,e);for(var p=o;++u<l;){var y=e[c=s[u]],m=t[c];if(n)var g=o?n(m,y,c,t,e,a):n(y,m,c,e,t,a);if(!(void 0===g?y===m||i(y,m,r,n,a):g)){f=!1;break}p||(p="constructor"==c)}if(f&&!p){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(f=!1)}return a.delete(e),a.delete(t),f}var COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty$4=objectProto.hasOwnProperty;function baseIsEqualDeep(e,t,r,n,i,a){var o=isArray$f(e),s=isArray$f(t),l=o?arrayTag:getTag$1(e),u=s?arrayTag:getTag$1(t),c=(l=l==argsTag?objectTag:l)==objectTag,d=(u=u==argsTag?objectTag:u)==objectTag,h=l==u;if(h&&isBuffer$1(e)){if(!isBuffer$1(t))return!1;o=!0,c=!1}if(h&&!c)return a||(a=new Stack),o||isTypedArray$5(e)?equalArrays(e,t,r,n,i,a):equalByTag(e,t,l,r,n,i,a);if(!(r&COMPARE_PARTIAL_FLAG$2)){var f=c&&hasOwnProperty$4.call(e,"__wrapped__"),p=d&&hasOwnProperty$4.call(t,"__wrapped__");if(f||p){var y=f?e.value():e,m=p?t.value():t;return a||(a=new Stack),i(y,m,r,n,a)}}return!!h&&(a||(a=new Stack),equalObjects(e,t,r,n,i,a))}function baseIsEqual(e,t,r,n,i){return e===t||(null==e||null==t||!isObjectLike(e)&&!isObjectLike(t)?e!=e&&t!=t:baseIsEqualDeep(e,t,r,n,baseIsEqual,i))}var COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch(e,t,r,n){var i=r.length,a=i,o=!n;if(null==e)return!a;for(e=Object(e);i--;){var s=r[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){var l=(s=r[i])[0],u=e[l],c=s[1];if(o&&s[2]){if(void 0===u&&!(l in e))return!1}else{var d=new Stack;if(n)var h=n(u,c,l,e,t,d);if(!(void 0===h?baseIsEqual(c,u,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,n,d):h))return!1}}return!0}function isStrictComparable(e){return e==e&&!isObject$V(e)}function getMatchData(e){for(var t=keys$b(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,isStrictComparable(i)]}return t}function matchesStrictComparable(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}}function baseMatches(e){var t=getMatchData(e);return 1==t.length&&t[0][2]?matchesStrictComparable(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}function baseHasIn(e,t){return null!=e&&t in Object(e)}function hasPath(e,t,r){for(var n=-1,i=(t=castPath(t,e)).length,a=!1;++n<i;){var o=toKey(t[n]);if(!(a=null!=e&&r(e,o)))break;e=e[o]}return a||++n!=i?a:!!(i=null==e?0:e.length)&&isLength(i)&&isIndex(o,i)&&(isArray$f(e)||isArguments$1(e))}function hasIn(e,t){return null!=e&&hasPath(e,t,baseHasIn)}var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(e,t){return isKey(e)&&isStrictComparable(t)?matchesStrictComparable(toKey(e),t):function(r){var n=get$4(r,e);return void 0===n&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function basePropertyDeep(e){return function(t){return baseGet(t,e)}}function property(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}function baseIteratee(e){return"function"==typeof e?e:null==e?identity:"object"==_typeof$b(e)?isArray$f(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}var now$1=function(){return root$1.Date.now()},now$2=now$1,FUNC_ERROR_TEXT$1="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce$3(e,t,r){var n,i,a,o,s,l,u=0,c=!1,d=!1,h=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT$1);function f(t){var r=n,a=i;return n=i=void 0,u=t,o=e.apply(a,r)}function p(e){return u=e,s=setTimeout(m,t),c?f(e):o}function y(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-u>=a}function m(){var e=now$2();if(y(e))return g(e);s=setTimeout(m,function(e){var r=t-(e-l);return d?nativeMin(r,a-(e-u)):r}(e))}function g(e){return s=void 0,h&&n?f(e):(n=i=void 0,o)}function v(){var e=now$2(),r=y(e);if(n=arguments,i=this,l=e,r){if(void 0===s)return p(l);if(d)return clearTimeout(s),s=setTimeout(m,t),f(l)}return void 0===s&&(s=setTimeout(m,t)),o}return t=toNumber$2(t)||0,isObject$V(r)&&(c=!!r.leading,a=(d="maxWait"in r)?nativeMax(toNumber$2(r.maxWait)||0,t):a,h="trailing"in r?!!r.trailing:h),v.cancel=function(){void 0!==s&&clearTimeout(s),u=0,n=l=i=s=void 0},v.flush=function(){return void 0===s?o:g(now$2())},v}function arrayIncludesWith(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}var FUNC_ERROR_TEXT="Expected a function";function throttle$1(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return isObject$V(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),debounce$3(e,t,{leading:n,maxWait:t,trailing:i})}var INFINITY=1/0,createSet=Set$2&&1/setToArray(new Set$2([,-0]))[1]==INFINITY?function(e){return new Set$2(e)}:noop$3,createSet$1=createSet,LARGE_ARRAY_SIZE=200;function baseUniq(e,t,r){var n=-1,i=arrayIncludes$2,a=e.length,o=!0,s=[],l=s;if(r)o=!1,i=arrayIncludesWith;else if(a>=LARGE_ARRAY_SIZE){var u=t?null:createSet$1(e);if(u)return setToArray(u);o=!1,i=cacheHas,l=new SetCache}else l=t?[]:s;e:for(;++n<a;){var c=e[n],d=t?t(c):c;if(c=r||0!==c?c:0,o&&d==d){for(var h=l.length;h--;)if(l[h]===d)continue e;t&&l.push(d),s.push(c)}else i(l,d,r)||(l!==s&&l.push(d),s.push(c))}return s}function uniqBy(e,t){return e&&e.length?baseUniq(e,baseIteratee(t)):[]}var CodecType=function(e){return e.H265="h265",e.H264="h264",e}(CodecType||{}),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var proxy=function(){var e,t=null;function r(e){return!!e&&("object"===_typeof$b(e)||"function"==typeof e)}function n(e){if(null!==e&&!r(e))throw new TypeError("Object prototype may only be an Object or null: "+e)}var i=Object,a=Boolean(i.create)||!({__proto__:null}instanceof i),o=i.create||(a?function(e){return n(e),{__proto__:e}}:function(e){if(n(e),null===e)throw new SyntaxError("Native Object.create is required to create objects with null prototype");var t=function(){};return t.prototype=e,new t}),s=function(){return null},l=i.getPrototypeOf||([].__proto__===Array.prototype?function(e){var t=e.__proto__;return r(t)?t:null}:s);return e=function(u,c){if(void 0===(this&&this instanceof e?this.constructor:void 0))throw new TypeError("Constructor Proxy requires 'new'");if(!r(u)||!r(c))throw new TypeError("Cannot create proxy with a non-object as target or handler");var d=function(){};t=function(){u=null,d=function(e){throw new TypeError("Cannot perform '".concat(e,"' on a proxy that has been revoked"))}},setTimeout((function(){t=null}),0);var h=c;for(var f in c={get:null,set:null,apply:null,construct:null},h){if(!(f in c))throw new TypeError("Proxy polyfill does not support trap '".concat(f,"'"));c[f]=h[f]}"function"==typeof h&&(c.apply=h.apply.bind(h));var p,y=l(u),m=!1,g=!1;"function"==typeof u?(p=function(){var e=this&&this.constructor===p,t=Array.prototype.slice.call(arguments);if(d(e?"construct":"apply"),e&&c.construct)return c.construct.call(this,u,t);if(!e&&c.apply)return c.apply(u,this,t);if(e){t.unshift(u);var r=u.bind.apply(u,t);return new r}return u.apply(this,t)},m=!0):u instanceof Array?(p=[],g=!0):p=a||null!==y?o(y):{};var v=c.get?function(e){return d("get"),c.get(this,e,p)}:function(e){return d("get"),this[e]},b=c.set?function(e,t){d("set"),c.set(this,e,t,p)}:function(e,t){d("set"),this[e]=t},_=i.getOwnPropertyNames(u),E={};_.forEach((function(e){if(!m&&!g||!(e in p)){var t=i.getOwnPropertyDescriptor(u,e),r={enumerable:Boolean(t.enumerable),get:v.bind(u,e),set:b.bind(u,e)};i.defineProperty(p,e,r),E[e]=!0}}));var T=!0;if(m||g){var S=i.setPrototypeOf||([].__proto__===Array.prototype?function(e,t){return n(t),e.__proto__=t,e}:s);y&&S(p,y)||(T=!1)}if(c.get||!T)for(var $ in u)E[$]||i.defineProperty(p,$,{get:v.bind(u,$)});return i.seal(u),i.seal(p),p},e.revocable=function(r,n){return{proxy:new e(r,n),revoke:t}},e},Proxy$1=proxy(),MyProxy=function(){function e(){_classCallCheck$j(this,e),this.subscribeId=0,this.watcherMap=new Map}return _createClass$k(e,[{key:"observe",value:function(e){var t=this,r=new Proxy$1(e,{set:function(e,n,i){var a=Reflect.get(e,n);Reflect.set(e,n,i);var o=t.watcherMap.get(r);return o&&(t.flushCallback(o),t.flushPropertyCallback(o,n,a,i)),!0}});return this.watcherMap.set(r,{pending:!1,queue:[],property:{}}),r}},{key:"subscribe",value:function(e,t){var r=this.watcherMap.get(e);if(r)return this.subscribeId++,r.queue.push({id:this.subscribeId,callback:t}),this.subscribeId}},{key:"unsubscribe",value:function(e,t){var r=this.watcherMap.get(e);if(r){var n=r.queue,i=n.findIndex((function(e){return e.id===t}));void 0!==i&&i>-1&&n.splice(i,1)}}},{key:"subscribeProperty",value:function(e,t,r){var n=this.watcherMap.get(e);n&&(this.subscribeId++,n.property[t]||(n.property[t]={pending:!1,timer:0,pre:null,queue:[]}),n.property[t].queue.push({id:this.subscribeId,callback:r}))}},{key:"unsubscribeProperty",value:function(e,t,r){var n=this.watcherMap.get(e);if(n){var i=n.property[t];if(i){var a=i.queue,o=a.findIndex((function(e){return e.id===r}));void 0!==o&&o>-1&&a.splice(o,1)}}}},{key:"flushCallback",value:function(e){e.pending||(e.pending=!0,setTimeout((function(){e.queue.forEach((function(e){return e.callback()})),e.pending=!1}),0))}},{key:"flushPropertyCallback",value:function(e,t,r,n){var i=e.property[t];i&&(clearTimeout(i.timer),!1===i.pending&&(i.pending=!0,i.pre=r),i.timer=setTimeout((function(){i.queue.forEach((function(e){return e.callback(i.pre,n)})),i.pending=!1}),0))}}]),e}(),MyProxy$1=new MyProxy;function ownKeys$k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$k(Object(r),!0).forEach((function(t){_defineProperty$i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _typeof$a(e){return(_typeof$a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck$i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$j(e,t,r){return t&&_defineProperties$j(e.prototype,t),r&&_defineProperties$j(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$f(e,t)}function _getPrototypeOf$f(e){return(_getPrototypeOf$f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$f(e,t){return(_setPrototypeOf$f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$f(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$f(e)}function _createSuper$i(e){var t=_isNativeReflectConstruct$i();return function(){var r,n=_getPrototypeOf$f(e);if(t){var i=_getPrototypeOf$f(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$f(this,r)}}function _superPropBase$3(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$f(e)););return e}function _get$3(){return _get$3="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase$3(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get$3.apply(this,arguments)}function _toConsumableArray$9(e){return _arrayWithoutHoles$9(e)||_iterableToArray$9(e)||_unsupportedIterableToArray$e(e)||_nonIterableSpread$9()}function _arrayWithoutHoles$9(e){if(Array.isArray(e))return _arrayLikeToArray$e(e)}function _iterableToArray$9(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray$e(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$e(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$e(e,t):void 0}}function _arrayLikeToArray$e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$9(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var es_array_find={},check$1=function(e){return e&&e.Math==Math&&e},global$1v=check$1("object"==("undefined"==typeof globalThis?"undefined":_typeof$b(globalThis))&&globalThis)||check$1("object"==("undefined"==typeof window?"undefined":_typeof$b(window))&&window)||check$1("object"==("undefined"==typeof self?"undefined":_typeof$b(self))&&self)||check$1("object"==_typeof$b(commonjsGlobal)&&commonjsGlobal)||function(){return this}()||Function("return this")(),objectGetOwnPropertyDescriptor$1={},fails$1Q=function(e){try{return!!e()}catch(t){return!0}},fails$1P=fails$1Q,descriptors$1=!fails$1P((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),fails$1O=fails$1Q,functionBindNative$1=!fails$1O((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),NATIVE_BIND$9=functionBindNative$1,call$X=Function.prototype.call,functionCall$1=NATIVE_BIND$9?call$X.bind(call$X):function(){return call$X.apply(call$X,arguments)},objectPropertyIsEnumerable$1={},$propertyIsEnumerable$4={}.propertyIsEnumerable,getOwnPropertyDescriptor$d=Object.getOwnPropertyDescriptor,NASHORN_BUG$1=getOwnPropertyDescriptor$d&&!$propertyIsEnumerable$4.call({1:2},1);objectPropertyIsEnumerable$1.f=NASHORN_BUG$1?function(e){var t=getOwnPropertyDescriptor$d(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable$4;var createPropertyDescriptor$k=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},NATIVE_BIND$8=functionBindNative$1,FunctionPrototype$7=Function.prototype,call$W=FunctionPrototype$7.call,uncurryThisWithBind$1=NATIVE_BIND$8&&FunctionPrototype$7.bind.bind(call$W,call$W),functionUncurryThisRaw$1=NATIVE_BIND$8?uncurryThisWithBind$1:function(e){return function(){return call$W.apply(e,arguments)}},uncurryThisRaw$3=functionUncurryThisRaw$1,toString$R=uncurryThisRaw$3({}.toString),stringSlice$p=uncurryThisRaw$3("".slice),classofRaw$5=function(e){return stringSlice$p(toString$R(e),8,-1)},classofRaw$4=classofRaw$5,uncurryThisRaw$2=functionUncurryThisRaw$1,functionUncurryThis$1=function(e){if("Function"===classofRaw$4(e))return uncurryThisRaw$2(e)},uncurryThis$1O=functionUncurryThis$1,fails$1N=fails$1Q,classof$w=classofRaw$5,$Object$9=Object,split$7=uncurryThis$1O("".split),indexedObject$1=fails$1N((function(){return!$Object$9("z").propertyIsEnumerable(0)}))?function(e){return"String"==classof$w(e)?split$7(e,""):$Object$9(e)}:$Object$9,isNullOrUndefined$h=function(e){return null==e},isNullOrUndefined$g=isNullOrUndefined$h,$TypeError$E=TypeError,requireObjectCoercible$p=function(e){if(isNullOrUndefined$g(e))throw $TypeError$E("Can't call method on "+e);return e},IndexedObject$c=indexedObject$1,requireObjectCoercible$o=requireObjectCoercible$p,toIndexedObject$q=function(e){return IndexedObject$c(requireObjectCoercible$o(e))},documentAll$5="object"==("undefined"==typeof document?"undefined":_typeof$b(document))&&document.all,IS_HTMLDDA$1=void 0===documentAll$5&&void 0!==documentAll$5,documentAll_1$1={all:documentAll$5,IS_HTMLDDA:IS_HTMLDDA$1},$documentAll$3=documentAll_1$1,documentAll$4=$documentAll$3.all,isCallable$Z=$documentAll$3.IS_HTMLDDA?function(e){return"function"==typeof e||e===documentAll$4}:function(e){return"function"==typeof e},isCallable$Y=isCallable$Z,$documentAll$2=documentAll_1$1,documentAll$3=$documentAll$2.all,isObject$U=$documentAll$2.IS_HTMLDDA?function(e){return"object"==_typeof$b(e)?null!==e:isCallable$Y(e)||e===documentAll$3}:function(e){return"object"==_typeof$b(e)?null!==e:isCallable$Y(e)},global$1u=global$1v,isCallable$X=isCallable$Z,aFunction$1=function(e){return isCallable$X(e)?e:void 0},getBuiltIn$A=function(e,t){return arguments.length<2?aFunction$1(global$1u[e]):global$1u[e]&&global$1u[e][t]},uncurryThis$1N=functionUncurryThis$1,objectIsPrototypeOf$1=uncurryThis$1N({}.isPrototypeOf),getBuiltIn$z=getBuiltIn$A,engineUserAgent$1=getBuiltIn$z("navigator","userAgent")||"",global$1t=global$1v,userAgent$f=engineUserAgent$1,process$9=global$1t.process,Deno$2=global$1t.Deno,versions$1=process$9&&process$9.versions||Deno$2&&Deno$2.version,v8$1=versions$1&&versions$1.v8,match$1,version$6;v8$1&&(match$1=v8$1.split("."),version$6=match$1[0]>0&&match$1[0]<4?1:+(match$1[0]+match$1[1])),!version$6&&userAgent$f&&(match$1=userAgent$f.match(/Edge\/(\d+)/),(!match$1||match$1[1]>=74)&&(match$1=userAgent$f.match(/Chrome\/(\d+)/),match$1&&(version$6=+match$1[1])));var engineV8Version$1=version$6,V8_VERSION$7=engineV8Version$1,fails$1M=fails$1Q,symbolConstructorDetection$1=!!Object.getOwnPropertySymbols&&!fails$1M((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&V8_VERSION$7&&V8_VERSION$7<41})),NATIVE_SYMBOL$9=symbolConstructorDetection$1,useSymbolAsUid$1=NATIVE_SYMBOL$9&&!Symbol.sham&&"symbol"==_typeof$b(Symbol.iterator),getBuiltIn$y=getBuiltIn$A,isCallable$W=isCallable$Z,isPrototypeOf$i=objectIsPrototypeOf$1,USE_SYMBOL_AS_UID$3=useSymbolAsUid$1,$Object$8=Object,isSymbol$c=USE_SYMBOL_AS_UID$3?function(e){return"symbol"==_typeof$b(e)}:function(e){var t=getBuiltIn$y("Symbol");return isCallable$W(t)&&isPrototypeOf$i(t.prototype,$Object$8(e))},$String$9=String,tryToString$e=function(e){try{return $String$9(e)}catch(t){return"Object"}},isCallable$V=isCallable$Z,tryToString$d=tryToString$e,$TypeError$D=TypeError,aCallable$p=function(e){if(isCallable$V(e))return e;throw $TypeError$D(tryToString$d(e)+" is not a function")},aCallable$o=aCallable$p,isNullOrUndefined$f=isNullOrUndefined$h,getMethod$d=function(e,t){var r=e[t];return isNullOrUndefined$f(r)?void 0:aCallable$o(r)},call$V=functionCall$1,isCallable$U=isCallable$Z,isObject$T=isObject$U,$TypeError$C=TypeError,ordinaryToPrimitive$3=function(e,t){var r,n;if("string"===t&&isCallable$U(r=e.toString)&&!isObject$T(n=call$V(r,e)))return n;if(isCallable$U(r=e.valueOf)&&!isObject$T(n=call$V(r,e)))return n;if("string"!==t&&isCallable$U(r=e.toString)&&!isObject$T(n=call$V(r,e)))return n;throw $TypeError$C("Can't convert object to primitive value")},shared$c={exports:{}},isPure$1=!1,global$1s=global$1v,defineProperty$x=Object.defineProperty,defineGlobalProperty$7=function(e,t){try{defineProperty$x(global$1s,e,{value:t,configurable:!0,writable:!0})}catch(r){global$1s[e]=t}return t},global$1r=global$1v,defineGlobalProperty$6=defineGlobalProperty$7,SHARED$1="__core-js_shared__",store$7=global$1r[SHARED$1]||defineGlobalProperty$6(SHARED$1,{}),sharedStore$1=store$7,store$6=sharedStore$1;(shared$c.exports=function(e,t){return store$6[e]||(store$6[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.0",mode:"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.0/LICENSE",source:"https://github.com/zloirock/core-js"});var requireObjectCoercible$n=requireObjectCoercible$p,$Object$7=Object,toObject$D=function(e){return $Object$7(requireObjectCoercible$n(e))},uncurryThis$1M=functionUncurryThis$1,toObject$C=toObject$D,hasOwnProperty$3=uncurryThis$1M({}.hasOwnProperty),hasOwnProperty_1$1=Object.hasOwn||function(e,t){return hasOwnProperty$3(toObject$C(e),t)},uncurryThis$1L=functionUncurryThis$1,id$2=0,postfix$1=Math.random(),toString$Q=uncurryThis$1L(1..toString),uid$9=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString$Q(++id$2+postfix$1,36)},global$1q=global$1v,shared$b=shared$c.exports,hasOwn$M=hasOwnProperty_1$1,uid$8=uid$9,NATIVE_SYMBOL$8=symbolConstructorDetection$1,USE_SYMBOL_AS_UID$2=useSymbolAsUid$1,WellKnownSymbolsStore$2=shared$b("wks"),_Symbol$5=global$1q.Symbol,symbolFor$1=_Symbol$5&&_Symbol$5.for,createWellKnownSymbol$1=USE_SYMBOL_AS_UID$2?_Symbol$5:_Symbol$5&&_Symbol$5.withoutSetter||uid$8,wellKnownSymbol$V=function(e){if(!hasOwn$M(WellKnownSymbolsStore$2,e)||!NATIVE_SYMBOL$8&&"string"!=typeof WellKnownSymbolsStore$2[e]){var t="Symbol."+e;NATIVE_SYMBOL$8&&hasOwn$M(_Symbol$5,e)?WellKnownSymbolsStore$2[e]=_Symbol$5[e]:WellKnownSymbolsStore$2[e]=USE_SYMBOL_AS_UID$2&&symbolFor$1?symbolFor$1(t):createWellKnownSymbol$1(t)}return WellKnownSymbolsStore$2[e]},call$U=functionCall$1,isObject$S=isObject$U,isSymbol$b=isSymbol$c,getMethod$c=getMethod$d,ordinaryToPrimitive$2=ordinaryToPrimitive$3,wellKnownSymbol$U=wellKnownSymbol$V,$TypeError$B=TypeError,TO_PRIMITIVE$1=wellKnownSymbol$U("toPrimitive"),toPrimitive$7=function(e,t){if(!isObject$S(e)||isSymbol$b(e))return e;var r,n=getMethod$c(e,TO_PRIMITIVE$1);if(n){if(void 0===t&&(t="default"),r=call$U(n,e,t),!isObject$S(r)||isSymbol$b(r))return r;throw $TypeError$B("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive$2(e,t)},toPrimitive$6=toPrimitive$7,isSymbol$a=isSymbol$c,toPropertyKey$b=function(e){var t=toPrimitive$6(e,"string");return isSymbol$a(t)?t:t+""},global$1p=global$1v,isObject$R=isObject$U,document$6=global$1p.document,EXISTS$3=isObject$R(document$6)&&isObject$R(document$6.createElement),documentCreateElement$5=function(e){return EXISTS$3?document$6.createElement(e):{}},DESCRIPTORS$Y=descriptors$1,fails$1L=fails$1Q,createElement$3=documentCreateElement$5,ie8DomDefine$1=!DESCRIPTORS$Y&&!fails$1L((function(){return 7!=Object.defineProperty(createElement$3("div"),"a",{get:function(){return 7}}).a})),DESCRIPTORS$X=descriptors$1,call$T=functionCall$1,propertyIsEnumerableModule$4=objectPropertyIsEnumerable$1,createPropertyDescriptor$j=createPropertyDescriptor$k,toIndexedObject$p=toIndexedObject$q,toPropertyKey$a=toPropertyKey$b,hasOwn$L=hasOwnProperty_1$1,IE8_DOM_DEFINE$3=ie8DomDefine$1,$getOwnPropertyDescriptor$4=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor$1.f=DESCRIPTORS$X?$getOwnPropertyDescriptor$4:function(e,t){if(e=toIndexedObject$p(e),t=toPropertyKey$a(t),IE8_DOM_DEFINE$3)try{return $getOwnPropertyDescriptor$4(e,t)}catch(r){}if(hasOwn$L(e,t))return createPropertyDescriptor$j(!call$T(propertyIsEnumerableModule$4.f,e,t),e[t])};var objectDefineProperty$1={},DESCRIPTORS$W=descriptors$1,fails$1K=fails$1Q,v8PrototypeDefineBug$1=DESCRIPTORS$W&&fails$1K((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),isObject$Q=isObject$U,$String$8=String,$TypeError$A=TypeError,anObject$L=function(e){if(isObject$Q(e))return e;throw $TypeError$A($String$8(e)+" is not an object")},DESCRIPTORS$V=descriptors$1,IE8_DOM_DEFINE$2=ie8DomDefine$1,V8_PROTOTYPE_DEFINE_BUG$3=v8PrototypeDefineBug$1,anObject$K=anObject$L,toPropertyKey$9=toPropertyKey$b,$TypeError$z=TypeError,$defineProperty$2=Object.defineProperty,$getOwnPropertyDescriptor$3=Object.getOwnPropertyDescriptor,ENUMERABLE$1="enumerable",CONFIGURABLE$3="configurable",WRITABLE$1="writable";objectDefineProperty$1.f=DESCRIPTORS$V?V8_PROTOTYPE_DEFINE_BUG$3?function(e,t,r){if(anObject$K(e),t=toPropertyKey$9(t),anObject$K(r),"function"==typeof e&&"prototype"===t&&"value"in r&&WRITABLE$1 in r&&!r[WRITABLE$1]){var n=$getOwnPropertyDescriptor$3(e,t);n&&n[WRITABLE$1]&&(e[t]=r.value,r={configurable:CONFIGURABLE$3 in r?r[CONFIGURABLE$3]:n[CONFIGURABLE$3],enumerable:ENUMERABLE$1 in r?r[ENUMERABLE$1]:n[ENUMERABLE$1],writable:!1})}return $defineProperty$2(e,t,r)}:$defineProperty$2:function(e,t,r){if(anObject$K(e),t=toPropertyKey$9(t),anObject$K(r),IE8_DOM_DEFINE$2)try{return $defineProperty$2(e,t,r)}catch(n){}if("get"in r||"set"in r)throw $TypeError$z("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var DESCRIPTORS$U=descriptors$1,definePropertyModule$e=objectDefineProperty$1,createPropertyDescriptor$i=createPropertyDescriptor$k,createNonEnumerableProperty$o=DESCRIPTORS$U?function(e,t,r){return definePropertyModule$e.f(e,t,createPropertyDescriptor$i(1,r))}:function(e,t,r){return e[t]=r,e},makeBuiltIn$7={exports:{}},DESCRIPTORS$T=descriptors$1,hasOwn$K=hasOwnProperty_1$1,FunctionPrototype$6=Function.prototype,getDescriptor$1=DESCRIPTORS$T&&Object.getOwnPropertyDescriptor,EXISTS$2=hasOwn$K(FunctionPrototype$6,"name"),PROPER$1=EXISTS$2&&"something"===function(){}.name,CONFIGURABLE$2=EXISTS$2&&(!DESCRIPTORS$T||DESCRIPTORS$T&&getDescriptor$1(FunctionPrototype$6,"name").configurable),functionName$1={EXISTS:EXISTS$2,PROPER:PROPER$1,CONFIGURABLE:CONFIGURABLE$2},uncurryThis$1K=functionUncurryThis$1,isCallable$T=isCallable$Z,store$5=sharedStore$1,functionToString$4=uncurryThis$1K(Function.toString);isCallable$T(store$5.inspectSource)||(store$5.inspectSource=function(e){return functionToString$4(e)});var inspectSource$7=store$5.inspectSource,global$1o=global$1v,isCallable$S=isCallable$Z,WeakMap$4=global$1o.WeakMap,weakMapBasicDetection$1=isCallable$S(WeakMap$4)&&/native code/.test(String(WeakMap$4)),shared$a=shared$c.exports,uid$7=uid$9,keys$a=shared$a("keys"),sharedKey$8=function(e){return keys$a[e]||(keys$a[e]=uid$7(e))},hiddenKeys$b={},NATIVE_WEAK_MAP$1=weakMapBasicDetection$1,global$1n=global$1v,isObject$P=isObject$U,createNonEnumerableProperty$n=createNonEnumerableProperty$o,hasOwn$J=hasOwnProperty_1$1,shared$9=sharedStore$1,sharedKey$7=sharedKey$8,hiddenKeys$a=hiddenKeys$b,OBJECT_ALREADY_INITIALIZED$1="Object already initialized",TypeError$d=global$1n.TypeError,WeakMap$3=global$1n.WeakMap,set$5,get$3,has$1,enforce$1=function(e){return has$1(e)?get$3(e):set$5(e,{})},getterFor$3=function(e){return function(t){var r;if(!isObject$P(t)||(r=get$3(t)).type!==e)throw TypeError$d("Incompatible receiver, "+e+" required");return r}};if(NATIVE_WEAK_MAP$1||shared$9.state){var store$4=shared$9.state||(shared$9.state=new WeakMap$3);store$4.get=store$4.get,store$4.has=store$4.has,store$4.set=store$4.set,set$5=function(e,t){if(store$4.has(e))throw TypeError$d(OBJECT_ALREADY_INITIALIZED$1);return t.facade=e,store$4.set(e,t),t},get$3=function(e){return store$4.get(e)||{}},has$1=function(e){return store$4.has(e)}}else{var STATE$1=sharedKey$7("state");hiddenKeys$a[STATE$1]=!0,set$5=function(e,t){if(hasOwn$J(e,STATE$1))throw TypeError$d(OBJECT_ALREADY_INITIALIZED$1);return t.facade=e,createNonEnumerableProperty$n(e,STATE$1,t),t},get$3=function(e){return hasOwn$J(e,STATE$1)?e[STATE$1]:{}},has$1=function(e){return hasOwn$J(e,STATE$1)}}var internalState$1={set:set$5,get:get$3,has:has$1,enforce:enforce$1,getterFor:getterFor$3},fails$1J=fails$1Q,isCallable$R=isCallable$Z,hasOwn$I=hasOwnProperty_1$1,DESCRIPTORS$S=descriptors$1,CONFIGURABLE_FUNCTION_NAME$5=functionName$1.CONFIGURABLE,inspectSource$6=inspectSource$7,InternalStateModule$l=internalState$1,enforceInternalState$6=InternalStateModule$l.enforce,getInternalState$h=InternalStateModule$l.get,defineProperty$w=Object.defineProperty,CONFIGURABLE_LENGTH$1=DESCRIPTORS$S&&!fails$1J((function(){return 8!==defineProperty$w((function(){}),"length",{value:8}).length})),TEMPLATE$1=String(String).split("String"),makeBuiltIn$6=makeBuiltIn$7.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!hasOwn$I(e,"name")||CONFIGURABLE_FUNCTION_NAME$5&&e.name!==t)&&(DESCRIPTORS$S?defineProperty$w(e,"name",{value:t,configurable:!0}):e.name=t),CONFIGURABLE_LENGTH$1&&r&&hasOwn$I(r,"arity")&&e.length!==r.arity&&defineProperty$w(e,"length",{value:r.arity});try{r&&hasOwn$I(r,"constructor")&&r.constructor?DESCRIPTORS$S&&defineProperty$w(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var n=enforceInternalState$6(e);return hasOwn$I(n,"source")||(n.source=TEMPLATE$1.join("string"==typeof t?t:"")),e};Function.prototype.toString=makeBuiltIn$6((function(){return isCallable$R(this)&&getInternalState$h(this).source||inspectSource$6(this)}),"toString");var isCallable$Q=isCallable$Z,definePropertyModule$d=objectDefineProperty$1,makeBuiltIn$5=makeBuiltIn$7.exports,defineGlobalProperty$5=defineGlobalProperty$7,defineBuiltIn$D=function(e,t,r,n){n||(n={});var i=n.enumerable,a=void 0!==n.name?n.name:t;if(isCallable$Q(r)&&makeBuiltIn$5(r,a,n),n.global)i?e[t]=r:defineGlobalProperty$5(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(o){}i?e[t]=r:definePropertyModule$d.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},objectGetOwnPropertyNames$1={},ceil$3=Math.ceil,floor$j=Math.floor,mathTrunc$1=Math.trunc||function(e){var t=+e;return(t>0?floor$j:ceil$3)(t)},trunc$3=mathTrunc$1,toIntegerOrInfinity$v=function(e){var t=+e;return t!=t||0===t?0:trunc$3(t)},toIntegerOrInfinity$u=toIntegerOrInfinity$v,max$c=Math.max,min$g=Math.min,toAbsoluteIndex$h=function(e,t){var r=toIntegerOrInfinity$u(e);return r<0?max$c(r+t,0):min$g(r,t)},toIntegerOrInfinity$t=toIntegerOrInfinity$v,min$f=Math.min,toLength$m=function(e){return e>0?min$f(toIntegerOrInfinity$t(e),9007199254740991):0},toLength$l=toLength$m,lengthOfArrayLike$K=function(e){return toLength$l(e.length)},toIndexedObject$o=toIndexedObject$q,toAbsoluteIndex$g=toAbsoluteIndex$h,lengthOfArrayLike$J=lengthOfArrayLike$K,createMethod$f=function(e){return function(t,r,n){var i,a=toIndexedObject$o(t),o=lengthOfArrayLike$J(a),s=toAbsoluteIndex$g(n,o);if(e&&r!=r){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===r)return e||s||0;return!e&&-1}},arrayIncludes$1={includes:createMethod$f(!0),indexOf:createMethod$f(!1)},uncurryThis$1J=functionUncurryThis$1,hasOwn$H=hasOwnProperty_1$1,toIndexedObject$n=toIndexedObject$q,indexOf$4=arrayIncludes$1.indexOf,hiddenKeys$9=hiddenKeys$b,push$j=uncurryThis$1J([].push),objectKeysInternal$1=function(e,t){var r,n=toIndexedObject$n(e),i=0,a=[];for(r in n)!hasOwn$H(hiddenKeys$9,r)&&hasOwn$H(n,r)&&push$j(a,r);for(;t.length>i;)hasOwn$H(n,r=t[i++])&&(~indexOf$4(a,r)||push$j(a,r));return a},enumBugKeys$7=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys$3=objectKeysInternal$1,enumBugKeys$6=enumBugKeys$7,hiddenKeys$8=enumBugKeys$6.concat("length","prototype");objectGetOwnPropertyNames$1.f=Object.getOwnPropertyNames||function(e){return internalObjectKeys$3(e,hiddenKeys$8)};var objectGetOwnPropertySymbols$1={};objectGetOwnPropertySymbols$1.f=Object.getOwnPropertySymbols;var getBuiltIn$x=getBuiltIn$A,uncurryThis$1I=functionUncurryThis$1,getOwnPropertyNamesModule$3=objectGetOwnPropertyNames$1,getOwnPropertySymbolsModule$5=objectGetOwnPropertySymbols$1,anObject$J=anObject$L,concat$8=uncurryThis$1I([].concat),ownKeys$j=getBuiltIn$x("Reflect","ownKeys")||function(e){var t=getOwnPropertyNamesModule$3.f(anObject$J(e)),r=getOwnPropertySymbolsModule$5.f;return r?concat$8(t,r(e)):t},hasOwn$G=hasOwnProperty_1$1,ownKeys$i=ownKeys$j,getOwnPropertyDescriptorModule$5=objectGetOwnPropertyDescriptor$1,definePropertyModule$c=objectDefineProperty$1,copyConstructorProperties$6=function(e,t,r){for(var n=ownKeys$i(t),i=definePropertyModule$c.f,a=getOwnPropertyDescriptorModule$5.f,o=0;o<n.length;o++){var s=n[o];hasOwn$G(e,s)||r&&hasOwn$G(r,s)||i(e,s,a(t,s))}},fails$1I=fails$1Q,isCallable$P=isCallable$Z,replacement$1=/#|\.prototype\./,isForced$9=function(e,t){var r=data$1[normalize$1(e)];return r==POLYFILL$1||r!=NATIVE$1&&(isCallable$P(t)?fails$1I(t):!!t)},normalize$1=isForced$9.normalize=function(e){return String(e).replace(replacement$1,".").toLowerCase()},data$1=isForced$9.data={},NATIVE$1=isForced$9.NATIVE="N",POLYFILL$1=isForced$9.POLYFILL="P",isForced_1$1=isForced$9,global$1m=global$1v,getOwnPropertyDescriptor$c=objectGetOwnPropertyDescriptor$1.f,createNonEnumerableProperty$m=createNonEnumerableProperty$o,defineBuiltIn$C=defineBuiltIn$D,defineGlobalProperty$4=defineGlobalProperty$7,copyConstructorProperties$5=copyConstructorProperties$6,isForced$8=isForced_1$1,_export$1=function(e,t){var r,n,i,a,o,s=e.target,l=e.global,u=e.stat;if(r=l?global$1m:u?global$1m[s]||defineGlobalProperty$4(s,{}):(global$1m[s]||{}).prototype)for(n in t){if(a=t[n],i=e.dontCallGetSet?(o=getOwnPropertyDescriptor$c(r,n))&&o.value:r[n],!isForced$8(l?n:s+(u?".":"#")+n,e.forced)&&void 0!==i){if(_typeof$b(a)==_typeof$b(i))continue;copyConstructorProperties$5(a,i)}(e.sham||i&&i.sham)&&createNonEnumerableProperty$m(a,"sham",!0),defineBuiltIn$C(r,n,a,e)}},uncurryThis$1H=functionUncurryThis$1,aCallable$n=aCallable$p,NATIVE_BIND$7=functionBindNative$1,bind$q=uncurryThis$1H(uncurryThis$1H.bind),functionBindContext$1=function(e,t){return aCallable$n(e),void 0===t?e:NATIVE_BIND$7?bind$q(e,t):function(){return e.apply(t,arguments)}},classof$v=classofRaw$5,isArray$d=Array.isArray||function(e){return"Array"==classof$v(e)},wellKnownSymbol$T=wellKnownSymbol$V,TO_STRING_TAG$9=wellKnownSymbol$T("toStringTag"),test$4={};test$4[TO_STRING_TAG$9]="z";var toStringTagSupport$1="[object z]"===String(test$4),TO_STRING_TAG_SUPPORT$5=toStringTagSupport$1,isCallable$O=isCallable$Z,classofRaw$3=classofRaw$5,wellKnownSymbol$S=wellKnownSymbol$V,TO_STRING_TAG$8=wellKnownSymbol$S("toStringTag"),$Object$6=Object,CORRECT_ARGUMENTS$1="Arguments"==classofRaw$3(function(){return arguments}()),tryGet$1=function(e,t){try{return e[t]}catch(r){}},classof$u=TO_STRING_TAG_SUPPORT$5?classofRaw$3:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet$1(t=$Object$6(e),TO_STRING_TAG$8))?r:CORRECT_ARGUMENTS$1?classofRaw$3(t):"Object"==(n=classofRaw$3(t))&&isCallable$O(t.callee)?"Arguments":n},uncurryThis$1G=functionUncurryThis$1,fails$1H=fails$1Q,isCallable$N=isCallable$Z,classof$t=classof$u,getBuiltIn$w=getBuiltIn$A,inspectSource$5=inspectSource$7,noop$2=function(){},empty$1=[],construct$3=getBuiltIn$w("Reflect","construct"),constructorRegExp$1=/^\s*(?:class|function)\b/,exec$h=uncurryThis$1G(constructorRegExp$1.exec),INCORRECT_TO_STRING$5=!constructorRegExp$1.exec(noop$2),isConstructorModern$1=function(e){if(!isCallable$N(e))return!1;try{return construct$3(noop$2,empty$1,e),!0}catch(t){return!1}},isConstructorLegacy$1=function(e){if(!isCallable$N(e))return!1;switch(classof$t(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING$5||!!exec$h(constructorRegExp$1,inspectSource$5(e))}catch(t){return!0}};isConstructorLegacy$1.sham=!0;var isConstructor$9=!construct$3||fails$1H((function(){var e;return isConstructorModern$1(isConstructorModern$1.call)||!isConstructorModern$1(Object)||!isConstructorModern$1((function(){e=!0}))||e}))?isConstructorLegacy$1:isConstructorModern$1,isArray$c=isArray$d,isConstructor$8=isConstructor$9,isObject$O=isObject$U,wellKnownSymbol$R=wellKnownSymbol$V,SPECIES$d=wellKnownSymbol$R("species"),$Array$a=Array,arraySpeciesConstructor$3=function(e){var t;return isArray$c(e)&&(t=e.constructor,(isConstructor$8(t)&&(t===$Array$a||isArray$c(t.prototype))||isObject$O(t)&&null===(t=t[SPECIES$d]))&&(t=void 0)),void 0===t?$Array$a:t},arraySpeciesConstructor$2=arraySpeciesConstructor$3,arraySpeciesCreate$7=function(e,t){return new(arraySpeciesConstructor$2(e))(0===t?0:t)},bind$p=functionBindContext$1,uncurryThis$1F=functionUncurryThis$1,IndexedObject$b=indexedObject$1,toObject$B=toObject$D,lengthOfArrayLike$I=lengthOfArrayLike$K,arraySpeciesCreate$6=arraySpeciesCreate$7,push$i=uncurryThis$1F([].push),createMethod$e=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(l,u,c,d){for(var h,f,p=toObject$B(l),y=IndexedObject$b(p),m=bind$p(u,c),g=lengthOfArrayLike$I(y),v=0,b=d||arraySpeciesCreate$6,_=t?b(l,g):r||o?b(l,0):void 0;g>v;v++)if((s||v in y)&&(f=m(h=y[v],v,p),e))if(t)_[v]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:push$i(_,h)}else switch(e){case 4:return!1;case 7:push$i(_,h)}return a?-1:n||i?i:_}},arrayIteration$1={forEach:createMethod$e(0),map:createMethod$e(1),filter:createMethod$e(2),some:createMethod$e(3),every:createMethod$e(4),find:createMethod$e(5),findIndex:createMethod$e(6),filterReject:createMethod$e(7)},objectDefineProperties$1={},internalObjectKeys$2=objectKeysInternal$1,enumBugKeys$5=enumBugKeys$7,objectKeys$8=Object.keys||function(e){return internalObjectKeys$2(e,enumBugKeys$5)},DESCRIPTORS$R=descriptors$1,V8_PROTOTYPE_DEFINE_BUG$2=v8PrototypeDefineBug$1,definePropertyModule$b=objectDefineProperty$1,anObject$I=anObject$L,toIndexedObject$m=toIndexedObject$q,objectKeys$7=objectKeys$8;objectDefineProperties$1.f=DESCRIPTORS$R&&!V8_PROTOTYPE_DEFINE_BUG$2?Object.defineProperties:function(e,t){anObject$I(e);for(var r,n=toIndexedObject$m(t),i=objectKeys$7(t),a=i.length,o=0;a>o;)definePropertyModule$b.f(e,r=i[o++],n[r]);return e};var getBuiltIn$v=getBuiltIn$A,html$5=getBuiltIn$v("document","documentElement"),anObject$H=anObject$L,definePropertiesModule$2=objectDefineProperties$1,enumBugKeys$4=enumBugKeys$7,hiddenKeys$7=hiddenKeys$b,html$4=html$5,documentCreateElement$4=documentCreateElement$5,sharedKey$6=sharedKey$8,GT$1=">",LT$1="<",PROTOTYPE$4="prototype",SCRIPT$1="script",IE_PROTO$3=sharedKey$6("IE_PROTO"),EmptyConstructor$1=function(){},scriptTag$1=function(e){return LT$1+SCRIPT$1+GT$1+e+LT$1+"/"+SCRIPT$1+GT$1},NullProtoObjectViaActiveX$1=function(e){e.write(scriptTag$1("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame$1=function(){var e,t=documentCreateElement$4("iframe"),r="java"+SCRIPT$1+":";return t.style.display="none",html$4.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(scriptTag$1("document.F=Object")),e.close(),e.F},activeXDocument$1,_NullProtoObject$1=function(){try{activeXDocument$1=new ActiveXObject("htmlfile")}catch(t){}_NullProtoObject$1="undefined"!=typeof document?document.domain&&activeXDocument$1?NullProtoObjectViaActiveX$1(activeXDocument$1):NullProtoObjectViaIFrame$1():NullProtoObjectViaActiveX$1(activeXDocument$1);for(var e=enumBugKeys$4.length;e--;)delete _NullProtoObject$1[PROTOTYPE$4][enumBugKeys$4[e]];return _NullProtoObject$1()};hiddenKeys$7[IE_PROTO$3]=!0;var objectCreate$2=Object.create||function(e,t){var r;return null!==e?(EmptyConstructor$1[PROTOTYPE$4]=anObject$H(e),r=new EmptyConstructor$1,EmptyConstructor$1[PROTOTYPE$4]=null,r[IE_PROTO$3]=e):r=_NullProtoObject$1(),void 0===t?r:definePropertiesModule$2.f(r,t)},wellKnownSymbol$Q=wellKnownSymbol$V,create$g=objectCreate$2,defineProperty$v=objectDefineProperty$1.f,UNSCOPABLES$1=wellKnownSymbol$Q("unscopables"),ArrayPrototype$3=Array.prototype;null==ArrayPrototype$3[UNSCOPABLES$1]&&defineProperty$v(ArrayPrototype$3,UNSCOPABLES$1,{configurable:!0,value:create$g(null)});var addToUnscopables$a=function(e){ArrayPrototype$3[UNSCOPABLES$1][e]=!0},$$2h=_export$1,$find$3=arrayIteration$1.find,addToUnscopables$9=addToUnscopables$a,FIND$1="find",SKIPS_HOLES$2=!0;FIND$1 in[]&&Array(1)[FIND$1]((function(){SKIPS_HOLES$2=!1})),$$2h({target:"Array",proto:!0,forced:SKIPS_HOLES$2},{find:function(e){return $find$3(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$9(FIND$1);var es_object_toString={},TO_STRING_TAG_SUPPORT$4=toStringTagSupport$1,classof$s=classof$u,objectToString$1=TO_STRING_TAG_SUPPORT$4?{}.toString:function(){return"[object "+classof$s(this)+"]"},TO_STRING_TAG_SUPPORT$3=toStringTagSupport$1,defineBuiltIn$B=defineBuiltIn$D,toString$P=objectToString$1;TO_STRING_TAG_SUPPORT$3||defineBuiltIn$B(Object.prototype,"toString",toString$P,{unsafe:!0});var es_array_concat={},$TypeError$y=TypeError,MAX_SAFE_INTEGER$3=9007199254740991,doesNotExceedSafeInteger$9=function(e){if(e>MAX_SAFE_INTEGER$3)throw $TypeError$y("Maximum allowed index exceeded");return e},toPropertyKey$8=toPropertyKey$b,definePropertyModule$a=objectDefineProperty$1,createPropertyDescriptor$h=createPropertyDescriptor$k,createProperty$c=function(e,t,r){var n=toPropertyKey$8(t);n in e?definePropertyModule$a.f(e,n,createPropertyDescriptor$h(0,r)):e[n]=r},fails$1G=fails$1Q,wellKnownSymbol$P=wellKnownSymbol$V,V8_VERSION$6=engineV8Version$1,SPECIES$c=wellKnownSymbol$P("species"),arrayMethodHasSpeciesSupport$b=function(e){return V8_VERSION$6>=51||!fails$1G((function(){var t=[];return(t.constructor={})[SPECIES$c]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},$$2g=_export$1,fails$1F=fails$1Q,isArray$b=isArray$d,isObject$N=isObject$U,toObject$A=toObject$D,lengthOfArrayLike$H=lengthOfArrayLike$K,doesNotExceedSafeInteger$8=doesNotExceedSafeInteger$9,createProperty$b=createProperty$c,arraySpeciesCreate$5=arraySpeciesCreate$7,arrayMethodHasSpeciesSupport$a=arrayMethodHasSpeciesSupport$b,wellKnownSymbol$O=wellKnownSymbol$V,V8_VERSION$5=engineV8Version$1,IS_CONCAT_SPREADABLE$1=wellKnownSymbol$O("isConcatSpreadable"),IS_CONCAT_SPREADABLE_SUPPORT$1=V8_VERSION$5>=51||!fails$1F((function(){var e=[];return e[IS_CONCAT_SPREADABLE$1]=!1,e.concat()[0]!==e})),SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport$a("concat"),isConcatSpreadable$1=function(e){if(!isObject$N(e))return!1;var t=e[IS_CONCAT_SPREADABLE$1];return void 0!==t?!!t:isArray$b(e)},FORCED$r=!IS_CONCAT_SPREADABLE_SUPPORT$1||!SPECIES_SUPPORT$1;$$2g({target:"Array",proto:!0,arity:1,forced:FORCED$r},{concat:function(e){var t,r,n,i,a,o=toObject$A(this),s=arraySpeciesCreate$5(o,0),l=0;for(t=-1,n=arguments.length;t<n;t++)if(isConcatSpreadable$1(a=-1===t?o:arguments[t]))for(i=lengthOfArrayLike$H(a),doesNotExceedSafeInteger$8(l+i),r=0;r<i;r++,l++)r in a&&createProperty$b(s,l,a[r]);else doesNotExceedSafeInteger$8(l+1),createProperty$b(s,l++,a);return s.length=l,s}});var web_domCollections_forEach={},domIterables$1={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},documentCreateElement$3=documentCreateElement$5,classList$1=documentCreateElement$3("span").classList,DOMTokenListPrototype$5=classList$1&&classList$1.constructor&&classList$1.constructor.prototype,domTokenListPrototype$1=DOMTokenListPrototype$5===Object.prototype?void 0:DOMTokenListPrototype$5,fails$1E=fails$1Q,arrayMethodIsStrict$g=function(e,t){var r=[][e];return!!r&&fails$1E((function(){r.call(null,t||function(){return 1},1)}))},$forEach$4=arrayIteration$1.forEach,arrayMethodIsStrict$f=arrayMethodIsStrict$g,STRICT_METHOD$e=arrayMethodIsStrict$f("forEach"),arrayForEach$1=STRICT_METHOD$e?[].forEach:function(e){return $forEach$4(this,e,arguments.length>1?arguments[1]:void 0)},global$1l=global$1v,DOMIterables$3=domIterables$1,DOMTokenListPrototype$4=domTokenListPrototype$1,forEach$6=arrayForEach$1,createNonEnumerableProperty$l=createNonEnumerableProperty$o,handlePrototype$3=function(e){if(e&&e.forEach!==forEach$6)try{createNonEnumerableProperty$l(e,"forEach",forEach$6)}catch(t){e.forEach=forEach$6}};for(var COLLECTION_NAME$3 in DOMIterables$3)DOMIterables$3[COLLECTION_NAME$3]&&handlePrototype$3(global$1l[COLLECTION_NAME$3]&&global$1l[COLLECTION_NAME$3].prototype);handlePrototype$3(DOMTokenListPrototype$4);var es_object_keys={},$$2f=_export$1,toObject$z=toObject$D,nativeKeys$1=objectKeys$8,fails$1D=fails$1Q,FAILS_ON_PRIMITIVES$7=fails$1D((function(){nativeKeys$1(1)}));$$2f({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$7},{keys:function(e){return nativeKeys$1(toObject$z(e))}});var es_array_slice={},uncurryThis$1E=functionUncurryThis$1,arraySlice$n=uncurryThis$1E([].slice),$$2e=_export$1,isArray$a=isArray$d,isConstructor$7=isConstructor$9,isObject$M=isObject$U,toAbsoluteIndex$f=toAbsoluteIndex$h,lengthOfArrayLike$G=lengthOfArrayLike$K,toIndexedObject$l=toIndexedObject$q,createProperty$a=createProperty$c,wellKnownSymbol$N=wellKnownSymbol$V,arrayMethodHasSpeciesSupport$9=arrayMethodHasSpeciesSupport$b,nativeSlice$1=arraySlice$n,HAS_SPECIES_SUPPORT$7=arrayMethodHasSpeciesSupport$9("slice"),SPECIES$b=wellKnownSymbol$N("species"),$Array$9=Array,max$b=Math.max;$$2e({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$7},{slice:function(e,t){var r,n,i,a=toIndexedObject$l(this),o=lengthOfArrayLike$G(a),s=toAbsoluteIndex$f(e,o),l=toAbsoluteIndex$f(void 0===t?o:t,o);if(isArray$a(a)&&(r=a.constructor,(isConstructor$7(r)&&(r===$Array$9||isArray$a(r.prototype))||isObject$M(r)&&null===(r=r[SPECIES$b]))&&(r=void 0),r===$Array$9||void 0===r))return nativeSlice$1(a,s,l);for(n=new(void 0===r?$Array$9:r)(max$b(l-s,0)),i=0;s<l;s++,i++)s in a&&createProperty$a(n,i,a[s]);return n.length=i,n}});var es_regexp_exec={},classof$r=classof$u,$String$7=String,toString$O=function(e){if("Symbol"===classof$r(e))throw TypeError("Cannot convert a Symbol value to a string");return $String$7(e)},anObject$G=anObject$L,regexpFlags$3=function(){var e=anObject$G(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},fails$1C=fails$1Q,global$1k=global$1v,$RegExp$5=global$1k.RegExp,UNSUPPORTED_Y$5=fails$1C((function(){var e=$RegExp$5("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),MISSED_STICKY$3=UNSUPPORTED_Y$5||fails$1C((function(){return!$RegExp$5("a","y").sticky})),BROKEN_CARET$1=UNSUPPORTED_Y$5||fails$1C((function(){var e=$RegExp$5("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),regexpStickyHelpers$1={BROKEN_CARET:BROKEN_CARET$1,MISSED_STICKY:MISSED_STICKY$3,UNSUPPORTED_Y:UNSUPPORTED_Y$5},fails$1B=fails$1Q,global$1j=global$1v,$RegExp$4=global$1j.RegExp,regexpUnsupportedDotAll$1=fails$1B((function(){var e=$RegExp$4(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),fails$1A=fails$1Q,global$1i=global$1v,$RegExp$3=global$1i.RegExp,regexpUnsupportedNcg$1=fails$1A((function(){var e=$RegExp$3("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),call$S=functionCall$1,uncurryThis$1D=functionUncurryThis$1,toString$N=toString$O,regexpFlags$2=regexpFlags$3,stickyHelpers$3=regexpStickyHelpers$1,shared$8=shared$c.exports,create$f=objectCreate$2,getInternalState$g=internalState$1.get,UNSUPPORTED_DOT_ALL$2=regexpUnsupportedDotAll$1,UNSUPPORTED_NCG$2=regexpUnsupportedNcg$1,nativeReplace$1=shared$8("native-string-replace",String.prototype.replace),nativeExec$1=RegExp.prototype.exec,patchedExec$1=nativeExec$1,charAt$n=uncurryThis$1D("".charAt),indexOf$3=uncurryThis$1D("".indexOf),replace$k=uncurryThis$1D("".replace),stringSlice$o=uncurryThis$1D("".slice),UPDATES_LAST_INDEX_WRONG$1=(re12=/a/,re22=/b*/g,call$S(nativeExec$1,re12,"a"),call$S(nativeExec$1,re22,"a"),0!==re12.lastIndex||0!==re22.lastIndex),re12,re22,UNSUPPORTED_Y$4=stickyHelpers$3.BROKEN_CARET,NPCG_INCLUDED$1=void 0!==/()??/.exec("")[1],PATCH$1=UPDATES_LAST_INDEX_WRONG$1||NPCG_INCLUDED$1||UNSUPPORTED_Y$4||UNSUPPORTED_DOT_ALL$2||UNSUPPORTED_NCG$2;PATCH$1&&(patchedExec$1=function(e){var t,r,n,i,a,o,s,l=this,u=getInternalState$g(l),c=toString$N(e),d=u.raw;if(d)return d.lastIndex=l.lastIndex,t=call$S(patchedExec$1,d,c),l.lastIndex=d.lastIndex,t;var h=u.groups,f=UNSUPPORTED_Y$4&&l.sticky,p=call$S(regexpFlags$2,l),y=l.source,m=0,g=c;if(f&&(p=replace$k(p,"y",""),-1===indexOf$3(p,"g")&&(p+="g"),g=stringSlice$o(c,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==charAt$n(c,l.lastIndex-1))&&(y="(?: "+y+")",g=" "+g,m++),r=new RegExp("^(?:"+y+")",p)),NPCG_INCLUDED$1&&(r=new RegExp("^"+y+"$(?!\\s)",p)),UPDATES_LAST_INDEX_WRONG$1&&(n=l.lastIndex),i=call$S(nativeExec$1,f?r:l,g),f?i?(i.input=stringSlice$o(i.input,m),i[0]=stringSlice$o(i[0],m),i.index=l.lastIndex,l.lastIndex+=i[0].length):l.lastIndex=0:UPDATES_LAST_INDEX_WRONG$1&&i&&(l.lastIndex=l.global?i.index+i[0].length:n),NPCG_INCLUDED$1&&i&&i.length>1&&call$S(nativeReplace$1,i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&h)for(i.groups=o=create$f(null),a=0;a<h.length;a++)o[(s=h[a])[0]]=i[s[1]];return i});var regexpExec$6=patchedExec$1,$$2d=_export$1,exec$g=regexpExec$6;$$2d({target:"RegExp",proto:!0,forced:/./.exec!==exec$g},{exec:exec$g});var es_regexp_test={},$$2c=_export$1,call$R=functionCall$1,isCallable$M=isCallable$Z,anObject$F=anObject$L,toString$M=toString$O,DELEGATES_TO_EXEC$1=(execCalled=!1,re3=/[ac]/,re3.exec=function(){return execCalled=!0,/./.exec.apply(this,arguments)},!0===re3.test("abc")&&execCalled),execCalled,re3,nativeTest$1=/./.test;$$2c({target:"RegExp",proto:!0,forced:!DELEGATES_TO_EXEC$1},{test:function(e){var t=anObject$F(this),r=toString$M(e),n=t.exec;if(!isCallable$M(n))return call$R(nativeTest$1,t,r);var i=call$R(n,t,r);return null!==i&&(anObject$F(i),!0)}});var es_array_join={},$$2b=_export$1,uncurryThis$1C=functionUncurryThis$1,IndexedObject$a=indexedObject$1,toIndexedObject$k=toIndexedObject$q,arrayMethodIsStrict$e=arrayMethodIsStrict$g,nativeJoin$1=uncurryThis$1C([].join),ES3_STRINGS$1=IndexedObject$a!=Object,STRICT_METHOD$d=arrayMethodIsStrict$e("join",",");$$2b({target:"Array",proto:!0,forced:ES3_STRINGS$1||!STRICT_METHOD$d},{join:function(e){return nativeJoin$1(toIndexedObject$k(this),void 0===e?",":e)}});var es_array_splice={},DESCRIPTORS$Q=descriptors$1,isArray$9=isArray$d,$TypeError$x=TypeError,getOwnPropertyDescriptor$b=Object.getOwnPropertyDescriptor,SILENT_ON_NON_WRITABLE_LENGTH_SET$1=DESCRIPTORS$Q&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}(),arraySetLength$1=SILENT_ON_NON_WRITABLE_LENGTH_SET$1?function(e,t){if(isArray$9(e)&&!getOwnPropertyDescriptor$b(e,"length").writable)throw $TypeError$x("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},tryToString$c=tryToString$e,$TypeError$w=TypeError,deletePropertyOrThrow$9=function(e,t){if(!delete e[t])throw $TypeError$w("Cannot delete property "+tryToString$c(t)+" of "+tryToString$c(e))},$$2a=_export$1,toObject$y=toObject$D,toAbsoluteIndex$e=toAbsoluteIndex$h,toIntegerOrInfinity$s=toIntegerOrInfinity$v,lengthOfArrayLike$F=lengthOfArrayLike$K,setArrayLength$5=arraySetLength$1,doesNotExceedSafeInteger$7=doesNotExceedSafeInteger$9,arraySpeciesCreate$4=arraySpeciesCreate$7,createProperty$9=createProperty$c,deletePropertyOrThrow$8=deletePropertyOrThrow$9,arrayMethodHasSpeciesSupport$8=arrayMethodHasSpeciesSupport$b,HAS_SPECIES_SUPPORT$6=arrayMethodHasSpeciesSupport$8("splice"),max$a=Math.max,min$e=Math.min;$$2a({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$6},{splice:function(e,t){var r,n,i,a,o,s,l=toObject$y(this),u=lengthOfArrayLike$F(l),c=toAbsoluteIndex$e(e,u),d=arguments.length;for(0===d?r=n=0:1===d?(r=0,n=u-c):(r=d-2,n=min$e(max$a(toIntegerOrInfinity$s(t),0),u-c)),doesNotExceedSafeInteger$7(u+r-n),i=arraySpeciesCreate$4(l,n),a=0;a<n;a++)(o=c+a)in l&&createProperty$9(i,a,l[o]);if(i.length=n,r<n){for(a=c;a<u-n;a++)s=a+r,(o=a+n)in l?l[s]=l[o]:deletePropertyOrThrow$8(l,s);for(a=u;a>u-n+r;a--)deletePropertyOrThrow$8(l,a-1)}else if(r>n)for(a=u-n;a>c;a--)s=a+r-1,(o=a+n-1)in l?l[s]=l[o]:deletePropertyOrThrow$8(l,s);for(a=0;a<r;a++)l[a+c]=arguments[a+2];return setArrayLength$5(l,u-n+r),i}});var es_promise={},classof$q=classofRaw$5,global$1h=global$1v,engineIsNode$1="process"==classof$q(global$1h.process),isCallable$L=isCallable$Z,$String$6=String,$TypeError$v=TypeError,aPossiblePrototype$3=function(e){if("object"==_typeof$b(e)||isCallable$L(e))return e;throw $TypeError$v("Can't set "+$String$6(e)+" as a prototype")},uncurryThis$1B=functionUncurryThis$1,anObject$E=anObject$L,aPossiblePrototype$2=aPossiblePrototype$3,objectSetPrototypeOf$1=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=uncurryThis$1B(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return anObject$E(r),aPossiblePrototype$2(n),t?e(r,n):r.__proto__=n,r}}():void 0),defineProperty$u=objectDefineProperty$1.f,hasOwn$F=hasOwnProperty_1$1,wellKnownSymbol$M=wellKnownSymbol$V,TO_STRING_TAG$7=wellKnownSymbol$M("toStringTag"),setToStringTag$k=function(e,t,r){e&&!r&&(e=e.prototype),e&&!hasOwn$F(e,TO_STRING_TAG$7)&&defineProperty$u(e,TO_STRING_TAG$7,{configurable:!0,value:t})},getBuiltIn$u=getBuiltIn$A,definePropertyModule$9=objectDefineProperty$1,wellKnownSymbol$L=wellKnownSymbol$V,DESCRIPTORS$P=descriptors$1,SPECIES$a=wellKnownSymbol$L("species"),setSpecies$9=function(e){var t=getBuiltIn$u(e),r=definePropertyModule$9.f;DESCRIPTORS$P&&t&&!t[SPECIES$a]&&r(t,SPECIES$a,{configurable:!0,get:function(){return this}})},isPrototypeOf$h=objectIsPrototypeOf$1,$TypeError$u=TypeError,anInstance$h=function(e,t){if(isPrototypeOf$h(t,e))return e;throw $TypeError$u("Incorrect invocation")},isConstructor$6=isConstructor$9,tryToString$b=tryToString$e,$TypeError$t=TypeError,aConstructor$6=function(e){if(isConstructor$6(e))return e;throw $TypeError$t(tryToString$b(e)+" is not a constructor")},anObject$D=anObject$L,aConstructor$5=aConstructor$6,isNullOrUndefined$e=isNullOrUndefined$h,wellKnownSymbol$K=wellKnownSymbol$V,SPECIES$9=wellKnownSymbol$K("species"),speciesConstructor$a=function(e,t){var r,n=anObject$D(e).constructor;return void 0===n||isNullOrUndefined$e(r=anObject$D(n)[SPECIES$9])?t:aConstructor$5(r)},NATIVE_BIND$6=functionBindNative$1,FunctionPrototype$5=Function.prototype,apply$j=FunctionPrototype$5.apply,call$Q=FunctionPrototype$5.call,functionApply$1="object"==("undefined"==typeof Reflect?"undefined":_typeof$b(Reflect))&&Reflect.apply||(NATIVE_BIND$6?call$Q.bind(apply$j):function(){return call$Q.apply(apply$j,arguments)}),$TypeError$s=TypeError,validateArgumentsLength$c=function(e,t){if(e<t)throw $TypeError$s("Not enough arguments");return e},userAgent$e=engineUserAgent$1,engineIsIos$1=/(?:ipad|iphone|ipod).*applewebkit/i.test(userAgent$e),global$1g=global$1v,apply$i=functionApply$1,bind$o=functionBindContext$1,isCallable$K=isCallable$Z,hasOwn$E=hasOwnProperty_1$1,fails$1z=fails$1Q,html$3=html$5,arraySlice$m=arraySlice$n,createElement$2=documentCreateElement$5,validateArgumentsLength$b=validateArgumentsLength$c,IS_IOS$3=engineIsIos$1,IS_NODE$b=engineIsNode$1,set$4=global$1g.setImmediate,clear$2=global$1g.clearImmediate,process$8=global$1g.process,Dispatch$1=global$1g.Dispatch,Function$4=global$1g.Function,MessageChannel$1=global$1g.MessageChannel,String$2=global$1g.String,counter$1=0,queue$3={},ONREADYSTATECHANGE$1="onreadystatechange",$location$1,defer$1,channel$1,port$1;try{$location$1=global$1g.location}catch(error){}var run$1=function(e){if(hasOwn$E(queue$3,e)){var t=queue$3[e];delete queue$3[e],t()}},runner$1=function(e){return function(){run$1(e)}},listener$2=function(e){run$1(e.data)},post$1=function(e){global$1g.postMessage(String$2(e),$location$1.protocol+"//"+$location$1.host)};set$4&&clear$2||(set$4=function(e){validateArgumentsLength$b(arguments.length,1);var t=isCallable$K(e)?e:Function$4(e),r=arraySlice$m(arguments,1);return queue$3[++counter$1]=function(){apply$i(t,void 0,r)},defer$1(counter$1),counter$1},clear$2=function(e){delete queue$3[e]},IS_NODE$b?defer$1=function(e){process$8.nextTick(runner$1(e))}:Dispatch$1&&Dispatch$1.now?defer$1=function(e){Dispatch$1.now(runner$1(e))}:MessageChannel$1&&!IS_IOS$3?(channel$1=new MessageChannel$1,port$1=channel$1.port2,channel$1.port1.onmessage=listener$2,defer$1=bind$o(port$1.postMessage,port$1)):global$1g.addEventListener&&isCallable$K(global$1g.postMessage)&&!global$1g.importScripts&&$location$1&&"file:"!==$location$1.protocol&&!fails$1z(post$1)?(defer$1=post$1,global$1g.addEventListener("message",listener$2,!1)):defer$1=ONREADYSTATECHANGE$1 in createElement$2("script")?function(e){html$3.appendChild(createElement$2("script"))[ONREADYSTATECHANGE$1]=function(){html$3.removeChild(this),run$1(e)}}:function(e){setTimeout(runner$1(e),0)});var task$3={set:set$4,clear:clear$2},userAgent$d=engineUserAgent$1,global$1f=global$1v,engineIsIosPebble$1=/ipad|iphone|ipod/i.test(userAgent$d)&&void 0!==global$1f.Pebble,userAgent$c=engineUserAgent$1,engineIsWebosWebkit$1=/web0s(?!.*chrome)/i.test(userAgent$c),global$1e=global$1v,bind$n=functionBindContext$1,getOwnPropertyDescriptor$a=objectGetOwnPropertyDescriptor$1.f,macrotask$1=task$3.set,IS_IOS$2=engineIsIos$1,IS_IOS_PEBBLE$1=engineIsIosPebble$1,IS_WEBOS_WEBKIT$1=engineIsWebosWebkit$1,IS_NODE$a=engineIsNode$1,MutationObserver$2=global$1e.MutationObserver||global$1e.WebKitMutationObserver,document$5=global$1e.document,process$7=global$1e.process,Promise$2=global$1e.Promise,queueMicrotaskDescriptor$1=getOwnPropertyDescriptor$a(global$1e,"queueMicrotask"),queueMicrotask$1=queueMicrotaskDescriptor$1&&queueMicrotaskDescriptor$1.value,flush$1,head$1,last$1,notify$3,toggle$1,node$1,promise$1,then$1;queueMicrotask$1||(flush$1=function(){var e,t;for(IS_NODE$a&&(e=process$7.domain)&&e.exit();head$1;){t=head$1.fn,head$1=head$1.next;try{t()}catch(error){throw head$1?notify$3():last$1=void 0,error}}last$1=void 0,e&&e.enter()},IS_IOS$2||IS_NODE$a||IS_WEBOS_WEBKIT$1||!MutationObserver$2||!document$5?!IS_IOS_PEBBLE$1&&Promise$2&&Promise$2.resolve?(promise$1=Promise$2.resolve(void 0),promise$1.constructor=Promise$2,then$1=bind$n(promise$1.then,promise$1),notify$3=function(){then$1(flush$1)}):IS_NODE$a?notify$3=function(){process$7.nextTick(flush$1)}:(macrotask$1=bind$n(macrotask$1,global$1e),notify$3=function(){macrotask$1(flush$1)}):(toggle$1=!0,node$1=document$5.createTextNode(""),new MutationObserver$2(flush$1).observe(node$1,{characterData:!0}),notify$3=function(){node$1.data=toggle$1=!toggle$1}));var microtask$3=queueMicrotask$1||function(e){var t={fn:e,next:void 0};last$1&&(last$1.next=t),head$1||(head$1=t,notify$3()),last$1=t},global$1d=global$1v,hostReportErrors$3=function(e,t){var r=global$1d.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},perform$7=function(e){try{return{error:!1,value:e()}}catch(error){return{error:!0,value:error}}},Queue$3=function(){this.head=null,this.tail=null};Queue$3.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var queue$2=Queue$3,global$1c=global$1v,promiseNativeConstructor$1=global$1c.Promise,engineIsDeno$1="object"==("undefined"==typeof Deno?"undefined":_typeof$b(Deno))&&Deno&&"object"==_typeof$b(Deno.version),IS_DENO$3=engineIsDeno$1,IS_NODE$9=engineIsNode$1,engineIsBrowser$1=!IS_DENO$3&&!IS_NODE$9&&"object"==("undefined"==typeof window?"undefined":_typeof$b(window))&&"object"==("undefined"==typeof document?"undefined":_typeof$b(document)),global$1b=global$1v,NativePromiseConstructor$9=promiseNativeConstructor$1,isCallable$J=isCallable$Z,isForced$7=isForced_1$1,inspectSource$4=inspectSource$7,wellKnownSymbol$J=wellKnownSymbol$V,IS_BROWSER$1=engineIsBrowser$1,IS_DENO$2=engineIsDeno$1,V8_VERSION$4=engineV8Version$1;NativePromiseConstructor$9&&NativePromiseConstructor$9.prototype;var SPECIES$8=wellKnownSymbol$J("species"),SUBCLASSING$1=!1,NATIVE_PROMISE_REJECTION_EVENT$3=isCallable$J(global$1b.PromiseRejectionEvent),FORCED_PROMISE_CONSTRUCTOR$b=isForced$7("Promise",(function(){var e=inspectSource$4(NativePromiseConstructor$9),t=e!==String(NativePromiseConstructor$9);if(!t&&66===V8_VERSION$4)return!0;if(!V8_VERSION$4||V8_VERSION$4<51||!/native code/.test(e)){var r=new NativePromiseConstructor$9((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[SPECIES$8]=n,!(SUBCLASSING$1=r.then((function(){}))instanceof n))return!0}return!t&&(IS_BROWSER$1||IS_DENO$2)&&!NATIVE_PROMISE_REJECTION_EVENT$3})),promiseConstructorDetection$1={CONSTRUCTOR:FORCED_PROMISE_CONSTRUCTOR$b,REJECTION_EVENT:NATIVE_PROMISE_REJECTION_EVENT$3,SUBCLASSING:SUBCLASSING$1},newPromiseCapability$5={},aCallable$m=aCallable$p,$TypeError$r=TypeError,PromiseCapability$1=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw $TypeError$r("Bad Promise constructor");t=e,r=n})),this.resolve=aCallable$m(t),this.reject=aCallable$m(r)};newPromiseCapability$5.f=function(e){return new PromiseCapability$1(e)};var $$29=_export$1,IS_NODE$8=engineIsNode$1,global$1a=global$1v,call$P=functionCall$1,defineBuiltIn$A=defineBuiltIn$D,setPrototypeOf$e=objectSetPrototypeOf$1,setToStringTag$j=setToStringTag$k,setSpecies$8=setSpecies$9,aCallable$l=aCallable$p,isCallable$I=isCallable$Z,isObject$L=isObject$U,anInstance$g=anInstance$h,speciesConstructor$9=speciesConstructor$a,task$2=task$3.set,microtask$2=microtask$3,hostReportErrors$2=hostReportErrors$3,perform$6=perform$7,Queue$2=queue$2,InternalStateModule$k=internalState$1,NativePromiseConstructor$8=promiseNativeConstructor$1,PromiseConstructorDetection$1=promiseConstructorDetection$1,newPromiseCapabilityModule$7=newPromiseCapability$5,PROMISE$1="Promise",FORCED_PROMISE_CONSTRUCTOR$a=PromiseConstructorDetection$1.CONSTRUCTOR,NATIVE_PROMISE_REJECTION_EVENT$2=PromiseConstructorDetection$1.REJECTION_EVENT,NATIVE_PROMISE_SUBCLASSING$1=PromiseConstructorDetection$1.SUBCLASSING,getInternalPromiseState$1=InternalStateModule$k.getterFor(PROMISE$1),setInternalState$h=InternalStateModule$k.set,NativePromisePrototype$5=NativePromiseConstructor$8&&NativePromiseConstructor$8.prototype,PromiseConstructor$1=NativePromiseConstructor$8,PromisePrototype$1=NativePromisePrototype$5,TypeError$c=global$1a.TypeError,document$4=global$1a.document,process$6=global$1a.process,newPromiseCapability$4=newPromiseCapabilityModule$7.f,newGenericPromiseCapability$1=newPromiseCapability$4,DISPATCH_EVENT$1=!!(document$4&&document$4.createEvent&&global$1a.dispatchEvent),UNHANDLED_REJECTION$1="unhandledrejection",REJECTION_HANDLED$1="rejectionhandled",PENDING$1=0,FULFILLED$1=1,REJECTED$1=2,HANDLED$1=1,UNHANDLED$1=2,Internal$1,OwnPromiseCapability$1,PromiseWrapper$1,nativeThen$1,isThenable$1=function(e){var t;return!(!isObject$L(e)||!isCallable$I(t=e.then))&&t},callReaction$1=function(e,t){var r,n,i,a=t.value,o=t.state==FULFILLED$1,s=o?e.ok:e.fail,l=e.resolve,u=e.reject,c=e.domain;try{s?(o||(t.rejection===UNHANDLED$1&&onHandleUnhandled$1(t),t.rejection=HANDLED$1),!0===s?r=a:(c&&c.enter(),r=s(a),c&&(c.exit(),i=!0)),r===e.promise?u(TypeError$c("Promise-chain cycle")):(n=isThenable$1(r))?call$P(n,r,l,u):l(r)):u(a)}catch(error){c&&!i&&c.exit(),u(error)}},notify$2=function(e,t){e.notified||(e.notified=!0,microtask$2((function(){for(var r,n=e.reactions;r=n.get();)callReaction$1(r,e);e.notified=!1,t&&!e.rejection&&onUnhandled$1(e)})))},dispatchEvent$1=function(e,t,r){var n,i;DISPATCH_EVENT$1?((n=document$4.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),global$1a.dispatchEvent(n)):n={promise:t,reason:r},!NATIVE_PROMISE_REJECTION_EVENT$2&&(i=global$1a["on"+e])?i(n):e===UNHANDLED_REJECTION$1&&hostReportErrors$2("Unhandled promise rejection",r)},onUnhandled$1=function(e){call$P(task$2,global$1a,(function(){var t,r=e.facade,n=e.value;if(isUnhandled$1(e)&&(t=perform$6((function(){IS_NODE$8?process$6.emit("unhandledRejection",n,r):dispatchEvent$1(UNHANDLED_REJECTION$1,r,n)})),e.rejection=IS_NODE$8||isUnhandled$1(e)?UNHANDLED$1:HANDLED$1,t.error))throw t.value}))},isUnhandled$1=function(e){return e.rejection!==HANDLED$1&&!e.parent},onHandleUnhandled$1=function(e){call$P(task$2,global$1a,(function(){var t=e.facade;IS_NODE$8?process$6.emit("rejectionHandled",t):dispatchEvent$1(REJECTION_HANDLED$1,t,e.value)}))},bind$m=function(e,t,r){return function(n){e(t,n,r)}},internalReject$1=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=REJECTED$1,notify$2(e,!0))},internalResolve$1=function e(t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===r)throw TypeError$c("Promise can't be resolved itself");var i=isThenable$1(r);i?microtask$2((function(){var n={done:!1};try{call$P(i,r,bind$m(e,n,t),bind$m(internalReject$1,n,t))}catch(error){internalReject$1(n,error,t)}})):(t.value=r,t.state=FULFILLED$1,notify$2(t,!1))}catch(error){internalReject$1({done:!1},error,t)}}};if(FORCED_PROMISE_CONSTRUCTOR$a&&(PromiseConstructor$1=function(e){anInstance$g(this,PromisePrototype$1),aCallable$l(e),call$P(Internal$1,this);var t=getInternalPromiseState$1(this);try{e(bind$m(internalResolve$1,t),bind$m(internalReject$1,t))}catch(error){internalReject$1(t,error)}},PromisePrototype$1=PromiseConstructor$1.prototype,Internal$1=function(e){setInternalState$h(this,{type:PROMISE$1,done:!1,notified:!1,parent:!1,reactions:new Queue$2,rejection:!1,state:PENDING$1,value:void 0})},Internal$1.prototype=defineBuiltIn$A(PromisePrototype$1,"then",(function(e,t){var r=getInternalPromiseState$1(this),n=newPromiseCapability$4(speciesConstructor$9(this,PromiseConstructor$1));return r.parent=!0,n.ok=!isCallable$I(e)||e,n.fail=isCallable$I(t)&&t,n.domain=IS_NODE$8?process$6.domain:void 0,r.state==PENDING$1?r.reactions.add(n):microtask$2((function(){callReaction$1(n,r)})),n.promise})),OwnPromiseCapability$1=function(){var e=new Internal$1,t=getInternalPromiseState$1(e);this.promise=e,this.resolve=bind$m(internalResolve$1,t),this.reject=bind$m(internalReject$1,t)},newPromiseCapabilityModule$7.f=newPromiseCapability$4=function(e){return e===PromiseConstructor$1||e===PromiseWrapper$1?new OwnPromiseCapability$1(e):newGenericPromiseCapability$1(e)},isCallable$I(NativePromiseConstructor$8)&&NativePromisePrototype$5!==Object.prototype)){nativeThen$1=NativePromisePrototype$5.then,NATIVE_PROMISE_SUBCLASSING$1||defineBuiltIn$A(NativePromisePrototype$5,"then",(function(e,t){var r=this;return new PromiseConstructor$1((function(e,t){call$P(nativeThen$1,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete NativePromisePrototype$5.constructor}catch(error){}setPrototypeOf$e&&setPrototypeOf$e(NativePromisePrototype$5,PromisePrototype$1)}$$29({global:!0,constructor:!0,wrap:!0,forced:FORCED_PROMISE_CONSTRUCTOR$a},{Promise:PromiseConstructor$1}),setToStringTag$j(PromiseConstructor$1,PROMISE$1,!1),setSpecies$8(PROMISE$1);var iterators$1={},wellKnownSymbol$I=wellKnownSymbol$V,Iterators$9=iterators$1,ITERATOR$l=wellKnownSymbol$I("iterator"),ArrayPrototype$2=Array.prototype,isArrayIteratorMethod$7=function(e){return void 0!==e&&(Iterators$9.Array===e||ArrayPrototype$2[ITERATOR$l]===e)},classof$p=classof$u,getMethod$b=getMethod$d,isNullOrUndefined$d=isNullOrUndefined$h,Iterators$8=iterators$1,wellKnownSymbol$H=wellKnownSymbol$V,ITERATOR$k=wellKnownSymbol$H("iterator"),getIteratorMethod$b=function(e){if(!isNullOrUndefined$d(e))return getMethod$b(e,ITERATOR$k)||getMethod$b(e,"@@iterator")||Iterators$8[classof$p(e)]},call$O=functionCall$1,aCallable$k=aCallable$p,anObject$C=anObject$L,tryToString$a=tryToString$e,getIteratorMethod$a=getIteratorMethod$b,$TypeError$q=TypeError,getIterator$9=function(e,t){var r=arguments.length<2?getIteratorMethod$a(e):t;if(aCallable$k(r))return anObject$C(call$O(r,e));throw $TypeError$q(tryToString$a(e)+" is not iterable")},call$N=functionCall$1,anObject$B=anObject$L,getMethod$a=getMethod$d,iteratorClose$5=function(e,t,r){var n,i;anObject$B(e);try{if(!(n=getMethod$a(e,"return"))){if("throw"===t)throw r;return r}n=call$N(n,e)}catch(error){i=!0,n=error}if("throw"===t)throw r;if(i)throw n;return anObject$B(n),r},bind$l=functionBindContext$1,call$M=functionCall$1,anObject$A=anObject$L,tryToString$9=tryToString$e,isArrayIteratorMethod$6=isArrayIteratorMethod$7,lengthOfArrayLike$E=lengthOfArrayLike$K,isPrototypeOf$g=objectIsPrototypeOf$1,getIterator$8=getIterator$9,getIteratorMethod$9=getIteratorMethod$b,iteratorClose$4=iteratorClose$5,$TypeError$p=TypeError,Result$1=function(e,t){this.stopped=e,this.result=t},ResultPrototype$1=Result$1.prototype,iterate$7=function(e,t,r){var n,i,a,o,s,l,u,c=r&&r.that,d=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),f=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),y=bind$l(t,c),m=function(e){return n&&iteratorClose$4(n,"normal",e),new Result$1(!0,e)},g=function(e){return d?(anObject$A(e),p?y(e[0],e[1],m):y(e[0],e[1])):p?y(e,m):y(e)};if(h)n=e.iterator;else if(f)n=e;else{if(!(i=getIteratorMethod$9(e)))throw $TypeError$p(tryToString$9(e)+" is not iterable");if(isArrayIteratorMethod$6(i)){for(a=0,o=lengthOfArrayLike$E(e);o>a;a++)if((s=g(e[a]))&&isPrototypeOf$g(ResultPrototype$1,s))return s;return new Result$1(!1)}n=getIterator$8(e,i)}for(l=h?e.next:n.next;!(u=call$M(l,n)).done;){try{s=g(u.value)}catch(error){iteratorClose$4(n,"throw",error)}if("object"==_typeof$b(s)&&s&&isPrototypeOf$g(ResultPrototype$1,s))return s}return new Result$1(!1)},wellKnownSymbol$G=wellKnownSymbol$V,ITERATOR$j=wellKnownSymbol$G("iterator"),SAFE_CLOSING$1=!1;try{var called$1=0,iteratorWithReturn$1={next:function(){return{done:!!called$1++}},return:function(){SAFE_CLOSING$1=!0}};iteratorWithReturn$1[ITERATOR$j]=function(){return this},Array.from(iteratorWithReturn$1,(function(){throw 2}))}catch(error){}var checkCorrectnessOfIteration$7=function(e,t){if(!t&&!SAFE_CLOSING$1)return!1;var r=!1;try{var n={};n[ITERATOR$j]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(error){}return r},NativePromiseConstructor$7=promiseNativeConstructor$1,checkCorrectnessOfIteration$6=checkCorrectnessOfIteration$7,FORCED_PROMISE_CONSTRUCTOR$9=promiseConstructorDetection$1.CONSTRUCTOR,promiseStaticsIncorrectIteration$1=FORCED_PROMISE_CONSTRUCTOR$9||!checkCorrectnessOfIteration$6((function(e){NativePromiseConstructor$7.all(e).then(void 0,(function(){}))})),$$28=_export$1,call$L=functionCall$1,aCallable$j=aCallable$p,newPromiseCapabilityModule$6=newPromiseCapability$5,perform$5=perform$7,iterate$6=iterate$7,PROMISE_STATICS_INCORRECT_ITERATION$3=promiseStaticsIncorrectIteration$1;$$28({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION$3},{all:function(e){var t=this,r=newPromiseCapabilityModule$6.f(t),n=r.resolve,i=r.reject,a=perform$5((function(){var r=aCallable$j(t.resolve),a=[],o=0,s=1;iterate$6(e,(function(e){var l=o++,u=!1;s++,call$L(r,t,e).then((function(e){u||(u=!0,a[l]=e,--s||n(a))}),i)})),--s||n(a)}));return a.error&&i(a.value),r.promise}});var $$27=_export$1,FORCED_PROMISE_CONSTRUCTOR$8=promiseConstructorDetection$1.CONSTRUCTOR,NativePromiseConstructor$6=promiseNativeConstructor$1,getBuiltIn$t=getBuiltIn$A,isCallable$H=isCallable$Z,defineBuiltIn$z=defineBuiltIn$D,NativePromisePrototype$4=NativePromiseConstructor$6&&NativePromiseConstructor$6.prototype;if($$27({target:"Promise",proto:!0,forced:FORCED_PROMISE_CONSTRUCTOR$8,real:!0},{catch:function(e){return this.then(void 0,e)}}),isCallable$H(NativePromiseConstructor$6)){var method$3=getBuiltIn$t("Promise").prototype.catch;NativePromisePrototype$4.catch!==method$3&&defineBuiltIn$z(NativePromisePrototype$4,"catch",method$3,{unsafe:!0})}var $$26=_export$1,call$K=functionCall$1,aCallable$i=aCallable$p,newPromiseCapabilityModule$5=newPromiseCapability$5,perform$4=perform$7,iterate$5=iterate$7,PROMISE_STATICS_INCORRECT_ITERATION$2=promiseStaticsIncorrectIteration$1;$$26({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION$2},{race:function(e){var t=this,r=newPromiseCapabilityModule$5.f(t),n=r.reject,i=perform$4((function(){var i=aCallable$i(t.resolve);iterate$5(e,(function(e){call$K(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var $$25=_export$1,call$J=functionCall$1,newPromiseCapabilityModule$4=newPromiseCapability$5,FORCED_PROMISE_CONSTRUCTOR$7=promiseConstructorDetection$1.CONSTRUCTOR;$$25({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR$7},{reject:function(e){var t=newPromiseCapabilityModule$4.f(this);return call$J(t.reject,void 0,e),t.promise}});var anObject$z=anObject$L,isObject$K=isObject$U,newPromiseCapability$3=newPromiseCapability$5,promiseResolve$5=function(e,t){if(anObject$z(e),isObject$K(t)&&t.constructor===e)return t;var r=newPromiseCapability$3.f(e);return(0,r.resolve)(t),r.promise},$$24=_export$1,getBuiltIn$s=getBuiltIn$A,FORCED_PROMISE_CONSTRUCTOR$6=promiseConstructorDetection$1.CONSTRUCTOR,promiseResolve$4=promiseResolve$5;getBuiltIn$s("Promise"),$$24({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR$6},{resolve:function(e){return promiseResolve$4(this,e)}});var es_function_name={},DESCRIPTORS$O=descriptors$1,FUNCTION_NAME_EXISTS$1=functionName$1.EXISTS,uncurryThis$1A=functionUncurryThis$1,defineProperty$t=objectDefineProperty$1.f,FunctionPrototype$4=Function.prototype,functionToString$3=uncurryThis$1A(FunctionPrototype$4.toString),nameRE$1=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,regExpExec$6=uncurryThis$1A(nameRE$1.exec),NAME$3="name";DESCRIPTORS$O&&!FUNCTION_NAME_EXISTS$1&&defineProperty$t(FunctionPrototype$4,NAME$3,{configurable:!0,get:function(){try{return regExpExec$6(nameRE$1,functionToString$3(this))[1]}catch(error){return""}}});var es_number_isNan={},$$23=_export$1;$$23({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var es_number_constructor={},isCallable$G=isCallable$Z,isObject$J=isObject$U,setPrototypeOf$d=objectSetPrototypeOf$1,inheritIfRequired$b=function(e,t,r){var n,i;return setPrototypeOf$d&&isCallable$G(n=t.constructor)&&n!==r&&isObject$J(i=n.prototype)&&i!==r.prototype&&setPrototypeOf$d(e,i),e},uncurryThis$1z=functionUncurryThis$1,thisNumberValue$5=uncurryThis$1z(1..valueOf),whitespaces$b="\t\n\v\f\r \u2028\u2029\ufeff",uncurryThis$1y=functionUncurryThis$1,requireObjectCoercible$m=requireObjectCoercible$p,toString$L=toString$O,whitespaces$a=whitespaces$b,replace$j=uncurryThis$1y("".replace),whitespace$1="["+whitespaces$a+"]",ltrim$1=RegExp("^"+whitespace$1+whitespace$1+"*"),rtrim$1=RegExp(whitespace$1+whitespace$1+"*$"),createMethod$d=function(e){return function(t){var r=toString$L(requireObjectCoercible$m(t));return 1&e&&(r=replace$j(r,ltrim$1,"")),2&e&&(r=replace$j(r,rtrim$1,"")),r}},stringTrim$1={start:createMethod$d(1),end:createMethod$d(2),trim:createMethod$d(3)},DESCRIPTORS$N=descriptors$1,global$19=global$1v,uncurryThis$1x=functionUncurryThis$1,isForced$6=isForced_1$1,defineBuiltIn$y=defineBuiltIn$D,hasOwn$D=hasOwnProperty_1$1,inheritIfRequired$a=inheritIfRequired$b,isPrototypeOf$f=objectIsPrototypeOf$1,isSymbol$9=isSymbol$c,toPrimitive$5=toPrimitive$7,fails$1y=fails$1Q,getOwnPropertyNames$7=objectGetOwnPropertyNames$1.f,getOwnPropertyDescriptor$9=objectGetOwnPropertyDescriptor$1.f,defineProperty$s=objectDefineProperty$1.f,thisNumberValue$4=thisNumberValue$5,trim$5=stringTrim$1.trim,NUMBER$1="Number",NativeNumber$1=global$19[NUMBER$1],NumberPrototype$1=NativeNumber$1.prototype,TypeError$b=global$19.TypeError,arraySlice$l=uncurryThis$1x("".slice),charCodeAt$9=uncurryThis$1x("".charCodeAt),toNumeric$1=function(e){var t=toPrimitive$5(e,"number");return"bigint"==typeof t?t:toNumber$1(t)},toNumber$1=function(e){var t,r,n,i,a,o,s,l,u=toPrimitive$5(e,"number");if(isSymbol$9(u))throw TypeError$b("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=trim$5(u),43===(t=charCodeAt$9(u,0))||45===t){if(88===(r=charCodeAt$9(u,2))||120===r)return NaN}else if(48===t){switch(charCodeAt$9(u,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+u}for(o=(a=arraySlice$l(u,2)).length,s=0;s<o;s++)if((l=charCodeAt$9(a,s))<48||l>i)return NaN;return parseInt(a,n)}return+u};if(isForced$6(NUMBER$1,!NativeNumber$1(" 0o1")||!NativeNumber$1("0b1")||NativeNumber$1("+0x1"))){for(var NumberWrapper$1=function(e){var t=arguments.length<1?0:NativeNumber$1(toNumeric$1(e)),r=this;return isPrototypeOf$f(NumberPrototype$1,r)&&fails$1y((function(){thisNumberValue$4(r)}))?inheritIfRequired$a(Object(t),r,NumberWrapper$1):t},keys$9=DESCRIPTORS$N?getOwnPropertyNames$7(NativeNumber$1):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),j$3=0,key$7;keys$9.length>j$3;j$3++)hasOwn$D(NativeNumber$1,key$7=keys$9[j$3])&&!hasOwn$D(NumberWrapper$1,key$7)&&defineProperty$s(NumberWrapper$1,key$7,getOwnPropertyDescriptor$9(NativeNumber$1,key$7));NumberWrapper$1.prototype=NumberPrototype$1,NumberPrototype$1.constructor=NumberWrapper$1,defineBuiltIn$y(global$19,NUMBER$1,NumberWrapper$1,{constructor:!0})}var es_array_map={},$$22=_export$1,$map$3=arrayIteration$1.map,arrayMethodHasSpeciesSupport$7=arrayMethodHasSpeciesSupport$b,HAS_SPECIES_SUPPORT$5=arrayMethodHasSpeciesSupport$7("map");$$22({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$5},{map:function(e){return $map$3(this,e,arguments.length>1?arguments[1]:void 0)}});var fails$1x=fails$1Q,correctPrototypeGetter$1=!fails$1x((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),hasOwn$C=hasOwnProperty_1$1,isCallable$F=isCallable$Z,toObject$x=toObject$D,sharedKey$5=sharedKey$8,CORRECT_PROTOTYPE_GETTER$3=correctPrototypeGetter$1,IE_PROTO$2=sharedKey$5("IE_PROTO"),$Object$5=Object,ObjectPrototype$7=$Object$5.prototype,objectGetPrototypeOf$1=CORRECT_PROTOTYPE_GETTER$3?$Object$5.getPrototypeOf:function(e){var t=toObject$x(e);if(hasOwn$C(t,IE_PROTO$2))return t[IE_PROTO$2];var r=t.constructor;return isCallable$F(r)&&t instanceof r?r.prototype:t instanceof $Object$5?ObjectPrototype$7:null},fails$1w=fails$1Q,isCallable$E=isCallable$Z,isObject$I=isObject$U,getPrototypeOf$7=objectGetPrototypeOf$1,defineBuiltIn$x=defineBuiltIn$D,wellKnownSymbol$F=wellKnownSymbol$V,ITERATOR$i=wellKnownSymbol$F("iterator"),BUGGY_SAFARI_ITERATORS$3=!1,IteratorPrototype$5,PrototypeOfArrayIteratorPrototype$1,arrayIterator$1;[].keys&&(arrayIterator$1=[].keys(),"next"in arrayIterator$1?(PrototypeOfArrayIteratorPrototype$1=getPrototypeOf$7(getPrototypeOf$7(arrayIterator$1)),PrototypeOfArrayIteratorPrototype$1!==Object.prototype&&(IteratorPrototype$5=PrototypeOfArrayIteratorPrototype$1)):BUGGY_SAFARI_ITERATORS$3=!0);var NEW_ITERATOR_PROTOTYPE$1=!isObject$I(IteratorPrototype$5)||fails$1w((function(){var e={};return IteratorPrototype$5[ITERATOR$i].call(e)!==e}));NEW_ITERATOR_PROTOTYPE$1&&(IteratorPrototype$5={}),isCallable$E(IteratorPrototype$5[ITERATOR$i])||defineBuiltIn$x(IteratorPrototype$5,ITERATOR$i,(function(){return this}));var iteratorsCore$1={IteratorPrototype:IteratorPrototype$5,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$3},IteratorPrototype$4=iteratorsCore$1.IteratorPrototype,create$e=objectCreate$2,createPropertyDescriptor$g=createPropertyDescriptor$k,setToStringTag$i=setToStringTag$k,Iterators$7=iterators$1,returnThis$3=function(){return this},iteratorCreateConstructor$1=function(e,t,r,n){var i=t+" Iterator";return e.prototype=create$e(IteratorPrototype$4,{next:createPropertyDescriptor$g(+!n,r)}),setToStringTag$i(e,i,!1),Iterators$7[i]=returnThis$3,e},$$21=_export$1,call$I=functionCall$1,FunctionName$3=functionName$1,isCallable$D=isCallable$Z,createIteratorConstructor$3=iteratorCreateConstructor$1,getPrototypeOf$6=objectGetPrototypeOf$1,setPrototypeOf$c=objectSetPrototypeOf$1,setToStringTag$h=setToStringTag$k,createNonEnumerableProperty$k=createNonEnumerableProperty$o,defineBuiltIn$w=defineBuiltIn$D,wellKnownSymbol$E=wellKnownSymbol$V,Iterators$6=iterators$1,IteratorsCore$1=iteratorsCore$1,PROPER_FUNCTION_NAME$7=FunctionName$3.PROPER,CONFIGURABLE_FUNCTION_NAME$4=FunctionName$3.CONFIGURABLE,IteratorPrototype$3=IteratorsCore$1.IteratorPrototype,BUGGY_SAFARI_ITERATORS$2=IteratorsCore$1.BUGGY_SAFARI_ITERATORS,ITERATOR$h=wellKnownSymbol$E("iterator"),KEYS$1="keys",VALUES$1="values",ENTRIES$2="entries",returnThis$2=function(){return this},iteratorDefine$1=function(e,t,r,n,i,a,o){createIteratorConstructor$3(r,t,n);var s,l,u,c=function(e){if(e===i&&y)return y;if(!BUGGY_SAFARI_ITERATORS$2&&e in f)return f[e];switch(e){case KEYS$1:case VALUES$1:case ENTRIES$2:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",h=!1,f=e.prototype,p=f[ITERATOR$h]||f["@@iterator"]||i&&f[i],y=!BUGGY_SAFARI_ITERATORS$2&&p||c(i),m="Array"==t&&f.entries||p;if(m&&(s=getPrototypeOf$6(m.call(new e)))!==Object.prototype&&s.next&&(getPrototypeOf$6(s)!==IteratorPrototype$3&&(setPrototypeOf$c?setPrototypeOf$c(s,IteratorPrototype$3):isCallable$D(s[ITERATOR$h])||defineBuiltIn$w(s,ITERATOR$h,returnThis$2)),setToStringTag$h(s,d,!0)),PROPER_FUNCTION_NAME$7&&i==VALUES$1&&p&&p.name!==VALUES$1&&(CONFIGURABLE_FUNCTION_NAME$4?createNonEnumerableProperty$k(f,"name",VALUES$1):(h=!0,y=function(){return call$I(p,this)})),i)if(l={values:c(VALUES$1),keys:a?y:c(KEYS$1),entries:c(ENTRIES$2)},o)for(u in l)(BUGGY_SAFARI_ITERATORS$2||h||!(u in f))&&defineBuiltIn$w(f,u,l[u]);else $$21({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS$2||h},l);return f[ITERATOR$h]!==y&&defineBuiltIn$w(f,ITERATOR$h,y,{name:i}),Iterators$6[t]=y,l},createIterResultObject$6=function(e,t){return{value:e,done:t}},toIndexedObject$j=toIndexedObject$q,addToUnscopables$8=addToUnscopables$a,Iterators$5=iterators$1,InternalStateModule$j=internalState$1,defineProperty$r=objectDefineProperty$1.f,defineIterator$4=iteratorDefine$1,createIterResultObject$5=createIterResultObject$6,DESCRIPTORS$M=descriptors$1,ARRAY_ITERATOR$1="Array Iterator",setInternalState$g=InternalStateModule$j.set,getInternalState$f=InternalStateModule$j.getterFor(ARRAY_ITERATOR$1),es_array_iterator$1=defineIterator$4(Array,"Array",(function(e,t){setInternalState$g(this,{type:ARRAY_ITERATOR$1,target:toIndexedObject$j(e),index:0,kind:t})}),(function(){var e=getInternalState$f(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,createIterResultObject$5(void 0,!0)):createIterResultObject$5("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values"),values$1=Iterators$5.Arguments=Iterators$5.Array;if(addToUnscopables$8("keys"),addToUnscopables$8("values"),addToUnscopables$8("entries"),DESCRIPTORS$M&&"values"!==values$1.name)try{defineProperty$r(values$1,"name",{value:"values"})}catch(error){}var web_domCollections_iterator={},global$18=global$1v,DOMIterables$2=domIterables$1,DOMTokenListPrototype$3=domTokenListPrototype$1,ArrayIteratorMethods$1=es_array_iterator$1,createNonEnumerableProperty$j=createNonEnumerableProperty$o,wellKnownSymbol$D=wellKnownSymbol$V,ITERATOR$g=wellKnownSymbol$D("iterator"),TO_STRING_TAG$6=wellKnownSymbol$D("toStringTag"),ArrayValues$1=ArrayIteratorMethods$1.values,handlePrototype$2=function(e,t){if(e){if(e[ITERATOR$g]!==ArrayValues$1)try{createNonEnumerableProperty$j(e,ITERATOR$g,ArrayValues$1)}catch(error){e[ITERATOR$g]=ArrayValues$1}if(e[TO_STRING_TAG$6]||createNonEnumerableProperty$j(e,TO_STRING_TAG$6,t),DOMIterables$2[t])for(var r in ArrayIteratorMethods$1)if(e[r]!==ArrayIteratorMethods$1[r])try{createNonEnumerableProperty$j(e,r,ArrayIteratorMethods$1[r])}catch(error){e[r]=ArrayIteratorMethods$1[r]}}};for(var COLLECTION_NAME$2 in DOMIterables$2)handlePrototype$2(global$18[COLLECTION_NAME$2]&&global$18[COLLECTION_NAME$2].prototype,COLLECTION_NAME$2);handlePrototype$2(DOMTokenListPrototype$3,"DOMTokenList");var es_array_filter={},$$20=_export$1,$filter$3=arrayIteration$1.filter,arrayMethodHasSpeciesSupport$6=arrayMethodHasSpeciesSupport$b,HAS_SPECIES_SUPPORT$4=arrayMethodHasSpeciesSupport$6("filter");$$20({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$4},{filter:function(e){return $filter$3(this,e,arguments.length>1?arguments[1]:void 0)}});var es_object_assign={},DESCRIPTORS$L=descriptors$1,uncurryThis$1w=functionUncurryThis$1,call$H=functionCall$1,fails$1v=fails$1Q,objectKeys$6=objectKeys$8,getOwnPropertySymbolsModule$4=objectGetOwnPropertySymbols$1,propertyIsEnumerableModule$3=objectPropertyIsEnumerable$1,toObject$w=toObject$D,IndexedObject$9=indexedObject$1,$assign$1=Object.assign,defineProperty$q=Object.defineProperty,concat$7=uncurryThis$1w([].concat),objectAssign$1=!$assign$1||fails$1v((function(){if(DESCRIPTORS$L&&1!==$assign$1({b:1},$assign$1(defineProperty$q({},"a",{enumerable:!0,get:function(){defineProperty$q(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=$assign$1({},e)[r]||objectKeys$6($assign$1({},t)).join("")!=n}))?function(e,t){for(var r=toObject$w(e),n=arguments.length,i=1,a=getOwnPropertySymbolsModule$4.f,o=propertyIsEnumerableModule$3.f;n>i;)for(var s,l=IndexedObject$9(arguments[i++]),u=a?concat$7(objectKeys$6(l),a(l)):objectKeys$6(l),c=u.length,d=0;c>d;)s=u[d++],DESCRIPTORS$L&&!call$H(o,l,s)||(r[s]=l[s]);return r}:$assign$1,$$1$=_export$1,assign$6=objectAssign$1;$$1$({target:"Object",stat:!0,arity:2,forced:Object.assign!==assign$6},{assign:assign$6});var eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,a||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=new Array(a);i<a;i++)o[i]=n[i].fn;return o},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var l,u,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,a),!0;case 6:return c.fn.call(c.context,t,n,i,a,o),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||o(this,a);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==t||i&&!s[l].once||n&&s[l].context!==n)&&u.push(s[l]);u.length?this._events[a]=1===u.length?u[0]:u:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(eventemitter3);var EventEmitter$1=eventemitter3.exports,es_string_match={},uncurryThis$1v=functionUncurryThis$1,defineBuiltIn$v=defineBuiltIn$D,regexpExec$5=regexpExec$6,fails$1u=fails$1Q,wellKnownSymbol$C=wellKnownSymbol$V,createNonEnumerableProperty$i=createNonEnumerableProperty$o,SPECIES$7=wellKnownSymbol$C("species"),RegExpPrototype$9=RegExp.prototype,fixRegexpWellKnownSymbolLogic$1=function(e,t,r,n){var i=wellKnownSymbol$C(e),a=!fails$1u((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!fails$1u((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[SPECIES$7]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!a||!o||r){var s=uncurryThis$1v(/./[i]),l=t(i,""[e],(function(e,t,r,n,i){var o=uncurryThis$1v(e),l=t.exec;return l===regexpExec$5||l===RegExpPrototype$9.exec?a&&!i?{done:!0,value:s(t,r,n)}:{done:!0,value:o(r,t,n)}:{done:!1}}));defineBuiltIn$v(String.prototype,e,l[0]),defineBuiltIn$v(RegExpPrototype$9,i,l[1])}n&&createNonEnumerableProperty$i(RegExpPrototype$9[i],"sham",!0)},uncurryThis$1u=functionUncurryThis$1,toIntegerOrInfinity$r=toIntegerOrInfinity$v,toString$K=toString$O,requireObjectCoercible$l=requireObjectCoercible$p,charAt$m=uncurryThis$1u("".charAt),charCodeAt$8=uncurryThis$1u("".charCodeAt),stringSlice$n=uncurryThis$1u("".slice),createMethod$c=function(e){return function(t,r){var n,i,a=toString$K(requireObjectCoercible$l(t)),o=toIntegerOrInfinity$r(r),s=a.length;return o<0||o>=s?e?"":void 0:(n=charCodeAt$8(a,o))<55296||n>56319||o+1===s||(i=charCodeAt$8(a,o+1))<56320||i>57343?e?charAt$m(a,o):n:e?stringSlice$n(a,o,o+2):i-56320+(n-55296<<10)+65536}},stringMultibyte$1={codeAt:createMethod$c(!1),charAt:createMethod$c(!0)},charAt$l=stringMultibyte$1.charAt,advanceStringIndex$6=function(e,t,r){return t+(r?charAt$l(e,t).length:1)},call$G=functionCall$1,anObject$y=anObject$L,isCallable$C=isCallable$Z,classof$o=classofRaw$5,regexpExec$4=regexpExec$6,$TypeError$o=TypeError,regexpExecAbstract$1=function(e,t){var r=e.exec;if(isCallable$C(r)){var n=call$G(r,e,t);return null!==n&&anObject$y(n),n}if("RegExp"===classof$o(e))return call$G(regexpExec$4,e,t);throw $TypeError$o("RegExp#exec called on incompatible receiver")},call$F=functionCall$1,fixRegExpWellKnownSymbolLogic$5=fixRegexpWellKnownSymbolLogic$1,anObject$x=anObject$L,isNullOrUndefined$c=isNullOrUndefined$h,toLength$k=toLength$m,toString$J=toString$O,requireObjectCoercible$k=requireObjectCoercible$p,getMethod$9=getMethod$d,advanceStringIndex$5=advanceStringIndex$6,regExpExec$5=regexpExecAbstract$1;fixRegExpWellKnownSymbolLogic$5("match",(function(e,t,r){return[function(t){var r=requireObjectCoercible$k(this),n=isNullOrUndefined$c(t)?void 0:getMethod$9(t,e);return n?call$F(n,t,r):new RegExp(t)[e](toString$J(r))},function(e){var n=anObject$x(this),i=toString$J(e),a=r(t,n,i);if(a.done)return a.value;if(!n.global)return regExpExec$5(n,i);var o=n.unicode;n.lastIndex=0;for(var s,l=[],u=0;null!==(s=regExpExec$5(n,i));){var c=toString$J(s[0]);l[u]=c,""===c&&(n.lastIndex=advanceStringIndex$5(i,toLength$k(n.lastIndex),o)),u++}return 0===u?null:l}]}));var es_regexp_constructor={},isObject$H=isObject$U,classof$n=classofRaw$5,wellKnownSymbol$B=wellKnownSymbol$V,MATCH$4=wellKnownSymbol$B("match"),isRegexp$1=function(e){var t;return isObject$H(e)&&(void 0!==(t=e[MATCH$4])?!!t:"RegExp"==classof$n(e))},call$E=functionCall$1,hasOwn$B=hasOwnProperty_1$1,isPrototypeOf$e=objectIsPrototypeOf$1,regExpFlags$3=regexpFlags$3,RegExpPrototype$8=RegExp.prototype,regexpGetFlags$1=function(e){var t=e.flags;return void 0!==t||"flags"in RegExpPrototype$8||hasOwn$B(e,"flags")||!isPrototypeOf$e(RegExpPrototype$8,e)?t:call$E(regExpFlags$3,e)},defineProperty$p=objectDefineProperty$1.f,proxyAccessor$4=function(e,t,r){r in e||defineProperty$p(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},DESCRIPTORS$K=descriptors$1,global$17=global$1v,uncurryThis$1t=functionUncurryThis$1,isForced$5=isForced_1$1,inheritIfRequired$9=inheritIfRequired$b,createNonEnumerableProperty$h=createNonEnumerableProperty$o,getOwnPropertyNames$6=objectGetOwnPropertyNames$1.f,isPrototypeOf$d=objectIsPrototypeOf$1,isRegExp$3=isRegexp$1,toString$I=toString$O,getRegExpFlags$2=regexpGetFlags$1,stickyHelpers$2=regexpStickyHelpers$1,proxyAccessor$3=proxyAccessor$4,defineBuiltIn$u=defineBuiltIn$D,fails$1t=fails$1Q,hasOwn$A=hasOwnProperty_1$1,enforceInternalState$5=internalState$1.enforce,setSpecies$7=setSpecies$9,wellKnownSymbol$A=wellKnownSymbol$V,UNSUPPORTED_DOT_ALL$1=regexpUnsupportedDotAll$1,UNSUPPORTED_NCG$1=regexpUnsupportedNcg$1,MATCH$3=wellKnownSymbol$A("match"),NativeRegExp=global$17.RegExp,RegExpPrototype$7=NativeRegExp.prototype,SyntaxError$1=global$17.SyntaxError,exec$f=uncurryThis$1t(RegExpPrototype$7.exec),charAt$k=uncurryThis$1t("".charAt),replace$i=uncurryThis$1t("".replace),stringIndexOf$3=uncurryThis$1t("".indexOf),stringSlice$m=uncurryThis$1t("".slice),IS_NCG=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,re1=/a/g,re2=/a/g,CORRECT_NEW=new NativeRegExp(re1)!==re1,MISSED_STICKY$2=stickyHelpers$2.MISSED_STICKY,UNSUPPORTED_Y$3=stickyHelpers$2.UNSUPPORTED_Y,BASE_FORCED=DESCRIPTORS$K&&(!CORRECT_NEW||MISSED_STICKY$2||UNSUPPORTED_DOT_ALL$1||UNSUPPORTED_NCG$1||fails$1t((function(){return re2[MATCH$3]=!1,NativeRegExp(re1)!=re1||NativeRegExp(re2)==re2||"/a/i"!=NativeRegExp(re1,"i")}))),handleDotAll=function(e){for(var t,r=e.length,n=0,i="",a=!1;n<=r;n++)"\\"!==(t=charAt$k(e,n))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+charAt$k(e,++n);return i},handleNCG=function(e){for(var t,r=e.length,n=0,i="",a=[],o={},s=!1,l=!1,u=0,c="";n<=r;n++){if("\\"===(t=charAt$k(e,n)))t+=charAt$k(e,++n);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:exec$f(IS_NCG,stringSlice$m(e,n+1))&&(n+=2,l=!0),i+=t,u++;continue;case">"===t&&l:if(""===c||hasOwn$A(o,c))throw new SyntaxError$1("Invalid capture group name");o[c]=!0,a[a.length]=[c,u],l=!1,c="";continue}l?c+=t:i+=t}return[i,a]};if(isForced$5("RegExp",BASE_FORCED)){for(var RegExpWrapper=function(e,t){var r,n,i,a,o,s,l=isPrototypeOf$d(RegExpPrototype$7,this),u=isRegExp$3(e),c=void 0===t,d=[],h=e;if(!l&&u&&c&&e.constructor===RegExpWrapper)return e;if((u||isPrototypeOf$d(RegExpPrototype$7,e))&&(e=e.source,c&&(t=getRegExpFlags$2(h))),e=void 0===e?"":toString$I(e),t=void 0===t?"":toString$I(t),h=e,UNSUPPORTED_DOT_ALL$1&&"dotAll"in re1&&(n=!!t&&stringIndexOf$3(t,"s")>-1)&&(t=replace$i(t,/s/g,"")),r=t,MISSED_STICKY$2&&"sticky"in re1&&(i=!!t&&stringIndexOf$3(t,"y")>-1)&&UNSUPPORTED_Y$3&&(t=replace$i(t,/y/g,"")),UNSUPPORTED_NCG$1&&(e=(a=handleNCG(e))[0],d=a[1]),o=inheritIfRequired$9(NativeRegExp(e,t),l?this:RegExpPrototype$7,RegExpWrapper),(n||i||d.length)&&(s=enforceInternalState$5(o),n&&(s.dotAll=!0,s.raw=RegExpWrapper(handleDotAll(e),r)),i&&(s.sticky=!0),d.length&&(s.groups=d)),e!==h)try{createNonEnumerableProperty$h(o,"source",""===h?"(?:)":h)}catch(error){}return o},keys$8=getOwnPropertyNames$6(NativeRegExp),index$5=0;keys$8.length>index$5;)proxyAccessor$3(RegExpWrapper,NativeRegExp,keys$8[index$5++]);RegExpPrototype$7.constructor=RegExpWrapper,RegExpWrapper.prototype=RegExpPrototype$7,defineBuiltIn$u(global$17,"RegExp",RegExpWrapper,{constructor:!0})}setSpecies$7("RegExp");var makeBuiltIn$4=makeBuiltIn$7.exports,defineProperty$o=objectDefineProperty$1,defineBuiltInAccessor$8=function(e,t,r){return r.get&&makeBuiltIn$4(r.get,t,{getter:!0}),r.set&&makeBuiltIn$4(r.set,t,{setter:!0}),defineProperty$o.f(e,t,r)},DESCRIPTORS$J=descriptors$1,MISSED_STICKY$1=regexpStickyHelpers$1.MISSED_STICKY,classof$m=classofRaw$5,defineBuiltInAccessor$7=defineBuiltInAccessor$8,getInternalState$e=internalState$1.get,RegExpPrototype$6=RegExp.prototype,$TypeError$n=TypeError;DESCRIPTORS$J&&MISSED_STICKY$1&&defineBuiltInAccessor$7(RegExpPrototype$6,"sticky",{configurable:!0,get:function(){if(this!==RegExpPrototype$6){if("RegExp"===classof$m(this))return!!getInternalState$e(this).sticky;throw $TypeError$n("Incompatible receiver, RegExp required")}}});var es_regexp_toString={},PROPER_FUNCTION_NAME$6=functionName$1.PROPER,defineBuiltIn$t=defineBuiltIn$D,anObject$w=anObject$L,$toString$6=toString$O,fails$1s=fails$1Q,getRegExpFlags$1=regexpGetFlags$1,TO_STRING$3="toString",RegExpPrototype$5=RegExp.prototype,nativeToString$1=RegExpPrototype$5[TO_STRING$3],NOT_GENERIC$1=fails$1s((function(){return"/a/b"!=nativeToString$1.call({source:"a",flags:"b"})})),INCORRECT_NAME$1=PROPER_FUNCTION_NAME$6&&nativeToString$1.name!=TO_STRING$3;(NOT_GENERIC$1||INCORRECT_NAME$1)&&defineBuiltIn$t(RegExp.prototype,TO_STRING$3,(function(){var e=anObject$w(this);return"/"+$toString$6(e.source)+"/"+$toString$6(getRegExpFlags$1(e))}),{unsafe:!0});var es_string_split={},toAbsoluteIndex$d=toAbsoluteIndex$h,lengthOfArrayLike$D=lengthOfArrayLike$K,createProperty$8=createProperty$c,$Array$8=Array,max$9=Math.max,arraySliceSimple$1=function(e,t,r){for(var n=lengthOfArrayLike$D(e),i=toAbsoluteIndex$d(t,n),a=toAbsoluteIndex$d(void 0===r?n:r,n),o=$Array$8(max$9(a-i,0)),s=0;i<a;i++,s++)createProperty$8(o,s,e[i]);return o.length=s,o},apply$h=functionApply$1,call$D=functionCall$1,uncurryThis$1s=functionUncurryThis$1,fixRegExpWellKnownSymbolLogic$4=fixRegexpWellKnownSymbolLogic$1,anObject$v=anObject$L,isNullOrUndefined$b=isNullOrUndefined$h,isRegExp$2=isRegexp$1,requireObjectCoercible$j=requireObjectCoercible$p,speciesConstructor$8=speciesConstructor$a,advanceStringIndex$4=advanceStringIndex$6,toLength$j=toLength$m,toString$H=toString$O,getMethod$8=getMethod$d,arraySlice$k=arraySliceSimple$1,callRegExpExec=regexpExecAbstract$1,regexpExec$3=regexpExec$6,stickyHelpers$1=regexpStickyHelpers$1,fails$1r=fails$1Q,UNSUPPORTED_Y$2=stickyHelpers$1.UNSUPPORTED_Y,MAX_UINT32=4294967295,min$d=Math.min,$push=[].push,exec$e=uncurryThis$1s(/./.exec),push$h=uncurryThis$1s($push),stringSlice$l=uncurryThis$1s("".slice),SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=!fails$1r((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));fixRegExpWellKnownSymbolLogic$4("split",(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=toString$H(requireObjectCoercible$j(this)),i=void 0===r?MAX_UINT32:r>>>0;if(0===i)return[];if(void 0===e)return[n];if(!isRegExp$2(e))return call$D(t,n,e,i);for(var a,o,s,l=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,d=new RegExp(e.source,u+"g");(a=call$D(regexpExec$3,d,n))&&!((o=d.lastIndex)>c&&(push$h(l,stringSlice$l(n,c,a.index)),a.length>1&&a.index<n.length&&apply$h($push,l,arraySlice$k(a,1)),s=a[0].length,c=o,l.length>=i));)d.lastIndex===a.index&&d.lastIndex++;return c===n.length?!s&&exec$e(d,"")||push$h(l,""):push$h(l,stringSlice$l(n,c)),l.length>i?arraySlice$k(l,0,i):l}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:call$D(t,this,e,r)}:t,[function(t,r){var i=requireObjectCoercible$j(this),a=isNullOrUndefined$b(t)?void 0:getMethod$8(t,e);return a?call$D(a,t,i,r):call$D(n,toString$H(i),t,r)},function(e,i){var a=anObject$v(this),o=toString$H(e),s=r(n,a,o,i,n!==t);if(s.done)return s.value;var l=speciesConstructor$8(a,RegExp),u=a.unicode,c=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(UNSUPPORTED_Y$2?"g":"y"),d=new l(UNSUPPORTED_Y$2?"^(?:"+a.source+")":a,c),h=void 0===i?MAX_UINT32:i>>>0;if(0===h)return[];if(0===o.length)return null===callRegExpExec(d,o)?[o]:[];for(var f=0,p=0,y=[];p<o.length;){d.lastIndex=UNSUPPORTED_Y$2?0:p;var m,g=callRegExpExec(d,UNSUPPORTED_Y$2?stringSlice$l(o,p):o);if(null===g||(m=min$d(toLength$j(d.lastIndex+(UNSUPPORTED_Y$2?p:0)),o.length))===f)p=advanceStringIndex$4(o,p,u);else{if(push$h(y,stringSlice$l(o,f,p)),y.length===h)return y;for(var v=1;v<=g.length-1;v++)if(push$h(y,g[v]),y.length===h)return y;p=f=m}}return push$h(y,stringSlice$l(o,f)),y}]}),!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC,UNSUPPORTED_Y$2);var es_string_replace={},uncurryThis$1r=functionUncurryThis$1,toObject$v=toObject$D,floor$i=Math.floor,charAt$j=uncurryThis$1r("".charAt),replace$h=uncurryThis$1r("".replace),stringSlice$k=uncurryThis$1r("".slice),SUBSTITUTION_SYMBOLS$1=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED$1=/\$([$&'`]|\d{1,2})/g,getSubstitution$3=function(e,t,r,n,i,a){var o=r+e.length,s=n.length,l=SUBSTITUTION_SYMBOLS_NO_NAMED$1;return void 0!==i&&(i=toObject$v(i),l=SUBSTITUTION_SYMBOLS$1),replace$h(a,l,(function(a,l){var u;switch(charAt$j(l,0)){case"$":return"$";case"&":return e;case"`":return stringSlice$k(t,0,r);case"'":return stringSlice$k(t,o);case"<":u=i[stringSlice$k(l,1,-1)];break;default:var c=+l;if(0===c)return a;if(c>s){var d=floor$i(c/10);return 0===d?a:d<=s?void 0===n[d-1]?charAt$j(l,1):n[d-1]+charAt$j(l,1):a}u=n[c-1]}return void 0===u?"":u}))},apply$g=functionApply$1,call$C=functionCall$1,uncurryThis$1q=functionUncurryThis$1,fixRegExpWellKnownSymbolLogic$3=fixRegexpWellKnownSymbolLogic$1,fails$1q=fails$1Q,anObject$u=anObject$L,isCallable$B=isCallable$Z,isNullOrUndefined$a=isNullOrUndefined$h,toIntegerOrInfinity$q=toIntegerOrInfinity$v,toLength$i=toLength$m,toString$G=toString$O,requireObjectCoercible$i=requireObjectCoercible$p,advanceStringIndex$3=advanceStringIndex$6,getMethod$7=getMethod$d,getSubstitution$2=getSubstitution$3,regExpExec$4=regexpExecAbstract$1,wellKnownSymbol$z=wellKnownSymbol$V,REPLACE$1=wellKnownSymbol$z("replace"),max$8=Math.max,min$c=Math.min,concat$6=uncurryThis$1q([].concat),push$g=uncurryThis$1q([].push),stringIndexOf$2=uncurryThis$1q("".indexOf),stringSlice$j=uncurryThis$1q("".slice),maybeToString$1=function(e){return void 0===e?e:String(e)},REPLACE_KEEPS_$0$1="$0"==="a".replace(/./,"$0"),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE$1=!!/./[REPLACE$1]&&""===/./[REPLACE$1]("a","$0"),REPLACE_SUPPORTS_NAMED_GROUPS$1=!fails$1q((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));fixRegExpWellKnownSymbolLogic$3("replace",(function(e,t,r){var n=REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE$1?"$":"$0";return[function(e,r){var n=requireObjectCoercible$i(this),i=isNullOrUndefined$a(e)?void 0:getMethod$7(e,REPLACE$1);return i?call$C(i,e,n,r):call$C(t,toString$G(n),e,r)},function(e,i){var a=anObject$u(this),o=toString$G(e);if("string"==typeof i&&-1===stringIndexOf$2(i,n)&&-1===stringIndexOf$2(i,"$<")){var s=r(t,a,o,i);if(s.done)return s.value}var l=isCallable$B(i);l||(i=toString$G(i));var u=a.global;if(u){var c=a.unicode;a.lastIndex=0}for(var d=[];;){var h=regExpExec$4(a,o);if(null===h)break;if(push$g(d,h),!u)break;""===toString$G(h[0])&&(a.lastIndex=advanceStringIndex$3(o,toLength$i(a.lastIndex),c))}for(var f="",p=0,y=0;y<d.length;y++){for(var m=toString$G((h=d[y])[0]),g=max$8(min$c(toIntegerOrInfinity$q(h.index),o.length),0),v=[],b=1;b<h.length;b++)push$g(v,maybeToString$1(h[b]));var _=h.groups;if(l){var E=concat$6([m],v,g,o);void 0!==_&&push$g(E,_);var T=toString$G(apply$g(i,void 0,E))}else T=getSubstitution$2(m,o,g,v,_,i);g>=p&&(f+=stringSlice$j(o,p,g)+T,p=g+m.length)}return f+stringSlice$j(o,p)}]}),!REPLACE_SUPPORTS_NAMED_GROUPS$1||!REPLACE_KEEPS_$0$1||REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE$1);var es_string_trim={},PROPER_FUNCTION_NAME$5=functionName$1.PROPER,fails$1p=fails$1Q,whitespaces$9=whitespaces$b,non$1="",stringTrimForced$1=function(e){return fails$1p((function(){return!!whitespaces$9[e]()||non$1[e]()!==non$1||PROPER_FUNCTION_NAME$5&&whitespaces$9[e].name!==e}))},$$1_=_export$1,$trim$1=stringTrim$1.trim,forcedStringTrimMethod$1=stringTrimForced$1;$$1_({target:"String",proto:!0,forced:forcedStringTrimMethod$1("trim")},{trim:function(){return $trim$1(this)}});var es_array_sort={},arraySlice$j=arraySliceSimple$1,floor$h=Math.floor,mergeSort$1=function e(t,r){var n=t.length,i=floor$h(n/2);return n<8?insertionSort$1(t,r):merge$1(t,e(arraySlice$j(t,0,i),r),e(arraySlice$j(t,i),r),r)},insertionSort$1=function(e,t){for(var r,n,i=e.length,a=1;a<i;){for(n=a,r=e[a];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==a++&&(e[n]=r)}return e},merge$1=function(e,t,r,n){for(var i=t.length,a=r.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?n(t[o],r[s])<=0?t[o++]:r[s++]:o<i?t[o++]:r[s++];return e},arraySort$3=mergeSort$1,userAgent$b=engineUserAgent$1,firefox$1=userAgent$b.match(/firefox\/(\d+)/i),engineFfVersion$1=!!firefox$1&&+firefox$1[1],UA$1=engineUserAgent$1,engineIsIeOrEdge$1=/MSIE|Trident/.test(UA$1),userAgent$a=engineUserAgent$1,webkit$1=userAgent$a.match(/AppleWebKit\/(\d+)\./),engineWebkitVersion$1=!!webkit$1&&+webkit$1[1],$$1Z=_export$1,uncurryThis$1p=functionUncurryThis$1,aCallable$h=aCallable$p,toObject$u=toObject$D,lengthOfArrayLike$C=lengthOfArrayLike$K,deletePropertyOrThrow$7=deletePropertyOrThrow$9,toString$F=toString$O,fails$1o=fails$1Q,internalSort$3=arraySort$3,arrayMethodIsStrict$d=arrayMethodIsStrict$g,FF$4=engineFfVersion$1,IE_OR_EDGE$3=engineIsIeOrEdge$1,V8$3=engineV8Version$1,WEBKIT$3=engineWebkitVersion$1,test$3=[],nativeSort$3=uncurryThis$1p(test$3.sort),push$f=uncurryThis$1p(test$3.push),FAILS_ON_UNDEFINED$1=fails$1o((function(){test$3.sort(void 0)})),FAILS_ON_NULL$1=fails$1o((function(){test$3.sort(null)})),STRICT_METHOD$c=arrayMethodIsStrict$d("sort"),STABLE_SORT$3=!fails$1o((function(){if(V8$3)return V8$3<70;if(!(FF$4&&FF$4>3)){if(IE_OR_EDGE$3)return!0;if(WEBKIT$3)return WEBKIT$3<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)test$3.push({k:t+n,v:r})}for(test$3.sort((function(e,t){return t.v-e.v})),n=0;n<test$3.length;n++)t=test$3[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}})),FORCED$q=FAILS_ON_UNDEFINED$1||!FAILS_ON_NULL$1||!STRICT_METHOD$c||!STABLE_SORT$3,getSortCompare$3=function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:toString$F(t)>toString$F(r)?1:-1}};$$1Z({target:"Array",proto:!0,forced:FORCED$q},{sort:function(e){void 0!==e&&aCallable$h(e);var t=toObject$u(this);if(STABLE_SORT$3)return void 0===e?nativeSort$3(t):nativeSort$3(t,e);var r,n,i=[],a=lengthOfArrayLike$C(t);for(n=0;n<a;n++)n in t&&push$f(i,t[n]);for(internalSort$3(i,getSortCompare$3(e)),r=lengthOfArrayLike$C(i),n=0;n<r;)t[n]=i[n++];for(;n<a;)deletePropertyOrThrow$7(t,n++);return t}});var XG_DEBUG_OPEN="undefined"!=typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,STYLE={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},XGTAG="%c[xgplayer]",XG_DEBUG={config:{debug:XG_DEBUG_OPEN?3:1},logInfo:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.config.debug>=3&&(t=console).log.apply(t,[XGTAG,STYLE.info,e].concat(n))},logWarn:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];this.config.debug>=1&&(t=console).warn.apply(t,[XGTAG,STYLE.warn,e].concat(n))},logError:function(e){var t;if(!(this.config.debug<1)){for(var r=this.config.debug>=2?"trace":"error",n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];(t=console)[r].apply(t,[XGTAG,STYLE.error,e].concat(i))}}};function bindDebug(e){e.logInfo=XG_DEBUG.logInfo.bind(e),e.logWarn=XG_DEBUG.logWarn.bind(e),e.logError=XG_DEBUG.logError.bind(e)}var XgplayerTimeRange=function(){function e(t){_classCallCheck$i(this,e),this.bufferedList=t}return _createClass$j(e,[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}]),e}(),util$2={};function checkIsIn(e,t){for(var r=0,n=t.length;r<n;r++)if(e.indexOf(t[r])>-1)return!0;return!1}function isObject$G(e){var t=_typeof$a(e);return null!==e&&("object"===t||"function"===t)}function debounce$2(e,t,r){var n,i,a,o,s,l,u=0,c=!1,d=!1,h=!0,f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var r=n,a=i;return n=i=void 0,u=t,o=e.apply(a,r)}function y(e,t){return f?(window.cancelAnimationFrame(s),window.requestAnimationFrame(e)):setTimeout(e,t)}function m(e){return u=e,s=y(v,t),c?p(e):o}function g(e){var r=e-l;return void 0===l||r>=t||r<0||d&&e-u>=a}function v(){var e=Date.now();if(g(e))return b(e);s=y(v,function(e){var r=e-u,n=t-(e-l);return d?Math.min(n,a-r):n}(e))}function b(e){return s=void 0,h&&n?p(e):(n=i=void 0,o)}function _(){for(var e=Date.now(),r=g(e),a=arguments.length,u=new Array(a),c=0;c<a;c++)u[c]=arguments[c];if(n=u,i=this,l=e,r){if(void 0===s)return m(l);if(d)return s=y(v,t),p(l)}return void 0===s&&(s=y(v,t)),o}return t=+t||0,isObject$G(r)&&(c=!!r.leading,a=(d="maxWait"in r)?Math.max(+r.maxWait||0,t):a,h="trailing"in r?!!r.trailing:h),_.cancel=function(){void 0!==s&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(s),u=0,n=l=i=s=void 0},_.flush=function(){return void 0===s?o:b(Date.now())},_.pending=function(){return void 0!==s},_}function throttle(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return isObject$G(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),debounce$2(e,t,{leading:n,trailing:i,maxWait:t})}function getLang(){var e=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return"zh-cn"===e&&(e="zh"),e}util$2.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Object.keys(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e||"live-video"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i},util$2.createDomFromHtml=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var n=document.createElement("div");n.innerHTML=e;var i=n.children;return n=null,i.length>0?(i=i[0],r&&util$2.addClass(i,r),t&&Object.keys(t).forEach((function(e){i.setAttribute(e,t[e])})),i):null}catch(a){return XG_DEBUG.logError("util.createDomFromHtml",a),null}},util$2.hasClass=function(t,r){if(!t||!r)return!1;try{return Array.prototype.some.call(t.classList,(function(e){return e===r}))}catch(e){var n=t.className&&"object"===_typeof$a(t.className)?t.getAttribute("class"):t.className;return n&&!!n.match(new RegExp("(\\s|^)"+r+"(\\s|$)"))}},util$2.addClass=function(t,r){if(t&&r)try{r.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(e){e&&t.classList.add(e)}))}catch(e){util$2.hasClass(t,r)||(t.className&&"object"===_typeof$a(t.className)?t.setAttribute("class",t.getAttribute("class")+" "+r):t.className+=" "+r)}},util$2.removeClass=function(t,r){if(t&&r)try{r.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(e){e&&t.classList.remove(e)}))}catch(e){util$2.hasClass(t,r)&&r.split(/\s+/g).forEach((function(e){var r=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className&&"object"===_typeof$a(t.className)?t.setAttribute("class",t.getAttribute("class").replace(r," ")):t.className=t.className.replace(r," ")}))}},util$2.toggleClass=function(e,t){e&&t.split(/\s+/g).forEach((function(t){util$2.hasClass(e,t)?util$2.removeClass(e,t):util$2.addClass(e,t)}))},util$2.classNames=function(){for(var e=arguments,t=[],r=function(r){"String"===util$2.typeOf(e[r])?t.push(e[r]):"Object"===util$2.typeOf(e[r])&&Object.keys(e[r]).map((function(n){e[r][n]&&t.push(n)}))},n=0;n<arguments.length;n++)r(n);return t.join(" ")},util$2.findDom=function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,n=arguments.length>1?arguments[1]:void 0;try{t=r.querySelector(n)}catch(e){XG_DEBUG.logError("util.findDom",e),0===n.indexOf("#")&&(t=r.getElementById(n.slice(1)))}return t},util$2.getCss=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},util$2.padStart=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},util$2.format=function(e){if(window.isNaN(e))return"";e=Math.round(e);var t=util$2.padStart(Math.floor(e/3600),2,0),r=util$2.padStart(Math.floor((e-3600*t)/60),2,0),n=util$2.padStart(Math.floor(e-3600*t-60*r),2,0);return("00"===t?[r,n]:[t,r,n]).join(":")},util$2.event=function(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},util$2.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},util$2.deepCopy=function(e,t){if("Object"===util$2.typeOf(t)&&"Object"===util$2.typeOf(e))return Object.keys(t).forEach((function(r){"Object"!==util$2.typeOf(t[r])||t[r]instanceof Node?"Array"===util$2.typeOf(t[r])?e[r]="Array"===util$2.typeOf(e[r])?e[r].concat(t[r]):t[r]:e[r]=t[r]:void 0===e[r]||void 0===e[r]?e[r]=t[r]:util$2.deepCopy(e[r],t[r])})),e},util$2.deepMerge=function(e,t){return Object.keys(t).map((function(r){var n;"Array"===util$2.typeOf(t[r])&&"Array"===util$2.typeOf(e[r])?"Array"===util$2.typeOf(e[r])&&(n=e[r]).push.apply(n,_toConsumableArray$9(t[r])):util$2.typeOf(e[r])!==util$2.typeOf(t[r])||null===e[r]||"Object"!==util$2.typeOf(e[r])||t[r]instanceof window.Node?null!==t[r]&&(e[r]=t[r]):util$2.deepMerge(e[r],t[r])})),e},util$2.getBgImage=function(e){var t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";var r=document.createElement("a");return r.href=t.replace(/url\("|"\)/g,""),r.href},util$2.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},util$2.setInterval=function(e,t,r,n){e._interval[t]||(e._interval[t]=window.setInterval(r.bind(e),n))},util$2.clearInterval=function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},util$2.setTimeout=function(e,t,r){e._timers||(e._timers=[]);var n=setTimeout((function(){t(),util$2.clearTimeout(e,n)}),r);return e._timers.push(n),n},util$2.clearTimeout=function(e,t){var r=e._timers;if("Array"===util$2.typeOf(r)){for(var n=0;n<r.length;n++)if(r[n]===t){r.splice(n,1),clearTimeout(t);break}}else clearTimeout(t)},util$2.clearAllTimers=function(e){var t=e._timers;"Array"===util$2.typeOf(t)&&(t.map((function(e){clearTimeout(e)})),e._timerIds=[])},util$2.createImgBtn=function(e,t,r,n){var i,a,o,s=util$2.createDom("xg-".concat(e),"",{},"xgplayer-".concat(e,"-img"));(s.style.backgroundImage='url("'.concat(t,'")'),r&&n)&&(["px","rem","em","pt","dp","vw","vh","vm","%"].every((function(e){return!(r.indexOf(e)>-1&&n.indexOf(e)>-1)||(i=parseFloat(r.slice(0,r.indexOf(e)).trim()),a=parseFloat(n.slice(0,n.indexOf(e)).trim()),o=e,!1)})),s.style.width="".concat(i).concat(o),s.style.height="".concat(a).concat(o),s.style.backgroundSize="".concat(i).concat(o," ").concat(a).concat(o),s.style.margin="start"===e?"-".concat(a/2).concat(o," auto auto -").concat(i/2).concat(o):"auto 5px auto 5px");return s},util$2.Hex2RGBA=function(e,t){var r=[];if(/^\#[0-9A-F]{3}$/i.test(e)){var n="#";e.replace(/[0-9A-F]/gi,(function(e){n+=e+e})),e=n}return/^#[0-9A-F]{6}$/i.test(e)?(e.replace(/[0-9A-F]{2}/gi,(function(e){r.push(parseInt(e,16))})),"rgba(".concat(r.join(","),", ").concat(t,")")):"rgba(255, 255, 255, 0.1)"},util$2.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},util$2.checkIsFunction=function(e){return e&&"function"==typeof e},util$2.checkIsObject=function(e){return null!==e&&"object"===_typeof$a(e)},util$2.hide=function(e){e.style.display="none"},util$2.show=function(e,t){e.style.display=t||"block"},util$2.isUndefined=function(e){if(null==e)return!0},util$2.setStyleFromCsstext=function(e,t){t&&("String"===util$2.typeOf(t)?t.replace(/\s+/g,"").split(";").map((function(t){if(t){var r=t.split(":");r.length>1&&(e.style[r[0]]=r[1])}})):Object.keys(t).map((function(r){e.style[r]=t[r]})))},util$2.filterStyleFromText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],r=e.style.cssText;if(!r)return{};var n=r.replace(/\s+/g,"").split(";"),i={},a={};return n.map((function(e){if(e){var r=e.split(":");r.length>1&&(checkIsIn(r[0],t)?i[r[0]]=r[1]:a[r[0]]=r[1])}})),e.setAttribute("style",""),Object.keys(a).map((function(t){e.style[t]=a[t]})),i},util$2.getStyleFromCsstext=function(e){var t=e.style.cssText;if(!t)return{};var r=t.replace(/\s+/g,"").split(";"),n={};return r.map((function(e){if(e){var t=e.split(":");t.length>1&&(n[t[0]]=t[1])}})),n},util$2.preloadImg=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){var n=new window.Image;n.onload=function(e){n=null,t&&t(e)},n.onerror=function(e){n=null,r&&r(e)},n.src=e}},util$2.stopPropagation=function(e){e&&(e.stopPropagation(),e.cancelable&&e.preventDefault())},util$2.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},util$2.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},util$2.checkTouchSupport=function(){return"ontouchstart"in window},util$2.getBuffered2=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=[],n=0;n<e.length;n++)r.push({start:e.start(n)<.5?0:e.start(n),end:e.end(n)});r.sort((function(e,t){var r=e.start-t.start;return r||t.end-e.end}));var i=[];if(t)for(var a=0;a<r.length;a++){var o=i.length;if(o){var s=i[o-1].end;r[a].start-s<t?r[a].end>s&&(i[o-1].end=r[a].end):i.push(r[a])}else i.push(r[a])}else i=r;return new XgplayerTimeRange(i)},util$2.getEventPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{x:e.x/t,y:e.y/t,clientX:e.clientX/t,clientY:e.clientY/t,offsetX:e.offsetX/t,offsetY:e.offsetY/t,pageX:e.pageX/t,pageY:e.pageY/t}},util$2.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t(e)},util$2.getHostFromUrl=function(e){if("String"!==util$2.typeOf(e))return"";var t=e.split("/"),r="";return t.length>3&&t[2]&&(r=t[2]),r},util$2.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;t&&t(e)},util$2.isMSE=function(e){return!!(e&&e instanceof HTMLMediaElement)&&(/^blob/.test(e.currentSrc)||/^blob/.test(e.src))},util$2.generateSessionId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=(new Date).getTime();try{t=parseInt(t)}catch(e){t=0}r+=t,window.performance&&"function"==typeof window.performance.now&&(r+=parseInt(window.performance.now()));var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===e?t:3&t|8).toString(16)}));return n};var VERSION_REG={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},H264_MIMETYPES=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],sniffer$1={get device(){return sniffer$1.os.isPc?"pc":"mobile"},get browser(){if("undefined"==typeof navigator)return"";var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(r){return t[r].test(e)})))[0]},get os(){if("undefined"==typeof navigator)return{};var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),r=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a,s=!(o||n||r||a),l=/(?:iPad|PlayBook)/.test(e);return{isTablet:a,isPhone:o,isIpad:l,isIos:o||l,isAndroid:n,isPc:s,isSymbian:r,isWindowsPhone:t,isFireFox:i}},get osVersion(){var e=navigator.userAgent,t="",r=(t=/(?:iPhone)|(?:iPad|PlayBook)/.test(e)?VERSION_REG.ios:VERSION_REG.android)?t.exec(e):[];if(r&&r.length>=3){var n=r[2].split(".");return n.length>0?parseInt(n[0]):0}return 0},get isWeixin(){if("undefined"==typeof navigator)return!1;return!!/(micromessenger)\/([\d.]+)/.exec(navigator.userAgent.toLocaleLowerCase())},isSupportMP4:function(){if(this.supportResult)return this.supportResult;var e=document.createElement("video"),t={isSupport:!1,mime:""};return"function"==typeof e.canPlayType&&H264_MIMETYPES.map((function(r){"probably"===e.canPlayType('video/mp4; codecs="'.concat(r,'"'))&&(t.isSupport=!0,t.mime+="||".concat(r))})),this.supportResult=t,e=null,t},isHevcSupported:function(){return MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')},probeConfigSupported:function(t){var r={supported:!1,smooth:!1,powerEfficient:!1};if(!t)return Promise.resolve(r);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(t);var n=t.video||{},i=t.audio||{};try{var a=MediaSource.isTypeSupported(n.contentType),o=MediaSource.isTypeSupported(i.contentType);return Promise.resolve({supported:a&&o,smooth:!1,powerEfficient:!1})}catch(e){return Promise.resolve(r)}}},version$5="3.0.0-next.38-0",ERROR_TYPE_MAP={1:"network",2:"network",3:"decoder",4:"format"},Errors$1=_createClass$j((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};_classCallCheck$i(this,e);var n=t&&t.i18n?t.i18n.ERROR_TYPES:null;if(t.video){var i=r.mediaError?r.mediaError:t.video.error||{},a=t.duration,o=t.currentTime,s=t.ended,l=t.src,u=t.currentSrc,c=t.video,d=c.readyState,h=c.networkState,f={playerVersion:version$5,currentTime:o,duration:a,ended:s,readyState:d,networkState:h,src:l||u,errorType:r.errorType,errorCode:r.errorCode||i.code,message:r.errorMessage||i.message,mediaError:i,originError:r.originError?r.originError.stack:"",host:util$2.getHostFromUrl(l||u)};return r.ext&&Object.keys(r.ext).map((function(e){f[e]=r.ext[e]})),f}if(arguments.length>1){for(var p={playerVersion:version$5,domain:document.domain},y=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],m=0;m<arguments.length;m++)p[y[m]]=arguments[m];return p.ex=n?(n[arguments[0]]||{}).msg:"",p}})),PLAY="play",PLAYING="playing",ENDED="ended",PAUSE="pause",ERROR$3="error",SEEKING="seeking",SEEKED="seeked",TIME_UPDATE="timeupdate",WAITING="waiting",CANPLAY="canplay",CANPLAY_THROUGH="canplaythrough",DURATION_CHANGE="durationchange",VOLUME_CHANGE="volumechange",LOADED_DATA="loadeddata",RATE_CHANGE="ratechange",PROGRESS="progress",LOAD_START="loadstart",EMPTIED="emptied",STALLED="stalled",SUSPEND="suspend",ABORT="abort",BUFFER_CHANGE="bufferedChange",PLAYER_FOCUS="focus",PLAYER_BLUR="blur",READY="ready",URL_NULL="urlNull",AUTOPLAY_STARTED="autoplay_started",AUTOPLAY_PREVENTED="autoplay_was_prevented",COMPLETE="complete",REPLAY="replay",DESTROY="destroy",URL_CHANGE="urlchange",DOWNLOAD_SPEED_CHANGE="download_speed_change",FULLSCREEN_CHANGE="fullscreen_change",CSS_FULLSCREEN_CHANGE="cssFullscreen_change",MINI_STATE_CHANGE="mini_state_change",DEFINITION_CHANGE="definition_change",BEFORE_DEFINITION_CHANGE="before_definition_change",AFTER_DEFINITION_CHANGE="after_definition_change",SEI_PARSED="SEI_PARSED",RETRY="retry",VIDEO_RESIZE="video_resize",PIP_CHANGE="pip_change",ROTATE="rotate",SCREEN_SHOT="screenShot",PLAYNEXT="playnext",SHORTCUT="shortcut",XGLOG="xglog",USER_ACTION="user_action",USER_ACTION1="user_action1",RESET="reset",VIDEO_EVENTS$1=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],STATS_EVENTS$2={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},Events$1=Object.freeze(Object.defineProperty({__proto__:null,ABORT:ABORT,AFTER_DEFINITION_CHANGE:AFTER_DEFINITION_CHANGE,AUTOPLAY_PREVENTED:AUTOPLAY_PREVENTED,AUTOPLAY_STARTED:AUTOPLAY_STARTED,BEFORE_DEFINITION_CHANGE:BEFORE_DEFINITION_CHANGE,BUFFER_CHANGE:BUFFER_CHANGE,CANPLAY:CANPLAY,CANPLAY_THROUGH:CANPLAY_THROUGH,COMPLETE:COMPLETE,CSS_FULLSCREEN_CHANGE:CSS_FULLSCREEN_CHANGE,DEFINITION_CHANGE:DEFINITION_CHANGE,DESTROY:DESTROY,DOWNLOAD_SPEED_CHANGE:DOWNLOAD_SPEED_CHANGE,DURATION_CHANGE:DURATION_CHANGE,EMPTIED:EMPTIED,ENDED:ENDED,ERROR:ERROR$3,FULLSCREEN_CHANGE:FULLSCREEN_CHANGE,LOADED_DATA:LOADED_DATA,LOAD_START:LOAD_START,MINI_STATE_CHANGE:MINI_STATE_CHANGE,PAUSE:PAUSE,PIP_CHANGE:PIP_CHANGE,PLAY:PLAY,PLAYER_BLUR:PLAYER_BLUR,PLAYER_FOCUS:PLAYER_FOCUS,PLAYING:PLAYING,PLAYNEXT:PLAYNEXT,PROGRESS:PROGRESS,RATE_CHANGE:RATE_CHANGE,READY:READY,REPLAY:REPLAY,RESET:RESET,RETRY:RETRY,ROTATE:ROTATE,SCREEN_SHOT:SCREEN_SHOT,SEEKED:SEEKED,SEEKING:SEEKING,SEI_PARSED:SEI_PARSED,SHORTCUT:SHORTCUT,STALLED:STALLED,STATS_EVENTS:STATS_EVENTS$2,SUSPEND:SUSPEND,TIME_UPDATE:TIME_UPDATE,URL_CHANGE:URL_CHANGE,URL_NULL:URL_NULL,USER_ACTION:USER_ACTION,USER_ACTION1:USER_ACTION1,VIDEO_EVENTS:VIDEO_EVENTS$1,VIDEO_RESIZE:VIDEO_RESIZE,VOLUME_CHANGE:VOLUME_CHANGE,WAITING:WAITING,XGLOG:XGLOG},Symbol.toStringTag,{value:"Module"}));function emitVideoEvent(e,t){this&&this.emit&&("error"===e?this.errorHandler(e):this.emit(e,t))}function getVideoEventHandler(e,t){return function(r){var n={player:t,eventName:e,originalEvent:r,detail:r.detail||{},timeStamp:r.timeStamp,currentTime:t.currentTime,duration:t.duration,paused:t.paused,ended:t.ended,isInternalOp:!!t._internalOp[r.type],muted:t.muted,volume:t.volume,host:util$2.getHostFromUrl(t.currentSrc),vtype:t.vtype};if(t.removeInnerOP(r.type),"timeupdate"===e&&(t._currentTime=t.video&&t.video.currentTime),"durationchange"===e&&(t._duration=t.video.duration),"volumechange"===e&&(n.isMutedChange=t._lastMuted!==t.muted,t._lastMuted=t.muted),t.videoEventMiddleware[e])try{t.videoEventMiddleware[e].call(t,n,emitVideoEvent.bind(t))}catch(i){throw emitVideoEvent.call(t,e,n),i}else emitVideoEvent.call(t,e,n)}}var VideoProxy=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;_classCallCheck$i(this,r),(n=t.call(this,e))._hasStart=!1,n._currentTime=0,n._duration=0,n._internalOp={},n._lastMuted=!1,n.vtype="MP4",n.videoConfig=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:2,mediaType:e.mediaType||"video"},e.videoConfig,e.videoAttributes);var i=e["x5-video-player-type"]||e.x5VideoPlayerType;return sniffer$1.isWeixin&&sniffer$1.os.isAndroid&&i&&(n.videoConfig["x5-video-player-type"]=i,delete n.videoConfig.playsinline,delete n.videoConfig["webkit-playsinline"],delete n.videoConfig["x5-playsinline"]),e.loop&&(n.videoConfig.loop="loop"),n.video=util$2.createDom(n.videoConfig.mediaType,"",n.videoConfig,""),e.defaultPlaybackRate&&(n.video.defaultPlaybackRate=n.video.playbackRate=e.defaultPlaybackRate),"Number"===util$2.typeOf(e.volume)&&(n.volume=e.volume),e.autoplayMuted&&(n.video.muted=!0,n._lastMuted=!0),e.autoplay&&(n.video.autoplay=!0),n._interval={},n.videoEventMiddleware={},n.attachVideoEvents(),n}return _createClass$j(r,[{key:"setEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(r){t.videoEventMiddleware[r]=e[r]}))}},{key:"removeEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(e){delete t.videoEventMiddleware[e]}))}},{key:"attachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.video;this._evHandlers||(this._evHandlers=VIDEO_EVENTS$1.map((function(t){var r="on".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));return"function"==typeof e[r]&&e.on(t,e[r]),_defineProperty$i({},t,getVideoEventHandler(t,e))}))),this._evHandlers.forEach((function(e){var r=Object.keys(e)[0];t.addEventListener(r,e[r],!1)}))}},{key:"detachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.video;this._evHandlers.forEach((function(e){var r=Object.keys(e)[0];t.removeEventListener(r,e[r],!1)})),this._evHandlers.forEach((function(t){var r=Object.keys(t)[0],n="on".concat(r.charAt(0).toUpperCase()).concat(r.slice(1));"function"==typeof e[n]&&e.off(r,e[n])})),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,t){var r=this;e.removeAttribute("src"),t.forEach((function(e){r.video.appendChild(util$2.createDom("source","",{src:"".concat(e.src),type:"".concat(e.type||"")}))}));var n=e.children;if(n){this._videoSourceCount=n.length,!this._sourceError&&(this._sourceError=function(e){r._videoSourceCount--,0===r._videoSourceCount&&(r.videoEventMiddleware.error?r.videoEventMiddleware.error.call(r,e,(function(){r.errorHandler("error")})):r.errorHandler("error",{code:4,message:"sources load error"}))});for(var i=0;i<n.length;i++)n[i].addEventListener("error",this._sourceError)}}},{key:"_detachSourceEvents",value:function(e){var t=e.children;if(t&&0!==t.length&&this._sourceError){for(var r=0;r<t.length;r++)t[r].removeEventListener("error",this._sourceError);for(;t.length>0;)e.removeChild(t[0])}}},{key:"errorHandler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.video&&(this.video.error||t)){var r=this.video.error||t,n=r.code?ERROR_TYPE_MAP[r.code]:"other";r.message;this.video.currentSrc||(r={code:6,message:"empty_src"}),this.emit(e,new Errors$1(this,{errorType:n,errorCode:r.code,errorMessage:r.message||"",mediaError:r}))}}},{key:"destroy",value:function(){for(var e in this.video&&(this.video.pause&&(this.video.pause(),this.video.muted=!0),this.video.removeAttribute("src"),this.video.load()),this._currentTime=0,this._duration=0,this.videoConfig=null,this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.video=null,this.videoEventMiddleware={},this.removeAllListeners()}},{key:"play",value:function(){return this.video?this.video.play():null}},{key:"pause",value:function(){this.video&&this.video.pause()}},{key:"canPlayType",value:function(e){return!!this.video&&this.video.canPlayType(e)}},{key:"getBufferedRange",value:function(e){var t=[0,0];if(!this.video)return t;e||(e=this.video.buffered);var r=this.video.currentTime;if(e)for(var n=0,i=e.length;n<i&&(t[0]=e.start(n),t[1]=e.end(n),!(t[0]<=r&&r<=t[1]));n++);return t[0]-r<=0&&r-t[1]<=0?t:[0,0]}},{key:"autoplay",get:function(){return!!this.video&&this.video.autoplay},set:function(e){this.video&&(this.video.autoplay=e)}},{key:"buffered",get:function(){return this.video?this.video.buffered:null}},{key:"buffered2",get:function(){return this.video?util$2.getBuffered2(this.video.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.video)return e;var t=this.video.buffered;if(!t||0===t.length)return e;for(var r=0;r<t.length;r++)if((t.start(r)<=this.currentTime||t.start(r)<.1)&&t.end(r)>=this.currentTime)return{start:t.start(r),end:t.end(r)};return e}},{key:"crossOrigin",get:function(){return this.video?this.video.crossOrigin:""},set:function(e){this.video&&(this.video.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.video?this.video.currentSrc:""},set:function(e){this.video&&(this.video.currentSrc=e)}},{key:"currentTime",get:function(){return this.video?void 0!==this.video.currentTime?this.video.currentTime:this._currentTime:0},set:function(e){this.video&&(this.video.currentTime=e)}},{key:"defaultMuted",get:function(){return!!this.video&&this.video.defaultMuted},set:function(e){this.video&&(this.video.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return!!this.video&&this.video.ended}},{key:"error",get:function(){return this.video.error}},{key:"errorNote",get:function(){if(!this.video.error)return"";return["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"][this.video.error.code-1]}},{key:"loop",get:function(){return!!this.video&&this.video.loop},set:function(e){this.video&&(this.video.loop=e)}},{key:"muted",get:function(){return!!this.video&&this.video.muted},set:function(e){this.video&&this.video.muted!==e&&(this._lastMuted=this.video.muted,this.video.muted=e)}},{key:"networkState",get:function(){return this.video.networkState}},{key:"paused",get:function(){return!this.video||this.video.paused}},{key:"playbackRate",get:function(){return this.video?this.video.playbackRate:0},set:function(e){this.video&&e!==1/0&&(this.video.playbackRate=e)}},{key:"played",get:function(){return this.video?this.video.played:null}},{key:"preload",get:function(){return!!this.video&&this.video.preload},set:function(e){this.video&&(this.video.preload=e)}},{key:"readyState",get:function(){return this.video.readyState}},{key:"seekable",get:function(){return!!this.video&&this.video.seekable}},{key:"seeking",get:function(){return!!this.video&&this.video.seeking}},{key:"src",get:function(){return this.video?this.video.src:""},set:function(e){this.video&&(this.emit(URL_CHANGE,e),this.emit(WAITING),this._currentTime=0,this._duration=0,/^blob/.test(this.video.currentSrc)||/^blob/.test(this.video.src)?this.onWaiting():(this._detachSourceEvents(this.video),"Array"===util$2.typeOf(e)?this._attachSourceEvents(this.video,e):this.video.src=e,this.load()))}},{key:"volume",get:function(){return this.video?this.video.volume:0},set:function(e){e!==1/0&&this.video&&(this.video.volume=e)}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$3(_getPrototypeOf$f(r.prototype),"emit",this)).call.apply(n,[this,e,t].concat(a))}},{key:"on",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$3(_getPrototypeOf$f(r.prototype),"on",this)).call.apply(n,[this,e,t].concat(a))}},{key:"once",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$3(_getPrototypeOf$f(r.prototype),"once",this)).call.apply(n,[this,e,t].concat(a))}},{key:"off",value:function(e,t){for(var n,i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];(n=_get$3(_getPrototypeOf$f(r.prototype),"off",this)).call.apply(n,[this,e,t].concat(a))}},{key:"offAll",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"removeAllListeners",this).call(this)}}]),r}(EventEmitter$1),INDEXDB=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};_classCallCheck$i(this,e),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=t}return _createClass$j(e,[{key:"openDB",value:function(e){var t=this,r=this,n=this.myDB.version||1,i=r.indexedDB.open(r.myDB.name,n);i.onerror=function(e){},i.onsuccess=function(n){t.myDB.db=n.target.result,e.call(r)},i.onupgradeneeded=function(e){var t=e.target.result;e.target.transaction,t.objectStoreNames.contains(r.myDB.ojstore.name)||t.createObjectStore(r.myDB.ojstore.name,{keyPath:r.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){this.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(e,t){for(var r,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),i=0;i<t.length;i++)(r=n.add(t[i])).onerror=function(){},r.onsuccess=function(){}}},{key:"putData",value:function(e,t){for(var r,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),i=0;i<t.length;i++)(r=n.put(t[i])).onerror=function(){},r.onsuccess=function(){}}},{key:"getDataByKey",value:function(e,t,r){var n=this,i=this.myDB.db.transaction(e,"readwrite").objectStore(e).get(t);i.onerror=function(){r.call(n,null)},i.onsuccess=function(e){var t=e.target.result;r.call(n,t)}}},{key:"deleteData",value:function(e,t){this.myDB.db.transaction(e,"readwrite").objectStore(e).delete(t)}},{key:"clearData",value:function(e){this.myDB.db.transaction(e,"readwrite").objectStore(e).clear()}}]),e}(),FULLSCREEN_EVENTS=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],GET_FULLSCREEN_API=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],EXIT_FULLSCREEN_API=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"];function callHandler(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];var o=t.call.apply(t,[e].concat(i));r&&"function"==typeof r&&(o&&o.then?o.then((function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.call.apply(r,[e].concat(n))})):r.call.apply(r,[e].concat(i)))}function hook(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[t]&&(this.__hooks[t]=null),function(){var i=arguments,a=this;if(n.pre)try{var o;(o=n.pre).call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}catch(e){throw e.message="[pluginName: ".concat(this.pluginName,":").concat(t,":pre error] >> ").concat(e.message),e}if(this.__hooks&&this.__hooks[t])try{var s,l=(s=this.__hooks[t]).call.apply(s,[this,this].concat(Array.prototype.slice.call(arguments)));l?l.then?l.then((function(e){!1!==e&&callHandler.apply(void 0,[a,r,n.next].concat(_toConsumableArray$9(i)))})).catch((function(e){throw e})):callHandler.apply(void 0,[this,r,n.next].concat(Array.prototype.slice.call(arguments))):void 0===l&&callHandler.apply(void 0,[this,r,n.next].concat(Array.prototype.slice.call(arguments)))}catch(e){throw e.message="[pluginName: ".concat(this.pluginName,":").concat(t,"] >> ").concat(e.message),e}else callHandler.apply(void 0,[this,r,n.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function useHooks(e,t){var r=this.__hooks;if(r)return r.hasOwnProperty(e)?(r&&(r[e]=t),!0):(console.warn("has no supported hook which name [".concat(e,"]")),!1)}function removeHooks(e,t){var r=this.__hooks;r&&delete r[e]}function usePluginHooks(e){if(this.plugins&&this.plugins[e.toLowerCase()]){for(var t=this.plugins[e.toLowerCase()],r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return t.useHooks&&t.useHooks.apply(t,n)}}function removePluginHooks(e){if(this.plugins&&this.plugins[e.toLowerCase()]){var t=this.plugins[e.toLowerCase()];if(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return t.removeHooks&&t.removeHooks.apply(t,n)}}}function hooksDescriptor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.__hooks={},t&&t.map((function(t){e.__hooks[t]=null})),Object.defineProperty(e,"hooks",{get:function(){return e.__hooks&&Object.keys(e.__hooks).map((function(t){if(e.__hooks[t])return t}))}})}function delHooksDescriptor(e){e.__hooks=null}function runHooks(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];if(!e.__hooks||!e.__hooks[t])return r.call.apply(r,[e,e].concat(i));var o,s=(o=e.__hooks[t]).call.apply(o,[e,e].concat(i));if(s&&s.then)s.then((function(t){return!1===t?null:r.call.apply(r,[e,e].concat(i))})).catch((function(e){console.warn("[runHooks]".concat(t," reject"),e.message)}));else if(!1!==s)return r.call.apply(r,[e,e].concat(i))}function showErrorMsg(e,t){XG_DEBUG.logError("[".concat(e,"] event or callback cant be undefined or null when call ").concat(t))}var BasePlugin=function(){function e(t){_classCallCheck$i(this,e),util$2.checkIsFunction(this.beforeCreate)&&this.beforeCreate(t),hooksDescriptor(this),this.__args=t,this.__events={},this.config=t.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(t)}return _createClass$j(e,[{key:"beforeCreate",value:function(e){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(e){this.player=e.player,this.playerConfig=e.player&&e.player.config,this.pluginName=e.pluginName?e.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=e.player&&e.player.logger}},{key:"updateLang",value:function(e){e||(e=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var e=util$2.checkTouchSupport()?"touch":"mouse";return!this.playerConfig||"touch"!==this.playerConfig.domEventType&&"mouse"!==this.playerConfig.domEventType||(e=this.playerConfig.domEventType),e}},{key:"on",value:function(e,t){var r=this;e&&t&&this.player?"string"==typeof e?(this.__events[e]=t,this.player.on(e,t)):Array.isArray(e)&&e.forEach((function(e){r.__events[e]=t,r.player.on(e,t)})):showErrorMsg(this.pluginName,"plugin.on(event, callback)")}},{key:"once",value:function(e,t){e&&t&&this.player?this.player.once(e,t):showErrorMsg(this.pluginName,"plugin.once(event, callback)")}},{key:"off",value:function(e,t){var r=this;e&&t&&this.player?"string"==typeof e?(delete this.__events[e],this.player.off(e,t)):Array.isArray(e)&&e.forEach((function(n){delete r.__events[e],r.player.off(n,t)})):showErrorMsg(this.pluginName,"plugin.off(event, callback)")}},{key:"offAll",value:function(){var e=this;Object.keys(this.__events).map((function(t){e.__events[t]&&e.off(t,e.__events[t]),t&&delete e.__events[t]})),this.__events={}}},{key:"emit",value:function(e){var t;if(this.player){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(t=this.player).emit.apply(t,[e].concat(n))}}},{key:"emitUserAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.player){var n=_objectSpread2$b(_objectSpread2$b({},r),{},{pluginName:this.pluginName});this.player.emitUserAction(e,t,n)}}},{key:"hook",value:function(e,t){return hook.call.apply(hook,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return useHooks.call.apply(useHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return removeHooks.call.apply(removeHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.player)return r&&(t.pluginName=r),this.player.registerPlugin({plugin:e,options:t})}},{key:"getPlugin",value:function(e){return this.player?this.player.getPlugin(e):null}},{key:"__destroy",value:function(){var e=this,t=this.player,r=this.pluginName;this.offAll(),util$2.clearAllTimers(this),util$2.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((function(t){e[t]=null})),t.unRegisterPlugin(r),delHooksDescriptor(this)}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&Object.defineProperty(e,r,t[r])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),e}(),DOCUMENT_NODE_TYPE=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var proto=Element.prototype;proto.matches=proto.matchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector||proto.webkitMatchesSelector}function closest$2(e,t){for(;e&&e.nodeType!==DOCUMENT_NODE_TYPE;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}var closest_1=closest$2,closest$1=closest_1;function _delegate(e,t,r,n,i){var a=listener$1.apply(this,arguments);return e.addEventListener(r,a,i),{destroy:function(){e.removeEventListener(r,a,i)}}}function delegate(e,t,r,n,i){return"function"==typeof e.addEventListener?_delegate.apply(null,arguments):"function"==typeof r?_delegate.bind(null,document).apply(null,arguments):("string"==typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return _delegate(e,t,r,n,i)})))}function listener$1(e,t,r,n){return function(r){r.delegateTarget=closest$1(r.target,t),r.delegateTarget&&n.call(e,r)}}var delegate_1=delegate,ROOT_TYPES={CONTROLS:"controls",ROOT:"root"},POSITIONS$a={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"};function isUrl(e){return!!e&&(e.indexOf&&/^(?:http|data:|\/)/.test(e))}function mergeIconClass(e,t){return"object"===_typeof$a(e)&&e.class&&"string"==typeof e.class?"".concat(t," ").concat(e.class):t}function mergeIconAttr(e,t){return"object"===_typeof$a(e)&&e.attr&&"object"===_typeof$a(e.attr)&&Object.keys(e.attr).map((function(r){t[r]=e.attr[r]})),t}function createIcon(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=null;if(t instanceof window.Element)return util$2.addClass(t,n),Object.keys(i).map((function(e){t.setAttribute(e,i[e])})),t;if(isUrl(t)||isUrl(t.url))return i.src=isUrl(t)?t:t.url||"",o=util$2.createDom(t.tag||"img","",i,"xg-img ".concat(n));if("function"==typeof t)try{return(o=t())instanceof window.Element?(util$2.addClass(o,n),Object.keys(i).map((function(e){o.setAttribute(e,i[e])})),o):(XG_DEBUG.logWarn("warn>>icons.".concat(r," in config of plugin named [").concat(a,"] is a function mast return an Element Object")),null)}catch(e){return XG_DEBUG.logError("Plugin named [".concat(a,"]:createIcon"),e),null}return"string"==typeof t?util$2.createDomFromHtml(t,i,n):(XG_DEBUG.logWarn("warn>>icons.".concat(r," in config of plugin named [").concat(a,"] is invalid")),null)}function registerIconsObj(e,t){var r=t.config.icons||t.playerConfig.icons;Object.keys(e).map((function(n){var i=e[n],a=i&&i.class?i.class:"",o=i&&i.attr?i.attr:{},s=null;r&&r[n]&&(a=mergeIconClass(r[n],a),o=mergeIconAttr(r[n],o),s=createIcon(r[n],n,a,o,t.pluginName)),!s&&i&&(s=createIcon(i.icon?i.icon:i,o,a,{},t.pluginName)),t.icons[n]=s}))}function registerTextObj(e,t){Object.keys(e).map((function(r){Object.defineProperty(t.langText,r,{get:function(){var n=t.lang,i=t.i18n;return i[r]?i[r]:e[r]&&e[r][n]||""}})}))}var Plugin=function(t){_inherits$f(n,t);var r=_createSuper$i(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck$i(this,n),(e=r.call(this,t)).__delegates=[],e}return _createClass$j(n,[{key:"__init",value:function(t){if(_get$3(_getPrototypeOf$f(n.prototype),"__init",this).call(this,t),t.root){var r=t.root,i=null;this.icons={},this.root=null,this.parent=null,registerIconsObj(this.registerIcons()||{},this),this.langText={},registerTextObj(this.registerLanguageTexts()||{},this);var a="";try{a=this.render()}catch(e){throw XG_DEBUG.logError("Plugin:".concat(this.pluginName,":render"),e),new Error("Plugin:".concat(this.pluginName,":render:").concat(e.message))}if(a)(i=n.insert(a,r,t.index)).setAttribute("data-index",t.index);else{if(!t.tag)return;(i=util$2.createDom(t.tag,"",t.attr,t.name)).setAttribute("data-index",t.index),r.appendChild(i)}this.root=i,this.parent=r;var o=this.config.attr||{},s=this.config.style||{};this.setAttr(o),this.setStyle(s),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var t=this.children();t&&"object"===_typeof$a(t)&&Object.keys(t).length>0&&Object.keys(t).map((function(r){var n,i,a=r,o=t[a],s={root:e.root};"function"==typeof o?(n=e.config[a]||{},i=o):"object"===_typeof$a(o)&&"function"==typeof o.plugin&&(n=o.options?util$2.deepCopy(e.config[a]||{},o.options):e.config[a]||{},i=o.plugin),s.config=n,void 0!==n.index&&(s.index=n.index),n.root&&(s.root=n.root),e.registerPlugin(i,s,a)}))}}},{key:"updateLang",value:function(e){e||(e=this.lang);var t=this.root,r=this.i18n,n=this.langText;t&&function e(t,r){for(var n=0;n<t.children.length;n++)t.children[n].children.length>0?e(t.children[n],r):r(t.children[n])}(t,(function(t){var i=t.getAttribute&&t.getAttribute("lang-key");if(i){var a=r[i.toUpperCase()]||n[i];a&&(t.innerHTML="function"==typeof a?a(e):a)}}))}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this.i18n||{},n=this.langText;e.setAttribute&&e.setAttribute("lang-key",t);var i=r[t]||n[t]||"";i&&(e.innerHTML=i)}},{key:"plugins",value:function(){return this._children}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.root=t.root||this.root;var i=_get$3(_getPrototypeOf$f(n.prototype),"registerPlugin",this).call(this,e,t,r);return this._children.push(i),i}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,t,r){var i=this;if(arguments.length<3&&"function"==typeof t)Array.isArray(e)?e.forEach((function(e){i.bindEL(e,t)})):this.bindEL(e,t);else{var a=n.delegate.call(this,this.root,e,t,r);this.__delegates=this.__delegates.concat(a)}}},{key:"unbind",value:function(e,t){var r=this;if(arguments.length<3&&"function"==typeof t)Array.isArray(e)?e.forEach((function(e){r.unbindEL(e,t)})):this.unbindEL(e,t);else for(var n="".concat(e,"_").concat(t),i=0;i<this.__delegates.length;i++)if(this.__delegates[i].key===n){this.__delegates[i].destroy(),this.__delegates.splice(i,1);break}}},{key:"setStyle",value:function(e,t){var r=this;if(this.root)return"String"===util$2.typeOf(e)?this.root.style[e]=t:void("Object"===util$2.typeOf(e)&&Object.keys(e).map((function(t){r.root.style[t]=e[t]})))}},{key:"setAttr",value:function(e,t){var r=this;if(this.root)return"String"===util$2.typeOf(e)?this.root.setAttribute(e,t):void("Object"===util$2.typeOf(e)&&Object.keys(e).map((function(t){r.root.setAttribute(t,e[t])})))}},{key:"setHtml",value:function(e,t){this.root&&(this.root.innerHTML=e,"function"==typeof t&&t())}},{key:"bindEL",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.addEventListener(e,t,r)}},{key:"unbindEL",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.removeEventListener(e,t,r)}},{key:"show",value:function(e){if(this.root)return this.root.style.display=void 0!==e?e:"block","none"===window.getComputedStyle(this.root,null).getPropertyValue("display")?this.root.style.display="block":void 0}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,t){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!(t&&t instanceof window.Element))return null;try{return"string"==typeof e?this.find(e).appendChild(t):e.appendChild(t)}catch(r){return XG_DEBUG.logError("Plugin:appendChild",r),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,t=this.player;this.__delegates.map((function(e){e.destroy()})),this.__delegates=[],this._children instanceof Array&&(this._children.map((function(e){t.unRegisterPlugin(e.pluginName)})),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),_get$3(_getPrototypeOf$f(n.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map((function(t){e[t]=null}))}}],[{key:"insert",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.children.length,i=Number(r),a=e instanceof window.Node;if(n){for(var o=0,s=null,l="";o<n;o++){s=t.children[o];var u=Number(s.getAttribute("data-index"));if(u>=i){l="beforebegin";break}u<i&&(l="afterend")}return a?"afterend"===l?t.appendChild(e):t.insertBefore(e,s):s.insertAdjacentHTML(l,e),"afterend"===l?t.children[t.children.length-1]:t.children[o]}return a?t.appendChild(e):t.insertAdjacentHTML("beforeend",e),t.children[t.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=[];if(e instanceof window.Node&&"function"==typeof n)if(Array.isArray(r))r.forEach((function(r){var o=delegate_1(e,t,r,n,i);o.key="".concat(t,"_").concat(r),a.push(o)}));else{var o=delegate_1(e,t,r,n,i);o.key="".concat(t,"_").concat(r),a.push(o)}return a}},{key:"ROOT_TYPES",get:function(){return ROOT_TYPES}},{key:"POSITIONS",get:function(){return POSITIONS$a}}]),n}(BasePlugin),es_string_iterator={},charAt$i=stringMultibyte$1.charAt,toString$E=toString$O,InternalStateModule$i=internalState$1,defineIterator$3=iteratorDefine$1,createIterResultObject$4=createIterResultObject$6,STRING_ITERATOR$1="String Iterator",setInternalState$f=InternalStateModule$i.set,getInternalState$d=InternalStateModule$i.getterFor(STRING_ITERATOR$1);defineIterator$3(String,"String",(function(e){setInternalState$f(this,{type:STRING_ITERATOR$1,string:toString$E(e),index:0})}),(function(){var e,t=getInternalState$d(this),r=t.string,n=t.index;return n>=r.length?createIterResultObject$4(void 0,!0):(e=charAt$i(r,n),t.index+=e.length,createIterResultObject$4(e,!1))}));var ResizeObserver$1=function(){function t(){var r=this;if(_classCallCheck$i(this,t),_defineProperty$i(this,"__trigger",(function(e){var t=(new Date).getTime();r.timeStamp=t;for(var n=0;n<e.length;n++)r.__runHandler(e[n].target)})),this.__handlers=[],this.timeStamp=0,this.observer=null,window.ResizeObserver)try{this.observer=new window.ResizeObserver(throttle(this.__trigger,100,{trailing:!0})),this.timeStamp=(new Date).getTime()}catch(e){console.error(e)}}return _createClass$j(t,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=e.getAttribute("data-playerid"),n=this.__handlers,i=-1,a=0;a<n.length;a++)n[a]&&e===n[a].target&&(i=a);i>-1?this.__handlers[i].handler=t:this.__handlers.push({target:e,handler:t,playerId:r})}}},{key:"unObserver",value:function(t){var r=-1;this.__handlers.map((function(e,n){t===e.target&&(r=n)}));try{this.observer&&this.observer.unobserve(t)}catch(e){}this.observer&&this.observer.unobserve(t),r>-1&&this.__handlers.splice(r,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,r=0;r<t.length;r++)if(t[r]&&e===t[r].target){try{t[r].handler(e)}catch(error){console.error(error)}return!0}return!1}}]),t}(),resizeObserver=null;function addObserver(e,t){return resizeObserver||(resizeObserver=new ResizeObserver$1),resizeObserver.addObserver(e,t),resizeObserver}function unObserver(e,t){resizeObserver.unObserver(e,t)}var pluginsManager={pluginGroup:{},init:function(e){var t=e._pluginInfoId;t||(t=(new Date).getTime(),e._pluginInfoId=t),!e.config.closeResizeObserver&&addObserver(e.root,(function(){e.resize()})),0===Object.keys(this.pluginGroup).length&&(e.isUserActive=!0),this.pluginGroup[t]={_player:e,_originalOptions:e.config||{}}},checkPlayerRoot:function(e){if(this.pluginGroup){for(var t=Object.keys(this.pluginGroup),r=0;r<t.length;r++){var n=this.pluginGroup[t[r]]._player;if(n.root===e)return n}return null}return null},formatPluginInfo:function(e,t){var r=null,n=null;return e.plugin&&"function"==typeof e.plugin?(r=e.plugin,n=e.options):(r=e,n={}),t&&(n.config=t||{}),{PLUFGIN:r,options:n}},checkPluginIfExits:function(e,t){for(var r=0;r<t.length;r++)if(e.toLowerCase()===t[r].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(e,t){for(var r=Object.keys(t),n=null,i=0;i<r.length;i++)if(e.toLowerCase()===r[i].toLowerCase()){n=t[r[i]];break}return"Object"===util$2.typeOf(n)?{root:n.root,position:n.position}:{}},lazyRegister:function(e,t){var r=this,n=t.timeout||1500;return Promise.race([t.loader().then((function(t){var n;n=t&&t.__esModule?t.default:t,r.register(e,n,t.options)})),new Promise((function(e,t){setTimeout((function(){t(new Error("timeout"))}),n)}))])},register:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&t&&"function"==typeof t&&void 0!==t.prototype){var n=e._pluginInfoId;n&&this.pluginGroup&&this.pluginGroup[n]||(this.init(e),n=e._pluginInfoId),this.pluginGroup[n]._plugins||(this.pluginGroup[n]._plugins={});var i=this.pluginGroup[n]._plugins,a=this.pluginGroup[n]._originalOptions;r.player=this.pluginGroup[n]._player;var o=r.pluginName||t.pluginName;if(!o)throw new Error("The property pluginName is necessary");if(!t.isSupported||t.isSupported()){r.config||(r.config={});for(var s=Object.keys(a),l=0;l<s.length;l++)if(o.toLowerCase()===s[l].toLowerCase()){var u=a[s[l]];"Object"===util$2.typeOf(u)?r.config=Object.assign({},r.config,a[s[l]]):"Boolean"===util$2.typeOf(u)&&(r.config.disable=!u);break}t.defaultConfig&&Object.keys(t.defaultConfig).map((function(e){void 0===r.config[e]&&(r.config[e]=t.defaultConfig[e])})),r.root?"string"==typeof r.root&&(r.root=e[r.root]):r.root=e.root,r.index=r.config.index||0;try{i[o.toLowerCase()]&&(this.unRegister(n,o.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(o,"] exist, destroy the old instance")));var c=new t(r);return i[o.toLowerCase()]=c,i[o.toLowerCase()].func=t,c&&"function"==typeof c.afterCreate&&c.afterCreate(),c}catch(d){throw console.error(d),d}}else console.warn("not supported plugin [".concat(o,"]"))}},unRegister:function(t,r){t._pluginInfoId&&(t=t._pluginInfoId),r=r.toLowerCase();try{var n=this.pluginGroup[t]._plugins[r];n&&(n.pluginName&&n.__destroy(),delete this.pluginGroup[t]._plugins[r])}catch(e){console.error("[unRegister:".concat(r,"] cgid:[").concat(t,"] error"),e)}},deletePlugin:function(e,t){var r=e._pluginInfoId;r&&this.pluginGroup&&this.pluginGroup[r]&&this.pluginGroup[r]._plugins&&delete this.pluginGroup[r]._plugins[t]},getPlugins:function(e){var t=e._pluginInfoId;return t&&this.pluginGroup[t]?this.pluginGroup[t]._plugins:{}},findPlugin:function(e,t){var r=e._pluginInfoId;if(!this.pluginGroup||!r)return null;var n=t.toLowerCase();return this.pluginGroup[r]._plugins[n]},beforeInit:function(t){var r=this;function n(e){return e&&e.then?e:new Promise((function(e){e()}))}return new Promise((function(i){if(r.pluginGroup)return(t._loadingPlugins&&t._loadingPlugins.length?Promise.all(t._loadingPlugins):Promise.resolve()).then((function(){var a=t._pluginInfoId;if(r.pluginGroup[a]){for(var o=r.pluginGroup[a]._plugins,s=[],l=0,u=Object.keys(o);l<u.length;l++){var c=u[l];if(o[c]&&o[c].beforePlayerInit)try{var d=o[c].beforePlayerInit();s.push(n(d))}catch(e){throw s.push(n(null)),e}}Promise.all([].concat(s)).then((function(){i()})).catch((function(e){console.error(e),i()}))}else i()}))}))},afterInit:function(e){var t=e._pluginInfoId;if(this.pluginGroup&&t)for(var r=this.pluginGroup[t]._plugins,n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];r[a]&&r[a].afterPlayerInit&&r[a].afterPlayerInit()}},setLang:function(e,t){var r=t._pluginInfoId;if(this.pluginGroup&&r){var n=this.pluginGroup[r]._plugins;Object.keys(n).map((function(t){if(n[t].updateLang)n[t].updateLang(e);else try{n[t].lang=e}catch(error){console.warn("".concat(t," setLang"))}}))}},reRender:function(e){var t=e._pluginInfoId;if(t){for(var r={},n=this.pluginGroup[t]._plugins,i=0,a=Object.keys(n);i<a.length;i++){var o=a[i];r[o]={plugin:n[o].func,options:n[o]._args},this.unRegister(t,o)}for(var s=0,l=Object.keys(r);s<l.length;s++){var u=l[s];this.register(t,u,r[u].plugin,r[u].options)}}},onPluginsReady:function(e){var t=e._pluginInfoId,r=this.pluginGroup[t]._plugins;t&&r&&Object.keys(r).map((function(e){r[e].onPluginsReady&&"function"==typeof r[e].onPluginsReady&&r[e].onPluginsReady()}))},setCurrentUserActive:function(e,t){if(this.pluginGroup&&this.pluginGroup[e]){if(!t)return this.pluginGroup[e]._player.isUserActive=t,e;for(var r=Object.keys(this.pluginGroup),n=0;n<r.length;n++){var i=this.pluginGroup[r[n]];i&&i._player&&(this.pluginGroup[r[n]]._player.isUserActive=!1)}return this.pluginGroup[e]._player.isUserActive=t,e}},getCurrentUseActiveId:function(){if(this.pluginGroup){for(var e=Object.keys(this.pluginGroup),t=0;t<e.length;t++){var r=this.pluginGroup[e[t]];if(r&&r._player&&r._player.isUserActive)return e[t]}return null}},destroy:function(e){var t=e._pluginInfoId;if(this.pluginGroup[t]){unObserver(e.root);for(var r=this.pluginGroup[t]._plugins,n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];this.unRegister(t,a)}var o=e.isUseActive;if(delete this.pluginGroup[t],delete e._pluginInfoId,o){var s=Object.keys(this.pluginGroup);s.length>0&&this.setCurrentUserActive(s[s.length-1],!0)}}}},STATE_CLASS={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function getDefaultConfig$1(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!1,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},ignores:[],whitelist:[],inactive:3e3,lang:getLang(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],thumbnail:null,videoConfig:{},commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var usePreset=function(e,t){var r,n,i=t.preset&&t.options?new t.preset(t.options,e.config):new t({},e.config),a=i.plugins,o=void 0===a?[]:a,s=i.ignores,l=void 0===s?[]:s,u=i.icons,c=void 0===u?{}:u,d=i.i18n,h=void 0===d?[]:d;e.config.plugins||(e.config.plugins=[]),e.config.ignores||(e.config.ignores=[]),(r=e.config.plugins).push.apply(r,_toConsumableArray$9(o)),(n=e.config.ignores).push.apply(n,_toConsumableArray$9(l)),Object.keys(c).map((function(t){e.config.icons[t]||(e.config.icons[t]=c[t])}));var f=e.config.i18n||[];h.push.apply(h,_toConsumableArray$9(f)),e.config.i18n=h},Controls=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"onMouseEnter",(function(t){var r=_assertThisInitialized$f(e),n=r.player;r.playerConfig.closeControlsBlur&&n.focus({autoHide:!1})})),_defineProperty$i(_assertThisInitialized$f(e),"onMouseLeave",(function(){_assertThisInitialized$f(e).player.focus()})),e}return _createClass$j(r,[{key:"beforeCreate",value:function(e){e.config.mode||"mobile"!==sniffer$1.device||(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,t=this.config,r=t.disable,n=t.height,i=t.mode;if(!r){"flex"===i&&this.player.addClass(STATE_CLASS.FLEX_CONTROLS);var a={height:"".concat(n,"px")};Object.keys(a).map((function(t){e.root.style[t]=a[t]})),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(MINI_STATE_CHANGE,(function(t){t?util$2.addClass(e.root,"mini-controls"):util$2.removeClass(e.root,"mini-controls")}));var o=this.playerConfig.isMobileSimulateMode;"mobile"!==sniffer$1.device&&"mobile"!==o&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&util$2.addClass(this.root,STATE_CLASS.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){util$2.removeClass(this.root,STATE_CLASS.CONTROLS_AUTOHIDE)}},{key:"show",value:function(){util$2.addClass(this.root,"show")}},{key:"hide",value:function(){util$2.removeClass(this.root,"show")}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(this.root){var i=e.defaultConfig||{};if(!t.root){var a=t.position?t.position:t.config&&t.config.position?t.config.position:i.position;switch(a){case POSITIONS$a.CONTROLS_LEFT:t.root=this.left;break;case POSITIONS$a.CONTROLS_RIGHT:t.root=this.right;break;case POSITIONS$a.CONTROLS_CENTER:t.root=this.center;break;case POSITIONS$a.CONTROLS:t.root=this.root;break;default:t.root=this.left}return _get$3(_getPrototypeOf$f(r.prototype),"registerPlugin",this).call(this,e,t,n)}}}},{key:"destroy",value:function(){"mobile"!==sniffer$1.device&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,t=e.mode,r=e.autoHide,n=e.initShow;if(!e.disable){var i=util$2.classNames({"xgplayer-controls":!0},{"flex-controls":"flex"===t},{"bottom-controls":"bottom"===t},_defineProperty$i({},STATE_CLASS.CONTROLS_AUTOHIDE,r),{"xgplayer-controls-initshow":n||!r});return'<xg-controls class="'.concat(i,'" unselectable="on" onselectstart="return false">\n    <xg-inner-controls class="xg-inner-controls xg-pos">\n      <xg-left-grid class="xg-left-grid">\n      </xg-left-grid>\n      <xg-center-grid class="xg-center-grid"></xg-center-grid>\n      <xg-right-grid class="xg-right-grid">\n      </xg-right-grid>\n    </xg-inner-controls>\n    </xg-controls>')}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),r}(Plugin),EN={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},XGI18nLang={lang:{},langKeys:[],textKeys:[]};function deepMerge(e,t){return Object.keys(t).map((function(r){var n=util$2.typeOf(t[r]),i=util$2.typeOf(e[r]);if(t[r]instanceof window.Node)e[r]=t[r];else if("Array"===n){var a;"Array"!==i&&(e[r]=[]),(a=e[r]).push.apply(a,_toConsumableArray$9(t[r]))}else"Object"===n?("Object"!==i&&(e[r]={}),deepMerge(e[r],t[r])):e[r]=t[r]})),e}function updateKeys(){Object.keys(XGI18nLang.lang.en).map((function(e){XGI18nLang.textKeys[e]=e}))}function extend(e,t){var r=[];if(t||(t=XGI18nLang),t.lang){r="Array"!==util$2.typeOf(e)?Object.keys(e).map((function(t){return{LANG:"zh"===t?"zh-cn":t,TEXT:e[t]}})):e;var n=t.lang;r.map((function(e){"zh"===e.LANG&&(e.LANG="zh-cn"),n[e.LANG]?deepMerge(n[e.LANG]||{},e.TEXT||{}):use(e,t)})),updateKeys()}}function use(e,t){var r=e.LANG;if(t||(t=XGI18nLang),t.lang){var n=e.TEXT||{};"zh"===r&&(r="zh-cn"),t.lang[r]?deepMerge(t.lang[r],n):(t.langKeys.push(r),t.lang[r]=n),updateKeys()}}function init$2(e){var t,r={lang:{},langKeys:[],textKeys:{},pId:e};return deepMerge(r.lang,XGI18nLang.lang),(t=r.langKeys).push.apply(t,_toConsumableArray$9(XGI18nLang.langKeys)),deepMerge(r.textKeys,XGI18nLang.textKeys),r}use(EN);var I18N={get textKeys(){return XGI18nLang.textKeys},get langKeys(){return XGI18nLang.langKeys},get lang(){var e={};return XGI18nLang.langKeys.map((function(t){e[t]=XGI18nLang.lang[t]})),XGI18nLang.lang["zh-cn"]&&(e.zh=XGI18nLang.lang["zh-cn"]||{}),e},extend:extend,use:use,init:init$2},STATES$2={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},STATE_ARRAY=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],PlAYER_HOOKS=["play","pause","replay","retry"],REAL_TIME_SPEED=0,AVG_SPEED=0,Player=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;_classCallCheck$i(this,r);var i=util$2.deepMerge(getDefaultConfig$1(),e);_defineProperty$i(_assertThisInitialized$f(n=t.call(this,i)),"canPlayFunc",(function(){if(n.config){var e=n.config,t=e.autoplay,r=e.startTime,i=e.defaultPlaybackRate;XG_DEBUG.logInfo("player","canPlayFunc, startTime",r),r&&(n.currentTime=r>n.duration?n.duration:r,n.config.startTime=0),1!==i&&(n.playbackRate=i),t&&n.videoPlay(),n.off(CANPLAY,n.canPlayFunc),n.removeClass(STATE_CLASS.ENTER)}})),_defineProperty$i(_assertThisInitialized$f(n),"onFullscreenChange",(function(e,t){var r=function(){util$2.setTimeout(_assertThisInitialized$f(n),(function(){n.resize()}),100)},i=util$2.getFullScreenEl();if(n._fullActionFrom?n._fullActionFrom="":n.emit(USER_ACTION,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:n.currentTime,duration:n.duration,props:[{prop:"fullscreen",from:!0,to:!1}]}),t||i&&(i===n._fullscreenEl||"VIDEO"===i.tagName))r(),!n.config.closeFocusVideoFocus&&n.video.focus(),n.fullscreen=!0,n.changeFullStyle(n.root,i,STATE_CLASS.FULLSCREEN),n.emit(FULLSCREEN_CHANGE,!0,n._fullScreenOffset),n.cssfullscreen&&n.exitCssFullscreen();else if(n.fullscreen){r();var a=_assertThisInitialized$f(n),o=a._fullScreenOffset;a.config.needFullscreenScroll?(window.scrollTo(o.left,o.top),util$2.setTimeout(_assertThisInitialized$f(n),(function(){n.fullscreen=!1,n._fullScreenOffset=null}),100)):(!n.config.closeFocusVideoFocus&&n.video.focus(),n.fullscreen=!1,n._fullScreenOffset=null),n.cssfullscreen?n.removeClass(STATE_CLASS.FULLSCREEN):n.recoverFullStyle(n.root,n._fullscreenEl,STATE_CLASS.FULLSCREEN),n._fullscreenEl=null,n.emit(FULLSCREEN_CHANGE,!1)}})),_defineProperty$i(_assertThisInitialized$f(n),"_onWebkitbeginfullscreen",(function(e){n._fullscreenEl=n.video,n.onFullscreenChange(e,!0)})),_defineProperty$i(_assertThisInitialized$f(n),"_onWebkitendfullscreen",(function(e){n.onFullscreenChange(e,!1)})),hooksDescriptor(_assertThisInitialized$f(n),PlAYER_HOOKS),n.config=i,n._pluginInfoId=util$2.generateSessionId(),bindDebug(_assertThisInitialized$f(n));var a=n.constructor.defaultPreset;if(n.config.presets.length){var o=n.config.presets.indexOf("default");o>=0&&a&&(n.config.presets[o]=a)}else a&&n.config.presets.push(a);if(n.userTimer=null,n.waitTimer=null,n._state=STATES$2.INITIAL,n._isError=!1,n._hasStart=!1,n.isSeeking=!1,n.isCanplay=!1,n._runPending=!1,n.rotateDeg=0,n.isActive=!1,n.fullscreen=!1,n.cssfullscreen=!1,n.isRotateFullscreen=!1,n._fullscreenEl=null,n._cssfullscreenEl=null,n.curDefinition=null,n._orgCss="",n._fullScreenOffset=null,n._videoHeight=0,n._videoWidth=0,n._accPlayed={t:0,acc:0,loopAcc:0},n.innerContainer=null,n.controls=null,n.topBar=null,n.root=null,n.__i18n=I18N.init(n._pluginInfoId),sniffer$1.os.isAndroid&&sniffer$1.osVersion>0&&sniffer$1.osVersion<6&&(n.config.autoplay=!1),n.database=new INDEXDB,n.isUserActive=!1,!n._initDOM())return console.error(new Error("can't find the dom which id is ".concat(n.config.id," or this.config.el does not exist"))),_possibleConstructorReturn$f(n);var s=n.config,l=s.definition,u=void 0===l?{}:l;if(!s.url&&u.list&&u.list.length>0){var c=u.list.find((function(e){return e.definition&&e.definition===u.defaultDefinition}));c||(u.defaultDefinition=u.list[0].definition,c=u.list[0]),n.config.url=c.url,n.curDefinition=c}return n._bindEvents(),n._registerPresets(),n._registerPlugins(),pluginsManager.onPluginsReady(_assertThisInitialized$f(n)),n.getInitDefinition(),n.setState(STATES$2.READY),n.emit(READY),n.onReady&&n.onReady(),(n.config.videoInit||n.config.autoplay)&&(!n.hasStart||n.state<STATES$2.ATTACHED)&&n.start(),n}return _createClass$j(r,[{key:"_initDOM",value:function(){var e=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var t=this.config.el;if(!t||1!==t.nodeType)return this.emit(ERROR$3,new Errors$1("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1;this.root=t}var r=pluginsManager.checkPlayerRoot(this.root);r&&(XG_DEBUG.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),r.destroy()),this.root.setAttribute("data-playerid",this.playerId),this._initBaseDoms();var n=this.constructor.XgVideoProxy;if(n&&this.videoConfig.mediaType===n.mediaType){var i=this.innerContainer||this.root;this.detachVideoEvents(this.video);var a=new n(i,this.config,this.videoConfig);this.attachVideoEvents(a),this.video=a}if(this.config.controls){var o=pluginsManager.register(this,Controls);this.controls=o}var s="mobile"===this.config.isMobileSimulateMode?"mobile":sniffer$1.device;if(this.addClass("".concat(STATE_CLASS.DEFAULT," ").concat(STATE_CLASS.INACTIVE," xgplayer-").concat(s," ").concat(this.config.controls?"":STATE_CLASS.NO_CONTROLS)),this.config.autoplay?this.addClass(STATE_CLASS.ENTER):this.addClass(STATE_CLASS.NO_START),this.config.fluid){var l=this.config,u=l.width,c=l.height;"number"==typeof u&&"number"==typeof c||(u=600,c=337.5);var d={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(100*c/u,"%")};Object.keys(d).forEach((function(t){e.root.style[t]=d[t]}))}else["width","height"].forEach((function(t){e.config[t]&&("number"!=typeof e.config[t]?e.root.style[t]=e.config[t]:e.root.style[t]="".concat(e.config[t],"px"))}));return!0}},{key:"_initBaseDoms",value:function(){this.topBar=util$2.createDom("xg-bar","",{"data-index":-1},"xg-top-bar"),this.leftBar=util$2.createDom("xg-bar","",{"data-index":-1},"xg-left-bar"),this.rightBar=util$2.createDom("xg-bar","",{"data-index":-1},"xg-right-bar"),this.config.marginControls&&(this.innerContainer=util$2.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer)),this.config.topBarAutoHide&&util$2.addClass(this.topBar,STATE_CLASS.TOP_BAR_AUTOHIDE),this.root.appendChild(this.topBar),this.root.appendChild(this.leftBar),this.root.appendChild(this.rightBar)}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach((function(t){e.on(t,e["on"+t.charAt(0).toUpperCase()+t.slice(1)])})),FULLSCREEN_EVENTS.forEach((function(t){document&&document.addEventListener(t,e.onFullscreenChange)})),sniffer$1.os.isIos&&(this.video.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.video.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(LOADED_DATA,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.video.focus()},this.once(PLAY,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),FULLSCREEN_EVENTS.forEach((function(t){document.removeEventListener(t,e.onFullscreenChange)})),this.playFunc&&this.off(PLAY,this.playFunc),this.off(CANPLAY,this.canPlayFunc),this.video.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.video.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_startInit",value:function(e){var t=this;if(this.video&&(e&&""!==e&&("Array"!==util$2.typeOf(e)||0!==e.length)||(e="",this.emit(URL_NULL),XG_DEBUG.logWarn("config.url is null, please get url and run player._startInit(url)"),!this.config.nullUrlStart))){this._detachSourceEvents(this.video),"Array"===util$2.typeOf(e)?this._attachSourceEvents(this.video,e):this.video.src!==e&&(this.video.src=e),"Number"===util$2.typeOf(this.config.volume)&&(this.volume=this.config.volume);var r=this.innerContainer?this.innerContainer:this.root;this.video instanceof window.Element&&!r.contains(this.video)&&r.insertBefore(this.video,r.firstChild);var n=this.video.readyState;XG_DEBUG.logInfo("_startInit readyState",n),this.config.autoplay&&(!/^blob/.test(this.video.currentSrc)&&!/^blob/.test(this.video.src)&&this.load(),(sniffer$1.os.isIpad||sniffer$1.os.isPhone)&&this.videoPlay()),n>=2?this.canPlayFunc():this.once(CANPLAY,this.canPlayFunc),(!this.hasStart||this.state<STATES$2.ATTACHED)&&pluginsManager.afterInit(this),this.hasStart=!0,this.setState(STATES$2.ATTACHED),util$2.setTimeout(this,(function(){t.emit(COMPLETE)}),0)}}},{key:"_registerPlugins",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._loadingPlugins=[];var r=this.config.ignores||[],n=this.config.plugins||[],i=this.config.i18n||[];t&&I18N.extend(i,this.__i18n);var a=r.join("||").toLowerCase().split("||"),o=this.plugins;n.forEach((function(r){try{var n=r.plugin?r.plugin.pluginName:r.pluginName;if(n&&a.indexOf(n.toLowerCase())>-1)return null;if(!t&&o[n.toLowerCase()])return;if(r.lazy&&r.loader){var i=pluginsManager.lazyRegister(e,r);return void(r.forceBeforeInit&&(i.then((function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(i),1)})).catch((function(t){XG_DEBUG.logError("_registerPlugins:loadingPlugin",t),e._loadingPlugins.splice(e._loadingPlugins.indexOf(i),1)})),e._loadingPlugins.push(i)))}return e.registerPlugin(r)}catch(s){XG_DEBUG.logError("_registerPlugins:",s)}}))}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach((function(t){usePreset(e,t)}))}},{key:"_getRootByPosition",value:function(e){var t=null;switch(e){case POSITIONS$a.ROOT_RIGHT:t=this.rightBar;break;case POSITIONS$a.ROOT_LEFT:t=this.leftBar;break;case POSITIONS$a.ROOT_TOP:t=this.topBar;break;default:t=this.innerContainer||this.root}return t}},{key:"registerPlugin",value:function(e,t){var r=pluginsManager.formatPluginInfo(e,t),n=r.PLUFGIN,i=r.options,a=this.config.plugins;!pluginsManager.checkPluginIfExits(n.pluginName,a)&&a.push(n);var o=pluginsManager.getRootByConfig(n.pluginName,this.config);o.root&&(i.root=o.root),o.position&&(i.position=o.position);var s=i.position?i.position:i.config&&i.config.position||n.defaultConfig&&n.defaultConfig.position;return!i.root&&"string"==typeof s&&s.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(n,i,n.pluginName):(i.root||(i.root=this._getRootByPosition(s)),pluginsManager.register(this,n,i))}},{key:"deregister",value:function(e){"string"==typeof e?pluginsManager.unRegister(this,e):e instanceof BasePlugin&&pluginsManager.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.deregister(e),t&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var t;if("string"==typeof e?t=e:e instanceof BasePlugin&&(t=e.pluginName),t)for(var r=this.config.plugins.length-1;r>-1;r--){if(this.config.plugins[r].pluginName.toLowerCase()===t.toLowerCase()){this.config.plugins.splice(r,1);break}}}},{key:"plugins",get:function(){return pluginsManager.getPlugins(this)}},{key:"getPlugin",value:function(e){var t=pluginsManager.findPlugin(this,e);return t&&t.pluginName?t:null}},{key:"addClass",value:function(e){this.root&&(util$2.hasClass(this.root,e)||util$2.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&util$2.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return util$2.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,t){this.root&&this.root.setAttribute(e,t)}},{key:"removeAttribute",value:function(e,t){this.root&&this.root.removeAttribute(e,t)}},{key:"start",value:function(e){var t=this;return this.hasStart||this.state>=STATES$2.ATTACHING?Promise.resolve():(e||this.config.url||this.getInitDefinition(),this.hasStart=!0,this.setState(STATES$2.ATTACHING),this._registerPlugins(!1),pluginsManager.beforeInit(this).then((function(){if(t.config)return e||(e=t.url||t.config.url),t._startInit(e)})).catch((function(e){throw e.fileName="player",e.lineNumber="236",XG_DEBUG.logError("start:beforeInit:",e),e})))}},{key:"switchURL",value:function(e){var t=this,r=e;"Object"===util$2.typeOf(e)&&(r=e.url);var n=this.currentTime,i=this.paused&&!this._isError;return this.src=r,new Promise((function(e){var r=function(){t.currentTime=n,i&&t.once("canplay",(function(){t.pause()})),e()};sniffer$1.os.isAndroid?t.once("timeupdate",(function(){r()})):t.once("canplay",(function(){r()})),t.play()}))}},{key:"load",value:function(){this.video&&this.video.load()}},{key:"videoPlay",value:function(){var e=this;if(this.hasStart||!(this.state<STATES$2.ATTACHED)){this.state<STATES$2.RUNNING&&(this.removeClass(STATE_CLASS.NO_START),!this.isCanplay&&this.addClass(STATE_CLASS.ENTER));var t=_get$3(_getPrototypeOf$f(r.prototype),"play",this).call(this);return void 0!==t&&t&&t.then?t.then((function(){e.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),e.addClass(STATE_CLASS.PLAYING),e.state<STATES$2.RUNNING&&(XG_DEBUG.logInfo(">>>>playPromise.then"),e.setState(STATES$2.RUNNING),e.emit(AUTOPLAY_STARTED))})).catch((function(t){if(XG_DEBUG.logWarn(">>>>playPromise.catch",t.name),e.video&&e.video.error)return e.onError(),void e.removeClass(STATE_CLASS.ENTER);"NotAllowedError"===t.name&&(e._errorTimer=util$2.setTimeout(e,(function(){e._errorTimer=null,e.emit(AUTOPLAY_PREVENTED),e.addClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),e.removeClass(STATE_CLASS.ENTER),e.pause(),e.setState(STATES$2.NOTALLOW)}),0))})):(XG_DEBUG.logWarn("video.play not return promise"),this.state<STATES$2.RUNNING&&(this.setState(STATES$2.RUNNING),this.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),this.removeClass(STATE_CLASS.NO_START),this.removeClass(STATE_CLASS.ENTER),this.addClass(STATE_CLASS.PLAYING),this.emit(AUTOPLAY_STARTED))),t}this.removeClass(STATE_CLASS.NO_START),this.addClass(STATE_CLASS.ENTER);var n=this.start();n&&n.then((function(t){!e.config.autoplay&&e.videoPlay()}))}},{key:"videoPause",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;this.removeClass(STATE_CLASS.PAUSED),runHooks(this,"play",(function(){e.videoPlay()}))}},{key:"pause",value:function(){var e=this;runHooks(this,"pause",(function(){_get$3(_getPrototypeOf$f(r.prototype),"pause",e).call(e)}))}},{key:"seek",value:function(e,t){var r=this;if(this.video&&!Number.isNaN(Number(e)||!this.hasStart)){var n=this.config,i=n.isSeekedPlay,a=n.seekedStatus,o=t||(i?"play":a);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,this.once(CANPLAY,(function(){switch(r.removeClass(STATE_CLASS.ENTER),r.isSeeking=!1,o){case"play":r.play();break;case"pause":r.pause();break;default:!r.paused&&r.play()}})),this.state<STATES$2.RUNNING?(this.removeClass(STATE_CLASS.NO_START),this.addClass(STATE_CLASS.ENTER),this.currentTime=e,"play"===o&&this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,t=this.config,r=t.definition;!t.url&&r&&r.list&&r.list.length>0&&r.defaultDefinition&&r.list.map((function(t){t.definition===r.defaultDefinition&&(e.config.url=t.url,e.curDefinition=t)}))}},{key:"changeDefinition",value:function(e,t){var r=this,n=this.config.definition;if(Array.isArray(null==n?void 0:n.list)&&n.list.forEach((function(t){(null==e?void 0:e.definition)===t.definition&&(r.curDefinition=t)})),this.emit(DEFINITION_CHANGE,{from:t,to:e}),this.hasStart){var i=this.switchURL(e.url);i&&i.then?i.then((function(){r.emit(AFTER_DEFINITION_CHANGE,{from:t,to:e})})):this.emit(AFTER_DEFINITION_CHANGE,{from:t,to:e})}else this.config.url=e.url}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(LOADED_DATA,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,t=[STATE_CLASS.NOT_ALLOW_AUTOPLAY,STATE_CLASS.PLAYING,STATE_CLASS.NO_START,STATE_CLASS.PAUSED,STATE_CLASS.REPLAY,STATE_CLASS.ENTER,STATE_CLASS.ENDED,STATE_CLASS.ERROR,STATE_CLASS.LOADING];this.hasStart=!1,this._isError=!1,this.videoPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,t.forEach((function(t){e.removeClass(t)})),this.addClass(STATE_CLASS.ENTER),this.emit(RESET)}},{key:"reset",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0;this.resetState();var n=this.plugins;if(n&&(t.map((function(t){e.deregister(t)})),r)){var i=getDefaultConfig$1();Object.keys(this.config).keys((function(t){"undefined"===e.config[t]||"plugins"!==t&&"presets"!==t&&"el"!==t&&"id"!==t||(e.config[t]=i[t])}))}}},{key:"destroy",value:function(){var e=this,t=this.innerContainer,n=this.root,i=this.video;if(n&&i){if(this._hasStart=!1,n.removeAttribute("data-playerid"),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.video),util$2.clearAllTimers(this),this.emit(DESTROY),pluginsManager.destroy(this),delHooksDescriptor(this),_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),t)for(var a=t.children,o=0;o<a.length;o++)t.removeChild(a[o]);!t&&i instanceof window.Node&&n.contains(i)&&n.removeChild(i),["topBar","leftBar","rightBar","innerContainer"].map((function(t){e[t]&&n.removeChild(e[t]),e[t]=null}));var s=n.className.split(" ");s.length>0?n.className=s.filter((function(e){return e.indexOf("xgplayer")<0})).join(" "):n.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach((function(t){e[t]=!1}))}}},{key:"replay",value:function(){var e=this;this.removeClass(STATE_CLASS.ENDED),this.currentTime=0,this.isSeeking=!1,runHooks(this,"replay",(function(){e.once(CANPLAY,(function(){var t=e.videoPlay();t&&t.catch&&t.catch((function(e){console.log(e)}))})),e.play(),e.emit(REPLAY),e.onPlay()}))}},{key:"retry",value:function(){var e=this;this.removeClass(STATE_CLASS.ERROR),this.addClass(STATE_CLASS.LOADING),runHooks(this,"retry",(function(){var t=e.currentTime;e.src=e.config.url,!e.config.isLive&&(e.currentTime=t),e.once(CANPLAY,(function(){e.videoPlay()}))}))}},{key:"changeFullStyle",value:function(e,t,r,n){e&&(n||(n=STATE_CLASS.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=util$2.filterStyleFromText(e)),util$2.addClass(e,r),t&&t!==e&&!this._orgPCss&&(this._orgPCss=util$2.filterStyleFromText(t),util$2.addClass(t,n)))}},{key:"recoverFullStyle",value:function(e,t,r,n){n||(n=STATE_CLASS.PARENT_FULLSCREEN),this._orgCss&&(util$2.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),util$2.removeClass(e,r),t&&t!==e&&this._orgPCss&&(util$2.setStyleFromCsstext(t,this._orgPCss),this._orgPCss="",util$2.removeClass(t,n))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget,t=this.root,r=this.video;e||(e=t),this._fullScreenOffset={top:util$2.scrollTop(),left:util$2.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var n=util$2.getFullScreenEl();if(n!==this._fullscreenEl)try{for(var i=0;i<GET_FULLSCREEN_API.length;i++){var a=GET_FULLSCREEN_API[i];if(e[a]){var o="webkitRequestFullscreen"===a?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[a]();return o&&o.then?o:Promise.resolve()}}return r.fullscreenEnabled||r.webkitSupportsFullscreen?(r.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(s){return Promise.reject(new Error("call getFullscreen fail"))}else this.onFullscreenChange()}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),this._fullscreenEl||util$2.getFullScreenEl()){this.root;var t=this.video;this._fullActionFrom="exit";try{for(var r=0;r<EXIT_FULLSCREEN_API.length;r++){var n=EXIT_FULLSCREEN_API[r];if(document[n]){var i=document[n]();return i&&i.then?i:Promise.resolve()}}return t&&t.webkitSupportsFullscreen?(t.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(a){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var t=e?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.CSS_FULLSCREEN):STATE_CLASS.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,t);var r=this.config.fullscreen,n=void 0===r?{}:r,i=!0===n.useCssFullscreen||"function"==typeof n.useCssFullscreen&&n.useCssFullscreen();i&&(this.fullscreen=!0,this.emit(FULLSCREEN_CHANGE,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(CSS_FULLSCREEN_CHANGE,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.CSS_FULLSCREEN):STATE_CLASS.CSS_FULLSCREEN;if(this.fullscreen){var t=this.config.fullscreen,r=void 0===t?{}:t;!0===r.useCssFullscreen||"function"==typeof r.useCssFullscreen&&r.useCssFullscreen()?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(FULLSCREEN_CHANGE,!1)):this.removeClass(e)}else this.recoverFullStyle(this.root,this._cssfullscreenEl,e);this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(CSS_FULLSCREEN_CHANGE,!1)}},{key:"getRotateFullscreen",value:function(e){this.cssfullscreen&&this.exitCssFullscreen(e);var t=e?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.ROTATE_FULLSCREEN):STATE_CLASS.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,t,STATE_CLASS.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this.emit(FULLSCREEN_CHANGE,!0)}},{key:"exitRotateFullscreen",value:function(e){var t=this._fullscreenEl!==this.root?"".concat(STATE_CLASS.INNER_FULLSCREEN," ").concat(STATE_CLASS.ROTATE_FULLSCREEN):STATE_CLASS.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,t,STATE_CLASS.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(FULLSCREEN_CHANGE,!1)}},{key:"setRotateDeg",value:function(e){90===window.orientation||-90===window.orientation?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};this.isActive?this.onFocus(e):this.emit(PLAYER_FOCUS,_objectSpread2$b({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ignorePaused:!1};this.isActive?this.emit(PLAYER_BLUR,_objectSpread2$b({paused:this.paused,ended:this.ended},e)):this.onBlur(e)}},{key:"onFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.autoHide,n=void 0===r?!this.config.closePlayerBlur:r,i=t.delay,a=void 0===i?this.config.inactive:i;this.isActive=!0,this.removeClass(STATE_CLASS.INACTIVE),this.userTimer&&(util$2.clearTimeout(this,this.userTimer),this.userTimer=null),n?this.userTimer=util$2.setTimeout(this,(function(){e.userTimer=null,e.blur()}),a):this.userTimer&&(util$2.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"onBlur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ignorePaused,r=void 0!==t&&t;if(this.isActive){var n=this.config.closePauseVideoFocus;this.isActive=!1,(r||n||!this.paused&&!this.ended)&&this.addClass(STATE_CLASS.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.state>=STATES$2.RUNNING&&this.removeClass(STATE_CLASS.ENTER),this.removeClass(STATE_CLASS.LOADING),this.isCanplay=!0,this.waitTimer&&util$2.clearTimeout(this,this.waitTimer)}},{key:"onPlay",value:function(){this.state===STATES$2.ENDED&&this.setState(STATES$2.RUNNING),this.removeClass(STATE_CLASS.PAUSED),this.ended&&this.removeClass(STATE_CLASS.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(STATE_CLASS.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this.userTimer&&(util$2.clearTimeout(this,this.userTimer),this.userTimer=null),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(STATE_CLASS.ENDED),this.setState(STATES$2.ENDED)}},{key:"onError",value:function(){this._isError=!0,this.updateAcc("error"),this.removeClass(STATE_CLASS.NOT_ALLOW_AUTOPLAY),this.removeClass(STATE_CLASS.NO_START),this.removeClass(STATE_CLASS.ENTER),this.removeClass(STATE_CLASS.LOADING),this.addClass(STATE_CLASS.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(STATE_CLASS.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&util$2.clearTimeout(this,this.waitTimer),this.removeClass(STATE_CLASS.LOADING),this.removeClass(STATE_CLASS.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&util$2.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=util$2.setTimeout(this,(function(){e.addClass(STATE_CLASS.LOADING),util$2.clearTimeout(e,e.waitTimer),e.waitTimer=null}),200)}},{key:"onPlaying",value:function(){var e=this;this._isError=!1,[STATE_CLASS.NO_START,STATE_CLASS.PAUSED,STATE_CLASS.ENDED,STATE_CLASS.ERROR,STATE_CLASS.REPLAY,STATE_CLASS.LOADING].forEach((function(t){e.removeClass(t)}))}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.resize(),(this.waitTimer||this.hasClass(STATE_CLASS.LOADING))&&this.video.readyState>2&&(this.removeClass(STATE_CLASS.LOADING),util$2.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state<STATES$2.RUNNING&&this.duration&&(this.setState(STATES$2.RUNNING),this.emit(AUTOPLAY_STARTED)),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onVolumechange",value:function(){"Number"===util$2.typeOf(this.config.volume)&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,t,r){if(this.video&&t&&e){var n="String"===util$2.typeOf(e)?e:e.type||"";r.props&&"Array"!==util$2.typeOf(r.props)&&(r.props=[r.props]),this.emit(USER_ACTION,_objectSpread2$b({eventType:n,action:t,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},r))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var t=(new Date).getTime()-this._accPlayed.t;this._accPlayed.acc+=t,this._accPlayed.t=0,("ended"===e||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var t=this.video.buffered;if(!t||0===t.length||!this.duration)return!0;for(var r=e||this.video.currentTime||.2,n=t.length,i=0;i<n;i++)if(t.start(i)<=r&&t.end(i)>r)return!0;return!1}},{key:"position",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{h:0,y:0,x:0,w:0};if(this.video&&e&&e.h){var t=1/e.h,r=1!==t?"scale(".concat(t,")"):"",n=0,i=0;e.y&&(i=(100-100*e.h)/2-100*e.y),e.w&&e.x&&(n=(100-100*e.w)/2-100*e.x),r+=" translate(".concat(n,"%, ").concat(i,"%)"),this.video.style.transform=r,this.video.style.webkitTransform=r}}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map((function(r){if("plugins"!==r){t.config[r]=e[r];var n=t.plugins[r.toLowerCase()];n&&"Function"===util$2.typeOf(n.setConfig)&&n.setConfig(e[r])}}))}},{key:"playNext",value:function(e){this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,this.play(),this.emit(PLAYNEXT,e)}},{key:"resize",value:function(){var e=this;if(this.video){var t=this.video,r=t.videoWidth,n=t.videoHeight,i=this.config,a=i.fitVideoSize,o=i.videoFillMode;if("fill"!==o&&"cover"!==o||this.setAttribute("data-xgfill",o),n&&r){this._videoHeight=n,this._videoWidth=r;var s=this.root.getBoundingClientRect(),l=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,u=s.width,c=s.height-l,d=parseInt(r/n*1e3,10),h=parseInt(u/c*1e3,10),f=u,p=c,y={};"auto"===a&&h>d||"fixWidth"===a?(p=u/d*1e3,this.config.fluid?y.paddingTop="".concat(100*p/f,"%"):y.height="".concat(p+l,"px")):("auto"===a&&h<d||"fixHeight"===a)&&(f=d*c/1e3,y.width="".concat(f,"px")),this.fullscreen||this.cssfullscreen||Object.keys(y).forEach((function(t){e.root.style[t]=y[t]})),("fillHeight"===o&&h<d||"fillWidth"===o&&h>d)&&this.setAttribute("data-xgfill","cover");var m={videoScale:d,vWidth:f,vHeight:p,cWidth:f,cHeight:p+l};this.emit(VIDEO_RESIZE,m)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.video.updateObjectPosition?this.video.updateObjectPosition(e,t):this.video.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%")}},{key:"setState",value:function(e){XG_DEBUG.logInfo("setState","state from:".concat(STATE_ARRAY[this.state]," to:").concat(STATE_ARRAY[e])),this._state=e}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){"boolean"==typeof e&&(this._hasStart=e,!1===e&&this.setState(STATES$2.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===STATES$2.RUNNING||this._state===STATES$2.ENDED},set:function(e){e?this.setState(STATES$2.RUNNING):this._state>=STATES$2.RUNNING&&this.setState(STATES$2.ATTACHED)}},{key:"definitionList",get:function(){return this.config.definition.list||[]},set:function(e){var t=this,r=this.config.definition,n=null,i=null;r.list=e,this.emit("resourceReady",e),e.forEach((function(e){var a;(null===(a=t.curDefinition)||void 0===a?void 0:a.definition)===e.definition&&(n=e),r.defaultDefinition===e.definition&&(i=e)})),!i&&e.length>0&&(i=e[0]),n?this.changeDefinition(n):i&&this.changeDefinition(i)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.video||!this.video.getVideoPlaybackQuality)return e;var t=this.video.getVideoPlaybackQuality();return e.dropped=t.droppedVideoFrames||0,e.total=t.totalVideoFrames||0,e.corrupted=t.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){0!==I18N.langKeys.filter((function(t){return t===e})).length||"zh"===e?(this.config.lang=e,pluginsManager.setLang(e,this)):console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(I18N.langKeys.join(),"] "))}},{key:"i18n",get:function(){var e=this.config.lang;return"zh"===e&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return version$5}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){var e=_get$3(_getPrototypeOf$f(r.prototype),"readyState",this);return this.i18n[e]||e}},{key:"error",get:function(){var e=_get$3(_getPrototypeOf$f(r.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){var e=_get$3(_getPrototypeOf$f(r.prototype),"networkState",this);return this.i18n[e]||e}},{key:"fullscreenChanging",get:function(){return!(null===this._fullScreenOffset)}},{key:"cumulateTime",get:function(){var e=this._accPlayed;return this.updateAcc("get"),e.acc}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"avgSpeed",get:function(){return AVG_SPEED},set:function(e){AVG_SPEED=e}},{key:"realTimeSpeed",get:function(){return REAL_TIME_SPEED},set:function(e){REAL_TIME_SPEED=e}},{key:"hook",value:function(e,t){return hook.call.apply(hook,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){return useHooks.call.apply(useHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){return removeHooks.call.apply(removeHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];return usePluginHooks.call.apply(usePluginHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,t,r){for(var n=arguments.length,i=new Array(n>3?n-3:0),a=3;a<n;a++)i[a-3]=arguments[a];return removePluginHooks.call.apply(removePluginHooks,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,t){"boolean"==typeof t&&t!==this.muted&&(this.addInnerOP("volumechange"),this.muted=t),pluginsManager.setCurrentUserActive(this.playerId,e)}}],[{key:"debugger",get:function(){return XG_DEBUG.config.debug},set:function(e){XG_DEBUG.config.debug=e}},{key:"getCurrentUserActivePlayerId",value:function(){return pluginsManager.getCurrentUseActiveId()}},{key:"setCurrentUserActive",value:function(e,t){pluginsManager.setCurrentUserActive(e,t)}},{key:"isHevcSupported",value:function(){return sniffer$1.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return sniffer$1.probeConfigSupported(e)}},{key:"install",value:function(e,t){r.plugins||(r.plugins={}),r.plugins[e]||(r.plugins[e]=t)}},{key:"use",value:function(e,t){r.plugins||(r.plugins={}),r.plugins[e]=t}}]),r}(VideoProxy);function now(){return(new Date).getTime()}_defineProperty$i(Player,"defaultPreset",null),_defineProperty$i(Player,"XgVideoProxy",null);var Xglogger=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"_onTimeupdate",(function(){e._state.isTimeUpdate=!0,e._state.autoplayStart&&(XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," _onTimeupdate")),e._sendFirstFrame())})),_defineProperty$i(_assertThisInitialized$f(e),"_onAutoplayStart",(function(){XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," _onAutoplayStart")),e._state.autoplayStart=!0,e._state.isTimeUpdate&&e._sendFirstFrame()})),_defineProperty$i(_assertThisInitialized$f(e),"_onReset",(function(){e._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1},e.vt=0,e.pt=0,e.fvt=0,e._isSeeking=!1,e.seekingStart=0,e.waitingStart=0,e._isWaiting=!1,e._waitTimer&&util$2.clearTimeout(_assertThisInitialized$f(e),e._waitTimer),e._waittTimer&&util$2.clearTimeout(_assertThisInitialized$f(e),e._waittTimer),e._waitTimer=null,e._waittTimer=null,e._waitType=0})),_defineProperty$i(_assertThisInitialized$f(e),"_onSeeking",(function(){e.seekingStart||(e.suspendWaitingStatus("seek"),e.seekingStart=now(),e.emitLog("seekStart",{start:now()}))})),_defineProperty$i(_assertThisInitialized$f(e),"_onSeeked",(function(){e.suspendSeekingStatus("seeked")})),_defineProperty$i(_assertThisInitialized$f(e),"_onWaitingLoadStart",(function(){e._isWaiting||e.vt||(e._isWaiting=!0,e.waitingStart=now(),e._waitType=1,e.emitLog("waitingStart",{start:e.waitingStart,type:1,endType:"loadstart"}))})),_defineProperty$i(_assertThisInitialized$f(e),"_onWaiting",(function(){!e._isWaiting&&e.vt&&(e._isWaiting=!0,e._waitTimer=util$2.setTimeout(_assertThisInitialized$f(e),(function(){e._isWaiting&&(e.waitingStart=now(),util$2.clearTimeout(_assertThisInitialized$f(e),e._waitTimer),e._waitTimer=null,e.vt?e.seekingStart?e._waitType=2:e._waitType=0:e._waitType=1,e._startWaitTimeout(),e.emitLog("waitingStart",{start:e.waitingStart,type:e._waitType,endType:2===e._waitType?"seek":"playing"}))}),200))})),_defineProperty$i(_assertThisInitialized$f(e),"_onError",(function(){e.suspendSeekingStatus("error"),e.suspendWaitingStatus("error")})),_defineProperty$i(_assertThisInitialized$f(e),"_onPlaying",(function(){e._isWaiting&&e.suspendWaitingStatus("playing")})),e}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.on(LOAD_START,(function(){var t=e._state,r=t.autoplayStart,n=t.isFFSend;XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(r," isFFSend:").concat(n)),n||(e._state.isTimeUpdate=!1,e._state.isFFLoading=!0,e.pt=now(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())})),this.on(LOADED_DATA,(function(){e.vt=now(),e.fvt=e.vt-e.pt,XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate)),e._state.isTimeUpdate&&e._sendFirstFrame(),e.suspendWaitingStatus("loadeddata")})),this.on(SEEKING,this._onSeeking),this.on(SEEKED,this._onSeeked),this.on(DESTROY,(function(){e.endState("destroy")})),this.on(URL_CHANGE,(function(){e.endState("urlChange"),XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._onReset()})),this.on([PLAYING,CANPLAY],this._onPlaying),this.on(WAITING,this._onWaiting),this.on(ERROR$3,this._onError),this.on(RESET,(function(){XG_DEBUG.logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()}))}},{key:"_initOnceEvents",value:function(){this.off(AUTOPLAY_STARTED,this._onAutoplayStart),this.off(TIME_UPDATE,this._onTimeupdate),this.once(AUTOPLAY_STARTED,this._onAutoplayStart),this.once(TIME_UPDATE,this._onTimeupdate)}},{key:"_sendFirstFrame",value:function(){this.s=now();var e=this._state,t=e.isFFLoading,r=e.isFFSend;XG_DEBUG.logInfo("[xgLogger]".concat(this.player.playerId," _sendFirstFrame"),"fvt:".concat(this.fvt," isFFLoading:").concat(t," !isFFSend:").concat(!r)),this.vt>0&&t&&!r&&(this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog("firstFrame",{fvt:this.fvt,costTime:this.fvt,vt:this.vt}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&util$2.clearTimeout(this,this._waittTimer),this._waittTimer=util$2.setTimeout(this,(function(){e.suspendWaitingStatus("timeout"),util$2.clearTimeout(e,e._waittTimer),e._waittTimer=null}),3e4)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var t=now(),r=t-this.seekingStart;this.seekingStart=0,this.emitLog("seekEnd",{end:t,costTime:r,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(util$2.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(util$2.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,this.waitingStart){var t=now()-this.waitingStart;this._isWaiting=!1,this.waitingStart=0,this.emitLog("waitingEnd",{costTime:t,type:this._waitType,endType:2===this._waitType?"seek":e})}}},{key:"emitLog",value:function(e,t){var r=this.player;this.emit(XGLOG,_objectSpread2$b({t:now(),host:util$2.getHostFromUrl(r.currentSrc),vtype:r.vtype,eventType:e,currentTime:this.player.currentTime,readyState:r.video.readyState,networkState:r.video.networkState},t))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{}}}]),r}(Plugin);function ReplaySvg(){return(new DOMParser).parseFromString('<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">\n  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Replay=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"registerIcons",value:function(){return{replay:ReplaySvg}}},{key:"afterCreate",value:function(){var e=this;Plugin.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",(function(){e.player.replay()}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(ENDED,(function(){if(e.playerConfig.loop||util$2.addClass(e.player.root,"replay"),!e.config.disable){e.show();var t=e.root.querySelector("path");if(t){var r=window.getComputedStyle(t).getPropertyValue("transform");if("string"==typeof r&&r.indexOf("none")>-1)return null;t.setAttribute("transform",r)}}})),this.on(PLAY,(function(){e.hide()}))}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),util$2.removeClass(this.player.root,"replay")}},{key:"show",value:function(){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return'<xg-replay class="xgplayer-replay">\n      <xg-replay-txt class="xgplayer-replay-txt" lang-key="'.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,"</xg-replay-txt>\n    </xg-replay>")}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),r}(Plugin),Poster=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){util$2.addClass(this.root,"hide")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){"string"==typeof e.player.config.poster&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(ENDED,(function(){e.isEndedShow&&util$2.removeClass(e.root,"hide")})),this.config.hideCanplay?(this.once(TIME_UPDATE,(function(){e.onTimeUpdate()})),this.on(URL_CHANGE,(function(){util$2.removeClass(e.root,"hide"),util$2.addClass(e.root,"xg-showplay"),e.once(TIME_UPDATE,(function(){e.onTimeUpdate()}))}))):this.on(PLAY,(function(){util$2.addClass(e.root,"hide")}))}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?util$2.removeClass(this.root,"xg-showplay"):this.once(TIME_UPDATE,(function(){e.onTimeUpdate()}))}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"render",value:function(){var e=this.config,t=e.poster,r=e.hideCanplay,n=t?"background-image:url(".concat(t,");"):"";return'<xg-poster class="xgplayer-poster '.concat(r?"xg-showplay":"",'" style="').concat(n,'">\n    </xg-poster>')}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,poster:""}}}]),r}(Plugin);function PlaySvg(){return(new DOMParser).parseFromString('<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n',"image/svg+xml").firstChild}function PauseSvg(){return(new DOMParser).parseFromString('<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n',"image/svg+xml").firstChild}var AnimateMap={};function addAnimate(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{start:null,end:null};AnimateMap[e]&&window.clearTimeout(AnimateMap[e].id),AnimateMap[e]={},r.start&&r.start(),AnimateMap[e].id=window.setTimeout((function(){r.end&&r.end(),window.clearTimeout(AnimateMap[e].id),delete AnimateMap[e]}),t)}function clearAnimation(){Object.keys(AnimateMap).map((function(e){window.clearTimeout(AnimateMap[e].id),delete AnimateMap[e]}))}var Start=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"onAutoplayStart",(function(){if(!n.autoPlayStart){var e="auto"===n.config.mode?"auto-hide":"hide";util$2.addClass(n.root,e),n.autoPlayStart=!0,n.onPlayPause("play")}})),n.autoPlayStart=!1,n}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this,t=this.player,r=this.playerConfig;this.initIcons(),this.once(READY,(function(){r&&(r.lang&&"en"===r.lang?util$2.addClass(t.root,"lang-is-en"):"jp"===r.lang&&util$2.addClass(t.root,"lang-is-jp"))})),this.on(AUTOPLAY_STARTED,this.onAutoplayStart),r.autoplay||this.show(),this.on(AUTOPLAY_PREVENTED,(function(){var t="auto"===e.config.mode?"auto-hide":"hide";e.setAttr("data-state","play"),util$2.removeClass(e.root,t),e.show()})),this.on(PLAY,(function(){e.onPlayPause("play")})),this.on(PAUSE,(function(){e.onPlayPause("pause")})),this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(t){t.cancelable&&t.preventDefault(),t.stopPropagation();var r=e.player.paused;e.emitUserAction(t,"switch_play_pause",{props:"paused",from:r,to:!r})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:PlaySvg,class:"xg-icon-play"},startPause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){util$2.addClass(this.root,"hide")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){util$2.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){util$2.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var t=this;addAnimate("pauseplay",400,{start:function(){util$2.addClass(t.root,"interact"),t.show(),t.switchStatus(!0)},end:function(){util$2.removeClass(t.root,"interact"),!e&&t.hide()}})}},{key:"switchPausePlay",value:function(e){var t=this.player;(e.cancelable&&e.preventDefault(),e.stopPropagation(),t.state<STATES$2.READY)||(this.player.paused||t.state!==STATES$2.RUNNING?t.play():t.pause())}},{key:"onPlayPause",value:function(e){var t=this.config,r=this.player;if(!(r.state<STATES$2.RUNNING)&&this.autoPlayStart){if("show"===t.mode)return this.switchStatus(),void this.show();if("auto"!==t.mode){if(t.isShowPause&&r.paused&&!r.ended||t.isShowEnd&&r.ended)return this.switchStatus(),void this.show();if(t.disableAnimate)return this.switchStatus(),void this.hide();if("play"===e)this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||r.ended)return;this.animate()}}else this.switchStatus()}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),clearAnimation()}},{key:"render",value:function(){var e=this.playerConfig.autoplay?"auto"===this.config.mode?"auto-hide":"hide":"";return'\n    <xg-start class="xgplayer-start '.concat(e,'">\n    <xg-start-inner></xg-start-inner>\n    </xg-start>')}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),r}(Plugin),Enter=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"render",value:function(){var e=this.config.innerHtml,t=util$2.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)t.appendChild(e);else if(e&&"string"==typeof e)t.innerHTML=e;else{for(var r="",n=1;n<=12;n++)r+='<div class="xgplayer-enter-bar'.concat(n,'"></div>');t.innerHTML='<div class="xgplayer-enter-spinner">'.concat(r,"</div>")}return t}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),r}(Plugin),MiniScreenIcon=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return'\n      <xg-icon class="xgplayer-miniicon">\n      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</span></div>\n      </xg-icon>")}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:10}}}]),r}(Plugin);function getStyleSize(e){var t=parseFloat(e);return-1===e.indexOf("%")&&!Number.isNaN(t)&&t}var measurements=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],measurementsLength=measurements.length;function getZeroSize(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<measurementsLength;t++){e[measurements[t]]=0}return e}function getStyle(e){return window.getComputedStyle(e)}function getSize(e){if("string"==typeof e&&(e=document.querySelector(e)),e&&"object"===_typeof$a(e)&&e.nodeType){var t=getStyle(e);if("none"===t.display)return getZeroSize();var r={};r.width=e.offsetWidth,r.height=e.offsetHeight;for(var n=r.isBorderBox="border-box"===t.boxSizing,i=0;i<measurementsLength;i++){var a=measurements[i],o=t[a],s=parseFloat(o);r[a]=Number.isNaN(s)?0:s}var l=r.paddingLeft+r.paddingRight,u=r.paddingTop+r.paddingBottom,c=r.marginLeft+r.marginRight,d=r.marginTop+r.marginBottom,h=r.borderLeftWidth+r.borderRightWidth,f=r.borderTopWidth+r.borderBottomWidth,p=n,y=getStyleSize(t.width);!1!==y&&(r.width=y+(p?0:l+h));var m=getStyleSize(t.height);return!1!==m&&(r.height=m+(p?0:u+f)),r.innerWidth=r.width-(l+h),r.innerHeight=r.height-(u+f),r.outerWidth=r.width+c,r.outerHeight=r.height+d,r}}function getTouch$1(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.identifier===t)return n}}var EVENTS$2={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},POST_START_EVENTS={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},Draggabilly=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck$i(this,r),(n=t.call(this)).isEnabled=!0,n.isDragging=!1,n.isDown=!1,n.position={},n.downPoint={},n.dragPoint={x:0,y:0},n.startPos={x:0,y:0},n._root=e instanceof Element?e:document.querySelector(e),n._handlerDom=i.handle instanceof Element?i.handle:document.querySelector(i.handle),n._root&&n._handlerDom?(n._bindStartEvent(),n):_possibleConstructorReturn$f(n)}return _createClass$j(r,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),POST_START_EVENTS[this._startKey].map((function(t){e["on".concat(t)]=e["on".concat(t)].bind(e)}))}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var t=this;if(e){var r=POST_START_EVENTS[this._startKey];r.map((function(e){window.addEventListener(e,t["on".concat(e)])})),this._boundPointerEvents=r}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map((function(t){window.removeEventListener(t,e["on".concat(t)])})),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame((function(){e.animate()})))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var t=e.changedTouches[0];this.dragStart(e,t),this.touchIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var t=getTouch$1(e.changedTouches,this.touchIdentifier);t&&this.dragMove(e,t)}},{key:"ontouchend",value:function(e){var t=getTouch$1(e.changedTouches,this.touchIdentifier);t&&this.dragEnd(e,t),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var t=getTouch$1(e.changedTouches,this.touchIdentifier);t&&this.dragCancel(e,t)}},{key:"dragStart",value:function(e,t){if(this._root&&!this.isDown&&this.isEnabled){this.downPoint=t,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var r=getSize(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-r.height,this.startPos.maxX=window.innerWidth-r.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,t){this.isDragging=!0,this.animate(),this.emit(EVENTS$2.START,this.startPos)}},{key:"dragEnd",value:function(e,t){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(EVENTS$2.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,t){var r={x:t.pageX-this.downPoint.pageX,y:t.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(r)&&this.dragRealStart(e,t),r}},{key:"dragMove",value:function(e,t){if(e=e||window.event,this.isDown){var r=this.startPos,n=r.x,i=r.y,a=this._dragPointerMove(e,t),o=a.x,s=a.y;o=this.checkContain("x",o,n),s=this.checkContain("y",s,i),this.position.x=n+o,this.position.y=i+s,this.dragPoint.x=o,this.dragPoint.y=s,this.emit(EVENTS$2.MOVE,this.position)}}},{key:"dragCancel",value:function(e,t){this.dragEnd(e,t)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,t,r){return t+r<0?0-r:"x"===e&&t+r>this.startPos.maxX?this.startPos.maxX-r:"y"===e&&t+r>this.startPos.maxY?this.startPos.maxY-r:t}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),t=this._getPositionCoord(e.left,"width"),r=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(t)?0:t,this.position.y=Number.isNaN(r)?0:r,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var t=e.transform;if(0===t.indexOf("matrix")){var r=t.split(","),n=0===t.indexOf("matrix3d")?12:4,i=parseInt(r[n],10),a=parseInt(r[n+1],10);this.position.x+=i,this.position.y+=a}}},{key:"_getPositionCoord",value:function(e,t){if(-1!==e.indexOf("%")){var r=getSize(this._root.parentNode);return r?parseFloat(e)/100*r[t]:0}return parseInt(e,10)}}]),r}(EventEmitter$1),MiniScreen=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;_classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"onCancelClick",(function(e){n.exitMini(),n.isClose=!0})),_defineProperty$i(_assertThisInitialized$f(n),"onCenterClick",(function(e){var t=_assertThisInitialized$f(n).player;t.paused?t.play():t.pause()})),_defineProperty$i(_assertThisInitialized$f(n),"onScroll",(function(e){if(!(!window.scrollY&&0!==window.scrollY||Math.abs(window.scrollY-n.pos.scrollY)<50)){var t=parseInt(util$2.getCss(n.player.root,"height"));t+=n.config.scrollTop,n.pos.scrollY=window.scrollY,window.scrollY>t+5?!n.isMini&&!n.isClose&&n.getMini():window.scrollY<=t&&(n.isMini&&n.exitMini(),n.isClose=!1)}})),n.isMini=!1,n.isClose=!1;var i=_assertThisInitialized$f(n).config;return n.pos={left:i.left<0?window.innerWidth-i.width-20:i.left,top:i.top<0?window.innerHeight-i.height-20:i.top,height:n.config.height,width:n.config.width,scrollY:window.scrollY||0},n.lastStyle=null,n}return _createClass$j(r,[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.mini&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(PAUSE,(function(){e.setAttr("data-state","pause")})),this.on(PLAY,(function(){e.setAttr("data-state","play")}))}},{key:"onPluginsReady",value:function(){var e=this,t=this.player;if(!this.config.disable){if(this.config.isShowIcon){var r={config:{onClick:function(){e.getMini()}}};t.controls.registerPlugin(MiniScreenIcon,r,MiniScreenIcon.pluginName)}var n=util$2.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",n,this.onCancelClick),this.bind(".play-icon",n,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new Draggabilly(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:PlaySvg,class:"xg-icon-play"},pause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var t=this.player,r=this.playerConfig,n=this.config.target||this.player.root;this.lastStyle={},util$2.addClass(t.root,"xgplayer-mini"),["width","height","top","left"].map((function(t){e.lastStyle[t]=n.style[t],n.style[t]="".concat(e.pos[t],"px")})),r.fluid&&(n.style["padding-top"]=""),this.emit(MINI_STATE_CHANGE,!0),t.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var t=this.player,r=this.playerConfig,n=this.config.target||this.player.root;util$2.removeClass(t.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map((function(t){n.style[t]=e.lastStyle[t]})),this.lastStyle=null,r.fluid&&(t.root.style.width="100%",t.root.style.height="0",t.root.style["padding-top"]="".concat(100*r.height/r.width,"%")),this.emit(MINI_STATE_CHANGE,!1),this.isMini=t.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=util$2.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return'\n      <xg-mini-layer class="xg-mini-layer">\n      <xg-mini-header class="xgplayer-mini-header">\n      <div lang-key="'.concat(this.i18nKeys.MINI_DRAG,'">').concat(this.i18n.MINI_DRAG,'</div>\n      </xg-mini-header>\n      <div class="mini-cancel-btn">\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>\n        </svg>\n      </div>\n      <div class="play-icon">\n      </div>\n      </xg-mini-layer>')}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),r}(Plugin),MOUSE_EVENTS={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},HOOKS=["videoClick","videoDbClick"],PCPlugin=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"onMouseMove",(function(t){var r=_assertThisInitialized$f(e),n=r.player,i=r.playerConfig;n.isActive||(n.focus({autoHide:!i.closeDelayBlur}),!i.closeFocusVideoFocus&&n.video.focus())})),_defineProperty$i(_assertThisInitialized$f(e),"onMouseEnter",(function(t){var r=_assertThisInitialized$f(e),n=r.playerConfig,i=r.player;!n.closeFocusVideoFocus&&i.video.focus(),n.closeDelayBlur?i.focus({autoHide:!1}):i.focus()})),_defineProperty$i(_assertThisInitialized$f(e),"onMouseLeave",(function(t){var r=e.playerConfig,n=r.closePlayerBlur,i=r.leavePlayerTime,a=r.closeDelayBlur;n||a||(i?e.player.focus({autoHide:!0,delay:i}):e.player.blur())})),_defineProperty$i(_assertThisInitialized$f(e),"onVideoClick",(function(t){var r=_assertThisInitialized$f(e),n=r.player,i=r.playerConfig;t.target&&i.closeVideoClick||t.target!==n.video&&t.target!==n.innerContainer&&t.target!==n.video.__canvas||(t.preventDefault(),i.closeVideoStopPropagation||t.stopPropagation(),e._clickCount++,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),e.clickTimer=setTimeout((function(){e._clickCount&&(e._clickCount--,runHooks(_assertThisInitialized$f(e),HOOKS[0],(function(t,r){e.switchPlayPause(r.e)}),{e:t,paused:n.paused}),clearTimeout(e.clickTimer),e.clickTimer=null)}),300))})),_defineProperty$i(_assertThisInitialized$f(e),"onVideoDblClick",(function(t){var r=_assertThisInitialized$f(e),n=r.player,i=r.playerConfig;!t.target||t.target!==n.video&&t.target!==n.video.__canvas||(e._clickCount<2?e._clickCount=0:(e._clickCount=0,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),t.preventDefault(),t.stopPropagation(),i.closeVideoDblclick||runHooks(_assertThisInitialized$f(e),HOOKS[1],(function(t,r){e.emitUserAction(r.e,"switch_fullscreen",{props:"fullscreen",from:n.fullscreen,to:!n.fullscreen}),n.fullscreen?n.exitFullscreen():n.getFullscreen()}),{e:t,fullscreen:n.fullscreen})))})),e}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,HOOKS.map((function(t){e.__hooks[t]=null}));var t=this.playerConfig,r=t.enableContextmenu;"mobile"===t.isMobileSimulateMode||"mobile"===sniffer$1.device&&!sniffer$1.os.isIpad||(this.config.disableContextmenu=!r,this.initEvents())}},{key:"initEvents",value:function(){var e=this,t=this.player,r=t.video,n=t.root;r&&r.addEventListener("click",this.onVideoClick,!1),r&&r.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(MOUSE_EVENTS).map((function(t){n.addEventListener(t,e[MOUSE_EVENTS[t]],!1)})),this.config.disableContextmenu&&r&&r.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var t=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:t.paused,to:!t.paused}),t.ended?t.duration!==1/0&&t.duration>0&&t.replay():t.paused?t.play():t.pause()}},{key:"onContextmenu",value:function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,t=this.player,r=t.video,n=t.root;this.clickTimer&&clearTimeout(this.clickTimer),r.removeEventListener("click",this.onVideoClick,!1),r.removeEventListener("dblclick",this.onVideoDblClick,!1),r.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(MOUSE_EVENTS).map((function(t){n.removeEventListener(t,e[MOUSE_EVENTS[t]],!1)}))}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{disableContextmenu:!0}}}]),r}(BasePlugin),toIntegerOrInfinity$p=toIntegerOrInfinity$v,toString$D=toString$O,requireObjectCoercible$h=requireObjectCoercible$p,$RangeError$d=RangeError,stringRepeat$1=function(e){var t=toString$D(requireObjectCoercible$h(this)),r="",n=toIntegerOrInfinity$p(e);if(n<0||n==1/0)throw $RangeError$d("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},$$1Y=_export$1,uncurryThis$1o=functionUncurryThis$1,toIntegerOrInfinity$o=toIntegerOrInfinity$v,thisNumberValue$3=thisNumberValue$5,$repeat$3=stringRepeat$1,fails$1n=fails$1Q,$RangeError$c=RangeError,$String$5=String,floor$g=Math.floor,repeat$5=uncurryThis$1o($repeat$3),stringSlice$i=uncurryThis$1o("".slice),nativeToFixed$1=uncurryThis$1o(1..toFixed),pow$7=function e(t,r,n){return 0===r?n:r%2==1?e(t,r-1,n*t):e(t*t,r/2,n)},log$7=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t},multiply$1=function(e,t,r){for(var n=-1,i=r;++n<6;)i+=t*e[n],e[n]=i%1e7,i=floor$g(i/1e7)},divide$1=function(e,t){for(var r=6,n=0;--r>=0;)n+=e[r],e[r]=floor$g(n/t),n=n%t*1e7},dataToString$1=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var n=$String$5(e[t]);r=""===r?n:r+repeat$5("0",7-n.length)+n}return r},FORCED$p=fails$1n((function(){return"0.000"!==nativeToFixed$1(8e-5,3)||"1"!==nativeToFixed$1(.9,0)||"1.25"!==nativeToFixed$1(1.255,2)||"1000000000000000128"!==nativeToFixed$1(0xde0b6b3a7640080,0)}))||!fails$1n((function(){nativeToFixed$1({})}));$$1Y({target:"Number",proto:!0,forced:FORCED$p},{toFixed:function(e){var t,r,n,i,a=thisNumberValue$3(this),o=toIntegerOrInfinity$o(e),s=[0,0,0,0,0,0],l="",u="0";if(o<0||o>20)throw $RangeError$c("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return $String$5(a);if(a<0&&(l="-",a=-a),a>1e-21)if(r=(t=log$7(a*pow$7(2,69,1))-69)<0?a*pow$7(2,-t,1):a/pow$7(2,t,1),r*=4503599627370496,(t=52-t)>0){for(multiply$1(s,0,r),n=o;n>=7;)multiply$1(s,1e7,0),n-=7;for(multiply$1(s,pow$7(10,n,1),0),n=t-1;n>=23;)divide$1(s,1<<23),n-=23;divide$1(s,1<<n),multiply$1(s,1,1),divide$1(s,2),u=dataToString$1(s)}else multiply$1(s,0,r),multiply$1(s,1<<-t,0),u=dataToString$1(s)+repeat$5("0",o);return u=o>0?l+((i=u.length)<=o?"0."+repeat$5("0",o-i)+u:stringSlice$i(u,0,i-o)+"."+stringSlice$i(u,i-o)):l+u}});var EVENTS$1={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},TOUCHS={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},MOUSES={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function getTouch(e){return e&&e.length>0?e[e.length-1]:null}function preventToucheDefault(e){var t=navigator.userAgent;/(?:iPhone|iPad)/.test(t)&&e.cancelable&&e.preventDefault()}function getDefaultConfig(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var Touche=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eventType:"touch"};_classCallCheck$i(this,e),this._pos={moving:!1,start:!1,x:0,y:0},this.config=getDefaultConfig(),Object.keys(n).map((function(e){r.config[e]=n[e]})),this.root=t,this.events="mouse"===n.eventType?MOUSES:TOUCHS,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return _createClass$j(e,[{key:"_initEvent",value:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(e){var t=this,r=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout((function(){t.trigger(EVENTS$1.PRESS,e),t._pos.press=!0,t.__clearPress()}),r.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(e){var t=this,r=this.config;if(this.dbIntrvalId)return this.__clearDb(),void this.trigger(EVENTS$1.DOUBlE_CLICK,e);this.dbIntrvalId=setTimeout((function(){t.__clearDb(),t._pos.start||t._pos.press||t._pos.moving||t.trigger(EVENTS$1.CLICK,e)}),r.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(e,t){this.__handlers[e]||(this.__handlers[e]=[]),this.__handlers[e].push(t)}},{key:"off",value:function(e,t){if(this.__handlers[e]){for(var r=this.__handlers[e],n=-1,i=0;i<r.length;i++)if(r[i]===t){n=i;break}n>=0&&this.__handlers[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.__handlers[e]&&this.__handlers[e].map((function(r){try{r(t)}catch(error){console.error("trigger>>:".concat(e),error)}}))}},{key:"onTouchStart",value:function(e){var t=this._pos,r=this.root;this.config.needPreventDefault&&preventToucheDefault(e);var n=getTouch(e.touches);t.x=n?parseInt(n.pageX,10):e.pageX,t.y=n?parseInt(n.pageX,10):e.pageX,t.start=!0,this.__setPress(e),r.addEventListener(this.events.end,this.onTouchEnd),r.addEventListener(this.events.cancel,this.onTouchCancel),r.addEventListener(this.events.move,this.onTouchMove),this.trigger(EVENTS$1.TOUCH_START,e)}},{key:"onTouchCancel",value:function(e){this.onTouchEnd(e)}},{key:"onTouchEnd",value:function(e){var t=this._pos,r=this.root;this.config.needPreventDefault&&preventToucheDefault(e),this.__clearPress(),r.removeEventListener(this.events.cancel,this.onTouchCancel),r.removeEventListener(this.events.end,this.onTouchEnd),r.removeEventListener(this.events.move,this.onTouchMove),e.moving=t.moving,e.press=t.press,t.press&&this.trigger(EVENTS$1.PRESS_END,e),this.trigger(EVENTS$1.TOUCH_END,e),!t.press&&!t.moving&&this.__setDb(e),t.press=!1,t.start=!1,t.moving=!1}},{key:"onTouchMove",value:function(e){var t=this._pos,r=this.config,n=getTouch(e.touches),i=n?parseInt(n.pageX,10):e.pageX,a=n?parseInt(n.pageY,10):e.pageX,o=i-t.x,s=a-t.y;Math.abs(s)<r.miniStep&&Math.abs(o)<r.miniStep||(this.__clearPress(),t.press&&this.trigger(EVENTS$1.PRESS_END,e),t.press=!1,t.moving=!0,this.trigger(EVENTS$1.TOUCH_MOVE,e))}},{key:"destroy",value:function(){var e=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).map((function(r){e.root.removeEventListener("touchend",e[t[r]])}))}}]),e}();function SeekTipIcon(){return(new DOMParser).parseFromString('<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"\n  xmlns:xlink="http://www.w3.org/1999/xlink">\n  <path opacity="0.54"\n    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"\n    fill="white" />\n  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}var ACTIONS={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},MobilePlugin=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"onTouchStart",(function(e){var t=_assertThisInitialized$f(n),r=t.player,i=t.config,a=t.pos,o=t.playerConfig,s=n.getTouche(e);if(s&&!i.disableGesture&&n.duration>0&&!r.ended){a.isStart=!0,util$2.checkIsFunction(o.disableSwipeHandler)&&o.disableSwipeHandler(),n.find(".xg-dur").innerHTML=util$2.format(n.duration);var l=n.root.getBoundingClientRect();90===r.rotateDeg?(a.top=l.left,a.left=l.top,a.width=l.height,a.height=l.width):(a.top=l.top,a.left=l.left,a.width=l.width,a.height=l.height);var u=parseInt(s.pageX-a.left,10),c=parseInt(s.pageY-a.top,10);a.x=90===r.rotateDeg?c:u,a.y=90===r.rotateDeg?u:c,a.scopeL=i.scopeL*a.width,a.scopeR=(1-i.scopeR)*a.width,a.scopeM1=a.width*(1-i.scopeM)/2,a.scopeM2=a.width-a.scopeM1}})),_defineProperty$i(_assertThisInitialized$f(n),"onTouchMove",(function(e){var t=n.getTouche(e),r=_assertThisInitialized$f(n),i=r.pos,a=r.config,o=r.player;if(t&&!a.disableGesture&&n.duration&&i.isStart){var s=a.miniMoveStep,l=a.hideControlsActive,u=parseInt(t.pageX-i.left,10),c=parseInt(t.pageY-i.top,10),d=90===o.rotateDeg?c:u,h=90===o.rotateDeg?u:c;if(Math.abs(d-i.x)>s||Math.abs(h-i.y)>s){var f=d-i.x,p=h-i.y,y=i.scope;if(-1===y&&(0===(y=n.checkScope(d,h,f,p,i))&&(l?o.blur():o.focus({autoHide:!1}),!i.time&&(i.time=parseInt(1e3*o.currentTime,10)+1e3*n.timeOffset)),i.scope=y),-1===y||y>0&&!a.gestureY||0===y&&!a.gestureX)return;e.cancelable&&e.preventDefault(),n.executeMove(f,p,y,i.width,i.height),i.x=d,i.y=h}}})),_defineProperty$i(_assertThisInitialized$f(n),"onTouchEnd",(function(e){var t=_assertThisInitialized$f(n),r=t.player,i=t.pos,a=t.playerConfig;i.isStart&&(i.scope>-1&&e.cancelable&&e.preventDefault(),n.endLastMove(i.scope),setTimeout((function(){r.getPlugin("progress")&&r.getPlugin("progress").resetSeekState()}),10),i.scope=-1,n.resetPos(),util$2.checkIsFunction(a.enableSwipeHandler)&&a.enableSwipeHandler(),n.changeAction(ACTIONS.AUTO))})),_defineProperty$i(_assertThisInitialized$f(n),"onRootTouchMove",(function(e){!n.config.disableGesture&&n.config.gestureX&&n.checkIsRootTarget(e)&&(e.stopPropagation(),n.pos.isStart?n.onTouchMove(e):n.onTouchStart(e))})),_defineProperty$i(_assertThisInitialized$f(n),"onRootTouchEnd",(function(e){n.pos.isStart&&n.checkIsRootTarget(e)&&(e.stopPropagation(),n.onTouchEnd(e))})),n.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},n.timer=null,n}return _createClass$j(r,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:SeekTipIcon,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this,t=this.playerConfig,r=this.config,n=this.player;!0===t.closeVideoDblclick&&(r.closedbClick=!0),this.resetPos(),util$2.isUndefined(t.disableGesture)||(r.disableGesture=!!t.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=util$2.createDom("xg-mask","",{},"xgmask"),n.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var i=this.domEventType;this.touch=new Touche(this.root,{eventType:i,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",(function(e){e.preventDefault()})),n.root.addEventListener("touchmove",this.onRootTouchMove,!0),n.root.addEventListener("touchend",this.onRootTouchEnd,!0),this.on(DURATION_CHANGE,(function(){var t=e.player,r=e.config;1e3*t.duration<r.moveDuration&&(r.moveDuration=1e3*t.duration)})),this.on([CANPLAY,ENDED],(function(){var t=e.pos,r=t.time;!t.isStart&&r>0&&(e.pos.time=0)}));var a={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(a).map((function(t){e.touch.on(t,(function(r){e[a[t]](r)}))})),!r.disableActive){var o=n.plugins.progress;o&&(o.addCallBack("dragmove",(function(t){e.activeSeekNote(t.currentTime,t.forward)})),o.addCallBack("dragend",(function(){e.changeAction(ACTIONS.AUTO)})))}}},{key:"registerThumbnail",value:function(){var e=this.player.plugins.thumbnail;if(e&&e.usable){this.thumbnail=e.createThumbnail(null,"mobile-thumbnail");var t=this.find(".time-preview");t.insertBefore(this.thumbnail,t.children[0])}}},{key:"initCustomStyle",value:function(){var e=(this.playerConfig||{}).commonStyle,t=e.playedColor,r=e.progressColor;t&&(this.find(".xg-curbar").style.backgroundColor=t,this.find(".xg-cur").style.color=t),r&&(this.find(".xg-bar").style.backgroundColor=r,this.find(".time-preview").style.color=r),this.config.disableTimeProgress&&util$2.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map((function(t){e.pos[t]=0}))):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var t=this.player;this.root.setAttribute("data-xg-action",e);var r=t.plugins.start;r&&r.recover()}},{key:"getTouche",value:function(e){this.player.rotateDeg;var t=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return{pageX:t.pageX,pageY:t.pageY}}},{key:"checkScope",value:function(e,t,r,n,i){var a=i.width,o=-1;if(e<0||e>a)return o;var s=0===n?Math.abs(r):Math.abs(r/n);return Math.abs(r)>0&&s>=1.73&&e>i.scopeM1&&e<i.scopeM2?o=0:(0===Math.abs(r)||s<=.57)&&(o=e<i.scopeL?1:e>i.scopeR?2:3),o}},{key:"executeMove",value:function(e,t,r,n,i){switch(r){case 0:this.updateTime(e/n*this.config.scopeM);break;case 1:this.updateBrightness(t/i);break;case 2:sniffer$1.os.isIos||this.updateVolume(t/i)}}},{key:"endLastMove",value:function(e){var t=this,r=this.pos,n=this.player,i=this.config,a=(r.time-this.timeOffset)/1e3;if(0===e)n.seek(Number(a).toFixed(1)),i.hideControlsEnd?n.blur():n.focus(),this.timer=setTimeout((function(){t.pos.time=0}),500);this.changeAction(ACTIONS.AUTO)}},{key:"checkIsRootTarget",value:function(e){var t=this.player.plugins||{};return(!t.progress||!t.progress.root.contains(e.target))&&(t.start&&t.start.root.contains(e.target)||t.controls&&t.controls.root.contains(e.target))}},{key:"sendUseAction",value:function(e){var t=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t,to:!t})}},{key:"onClick",value:function(e){var t=this.player,r=this.config,n=this.playerConfig;t.state<STATES$2.RUNNING?n.closeVideoClick||(this.sendUseAction(new Event("click")),t.play()):!r.closedbClick||n.closeVideoClick?t.isActive?t.blur():t.focus():n.closeVideoClick||((t.isActive||r.focusVideoClick)&&(this.emitUserAction("click","switch_play_pause"),this.switchPlayPause()),t.focus())}},{key:"onDbClick",value:function(e){var t=this.config,r=this.player;!t.closedbClick&&r.state>=STATES$2.RUNNING&&(this.sendUseAction(new Event("dblclick")),this.switchPlayPause())}},{key:"onPress",value:function(e){var t=this.pos,r=this.config,n=this.player;r.disablePress||(t.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:n.playbackRate,to:r.pressRate}),n.playbackRate=r.pressRate,this.changeAction(ACTIONS.PLAYBACK))}},{key:"onPressEnd",value:function(e){var t=this.pos,r=this.config,n=this.player;r.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:n.playbackRate,to:t.rate}),n.playbackRate=t.rate,t.rate=1,this.changeAction(ACTIONS.AUTO))}},{key:"updateTime",value:function(e){var t=this.player,r=this.config,n=this.player.duration;e=Number(e.toFixed(4));var i=parseInt(e*r.moveDuration,10)+this.timeOffset;i=(i+=this.pos.time)<0?0:i>1e3*n?1e3*n-200:i,t.getPlugin("time")&&t.getPlugin("time").updateTime(i/1e3),t.getPlugin("progress")&&t.getPlugin("progress").updatePercent(i/1e3/this.duration,!0),this.activeSeekNote(i/1e3,e>0),r.isTouchingSeek&&t.seek(Number((i-this.timeOffset)/1e3).toFixed(1)),this.pos.time=i}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var t=this.player,r=this.pos;if(e=parseInt(100*e,10),r.volume+=e,!(Math.abs(r.volume)<10)){var n=parseInt(10*t.volume,10)-parseInt(r.volume/10,10);n=n>10?10:n<1?0:n,t.volume=n/10,r.volume=0}}},{key:"updateBrightness",value:function(e){this.player.rotateDeg&&(e=-e);var t=this.pos,r=this.config,n=this.xgMask,i=t.light+.8*e;i=i>r.maxDarkness?r.maxDarkness:i<0?0:i,n&&(n.style.backgroundColor="rgba(0,0,0,".concat(i,")")),t.light=i}},{key:"activeSeekNote",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.player,n=this.config,i=!(this.duration!==1/0&&this.duration>0);if(e&&"number"==typeof e&&!i&&!n.disableActive){e<0?e=0:e>r.duration&&(e=r.duration-.2),this.changeAction(ACTIONS.SEEKING);var a=r.plugins.start;a&&a.focusHide(),this.find(".xg-dur").innerHTML=util$2.format(this.duration),this.find(".xg-cur").innerHTML=util$2.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),t?util$2.removeClass(this.find(".xg-seek-show"),"xg-back"):util$2.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var t=this.player.plugins.thumbnail;t&&t.usable&&this.thumbnail&&t.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<STATES$2.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!1}},{key:"enableGesture",value:function(){this.config.disableGesture=!0}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0)}},{key:"render",value:function(){var e="normal"!==this.config.gradient?"gradient ".concat(this.config.gradient):"gradient";return'\n     <xg-trigger class="trigger">\n     <div class="'.concat(e,'"></div>\n        <div class="time-preview">\n            <div class="xg-seek-show ').concat(this.config.disableSeekIcon?" hide-seek-icon":"",'">\n              <i class="xg-seek-icon"></i>\n              <span class="xg-cur">00:00</span>\n              <span>/</span>\n              <span class="xg-dur">00:00</span>\n            </div>\n              <div class="xg-bar xg-timebar">\n                <div class="xg-curbar"></div>\n              </div>\n        </div>\n        <div class="xg-playbackrate xg-top-note">\n            <span><i>').concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,"</span>\n        </div>\n     </xg-trigger>\n    ")}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:36e4,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),r}(Plugin);function preventDefault(e){e.preventDefault(),e.returnValue=!1}function isDisableTag(e){var t=e.tagName;return!("INPUT"!==t&&"TEXTAREA"!==t&&!e.isContentEditable)}var Keyboard=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"onBodyKeyDown",(function(t){var r=t||window.event;if(e.player&&(e.player.isUserActive||e.config.isIgnoreUserActive)&&!(e.config.disable||e.config.disableBodyTrigger||!e.checkIsVisible()||r.metaKey||r.altKey||r.ctrlKey)){var n=r.keyCode;return!(r.target!==document.body&&(!e.config.isGlobalTrigger||isDisableTag(r.target))||!e.checkCode(n,!0))&&(preventDefault(r),e.handleKeyCode(n,t),!1)}})),_defineProperty$i(_assertThisInitialized$f(e),"onKeydown",(function(t){var r=t||window.event;if(!(e.config.disable||e.config.disableRootTrigger||r.metaKey||r.altKey||r.ctrlKey)&&(e.player.isUserActive||e.config.isIgnoreUserActive)&&(e.player.isUserActive||e.config.isIgnoreUserActive)){if(!r||37!==r.keyCode&&!e.checkCode(r.keyCode)||r.target!==e.player.root&&r.target!==e.player.video&&r.target!==e.player.controls.el)return!0;preventDefault(r),e.handleKeyCode(r.keyCode,t)}})),e}return _createClass$j(r,[{key:"mergekeyCodeMap",value:function(){var e=this,t=this.config.keyCodeMap;t&&Object.keys(t).map((function(r){e.keyCodeMap[r]?["keyCode","action","disable","isBodyTarget"].map((function(n){t[r][n]&&(e.keyCodeMap[r][n]=t[r][n])})):e.keyCodeMap[r]=t[r]}))}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e="function"==typeof this.config.seekStep?this.config.seekStep(this.player):this.config.seekStep;e&&"number"==typeof e&&(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disable:!1},right:{keyCode:39,action:"seek",disable:!1},esc:{keyCode:27,action:"exitFullscreen",disable:!1}},this.mergekeyCodeMap(),this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),t=e.height,r=e.top,n=e.bottom,i=window.innerHeight;return!(r<0&&r<0-.9*t||n>0&&n-i>.9*t)}},{key:"checkCode",value:function(e,t){var r=this,n=!1;return Object.keys(this.keyCodeMap).map((function(i){r.keyCodeMap[i]&&e===r.keyCodeMap[i].keyCode&&!r.keyCodeMap[i].disable&&(n=!t||t&&!r.keyCodeMap[i].noBodyTarget)})),n}},{key:"downVolume",value:function(e){var t=this.player,r=parseFloat((t.volume-.1).toFixed(1)),n={volume:{from:t.volume,to:r}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=r>=0?r:0}},{key:"upVolume",value:function(e){var t=this.player,r=parseFloat((t.volume+.1).toFixed(1)),n={volume:{from:t.volume,to:r}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=r<=1?r:1}},{key:"seek",value:function(e){var t=this.player,r=t.currentTime,n=t.duration,i=r,a={currentTime:{from:r,to:i=r+this.seekStep<=n?r+this.seekStep:n-1}};this.emitUserAction(e,"seek",{props:a}),this.player.currentTime=i}},{key:"seekBack",value:function(e){var t=this.player.currentTime,r=0;t-this.seekStep>=0&&(r=t-this.seekStep);var n={currentTime:{from:t,to:r}};this.emitUserAction(e,"seek",{props:n}),this.player.currentTime=r}},{key:"playPause",value:function(e){var t=this.player;t&&(this.emitUserAction(e,"switch_play_pause"),t.paused?t.play():t.pause())}},{key:"exitFullscreen",value:function(e){var t=this.player,r=t.fullscreen,n=t.cssfullscreen;r&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:r,to:!r}),t.exitFullscreen()),n&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:n,to:!n}),t.exitCssFullscreen())}},{key:"handleKeyCode",value:function(e,t){var r=this;Object.keys(this.keyCodeMap).map((function(n){var i=r.keyCodeMap[n],a=i.action,o=i.keyCode,s=i.disable;o!==e||s||("function"==typeof a?a(t,r.player):"string"==typeof a&&"function"==typeof r[a]&&r[a](t,r.player),r.emit(SHORTCUT,_objectSpread2$b({key:n,target:t.target},r.keyCodeMap[n])))}))}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!0,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!1,keyCodeMap:{},disable:!1,isIgnoreUserActive:!1}}}]),r}(BasePlugin);function loadingIcon(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">\n  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>\n</svg>\n',"image/svg+xml").firstChild}var Loading=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"registerIcons",value:function(){return{loadingIcon:loadingIcon}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return'\n    <xg-loading class="xgplayer-loading">\n      <xg-loading-inner></xg-loading-inner>\n    </xg-loading>'}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.ROOT}}}]),r}(Plugin),es_array_findIndex={},$$1X=_export$1,$findIndex$2=arrayIteration$1.findIndex,addToUnscopables$7=addToUnscopables$a,FIND_INDEX="findIndex",SKIPS_HOLES$1=!0;FIND_INDEX in[]&&Array(1)[FIND_INDEX]((function(){SKIPS_HOLES$1=!1})),$$1X({target:"Array",proto:!0,forced:SKIPS_HOLES$1},{findIndex:function(e){return $findIndex$2(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$7(FIND_INDEX);var TPL=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],InnerList=function(){function e(t){_classCallCheck$i(this,e),this.fragments=t.fragments||[],this.focusClass="inner-focus",this.style=t.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0}return _createClass$j(e,[{key:"updateDuration",value:function(e){var t=this;this.duration=parseInt(1e3*e);var r=0,n=this.fragments;this.fragments=n.map((function(e){return e.start=r,e.end=r+e.percent*t.duration,e.duration=e.percent*t.duration,r+=e.percent*t.duration,e}))}},{key:"updateProgress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},r=this.progressList,n=this.fragments,i=t.newIndex,a=t.curIndex,o=t.millisecond;i!==a&&r.map((function(t,r){r<i?t[e].style.width="100%":r>i&&(t[e].style.width=0)}));var s=n[i],l=0===o?0:(o-s.start)/s.duration;r[i][e].style.width=l<0?0:"".concat(100*l,"%")}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(1e3*t,10)!==this.duration){if(!t&&0!==t)return;this.updateDuration(t)}var r=this.playedIndex,n=this.cachedIndex;if("Undefined"!==util$2.typeOf(e.played)){var i=this.findIndex(1e3*e.played,r);this.updateProgress("played",{newIndex:i,curIndex:r,millisecond:parseInt(1e3*e.played,10)}),this.playedIndex=i}if("Undefined"!==util$2.typeOf(e.cached)){var a=this.findIndex(1e3*e.cached,n);this.updateProgress("cached",{newIndex:a,curIndex:n,millisecond:parseInt(1e3*e.cached,10)}),this.cachedIndex=a}}},{key:"findIndex",value:function(e,t){var r=this.fragments;return 1===r.length?0:(e>r[t].start&&e<r[t].end||this.fragments.map((function(r,n){e>r.start&&e<=r.end&&(t=n)})),t)}},{key:"findHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)if(util$2.hasClass(e[t],this.focusClass))return{dom:e[t],pos:e[t].getBoundingClientRect()}}},{key:"findFragment",value:function(e){var t=this.root.children;return e<0||e>=t.length?null:{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)util$2.removeClass(e[t],this.focusClass)}},{key:"setHightLight",value:function(e){var t=this.root.children;if(e<t.length)return util$2.addClass(t[e],this.focusClass),{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"render",value:function(){var e=this,t=this.style.progressColor;return this.root=util$2.createDom("xg-inners","",{},"progress-list"),this.fragments&&(this.progressList=this.fragments.map((function(r){var n=util$2.createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(r.percent):"flex: ".concat(r.percent)},"".concat(r.isFocus?"inner-focus":""," xgplayer-progress-inner"));return e.root.appendChild(n),TPL.map((function(t){n.appendChild(util$2.createDom(t.tag,"",{style:t.styleKey?"background: ".concat(e.style[t.styleKey],"; width:0;"):"width:0;"},t.className))})),{cached:n.children[0],played:n.children[1]}}))),this.root}}]),e}(),Progress=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"onMoveOnly",(function(e){var t=_assertThisInitialized$f(n),r=t.pos,i=t.config,a=t.player;util$2.event(e);var o=util$2.getEventPos(e,a.zoom),s=90===a.rotateDeg?o.clientY:o.clientX;if(!(r.moving&&Math.abs(r.x-s)<i.miniMoveStep)){r.moving=!0,r.x=s;var l=n.computeTime(e);n.triggerCallbacks("dragmove",l,e)}})),_defineProperty$i(_assertThisInitialized$f(n),"onBodyClick",(function(e){e.preventDefault(),e.stopPropagation()})),_defineProperty$i(_assertThisInitialized$f(n),"_mouseDownHandler",(function(e,t){n._state.time=t.currentTime,n.updateWidth(t.currentTime,t.percent,0)})),_defineProperty$i(_assertThisInitialized$f(n),"_mouseUpHandler",(function(e,t){_assertThisInitialized$f(n).pos.moving&&n.updateWidth(t.currentTime,t.percent,2)})),_defineProperty$i(_assertThisInitialized$f(n),"_mouseMoveHandler",(function(e,t){var r=_assertThisInitialized$f(n),i=r._state,a=r.pos,o=r.config,s=r.player;i.time<t.currentTime?t.forward=!0:t.forward=!1,i.time=t.currentTime,a.isDown&&!a.moving&&(a.moving=!0,o.isPauseMoving&&s.pause(),n.triggerCallbacks("dragstart",t,e)),n.updateWidth(t.currentTime,t.percent,1),n.triggerCallbacks("dragmove",t,e)})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseDown",(function(e){var t=_assertThisInitialized$f(n),r=t.player,i=t.pos,a=t.config,o=t.playerConfig,s=util$2.getEventPos(e,r.zoom),l=90===r.rotateDeg?s.clientY:s.clientX;if(!(r.isMini||a.closeMoveSeek||!o.allowSeekAfterEnded&&r.ended)){e.stopPropagation(),n.focus(),util$2.checkIsFunction(o.disableSwipeHandler)&&o.disableSwipeHandler(),util$2.checkIsFunction(a.onMoveStart)&&a.onMoveStart(),util$2.event(e),i.x=l,i.isDown=!0,i.moving=!1,r.focus({autoHide:!1}),n.isProgressMoving=!0,util$2.addClass(n.progressBtn,"active");var u=n.computeTime(e);return n._mouseDownHandlerHook(e,u),"touch"===n.domEventType?(n.root.addEventListener("touchmove",n.onMouseMove),n.root.addEventListener("touchend",n.onMouseUp)):(n.unbind("mousemove",n.onMoveOnly),document.addEventListener("mousemove",n.onMouseMove,!1),document.addEventListener("mouseup",n.onMouseUp,!1),r.root.addEventListener("click",n.onBodyClick,!1)),!0}})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseUp",(function(e){var t=_assertThisInitialized$f(n),r=t.player,i=t.config,a=t.pos,o=t.playerConfig,s=t._state;e.stopPropagation(),e.preventDefault(),util$2.checkIsFunction(o.enableSwipeHandler)&&o.enableSwipeHandler(),util$2.checkIsFunction(i.onMoveEnd)&&i.onMoveEnd(),util$2.event(e),util$2.removeClass(n.progressBtn,"active");var l=n.computeTime(e);a.moving?n.triggerCallbacks("dragend",l,e):n.triggerCallbacks("click",l,e),n._mouseUpHandlerHook(e,l),a.moving=!1,a.isDown=!1,a.x=0,a.y=0,s.time=0,"touch"===n.domEventType?(n.root.removeEventListener("touchmove",n.onMouseMove),n.root.removeEventListener("touchend",n.onMouseUp),n.blur()):(document.removeEventListener("mousemove",n.onMouseMove,!1),document.removeEventListener("mouseup",n.onMouseUp,!1),r.root.removeEventListener("click",n.onBodyClick,!1),a.isEnter?"mobile"!==o.isMobileSimulateMode&&n.bind("mousemove",n.onMoveOnly):n.onMouseLeave(e)),util$2.setTimeout(_assertThisInitialized$f(n),(function(){n.resetSeekState()}),10),r.focus()})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseMove",(function(e){var t=_assertThisInitialized$f(n),r=t.pos,i=t.player,a=t.config;util$2.checkTouchSupport()&&e.preventDefault(),util$2.event(e);var o=util$2.getEventPos(e,i.zoom),s=90===i.rotateDeg?o.clientY:o.clientX,l=Math.abs(r.x-s);if(!(r.moving&&l<a.miniMoveStep||!r.moving&&l<a.miniStartStep)){r.x=s;var u=n.computeTime(e);n._mouseMoveHandlerHook(e,u)}})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseOut",(function(e){n.triggerCallbacks("mouseout",null,e)})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseOver",(function(e){n.triggerCallbacks("mouseover",null,e)})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseEnter",(function(e){var t=_assertThisInitialized$f(n),r=t.player,i=t.pos;n.triggerCallbacks("mouseenter",null,e),i.isDown||i.isEnter||r.isMini||!r.config.allowSeekAfterEnded&&r.ended||(i.isEnter=!0,n.bind("mousemove",n.onMoveOnly),n.bind("mouseleave",n.onMouseLeave),n.focus())})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseLeave",(function(e){n.triggerCallbacks("mouseleave",null,e);var t=_assertThisInitialized$f(n),r=t.player,i=t.pos;i.isEnter=!1,r.isMini||(n.unbind("mousemove",n.onMoveOnly),i.isDown?n.unbind("mouseleave",n.onMouseLeave):n.blur())})),n.useable=!1,n.isProgressMoving=!1,n.__dragCallBacks=[],n._state={now:-1,direc:0,time:0},n._disableBlur=!1,n}return _createClass$j(r,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"changeState",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.useable=e}},{key:"createInner",value:function(){var e=this;this.innerList=new InnerList({fragments:this.config.fragments,style:this.playerConfig.commonStyle||{}}),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map((function(t){e[t]=e.innerList[t].bind(e.innerList)}))}},{key:"afterCreate",value:function(){var e=this;this.config.disable||this.playerConfig.isLive||(this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1},this.outer=this.find("xg-outer"),this.createInner(),"mobile"===sniffer$1.device&&(this.config.isDragingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.on(DURATION_CHANGE,(function(){e.onMouseLeave()})),this.on(TIME_UPDATE,(function(){e.onTimeupdate()})),this.on(SEEKED,(function(){e.onTimeupdate(),e.onCacheUpdate()})),this.on(PROGRESS,(function(){e.onCacheUpdate()})),this.on(ENDED,(function(){e.onCacheUpdate(),e._state.now=0})),this.on(EMPTIED,(function(){e.onReset()})),this.bindDomEvents(),this.initCustomStyle())}},{key:"initCustomStyle",value:function(){var e=(this.playerConfig||{}).commonStyle.sliderBtnStyle,t=this.progressBtn;e&&("string"==typeof e?t.style.boxShadow=e:"object"===_typeof$a(e)&&Object.keys(e).map((function(r){t.style[r]=e[r]})))}},{key:"triggerCallbacks",value:function(e,t,r){this.__dragCallBacks.length>0&&this.__dragCallBacks.map((function(n){if(n&&n.handler&&n.type===e)try{n.handler(t,r)}catch(error){console.error("[XGPLAYER][triggerCallbacks] ".concat(n," error"),error)}}))}},{key:"addCallBack",value:function(e,t){t&&"function"==typeof t&&this.__dragCallBacks.push({type:e,handler:t})}},{key:"removeCallBack",value:function(e,t){var r=this.__dragCallBacks,n=-1;r.map((function(r,i){r&&r.type===e&&r.handler===t&&(n=i)})),n>-1&&r.splice(n,1)}},{key:"bindDomEvents",value:function(){var e=this.player,t=e.controls,r=e.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),"touch"===this.domEventType?(this.root.addEventListener("touchstart",this.onMouseDown),t&&(t.root&&t.root.addEventListener("touchmove",util$2.stopPropagation),t.center&&t.center.addEventListener("touchend",util$2.stopPropagation))):(this.bind("mousedown",this.onMouseDown),"mobile"!==r.isMobileSimulateMode&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut))}},{key:"focus",value:function(){util$2.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),util$2.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,t,r){var n=this.config,i=this.player;if(!n.isCloseClickSeek||0!==r){var a=e>=i.duration?i.duration-n.endedDiff:Number(e).toFixed(1);this.updatePercent(t),this.updateTime(e),(1!==r||n.isDragingSeek&&"audio"!==i.videoConfig.mediaType)&&(this._state.now=a,this._state.direc=a>i.currentTime?0:1,i.seek(a))}}},{key:"computeTime",value:function(e){var t,r,n,i=this.player,a=this.root.getBoundingClientRect(),o=a.width,s=a.height,l=a.top,u=a.left,c=util$2.getEventPos(e,i.zoom);90===i.rotateDeg?(t=s,r=l,n=c.clientY):(t=o,r=u,n=c.clientX);var d=n-r,h=(d=d>t?t:d<0?0:d)/t;return{percent:h=h<0?0:h>1?1:h,currentTime:parseInt(h*this.duration*1e3,10)/1e3,offset:d,width:t,left:r,e:e}}},{key:"updateTime",value:function(e){var t=this.player,r=this.duration;e>r?e=r:e<0&&(e=0);var n=t.plugins.time;n&&n.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,t){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(100*e,"%"),this.innerList.update({played:e*this.duration},this.duration);var r=this.player.plugins.miniprogress;r&&r.update({played:e*this.duration},this.duration)}}},{key:"onTimeupdate",value:function(){var e=this.player,t=this._state,r=this.duration;if(!(e.isSeeking||this.isProgressMoving||e.state<STATES$2.RUNNING)){if(t.now>-1){var n=parseInt(1e3*t.now,10)-parseInt(1e3*e.currentTime,10);if(0===t.direc&&n>300||1===t.direc&&n>-300)return void(t.now=-1);t.now=-1}var i=this.timeOffset+e.currentTime;this.innerList.update({played:i},r),this.progressBtn.style.left="".concat(i/r*100,"%");var a=this.player.plugins.miniprogress;a&&a.update({played:i},r)}}},{key:"onCacheUpdate",value:function(){var e=this.player,t=this.duration,r=e.bufferedPoint;this.innerList.update({cached:r.end},t);var n=this.player.plugins.miniprogress;n&&n.update({cached:r.end},t)}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0);var e=this.player.plugins.miniprogress;e&&e.update({cached:0,played:0},0)}},{key:"destroy",value:function(){var e=this.player,t=e.controls;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null,"touch"===this.domEventType?(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),t&&(t.root&&t.root.removeEventListener("touchmove",util$2.stopPropagation),t.center&&t.center.removeEventListener("touchend",util$2.stopPropagation))):(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!1))}},{key:"render",value:function(){if(!this.config.disable&&!this.playerConfig.isLive){var e=this.player.controls?this.player.controls.config.mode:"";return'\n    <xg-progress class="xgplayer-progress '.concat("bottom"===e?"xgplayer-progress-bottom":"",'">\n      <xg-outer class="xgplayer-progress-outer">\n        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n      </xg-outer>\n    </xg-progress>\n    ')}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}}]),r}(Plugin),Fullscreen$1=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"_onMouseenter",(function(t){e.emit("icon_mouseenter",{pluginName:e.pluginName})})),_defineProperty$i(_assertThisInitialized$f(e),"_onMouseLeave",(function(t){e.emit("icon_mouseleave",{pluginName:e.pluginName})})),e}return _createClass$j(r,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave)}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),r}(Plugin),Play=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this);var t=this.player;this.config.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.on(PAUSE,(function(){e.animate(t.paused)})),this.on(PLAY,(function(){e.animate(t.paused)})),this.animate(!0))}},{key:"registerIcons",value:function(){return{play:{icon:PlaySvg,class:"xg-icon-play"},pause:{icon:PauseSvg,class:"xg-icon-pause"}}}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player;return this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t.paused,to:!t.paused}),t.ended?t.replay():t.paused?(t.play(),this.animate(!1)):(t.pause(),this.animate(!0)),!1}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){var t=this.i18nKeys;e?(this.setAttr("data-state","pause"),this.changeLangTextKey(this.find(".xg-tips"),t.PLAY_TIPS)):(this.setAttr("data-state","play"),this.changeLangTextKey(this.find(".xg-tips"),t.PAUSE_TIPS))}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-play">\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys.PLAY_TIPS,'">').concat(this.i18n.PLAY_TIPS,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_LEFT,index:0,disable:!1}}}]),r}(Fullscreen$1);function BackSVG(){return(new DOMParser).parseFromString('<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>\n    </g>\n</svg>',"image/svg+xml").firstChild}var TopBackIcon=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(t){t.preventDefault(),t.stopPropagation(),e.config.onClick(t)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:BackSVG,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){util$2.addClass(this.root,"show")}},{key:"hide",value:function(){util$2.removeClass(this.root,"show")}},{key:"render",value:function(){return'<xg-icon class="xgplayer-back">\n    </xg-icon>'}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.ROOT_TOP,index:0}}}]),r}(Plugin);function FullScreenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ExitFullScreenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Fullscreen=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"_onOrientationChange",(function(t){e.player.fullscreen&&e.config.rotateFullscreen&&(90===window.orientation||-90===window.orientation?e.player.setRotateDeg(0):e.player.setRotateDeg(90))})),e}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this);var t=this.config,n=this.playerConfig;if(!t.disable){t.target&&(this.playerConfig.fullscreenTarget=this.config.target);var i=util$2.getFullScreenEl();n.fullscreenTarget===i&&this.player.getFullscreen(),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(t){var r=e.player.fullscreen;e.emitUserAction(t,"switch_fullscreen",{prop:"fullscreen",from:r,to:!r})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(FULLSCREEN_CHANGE,(function(t){e.changeLangTextKey(e.find(".xg-tips"),t?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(t)})),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:TopBackIcon,options:{config:{onClick:function(t){e.handleFullscreen(t)}}}})),"mobile"===sniffer$1.device&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:FullScreenSvg,class:"xg-get-fullscreen"},exitFullscreen:{icon:ExitFullScreenSvg,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon","mobile"===sniffer$1.device?"touchend":"click",this.handleFullscreen),"mobile"===sniffer$1.device&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.player,r=this.config;!0===r.useCssFullscreen||"function"==typeof r.useCssFullscreen&&r.useCssFullscreen()?(t.fullscreen?t.exitCssFullscreen():t.getCssFullscreen(),this.animate(t.fullscreen)):r.rotateFullscreen?(t.fullscreen?t.exitRotateFullscreen():t.getRotateFullscreen(),this.animate(t.fullscreen)):r.switchCallback&&"function"==typeof r.switchCallback?r.switchCallback(t.fullscreen):t.fullscreen?t.exitFullscreen():t.getFullscreen()}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"show",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"show",this).call(this)}},{key:"hide",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"hide",this).call(this)}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return'<xg-icon class="xgplayer-fullscreen">\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</div>\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),r}(Fullscreen$1),Time=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),(n=t.call(this,e)).isActiving=!1,n}return _createClass$j(r,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"currentTime",get:function(){return this.player.currentTime||0}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this,t=this.player.controls.config.mode;this.mode="flex"===t?"flex":"normal",this.config.disable||("flex"===this.mode&&(this.createCenterTime(),this.hide()),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.on(DURATION_CHANGE,(function(){e.onTimeUpdate()})),this.on(TIME_UPDATE,(function(){e.onTimeUpdate()})),this.on(EMPTIED,(function(){e.onReset()})))}},{key:"show",value:function(){"flex"!==this.mode&&_get$3(_getPrototypeOf$f(r.prototype),"show",this).call(this)}},{key:"onTimeUpdate",value:function(){var e=this.player;if(!(this.config.disable||this.isActiving||e.state<STATES$2.RUNNING&&e.state!==STATES$2.ATTACHED)){var t=this.currentTime+this.timeOffset;"flex"===this.mode?(this.centerCurDom.innerHTML=util$2.format(t),this.duration!==1/0&&this.duration>0&&(this.centerDurDom.innerHTML=util$2.format(this.duration))):(this.timeDom.innerHTML=util$2.format(t),this.duration!==1/0&&this.duration>0&&(this.durationDom.innerHTML=util$2.format(this.duration)))}}},{key:"onReset",value:function(){"flex"===this.mode?(this.centerCurDom.innerHTML=util$2.format(0),this.centerDurDom.innerHTML=util$2.format(0)):(this.timeDom.innerHTML=util$2.format(0),this.durationDom.innerHTML=util$2.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(e.controls&&e.controls.center){var t=e.controls.center;this.centerCurDom=util$2.createDom("xg-icon","00:00",{},"xgplayer-time left"),this.centerDurDom=util$2.createDom("xg-icon","00:00",{},"xgplayer-time right"),t.children.length>0?t.insertBefore(this.centerCurDom,t.children[0]):t.appendChild(this.centerCurDom),t.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;this.duration===1/0||this.playerConfig.isLive?(util$2.hide(this.durationDom),util$2.hide(this.timeDom),util$2.hide(this.find(".time-separator")),util$2.show(this.find(".time-live-tag"))):util$2.hide(this.find(".time-live-tag")),e.hide?this.hide():this.show()}},{key:"changeLiveState",value:function(e){e?(util$2.hide(this.durationDom),util$2.hide(this.timeDom),util$2.hide(this.find(".time-separator")),util$2.show(this.find(".time-live-tag"))):(util$2.hide(this.find(".time-live-tag")),util$2.show(this.find(".time-separator")),util$2.show(this.durationDom),util$2.show(this.timeDom))}},{key:"updateTime",value:function(e){this.isActiving=!0,!e&&0!==e||e>this.duration||("flex"!==this.mode?this.timeDom.innerHTML=util$2.format(e):this.centerCurDom.innerHTML=util$2.format(e))}},{key:"resetActive",value:function(){var e=this,t=this.player,r=function(){e.isActiving=!1};this.off(SEEKED,r),t.isSeeking?this.once(SEEKED,r):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-time">\n    <span class="time-current">00:00</span>\n    <span class="time-separator">/</span>\n    <span class="time-duration">00:00</span>\n    <span class="time-live-tag">'.concat(this.i18n.LIVE_TIP,"</span>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_LEFT,index:2,disable:!1}}}]),r}(Plugin);function volumeLargeSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function volumeSmallSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function volumeMutedSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Volume=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"onBarMousedown",(function(t){var r=_assertThisInitialized$f(e).player,n=e.find(".xgplayer-bar");util$2.event(t);var i=n.getBoundingClientRect(),a=util$2.getEventPos(t,r.zoom),o=i.height-(a.clientY-i.top);if(a.h=o,a.barH=i.height,e.pos=a,!(o<-2))return e.updateVolumePos(o,t),document.addEventListener("mouseup",e.onBarMouseUp),e.isStart=!0,!1})),_defineProperty$i(_assertThisInitialized$f(e),"onBarMouseMove",(function(t){if(e.isStart){var r=_assertThisInitialized$f(e),n=r.pos,i=r.player;t.preventDefault(),t.stopPropagation(),util$2.event(t);var a=util$2.getEventPos(t,i.zoom);e.isMoving=!0;var o=n.h-a.clientY+n.clientY;o>n.barH||e.updateVolumePos(o,t)}})),_defineProperty$i(_assertThisInitialized$f(e),"onBarMouseUp",(function(t){util$2.event(t),document.removeEventListener("mouseup",e.onBarMouseUp),e.isStart=!1,e.isMoving=!1})),_defineProperty$i(_assertThisInitialized$f(e),"onMouseenter",(function(t){e._timerId&&(util$2.clearTimeout(_assertThisInitialized$f(e),e._timerId),e._timerId=null),util$2.addClass(e.root,"slide-show"),e.emit("icon_mouseenter",{pluginName:e.pluginName})})),_defineProperty$i(_assertThisInitialized$f(e),"onMouseleave",(function(t){e._timerId&&(util$2.clearTimeout(_assertThisInitialized$f(e),e._timerId),e._timerId=null),e._timerId=util$2.setTimeout(_assertThisInitialized$f(e),(function(){util$2.removeClass(e.root,"slide-show"),e.isStart&&e.onBarMouseUp(t),e._timerId=null}),100),e.emit("icon_mouseleave",{pluginName:e.pluginName})})),_defineProperty$i(_assertThisInitialized$f(e),"onVolumeChange",(function(t){if(e.player){var r=e.player,n=r.muted,i=r.volume;e.isMoving||(e.find(".xgplayer-drag").style.height=n||0===i?"4px":"".concat(100*i,"%"),e.config.showValueLabel&&e.updateVolumeValue()),e.animate(n,i)}})),e}return _createClass$j(r,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:volumeSmallSvg,class:"xg-volume-small"},volumeLarge:{icon:volumeLargeSvg,class:"xg-volume"},volumeMuted:{icon:volumeMutedSvg,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,!this.config.disable){this.initIcons();var t=this.playerConfig,r=t.commonStyle,n=t.volume;r.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=r.volumeColor),this.changeMutedHandler=this.hook("mutedChange",(function(t){e.changeMuted(t)}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),"mobile"!==sniffer$1.device&&"mobile"!==this.playerConfig.isMobileSimulateMode&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(VOLUME_CHANGE,this.onVolumeChange),this.once(LOADED_DATA,this.onVolumeChange),"Number"!==util$2.typeOf(n)&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,t){var r=this.player,n=this.find(".xgplayer-drag"),i=this.find(".xgplayer-bar");if(i&&n){var a=parseInt(e/i.getBoundingClientRect().height*1e3,10);n.style.height="".concat(e,"px");var o=Math.max(Math.min(a/1e3,1),0),s={volume:{from:r.volume,to:o}};r.muted&&(s.muted={from:!0,to:!1}),this.emitUserAction(t,"change_volume",{muted:r.muted,volume:r.volume,props:s}),r.volume=Math.max(Math.min(a/1e3,1),0),r.muted&&(r.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,t=e.volume,r=e.muted,n=this.find(".xgplayer-value-label"),i=Math.max(Math.min(t,1),0);n.innerText=r?0:Math.ceil(100*i)}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var t=this.player;this.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:t.muted,volume:t.volume,props:{muted:{from:t.muted,to:!t.muted}}}),t.volume>0&&(t.muted=!t.muted),t.volume<.01&&(t.volume=this.config.miniVolume)}},{key:"animate",value:function(e,t){e||0===t?this.setAttr("data-state","mute"):t<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon","mobile"===sniffer$1.device?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,t=this.config.showValueLabel;return'\n    <xg-icon class="xgplayer-volume" data-state="normal">\n      <div class="xgplayer-icon">\n      </div>\n      <xg-slider class="xgplayer-slider">\n        '.concat(t?'<div class="xgplayer-value-label">'.concat(100*e,"</div>"):"",'\n        <div class="xgplayer-bar">\n          <xg-drag class="xgplayer-drag" style="height: ').concat(100*e,'%"></xg-drag>\n        </div>\n      </xg-slider>\n    </xg-icon>')}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),r}(Plugin);function RotateSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">\n  <g clip-path="url(#clip0)">\n    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>\n    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>\n  </g>\n  <defs>\n    <clipPath id="clip0">\n      <rect width="40" height="40" fill="white"/>\n    </clipPath>\n  </defs>\n</svg>\n',"image/svg+xml").firstChild}var Rotate=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),(n=t.call(this,e)).rotateDeg=n.config.rotateDeg||0,n}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this.config.disable||(_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(VIDEO_RESIZE,(function(){e.rotateDeg&&util$2.setTimeout(e,(function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)}),100)})),this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate))}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,t){var r=this.player;e||(e=0);var n=this.player,i=n.root,a=n.innerContainer,o=n.video,s=i.offsetWidth,l=a&&t?a.offsetHeight:i.offsetHeight,u="100%",c="100%",d=0,h=0;.75!==e&&.25!==e||(u="".concat(l,"px"),c="".concat(s,"px"),d=-(l-s)/2,h=-(s-l)/2);var f="translate(".concat(d,"px,").concat(h,"px) rotate(").concat(e,"turn)"),p={transformOrigin:"center center",transform:f,webKitTransform:f,height:c,width:u},y=t?o:i,m=t?r.getPlugin("poster"):null;Object.keys(p).map((function(e){y.style[e]=p[e],m&&m.root&&(m.root.style[e]=p[e])}))}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.player;this.rotateDeg||(this.rotateDeg=0);var i=e?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*i*r)%1,this.updateRotateDeg(this.rotateDeg,t),n.emit(ROTATE,360*this.rotateDeg)}},{key:"registerIcons",value:function(){return{rotate:RotateSvg}}},{key:"render",value:function(){if(!this.config.disable)return'\n    <xg-icon class="xgplayer-rotate">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="'.concat(this.i18nKeys.ROTATE_TIPS,'">\n      ').concat(this.i18n.ROTATE_TIPS,"\n      </div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),r}(Fullscreen$1);function PipIcon(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}function PipIconExit(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}var PresentationMode={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},PIP=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"switchPIP",(function(t){if(!e.isPIPAvailable())return!1;t.stopPropagation(),e.isPip?(e.exitPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!0,to:!1}),e.setAttr("data-state","normal")):4===e.player.video.readyState&&(e.requestPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!1,to:!0}),e.setAttr("data-state","pip"))})),e}return _createClass$j(r,[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.pip&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this),this.pMode=PresentationMode.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(COMPLETE,(function(){e.config.showIcon&&(util$2.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))})))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:PipIcon,class:"xg-get-pip"},pipIconExit:{icon:PipIconExit,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,t=this.player;this.leavePIPCallback=function(){var r=t.paused;util$2.setTimeout(e,(function(){!r&&t.videoPlay()}),0),!r&&t.videoPlay(),e.setAttr("data-state","normal"),t.emit(PIP_CHANGE,!1)},this.enterPIPCallback=function(r){t.emit(PIP_CHANGE,!0),e.pipWindow=r.pictureInPictureWindow,e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(r){var n=t.video.webkitPresentationMode;e.pMode===PresentationMode.FULLSCREEN&&n!==PresentationMode.FULLSCREEN&&t.onFullscreenChange(null,!1),e.pMode=n,n===PresentationMode.PIP?e.enterPIPCallback(r):n===PresentationMode.INLINE&&e.leavePIPCallback(r)},t.video&&(t.video.addEventListener("enterpictureinpicture",this.enterPIPCallback),t.video.addEventListener("leavepictureinpicture",this.leavePIPCallback),r.checkWebkitSetPresentationMode(t.video)&&t.video.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"requestPIP",value:function(){var e=this.player,t=this.playerConfig;if(this.isPIPAvailable()&&!this.isPip)try{var n=t.poster;return n&&(e.video.poster="String"===util$2.typeOf(n)?n:n.poster),r.checkWebkitSetPresentationMode(e.video)?e.video.webkitSetPresentationMode("picture-in-picture"):e.video.requestPictureInPicture(),!0}catch(i){return console.error("requestPiP",i),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{return this.isPIPAvailable()&&this.isPip&&(r.checkWebkitSetPresentationMode(e.video)?e.video.webkitSetPresentationMode("inline"):document.exitPictureInPicture()),!0}catch(t){return console.error("exitPIP",t),!1}}},{key:"isPip",get:function(){var e=this.player;return document.pictureInPictureElement&&document.pictureInPictureElement===e.video||e.video.webkitPresentationMode===PresentationMode.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.video;return("Boolean"!==util$2.typeOf(document.pictureInPictureEnabled)||document.pictureInPictureEnabled)&&("Boolean"===util$2.typeOf(e.disablePictureInPicture)&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&"Function"===util$2.typeOf(e.webkitSetPresentationMode))}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this);var e=this.player;e.video.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.video.removeEventListener("leavepictureinpicture",this.leavePIPCallback),r.checkWebkitSetPresentationMode(e.video)&&e.video.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(this.config.showIcon&&this.isPIPAvailable())return'<xg-icon class="xgplayer-pip">\n      <div class="xgplayer-icon xg-icon-disable">\n      </div>\n      <div class="xg-tips" lang-key="'.concat(this.i18nKeys.PIP,'">').concat(this.i18n.PIP,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:6,showIcon:!1}}},{key:"checkWebkitSetPresentationMode",value:function(e){return"function"==typeof e.webkitSetPresentationMode}}]),r}(Fullscreen$1);function Next(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">\n  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>\n</svg>\n',"image/svg+xml").firstChild}var PlayNextIcon=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"playNext",(function(e){var t=_assertThisInitialized$f(n).player;e.preventDefault(),e.stopPropagation(),n.idx+1<n.config.urlList.length?(n.idx++,n.nextHandler(n.config.urlList[n.idx],n.idx),t.emit(PLAYNEXT,n.idx+1)):(n.nextHandler(),t.emit(PLAYNEXT))})),n.idx=-1,n}return _createClass$j(r,[{key:"afterCreate",value:function(){this.config.urlList&&0!==this.config.urlList.length&&(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Next}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e="mobile"===sniffer$1.device?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var t=this.player;e&&(t.pause(),t.currentTime=0,t.switchURL?t.switchURL(e):t.src=e,t.config.url=e,t.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(this.config.urlList&&0!==this.config.urlList.length)return'\n     <xg-icon class="xgplayer-playnext">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="PLAYNEXT_TIPS">'.concat(this.i18n.PLAYNEXT_TIPS,"</div>\n     </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),r}(Plugin),download={exports:{}},module2;module2=download,module2.exports=function e(t,r,n){var i,a,o=window,s="application/octet-stream",l=n||s,u=t,c=!r&&!n&&u,d=document.createElement("a"),h=function(e){return String(e)},f=o.Blob||o.MozBlob||o.WebKitBlob||h,p=r||"download";if(f=f.call?f.bind(o):Blob,"true"===String(this)&&(l=(u=[u,l])[0],u=u[1]),c&&c.length<2048&&(p=c.split("/").pop().split("?")[0],d.href=c,-1!==d.href.indexOf(c))){var y=new XMLHttpRequest;return y.open("GET",c,!0),y.responseType="blob",y.onload=function(t){e(t.target.response,p,s)},setTimeout((function(){y.send()}),0),y}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(u)){if(!(u.length>2096103.424&&f!==h))return navigator.msSaveBlob?navigator.msSaveBlob(b(u),p):_(u);l=(u=b(u)).type||s}else if(/([\x80-\xff])/.test(u)){for(var m=0,g=new Uint8Array(u.length),v=g.length;m<v;++m)g[m]=u.charCodeAt(m);u=new f([g],{type:l})}function b(e){for(var t=e.split(/[:;,]/),r=t[1],n=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),i=n.length,a=0,o=new Uint8Array(i);a<i;++a)o[a]=n.charCodeAt(a);return new f([o],{type:r})}function _(e,t){if("download"in d)return d.href=e,d.setAttribute("download",p),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){o.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var r=document.createElement("iframe");document.body.appendChild(r),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),r.src=e,setTimeout((function(){document.body.removeChild(r)}),333)}if(i=u instanceof f?u:new f([u],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(i,p);if(o.URL)_(o.URL.createObjectURL(i),!0);else{if("string"==typeof i||i.constructor===h)try{return _("data:"+l+";base64,"+o.btoa(i))}catch(E){return _("data:"+l+","+encodeURIComponent(i))}(a=new FileReader).onload=function(e){_(this.result)},a.readAsDataURL(i)}return!0};var downloadUtil=download.exports;function DownloadSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">\n      <g id="Group-2">\n        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">\n          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>\n          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>\n          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>\n          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n',"image/svg+xml").firstChild}var Download=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"download",(function(e){if(!n.isLock){n.emitUserAction(e,"download");var t=n.getAbsoluteURL(n.player.src);downloadUtil(t),n.isLock=!0,n.timer=window.setTimeout((function(){n.isLock=!1,window.clearTimeout(n.timer),n.timer=null}),300)}})),n.timer=null,n.isLock=!1,n}return _createClass$j(r,[{key:"afterCreate",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this),this.config.disable||(this.appendChild(".xgplayer-icon",this.icons.download),this.bind(["click","touchend"],this.download))}},{key:"registerIcons",value:function(){return{download:DownloadSvg}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var t=document.createElement("div");t.innerHTML='<a href="'.concat(e,'">x</a>'),e=t.firstChild.href}return e}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-download">\n   <div class="xgplayer-icon">\n   </div>\n   <div class="xg-tips" lang-key="'.concat(this.i18nKeys.DOWNLOAD_TIPS,'">').concat(this.i18n.DOWNLOAD_TIPS,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:3,disable:!0}}}]),r}(Fullscreen$1),ScreenShot=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.screenShot&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(t){e.fitVideo&&(e.width=t.vWidth,e.height=t.vHeight)},this.once(VIDEO_RESIZE,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,t){var r=document.createElement("a");r.href=e,r.download=t;var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n)}},{key:"createCanvans",value:function(e,t){var r=document.createElement("canvas");this.canvasCtx=r.getContext("2d"),this.canvas=r,r.width=e||this.config.width,r.height=t||this.config.height}},{key:"onClickBtn",value:function(e){var t=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot"),this.shot().then((function(e){t.emit(SCREEN_SHOT,e),t.saveScreenShot(e,t.config.name+t.config.format)}))}},{key:"shot",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quality:.92,type:"image/png"},i=this.config,a=this.player,o=n.quality||i.quality,s=n.type||i.type;return new Promise((function(n,l){var u=null;a.video.canvas?u=a.video.canvas:(r.canvas?(r.canvas.width=e||i.width,r.canvas.height=t||i.height):r.createCanvans(e,t),r.canvasCtx.drawImage(a.video,0,0,e||i.width,t||i.height),u=r.canvas);var c=u.toDataURL(s,o).replace(s,"image/octet-stream");n(c=c.replace(/^data:image\/[^;]+/,"data:application/octet-stream"))}))}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(VIDEO_RESIZE,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",t="SCREENSHOT";return'\n      <xg-icon class="xgplayer-shot">\n      <div class="'.concat(e,'">\n      ').concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[t],'">').concat(this.i18n[t],"</span>")," \n      </div>\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,fitVideo:!0,disable:!1,name:"screenshot"}}}]),r}(Fullscreen$1),OptionList=function(){function e(t){_classCallCheck$i(this,e),this.config=t.config,this.parent=t.root,this.root=util$2.createDom("ul","",{},"xg-options-list ".concat(this.config.className)),t.root.appendChild(this.root),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var r="mobile"===sniffer$1.device?"touchend":"click";this._delegates=Plugin.delegate.call(this,this.root,"li",r,this.onItemClick)}return _createClass$j(e,[{key:"renderItemList",value:function(e){var t=this,r=this.config,n=this.root;e?r.data=e:e=r.data,r.style&&Object.keys(r.style).map((function(e){n.style[e]=r[e]})),e.length>0&&(this.attrKeys=Object.keys(e[0])),this.root.innerHTML="",e.map((function(e,r){var n=e.selected?"option-item selected":"option-item";e["data-index"]=r,t.root.appendChild(util$2.createDom("li","<span>".concat(e.showText,"</span>"),e,n))}))}},{key:"onItemClick",value:function(e){e.delegateTarget||(e.delegateTarget=e.target);var t=e.delegateTarget;if(t&&util$2.hasClass(t,"selected"))return!1;var r="function"==typeof this.config.onItemClick?this.config.onItemClick:null,n=this.root.querySelector(".selected");util$2.addClass(t,"selected"),n&&util$2.removeClass(n,"selected"),r(e,{from:n?this.getAttrObj(n,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(e,t){if(!e||!t)return{};var r={};t.map((function(t){r[t]=e.getAttribute(t)}));var n=e.getAttribute("data-index");return n&&(r.index=Number(n)),r}},{key:"show",value:function(){util$2.removeClass(this.root,"hide"),util$2.addClass(this.root,"active")}},{key:"hide",value:function(){util$2.removeClass(this.root,"active"),util$2.addClass(this.root,"hide")}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map((function(e){e.destroy&&e.destroy()})),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),e}(),IS_MOBILE$1="mobile"===sniffer$1.device,OptionsIcon=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"onEnter",(function(e){e.preventDefault(),e.stopPropagation(),n.emit("icon_mouseenter",{pluginName:n.pluginName}),n.onToggle(!0)})),_defineProperty$i(_assertThisInitialized$f(n),"onLeave",(function(e){e.preventDefault(),e.stopPropagation(),n.emit("icon_mouseleave",{pluginName:n.pluginName}),n.isActive&&n.onToggle(!1)})),n.isActive=!1,n.curValue=null,n.curIndex=0,n}return _createClass$j(r,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,t=this.config;IS_MOBILE$1&&"middle"!==t.listType&&(t.listType="rightSide"),t.hidePortrait&&util$2.addClass(this.root,"portrait"),this.once(CANPLAY,(function(){t.list&&t.list.length>0&&(e.renderItemList(t.list),e.show())})),IS_MOBILE$1&&this.on(PLAYER_FOCUS,(function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)})),this.activeEvent=IS_MOBILE$1?"touchend":"mouseenter",this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)}},{key:"show",value:function(){!this.config.list||this.config.list.length<2||util$2.addClass(this.root,"show")}},{key:"hide",value:function(){util$2.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,t,r){if(void 0===e)return"";var n=this.config.list;return!r&&(r=this.player.lang),t=!t||util$2.isUndefined(e[t])?"text":t,"number"==typeof e&&(e=n[e]),"object"===_typeof$a(e[t])?e[t][r]||e[t].zh:e[t]||""}},{key:"onToggle",value:function(e){if(this.isActive!==e){var t=this.player.controls,r=this.config.listType;e?("rightSide"===r?t.blur():t.focus(),this.optionsList&&this.optionsList.show()):("rightSide"===r?t.focus():t.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,t){e.preventDefault(),e.stopPropagation();var r=this.config,n=r.listType,i=r.list;(IS_MOBILE$1||"rightSide"===n)&&this.onToggle(!1),this.curIndex=t.to.index,this.curItem=i[this.curIndex],this.changeCurrentText(),this.onToggle(!1)}},{key:"changeCurrentText",value:function(){var e=this.config.list,t=e[this.curIndex<e.length?this.curIndex:0];t&&(this.find(".icon-text").innerHTML=this.getTextByLang(t,"iconText"))}},{key:"renderItemList",value:function(e,t){var r=this,n=this.config,i=this.optionsList,a=this.player;if("number"==typeof t&&(this.curIndex=t,this.curItem=n.list[t]),i)return i.renderItemList(e),void this.changeCurrentText();var o={config:{data:e||[],className:"rightSide"===n.listType?"right-side":"",onItemClick:function(e,t){r.onItemClick(e,t)}},root:"rightSide"===n.listType?a.root:this.root};this.config.isShowIcon&&(this.optionsList=new OptionList(o),this.changeCurrentText(),this.show())}},{key:"destroy",value:function(){this.unbind(this.activeEvent,this.onToggle),this.unbind("mouseleave",this.onToggle),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",'">\n    <div class="xgplayer-icon btn-text">\n    <span class="icon-text"></span>\n    </div>\n   </xg-icon>')}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:100,list:[],listType:"middle",listStyle:{},hidePortrait:!0,isShowIcon:!1}}}]),r}(Plugin),DefinitionIcon=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),(n=t.call(this,e)).curTime=0,n.isPaused=!0,n}return _createClass$j(r,[{key:"beforeCreate",value:function(e){var t=e.config.list;Array.isArray(t)&&t.length>0&&(e.config.list=t.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})))}},{key:"afterCreate",value:function(){var e=this;_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this),this.on("resourceReady",(function(t){e.changeDefinitionList(t)})),this.on(DEFINITION_CHANGE,(function(t){e.renderItemList(e.config.list,t.to)})),this.player.definitionList.length<2&&this.hide()}},{key:"initDefinition",value:function(){var e=this.config,t=e.list,r=e.defaultDefinition;if(t.length>0){var n=null;t.map((function(e){e.definition===r&&(n=e)})),n||(n=t[0]),this.changeDefinition(n)}}},{key:"renderItemList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.list||[],n=arguments.length>1?arguments[1]:void 0,i=n&&n.definition?n.definition:this.config.defaultDefinition;n&&t.forEach((function(e){e.selected=!1}));var a=0,o=t.map((function(t,r){var n={url:t.url,definition:t.definition||"",showText:e.getTextByLang(t)||t.definition,selected:!1};return(t.selected||t.definition&&t.definition===i)&&(n.selected=!0,a=r),n}));_get$3(_getPrototypeOf$f(r.prototype),"renderItemList",this).call(this,o,a)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,t){this.player.changeDefinition(e,t)}},{key:"onItemClick",value:function(e,t){var n=this.player.definitionList;_get$3(_getPrototypeOf$f(r.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:t.from,to:t.to});for(var i=0;i<n.length;i++)t.to&&n[i].definition===t.to.definition&&(t.to.url=n[i].url),t.from&&n[i].definition===t.from.definition&&(t.from.url=n[i].url);this.player.changeDefinition(t.to,t.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0}}}]),r}(OptionsIcon),PlaybackRate=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),(n=t.call(this,e)).curRate=1,n}return _createClass$j(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.playbackRate,r=t?Array.isArray(t)?t:e.config.list:[];Array.isArray(r)&&(e.config.list=r.map((function(e){return"number"==typeof e?e={rate:e,text:"".concat(e,"x")}:!e.text&&e.rate&&(e.text="".concat(e.rate,"x")),e})))}},{key:"afterCreate",value:function(){var e=this;_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this),this.on(RATE_CHANGE,(function(){e.curValue!==e.player.playbackRate&&e.renderItemList()})),this.renderItemList()}},{key:"show",value:function(){this.config.list&&0!==this.config.list.length&&_get$3(_getPrototypeOf$f(r.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,t){_get$3(_getPrototypeOf$f(r.prototype),"onItemClick",this).apply(this,arguments);var n=e.delegateTarget,i=Number(n.getAttribute("rate"));if(!i||i===this.curValue)return!1;var a={playbackRate:{from:this.player.playbackRate,to:i}};this.emitUserAction(e,"change_rate",{props:a}),this.curValue=i,this.player.playbackRate=i}},{key:"renderItemList",value:function(){var e=this,t=this.player.playbackRate||1;this.curValue=t;var n=0,i=this.config.list.map((function(r,i){var a={rate:r.rate};return a.rate===t&&(a.selected=!0,n=i),a.showText=e.getTextByLang(r),a}));_get$3(_getPrototypeOf$f(r.prototype),"renderItemList",this).call(this,i,n)}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1}}}]),r}(OptionsIcon);function CssFullSceenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" class=\'path_full\' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ExitCssFullSceenSvg(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var CssFullScreen=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.cssFullscreen&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this),this.config.disable||(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(CSS_FULLSCREEN_CHANGE,(function(t){e.animate(t)})),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e.cssFullscreen),t.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:t}),t?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var t=this.i18nKeys;this.changeLangTextKey(this.find(".xg-tips"),e?t.EXITCSSFULLSCREEN_TIPS:t.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:CssFullSceenSvg,class:"xg-get-cssfull"},exitCssFullscreen:{icon:ExitCssFullSceenSvg,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class=\'xgplayer-cssfullscreen\'>\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys.CSSFULLSCREEN_TIPS,'">').concat(this.i18n.CSSFULLSCREEN_TIPS,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),r}(Fullscreen$1),ErrorPlugin$1=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(CANPLAY,(function(){e.handleCanPlay()})),this.on(ERROR$3,(function(t){e.onError(t)}))}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleCanPlay",value:function(){util$2.removeClass(this.player.root,"xgplayer-is-error")}},{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.player,r=e.errorType,n=t.errorNote?this.i18n[t.errorNote]:"";if(!n)switch(r){case"decoder":n=this.i18n.MEDIA_ERR_DECODE;break;case"network":n=this.i18n.MEDIA_ERR_NETWORK;break;default:n=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=n,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return'<xg-error class="xgplayer-error">\n      <div class="xgplayer-errornote">\n       <span class="xgplayer-error-text"></span>\n       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>\n      </div>\n    </xg-error>'}}],[{key:"pluginName",get:function(){return"error"}}]),r}(Plugin),Prompt=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],(function(t){(e.config.onClick||e.customOnClick)&&(t.preventDefault(),t.stopPropagation(),e.customOnClick?e.customOnClick(t):e.config.onClick(t))})),this.player.showPrompt=function(){e.show.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var t=this;Object.keys(e).map((function(r){t.root.style[r]=e[r]}))}},{key:"show",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){this.customOnClick=n;var i=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),util$2.addClass(this.root,"show"),"arrow"===r.mode&&util$2.addClass(this.root,"arrow"),this.find(".xgplayer-prompt-detail").innerHTML="string"==typeof e?e:"".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),r.style&&this.setStyle(r.style);var a="boolean"==typeof r.autoHide?r.autoHide:this.config.autoHide;if(a){var o=r.interval||i;this.intervalId=setTimeout((function(){t.hide()}),o)}}}},{key:"hide",value:function(){util$2.removeClass(this.root,"show"),util$2.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(STATE_CLASS.CONTROLS_FOLLOW,'">\n    <span class="xgplayer-prompt-detail"></span>\n    </xg-prompt>')}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),r}(Plugin),ISPOT={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function mergeISPOT(e){Object.keys(ISPOT).map((function(t){void 0===e[t]&&(e[t]=ISPOT[t])}))}var APIS={initDots:function(){var e=this;this._ispots.map((function(t){e.createDot(t,!1)})),this._ispotsInit=!0},createDot:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.player.plugins.progress;if(r&&(t&&(mergeISPOT(e),this._ispots.push(e)),this._ispotsInit||!t)){var n=this.calcuPosition(e.time,e.duration),i=e.style||{};i.left="".concat(n.left,"%"),i.width="".concat(n.width,"%");var a="xgspot_".concat(e.id," xgplayer-spot");n.isMini&&(a+=" mini");var o=util$2.createDom("xg-spot",e.template||"",{"data-text":e.text,"data-time":e.time,"data-id":e.id},a);Object.keys(i).map((function(e){o.style[e]=i[e]})),r.outer&&r.outer.appendChild(o)}},findDot:function(e){if(this.player.plugins.progress){var t=this._ispots.filter((function(t,r){return t.id===e}));return t.length>0?t[0]:null}},updateDot:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.player.plugins.progress;if(r){var n=this.findDot(e.id);if(n&&Object.keys(e).map((function(t){n[t]=e[t]})),this._ispotsInit){var i=r.find('xg-spot[data-id="'.concat(e.id,'"]'));if(i){var a=this.calcuPosition(e.time,e.duration),o=e.style||{};o.left="".concat(a.left,"%"),o.width="".concat(a.width,"%"),i.setAttribute("data-text",e.text),i.setAttribute("data-time",e.time),a.isMini?util$2.addClass(i,"mini"):util$2.removeClass(i,"mini"),Object.keys(o).map((function(e){i.style[e]=o[e]})),t&&this.showDot(e.id)}}}},deleteDot:function(e){var t=this._ispots,r=this.player.plugins.progress;if(r){for(var n=[],i=0;i<t.length;i++)t[i].id===e&&n.push(i);for(var a=n.length-1;a>=0;a--)if(t.splice(n[a],1),this._ispotsInit){var o=r.find('xg-spot[data-id="'.concat(e,'"]'));o&&o.parentElement.removeChild(o)}}},deleteAllDots:function(){var e=this.player.plugins.progress;if(e)if(this._ispotsInit){for(var t=e.root.getElementsByTagName("xg-spot"),r=t.length-1;r>=0;r--)e.outer.removeChild(t[r]);this._ispots=[]}else this._ispots=[]},updateAllDots:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=this.player.plugins.progress;if(r)if(this._ispotsInit){this._ispots=[];var n=r.root.getElementsByTagName("xg-spot"),i=n.length;if(i>t.length)for(var a=i-1;a>t.length-1;a--)r.outer.removeChild(n[a]);t.map((function(t,r){r<i?(n[r].setAttribute("data-id","".concat(t.id)),e._ispots.push(t),e.updateDot(t)):e.createDot(t)}))}else this._ispots=t},getAllDotsDom:function(){var e=this.player.plugins.progress;return e?e.root.getElementsByTagName("xg-spot"):[]},getDotDom:function(e){var t=this.player.plugins.progress;if(t)return t.find('xg-spot[data-id="'.concat(e,'"]'))}};function initDotsAPI(e){var t=e.config,r=e.player;Object.keys(APIS).map((function(t){e[t]=APIS[t].bind(e)}));var n=r.config.progressDot||t.ispots||[];e._ispots=n.map((function(e){return mergeISPOT(e),e})),e._ispotsInit=!1,r.once(DURATION_CHANGE,(function(){e.initDots()}))}var CALLBACK_MAP={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver"},ProgressPreview=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),_defineProperty$i(_assertThisInitialized$f(n=t.call(this,e)),"onMousemove",(function(e){n.config.disable||(n._state.f||util$2.hasClass(e.target,"xg-spot-content"))&&(util$2.event(e),e.stopPropagation())})),_defineProperty$i(_assertThisInitialized$f(n),"onMousedown",(function(e){n.config.disable||(n._state.f||util$2.hasClass(e.target,"xg-spot-content"))&&(util$2.event(e),e.stopPropagation())})),_defineProperty$i(_assertThisInitialized$f(n),"onMouseup",(function(e){if(n.isDrag){var t=n.player.plugins.progress;t&&t.pos&&(t.onMouseUp(e),!t.pos.isEnter&&t.onMouseLeave(e))}})),_defineProperty$i(_assertThisInitialized$f(n),"onDotMouseLeave",(function(e){if(!n.config.disable){n._curDot.removeEventListener("mouseleave",n.onDotMouseLeave),n.blurDot(e.target),n._curDot=null;var t=n.player.plugins.progress;t&&t.enableBlur(),n.show()}})),_defineProperty$i(_assertThisInitialized$f(n),"onProgressMouseOver",(function(e,t){if(!n.config.disable&&util$2.hasClass(t.target,"xgplayer-spot")&&!n._curDot){n._curDot=t.target,n.focusDot(t.target),n._curDot.children.length>0&&n.hide();var r=n.player.plugins.progress;r&&r.disableBlur(),n._curDot.addEventListener("mouseleave",n.onDotMouseLeave)}})),n._ispots=[],n.videoPreview=null,n.videothumbnail=null,n.thumbnail=null,n._state={now:0,f:!1},n}return _createClass$j(r,[{key:"beforeCreate",value:function(e){var t=e.player.plugins.progress;t&&(e.root=t.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",(function(t,r){r.time&&e.player.seek(r.time)})),initDotsAPI(this),this.config.disable&&this.disable()}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map((function(r){t.config[r]=e[r]}))}},{key:"onPluginsReady",value:function(){this.player.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,t=this.player.plugins.progress;if(t&&(Object.keys(CALLBACK_MAP).map((function(r){e[CALLBACK_MAP[r]]=e[CALLBACK_MAP[r]].bind(e),t.addCallBack(r,e[CALLBACK_MAP[r]])})),"mobile"!==sniffer$1.device)){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var r=this.hook("previewClick",(function(){}));this.handlerPreviewClick=function(t){t.stopPropagation(),r(parseInt(1e3*e._state.now,10)/1e3,t)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,t){!this.config.disable&&this.player.duration&&this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){!this.config.disable&&this.player.duration&&(this.isDrag=!0,this.videoPreview&&util$2.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){!this.config.disable&&this.player.duration&&(this.isDrag=!1,this.videoPreview&&util$2.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,t){if(!this.config.disable&&util$2.hasClass(t.target,"xgplayer-spot")){t.stopPropagation(),t.preventDefault();var r={};["time","id","text"].map((function(e){r[e]=t.target.getAttribute("data-".concat(e))})),r.time&&(r.time=Number(r.time)),this.handlerSpotClick(t,r)}}},{key:"updateLinePos",value:function(e,t){var r,n,i=this.root,a=this.previewLine,o=this.timePoint,s="flex"===this.player.controls.mode,l=i.getBoundingClientRect().width,u=o.getBoundingClientRect().width,c=e-l/2;c<0&&!s?(c=0,r=e-l/2,!this.thumbnail&&(n=e-l/2-u/2)):c>t-l&&!s?(r=c-(t-l),!this.thumbnail&&(n=c-(t-l)-u/2),c=t-l):!this.thumbnail&&(n=-u/2),a.style.transform=void 0!==r?"translateX(".concat(r,"px)"):"",o.style.transform=void 0!==n?"translateX(".concat(n,"px)"):"",i.style.transform="translateX(".concat(c,"px)")}},{key:"updateTimeText",value:function(e){var t=this.timeText,r=this.timePoint;t.textContent=e,!this.thumbnail&&(r.textContent=e)}},{key:"updatePosition",value:function(e,t,r,n){var i=this.root,a=this.config,o=this._state;if(i){this.updateLinePos(e,t),o.now=r;var s=util$2.format(r);n&&n.target&&util$2.hasClass(n.target,"xgplayer-spot")?(this.showTips(n.target.getAttribute("data-text"),!1,s),this.focusDot(n.target),o.f=!0,a.isFocusDots&&o.f&&(o.now=parseInt(n.target.getAttribute("data-time"),10))):a.defaultText?(o.f=!1,this.showTips(a.defaultText,!0,s)):(o.f=!1,this.hideTips("")),this.updateTimeText(s),this.updateThumbnails(o.now)}}},{key:"updateThumbnails",value:function(e){var t=this.player,r=this.videoPreview,n=t.plugins.thumbnail;if(n&&n.usable){this.thumbnail&&n.update(this.thumbnail,e,160,90);var i=r&&r.getBoundingClientRect();this.videothumbnail&&n.update(this.videothumbnail,e,i.width,i.height)}}},{key:"changeThumbnail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("mobile"!==sniffer$1.device){var t=this.player,r=this.config,n=t.getPlugin("thumbnail");if(n.changeConfig(e),n&&n.usable&&r.isShowThumbnail){util$2.removeClass(this.root,"short-line no-thumbnail"),this._hasThumnail=!0;var i=this.find(".xg-spot-thumbnail");this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.thumbnail&&i.removeChild(this.thumbnail),this.thumbnail=n.createThumbnail(i,"progress-thumbnail"),r.isShowCoverPreview&&(this.videoPreview=util$2.createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=n.createThumbnail(this.videoPreview,"xgvideo-thumbnail"))}else{util$2.addClass(this.root,"short-line no-thumbnail");var a=this.find(".xg-spot-thumbnail");this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.thumbnail&&a.removeChild(this.thumbnail),this.videothumbnail=null,this.thumbnail=null,this._hasThumnail=!1}}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("mobile"!==sniffer$1.device){var t=this.player,r=this.config,n=t.getPlugin("thumbnail");if(n&&n.setConfig(e),n&&n.usable&&r.isShowThumbnail){util$2.removeClass(this.root,"short-line no-thumbnail"),this._hasThumnail=!0;var i=this.find(".xg-spot-thumbnail");this.thumbnail=n.createThumbnail(i,"progress-thumbnail"),r.isShowCoverPreview&&(this.videoPreview=util$2.createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=n.createThumbnail(this.videoPreview,"xgvideo-thumbnail"))}else util$2.addClass(this.root,"short-line no-thumbnail")}}},{key:"calcuPosition",value:function(e,t){var r=this.player.plugins.progress,n=this.player,i=r.root.getBoundingClientRect().width,a=n.duration/i*6;return e+t>n.duration&&(t=n.duration-e),n.duration,n.duration,{left:e/n.duration*100,width:t/n.duration*100,isMini:t<a}}},{key:"showDot",value:function(e){var t=this.findDot(e);if(t){var r=this.root.getBoundingClientRect().width,n=t.time/this.player.duration*r;this.updatePosition(n,r,t.time)}}},{key:"focusDot",value:function(e,t){e&&(t||(t=e.getAttribute("data-id")),util$2.addClass(e,"active"),this._activeDotId=t)}},{key:"blurDot",value:function(e){if(!e){var t=this._activeDotId;e=this.getDotDom(t)}e&&(util$2.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";util$2.addClass(this.root,"no-timepoint"),e&&(util$2.addClass(this.find(".xg-spot-content"),"show-text"),t&&"production"===this.config.mode?(util$2.addClass(this.root,"product"),this.tipText.textContent=e):(util$2.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(r," ").concat(e)))}},{key:"hideTips",value:function(){util$2.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",util$2.removeClass(this.find(".xg-spot-content"),"show-text"),util$2.removeClass(this.root,"product")}},{key:"hide",value:function(){util$2.addClass(this.root,"hide")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,t=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(t.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,t=this.player.plugins.progress;t&&Object.keys(CALLBACK_MAP).map((function(r){t.removeCallBack(r,e[CALLBACK_MAP[r]])})),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return"mobile"===sniffer$1.device||"mobile"===this.playerConfig.isMobileSimulateMode?"":'<div class="xg-spot-info '.concat("short"===this.config.mode?"short-line":"",'">\n      <div class="xg-spot-content">\n        <div class="xg-spot-thumbnail">\n          <span class="xg-spot-time"></span>\n        </div>\n        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>\n      </div>\n      <div class="xgplayer-progress-point">00:00</div>\n      <div class="xg-spot-line"></div>\n    </div>')}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1}}}]),r}(Plugin),Thumbnail=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),(n=t.call(this,e)).ratio=1,n.interval=-1,n.preloadMark={},n}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([DURATION_CHANGE],(function(){var t=e.config,r=t.pic_num,n=t.interval;e.usable&&(e.interval=n>0?n:Math.round(1e3*e.player.duration/r)/1e3)}))}},{key:"setConfig",value:function(e){var t=this;e&&(Object.keys(e).map((function(r){t.config[r]=e[r]})),this.usable&&this.initThumbnail())}},{key:"usable",get:function(){var e=this.config,t=e.urls,r=e.pic_num;return t&&t.length>0&&r>0}},{key:"initThumbnail",value:function(){var e=this.config,t=e.width,r=e.height,n=e.pic_num,i=e.interval;this.ratio=t/r*100,this.interval=i>0?i:Math.round(1e3*this.player.duration/n)/1e3,this.preload(0)}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var t=this,r=this.config.urls,n=r.length;[e-1,e,e+1,e+2].map((function(e){!t.preloadMark[e]&&e>=0&&e<n&&(util$2.preloadImg(r[e]),t.preloadMark[e]=!0)}))}},{key:"getPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.config,i=n.pic_num,a=n.row,o=n.col,s=n.width,l=n.height,u=Math.ceil(e/this.interval),c=(u=u>i?i:u)<a*o?0:Math.ceil(u/(a*o))-1,d=u-c*(o*a),h=d>0?Math.ceil(d/o)-1:0,f=d>0?d-h*o-1:0,p=0,y=0;if(t&&r){var m=t/r;m<s/l?y=(p=t)/(s/l):p=(y=r)*(s/l)}else y=(p=t||s)/(s/l);var g=this.getUrlByIndex(c);return{urlIndex:c,rowIndex:h,colIndex:f,url:g,height:y,width:p,style:{backgroundImage:"url(".concat(g,")"),backgroundSize:"".concat(p*o,"px auto"),backgroundPosition:"-".concat(f*p,"px -").concat(h*y,"px"),width:"".concat(p,"px"),height:"".concat(y,"px")}}}},{key:"update",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=this.config,o=a.pic_num,s=a.urls;if(!(o<1)&&s&&0!==s.length){var l=this.getPosition(t,r,n);this.preload(l.urlIndex),Object.keys(l.style).map((function(t){e.style[t]=l.style[t]})),Object.keys(i).map((function(t){e.style[t]=i[t]}))}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,t){var r=util$2.createDom("xg-thumbnail","",{},"thumbnail ".concat(t));return e&&e.appendChild(r),r}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,width:160,height:90,scale:1,className:"",hidePortrait:!1}}}]),r}(Plugin),MiniProgress=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"afterCreate",value:function(){}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;t&&this.root&&(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/t*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/t*100,"%")))}},{key:"render",value:function(){if(this.playerConfig.progress&&this.playerConfig.miniprogress)return'<xg-mini-progress class="xg-mini-progress">\n    <xg-mini-progress-cache class="xg-mini-progress-cache"></xg-mini-progress-cache>\n    <xg-mini-progress-played class="xg-mini-progress-played"></xg-mini-progress-played>\n    </xg-mini-progress>'}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{}}}]),r}(Plugin),MODES={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function nowTime$4(){try{return window.performance.now()}catch(e){return(new Date).getTime()}}function checkIsSupportCanvas(){try{return!!document.createElement("canvas").getContext}catch(e){return!1}}var isSupportCanvas=null,DynamicBg=function(t){_inherits$f(n,t);var r=_createSuper$i(n);function n(){var e;_classCallCheck$i(this,n);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=r.call.apply(r,[this].concat(i))),"start",(function(){var t=e.player.video,r=nowTime$4(),n=e.checkVideoIsSupport(t);n&&e.canvasCtx&&t.videoWidth&&t.videoHeight&&(e.stop(),e.videoPI=t.videoHeight>0?parseInt(t.videoWidth/t.videoHeight*100,10):0,(e.config.mode===MODES.REAL_TIME||r-e.preTime>=e.interval)&&(t&&t.videoWidth&&e.update(n,e.videoPI),e.preTime=r),e.frameId=util$2.requestAnimationFrame(e.start))})),_defineProperty$i(_assertThisInitialized$f(e),"stop",(function(){e.frameId&&(util$2.cancelAnimationFrame(e.frameId),e.frameId=null)})),e}return _createClass$j(n,[{key:"afterCreate",value:function(){var e=this;!0===this.playerConfig.dynamicBg&&(this.config.disable=!1),n.isSupport||(this.config.disable=!0);var t=this.config,r=t.disable,i=t.mode;r||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/this.config.frameRate,10),this.canvas=null,this.canvasCtx=null,this.once(COMPLETE,(function(){e.player&&e.init()})),i!==MODES.POSTER&&(i!==MODES.FIRST_FRAME&&(this.on(EMPTIED,(function(){e.stop()})),this.on(PLAY,(function(){e.start()})),this.on(PAUSE,(function(){e.stop()}))),i===MODES.FIRST_FRAME&&this.once(TIME_UPDATE,(function(){e.renderOnce()}))))}},{key:"init",value:function(){var t=this.player,r=this.config;this.canvasFilter=n.supportCanvasFilter();try{var i=this.config.isInnerRender&&t.innerContainer||t.root;i.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg"><canvas>\n        </canvas><xgmask></xgmask></div>'),this.root=i.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=r.filter,this.canvas.style.webkitFilter=r.filter),this.mask=this.find("xgmask"),r.addMask&&(this.mask.style.background=r.maskBg),this.canvasCtx=this.canvas.getContext("2d"),this.renderByPoster()}catch(e){XG_DEBUG.logError("plugin:DynamicBg",e)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var t=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(t&&("safari"!==sniffer$1.browser||!/^blob/.test(t.currentSrc)&&!/^blob/.test(t.src)))return t;var r=t?t.tagName.toLowerCase():"";return"canvas"===r||"img"===r?t:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var t="String"===util$2.typeOf(e)?e:"String"===util$2.typeOf(e.poster)?e.poster:null;this.updateImg(t)}}},{key:"renderOnce",value:function(){var e=this.player.video;if(e.videoWidth&&e.videoHeight){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var t=this.checkVideoIsSupport(e);t&&e.videoWidth&&this.update(t,this.videoPI)}}},{key:"updateImg",value:function(e){var t=this;if(e){var r=this.canvas.getBoundingClientRect(),n=r.width,i=r.height,a=new window.Image;a.onload=function(){if(t.canvas&&!t.frameId&&!t.isStart){t.canvas.height=i,t.canvas.width=n;var e=parseInt(n/i*100,10);t.update(a,e),a=null}},a.src=e}}},{key:"update",value:function(t,r){if(this.canvas&&this.canvasCtx&&r)try{var n=this._pos,i=this.config,a=this.canvas.getBoundingClientRect(),o=a.width,s=a.height;if(o!==n.width||s!==n.height||n.pi!==r){var l=parseInt(o/s*100,10);n.pi=r,n.width=this.canvas.width=o,n.height=this.canvas.height=s;var u=s,c=o;l<r?c=parseInt(s*r/100,10):l>r&&(u=parseInt(100*o/r,10)),n.rwidth=c*i.multiple,n.rheight=u*i.multiple,n.x=(o-n.rwidth)/2,n.y=(s-n.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=i.filter),this.canvasCtx.drawImage(t,n.x,n.y,n.rwidth,n.rheight)}catch(e){XG_DEBUG.logError("plugin:DynamicBg",e)}}},{key:"destroy",value:function(){this.stop(),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,mode:"framerate",frameRate:10,filter:"blur(50px)",addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return"boolean"==typeof isSupportCanvas?isSupportCanvas:isSupportCanvas=checkIsSupportCanvas()}},{key:"supportCanvasFilter",value:function(){return!("safari"===sniffer$1.browser||"firefox"===sniffer$1.browser)}}]),n}(Plugin),ZH={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:""},mse:{code:2,msg:""},parse:{code:3,msg:""},format:{code:4,msg:""},decoder:{code:5,msg:""},runtime:{code:6,msg:""},timeout:{code:7,msg:""},other:{code:8,msg:""}},HAVE_NOTHING:"/",HAVE_METADATA:"/",HAVE_CURRENT_DATA:"/",HAVE_FUTURE_DATA:"",HAVE_ENOUGH_DATA:"",NETWORK_EMPTY:"/",NETWORK_IDLE:"/",NETWORK_LOADING:"",NETWORK_NO_SOURCE:"/",MEDIA_ERR_ABORTED:"",MEDIA_ERR_NETWORK:"",MEDIA_ERR_DECODE:"",MEDIA_ERR_SRC_NOT_SUPPORTED:"/",REPLAY:"",ERROR:"",PLAY_TIPS:"",PAUSE_TIPS:"",PLAYNEXT_TIPS:"",DOWNLOAD_TIPS:"",ROTATE_TIPS:"",RELOAD_TIPS:"",FULLSCREEN_TIPS:"",EXITFULLSCREEN_TIPS:"",CSSFULLSCREEN_TIPS:"",EXITCSSFULLSCREEN_TIPS:"",TEXTTRACK:"",PIP:"",SCREENSHOT:"",LIVE:"",OFF:"",OPEN:"",MINI_DRAG:"",MINISCREEN:"",REFRESH_TIPS:"",REFRESH:"",FORWARD:"",LIVE_TIP:""}},es_json_stringify={},$$1W=_export$1,getBuiltIn$r=getBuiltIn$A,apply$f=functionApply$1,call$B=functionCall$1,uncurryThis$1n=functionUncurryThis$1,fails$1m=fails$1Q,isArray$8=isArray$d,isCallable$A=isCallable$Z,isObject$F=isObject$U,isSymbol$8=isSymbol$c,arraySlice$i=arraySlice$n,NATIVE_SYMBOL$7=symbolConstructorDetection$1,$stringify$1=getBuiltIn$r("JSON","stringify"),exec$d=uncurryThis$1n(/./.exec),charAt$h=uncurryThis$1n("".charAt),charCodeAt$7=uncurryThis$1n("".charCodeAt),replace$g=uncurryThis$1n("".replace),numberToString$4=uncurryThis$1n(1..toString),tester$1=/[\uD800-\uDFFF]/g,low$1=/^[\uD800-\uDBFF]$/,hi$1=/^[\uDC00-\uDFFF]$/,WRONG_SYMBOLS_CONVERSION$1=!NATIVE_SYMBOL$7||fails$1m((function(){var e=getBuiltIn$r("Symbol")();return"[null]"!=$stringify$1([e])||"{}"!=$stringify$1({a:e})||"{}"!=$stringify$1(Object(e))})),ILL_FORMED_UNICODE$1=fails$1m((function(){return'"\\udf06\\ud834"'!==$stringify$1("\udf06\ud834")||'"\\udead"'!==$stringify$1("\udead")})),stringifyWithSymbolsFix$1=function(e,t){var r=arraySlice$i(arguments),n=t;if((isObject$F(t)||void 0!==e)&&!isSymbol$8(e))return isArray$8(t)||(t=function(e,t){if(isCallable$A(n)&&(t=call$B(n,this,e,t)),!isSymbol$8(t))return t}),r[1]=t,apply$f($stringify$1,null,r)},fixIllFormed$1=function(e,t,r){var n=charAt$h(r,t-1),i=charAt$h(r,t+1);return exec$d(low$1,e)&&!exec$d(hi$1,i)||exec$d(hi$1,e)&&!exec$d(low$1,n)?"\\u"+numberToString$4(charCodeAt$7(e,0),16):e};$stringify$1&&$$1W({target:"JSON",stat:!0,arity:3,forced:WRONG_SYMBOLS_CONVERSION$1||ILL_FORMED_UNICODE$1},{stringify:function(e,t,r){var n=arraySlice$i(arguments),i=apply$f(WRONG_SYMBOLS_CONVERSION$1?stringifyWithSymbolsFix$1:$stringify$1,null,n);return ILL_FORMED_UNICODE$1&&"string"==typeof i?replace$g(i,tester$1,fixIllFormed$1):i}});var web_url={},fails$1l=fails$1Q,wellKnownSymbol$y=wellKnownSymbol$V,IS_PURE$1=isPure$1,ITERATOR$f=wellKnownSymbol$y("iterator"),urlConstructorDetection$1=!fails$1l((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),IS_PURE$1&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[ITERATOR$f]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),anObject$t=anObject$L,iteratorClose$3=iteratorClose$5,callWithSafeIterationClosing$3=function(e,t,r,n){try{return n?t(anObject$t(r)[0],r[1]):t(r)}catch(error){iteratorClose$3(e,"throw",error)}},bind$k=functionBindContext$1,call$A=functionCall$1,toObject$t=toObject$D,callWithSafeIterationClosing$2=callWithSafeIterationClosing$3,isArrayIteratorMethod$5=isArrayIteratorMethod$7,isConstructor$5=isConstructor$9,lengthOfArrayLike$B=lengthOfArrayLike$K,createProperty$7=createProperty$c,getIterator$7=getIterator$9,getIteratorMethod$8=getIteratorMethod$b,$Array$7=Array,arrayFrom$3=function(e){var t=toObject$t(e),r=isConstructor$5(this),n=arguments.length,i=n>1?arguments[1]:void 0,a=void 0!==i;a&&(i=bind$k(i,n>2?arguments[2]:void 0));var o,s,l,u,c,d,h=getIteratorMethod$8(t),f=0;if(!h||this===$Array$7&&isArrayIteratorMethod$5(h))for(o=lengthOfArrayLike$B(t),s=r?new this(o):$Array$7(o);o>f;f++)d=a?i(t[f],f):t[f],createProperty$7(s,f,d);else for(c=(u=getIterator$7(t,h)).next,s=r?new this:[];!(l=call$A(c,u)).done;f++)d=a?callWithSafeIterationClosing$2(u,i,[l.value,f],!0):l.value,createProperty$7(s,f,d);return s.length=f,s},uncurryThis$1m=functionUncurryThis$1,maxInt$1=2147483647,base$1=36,tMin$1=1,tMax$1=26,skew$1=38,damp$1=700,initialBias$1=72,initialN$1=128,delimiter$1="-",regexNonASCII$1=/[^\0-\u007E]/,regexSeparators$1=/[.\u3002\uFF0E\uFF61]/g,OVERFLOW_ERROR$1="Overflow: input needs wider integers to process",baseMinusTMin$1=base$1-tMin$1,$RangeError$b=RangeError,exec$c=uncurryThis$1m(regexSeparators$1.exec),floor$f=Math.floor,fromCharCode$4=String.fromCharCode,charCodeAt$6=uncurryThis$1m("".charCodeAt),join$9=uncurryThis$1m([].join),push$e=uncurryThis$1m([].push),replace$f=uncurryThis$1m("".replace),split$6=uncurryThis$1m("".split),toLowerCase$3=uncurryThis$1m("".toLowerCase),ucs2decode$1=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=charCodeAt$6(e,r++);if(i>=55296&&i<=56319&&r<n){var a=charCodeAt$6(e,r++);56320==(64512&a)?push$e(t,((1023&i)<<10)+(1023&a)+65536):(push$e(t,i),r--)}else push$e(t,i)}return t},digitToBasic$1=function(e){return e+22+75*(e<26)},adapt$1=function(e,t,r){var n=0;for(e=r?floor$f(e/damp$1):e>>1,e+=floor$f(e/t);e>baseMinusTMin$1*tMax$1>>1;)e=floor$f(e/baseMinusTMin$1),n+=base$1;return floor$f(n+(baseMinusTMin$1+1)*e/(e+skew$1))},encode$5=function(e){var t,r,n=[],i=(e=ucs2decode$1(e)).length,a=initialN$1,o=0,s=initialBias$1;for(t=0;t<e.length;t++)(r=e[t])<128&&push$e(n,fromCharCode$4(r));var l=n.length,u=l;for(l&&push$e(n,delimiter$1);u<i;){var c=maxInt$1;for(t=0;t<e.length;t++)(r=e[t])>=a&&r<c&&(c=r);var d=u+1;if(c-a>floor$f((maxInt$1-o)/d))throw $RangeError$b(OVERFLOW_ERROR$1);for(o+=(c-a)*d,a=c,t=0;t<e.length;t++){if((r=e[t])<a&&++o>maxInt$1)throw $RangeError$b(OVERFLOW_ERROR$1);if(r==a){for(var h=o,f=base$1;;){var p=f<=s?tMin$1:f>=s+tMax$1?tMax$1:f-s;if(h<p)break;var y=h-p,m=base$1-p;push$e(n,fromCharCode$4(digitToBasic$1(p+y%m))),h=floor$f(y/m),f+=base$1}push$e(n,fromCharCode$4(digitToBasic$1(h))),s=adapt$1(o,d,u==l),o=0,u++}}o++,a++}return join$9(n,"")},stringPunycodeToAscii$1=function(e){var t,r,n=[],i=split$6(replace$f(toLowerCase$3(e),regexSeparators$1,"."),".");for(t=0;t<i.length;t++)r=i[t],push$e(n,exec$c(regexNonASCII$1,r)?"xn--"+encode$5(r):r);return join$9(n,".")},defineBuiltIn$s=defineBuiltIn$D,defineBuiltIns$6=function(e,t,r){for(var n in t)defineBuiltIn$s(e,n,t[n],r);return e},$$1V=_export$1,global$16=global$1v,call$z=functionCall$1,uncurryThis$1l=functionUncurryThis$1,DESCRIPTORS$I=descriptors$1,USE_NATIVE_URL$3=urlConstructorDetection$1,defineBuiltIn$r=defineBuiltIn$D,defineBuiltIns$5=defineBuiltIns$6,setToStringTag$g=setToStringTag$k,createIteratorConstructor$2=iteratorCreateConstructor$1,InternalStateModule$h=internalState$1,anInstance$f=anInstance$h,isCallable$z=isCallable$Z,hasOwn$z=hasOwnProperty_1$1,bind$j=functionBindContext$1,classof$l=classof$u,anObject$s=anObject$L,isObject$E=isObject$U,$toString$5=toString$O,create$d=objectCreate$2,createPropertyDescriptor$f=createPropertyDescriptor$k,getIterator$6=getIterator$9,getIteratorMethod$7=getIteratorMethod$b,validateArgumentsLength$a=validateArgumentsLength$c,wellKnownSymbol$x=wellKnownSymbol$V,arraySort$2=arraySort$3,ITERATOR$e=wellKnownSymbol$x("iterator"),URL_SEARCH_PARAMS$1="URLSearchParams",URL_SEARCH_PARAMS_ITERATOR$1=URL_SEARCH_PARAMS$1+"Iterator",setInternalState$e=InternalStateModule$h.set,getInternalParamsState$1=InternalStateModule$h.getterFor(URL_SEARCH_PARAMS$1),getInternalIteratorState$1=InternalStateModule$h.getterFor(URL_SEARCH_PARAMS_ITERATOR$1),getOwnPropertyDescriptor$8=Object.getOwnPropertyDescriptor,safeGetBuiltIn$1=function(e){if(!DESCRIPTORS$I)return global$16[e];var t=getOwnPropertyDescriptor$8(global$16,e);return t&&t.value},nativeFetch$1=safeGetBuiltIn$1("fetch"),NativeRequest$1=safeGetBuiltIn$1("Request"),Headers$2=safeGetBuiltIn$1("Headers"),RequestPrototype$1=NativeRequest$1&&NativeRequest$1.prototype,HeadersPrototype$1=Headers$2&&Headers$2.prototype,RegExp$4=global$16.RegExp,TypeError$a=global$16.TypeError,decodeURIComponent$2=global$16.decodeURIComponent,encodeURIComponent$2=global$16.encodeURIComponent,charAt$g=uncurryThis$1l("".charAt),join$8=uncurryThis$1l([].join),push$d=uncurryThis$1l([].push),replace$e=uncurryThis$1l("".replace),shift$3=uncurryThis$1l([].shift),splice$1=uncurryThis$1l([].splice),split$5=uncurryThis$1l("".split),stringSlice$h=uncurryThis$1l("".slice),plus$1=/\+/g,sequences$1=Array(4),percentSequence$1=function(e){return sequences$1[e-1]||(sequences$1[e-1]=RegExp$4("((?:%[\\da-f]{2}){"+e+"})","gi"))},percentDecode$1=function(e){try{return decodeURIComponent$2(e)}catch(error){return e}},deserialize$1=function(e){var t=replace$e(e,plus$1," "),r=4;try{return decodeURIComponent$2(t)}catch(error){for(;r;)t=replace$e(t,percentSequence$1(r--),percentDecode$1);return t}},find$1=/[!'()~]|%20/g,replacements$1={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},replacer$1=function(e){return replacements$1[e]},_serialize$1=function(e){return replace$e(encodeURIComponent$2(e),find$1,replacer$1)},URLSearchParamsIterator$1=createIteratorConstructor$2((function(e,t){setInternalState$e(this,{type:URL_SEARCH_PARAMS_ITERATOR$1,iterator:getIterator$6(getInternalParamsState$1(e).entries),kind:t})}),"Iterator",(function(){var e=getInternalIteratorState$1(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),URLSearchParamsState$1=function(e){this.entries=[],this.url=null,void 0!==e&&(isObject$E(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===charAt$g(e,0)?stringSlice$h(e,1):e:$toString$5(e)))};URLSearchParamsState$1.prototype={type:URL_SEARCH_PARAMS$1,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,a,o,s,l=getIteratorMethod$7(e);if(l)for(r=(t=getIterator$6(e,l)).next;!(n=call$z(r,t)).done;){if(a=(i=getIterator$6(anObject$s(n.value))).next,(o=call$z(a,i)).done||(s=call$z(a,i)).done||!call$z(a,i).done)throw TypeError$a("Expected sequence with length 2");push$d(this.entries,{key:$toString$5(o.value),value:$toString$5(s.value)})}else for(var u in e)hasOwn$z(e,u)&&push$d(this.entries,{key:u,value:$toString$5(e[u])})},parseQuery:function(e){if(e)for(var t,r,n=split$5(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=split$5(t,"="),push$d(this.entries,{key:deserialize$1(shift$3(r)),value:deserialize$1(join$8(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],push$d(r,_serialize$1(e.key)+"="+_serialize$1(e.value));return join$8(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var URLSearchParamsConstructor$1=function(){anInstance$f(this,URLSearchParamsPrototype$1);var e=arguments.length>0?arguments[0]:void 0;setInternalState$e(this,new URLSearchParamsState$1(e))},URLSearchParamsPrototype$1=URLSearchParamsConstructor$1.prototype;if(defineBuiltIns$5(URLSearchParamsPrototype$1,{append:function(e,t){validateArgumentsLength$a(arguments.length,2);var r=getInternalParamsState$1(this);push$d(r.entries,{key:$toString$5(e),value:$toString$5(t)}),r.updateURL()},delete:function(e){validateArgumentsLength$a(arguments.length,1);for(var t=getInternalParamsState$1(this),r=t.entries,n=$toString$5(e),i=0;i<r.length;)r[i].key===n?splice$1(r,i,1):i++;t.updateURL()},get:function(e){validateArgumentsLength$a(arguments.length,1);for(var t=getInternalParamsState$1(this).entries,r=$toString$5(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){validateArgumentsLength$a(arguments.length,1);for(var t=getInternalParamsState$1(this).entries,r=$toString$5(e),n=[],i=0;i<t.length;i++)t[i].key===r&&push$d(n,t[i].value);return n},has:function(e){validateArgumentsLength$a(arguments.length,1);for(var t=getInternalParamsState$1(this).entries,r=$toString$5(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){validateArgumentsLength$a(arguments.length,1);for(var r,n=getInternalParamsState$1(this),i=n.entries,a=!1,o=$toString$5(e),s=$toString$5(t),l=0;l<i.length;l++)(r=i[l]).key===o&&(a?splice$1(i,l--,1):(a=!0,r.value=s));a||push$d(i,{key:o,value:s}),n.updateURL()},sort:function(){var e=getInternalParamsState$1(this);arraySort$2(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=getInternalParamsState$1(this).entries,n=bind$j(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new URLSearchParamsIterator$1(this,"keys")},values:function(){return new URLSearchParamsIterator$1(this,"values")},entries:function(){return new URLSearchParamsIterator$1(this,"entries")}},{enumerable:!0}),defineBuiltIn$r(URLSearchParamsPrototype$1,ITERATOR$e,URLSearchParamsPrototype$1.entries,{name:"entries"}),defineBuiltIn$r(URLSearchParamsPrototype$1,"toString",(function(){return getInternalParamsState$1(this).serialize()}),{enumerable:!0}),setToStringTag$g(URLSearchParamsConstructor$1,URL_SEARCH_PARAMS$1),$$1V({global:!0,constructor:!0,forced:!USE_NATIVE_URL$3},{URLSearchParams:URLSearchParamsConstructor$1}),!USE_NATIVE_URL$3&&isCallable$z(Headers$2)){var headersHas$1=uncurryThis$1l(HeadersPrototype$1.has),headersSet$1=uncurryThis$1l(HeadersPrototype$1.set),wrapRequestOptions$1=function(e){if(isObject$E(e)){var t,r=e.body;if(classof$l(r)===URL_SEARCH_PARAMS$1)return t=e.headers?new Headers$2(e.headers):new Headers$2,headersHas$1(t,"content-type")||headersSet$1(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),create$d(e,{body:createPropertyDescriptor$f(0,$toString$5(r)),headers:createPropertyDescriptor$f(0,t)})}return e};if(isCallable$z(nativeFetch$1)&&$$1V({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return nativeFetch$1(e,arguments.length>1?wrapRequestOptions$1(arguments[1]):{})}}),isCallable$z(NativeRequest$1)){var RequestConstructor$1=function(e){return anInstance$f(this,RequestPrototype$1),new NativeRequest$1(e,arguments.length>1?wrapRequestOptions$1(arguments[1]):{})};RequestPrototype$1.constructor=RequestConstructor$1,RequestConstructor$1.prototype=RequestPrototype$1,$$1V({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:RequestConstructor$1})}}var web_urlSearchParams_constructor$1={URLSearchParams:URLSearchParamsConstructor$1,getState:getInternalParamsState$1},$$1U=_export$1,DESCRIPTORS$H=descriptors$1,USE_NATIVE_URL$2=urlConstructorDetection$1,global$15=global$1v,bind$i=functionBindContext$1,uncurryThis$1k=functionUncurryThis$1,defineBuiltIn$q=defineBuiltIn$D,defineBuiltInAccessor$6=defineBuiltInAccessor$8,anInstance$e=anInstance$h,hasOwn$y=hasOwnProperty_1$1,assign$5=objectAssign$1,arrayFrom$2=arrayFrom$3,arraySlice$h=arraySliceSimple$1,codeAt$1=stringMultibyte$1.codeAt,toASCII$1=stringPunycodeToAscii$1,$toString$4=toString$O,setToStringTag$f=setToStringTag$k,validateArgumentsLength$9=validateArgumentsLength$c,URLSearchParamsModule$1=web_urlSearchParams_constructor$1,InternalStateModule$g=internalState$1,setInternalState$d=InternalStateModule$g.set,getInternalURLState$1=InternalStateModule$g.getterFor("URL"),URLSearchParams$2=URLSearchParamsModule$1.URLSearchParams,getInternalSearchParamsState$1=URLSearchParamsModule$1.getState,NativeURL$1=global$15.URL,TypeError$9=global$15.TypeError,parseInt$2=global$15.parseInt,floor$e=Math.floor,pow$6=Math.pow,charAt$f=uncurryThis$1k("".charAt),exec$b=uncurryThis$1k(/./.exec),join$7=uncurryThis$1k([].join),numberToString$3=uncurryThis$1k(1..toString),pop$1=uncurryThis$1k([].pop),push$c=uncurryThis$1k([].push),replace$d=uncurryThis$1k("".replace),shift$2=uncurryThis$1k([].shift),split$4=uncurryThis$1k("".split),stringSlice$g=uncurryThis$1k("".slice),toLowerCase$2=uncurryThis$1k("".toLowerCase),unshift$1=uncurryThis$1k([].unshift),INVALID_AUTHORITY$1="Invalid authority",INVALID_SCHEME$1="Invalid scheme",INVALID_HOST$1="Invalid host",INVALID_PORT$1="Invalid port",ALPHA$1=/[a-z]/i,ALPHANUMERIC$1=/[\d+-.a-z]/i,DIGIT$1=/\d/,HEX_START$1=/^0x/i,OCT$1=/^[0-7]+$/,DEC$1=/^\d+$/,HEX$1=/^[\da-f]+$/i,FORBIDDEN_HOST_CODE_POINT$1=/[\0\t\n\r #%/:<>?@[\\\]^|]/,FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT$1=/[\0\t\n\r #/:<>?@[\\\]^|]/,LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE$1=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,TAB_AND_NEW_LINE$1=/[\t\n\r]/g,EOF$1,parseIPv4$1=function(e){var t,r,n,i,a,o,s,l=split$4(e,".");if(l.length&&""==l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=l[n]))return e;if(a=10,i.length>1&&"0"==charAt$f(i,0)&&(a=exec$b(HEX_START$1,i)?16:8,i=stringSlice$g(i,8==a?1:2)),""===i)o=0;else{if(!exec$b(10==a?DEC$1:8==a?OCT$1:HEX$1,i))return e;o=parseInt$2(i,a)}push$c(r,o)}for(n=0;n<t;n++)if(o=r[n],n==t-1){if(o>=pow$6(256,5-t))return null}else if(o>255)return null;for(s=pop$1(r),n=0;n<r.length;n++)s+=r[n]*pow$6(256,3-n);return s},parseIPv6$1=function(e){var t,r,n,i,a,o,s,l=[0,0,0,0,0,0,0,0],u=0,c=null,d=0,h=function(){return charAt$f(e,d)};if(":"==h()){if(":"!=charAt$f(e,1))return;d+=2,c=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=r=0;r<4&&exec$b(HEX$1,h());)t=16*t+parseInt$2(h(),16),d++,r++;if("."==h()){if(0==r)return;if(d-=r,u>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;d++}if(!exec$b(DIGIT$1,h()))return;for(;exec$b(DIGIT$1,h());){if(a=parseInt$2(h(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;d++}l[u]=256*l[u]+i,2!=++n&&4!=n||u++}if(4!=n)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;l[u++]=t}else{if(null!==c)return;d++,c=++u}}if(null!==c)for(o=u-c,u=7;0!=u&&o>0;)s=l[u],l[u--]=l[c+o-1],l[c+--o]=s;else if(8!=u)return;return l},findLongestZeroSequence$1=function(e){for(var t=null,r=1,n=null,i=0,a=0;a<8;a++)0!==e[a]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=a),++i);return i>r&&(t=n,r=i),t},serializeHost$1=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)unshift$1(t,e%256),e=floor$e(e/256);return join$7(t,".")}if("object"==_typeof$b(e)){for(t="",n=findLongestZeroSequence$1(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=numberToString$3(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},C0ControlPercentEncodeSet$1={},fragmentPercentEncodeSet$1=assign$5({},C0ControlPercentEncodeSet$1,{" ":1,'"':1,"<":1,">":1,"`":1}),pathPercentEncodeSet$1=assign$5({},fragmentPercentEncodeSet$1,{"#":1,"?":1,"{":1,"}":1}),userinfoPercentEncodeSet$1=assign$5({},pathPercentEncodeSet$1,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),percentEncode$1=function(e,t){var r=codeAt$1(e,0);return r>32&&r<127&&!hasOwn$y(t,e)?e:encodeURIComponent(e)},specialSchemes$1={ftp:21,file:null,http:80,https:443,ws:80,wss:443},isWindowsDriveLetter$1=function(e,t){var r;return 2==e.length&&exec$b(ALPHA$1,charAt$f(e,0))&&(":"==(r=charAt$f(e,1))||!t&&"|"==r)},startsWithWindowsDriveLetter$1=function(e){var t;return e.length>1&&isWindowsDriveLetter$1(stringSlice$g(e,0,2))&&(2==e.length||"/"===(t=charAt$f(e,2))||"\\"===t||"?"===t||"#"===t)},isSingleDot$1=function(e){return"."===e||"%2e"===toLowerCase$2(e)},isDoubleDot$1=function(e){return".."===(e=toLowerCase$2(e))||"%2e."===e||".%2e"===e||"%2e%2e"===e},SCHEME_START$1={},SCHEME$1={},NO_SCHEME$1={},SPECIAL_RELATIVE_OR_AUTHORITY$1={},PATH_OR_AUTHORITY$1={},RELATIVE$1={},RELATIVE_SLASH$1={},SPECIAL_AUTHORITY_SLASHES$1={},SPECIAL_AUTHORITY_IGNORE_SLASHES$1={},AUTHORITY$1={},HOST$1={},HOSTNAME$1={},PORT$1={},FILE$1={},FILE_SLASH$1={},FILE_HOST$1={},PATH_START$1={},PATH$1={},CANNOT_BE_A_BASE_URL_PATH$1={},QUERY$1={},FRAGMENT$1={},URLState$1=function e(t,r,n){var i,a,o,s=$toString$4(t);if(r){if(a=this.parse(s))throw TypeError$9(a);this.searchParams=null}else{if(void 0!==n&&(i=new e(n,!0)),a=this.parse(s,null,i))throw TypeError$9(a);(o=getInternalSearchParamsState$1(new URLSearchParams$2)).bindURL(this),this.searchParams=o}};URLState$1.prototype={type:"URL",parse:function(e,t,r){var n,i,a,o,s=this,l=t||SCHEME_START$1,u=0,c="",d=!1,h=!1,f=!1;for(e=$toString$4(e),t||(s.scheme="",s.username="",s.password="",s.host=null,s.port=null,s.path=[],s.query=null,s.fragment=null,s.cannotBeABaseURL=!1,e=replace$d(e,LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE$1,"")),e=replace$d(e,TAB_AND_NEW_LINE$1,""),n=arrayFrom$2(e);u<=n.length;){switch(i=n[u],l){case SCHEME_START$1:if(!i||!exec$b(ALPHA$1,i)){if(t)return INVALID_SCHEME$1;l=NO_SCHEME$1;continue}c+=toLowerCase$2(i),l=SCHEME$1;break;case SCHEME$1:if(i&&(exec$b(ALPHANUMERIC$1,i)||"+"==i||"-"==i||"."==i))c+=toLowerCase$2(i);else{if(":"!=i){if(t)return INVALID_SCHEME$1;c="",l=NO_SCHEME$1,u=0;continue}if(t&&(s.isSpecial()!=hasOwn$y(specialSchemes$1,c)||"file"==c&&(s.includesCredentials()||null!==s.port)||"file"==s.scheme&&!s.host))return;if(s.scheme=c,t)return void(s.isSpecial()&&specialSchemes$1[s.scheme]==s.port&&(s.port=null));c="","file"==s.scheme?l=FILE$1:s.isSpecial()&&r&&r.scheme==s.scheme?l=SPECIAL_RELATIVE_OR_AUTHORITY$1:s.isSpecial()?l=SPECIAL_AUTHORITY_SLASHES$1:"/"==n[u+1]?(l=PATH_OR_AUTHORITY$1,u++):(s.cannotBeABaseURL=!0,push$c(s.path,""),l=CANNOT_BE_A_BASE_URL_PATH$1)}break;case NO_SCHEME$1:if(!r||r.cannotBeABaseURL&&"#"!=i)return INVALID_SCHEME$1;if(r.cannotBeABaseURL&&"#"==i){s.scheme=r.scheme,s.path=arraySlice$h(r.path),s.query=r.query,s.fragment="",s.cannotBeABaseURL=!0,l=FRAGMENT$1;break}l="file"==r.scheme?FILE$1:RELATIVE$1;continue;case SPECIAL_RELATIVE_OR_AUTHORITY$1:if("/"!=i||"/"!=n[u+1]){l=RELATIVE$1;continue}l=SPECIAL_AUTHORITY_IGNORE_SLASHES$1,u++;break;case PATH_OR_AUTHORITY$1:if("/"==i){l=AUTHORITY$1;break}l=PATH$1;continue;case RELATIVE$1:if(s.scheme=r.scheme,i==EOF$1)s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$h(r.path),s.query=r.query;else if("/"==i||"\\"==i&&s.isSpecial())l=RELATIVE_SLASH$1;else if("?"==i)s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$h(r.path),s.query="",l=QUERY$1;else{if("#"!=i){s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$h(r.path),s.path.length--,l=PATH$1;continue}s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice$h(r.path),s.query=r.query,s.fragment="",l=FRAGMENT$1}break;case RELATIVE_SLASH$1:if(!s.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,l=PATH$1;continue}l=AUTHORITY$1}else l=SPECIAL_AUTHORITY_IGNORE_SLASHES$1;break;case SPECIAL_AUTHORITY_SLASHES$1:if(l=SPECIAL_AUTHORITY_IGNORE_SLASHES$1,"/"!=i||"/"!=charAt$f(c,u+1))continue;u++;break;case SPECIAL_AUTHORITY_IGNORE_SLASHES$1:if("/"!=i&&"\\"!=i){l=AUTHORITY$1;continue}break;case AUTHORITY$1:if("@"==i){d&&(c="%40"+c),d=!0,a=arrayFrom$2(c);for(var p=0;p<a.length;p++){var y=a[p];if(":"!=y||f){var m=percentEncode$1(y,userinfoPercentEncodeSet$1);f?s.password+=m:s.username+=m}else f=!0}c=""}else if(i==EOF$1||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()){if(d&&""==c)return INVALID_AUTHORITY$1;u-=arrayFrom$2(c).length+1,c="",l=HOST$1}else c+=i;break;case HOST$1:case HOSTNAME$1:if(t&&"file"==s.scheme){l=FILE_HOST$1;continue}if(":"!=i||h){if(i==EOF$1||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()){if(s.isSpecial()&&""==c)return INVALID_HOST$1;if(t&&""==c&&(s.includesCredentials()||null!==s.port))return;if(o=s.parseHost(c))return o;if(c="",l=PATH_START$1,t)return;continue}"["==i?h=!0:"]"==i&&(h=!1),c+=i}else{if(""==c)return INVALID_HOST$1;if(o=s.parseHost(c))return o;if(c="",l=PORT$1,t==HOSTNAME$1)return}break;case PORT$1:if(!exec$b(DIGIT$1,i)){if(i==EOF$1||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()||t){if(""!=c){var g=parseInt$2(c,10);if(g>65535)return INVALID_PORT$1;s.port=s.isSpecial()&&g===specialSchemes$1[s.scheme]?null:g,c=""}if(t)return;l=PATH_START$1;continue}return INVALID_PORT$1}c+=i;break;case FILE$1:if(s.scheme="file","/"==i||"\\"==i)l=FILE_SLASH$1;else{if(!r||"file"!=r.scheme){l=PATH$1;continue}if(i==EOF$1)s.host=r.host,s.path=arraySlice$h(r.path),s.query=r.query;else if("?"==i)s.host=r.host,s.path=arraySlice$h(r.path),s.query="",l=QUERY$1;else{if("#"!=i){startsWithWindowsDriveLetter$1(join$7(arraySlice$h(n,u),""))||(s.host=r.host,s.path=arraySlice$h(r.path),s.shortenPath()),l=PATH$1;continue}s.host=r.host,s.path=arraySlice$h(r.path),s.query=r.query,s.fragment="",l=FRAGMENT$1}}break;case FILE_SLASH$1:if("/"==i||"\\"==i){l=FILE_HOST$1;break}r&&"file"==r.scheme&&!startsWithWindowsDriveLetter$1(join$7(arraySlice$h(n,u),""))&&(isWindowsDriveLetter$1(r.path[0],!0)?push$c(s.path,r.path[0]):s.host=r.host),l=PATH$1;continue;case FILE_HOST$1:if(i==EOF$1||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&isWindowsDriveLetter$1(c))l=PATH$1;else if(""==c){if(s.host="",t)return;l=PATH_START$1}else{if(o=s.parseHost(c))return o;if("localhost"==s.host&&(s.host=""),t)return;c="",l=PATH_START$1}continue}c+=i;break;case PATH_START$1:if(s.isSpecial()){if(l=PATH$1,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=EOF$1&&(l=PATH$1,"/"!=i))continue}else s.fragment="",l=FRAGMENT$1;else s.query="",l=QUERY$1;break;case PATH$1:if(i==EOF$1||"/"==i||"\\"==i&&s.isSpecial()||!t&&("?"==i||"#"==i)){if(isDoubleDot$1(c)?(s.shortenPath(),"/"==i||"\\"==i&&s.isSpecial()||push$c(s.path,"")):isSingleDot$1(c)?"/"==i||"\\"==i&&s.isSpecial()||push$c(s.path,""):("file"==s.scheme&&!s.path.length&&isWindowsDriveLetter$1(c)&&(s.host&&(s.host=""),c=charAt$f(c,0)+":"),push$c(s.path,c)),c="","file"==s.scheme&&(i==EOF$1||"?"==i||"#"==i))for(;s.path.length>1&&""===s.path[0];)shift$2(s.path);"?"==i?(s.query="",l=QUERY$1):"#"==i&&(s.fragment="",l=FRAGMENT$1)}else c+=percentEncode$1(i,pathPercentEncodeSet$1);break;case CANNOT_BE_A_BASE_URL_PATH$1:"?"==i?(s.query="",l=QUERY$1):"#"==i?(s.fragment="",l=FRAGMENT$1):i!=EOF$1&&(s.path[0]+=percentEncode$1(i,C0ControlPercentEncodeSet$1));break;case QUERY$1:t||"#"!=i?i!=EOF$1&&("'"==i&&s.isSpecial()?s.query+="%27":s.query+="#"==i?"%23":percentEncode$1(i,C0ControlPercentEncodeSet$1)):(s.fragment="",l=FRAGMENT$1);break;case FRAGMENT$1:i!=EOF$1&&(s.fragment+=percentEncode$1(i,fragmentPercentEncodeSet$1))}u++}},parseHost:function(e){var t,r,n;if("["==charAt$f(e,0)){if("]"!=charAt$f(e,e.length-1))return INVALID_HOST$1;if(!(t=parseIPv6$1(stringSlice$g(e,1,-1))))return INVALID_HOST$1;this.host=t}else if(this.isSpecial()){if(e=toASCII$1(e),exec$b(FORBIDDEN_HOST_CODE_POINT$1,e))return INVALID_HOST$1;if(null===(t=parseIPv4$1(e)))return INVALID_HOST$1;this.host=t}else{if(exec$b(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT$1,e))return INVALID_HOST$1;for(t="",r=arrayFrom$2(e),n=0;n<r.length;n++)t+=percentEncode$1(r[n],C0ControlPercentEncodeSet$1);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return hasOwn$y(specialSchemes$1,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&isWindowsDriveLetter$1(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,a=e.port,o=e.path,s=e.query,l=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=r+(n?":"+n:"")+"@"),u+=serializeHost$1(i),null!==a&&(u+=":"+a)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?o[0]:o.length?"/"+join$7(o,"/"):"",null!==s&&(u+="?"+s),null!==l&&(u+="#"+l),u},setHref:function(e){var t=this.parse(e);if(t)throw TypeError$9(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new URLConstructor$1(e.path[0]).origin}catch(error){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+serializeHost$1(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse($toString$4(e)+":",SCHEME_START$1)},getUsername:function(){return this.username},setUsername:function(e){var t=arrayFrom$2($toString$4(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=percentEncode$1(t[r],userinfoPercentEncodeSet$1)}},getPassword:function(){return this.password},setPassword:function(e){var t=arrayFrom$2($toString$4(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=percentEncode$1(t[r],userinfoPercentEncodeSet$1)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?serializeHost$1(e):serializeHost$1(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,HOST$1)},getHostname:function(){var e=this.host;return null===e?"":serializeHost$1(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,HOSTNAME$1)},getPort:function(){var e=this.port;return null===e?"":$toString$4(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=$toString$4(e))?this.port=null:this.parse(e,PORT$1))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+join$7(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,PATH_START$1))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=$toString$4(e))?this.query=null:("?"==charAt$f(e,0)&&(e=stringSlice$g(e,1)),this.query="",this.parse(e,QUERY$1)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=$toString$4(e))?("#"==charAt$f(e,0)&&(e=stringSlice$g(e,1)),this.fragment="",this.parse(e,FRAGMENT$1)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var URLConstructor$1=function(e){var t=anInstance$e(this,URLPrototype$1),r=validateArgumentsLength$9(arguments.length,1)>1?arguments[1]:void 0,n=setInternalState$d(t,new URLState$1(e,!1,r));DESCRIPTORS$H||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},URLPrototype$1=URLConstructor$1.prototype,accessorDescriptor$1=function(e,t){return{get:function(){return getInternalURLState$1(this)[e]()},set:t&&function(e){return getInternalURLState$1(this)[t](e)},configurable:!0,enumerable:!0}};if(DESCRIPTORS$H&&(defineBuiltInAccessor$6(URLPrototype$1,"href",accessorDescriptor$1("serialize","setHref")),defineBuiltInAccessor$6(URLPrototype$1,"origin",accessorDescriptor$1("getOrigin")),defineBuiltInAccessor$6(URLPrototype$1,"protocol",accessorDescriptor$1("getProtocol","setProtocol")),defineBuiltInAccessor$6(URLPrototype$1,"username",accessorDescriptor$1("getUsername","setUsername")),defineBuiltInAccessor$6(URLPrototype$1,"password",accessorDescriptor$1("getPassword","setPassword")),defineBuiltInAccessor$6(URLPrototype$1,"host",accessorDescriptor$1("getHost","setHost")),defineBuiltInAccessor$6(URLPrototype$1,"hostname",accessorDescriptor$1("getHostname","setHostname")),defineBuiltInAccessor$6(URLPrototype$1,"port",accessorDescriptor$1("getPort","setPort")),defineBuiltInAccessor$6(URLPrototype$1,"pathname",accessorDescriptor$1("getPathname","setPathname")),defineBuiltInAccessor$6(URLPrototype$1,"search",accessorDescriptor$1("getSearch","setSearch")),defineBuiltInAccessor$6(URLPrototype$1,"searchParams",accessorDescriptor$1("getSearchParams")),defineBuiltInAccessor$6(URLPrototype$1,"hash",accessorDescriptor$1("getHash","setHash"))),defineBuiltIn$q(URLPrototype$1,"toJSON",(function(){return getInternalURLState$1(this).serialize()}),{enumerable:!0}),defineBuiltIn$q(URLPrototype$1,"toString",(function(){return getInternalURLState$1(this).serialize()}),{enumerable:!0}),NativeURL$1){var nativeCreateObjectURL$1=NativeURL$1.createObjectURL,nativeRevokeObjectURL$1=NativeURL$1.revokeObjectURL;nativeCreateObjectURL$1&&defineBuiltIn$q(URLConstructor$1,"createObjectURL",bind$i(nativeCreateObjectURL$1,NativeURL$1)),nativeRevokeObjectURL$1&&defineBuiltIn$q(URLConstructor$1,"revokeObjectURL",bind$i(nativeRevokeObjectURL$1,NativeURL$1))}setToStringTag$f(URLConstructor$1,"URL"),$$1U({global:!0,constructor:!0,forced:!USE_NATIVE_URL$2,sham:!DESCRIPTORS$H},{URL:URLConstructor$1});var web_urlSearchParams={},INFO="info",STATS_EVENTS$1=STATS_EVENTS$2,Stats$2=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"_recordUserActions",(function(t){var r=e._getTime(),n=Object.assign({},t,{msg:t.msg||t.action});e._stats[INFO].push(_objectSpread2$b(_objectSpread2$b({type:"userAction"},r),{},{payload:n}))})),_defineProperty$i(_assertThisInitialized$f(e),"_onReset",(function(){e.reset()})),_defineProperty$i(_assertThisInitialized$f(e),"_recordInfo",(function(t){e.info(t)})),_defineProperty$i(_assertThisInitialized$f(e),"_downloadStats",(function(){var t=e.getStats(),r=new Blob([JSON.stringify(t)],{type:"application/json"}),n=window.URL.createObjectURL(r),i=document.createElement("a");i.style.display="none",i.href=n,i.download="player.txt",i.disabled=!1,i.click()})),e}return _createClass$j(r,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:(new Date).toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(USER_ACTION,this._recordUserActions),this.on(STATS_EVENTS$1.STATS_INFO,this._recordInfo),this.on(STATS_EVENTS$1.STATS_DOWNLOAD,this._downloadStats),this.on(STATS_EVENTS$1.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var t=this._getTime();this._stats[INFO].push(_objectSpread2$b(_objectSpread2$b({},t),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var t=_objectSpread2$b({cat:"function",dur:Date.now()-e.startMs,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(t)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(_defineProperty$i(e={},INFO,[]),_defineProperty$i(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player.video,t=[],r=0;r<e.buffered.length;r++)t.push({start:e.buffered.start(r),end:e.buffered.end(r)});var n={currentTime:e.currentTime,readyState:e.readyState,buffered:t,paused:e.paused,ended:e.ended};return this._stats.media=n,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){return this._stats[INFO].map((function(e){var t=e.payload.data,r="";try{t instanceof Error?r=t.msg:void 0!==t&&(r=JSON.stringify(t))}catch(error){console.log("err",error)}return"[".concat(e.timeFormat,"] : ").concat(e.payload.msg," ").concat(r," ")}))}},{key:"_getProfile",value:function(){var e={traceEvents:[]};return this._stats[INFO].forEach((function(t){t.payload.profile&&e.traceEvents.push(t.payload)})),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),r}(BasePlugin),GapJump$2=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"onGapJump",(function(){var t=_assertThisInitialized$f(e),n=t.player,i=t.config;if(n.video.readyState!==HTMLMediaElement.HAVE_NOTHING){if(n.video.seeking){if(!e.seekingEventReceived)return}else e.seekingEventReceived=!1;if(!n.video.paused||0===n.video.currentTime||!e.hasPlayed){var a=n.video.buffered,o=i.smallGapLimit||.5,s=i.gapDetectionThreshold||.3,l=n.video.currentTime,u=e._getIndex(a,l,s);if(null!==u&&0!==u){console.log("GapJump  bufferRange ",a.start(u),a.end(u));var c=a.start(u)+.1;if(!(c>n.video.duration)){var d=c-l,h=d<=o;d<r.BROWSER_GAP_TOLERANCE||h&&(!1!==i.useGapJump&&(n.video.currentTime=e.isSafari?c+.1:c),e.player&&e.player.emit("detectGap"),console.log("gapJump gapIndex",u," isGapSamll:",h," currentTime:",n.video.currentTime," jumpSize:",l-n.video.currentTime),.08!==c&&n&&n.emit("log",{type:"oneevent",end_type:"gap",vid:n.config.vid,ext:{video_postion:Math.floor(1e3*c)}}))}}}}})),e}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;!1!==this.config.useGapJump&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(WAITING,this.onGapJump),this.on(PLAY,(function(){e.hasPlayed=!0})),this.on(SEEKING,(function(){e.seekingEventReceived=!0})))}},{key:"_getIndex",value:function(e,t,r){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var n=this._getBuffered(e),i=null,a=0;a<n.length;a++){if(n[a].start>t&&(0===a||n[a-1].end-t<=r)){i=a;break}}return i}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),r}(Plugin);GapJump$2.BROWSER_GAP_TOLERANCE=.001;var WaitingTimeoutJump=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"onWaiting",(function(){var t=_assertThisInitialized$f(e).config;e.jumpCnt>t.jumpCntMax||e.timer||!1===t.useWaitingTimeoutJump||(e.timer=setTimeout(e.onJump,1e3*t.waitingTime))})),_defineProperty$i(_assertThisInitialized$f(e),"onJump",(function(){var t=_assertThisInitialized$f(e),r=t.player,n=t.config;if(clearTimeout(e.timer),e.timer=null,!(e.jumpCnt>n.jumpCntMax||!1===n.useWaitingTimeoutJump||r.video.paused&&0!==r.video.currentTime&&e.hasPlayed)){e.jumpSize=n.jumpSize*(e.jumpCnt+1),e.jumpCnt===n.jumpSize&&e.jumpSize<6&&(e.jumpSize=6);var i=r.currentTime+e.jumpSize;i>r.video.duration||(console.log("waitintTimeout, currentTime:",r.currentTime,", jumpTo:",i),e.jumpCnt++,r.currentTime=i)}})),e}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this,t=this.config,r=t.useWaitingTimeoutJump,n=t.jumpSize;!1!==r&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=n,this.on(WAITING,this.onWaiting),this.on([PLAYING,CANPLAY],(function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize})),this.on(PLAY,(function(){e.hasPlayed=!0})))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),r}(Plugin),TestSpeed=function(t){_inherits$f(n,t);var r=_createSuper$i(n);function n(){var t;_classCallCheck$i(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return _defineProperty$i(_assertThisInitialized$f(t=r.call.apply(r,[this].concat(a))),"getSpeed",(function(e){if(t.speedListCache.length<=0)return 0;var r=0;return t.speedListCache.map((function(e){r+=e})),Math.floor(r/t.speedListCache.length)})),_defineProperty$i(_assertThisInitialized$f(t),"_onRealSpeedChange",(function(e){e.speed&&t.appendList(e.speed)})),_defineProperty$i(_assertThisInitialized$f(t),"testSpeed",(function(){if(clearTimeout(t.timer),t.timer=null,t.player&&t.config.openSpeed){var r=t.config,n=r.url,i=r.loadSize,a=r.testCnt,o=r.testTimeStep,s=n+(n.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(t.cnt>=a)){t.cnt++;try{var l=(new Date).getTime(),u=null,c=new XMLHttpRequest;t.xhr=c,c.open("GET",s);var d={},h=Math.floor(10*Math.random());d.Range="bytes="+h+"-"+(i+h),d&&Object.keys(d).forEach((function(e){c.setRequestHeader(e,d[e])})),c.onreadystatechange=function(){if(4===c.readyState){t.xhr=null,u=(new Date).getTime();var e=c.getResponseHeader("Content-Length")/1024*8,r=Math.round(1e3*e/(u-l));t.appendList(r),t.timer=setTimeout(t.testSpeed,o)}},c.send()}catch(e){console.error(e)}}}})),_defineProperty$i(_assertThisInitialized$f(t),"appendList",(function(e){var r=t.config.saveSpeedMax;t.speedListCache.length>=r&&t.speedListCache.shift(),t.speedListCache.push(e),t.player&&(t.player.realTimeSpeed=e),t.updateSpeed()})),_defineProperty$i(_assertThisInitialized$f(t),"updateSpeed",(function(){var e=t.getSpeed(),r=_assertThisInitialized$f(t).player;!r||r.avgSpeed&&e===r.avgSpeed||(r.avgSpeed=e,r.emit(DOWNLOAD_SPEED_CHANGE,{speed:e,realTimeSpeed:r.realTimeSpeed}))})),t}return _createClass$j(n,[{key:"afterCreate",value:function(){var e=this;this.speedListCache=[];var t=this.config,r=t.openSpeed,n=t.testTimeStep;this.timer=null,this.cnt=0,this.xhr=null,r&&(this.on("real_time_speed",this._onRealSpeedChange),this.on([LOADED_DATA,REPLAY],(function(){util$2.isMSE(e.player.video)||(e.speedListCache=[],e.cnt=0,e.timer=setTimeout(e.testSpeed,n))})))}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer)return clearTimeout(this.timer),void(this.timer=null);if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){clearTimeout(this.timer),this.timer=null,this.xhr&&4!==this.xhr.readyState&&(this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:204800,testTimeStep:3e3,url:"",saveSpeedMax:5}}}]),n}(Plugin);I18N.use(ZH);var DefaultPreset$3=_createClass$j((function e(t,r){var n,i,a;_classCallCheck$i(this,e);var o=r&&"mobile"===r.isMobileSimulateMode,s=r.isLive,l=[].concat(s?[]:[Progress,MiniProgress,ProgressPreview,Time],[Play,Fullscreen,Rotate,PlayNextIcon,DefinitionIcon,PlaybackRate,Download,ScreenShot,Volume,PIP]),u=[Replay,Poster,Start,Loading,Enter,ErrorPlugin$1,Prompt,Thumbnail,MiniScreen];this.plugins=[Stats$2,Xglogger].concat(_toConsumableArray$9(l),u,[GapJump$2,WaitingTimeoutJump]);var c=o?"mobile":sniffer$1.device;switch(c){case"pc":(n=this.plugins).push.apply(n,[Keyboard,PCPlugin,CssFullScreen,TestSpeed]);break;case"mobile":(i=this.plugins).push.apply(i,[MobilePlugin]);break;default:(a=this.plugins).push.apply(a,[Keyboard,PCPlugin,CssFullScreen])}(sniffer$1.os.isIpad||"pc"===c)&&this.plugins.push(DynamicBg),sniffer$1.os.isIpad&&this.plugins.push(PCPlugin),this.ignores=[],this.i18n=[]})),PresetPlayer=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r)}(Player);_defineProperty$i(PresetPlayer,"defaultPreset",DefaultPreset$3),_defineProperty$i(PresetPlayer,"Util",util$2),_defineProperty$i(PresetPlayer,"Sniffer",sniffer$1),_defineProperty$i(PresetPlayer,"Errors",Errors$1),_defineProperty$i(PresetPlayer,"Events",Events$1),_defineProperty$i(PresetPlayer,"Plugin",Plugin),_defineProperty$i(PresetPlayer,"BasePlugin",BasePlugin),_defineProperty$i(PresetPlayer,"I18N",I18N),_defineProperty$i(PresetPlayer,"STATE_CLASS",STATE_CLASS);var DefaultPreset$2=_createClass$j((function e(t,r){var n,i,a;_classCallCheck$i(this,e);var o=r&&"mobile"===r.isMobileSimulateMode,s=r.isLive,l=[].concat(s?[]:[Progress,MiniProgress,ProgressPreview,Time],[Play,Fullscreen,Rotate,PlayNextIcon,DefinitionIcon,PlaybackRate,Download,ScreenShot,Volume,PIP]),u=[Replay,Poster,Start,Loading,Enter,ErrorPlugin$1,Prompt,Thumbnail,MiniScreen];this.plugins=[Stats$2,Xglogger].concat(_toConsumableArray$9(l),u,[GapJump$2,WaitingTimeoutJump]);var c=o?"mobile":sniffer$1.device;switch(c){case"pc":(n=this.plugins).push.apply(n,[Keyboard,PCPlugin,CssFullScreen,TestSpeed]);break;case"mobile":(i=this.plugins).push.apply(i,[MobilePlugin]);break;default:(a=this.plugins).push.apply(a,[Keyboard,PCPlugin,CssFullScreen])}(sniffer$1.os.isIpad||"pc"===c)&&this.plugins.push(DynamicBg),this.ignores=[],this.i18n=[]})),DefaultPreset$1=_createClass$j((function e(){var t,r;_classCallCheck$i(this,e);var n=[Play,Fullscreen,Time,Volume,Rotate,DefinitionIcon,PlaybackRate,CssFullScreen,PIP];switch(this.plugins=[Poster,Start,Loading,Enter,ErrorPlugin$1].concat(n),sniffer$1.device){case"pc":(t=this.plugins).push.apply(t,[Keyboard,PCPlugin]);break;case"mobile":this.plugins.push(MobilePlugin);break;default:(r=this.plugins).push.apply(r,[Keyboard,PCPlugin])}this.ignores=[],this.i18n=[ZH]})),DefaultPreset=_createClass$j((function e(){_classCallCheck$i(this,e);var t=[MobilePlugin,Progress,Play,Fullscreen,Time,Rotate,PlayNextIcon,DefinitionIcon,PlaybackRate,Download,ScreenShot,Volume,PIP],r=[Replay,Poster,Start,Loading,Enter,ErrorPlugin$1,Prompt,Thumbnail,MiniProgress];this.plugins=[Xglogger].concat(t,r),this.ignores=[],this.i18n=[ZH]})),zhHk={LANG:"zh-hk",TEXT:{ERROR_TYPES:{network:{code:1,msg:""},mse:{code:2,msg:""},parse:{code:3,msg:""},format:{code:4,msg:""},decoder:{code:5,msg:""},runtime:{code:6,msg:""},timeout:{code:7,msg:""},other:{code:8,msg:""}},HAVE_NOTHING:"/",HAVE_METADATA:"/",HAVE_CURRENT_DATA:"/",HAVE_FUTURE_DATA:"",HAVE_ENOUGH_DATA:"",NETWORK_EMPTY:"/",NETWORK_IDLE:"/",NETWORK_LOADING:"",NETWORK_NO_SOURCE:"/",MEDIA_ERR_ABORTED:"",MEDIA_ERR_NETWORK:"",MEDIA_ERR_DECODE:"",MEDIA_ERR_SRC_NOT_SUPPORTED:"/",REPLAY:"",ERROR:"",PLAY_TIPS:"",PAUSE_TIPS:"",PLAYNEXT_TIPS:"",DOWNLOAD_TIPS:"",ROTATE_TIPS:"",RELOAD_TIPS:"",FULLSCREEN_TIPS:"",EXITFULLSCREEN_TIPS:"",CSSFULLSCREEN_TIPS:"",EXITCSSFULLSCREEN_TIPS:"",TEXTTRACK:"",PIP:"",SCREENSHOT:"",LIVE:"",OFF:"",OPEN:"",MINI_DRAG:"",MINISCREEN:"",REFRESH_TIPS:"",REFRESH:"",FORWARD:"",LIVE_TIP:""}},jp$1={LANG:"jp",TEXT:{ERROR_TYPES:{network:{code:1,msg:""},mse:{code:2,msg:""},parse:{code:3,msg:""},format:{code:4,msg:""},decoder:{code:5,msg:""},runtime:{code:6,msg:""},timeout:{code:7,msg:""},other:{code:8,msg:""}},HAVE_NOTHING:"/",HAVE_METADATA:"/",HAVE_CURRENT_DATA:"/",HAVE_FUTURE_DATA:"",HAVE_ENOUGH_DATA:"",NETWORK_EMPTY:"/",NETWORK_IDLE:"/",NETWORK_LOADING:"",NETWORK_NO_SOURCE:"/ ",MEDIA_ERR_ABORTED:"",MEDIA_ERR_NETWORK:"",MEDIA_ERR_DECODE:"",MEDIA_ERR_SRC_NOT_SUPPORTED:"/ ",REPLAY:"",ERROR:"",PLAY_TIPS:"",PAUSE_TIPS:"",PLAYNEXT_TIPS:"",DOWNLOAD_TIPS:"",ROTATE_TIPS:"",RELOAD_TIPS:"",FULLSCREEN_TIPS:"",EXITFULLSCREEN_TIPS:"",CSSFULLSCREEN_TIPS:"",EXITCSSFULLSCREEN_TIPS:"",TEXTTRACK:"",PIP:"",SCREENSHOT:"",LIVE:"",OFF:"",OPEN:"",MINI_DRAG:"",MINISCREEN:"",REFRESH:"",REFRESH_TIPS:"",FORWARD:"",LIVE_TIP:""}},dist$3={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$b(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){function n(e,t){return e.classList?Array.prototype.some.call(e.classList,(function(e){return e===t})):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function i(e,t){e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)})):n(e,t)||(e.className+=" "+t)}function a(e,t){e.classList?t.split(/\s+/g).forEach((function(t){e.classList.remove(t)})):n(e,t)&&t.split(/\s+/g).forEach((function(t){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ")}))}function o(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}Object.defineProperty(t,"__esModule",{value:!0}),t.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Object.keys(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i},t.hasClass=n,t.addClass=i,t.removeClass=a,t.toggleClass=function(e,t){t.split(/\s+/g).forEach((function(t){n(e,t)?a(e,t):i(e,t)}))},t.findDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments[1],r=void 0;try{r=e.querySelector(t)}catch(n){t.startsWith("#")&&(r=e.getElementById(t.slice(1)))}return r},t.deepCopy=function e(t,r){if("Object"===o(r)&&"Object"===o(t))return Object.keys(r).forEach((function(n){"Object"!==o(r[n])||r[n]instanceof Node?"Array"===o(r[n])?t[n]="Array"===o(t[n])?t[n].concat(r[n]):r[n]:t[n]=r[n]:t[n]?e(t[n],r[n]):t[n]=r[n]})),t},t.typeOf=o,t.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},t.attachEventListener=function(e,t,r,n){var i,a,o,s;n?(e.on(t,r),a=t,o=r,s=n,(i=e).once(s,(function e(){i.off(a,o),i.off(s,e)}))):e.on(t,(function n(i){r(i),e.off(t,n)}))},t.styleUtil=function(e,t,r){var n=e.style;try{n[t]=r}catch(i){n.setProperty(t,r)}},t.isNumber=function(e){return"number"==typeof e&&!Number.isNaN(e)},t.throttle=function(e,t){var r=this,n=0;return function(){for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];clearTimeout(n),n=setTimeout((function(){return e.apply(r,a)}),t)}},t.hasOwnProperty=Object.prototype.hasOwnProperty},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(26))&&n.__esModule?n:{default:n},o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"setLogger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.logger=new a.default(e+".js")}}]),e}();t.default=o,e.exports=t.default},function(e,t,r){var n=r(18)();e.exports=function(e){return e!==n&&null!==e}},function(e,t,r){e.exports=function(e){return null!=e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r(5))&&n.__esModule?n:{default:n};r(34),t.default=i.default,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DanmuJs=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=d(r(6)),a=r(25),o=d(r(1)),s=d(r(27)),l=d(r(32)),u=r(33),c=r(0);function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}var f=t.DanmuJs=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=r;n.setLogger("danmu"),n.logger&&n.logger.info("danmu.js version: "+a.version);var o=n.config={overlap:!1,area:{start:0,end:1,lines:void 0},live:!1,comments:[],direction:"r2l",needResizeObserver:!1,dropStaleComments:!1,channelSize:void 0,maxCommentsLength:void 0,bulletOffset:void 0,interval:2e3};if((0,c.deepCopy)(o,e),(0,i.default)(n),n.hideArr=[],n.domObj=new l.default,n.freezeId=null,o.comments.forEach((function(e){e.duration=e.duration?e.duration:5e3,e.mode||(e.mode="scroll")})),n.container=o.container&&1===o.container.nodeType?o.container:null,!n.container)return n.emit("error","container id can't be empty"),h(r,!1);if(o.containerStyle){var u=o.containerStyle;Object.keys(u).forEach((function(e){n.container.style[e]=u[e]}))}return n.live=o.live,n.player=o.player,n.direction=o.direction,(0,c.addClass)(n.container,"danmu"),n.bulletBtn=new s.default(n),n.main=n.bulletBtn.main,n.isReady=!0,n.emit("ready"),r.logger&&r.logger.info("ready"),r.addResizeObserver(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"addResizeObserver",value:function(){var e=this;this.config.needResizeObserver&&(0,u.addObserver)(this.container,(function(){e.logger&&e.logger.info("needResizeObserver"),e.resize()}))}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.main.clear()}},{key:"destroy",value:function(){for(var e in(0,u.unObserver)(this.container),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn.destroy(),this.domObj.destroy(),this)delete this[e];this.emit("destroy")}},{key:"sendComment",value:function(e){this.logger&&this.logger.info("sendComment: "+(e.txt||"[DOM Element]"));var t=this.main;e.duration||(e.duration=15e3),e&&e.id&&e.duration&&(e.el||e.txt)&&(e.duration=e.duration?e.duration:5e3,e.style||(e.style={opacity:void 0,fontSize:void 0}),e.style&&(this.opacity&&this.opacity!==e.style.opacity&&(e.style.opacity=this.opacity),this.fontSize&&this.fontSize!==e.style.fontSize&&(e.style.fontSize=this.fontSize)),e.prior||e.realTime?(t.data.unshift(e),e.realTime&&(t.readData(),t.dataHandle())):t.data.push(e),t.keepPoolWatermark())}},{key:"setCommentID",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentID: oldID "+e+" newID "+t),e&&t&&(this.main.data.some((function(r){return r.id===e&&(r.id=t,!0)})),this.main.queue.some((function(n){return n.id===e&&(n.id=t,n.pauseMove(),"paused"!==r.main.status&&n.startMove(),!0)})))}},{key:"setCommentDuration",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentDuration: id "+e+" duration "+t),e&&t&&(t=t||5e3,this.main.data.some((function(r){return r.id===e&&(r.duration=t,!0)})),this.main.queue.some((function(n){return n.id===e&&(n.duration=t,n.pauseMove(),"paused"!==r.main.status&&n.startMove(),!0)})))}},{key:"setCommentLike",value:function(e,t){this.logger&&this.logger.info("setCommentLike: id "+e+" like "+t),e&&t&&(this.main.data.some((function(r){return r.id===e&&(r.like=t,!0)})),this.main.queue.some((function(r){return r.id===e&&(r.pauseMove(),r.setLikeDom(t.el,t.style),"paused"!==r.danmu.main.status&&r.startMove(),!0)})))}},{key:"restartComment",value:function(e){if(this.logger&&this.logger.info("restartComment: id "+e),e){var t=this.main;if(this._releaseCtrl(e),"closed"===t.status)return;t.queue.some((function(r){return r.id===e&&("paused"!==t.status?r.startMove(!0):r.status="paused",!0)}))}}},{key:"_releaseCtrl",value:function(e){this.freezeId&&e===this.freezeId&&(this.mouseControl=!1,this.freezeId=null)}},{key:"_freezeCtrl",value:function(e){this.mouseControl=!0,this.freezeId=e}},{key:"freezeComment",value:function(e){this.logger&&this.logger.info("freezeComment: id "+e),e&&(this._freezeCtrl(e),this.main.queue.some((function(t){return t.id===e&&(t.status="forcedPause",t.pauseMove(),t.el&&t.el.style&&(0,c.styleUtil)(t.el,"zIndex",10),!0)})))}},{key:"removeComment",value:function(e){this.logger&&this.logger.info("removeComment: id "+e),e&&(this._releaseCtrl(e),this.main.queue.some((function(t){return t.id===e&&(t.remove(),!0)})),this.main.data=this.main.data.filter((function(t){return t.id!==e})))}},{key:"updateComments",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.logger&&this.logger.info("updateComments: "+e.length+", isClear "+t);var r=this.main;"boolean"==typeof t&&t&&(r.data=[]),r.data=r.data.concat(e),r.sortData(),r.keepPoolWatermark()}},{key:"willChange",value:function(){var e=this.container,t=this.main;e.style.willChange="opacity",t.willChanges.push("contents"),t.queue.forEach((function(e){e.willChange()}))}},{key:"stopWillChange",value:function(){this.container.style.willChange="",this.main.willChanges.splice(0),this.main.queue.forEach((function(e){e.willChange()}))}},{key:"setAllDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",t=this,r=arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger&&this.logger.info("setAllDuration: mode "+e+" duration "+r+" force "+n),r&&(r=r||5e3,n&&(this.main.forceDuration=r),this.main.data.forEach((function(t){e===t.mode&&(t.duration=r)})),this.main.queue.forEach((function(n){e===n.mode&&(n.duration=r,n.pauseMove(),"paused"!==t.main.status&&n.startMove())})))}},{key:"setPlayRate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",r=arguments[1];this.logger&&this.logger.info("setPlayRate: "+r),(0,c.isNumber)(r)&&r>0&&(this.main.playRate=r,this.main.queue.forEach((function(r){t===r.mode&&(r.pauseMove(),"paused"!==e.main.status&&r.startMove())})))}},{key:"setOpacity",value:function(e){this.logger&&this.logger.info("setOpacity: opacity "+e),this.container.style.opacity=e}},{key:"setFontSize",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{reflow:!0};this.logger&&this.logger.info("setFontSize: size "+e+" channelSize "+t),this.fontSize=e+"px",e&&(this.main.data.forEach((function(e){e.style&&(e.style.fontSize=r.fontSize)})),this.main.queue.forEach((function(e){e.options.style||(e.options.style={}),e.options.style.fontSize=r.fontSize,e.setFontSize(r.fontSize),t&&(e.top=e.channel_id[0]*t,e.topInit())}))),t&&(this.config.channelSize=t,n.reflow&&this.main.channel.resizeSync())}},{key:"setArea",value:function(e){this.logger&&this.logger.info("setArea: area "+e),this.config.area=e,!1!==e.reflow&&this.main.channel.resizeSync()}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode "+e),this.hideArr.indexOf(e)<0&&this.hideArr.push(e),this.main.queue.filter((function(t){return e===t.mode||"color"===e&&t.color})).forEach((function(e){return e.remove()}))}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode "+e);var t=this.hideArr.indexOf(e);t>-1&&this.hideArr.splice(t,1)}},{key:"setDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction "+e),this.emit("changeDirection",e)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}},{key:"status",get:function(){return this.main.status}},{key:"state",get:function(){var e=this.main;return{status:e.status,comments:e.data,bullets:e.queue,displayArea:e.channel.getRealOccupyArea()}}},{key:"containerPos",get:function(){return this.main.channel.containerPos}}]),t}(o.default);t.default=f},function(e,t,r){var n,i,a,o,s,l,u,c=r(7),d=r(24),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,y=Object.defineProperty,m=Object.defineProperties,g=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var r,i;return d(t),i=this,n.call(this,e,r=function(){a.call(i,e,r),h.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:n=function(e,t){var r;return d(t),g.call(this,"__ee__")?r=this.__ee__:(r=v.value=p(null),y(this,"__ee__",v),v.value=null),r[e]?"object"==_typeof$b(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:i,off:a=function(e,t){var r,n,i,a;if(d(t),!g.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==_typeof$b(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:o=function(e){var t,r,n,i,a;if(g.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==_typeof$b(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)h.call(n,this,a)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];h.call(i,this,a)}}},l={on:c(n),once:c(i),off:c(a),emit:c(o)},u=m({},l),e.exports=t=function(e){return null==e?p(u):m(Object(e),l)},t.methods=s},function(e,t,r){var n=r(3),i=r(8),a=r(12),o=r(20),s=r(21);(e.exports=function(e,t){var r,i,l,u,c;return arguments.length<2||"string"!=typeof e?(u=t,t=e,e=null):u=arguments[2],n(e)?(r=s.call(e,"c"),i=s.call(e,"e"),l=s.call(e,"w")):(r=l=!0,i=!1),c={value:t,configurable:r,enumerable:i,writable:l},u?a(o(u),c):c}).gs=function(e,t,r){var l,u,c,d;return"string"!=typeof e?(c=r,r=t,t=e,e=null):c=arguments[3],n(t)?i(t)?n(r)?i(r)||(c=r,r=void 0):r=void 0:(c=t,t=r=void 0):t=void 0,n(e)?(l=s.call(e,"c"),u=s.call(e,"e")):(l=!0,u=!1),d={get:t,set:r,configurable:l,enumerable:u},c?a(o(c),d):d}},function(e,t,r){var n=r(9),i=/^\s*class[\s{/}]/,a=Function.prototype.toString;e.exports=function(e){return!!n(e)&&!i.test(a.call(e))}},function(e,t,r){var n=r(10);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(t){return!1}return!n(e)}},function(e,t,r){var n=r(11);e.exports=function(e){if(!n(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}}},function(e,t,r){var n=r(3),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!n(e)&&hasOwnProperty.call(i,_typeof$b(e))}},function(e,t,r){e.exports=r(13)()?Object.assign:r(14)},function(e,t,r){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,r){var n=r(15),i=r(19),a=Math.max;e.exports=function(e,t){var r,o,s,l=a(arguments.length,2);for(e=Object(i(e)),s=function(n){try{e[n]=t[n]}catch(i){r||(r=i)}},o=1;o<l;++o)n(t=arguments[o]).forEach(s);if(void 0!==r)throw r;return e}},function(e,t,r){e.exports=r(16)()?Object.keys:r(17)},function(e,t,r){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,r){var n=r(2),i=Object.keys;e.exports=function(e){return i(n(e)?Object(e):e)}},function(e,t,r){e.exports=function(){}},function(e,t,r){var n=r(2);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,r){var n=r(2),i=Array.prototype.forEach,a=Object.create,o=function(e,t){var r;for(r in e)t[r]=e[r]};e.exports=function(e){var t=a(null);return i.call(arguments,(function(e){n(e)&&o(Object(e),t)})),t}},function(e,t,r){e.exports=r(22)()?String.prototype.contains:r(23)},function(e,t,r){var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},function(e,t,r){var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e){e.exports=JSON.parse('{"version":"1.1.5"}')},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructorName=t||""}return n(e,[{key:"info",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];i&&(t=console).log.apply(t,["[Danmu Log]["+this.constructorName+"]",e].concat(n))}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(1)),a=s(r(28)),o=r(0);function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setLogger("control"),r.danmu=e,r.main=new a.default(e),e.config.defaultOff||r.main.start(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"createSwitch",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=(0,o.createDom)("dk-switch",'<span class="txt"></span>',{},"danmu-switch "+(e?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)o.hasOwnProperty.call(this,e)&&delete this[e]}}]),t}(i.default);t.default=l,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=l(r(1)),a=l(r(29)),o=l(r(30)),s=r(0);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setLogger("main"),r.danmu=e,r.container=e.container,r.channel=new o.default(e),r.data=[].concat(e.config.comments),r.playedData=[],r.queue=[],r.timer=null,r.playRate=1,r.retryStatus="normal",r.interval=e.config.interval,r.willChanges=[],r._status="idle",(0,s.attachEventListener)(e,"bullet_remove",r.updateQueue.bind(r),"destroy"),(0,s.attachEventListener)(e,"changeDirection",(function(e){r.danmu.direction=e}),"destroy"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"_cancelDataHandleTimer",value:function(){this.handleId&&(clearTimeout(this.handleId),this.handleId=null),this.handleTimer&&(clearTimeout(this.handleTimer),this.handleTimer=null)}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this._cancelDataHandleTimer(),this.channel.destroy(),this.data=[],this)delete this[e]}},{key:"updateQueue",value:function(e){this.logger&&this.logger.info("updateQueue");var t=this;t.queue.some((function(r,n){return r.id===e.bullet.id&&(t.queue.splice(n,1),!0)})),t.data.some((function(t){return t.id===e.bullet.id&&(t.attached_=!1,!0)}))}},{key:"init",value:function(){var e=this;e.retryStatus="normal",e.sortData(),function t(){"closed"!==e._status||"stop"!==e.retryStatus?("playing"===e._status&&(e.readData(),e.dataHandle()),"stop"===e.retryStatus&&"paused"!==e._status||(e.handleTimer=setTimeout((function(){e.handleId=requestAnimationFrame((function(){t()}))}),250))):e._cancelDataHandleTimer()}()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this._status="playing",this.queue=[],this.container.innerHTML="",this.channel.reset(),this.init()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this._status="closed",this.retryStatus="stop",this.queue=[],this.container.innerHTML="",this.channel.reset()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel.reset(),this.data=[],this.queue=[],this.container.innerHTML=""}},{key:"play",value:function(){var e=this;if("closed"!==this._status){this.logger&&this.logger.info("play"),this._status="playing";var t=this.channel.channels;t&&t.length>0&&["scroll","top","bottom"].forEach((function(r){e.queue.forEach((function(e){e.startMove(),e.resized=!0}));for(var n=0;n<t.length;n++)t[n].queue[r].forEach((function(e){e.resized=!1}))}))}else this.logger&&this.logger.info("play ignored")}},{key:"pause",value:function(){if("closed"!==this._status){this.logger&&this.logger.info("pause"),this._status="paused";var e=this.channel.channels;e&&e.length>0&&this.queue.forEach((function(e){e.pauseMove()}))}else this.logger&&this.logger.info("pause ignored")}},{key:"dataHandle",value:function(){"paused"!==this._status&&"closed"!==this._status&&this.queue.length&&this.queue.forEach((function(e){"waiting"===e.status&&e.startMove()}))}},{key:"readData",value:function(){if(this.danmu.isReady){var e=this,t=this.danmu,r=t.player,n=e.interval,i=e.channel,o=void 0,l=void 0;if(r){var u=r.currentTime?Math.floor(1e3*r.currentTime):0;l=e.data.filter((function(t){return!t.start&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&(t.start=u),!t.attached_&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&t.start-n<=u&&u<=t.start+n})),t.live&&(e.data=[])}else 0===(l=e.data.splice(0,1)).length&&(l=e.playedData.splice(0,1));if(l.length>0){i.updatePos();var c=2;e:for(var d,h=0;h<l.length;h++)if(d=l[h],e.forceDuration&&e.forceDuration!==d.duration&&(d.duration=e.forceDuration),(o=new a.default(t,d))&&!o.bulletCreateFail)if(o.attach(),d.attached_=!0,i.addBullet(o).result)e.queue.push(o),o.topInit(),c=2;else{for(var f in o.detach(),o)s.hasOwnProperty.call(o,f)&&delete o[f];if(o=null,d.attached_=!1,d.noDiscard&&(d.prior?e.data.unshift(d):e.data.push(d)),0===c)break e;c--}else{if(0===c)break e;c--}}}}},{key:"sortData",value:function(){this.data.sort((function(e,t){return(e.start||-1)-(t.start||-1)}))}},{key:"keepPoolWatermark",value:function(){var e=this.danmu,t=e.config,r=e.player,n=this.data,i=[],a=0;if("number"==typeof t.maxCommentsLength&&n.length>t.maxCommentsLength){a=n.length-t.maxCommentsLength;for(var o,s=0;s<a;s++)(o=n[s]).prior&&!o.attached_&&i.push(n[s])}else if(t.dropStaleComments&&r&&r.currentTime){var l=Math.floor(1e3*r.currentTime)-t.interval;if(l>0)for(var u,c=0;c<n.length;c++)if((u=n[c]).prior&&!u.attached_&&i.push(n[c]),u.start>l){a=c;break}}a>0&&(n.splice(0,a),this.data=i.concat(n))}},{key:"status",get:function(){return this._status}}]),t}(i.default);t.default=u,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Bullet=void 0;var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(1))&&n.__esModule?n:{default:n},o=r(0);function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}var l=t.Bullet=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=n,a=void 0;if(n.setLogger("bullet"),n.danmu=e,n.options=r,n.duration=r.duration,n.id=r.id,n.container=e.container,n.start=r.start,n.prior=r.prior,n.realTime=r.realTime,n.color=r.color,n.bookChannelId=r.bookChannelId,n.direction=e.direction,n.reuseDOM=!0,n.willChanges=[],n.domObj=e.domObj,r.el&&1===r.el.nodeType){if(r.el.parentNode)return s(n,{bulletCreateFail:!0});if(e.config.disableCopyDOM)a=r.el,n.reuseDOM=!1;else{a=n.domObj.use();var l=(0,o.copyDom)(r.el);r.eventListeners&&r.eventListeners.length>0&&r.eventListeners.forEach((function(e){l.addEventListener(e.event,e.listener,e.useCapture||!1)})),a.appendChild(l)}}else(a=n.domObj.use()).textContent=r.txt;if(n.onChangeDirection=function(e){i.direction=e},n.danmu.on("changeDirection",n.onChangeDirection),r.style){var u=r.style;Object.keys(u).forEach((function(e){(0,o.styleUtil)(a,e,u[e])}))}"top"===r.mode||"bottom"===r.mode?n.mode=r.mode:n.mode="scroll",n.el=a,r.like&&r.like.el&&n.setLikeDom(r.like.el,r.like.style),n.status="waiting";var c=void 0;if((0,o.isNumber)(e.config.bulletOffset)&&e.config.bulletOffset>=0)c=e.config.bulletOffset;else{var d=e.containerPos;c=d.width/10>100?100:d.width/10}var h=r.realTime?0:Math.floor(Math.random()*c);return n.updateOffset(h),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"updateOffset",value:function(e){this.random=e,(0,o.styleUtil)(this.el,"left",this.danmu.containerPos.width+e+"px")}},{key:"attach",value:function(){var e=this.el;this.container.appendChild(e),this.elPos=e.getBoundingClientRect(),"b2t"===this.direction?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV&&(this.duration=(this.danmu.containerPos.width+this.random+this.width)/this.moveV*1e3),this.danmu.config&&(this.danmu.config.mouseControl&&(this.mouseoverFunWrapper=this.mouseoverFun.bind(this),e.addEventListener("mouseover",this.mouseoverFunWrapper,!1)),this.danmu.config.mouseEnterControl&&(this.mouseEnterFunWrapper=this.mouseoverFun.bind(this),e.addEventListener("mouseenter",this.mouseEnterFunWrapper,!1))),this._onTransitionEnd=this._onTransitionEnd.bind(this),e.addEventListener("transitionend",this._onTransitionEnd,!1)}},{key:"detach",value:function(){var e=this.el;if(e){var t=this.danmu.config;t&&(t.mouseControl&&e.removeEventListener("mouseover",this.mouseoverFunWrapper,!1),t.mouseEnterControl&&e.removeEventListener("mouseenter",this.mouseEnterFunWrapper,!1)),e.removeEventListener("transitionend",this._onTransitionEnd,!1),e.parentNode&&e.parentNode.removeChild(e),this.reuseDOM&&this.domObj.unused(e),this.el=null}this.elPos=void 0,this.danmu.off("changeDirection",this.onChangeDirection)}},{key:"willChange",value:function(){var e=this.danmu.main.willChanges.concat(this.willChanges).join();(0,o.styleUtil)(this.el,"willChange",e)}},{key:"mouseoverFun",value:function(e){this.danmu&&this.danmu.mouseControl&&this.danmu.config.mouseControlPause||"waiting"===this.status||"end"===this.status||this.danmu&&this.danmu.emit("bullet_hover",{bullet:this,event:e})}},{key:"_onTransitionEnd",value:function(){this.status="end",this.remove()}},{key:"topInit",value:function(){this.logger&&this.logger.info("topInit #"+(this.options.txt||"[DOM Element]")+"#"),"b2t"===this.direction?((0,o.styleUtil)(this.el,"transformOrigin","left top"),(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+this.danmu.containerPos.height+"px) translateZ(0px) rotate(90deg)"),(0,o.styleUtil)(this.el,"transition","transform 0s linear 0s")):(0,o.styleUtil)(this.el,"top",this.top+"px")}},{key:"pauseMove",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;if("paused"!==t.status&&("forcedPause"!==t.status&&(this.status="paused"),t._moveV=void 0,this.el))if(this.willChange(),"scroll"===this.mode){var r=t.danmu.containerPos;if(e){var n=((new Date).getTime()-t.moveTime)/1e3*this.moveV,i=0;i=t.moveMoreS-n>=0?"b2t"===this.direction?(t.moveMoreS-n)/t.moveContainerHeight*r.height:(t.moveMoreS-n)/t.moveContainerWidth*r.width:t.moveMoreS-n,"b2t"===this.direction?(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+i+"px) translateZ(0px) rotate(90deg)"):(0,o.styleUtil)(this.el,"left",i+"px")}else"b2t"===this.direction?(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+(this.el.getBoundingClientRect().top-r.top)+"px) translateZ(0px) rotate(90deg)"):(0,o.styleUtil)(this.el,"left",this.el.getBoundingClientRect().left-r.left+"px");"b2t"===this.direction||(0,o.styleUtil)(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,o.styleUtil)(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+(new Date).getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(e){if(this.hasMove||(this.danmu.emit("bullet_start",this),this.hasMove=!0),("forcedPause"!==this.status||e)&&this.el&&"start"!==this.status)if(this.status="start",this.willChanges=["transform","transition"],this.willChange(),(0,o.styleUtil)(this.el,"backface-visibility","hidden"),(0,o.styleUtil)(this.el,"perspective","500em"),"scroll"===this.mode){var t=this.danmu.containerPos;if("b2t"===this.direction){var r=(this.el.getBoundingClientRect().bottom-t.top)/this.moveV;(0,o.styleUtil)(this.el,"transition","transform "+r+"s linear 0s"),(0,o.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY(-"+this.height+"px) translateZ(0px) rotate(90deg)"),this.moveTime=(new Date).getTime(),this.moveMoreS=this.el.getBoundingClientRect().top-t.top,this.moveContainerHeight=t.height}else{if(!this.el)return;var n=this.el.getBoundingClientRect(),i=n.right-t.left,a=i/this.moveV;n.right>t.left?((0,o.styleUtil)(this.el,"transition","transform "+a+"s linear 0s"),(0,o.styleUtil)(this.el,"transform","translateX(-"+i+"px) translateY(0px) translateZ(0px)"),this.moveTime=(new Date).getTime(),this.moveMoreS=n.left-t.left,this.moveContainerWidth=t.width):(this.status="end",this.remove())}}else{var s=(new Date).getTime(),l=(this.startTime&&s-this.startTime>this.duration?s-this.startTime:this.duration)/1e3;(0,o.styleUtil)(this.el,"left","50%"),(0,o.styleUtil)(this.el,"margin","0 0 0 -"+this.width/2+"px"),(0,o.styleUtil)(this.el,"visibility","hidden"),(0,o.styleUtil)(this.el,"transition","visibility "+l+"s 0s"),this.pastDuration||(this.pastDuration=1),this.startTime=s}}},{key:"remove",value:function(){this.logger&&this.logger.info("remove #"+(this.options.txt||"[DOM Element]")+"#"),this.pauseMove(),this.el&&this.el.parentNode&&(this.willChanges=[],this.willChange(),this.detach(),this.options.el&&1===this.options.el.nodeType&&this.danmu.config.disableCopyDOM&&(0,o.styleUtil)(this.options.el,"transform","none"),this.danmu.emit("bullet_remove",{bullet:this}))}},{key:"setFontSize",value:function(e){this.el&&(this.el.style.fontSize=e)}},{key:"setLikeDom",value:function(e,t){if(e&&(Object.keys(t).forEach((function(r){e.style[r]=t[r]})),e.className="danmu-like",this.el)){var r=this.el.querySelector(".danmu-like");r&&this.el.removeChild(r),this.el.innerHTML=""+this.el.innerHTML+e.outerHTML}return e}},{key:"moveV",get:function(){var e=this._moveV;if(!e){if(this.options.moveV)e=this.options.moveV;else if(this.elPos){var t=this.danmu.containerPos;e=("b2t"===this.direction?t.height+this.height:t.width+this.width)/this.duration*1e3}e&&(e*=this.danmu.main.playRate,this._moveV=e)}return e}}]),t}(a.default);t.default=l},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(1))&&n.__esModule?n:{default:n},o=r(0),s=r(31),l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=r;return n.setLogger("channel"),n.danmu=e,n.width=0,n.height=0,n.reset(!0),n.direction=e.direction,n.channels=[],n.updatePos(),(0,o.attachEventListener)(r.danmu,"bullet_remove",(function(e){n.removeBullet(e.bullet)}),"destroy"),(0,o.attachEventListener)(r.danmu,"changeDirection",(function(e){n.direction=e}),"destroy"),(0,o.attachEventListener)(r.danmu,"channel_resize",(function(){n.resize()}),"destroy"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.channels.splice(0,this.channels.length),this._cancelResizeTimer(),this)o.hasOwnProperty.call(this,e)&&delete this[e]}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("reset");var t=this,r=t.danmu,n=r.container,i=r.bulletBtn;function a(){var e=n.getBoundingClientRect();t.width=e.width,t.height=e.height,t.resetId&&(cancelAnimationFrame(t.resetId),t.resetId=null);var r=t._initChannels(),i=r.channelSize,a=r.channelCount,o=r.channels;t.channelCount=a,t.channels=o,"b2t"===t.direction?t.channelWidth=i:t.channelHeight=i}t.container=n,i&&i.main&&i.main.queue.forEach((function(e){e.remove()})),t.channels&&t.channels.length>0&&["scroll","top","bottom"].forEach((function(e){for(var r=0;r<t.channels.length;r++)t.channels[r].queue[e].forEach((function(e){e.remove()}))})),i&&i.main&&i.main.data&&i.main.data.forEach((function(e){e.attached_=!1})),e?this.resetId=requestAnimationFrame(a):a()}},{key:"getRealOccupyArea",value:function(){return{width:this.width,height:this.height}}},{key:"updatePos",value:function(){var e=this.container.getBoundingClientRect();this.containerPos=e,this.containerWidth=e.width,this.containerHeight=e.height,this.containerTop=e.top,this.containerBottom=e.bottom,this.containerLeft=e.left,this.containerRight=e.right}},{key:"addBullet",value:function(e){var t=this,r=this.danmu,n=this.channels,i=void 0,a=void 0,o=void 0;if("b2t"===t.direction?(a=this.channelWidth,o=Math.ceil(e.width/a)):(i=this.channelHeight,o=Math.ceil(e.height/i)),o>n.length)return{result:!1,message:"exceed channels.length, occupy="+o+",channelsSize="+n.length};for(var s=!0,l=void 0,u=-1,c=0,d=n.length;c<d;c++)if(n[c].queue[e.mode].some((function(t){return t.id===e.id})))return{result:!1,message:"exited, channelOrder="+c+",danmu_id="+e.id};if("scroll"===e.mode)for(var h=0,f=n.length-o;h<=f;h++){s=!0;for(var p=h;p<h+o;p++){if((l=n[p]).operating.scroll){s=!1;break}if(l.bookId.scroll&&l.bookId.scroll!==e.id){s=!1;break}l.operating.scroll=!0;var y=l.queue.scroll[0];if(y){var m=y.el.getBoundingClientRect();if("b2t"===t.direction){if(m.bottom>=t.containerPos.bottom){s=!1,l.operating.scroll=!1;break}}else if(m.right>=t.containerPos.right){s=!1,l.operating.scroll=!1;break}var g=void 0,v=y.moveV,b=void 0,_=e.moveV,E=void 0;if("b2t"===t.direction?(b=(g=m.bottom-t.containerTop)/v,E=t.containerHeight+e.random-g):(b=(g=m.right-t.containerLeft)/v,E=t.containerWidth+e.random-g),_>v){var T=E/(_-v);if(r.config.bOffset||(r.config.bOffset=0),b+r.config.bOffset>=T){var S=b*_-t.containerPos.width;S>0&&e.updateOffset(S+(1+Math.ceil(5*Math.random())))}}}l.operating.scroll=!1}if(s){u=h;break}}else if("top"===e.mode)for(var $=0,A=n.length-o;$<=A;$++){s=!0;for(var w=$;w<$+o;w++){if(w>Math.floor(n.length/2)){s=!1;break}if((l=n[w]).operating[e.mode]){s=!1;break}if((l.bookId[e.mode]||e.prior)&&l.bookId[e.mode]!==e.id){s=!1;break}if(l.operating[e.mode]=!0,l.queue[e.mode].length>0){s=!1,l.operating[e.mode]=!1;break}l.operating[e.mode]=!1}if(s){u=$;break}}else if("bottom"===e.mode)for(var k=n.length-o;k>=0;k--){s=!0;for(var I=k;I<k+o;I++){if(I<=Math.floor(n.length/2)){s=!1;break}if((l=n[I]).operating[e.mode]){s=!1;break}if((l.bookId[e.mode]||e.prior)&&l.bookId[e.mode]!==e.id){s=!1;break}if(l.operating[e.mode]=!0,l.queue[e.mode].length>0){s=!1,l.operating[e.mode]=!1;break}l.operating[e.mode]=!1}if(s){u=k;break}}if(-1!==u){for(var C=u,P=u+o;C<P;C++)(l=n[C]).operating[e.mode]=!0,l.queue[e.mode].unshift(e),e.prior&&(delete l.bookId[e.mode],t.logger&&t.logger.info(C+"")),l.operating[e.mode]=!1;return e.prior&&(t.logger&&t.logger.info(e.id+""),delete e.bookChannelId,r.player&&r.bulletBtn.main.data.some((function(t){return t.id===e.id&&(delete t.bookChannelId,!0)}))),e.channel_id=[u,o],"b2t"===t.direction?(e.top=u*a,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerWidth*t.danmu.config.area.start)):(e.top=u*i,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start)),{result:e,message:"success"}}if(e.options.realTime){var x=0,R=-1,O=null;if(t.danmu.bulletBtn.main.queue.forEach((function(e,r){!e.prior&&!e.options.realTime&&e.el&&e.el.getBoundingClientRect().left>t.containerPos.right&&e.start>=x&&(x=e.start,R=r,O=e)})),O){O.remove(),t.removeBullet(O),t.danmu.bulletBtn.main.queue.splice(R,1),e.channel_id=O.channel_id;for(var L=O.channel_id[0],D=O.channel_id[0]+O.channel_id[1];L<D;L++)(l=n[L]).operating[e.mode]=!0,l.queue[e.mode].unshift(e),e.prior&&delete l.bookId[e.mode],l.operating[e.mode]=!1;return e.top=O.top,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start),{result:e,message:"success"}}}if(e.prior)if(e.bookChannelId||t.danmu.live)r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"2"),r.start+=2e3,!0)}));else{u=-1;for(var M=0,N=n.length-o;M<=N;M++){s=!0;for(var G=M;G<M+o;G++)if(n[G].bookId[e.mode]){s=!1;break}if(s){u=M;break}}if(-1!==u){for(var V=u;V<u+o;V++)n[V].bookId[e.mode]=e.id,t.logger&&t.logger.info(V+""+e.id+"");r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"2"),r.start+=2e3,r.bookChannelId=[u,o],t.logger&&t.logger.info(e.id+""+u+"~"+(u+o-1)+""),!0)}))}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(e){this.logger&&this.logger.info("removeBullet "+(e.options.txt||"[DOM Element]"));for(var t=this.channels,r=e.channel_id,n=void 0,i=r[0],a=r[0]+r[1];i<a;i++)if(n=t[i]){n.operating[e.mode]=!0;var o=-1;n.queue[e.mode].some((function(t,r){return t.id===e.id&&(o=r,!0)})),o>-1&&n.queue[e.mode].splice(o,1),n.operating[e.mode]=!1}e.options.loop&&this.danmu.bulletBtn.main.playedData.push(e.options)}},{key:"resizeSync",value:function(){this.resize(!0)}},{key:"_initChannels",value:function(){var e=this.danmu.config,t=e.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),r=void 0;if(e.area){var n=e.area,i=n.lines,a=n.start,l=n.end;if((0,s.validAreaLineRule)(i))r=i,"b2t"===this.direction?this.width=r*t:this.height=r*t;else if(a>=0&&l>=a){var u=l-a;"b2t"===this.direction?this.width=Math.floor(this.width*u):this.height=Math.floor(this.height*u)}}(0,o.isNumber)(r)||(r="b2t"===this.direction?Math.floor(this.width/t):Math.floor(this.height/t));for(var c=[],d=0;d<r;d++)c[d]={id:d,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};return{channelSize:t,channelCount:r,channels:c}}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("resize");var t=this;function r(e,t){e[t]={id:t,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}}}function n(e,n){function i(r){["scroll","top"].forEach((function(n){t.channels[r].queue[n].forEach((function(t){t.el&&e[r].queue[n].push(t)}))}))}function a(r){t.channels[r].queue.bottom.forEach((function(i){if(i.el&&(e[r+e.length-t.channels.length].queue.bottom.push(i),i.channel_id[0]+i.channel_id[1]-1===r)){var a=[].concat(i.channel_id);i.channel_id=[a[0]-t.channels.length+e.length,a[1]],i.top=i.channel_id[0]*n,t.danmu.config.area&&t.danmu.config.area.start&&(i.top+=t.containerHeight*t.danmu.config.area.start),i.topInit()}}))}for(var o=0;o<t.channels.length;o++)r(e,o),i(o),a(o);for(var s=function(t){["scroll","top","bottom"].forEach((function(r){e[t].queue[r].forEach((function(e){e.resized=!1}))}))},l=0;l<e.length;l++)s(l);t.channels=e,"b2t"===t.direction?t.channelWidth=n:t.channelHeight=n}function i(e,n){for(var i=["scroll","top","bottom"],a=function(a){r(e,a),i.forEach((function(r){if("top"===r&&a>Math.floor(e.length/2));else if("bottom"===r&&a<=Math.floor(e.length/2));else{var i="bottom"===r?a-e.length+t.channels.length:a;t.channels[i].queue[r].forEach((function(o,s){if(o.el){if(e[a].queue[r].push(o),"bottom"===r&&o.channel_id[0]+o.channel_id[1]-1===i){var l=[].concat(o.channel_id);o.channel_id=[l[0]-t.channels.length+e.length,l[1]],o.top=o.channel_id[0]*n,t.danmu.config.area&&t.danmu.config.area.start&&(o.top+=t.containerHeight*t.danmu.config.area.start),o.topInit()}t.channels[i].queue[r].splice(s,1)}}))}}))},o=0;o<e.length;o++)a(o);var s=function(t){i.forEach((function(r){e[t].queue[r].forEach((function(e){e.resized=!1}))}))};for(o=0;o<e.length;o++)s(o);t.channels=e,"b2t"===t.direction?t.channelWidth=n:t.channelHeight=n}function a(){var e=t.danmu,r=e.container,a=e.bulletBtn;t.container=r,t.updatePos(),t._cancelResizeTimer(),a.main.data&&a.main.data.forEach((function(e){e.bookChannelId&&(delete e.bookChannelId,t.logger&&t.logger.info("resize"+e.id+""))})),t.logger&&t.logger.info("resize"),t.width=t.containerWidth,t.height=t.containerHeight;var o=t._initChannels(),s=o.channelSize,l=o.channels;t.channels&&(t.channels.length<=l.length?n(l,s):i(l,s)),t.resizing=!1}t.resizing||(t.resizing=!0,e?a():(this._cancelResizeTimer(),this.resizeId=requestAnimationFrame(a)))}},{key:"_cancelResizeTimer",value:function(){this.resizeId&&(cancelAnimationFrame(this.resizeId),this.resizeId=null)}}]),t}(a.default);t.default=l,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.validAreaLineRule=function(e){return"number"==typeof e&&e>=0&&Number.isInteger(e)}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t={initDOM:function(){return document.createElement("div")},initSize:10},this.init(t)}return n(e,[{key:"init",value:function(e){this.idleList=[],this.usingList=[],this._id=0,this.options=e,this._expand(e.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var e=this.idleList.shift();return this.usingList.push(e),e}},{key:"unused",value:function(e){var t=this.usingList.indexOf(e);t<0||(this.usingList.splice(t,1),e.innerHTML="",e.textcontent="",this.clearElementStyle(e),this.idleList.push(e))}},{key:"_expand",value:function(e){for(var t=0;t<e;t++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var e=0;e<this.idleList.length;e++)this.idleList[e].innerHTML="",this.idleList[e].textcontent="",this.clearElementStyle(this.idleList[e]);for(var t=0;t<this.usingList.length;t++)this.usingList[t].innerHTML="",this.usingList[t].textcontent="",this.clearElementStyle(this.usingList[t]);for(var r in this)i.hasOwnProperty.call(this,r)&&delete this[r]}},{key:"clearElementStyle",value:function(e){var t="undefined"!=typeof window?window.navigator.userAgent:null;t&&(t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1?(0,i.styleUtil)(e,"transform","none"):e.setAttribute("style",""))}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.destroyObserver=t.unObserver=t.addObserver=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=new(function(){function e(){var t=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__handlers=[],window.ResizeObserver)try{this.observer=new window.ResizeObserver((0,i.throttle)((function(e){t.__trigger(e)}),100))}catch(r){}}return n(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=this.__handlers,n=-1,i=0;i<r.length;i++)r[i]&&e===r[i].target&&(n=i);n>-1?this.__handlers[n].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(r,n){e===r.target&&(t=n)})),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,r=0;r<t.length;r++)if(t[r]&&e===t[r].target){t[r].handler&&t[r].handler.map((function(e){try{e()}catch(t){console.error(t)}}));break}}},{key:"__trigger",value:function(e){var t=this;e.map((function(e){t.__runHandler(e.target)}))}}]),e}());t.addObserver=function(e,t){a.addObserver(e,t)},t.unObserver=function(e,t){a.unObserver(e,t)},t.destroyObserver=function(e,t){a.destroyObserver(e,t)}},function(e,t,r){var n=r(35);"string"==typeof n&&(n=[[e.i,n,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(37)(n,i),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(36)(!1)).push([e.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#fff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var a=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(o).concat([a]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(n[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];"number"==typeof o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),t.push(o))}},t}},function(e,t,r){var n,i,a,o={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),l=function(e){return document.querySelector(e)},u=(a={},function(e){if("function"==typeof e)return e();if(void 0===a[e]){var t=l.call(this,e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(r){t=null}a[e]=t}return a[e]}),c=null,d=0,h=[],f=r(38);function p(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=o[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(_(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(_(n.parts[a],t));o[n.id]={id:n.id,refs:1,parts:s}}}}function y(e,t){for(var r=[],n={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};n[o]?n[o].parts.push(s):r.push(n[o]={id:o,parts:[s]})}return r}function m(e,t){var r=u(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=h[h.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),h.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=_typeof$b(e.insertAt)||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=u(e.insertInto+" "+e.insertAt.before);r.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function v(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),b(t,e.attrs),m(e,t),t}function b(e,t){Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])}))}function _(e,t){var r,n,i,a,o,s;if(t.transform&&e.css){if(!(a=t.transform(e.css)))return function(){};e.css=a}if(t.singleton){var l=d++;r=c||(c=v(t)),n=S.bind(null,r,l,!1),i=S.bind(null,r,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=t,s=document.createElement("link"),void 0===o.attrs.type&&(o.attrs.type="text/css"),o.attrs.rel="stylesheet",b(s,o.attrs),m(o,s),r=s,n=A.bind(null,r,t),i=function(){g(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=$.bind(null,r),i=function(){g(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=("undefined"==typeof document?"undefined":_typeof$b(document)))throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==_typeof$b(t.attrs)?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=y(e,t);return p(r,t),function(e){for(var n=[],i=0;i<r.length;i++){var a=r[i];(s=o[a.id]).refs--,n.push(s)}for(e&&p(y(e,t),t),i=0;i<n.length;i++){var s;if(0===(s=n[i]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete o[s.id]}}}};var E,T=(E=[],function(e,t){return E[e]=t,E.filter(Boolean).join("\n")});function S(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=T(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}function $(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function A(e,t,r){var n=r.css,i=r.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(n=f(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?r+a:n+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}}])}(dist$3);var DanmuJs$1=getDefaultExportFromCjs(dist$3.exports);function PanelIcon(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="-5 -11 40 40" width="40" height="40">\n  <path fill="#f85959" transform="scale(0.8 0.8)" d="M36.5,18.73a1.19,1.19,0,0,0,1-1.14V16.33a1.2,1.2,0,0,0-1-1.13l-.61-.08a1.75,1.75,0,0,1-1.3-.86l-.21-.36-.2-.36A1.72,1.72,0,0,1,34,12l.23-.58a1.18,1.18,0,0,0-.5-1.42l-1.1-.62a1.18,1.18,0,0,0-1.47.3l-.39.51a1.82,1.82,0,0,1-1.41.72c-.44,0-1.88-.27-2.22-.7l-.39-.49a1.18,1.18,0,0,0-1.48-.28l-1.09.64a1.19,1.19,0,0,0-.47,1.43l.25.59a1.87,1.87,0,0,1-.08,1.58c-.26.37-1.17,1.5-1.71,1.58l-.63.09a1.19,1.19,0,0,0-1,1.14l0,1.27a1.17,1.17,0,0,0,1,1.12l.61.08a1.74,1.74,0,0,1,1.3.87l.21.36.2.35A1.69,1.69,0,0,1,24,22.08l-.23.59a1.19,1.19,0,0,0,.5,1.42l1.1.62a1.19,1.19,0,0,0,1.48-.31l.38-.5a1.83,1.83,0,0,1,1.41-.72c.44,0,1.88.25,2.22.69l.39.49a1.18,1.18,0,0,0,1.48.28L33.86,24a1.19,1.19,0,0,0,.47-1.43L34.09,22a1.84,1.84,0,0,1,.07-1.58c.26-.37,1.17-1.5,1.72-1.58ZM31,18.94a2.76,2.76,0,0,1-4.65-1.2A2.71,2.71,0,0,1,27,15.13a2.76,2.76,0,0,1,4.64,1.2A2.7,2.7,0,0,1,31,18.94Z"/>\n  <path fill="#f85959" transform="scale(0.8 0.8)" d="M32,0H3.59A3.59,3.59,0,0,0,0,3.59v17A3.59,3.59,0,0,0,3.59,24.2H19.72a12.59,12.59,0,0,1-.81-1.2A11.73,11.73,0,0,1,35.54,7.28V3.59A3.59,3.59,0,0,0,32,0ZM13,14.18H4.29a1.52,1.52,0,0,1,0-3H13a1.52,1.52,0,0,1,0,3ZM16.45,8H4.29a1.51,1.51,0,0,1,0-3H16.45a1.51,1.51,0,1,1,0,3Z"/>\n</svg>\n',"image/svg+xml").firstChild}var DanmuPanel=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),(n=t.call(this,e)).set={speed:1,area:{},opacity:1,fonSize:"middle"},n}return _createClass$j(r,[{key:"afterCreate",value:function(){"mobile"===sniffer$1.device?this.activeEvent="click":this.activeEvent="mouseenter",this.onStateChange=this.onStateChange.bind(this),this.onToggle=this.onToggle.bind(this),this.bind(this.activeEvent,this.onToggle),this.bind("mouseleave",this.onToggle),this.appendChild(".xgplayer-panel-icon",PanelIcon())}},{key:"onStateChange",value:function(e){this.config.onChangeSet&&this.config.onChangeSet(this.set)}},{key:"onToggle",value:function(e){e.preventDefault(),e.stopPropagation(),util$2.hasClass(this.root,"slider-show")?util$2.removeClass(this.root,"slider-show"):util$2.addClass(this.root,"slider-show")}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.onStateChange)}},{key:"render",value:function(){return'\n      <xg-icon class="xgplayer-panel">\n          <xg-panel-icon class="xgplayer-panel-icon">\n          </xg-panel-icon>\n          <xg-panel-slider class="xgplayer-panel-slider">\n            <xg-hidemode class="xgplayer-hidemode">\n              <p class="xgplayer-hidemode-font"></p>\n              <ul class="xgplayer-hidemode-radio">\n                <li class="xgplayer-hidemode-scroll" id="false"></li><li class="xgplayer-hidemode-top" id="false"></li><li class="xgplayer-hidemode-bottom" id="false"></li><li class="xgplayer-hidemode-color" id="false"></li>\n              </ul>\n            </xg-hidemode>\n            <xg-transparency class="xgplayer-transparency">\n              <span></span>\n              <input class="xgplayer-transparency-line xgplayer-transparency-color xgplayer-transparency-bar xgplayer-transparency-gradient" type="range" min="0" max="100" step="0.1" value="50"></input>\n            </xg-transparency>\n            <xg-showarea class="xgplayer-showarea">\n              <div class="xgplayer-showarea-name"></div>\n              <div class="xgplayer-showarea-control">\n                <div class="xgplayer-showarea-control-up">\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-onequarters">1/4</span>\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-twoquarters selected-color">1/2</span>\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-threequarters">3/4</span>\n                  <span class="xgplayer-showarea-control-up-item xgplayer-showarea-full">1</span>\n                </div>\n                <div class="xgplayer-showarea-control-down">\n                  <div class="xgplayer-showarea-control-down-dots">\n                    <span class="xgplayer-showarea-onequarters-dot"></span>\n                    <span class="xgplayer-showarea-twoquarters-dot"></span>\n                    <span class="xgplayer-showarea-threequarters-dot"></span>\n                    <span class="xgplayer-showarea-full-dot"></span>\n                  </div>\n                  <input class="xgplayer-showarea-line xgplayer-showarea-color xgplayer-showarea-bar xgplayer-gradient" type="range" min="1" max="4" step="1" value="1">\n                </div>\n              </div>\n            </xg-showarea>\n            <xg-danmuspeed class="xgplayer-danmuspeed">\n              <div class="xgplayer-danmuspeed-name"></div>\n              <div class="xgplayer-danmuspeed-control">\n                <div class="xgplayer-danmuspeed-control-up">\n                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-small"></span>\n                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-middle selected-color"></span>\n                  <span class="xgplayer-danmuspeed-control-up-item xgplayer-danmuspeed-large"></span>\n                </div>\n                <div class="xgplayer-danmuspeed-control-down">\n                  <div class="xgplayer-danmuspeed-control-down-dots">\n                    <span class="xgplayer-danmuspeed-small-dot"></span>\n                    <span class="xgplayer-danmuspeed-middle-dot"></span>\n                    <span class="xgplayer-danmuspeed-large-dot"></span>\n                  </div>\n                  <input class="xgplayer-danmuspeed-line xgplayer-danmuspeed-color xgplayer-danmuspeed-bar xgplayer-gradient" type="range" min="50" max="150" step="50" value="100">\n                </div>\n              </div>\n            </xg-danmuspeed>\n            <xg-danmufont class="xgplayer-danmufont">\n              <div class="xgplayer-danmufont-name"></div>\n              <div class="xgplayer-danmufont-control">\n                <div class="xgplayer-danmufont-control-up">\n                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-small"></span>\n                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-middle"></span>\n                  <span class="xgplayer-danmufont-control-up-item xgplayer-danmufont-large selected-color"></span>\n                </div>\n                <div class="xgplayer-danmufont-control-down">\n                  <div class="xgplayer-danmufont-control-down-dots">\n                    <span class="xgplayer-danmufont-small-dot"></span>\n                    <span class="xgplayer-danmufont-middle-dot"></span>\n                    <span class="xgplayer-danmufont-large-dot"></span>\n                  </div>\n                  <input class="xgplayer-danmufont-line xgplayer-danmufont-color xgplayer-danmufont-bar xgplayer-gradient" type="range" min="20" max="30" step="5" value="25">\n                </div>\n              </div>\n            </xg-danmufont>\n          </xg-panel-slider>\n      </xg-icon>'}}],[{key:"pluginName",get:function(){return"danmuPanel"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:11,onChangeSet:function(e){console.log("DanmuPanel:".concat(e))},speed:1,area:{},opacity:1,fonSize:"middle"}}}]),r}(Plugin),DANMU_OPEN='<dk-switch class="danmu-switch">\n<span class="txt"></span>\n</dk-switch>',DanmuIcon=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){return _classCallCheck$i(this,r),t.apply(this,arguments)}return _createClass$j(r,[{key:"afterCreate",value:function(){this.initIcons(),this.onStateChange=this.onStateChange.bind(this),this.bind(["click","touchend"],this.onStateChange)}},{key:"registerIcons",value:function(){return{openDanmu:{icon:DANMU_OPEN,class:"danmu-switch-open"},closeDanmu:{icon:DANMU_OPEN,class:"danmu-switch-closed"}}}},{key:"switchState",value:function(e){e?this.setAttr("data-state","active"):this.setAttr("data-state","normal"),this.switchTips(e)}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e.openDanmu),t.appendChild(e.closeDanmu)}},{key:"switchTips",value:function(e){this.changeLangTextKey(this.find(".xg-tips"),e?"OFF":"OPEN")}},{key:"onStateChange",value:function(e){e.preventDefault(),e.stopPropagation();var t="active"===this.root.getAttribute("data-state");this.switchState(!t),this.config.onSwitch&&this.config.onSwitch(e,!t)}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){return'\n    <xg-icon class="danmu-icon">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="'.concat(this.i18nKeys.OPEN,'">').concat(this.i18n.OPEN,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"danmuIcon"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:11,onSwitch:function(e,t){}}}}]),r}(Plugin),MIN_INTERVAL$1=300,Danmu=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(e){var n;return _classCallCheck$i(this,r),(n=t.call(this,e)).danmujs=null,n.danmuPanel=null,n.isOpen=!1,n.seekCost=0,n.intervalId=0,n.isUseClose=!1,n}return _createClass$j(r,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.isLive&&(this.config.isLive=!0),this.initDanmu(),this.registerExtIcons(),this.once(TIME_UPDATE,(function(){e.config.defaultOpen&&!e.isUseClose&&e.start()})),this.on(PAUSE,(function(){e.isOpen&&e.danmujs&&e.danmujs.pause()})),this.on(PLAY,(function(){e.isOpen&&e.danmujs&&e.danmujs.play()})),this.on(SEEKING,(function(){e.seekCost=window.performance.now(),!e.config.isLive&&e.danmujs&&e.danmujs.stop()})),this.on(VIDEO_RESIZE,(function(){e.resize()})),this.on(SEEKED,(function(){e.danmujs&&e.isOpen&&(e.intervalId&&(util$2.clearTimeout(e,e.intervalId),e.intervalId=null),window.performance.now()-e.seekCost>MIN_INTERVAL$1?e.danmujs.start():e.intervalId=util$2.setTimeout(e,(function(){e.danmujs.start(),e.intervalId=null}),MIN_INTERVAL$1))}))}},{key:"onPluginsReady",value:function(){var e=this.player.plugins.pc;e&&(e.onVideoDblClick&&this.bind("dblclick",e.onVideoDblClick),e.onVideoClick&&this.bind("click",e.onVideoClick))}},{key:"initDanmu",value:function(){var e=this.player,t=this.config,r=this.config,n=r.channelSize,i=r.fontSize,a=r.opacity,o=r.mouseControl,s=r.mouseControlPause,l=r.area,u=r.defaultOff,c={container:this.root,player:e.video,comments:this.config.comments,live:t.isLive,defaultOff:u,area:l,mouseControl:o,mouseControlPause:s};t.ext&&Object.keys(t.ext).map((function(e){c[e]=t.ext[e]}));var d=new DanmuJs$1(c);this.danmujs=d,e.danmu=d,this.setFontSize(i,n),this.setArea(l),this.resize(),1!==a&&this.setOpacity(a)}},{key:"registerExtIcons",value:function(){var e=this,t=this.player,r=this.config;if(r.panel){var n={config:{onChangeset:function(t){e.changeSet(t)}}};this.danmuPanel=t.controls.registerPlugin(DanmuPanel,n,DanmuPanel.pluginName)}var i=r.switchConfig;if(!r.closeDefaultBtn){var a={config:{onSwitch:function(t,r){e.onSwitch(t,r)}}};Object.keys(i).map((function(e){a.config[e]=i[e]})),this.danmuButton=t.controls.registerPlugin(DanmuIcon,a,DanmuIcon.pluginName),this.config.defaultOpen&&this.danmuButton.switchState(!0)}}},{key:"changeSet",value:function(e){}},{key:"onSwitch",value:function(e,t){this.emitUserAction(e,"switch_danmu",{prop:"isOpen",from:!t,to:t}),t?this.start():this.stop()}},{key:"start",value:function(){var e=this;!this.isOpen&&this.danmujs&&(this.isUseClose=!1,this.show(),this.resize(),util$2.setTimeout(this,(function(){e.danmujs.start(),e.player.paused&&e.danmujs.pause(),e.isOpen=!0}),0))}},{key:"stop",value:function(){this.isUseClose=!0,this.isOpen&&this.danmujs&&(this.danmujs.stop(),this.config.isLive&&this.clear(),this.isOpen=!1,this.hide())}},{key:"clear",value:function(){this.danmujs&&this.danmujs.clear()}},{key:"setCommentLike",value:function(e,t){this.danmujs&&this.danmujs.setCommentLike(e,t)}},{key:"setCommentDuration",value:function(e,t){this.danmujs&&this.danmujs.setCommentDuration(e,t)}},{key:"setAllDuration",value:function(e,t){this.danmujs&&this.danmujs.setAllDuration(e,t)}},{key:"setCommentID",value:function(e,t){this.danmujs&&this.danmujs.setCommentID(e,t)}},{key:"hideMode",value:function(e){this.danmujs&&this.danmujs.hide(e)}},{key:"showMode",value:function(e){this.danmujs&&this.danmujs.show(e)}},{key:"setArea",value:function(e){this.danmujs&&this.danmujs.setArea(e)}},{key:"setOpacity",value:function(e){this.danmujs&&this.danmujs.setOpacity(e)}},{key:"setFontSize",value:function(e,t){this.danmujs&&this.danmujs.setFontSize(e,t)}},{key:"resize",value:function(){this.danmujs&&this.danmujs.resize()}},{key:"sendComment",value:function(e){this.danmujs&&this.danmujs.sendComment(e)}},{key:"hideIcon",value:function(){this.danmuButton&&this.danmuButton.hide()}},{key:"showIcon",value:function(){this.danmuButton&&this.danmuButton.show()}},{key:"destroy",value:function(){this.danmujs.stop(),this.danmujs.destroy(),this.danmujs=null,this.player.danmu=null;var e=this.danmuButton,t=this.danmuPanel;this.danmuButton&&this.danmuButton.root&&e.__destroy&&e.__destroy(),this.danmuPanel&&this.danmuPanel.root&&t.__destroy&&t.__destroy(),this.danmuButton=null,this.danmuPanel=null}},{key:"render",value:function(){return'<xg-danmu class="xgplayer-danmu">\n    </xg-danmu>'}}],[{key:"pluginName",get:function(){return"danmu"}},{key:"defaultConfig",get:function(){return{comments:[],area:{start:0,end:1},closeDefaultBtn:!1,defaultOff:!1,panel:!1,panelConfig:{},switchConfig:{},defaultOpen:!0,isLive:!1,channelSize:24,fontSize:14,opacity:1,mouseControl:!1,mouseControlPause:!1,ext:{},style:{}}}}]),r}(Plugin),index_min$2={exports:{}};!function(e,t){e.exports=function(){function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}function r(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=N(t),this.reject=N(r)}function n(e){var t=e.length;return 3===t?(60*(60*Number(e[0])+Number(e[1]))*1e3+1e3*Number(e[2]))/1e3:2===t?(60*Number(e[0])*1e3+1e3*Number(e[1]))/1e3:Number(e[0])}function i(e){return/^(\-|\+)?\d+(\.\d+)?$/.test(e)}function a(e){return e}function o(e,t){return e>=0&&e<t.length?t[e]:""}function s(e,t){if(!e)return!1;if(e.classList)return Array.prototype.some.call(e.classList,(function(e){return e===t}));var r=e.className&&"object"===Yt(e.className)?e.getAttribute("class"):e.className;return r&&!!r.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function l(e,t){e&&(e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)})):s(e,t)||(e.className&&"object"===Yt(e.className)?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t))}function u(e,t){e&&(e.classList?t.split(/\s+/g).forEach((function(t){e.classList.remove(t)})):s(e,t)&&t.split(/\s+/g).forEach((function(t){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===Yt(e.className)?e.setAttribute("class",e.getAttribute("class").replace(r," ")):e.className=e.className.replace(r," ")})))}function c(e,t,r){var n=t.length;if(n<1)return-1;if(t[r=r<0?0:r>=n?n-1:r].start<=e&&e<t[r].end)return r;for(var i=t[r].end<=e?r+1:0;i<n;i++){if(t[i].start<=e&&e<t[i].end)return i;if(e>t[i].end&&i+1<n&&e<t[i+1].start)return-1;if(e>t[i].end&&i+1>=n)return-1}return-1}function d(e,t,r){var n=t.length;if(n<1)return[];var i=[];if((r=r<0?0:r>=n?n-1:r)<n)for(var a=t[r].end<=e?r:0;a<n&&(t[a].start<=e&&e<t[a].end&&i.push(a),!(e<t[a].start));a++);return i}function h(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Sn(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e||"live-video"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i}function p(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),r=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e);return/(?:iPhone)/.test(e)&&!a||n||r||a}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="";e.map((function(e){r+=" "+t+" "+e.key+" {"+e.style+"}"}));var n=document.createElement("style"),i=document.head||document.getElementsByTagName("head")[0];if(n.type="text/css",n.id="ssss",n.styleSheet){var a=function(){try{n.styleSheet.cssText=r}catch(e){}};n.styleSheet.disabled?setTimeout(a,10):a()}else{var o=document.createTextNode(r);n.appendChild(o)}i.appendChild(n)}function m(e,t){Nn||(Nn=new Mn),Nn.addObserver(e,t)}function g(e,t){Nn&&Nn.unObserver(e,t)}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={code:Gn[e].code,msg:Gn[e].msg};return Sn(t).map((function(e){r[e]=t[e]})),r}function b(e,t,r,n,i){i?r(v(2,i),{format:n.format}):n.format?(e.list=n.list,e.format=n.format,e.styles=n.styles,t(e)):r(v(3))}function _(e){return new En((function(t,r){if(e.list)t(e);else{if(e.json){var n=Dn.parseJson(e.json);return e.list=n,e.format="json",void t(e)}if(e.stringContent&&!e.url)Dn.parse(e.stringContent,(function(n,i){b(e,t,r,n,i)}));else if(e.url)new An({url:e.url,type:"text"}).then((function(n){Dn.parse(n.res.response,(function(n,i){b(e,t,r,n,i)}))})).catch((function(t){var n=v(1,{statusText:t.statusText,status:t.status,type:t.type,message:"http load error",url:e.url});r(n)}));else{var i=v(8);r(i)}}}))}function E(e,t){return!!(e.id&&e.id===t.id||e.language&&e.language===t.language)}var T=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},S=function(e){return Object(T(e))},$={}.hasOwnProperty,A=function(e,t){return $.call(e,t)},w=t((function(e){var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)})),k=(w.version,t((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}))),I=t((function(e){var t=k["__core-js_shared__"]||(k["__core-js_shared__"]={});(e.exports=function(e,r){return t[e]||(t[e]=void 0!==r?r:{})})("versions",[]).push({version:w.version,mode:"pure",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})})),C=0,P=Math.random(),x=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++C+P).toString(36))},R=I("keys"),O=function(e){return R[e]||(R[e]=x(e))},L=O("IE_PROTO"),D=Object.prototype,M=Object.getPrototypeOf||function(e){return e=S(e),A(e,L)?e[L]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?D:null},N=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},G=function(e,t,r){if(N(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},V=function(e){return"object"==_typeof$b(e)?null!==e:"function"==typeof e},U=function(e){if(!V(e))throw TypeError(e+" is not an object!");return e},Z=function(e){try{return!!e()}catch(t){return!0}},B=!Z((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),F=k.document,j=V(F)&&V(F.createElement),W=function(e){return j?F.createElement(e):{}},X=!B&&!Z((function(){return 7!=Object.defineProperty(W("div"),"a",{get:function(){return 7}}).a})),H=function(e,t){if(!V(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!V(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!V(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!V(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},K=Object.defineProperty,Y={f:B?Object.defineProperty:function(e,t,r){if(U(e),t=H(t,!0),U(r),X)try{return K(e,t,r)}catch(n){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},z=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},J=B?function(e,t,r){return Y.f(e,t,z(1,r))}:function(e,t,r){return e[t]=r,e},Q=function e(t,r,n){var i,a,o,s=t&e.F,l=t&e.G,u=t&e.S,c=t&e.P,d=t&e.B,h=t&e.W,f=l?w:w[r]||(w[r]={}),p=f.prototype,y=l?k:u?k[r]:(k[r]||{}).prototype;for(i in l&&(n=r),n)(a=!s&&y&&void 0!==y[i])&&A(f,i)||(o=a?y[i]:n[i],f[i]=l&&"function"!=typeof y[i]?n[i]:d&&a?G(o,k):h&&y[i]==o?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(o):c&&"function"==typeof o?G(Function.call,o):o,c&&((f.virtual||(f.virtual={}))[i]=o,t&e.R&&p&&!p[i]&&J(p,i,o)))};Q.F=1,Q.G=2,Q.S=4,Q.P=8,Q.B=16,Q.W=32,Q.U=64,Q.R=128;var q=Q,ee=function(e,t){var r=(w.Object||{})[e]||Object[e],n={};n[e]=t(r),q(q.S+q.F*Z((function(){r(1)})),"Object",n)};ee("getPrototypeOf",(function(){return function(e){return M(S(e))}}));var te,re=w.Object.getPrototypeOf,ne=e(t((function(e){e.exports={default:re,__esModule:!0}}))),ie=e(t((function(e,t){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}}))),ae=Math.ceil,oe=Math.floor,se=function(e){return isNaN(e=+e)?0:(e>0?oe:ae)(e)},le=J,ue={},ce={}.toString,de=function(e){return ce.call(e).slice(8,-1)},he=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==de(e)?e.split(""):Object(e)},fe=function(e){return he(T(e))},pe=Math.min,ye=function(e){return e>0?pe(se(e),9007199254740991):0},me=Math.max,ge=Math.min,ve=function(e,t){return(e=se(e))<0?me(e+t,0):ge(e,t)},be=(te=!1,function(e,t,r){var n,i=fe(e),a=ye(i.length),o=ve(r,a);if(te&&t!=t){for(;a>o;)if((n=i[o++])!=n)return!0}else for(;a>o;o++)if((te||o in i)&&i[o]===t)return te||o||0;return!te&&-1}),_e=O("IE_PROTO"),Ee=function(e,t){var r,n=fe(e),i=0,a=[];for(r in n)r!=_e&&A(n,r)&&a.push(r);for(;t.length>i;)A(n,r=t[i++])&&(~be(a,r)||a.push(r));return a},Te="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Se=Object.keys||function(e){return Ee(e,Te)},$e=B?Object.defineProperties:function(e,t){U(e);for(var r,n=Se(t),i=n.length,a=0;i>a;)Y.f(e,r=n[a++],t[r]);return e},Ae=k.document,we=Ae&&Ae.documentElement,ke=O("IE_PROTO"),Ie=function(){},Ce=function(){var e,t=W("iframe"),r=Te.length;for(t.style.display="none",we.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Ce=e.F;r--;)delete Ce.prototype[Te[r]];return Ce()},Pe=Object.create||function(e,t){var r;return null!==e?(Ie.prototype=U(e),r=new Ie,Ie.prototype=null,r[ke]=e):r=Ce(),void 0===t?r:$e(r,t)},xe=t((function(e){var t=I("wks"),r=k.Symbol,n="function"==typeof r;(e.exports=function(e){return t[e]||(t[e]=n&&r[e]||(n?r:x)("Symbol."+e))}).store=t})),Re=Y.f,Oe=xe("toStringTag"),Le=function(e,t,r){e&&!A(e=r?e:e.prototype,Oe)&&Re(e,Oe,{configurable:!0,value:t})},De={};J(De,xe("iterator"),(function(){return this}));var Me=function(e,t,r){e.prototype=Pe(De,{next:z(1,r)}),Le(e,t+" Iterator")},Ne=xe("iterator"),Ge=!([].keys&&"next"in[].keys()),Ve=function(){return this},Ue=function(e,t,r,n,i,a,o){Me(r,t,n);var s,l,u,c=function(e){if(!Ge&&e in p)return p[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},d=t+" Iterator",h="values"==i,f=!1,p=e.prototype,y=p[Ne]||p["@@iterator"]||i&&p[i],m=y||c(i),g=i?h?c("entries"):m:void 0,v="Array"==t&&p.entries||y;if(v&&(u=M(v.call(new e)))!==Object.prototype&&u.next&&Le(u,d,!0),h&&y&&"values"!==y.name&&(f=!0,m=function(){return y.call(this)}),o&&(Ge||f||!p[Ne])&&J(p,Ne,m),ue[t]=m,ue[d]=Ve,i)if(s={values:h?m:c("values"),keys:a?m:c("keys"),entries:g},o)for(l in s)l in p||le(p,l,s[l]);else q(q.P+q.F*(Ge||f),t,s);return s},Ze=function(e){return function(t,r){var n,i,a=String(T(t)),o=se(r),s=a.length;return o<0||o>=s?e?"":void 0:(n=a.charCodeAt(o))<55296||n>56319||o+1===s||(i=a.charCodeAt(o+1))<56320||i>57343?e?a.charAt(o):n:e?a.slice(o,o+2):i-56320+(n-55296<<10)+65536}}(!0);Ue(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=Ze(t,r),this._i+=e.length,{value:e,done:!1})}));var Be=function(e,t){return{value:t,done:!!e}};Ue(Array,"Array",(function(e,t){this._t=fe(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,Be(1)):Be(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),ue.Arguments=ue.Array;for(var Fe=xe("toStringTag"),je="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),We=0;We<je.length;We++){var Xe=je[We],He=k[Xe],Ke=He&&He.prototype;Ke&&!Ke[Fe]&&J(Ke,Fe,Xe),ue[Xe]=ue.Array}var Ye={f:xe},ze=Ye.f("iterator"),Je=t((function(e){e.exports={default:ze,__esModule:!0}}));e(Je);var Qe=t((function(e){var t=x("meta"),r=Y.f,n=0,i=Object.isExtensible||function(){return!0},a=!Z((function(){return i(Object.preventExtensions({}))})),o=function(e){r(e,t,{value:{i:"O"+ ++n,w:{}}})},s=function(e,r){if(!V(e))return"symbol"==_typeof$b(e)?e:("string"==typeof e?"S":"P")+e;if(!A(e,t)){if(!i(e))return"F";if(!r)return"E";o(e)}return e[t].i},l=function(e,r){if(!A(e,t)){if(!i(e))return!0;if(!r)return!1;o(e)}return e[t].w},u=function(e){return a&&c.NEED&&i(e)&&!A(e,t)&&o(e),e},c=e.exports={KEY:t,NEED:!1,fastKey:s,getWeak:l,onFreeze:u}})),qe=(Qe.KEY,Qe.NEED,Qe.fastKey,Qe.getWeak,Qe.onFreeze,Y.f),et=function(e){var t=w.Symbol||(w.Symbol={});"_"==e.charAt(0)||e in t||qe(t,e,{value:Ye.f(e)})},tt={f:Object.getOwnPropertySymbols},rt={f:{}.propertyIsEnumerable},nt=function(e){var t=Se(e),r=tt.f;if(r)for(var n,i=r(e),a=rt.f,o=0;i.length>o;)a.call(e,n=i[o++])&&t.push(n);return t},it=Array.isArray||function(e){return"Array"==de(e)},at=Te.concat("length","prototype"),ot={f:Object.getOwnPropertyNames||function(e){return Ee(e,at)}},st=ot.f,lt={}.toString,ut="object"==("undefined"==typeof window?"undefined":_typeof$b(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ct=function(e){try{return st(e)}catch(t){return ut.slice()}},dt={f:function(e){return ut&&"[object Window]"==lt.call(e)?ct(e):st(fe(e))}},ht=Object.getOwnPropertyDescriptor,ft={f:B?ht:function(e,t){if(e=fe(e),t=H(t,!0),X)try{return ht(e,t)}catch(r){}if(A(e,t))return z(!rt.f.call(e,t),e[t])}},pt=Qe.KEY,yt=ft.f,mt=Y.f,gt=dt.f,vt=k.Symbol,bt=k.JSON,_t=bt&&bt.stringify,Et=xe("_hidden"),Tt=xe("toPrimitive"),St={}.propertyIsEnumerable,$t=I("symbol-registry"),At=I("symbols"),wt=I("op-symbols"),kt=Object.prototype,It="function"==typeof vt&&!!tt.f,Ct=k.QObject,Pt=!Ct||!Ct.prototype||!Ct.prototype.findChild,xt=B&&Z((function(){return 7!=Pe(mt({},"a",{get:function(){return mt(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=yt(kt,t);n&&delete kt[t],mt(e,t,r),n&&e!==kt&&mt(kt,t,n)}:mt,Rt=function(e){var t=At[e]=Pe(vt.prototype);return t._k=e,t},Ot=It&&"symbol"==_typeof$b(vt.iterator)?function(e){return"symbol"==_typeof$b(e)}:function(e){return e instanceof vt},Lt=function e(t,r,n){return t===kt&&e(wt,r,n),U(t),r=H(r,!0),U(n),A(At,r)?(n.enumerable?(A(t,Et)&&t[Et][r]&&(t[Et][r]=!1),n=Pe(n,{enumerable:z(0,!1)})):(A(t,Et)||mt(t,Et,z(1,{})),t[Et][r]=!0),xt(t,r,n)):mt(t,r,n)},Dt=function(e,t){U(e);for(var r,n=nt(t=fe(t)),i=0,a=n.length;a>i;)Lt(e,r=n[i++],t[r]);return e},Mt=function(e,t){return void 0===t?Pe(e):Dt(Pe(e),t)},Nt=function(e){var t=St.call(this,e=H(e,!0));return!(this===kt&&A(At,e)&&!A(wt,e))&&(!(t||!A(this,e)||!A(At,e)||A(this,Et)&&this[Et][e])||t)},Gt=function(e,t){if(e=fe(e),t=H(t,!0),e!==kt||!A(At,t)||A(wt,t)){var r=yt(e,t);return!r||!A(At,t)||A(e,Et)&&e[Et][t]||(r.enumerable=!0),r}},Vt=function(e){for(var t,r=gt(fe(e)),n=[],i=0;r.length>i;)A(At,t=r[i++])||t==Et||t==pt||n.push(t);return n},Ut=function(e){for(var t,r=e===kt,n=gt(r?wt:fe(e)),i=[],a=0;n.length>a;)!A(At,t=n[a++])||r&&!A(kt,t)||i.push(At[t]);return i};It||(le((vt=function(){if(this instanceof vt)throw TypeError("Symbol is not a constructor!");var e=x(arguments.length>0?arguments[0]:void 0),t=function t(r){this===kt&&t.call(wt,r),A(this,Et)&&A(this[Et],e)&&(this[Et][e]=!1),xt(this,e,z(1,r))};return B&&Pt&&xt(kt,e,{configurable:!0,set:t}),Rt(e)}).prototype,"toString",(function(){return this._k})),ft.f=Gt,Y.f=Lt,ot.f=dt.f=Vt,rt.f=Nt,tt.f=Ut,Ye.f=function(e){return Rt(xe(e))}),q(q.G+q.W+q.F*!It,{Symbol:vt});for(var Zt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Bt=0;Zt.length>Bt;)xe(Zt[Bt++]);for(var Ft=Se(xe.store),jt=0;Ft.length>jt;)et(Ft[jt++]);q(q.S+q.F*!It,"Symbol",{for:function(e){return A($t,e+="")?$t[e]:$t[e]=vt(e)},keyFor:function(e){if(!Ot(e))throw TypeError(e+" is not a symbol!");for(var t in $t)if($t[t]===e)return t},useSetter:function(){Pt=!0},useSimple:function(){Pt=!1}}),q(q.S+q.F*!It,"Object",{create:Mt,defineProperty:Lt,defineProperties:Dt,getOwnPropertyDescriptor:Gt,getOwnPropertyNames:Vt,getOwnPropertySymbols:Ut});var Wt=Z((function(){tt.f(1)}));q(q.S+q.F*Wt,"Object",{getOwnPropertySymbols:function(e){return tt.f(S(e))}}),bt&&q(q.S+q.F*(!It||Z((function(){var e=vt();return"[null]"!=_t([e])||"{}"!=_t({a:e})||"{}"!=_t(Object(e))}))),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(V(t)||void 0!==e)&&!Ot(e))return it(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ot(t))return t}),n[1]=t,_t.apply(bt,n)}}),vt.prototype[Tt]||J(vt.prototype,Tt,vt.prototype.valueOf),Le(vt,"Symbol"),Le(Math,"Math",!0),Le(k.JSON,"JSON",!0),et("asyncIterator"),et("observable");var Xt=w.Symbol,Ht=t((function(e){e.exports={default:Xt,__esModule:!0}}));e(Ht);var Kt=t((function(e,t){function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=r(Je),i=r(Ht),a="function"==typeof i.default&&"symbol"==_typeof$b(n.default)?function(e){return _typeof$b(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":_typeof$b(e)};t.default="function"==typeof i.default&&"symbol"===a(n.default)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":a(e)}})),Yt=e(Kt),zt=e(t((function(e,t){t.__esModule=!0;var r,n=(r=Kt)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,n.default)(t))&&"function"!=typeof t?e:t}})));q(q.S+q.F*!B,"Object",{defineProperty:Y.f});var Jt=w.Object,Qt=function(e,t,r){return Jt.defineProperty(e,t,r)},qt=t((function(e){e.exports={default:Qt,__esModule:!0}}));e(qt);var er=e(t((function(e,t){t.__esModule=!0;var r,n=(r=qt)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(e,i.key,i)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()}))),tr=function(e,t){if(U(e),!V(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},rr={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=G(Function.call,ft.f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(n){t=!0}return function(e,n){return tr(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:tr};q(q.S,"Object",{setPrototypeOf:rr.set});var nr=w.Object.setPrototypeOf,ir=t((function(e){e.exports={default:nr,__esModule:!0}}));e(ir),q(q.S,"Object",{create:Pe});var ar=w.Object,or=function(e,t){return ar.create(e,t)},sr=t((function(e){e.exports={default:or,__esModule:!0}}));e(sr);var lr,ur,cr,dr=e(t((function(e,t){function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=r(ir),i=r(sr),a=r(Kt);t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,a.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}}))),hr=xe("toStringTag"),fr="Arguments"==de(function(){return arguments}()),pr=function(e,t){try{return e[t]}catch(r){}},yr=function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=pr(t=Object(e),hr))?r:fr?de(t):"Object"==(n=de(t))&&"function"==typeof t.callee?"Arguments":n},mr=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e},gr=function(e,t,r,n){try{return n?t(U(r)[0],r[1]):t(r)}catch(a){var i=e.return;throw void 0!==i&&U(i.call(e)),a}},vr=xe("iterator"),br=Array.prototype,_r=function(e){return void 0!==e&&(ue.Array===e||br[vr]===e)},Er=xe("iterator"),Tr=w.getIteratorMethod=function(e){if(null!=e)return e[Er]||e["@@iterator"]||ue[yr(e)]},Sr=t((function(e){var t={},r={},n=e.exports=function(e,n,i,a,o){var s,l,u,c,d=o?function(){return e}:Tr(e),h=G(i,a,n?2:1),f=0;if("function"!=typeof d)throw TypeError(e+" is not iterable!");if(_r(d)){for(s=ye(e.length);s>f;f++)if((c=n?h(U(l=e[f])[0],l[1]):h(e[f]))===t||c===r)return c}else for(u=d.call(e);!(l=u.next()).done;)if((c=gr(u,h,l.value,n))===t||c===r)return c};n.BREAK=t,n.RETURN=r})),$r=xe("species"),Ar=function(e,t){var r,n=U(e).constructor;return void 0===n||null==(r=U(n)[$r])?t:N(r)},wr=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)},kr=k.process,Ir=k.setImmediate,Cr=k.clearImmediate,Pr=k.MessageChannel,xr=k.Dispatch,Rr=0,Or={},Lr=function(){var e=+this;if(Or.hasOwnProperty(e)){var t=Or[e];delete Or[e],t()}},Dr=function(e){Lr.call(e.data)};Ir&&Cr||(Ir=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return Or[++Rr]=function(){wr("function"==typeof e?e:Function(e),t)},lr(Rr),Rr},Cr=function(e){delete Or[e]},"process"==de(kr)?lr=function(e){kr.nextTick(G(Lr,e,1))}:xr&&xr.now?lr=function(e){xr.now(G(Lr,e,1))}:Pr?(cr=(ur=new Pr).port2,ur.port1.onmessage=Dr,lr=G(cr.postMessage,cr,1)):k.addEventListener&&"function"==typeof postMessage&&!k.importScripts?(lr=function(e){k.postMessage(e+"","*")},k.addEventListener("message",Dr,!1)):lr="onreadystatechange"in W("script")?function(e){we.appendChild(W("script")).onreadystatechange=function(){we.removeChild(this),Lr.call(e)}}:function(e){setTimeout(G(Lr,e,1),0)});var Mr={set:Ir,clear:Cr},Nr=Mr.set,Gr=k.MutationObserver||k.WebKitMutationObserver,Vr=k.process,Ur=k.Promise,Zr="process"==de(Vr),Br={f:function(e){return new r(e)}},Fr=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}},jr=k.navigator,Wr=jr&&jr.userAgent||"",Xr=function(e,t){if(U(e),V(t)&&t.constructor===e)return t;var r=Br.f(e);return(0,r.resolve)(t),r.promise},Hr=xe("species"),Kr=xe("iterator"),Yr=!1;try{var zr=[7][Kr]();zr.return=function(){Yr=!0},Array.from(zr,(function(){throw 2}))}catch(te){}var Jr,Qr,qr,en,tn=Mr.set,rn=function(){var e,t,r,n=function(){var n,i;for(Zr&&(n=Vr.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(a){throw e?r():t=void 0,a}}t=void 0,n&&n.enter()};if(Zr)r=function(){Vr.nextTick(n)};else if(!Gr||k.navigator&&k.navigator.standalone)if(Ur&&Ur.resolve){var i=Ur.resolve(void 0);r=function(){i.then(n)}}else r=function(){Nr.call(k,n)};else{var a=!0,o=document.createTextNode("");new Gr(n).observe(o,{characterData:!0}),r=function(){o.data=a=!a}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}(),nn=k.TypeError,an=k.process,on=an&&an.versions,sn=on&&on.v8||"",ln=k.Promise,un="process"==yr(an),cn=function(){},dn=Qr=Br.f,hn=!!function(){try{var e=ln.resolve(1),t=(e.constructor={})[xe("species")]=function(e){e(cn,cn)};return(un||"function"==typeof PromiseRejectionEvent)&&e.then(cn)instanceof t&&0!==sn.indexOf("6.6")&&-1===Wr.indexOf("Chrome/66")}catch(r){}}(),fn=function(e){var t;return!(!V(e)||"function"!=typeof(t=e.then))&&t},pn=function(e,t){if(!e._n){e._n=!0;var r=e._c;rn((function(){for(var n=e._v,i=1==e._s,a=0;r.length>a;)!function(t){var r,a,o,s=i?t.ok:t.fail,l=t.resolve,u=t.reject,c=t.domain;try{s?(i||(2==e._h&&gn(e),e._h=1),!0===s?r=n:(c&&c.enter(),r=s(n),c&&(c.exit(),o=!0)),r===t.promise?u(nn("Promise-chain cycle")):(a=fn(r))?a.call(r,l,u):l(r)):u(n)}catch(d){c&&!o&&c.exit(),u(d)}}(r[a++]);e._c=[],e._n=!1,t&&!e._h&&yn(e)}))}},yn=function(e){tn.call(k,(function(){var t,r,n,i=e._v,a=mn(e);if(a&&(t=Fr((function(){un?an.emit("unhandledRejection",i,e):(r=k.onunhandledrejection)?r({promise:e,reason:i}):(n=k.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=un||mn(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},mn=function(e){return 1!==e._h&&0===(e._a||e._c).length},gn=function(e){tn.call(k,(function(){var t;un?an.emit("rejectionHandled",e):(t=k.onrejectionhandled)&&t({promise:e,reason:e._v})}))},vn=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),pn(t,!0))},bn=function e(t){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw nn("Promise can't be resolved itself");(r=fn(t))?rn((function(){var i={_w:n,_d:!1};try{r.call(t,G(e,i,1),G(vn,i,1))}catch(a){vn.call(i,a)}})):(n._v=t,n._s=1,pn(n,!1))}catch(i){vn.call({_w:n,_d:!1},i)}}};hn||(ln=function(e){mr(this,ln,"Promise","_h"),N(e),Jr.call(this);try{e(G(bn,this,1),G(vn,this,1))}catch(t){vn.call(this,t)}},(Jr=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(e,t,r){for(var n in t)r&&e[n]?e[n]=t[n]:J(e,n,t[n]);return e}(ln.prototype,{then:function(e,t){var r=dn(Ar(this,ln));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=un?an.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&pn(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),qr=function(){var e=new Jr;this.promise=e,this.resolve=G(bn,e,1),this.reject=G(vn,e,1)},Br.f=dn=function(e){return e===ln||e===en?new qr(e):Qr(e)}),q(q.G+q.W+q.F*!hn,{Promise:ln}),Le(ln,"Promise"),function(e){var t="function"==typeof w[e]?w[e]:k[e];B&&t&&!t[Hr]&&Y.f(t,Hr,{configurable:!0,get:function(){return this}})}("Promise"),en=w.Promise,q(q.S+q.F*!hn,"Promise",{reject:function(e){var t=dn(this);return(0,t.reject)(e),t.promise}}),q(q.S+!0*q.F,"Promise",{resolve:function(e){return Xr(this===en?ln:this,e)}}),q(q.S+q.F*!(hn&&function(e,t){if(!Yr)return!1;var r=!1;try{var n=[7],i=n[Kr]();i.next=function(){return{done:r=!0}},n[Kr]=function(){return i},e(n)}catch(a){}return r}((function(e){ln.all(e).catch(cn)}))),"Promise",{all:function(e){var t=this,r=dn(t),n=r.resolve,i=r.reject,a=Fr((function(){var r=[],a=0,o=1;Sr(e,!1,(function(e){var s=a++,l=!1;r.push(void 0),o++,t.resolve(e).then((function(e){l||(l=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=dn(t),n=r.reject,i=Fr((function(){Sr(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}}),q(q.P+q.R,"Promise",{finally:function(e){var t=Ar(this,w.Promise||k.Promise),r="function"==typeof e;return this.then(r?function(r){return Xr(t,e()).then((function(){return r}))}:e,r?function(r){return Xr(t,e()).then((function(){throw r}))}:e)}}),q(q.S,"Promise",{try:function(e){var t=Br.f(this),r=Fr(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}});var _n=w.Promise,En=e(t((function(e){e.exports={default:_n,__esModule:!0}})));ee("keys",(function(){return function(e){return Se(S(e))}}));var Tn=w.Object.keys,Sn=e(t((function(e){e.exports={default:Tn,__esModule:!0}}))),$n=t((function(e){function t(){}function r(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,n,i,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new r(n,i||e,a),l=s?s+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function i(e,r){0==--e._eventsCount?e._events=new t:delete e._events[r]}function a(){this._events=new t,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,s="~";Object.create&&(t.prototype=Object.create(null),(new t).__proto__||(s=!1)),a.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)o.call(e,t)&&r.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=s?s+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,i=r.length,a=new Array(i);n<i;n++)a[n]=r[n].fn;return a},a.prototype.listenerCount=function(e){var t=s?s+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,n,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,n),!0;case 5:return c.fn.call(c.context,t,r,n,i),!0;case 6:return c.fn.call(c.context,t,r,n,i,a),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},a.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,r,n){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return i(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||n&&!o.once||r&&o.context!==r||i(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||n&&!o[l].once||r&&o[l].context!==r)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:i(this,a)}return this},a.prototype.removeAllListeners=function(e){var r;return e?(r=s?s+e:e,this._events[r]&&i(this,r)):(this._events=new t,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,e.exports=a})),An=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,n=t.method,i=void 0===n?"GET":n,a=t.type,o=void 0===a?"arraybuffer":a,s=t.timeout,l=void 0===s?1e4:s,u=t.data,c=void 0===u?{}:u,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ie(this,e),new En((function(e,t){var n=new window.XMLHttpRequest,a=i.toUpperCase(),s=[];for(var u in o&&(n.responseType=o),l&&(n.timeout=l),c)s.push("k="+c[u]);if(n.onload=function(){200===n.status||206===n.status?e({context:d,res:n}):t(new Error({context:d,res:n,type:"error"}))},n.onerror=function(e){t(new Error({context:d,res:n,type:"error"}))},n.ontimeout=function(e){t(new Error({context:d,res:n,type:"error"}))},n.onabort=function(){t(new Error({context:d,res:n,type:"error"}))},"GET"===a)n.open(a,""+r),n.send();else{if("post"!==a)throw new Error("xhr "+a+" is not supported");n.open(a,r),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(s.join("&"))}}))},wn=/^WEBVTT/,kn=/^STYLE+$/,In=/^\:\:cue/,Cn=/^}+$/,Pn=/^\[Script Info\].*/,xn=[/[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}\.[0-9]{1,3}-->[0-9]{1,2}\.[0-9]{1,3}/],Rn=/^Format:\s/,On=/^Style:\s/,Ln=/^Dialogue:\s/,Dn=function(){function e(){ie(this,e)}return er(e,null,[{key:"parseJson",value:function(e){for(var t=[],r=0,n=0;n<e.length;n++){if(r>=50&&(r=0),0===r){var i={start:e[n].start,list:[e[n]],end:e[n].end};t.push(i)}else t[t.length-1].list.push(e[n]),t[t.length-1].end=e[n].end;r++}return t}},{key:"parse",value:function(t,r){var n=e.checkFormat(t);n||r({format:n});try{var i=[];"ass"===n?i=e.parseASS(t):"vtt"===n&&(i=e.parseVTT(t)),r({format:n,list:i.list,styles:i.styles})}catch(a){console.error(a),r({format:n},a)}}},{key:"parseASSItem",value:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(","),r={},i="";try{var o=t.length-e.length;return i=a(i=(i=o>0?t.splice(e.length-1,o+1).join(",")+"":t[t.length-1]+"").replace(/\\n+/g,"")),t[e.length-1]=i,e.map((function(e,i){"end"===e||"start"===e?r[e]=n(t[i].split(":")):"text"===e?r[e]=[t[i]]:"layer"===e?(r[e]=[t[i]],r.textTag=[t[i]]):r[e]="style"===e?[t[i]]:Number(t[i])?Number(t[i]):t[i]})),r}catch(s){return console.error(s),{}}}},{key:"parseASS",value:function(t){for(var r=t.split("\n"),n=[],i=0,a=0,o=[],s=[],l=null;i<r.length;){if(Rn.test(r[i]))s=(s=r[i].replace(Rn,"").replace(/\s+/g,"").split(",")).map((function(e){return e.toLocaleLowerCase()}));else if(On.test(r[i]))o.push(r[i].replace(On,"").replace(/\s+/g,""));else if(Ln.test(r[i])){var u=e.parseASSItem(r[i].replace(Ln,""),s);if(l&&u.start===l.start&&u.end===l.end)try{var c=l,d=c.text,h=c.textTag,f=c.style;d.push(u.text[0]),h.push(u.textTag[0]),f.push(u.style[0])}catch(y){console.error(y)}else{l=u;var p=null;a%50==0?((p={start:l.start,end:l.end,list:[]}).list.push(l),n.push(p)):((p=n[n.length-1]).end=l.end,p.list.push(l)),a++}}i++}return{list:n,style:{}}}},{key:"parseVTTStyle",value:function(e,t){var r=e.split(":");if(r.length>1){var n=r[0].trim().split("-"),i="";n.length>1?n.map((function(e,t){i+=0===t?e:e.charAt(0).toUpperCase()+e.slice(1)})):i=n[0],t[i]=r[1].trim().replace(/;$/,"")}return t}},{key:"parseVTT",value:function(e){for(var t=(e=e.replace(wn,"")).split("\n"),r=[],n=0,a=0,s=null,l=!1,u=!1,c=null,d=null,h=[];n<t.length;){var f=o(n,t).trim();if(!f||l&&i(f))l=!f;else if(In.test(f)&&kn.test(o(n-1,t).trim())){u=!0;var p=/\((.+?)\)/g.exec(f);d=p?p[1]:"",c=""}else if(u)Cn.test(f)?(h.push({key:d,style:c}),c=null,d=null,u=!1):c+=f;else if(f){l=!1;var y=this.checkIsTime(t[n]);if(y){var m=this.parseVttTime(y);if(!s||m.start!==s.start||m.end!==s.end){(s=m).text=[],s.textTag=[];var g=null;a%50==0?((g={start:s.start,end:s.end,list:[]}).list.push(s),r.push(g)):((g=r[r.length-1]).end=s.end,g.list.push(s)),a++}}else if(s){var v=s,b=v.text,_=v.textTag,E=this.parseVttText(t[n]);b.push(E.text),_.push(E.tag)}l=!1}n++}return{list:r,styles:h}}},{key:"checkIsTime",value:function(e){e=e.replace(/\s+/g,"");for(var t=0,r=null;t<xn.length&&!(r=xn[t].exec(e));)t++;return r?r[0]:null}},{key:"parseVttText",value:function(e){var t=/^(<?.+?>)/g.exec(e),r="",n="default";if(t){n=t[0].replace(/\<|\>|\&/g,"");var i=RegExp("^<"+n+">(([\\s\\S])*?)</"+n+">$").exec(e);i?r=i[1]:(r=e,n="")}else r=e;for(var o=/<(\w+).(\w+)>/g,s=o.exec(r);s&&s.length>2;)r=r.replace(s[0],"<"+s[1]+' class="'+s[2]+'">'),s=o.exec(r);return{tag:n,text:a(r.replace(/\\n+/g,"<br/>"))}}},{key:"parseVttTime",value:function(e){var t=e.split("--\x3e"),r=void 0,i=0;if(2===t.length){var a=t[0].split(":"),o=t[1].split(":");r=n(a),i=n(o)}return{start:r,end:i,time:e}}},{key:"isVTT",value:function(e){return wn.test(e)}},{key:"isASS",value:function(e){return Pn.test(e)}},{key:"checkFormat",value:function(e){return e?wn.test(e)?"vtt":Pn.test(e)?"ass":null:null}}]),e}(),Mn=function(){function e(){var t=this;ie(this,e),this.__handlers=[],window.ResizeObserver&&(this.observer=new window.ResizeObserver((function(e){t.__trigger(e)})))}return er(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=this.__handlers,n=-1,i=0;i<r.length;i++)r[i]&&e===r[i].target&&(n=i);n>-1?this.__handlers[n].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(r,n){e===r.target&&(t=n)})),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e,t){for(var r=this.__handlers,n=0;n<r.length;n++)if(r[n]&&e===r[n].target){r[n].handler&&r[n].handler.map((function(r){try{r(e,t)}catch(n){console.error(n)}}));break}}},{key:"__trigger",value:function(e){var t=this;e.map((function(e){var r=e.contentRect;t.__runHandler(e.target,r)}))}}]),e}(),Nn=null;!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}('xg-text-track.xg-text-track {\n  font-family: "PingFang SC","SF Pro SC","SF Pro Text","SF Pro Icons","Helvetica Neue","Helvetica","Arial",sans-serif;\n  -webkit-font-smoothing: antialiased;\n  position: absolute;\n  bottom: 0;\n  color: #fff;\n  left: 0;\n  right: 0;\n  pointer-events: none;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center; }\n  xg-text-track.xg-text-track.text-track-no-fitvideo {\n    margin-bottom: 2%; }\n  xg-text-track.xg-text-track.text-track-hide {\n    opacity: 0;\n    visibility: hidden; }\n  xg-text-track.xg-text-track.text-track-show {\n    opacity: 1;\n    visibility: visible; }\n  xg-text-track.xg-text-track xg-text-track-inner {\n    display: block;\n    max-width: 92%; }\n  xg-text-track.xg-text-track xg-text-track-span {\n    display: -webkit-box;\n    text-align: center;\n    text-overflow: ellipsis;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    padding: 1px 4px;\n    -webkit-line-clamp: 1;\n    line-height: 120%;\n    word-break: break-word; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-deputy {\n      font-size: 75%; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-single {\n      -webkit-line-clamp: 1; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-double {\n      -webkit-line-clamp: 2; }\n    xg-text-track.xg-text-track xg-text-track-span.text-track-three {\n      -webkit-line-clamp: 3; }\n  xg-text-track.xg-text-track.text-track-bg xg-text-track-inner {\n    background-color: rgba(0, 0, 0, .54);\n    border-radius: 2px; }\n  xg-text-track.xg-text-track.text-track-stroke xg-text-track-inner {\n    background-color: none;\n    border-radius: 0;\n    text-shadow: -1px 1px 0 rgba(0, 0, 0, .7), 1px 1px 0 rgba(0, 0, 0, .7), 1px -1px 0 rgba(0, 0, 0, .7), -1px -1px 0 rgba(0, 0, 0, .7); }\n');var Gn=[{code:0,msg:"SUCCESS"},{code:1,msg:"LOAD_ERROR"},{code:2,msg:"PARSER_ERROR"},{code:3,msg:"FORMAT_NOT_SUPPORTED"},{code:4,msg:"ID_OR_LANGUAGE_NOT_EXIST"},{code:5,msg:"PARAMETERS_ERROR"},{code:6,msg:"ABORT"},{code:7,msg:"UNKNOWN"},{code:8,msg:"DATA_ERROR:subtitle.url is null"}],Vn={RESIZE:"resize"},Un=!1;return function(e){function t(e){ie(this,t);var r=zt(this,(t.__proto__||ne(t)).call(this));return Un=p(),r.currentText=null,r.textTrack=[],r._cid=-1,r._gid=-1,r._cids=[],r._iId=null,r._iC=0,r.player=null,r.root=null,r.config={line:"double",bottom:0,mode:"stroke",defaultOpen:!1,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,fitVideo:!0,offsetBottom:2,fontColor:"#fff"},r._ctime=0,r._loadingTrack={},Sn(r.config).map((function(t){void 0!==e[t]&&null!==e[t]&&(r.config[t]=e[t])})),r._isOpen=!1,r._videoMeta={scale:0,videoHeight:0,videoWidth:0,lwidth:0,lheight:0,vWidth:0,vHeight:0,vBottom:0,vLeft:0,marginBottom:0},e.subTitles&&"Array"===h(e.subTitles)?(e.player&&r.attachPlayer(e.player),r.setSubTitles(e.subTitles,r.config.defaultOpen),r):zt(r)}return dr(t,e),er(t,[{key:"version",get:function(){return"1.0.12"}}]),er(t,[{key:"setSubTitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this._isOpen||r;n&&this.innerRoot&&this.switchOff(),this.currentText=null,this.textTrack=[],e.map((function(e){var r={};Sn(e).map((function(t){r[t]=e[t]})),r.isDefault&&(t.currentText=r),t.textTrack.push(r)})),this.currentText&&_(this.currentText).then((function(e){t.addStyles(e),i&&t.switch()}))}},{key:"addStyles",value:function(e){var t=e.styles,r=e.format;t&&"vtt"===r&&(t.map((function(e){e.key||(e.key="xg-text-track-span")})),y(t,"xg-text-track"))}},{key:"attachPlayer",value:function(e){var t=this;if(e){this.player&&this.detachPlayer();var r=this.config,n=r.fontColor,i=r.mode,a=r.fitVideo;this.player=e,this.root=document.createElement("xg-text-track"),this.root.className="xg-text-track",!this._isOpen&&l(this.root,"text-track-hide"),!a&&l(this.root,"text-track-no-fitvideo"),i&&l(this.root,"text-track-"+i),this.innerRoot=document.createElement("xg-text-track-inner"),this.root.appendChild(this.innerRoot),n&&(this.root.style.color=n),this.currentText&&["language","id","label"].map((function(e){t.root.setAttribute("data-"+e,t.currentText[e]||"")})),this.player.root.appendChild(this.root),["destroy","__onTimeupdate","_onResize"].map((function(e){t[e]=t[e].bind(t)})),this.player.on("destroy",this.destroy),this.player.on("timeupdate",this.__onTimeupdate),this._isOpen&&this.switch(),m(e.root,this._onResize)}}},{key:"detachPlayer",value:function(){var e=this.player;e&&(e.off("destroy",this.destroy),e.off("timeupdate",this.__onTimeupdate),e.root&&(g(e.root,this._onResize),e.root.removeChild(this.root)),this.innerRoot=null,this.root=null,this.player=null)}},{key:"switch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""};return this._loadingTrack=t,new En((function(r,n){if(t.id||t.language)if(e.currentText&&E(t,e.currentText))e._loadingTrack={},e._updateCurrent(e.currentText),e._isOpen=!0,e.show(),r(v(0));else{for(var i=null,a=0;a<e.textTrack.length;a++)if(E(t,e.textTrack[a])){i=e.textTrack[a];break}if(i)i.list?(e._loadingTrack={},e._updateCurrent(i),e._isOpen=!0,e.show(),r(v(0))):_(i).then((function(t){if(e.addStyles(t),e._loadingTrack.id===i.id||e._loadingTrack.language===t.language)e._loadingTrack={},e._updateCurrent(t),e._isOpen=!0,e.show(),r(v(0));else{var a=v(6,{message:"check _loadingTrack fail id: "+e._loadingTrack.id+"  nextSubtitle:"+t.id});console.trace(a),n(a)}})).catch((function(e){n(e)}));else{var o=v(4,new Error("The is no subtitle with id:[{"+t.id+"}] or language:["+t.language+"]"));console.trace(o),n(o)}}else{if(e.currentText){e._loadingTrack={},e._updateCurrent(e.currentText),e._isOpen=!0,e.show();var s=v(0,{message:"switch default subtitle success"});return void r(s)}var l=v(5,{message:"no default subtitle"});n(l)}}))}},{key:"switchOff",value:function(){this._isOpen=!1,this.hide()}},{key:"_updateCurrent",value:function(e){var t=this;if(this.root){this.currentText=e,["language","id","label"].map((function(e){t.root.setAttribute("data-"+e,t.currentText[e]||"")})),this.__remove(this._cids);var r=this.player.currentTime;this._cids=[],this._gid=-1,this._cid=-1,this._update(r)}}},{key:"__loadAll",value:function(){this.textTrack.map((function(e){_(e)}))}},{key:"getDelCid",value:function(e,t){for(var r=[],n=0;n<e.length;n++)t.includes(e[n])||r.push(e[n]);return r}},{key:"getNewCid",value:function(e,t){for(var r=[],n=0;n<t.length;n++)e.includes(t[n])||r.push(t[n]);return r}},{key:"_update",value:function(e){var t=this,r=c(e,this.currentText.list,this._gid),n=[];if(r>-1&&(n=d(e,this.currentText.list[r].list,this._cid)),n.length<1)return this._cids.length>0&&this.__remove(this._cids),void(this._cids=[]);if(this._cids!==n||r!==this._gid){this._gid=r,this._cid=n[0];var i=this.getDelCid(this._cids,n),a=this.getNewCid(this._cids,n);this._cids=n,this.__remove(i);var o=[];a.map((function(e){var n=t.currentText.list[r].list[e];n.index=e,o.push(n)})),this.__render(o,e)}}},{key:"__onTimeupdate",value:function(){if(this._isOpen){var e=this.player.video,t=e.videoWidth,r=e.videoHeight;!this._videoMeta.scale&&t&&r&&this._onResize(this.player.root);var n=this.player.currentTime;Math.round(Math.abs(1e3*n-this._ctime))<200||(this._ctime=1e3*n,this.currentText&&this.currentText.list&&this._update(n))}}},{key:"_onResize",value:function(e){var t=this._videoMeta;if(e&&e instanceof window.Element||(e=this.player.root),this._iId&&(clearTimeout(this._iId),this._iId=null),!t.scale){if(!this.player.video)return;var r=this.player.video,n=r.videoWidth,i=r.videoHeight;if(!n||!i)return;t.videoWidth=n,t.videoHeight=i,t.scale=parseInt(i/n*100,10)}this.__startResize(e)}},{key:"resize",value:function(e,t){var r=this,n=this.config,i=n.baseSizeX,a=n.baseSizeY,o=n.minMobileSize,s=n.minSize,l=n.fitVideo,u=n.offsetBottom,c=this._videoMeta.scale;this._videoMeta.lwidth=e,this._videoMeta.lheight=t;var d=void 0,h=0;t/e*100>=c?(h=parseInt(c*e,10)/100,d=e):(h=t,d=parseInt(t/c*100,10)),this._videoMeta.vWidth=d,this._videoMeta.vHeight=h;var f=0,p=0;c>120?(f=a,p=parseInt(f*h/1080,10)):(f=i,p=parseInt(f*d/1920,10));var y=Un?o:s,m={fontSize:p=p<y?y:p>f?f:p},g=parseInt((t-h)/2,10),v=parseInt((e-d)/2,10),b=parseInt(h*u,10)/100;this._videoMeta.vBottom=g,this._videoMeta.vLeft=v,this._videoMeta.marginBottom=b,l&&(m.bottom=g+b,m.left=m.right=v),Sn(m).map((function(e){r.root.style[e]=m[e]+"px"})),this.emit(Vn.RESIZE,{vLeft:v,vBottom:g,marginBottom:b,vWidth:d,vHeight:h,fontSize:p,scale:c})}},{key:"__startResize",value:function(e){var t=this,r=e.getBoundingClientRect(),n=this._videoMeta,i=r.width,a=r.height;if(this._iId&&(clearTimeout(this._iId),this._iId=null),i>0&&a>0&&(i!==n.lwidth||a!==n.lheight))this._iC=0,this.resize(i,a);else{if(this._iC>=5)return void(this._iC=0);this._iC++,this._iId=setTimeout((function(){t.__startResize(e)}),50)}}},{key:"__remove",value:function(e){var t=this;if(e&&!(e.length<1)){for(var r=this.innerRoot.children,n=[],i=0;i<r.length;i++){var a=Number(r[i].getAttribute("data-index"));e.includes(a)&&n.push(r[i])}n.map((function(e){t.innerRoot.removeChild(e)}))}}},{key:"__render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.length>0&&t.map((function(t){var r="text-track-"+e.config.line;t.text.map((function(n,i){i>0&&(r+=" text-track-deputy");var a={"data-start":t.start,"data-end":t.end,"data-index":t.index};e.innerRoot.appendChild(f("xg-text-track-span",n,a,r))}))}))}},{key:"show",value:function(){u(this.root,"text-track-hide")}},{key:"hide",value:function(){l(this.root,"text-track-hide"),this.innerRoot.innerHTML=""}},{key:"destroy",value:function(){this.detachPlayer(),this.removeAllListeners(),this.player=null,this.textTrack=null}},{key:"marginBottom",get:function(){var e=this._videoMeta,t=e.bottom,r=e.marginBottom;return this.config.fitVideo?t+r:r}}]),t}($n)}()}(index_min$2);var SubTitles=getDefaultExportFromCjs(index_min$2.exports),DEFAULT_CLOSE_TYPE$1="text-close";function formatList$1(e){var t=-1;return e.map((function(e,r){e.id||e.language||(e.id=r),!e.url&&(e.url=e.src),!e.text&&(e.text=e.label),!e.language&&(e.language=e.srclang),void 0===e.isDefault&&(e.isDefault=e.default),(e.isDefault||e.default)&&(t<0?t=r:e.isDefault=e.default=!1)})),t}var TextTrack=function(e){_inherits$f(r,e);var t=_createSuper$i(r);function r(){var e;_classCallCheck$i(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$i(_assertThisInitialized$f(e=t.call.apply(t,[this].concat(i))),"clickSwitch",(function(t,r){e.subTitles&&(r.type===DEFAULT_CLOSE_TYPE$1?e.switchOffSubtile():e.switchSubTitle({language:r.language,id:r.id}))})),_defineProperty$i(_assertThisInitialized$f(e),"onPlayerFocus",(function(t){e.subTitles&&e.config.style.follow&&e.rePosition()})),_defineProperty$i(_assertThisInitialized$f(e),"onPlayerBlur",(function(t){e.subTitles&&e.config.style.follow&&!e.playerConfig.marginControls&&e.subTitles.root&&(e.subTitles.root.style.transform="translate(0, 0)")})),e}return _createClass$j(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.texttrack||e.player.config.textTrack;"Array"===util$2.typeOf(t)&&(e.config.list=t)}},{key:"afterCreate",value:function(){var e=this.config,t=e.list,n=e.style,i=e.isDefaultOpen;this.curIndex=-1,this.curItem=null;var a=formatList$1(t);_get$3(_getPrototypeOf$f(r.prototype),"afterCreate",this).call(this);var o={subTitles:t,defaultOpen:i};this.handlerClickSwitch=this.hook("subtitle_change",this.clickSwitch),Object.keys(n).map((function(e){o[e]=n[e]})),!this.playerConfig.marginControls&&this.player.controls.root&&(this.on(PLAYER_FOCUS,this.onPlayerFocus),this.on(PLAYER_BLUR,this.onPlayerBlur)),this.subTitles=new SubTitles(o),this.subTitles.attachPlayer(this.player),n.follow&&this.subTitles.root&&util$2.addClass(this.subTitles.root,"follow-control"),t&&0!==t.length&&(i&&a<0?(t[0].isDefault=!0,this.curIndex=0,this.curItem=t[0]):(this.curIndex=a,this.curItem=t[a]))}},{key:"show",value:function(){this.config.list&&0!==this.config.list.length&&_get$3(_getPrototypeOf$f(r.prototype),"show",this).call(this)}},{key:"updateSubtitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var r=[];e.map((function(e){r.push(e)}));var n=formatList$1(r);this.curIndex=n,this.curItem=n>-1?r[n]:null;var i=n>-1;this.config.list=r,this.subTitles&&this.subTitles.setSubTitles(r,i,t),r.length>0?this.show():(this.switchOffSubtile(),this.hide()),this.renderItemList()}}},{key:"switchSubTitle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""},r=-1;t&&(t.id||t.language)&&(this.config.list.map((function(e,n){e.id!==t.id&&e.language!==t.language||(r=n)})),r===this.curIndex||r<0||this.subTitles.switch(t).then((function(n){0===n.code&&(t.off=!1,t.isListUpdate=!1,t.list=[],e.curIndex=r,e.curItem=e.config.list[r-1],e.renderItemList(),e.emit("subtitle_change",t))})))}},{key:"switchOffSubtile",value:function(){this.subTitles.switchOff(),this.emit("subtitle_change",{off:!0,isListUpdate:!1,list:[]}),this.curIndex=-1,this.curItem=null,this.renderItemList()}},{key:"onItemClick",value:function(e,t){_get$3(_getPrototypeOf$f(r.prototype),"onItemClick",this).apply(this,arguments);var n=e.delegateTarget,i=n.getAttribute("language"),a=n.getAttribute("data-id"),o=n.getAttribute("data-type");this.handlerClickSwitch(e,{language:i,id:a,type:o})}},{key:"changeCurrentText",value:function(){var e=this.config,t=e.list,r=e.closeText,n=this.curIndex;if(n-1<0)this.find(".icon-text").innerHTML=this.getTextByLang(r,"iconText");else if(n-1<t.length){var i=t[n-1];if(!i)return;this.find(".icon-text").innerHTML=this.getTextByLang(i,"iconText")}}},{key:"renderItemList",value:function(){var e=this,t=this.config,n=t.list,i=t.closeText,a=[];a.push({showText:this.getTextByLang(i),"data-type":DEFAULT_CLOSE_TYPE$1,selected:-1===this.curIndex}),n.map((function(t,r){var n={language:t.language||t.srclang,"data-id":t.id};n.selected=e.curIndex===r,n.showText=e.getTextByLang(t),a.push(n)})),_get$3(_getPrototypeOf$f(r.prototype),"renderItemList",this).call(this,a,this.curIndex+1)}},{key:"rePosition",value:function(){var e=this.config.style.fitVideo,t=0-this.player.controls.root.getBoundingClientRect().height;if(e){var r=this.player,n=r.video,i=r.root.getBoundingClientRect(),a=i.height,o=i.width,s=n.videoHeight,l=n.videoWidth,u=parseInt(s/l*100,10)*o/100;u>a&&(u=a);var c=(a-u)/2-t;c<0&&(this.subTitles.root.style.transform="translate(0, ".concat(c,"px)"))}else this.subTitles.root.style.transform="translate(0, ".concat(t,"px)")}},{key:"destroy",value:function(){this.subTitles&&(this.subTitles.destroy(),this.subTitles=null),_get$3(_getPrototypeOf$f(r.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"texttrack"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$a.CONTROLS_RIGHT,index:6,list:[],isDefaultOpen:!0,style:{follow:!0,mode:"stroke",followBottom:50,fitVideo:!0,offsetBottom:2,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,line:"double",fontColor:"#fff"},closeText:{text:"",iconText:""},className:"xgplayer-texttrack",hidePortrait:!1,isShowIcon:!0}}}]),r}(OptionsIcon),es=Object.freeze(Object.defineProperty({__proto__:null,Events:Events$1,SimplePlayer:Player,Plugin:Plugin,BasePlugin:BasePlugin,STATE_CLASS:STATE_CLASS,I18N:I18N,Errors:Errors$1,Sniffer:sniffer$1,Util:util$2,default:PresetPlayer,STATES:STATES$2,DefaultPresetEn:DefaultPreset$2,DefaultPreset:DefaultPreset$3,LivePreset:DefaultPreset$1,MobilePreset:DefaultPreset,langZhHk:zhHk,langJp:jp$1,langZhCn:ZH,Danmu:Danmu,TextTrack:TextTrack,DanmuIcon:DanmuIcon,DanmuPanel:DanmuPanel},Symbol.toStringTag,{value:"Module"})),DefinitionLinked={origin:{index:1,next:"uhd",prev:null},uhd:{index:2,next:"hd",prev:"origin"},hd:{index:3,next:"sd",prev:"uhd"},sd:{index:4,next:"ld",prev:"hd"},ld:{index:5,next:"ao",prev:"sd"},ao:{index:6,next:null,prev:"ld"}},PLAYER_LANGS=["zh","en","jp","zh-hk"],PLAYER_MODE={NORMAL:0,INNER:1,FULLSCREEN:2},VIDEO_STATUS_TYPE=function(e){return e[e.VALID=10]="VALID",e[e.TRANSCODING=30]="TRANSCODING",e[e.NO_SET_AUDIT=1e3]="NO_SET_AUDIT",e[e.OFFLINE=1002]="OFFLINE",e[e.NO_AUTH=2001]="NO_AUTH",e[e.UN_AUTH=2002]="UN_AUTH",e}(VIDEO_STATUS_TYPE||{}),MIN_EXPIRE_INTERVAL$1=300,dayjs_min$1={exports:{}};!function(e,t){e.exports=function(){var e=1e3,t=6e4,r=36e5,n="millisecond",i="second",a="minute",o="hour",s="day",l="week",u="month",c="quarter",d="year",h="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},g=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},v={s:g,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),n=Math.floor(r/60),i=r%60;return(t<=0?"+":"-")+g(n,2,"0")+":"+g(i,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),i=t.clone().add(n,u),a=r-i<0,o=t.clone().add(n+(a?-1:1),u);return+(-(n+(r-i)/(a?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:d,w:l,d:s,D:h,h:o,m:a,s:i,ms:n,Q:c}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",_={};_[b]=m;var E=function(e){return e instanceof A},T=function e(t,r,n){var i;if(!t)return b;if("string"==typeof t){var a=t.toLowerCase();_[a]&&(i=a),r&&(_[a]=r,i=a);var o=t.split("-");if(!i&&o.length>1)return e(o[0])}else{var s=t.name;_[s]=t,i=s}return!n&&i&&(b=i),i||!n&&b},S=function(e,t){if(E(e))return e.clone();var r="object"==_typeof$b(t)?t:{};return r.date=e,r.args=arguments,new A(r)},$=v;$.l=T,$.i=E,$.w=function(e,t){return S(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var A=function(){function m(e){this.$L=T(e.locale,null,!0),this.parse(e)}var g=m.prototype;return g.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if($.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(p);if(n){var i=n[2]-1||0,a=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=function(){return $},g.isValid=function(){return!(this.$d.toString()===f)},g.isSame=function(e,t){var r=S(e);return this.startOf(t)<=r&&r<=this.endOf(t)},g.isAfter=function(e,t){return S(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<S(e)},g.$g=function(e,t,r){return $.u(e)?this[t]:this.set(r,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var r=this,n=!!$.u(t)||t,c=$.p(e),f=function(e,t){var i=$.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return n?i:i.endOf(s)},p=function(e,t){return $.w(r.toDate()[e].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},y=this.$W,m=this.$M,g=this.$D,v="set"+(this.$u?"UTC":"");switch(c){case d:return n?f(1,0):f(31,11);case u:return n?f(1,m):f(0,m+1);case l:var b=this.$locale().weekStart||0,_=(y<b?y+7:y)-b;return f(n?g-_:g+(6-_),m);case s:case h:return p(v+"Hours",0);case o:return p(v+"Minutes",1);case a:return p(v+"Seconds",2);case i:return p(v+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var r,l=$.p(e),c="set"+(this.$u?"UTC":""),f=(r={},r[s]=c+"Date",r[h]=c+"Date",r[u]=c+"Month",r[d]=c+"FullYear",r[o]=c+"Hours",r[a]=c+"Minutes",r[i]=c+"Seconds",r[n]=c+"Milliseconds",r)[l],p=l===s?this.$D+(t-this.$W):t;if(l===u||l===d){var y=this.clone().set(h,1);y.$d[f](p),y.init(),this.$d=y.set(h,Math.min(this.$D,y.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[$.p(e)]()},g.add=function(n,c){var h,f=this;n=Number(n);var p=$.p(c),y=function(e){var t=S(f);return $.w(t.date(t.date()+Math.round(e*n)),f)};if(p===u)return this.set(u,this.$M+n);if(p===d)return this.set(d,this.$y+n);if(p===s)return y(1);if(p===l)return y(7);var m=(h={},h[a]=t,h[o]=r,h[i]=e,h)[p]||1,g=this.$d.getTime()+n*m;return $.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||f;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=$.z(this),a=this.$H,o=this.$m,s=this.$M,l=r.weekdays,u=r.months,c=function(e,r,i,a){return e&&(e[r]||e(t,n))||i[r].slice(0,a)},d=function(e){return $.s(a%12||12,e,"0")},h=r.meridiem||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:$.s(s+1,2,"0"),MMM:c(r.monthsShort,s,u,3),MMMM:c(u,s),D:this.$D,DD:$.s(this.$D,2,"0"),d:String(this.$W),dd:c(r.weekdaysMin,this.$W,l,2),ddd:c(r.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(a),HH:$.s(a,2,"0"),h:d(1),hh:d(2),a:h(a,o,!0),A:h(a,o,!1),m:String(o),mm:$.s(o,2,"0"),s:String(this.$s),ss:$.s(this.$s,2,"0"),SSS:$.s(this.$ms,3,"0"),Z:i};return n.replace(y,(function(e,t){return t||p[e]||i.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(n,h,f){var p,y=$.p(h),m=S(n),g=(m.utcOffset()-this.utcOffset())*t,v=this-m,b=$.m(this,m);return b=(p={},p[d]=b/12,p[u]=b,p[c]=b/3,p[l]=(v-g)/6048e5,p[s]=(v-g)/864e5,p[o]=v/r,p[a]=v/t,p[i]=v/e,p)[y]||v,f?b:$.a(b)},g.daysInMonth=function(){return this.endOf(u).$D},g.$locale=function(){return _[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=T(e,t,!0);return n&&(r.$L=n),r},g.clone=function(){return $.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},m}(),w=A.prototype;return S.prototype=w,[["$ms",n],["$s",i],["$m",a],["$H",o],["$W",s],["$M",u],["$y",d],["$D",h]].forEach((function(e){w[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),S.extend=function(e,t){return e.$i||(e(t,A,S),e.$i=!0),S},S.locale=T,S.isDayjs=E,S.unix=function(e){return S(1e3*e)},S.en=_[b],S.Ls=_,S.p={},S}()}(dayjs_min$1);var dayjs=dayjs_min$1.exports,utc$1={exports:{}};!function(e,t){var r,n,i;e.exports=(r="minute",n=/[+-]\d\d(?::?\d\d)?/g,i=/([+-]|\d\d)/g,function(e,t,a){var o=t.prototype;a.utc=function(e){return new t({date:e,utc:!0,args:arguments})},o.utc=function(e){var t=a(this.toDate(),{locale:this.$L,utc:!0});return e?t.add(this.utcOffset(),r):t},o.local=function(){return a(this.toDate(),{locale:this.$L,utc:!1})};var s=o.parse;o.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),s.call(this,e)};var l=o.init;o.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var u=o.utcOffset;o.utcOffset=function(e,t){var a=this.$utils().u;if(a(e))return this.$u?0:a(this.$offset)?u.call(this):this.$offset;if("string"==typeof e&&null===(e=function(e){void 0===e&&(e="");var t=e.match(n);if(!t)return null;var r=(""+t[0]).match(i)||["-",0,0],a=r[0],o=60*+r[1]+ +r[2];return 0===o?0:"+"===a?o:-o}(e)))return this;var o=Math.abs(e)<=16?60*e:e,s=this;if(t)return s.$offset=o,s.$u=0===e,s;if(0!==e){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(s=this.local().add(o+l,r)).$offset=o,s.$x.$localOffset=l}else s=this.utc();return s};var c=o.format;o.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,t)},o.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(e){return"s"===e&&this.$offset?a(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var h=o.diff;o.diff=function(e,t,r){if(e&&this.$u===e.$u)return h.call(this,e,t,r);var n=this.local(),i=a(e).local();return h.call(n,i,t,r)}})}(utc$1);var utc=utc$1.exports;dayjs.extend(utc);var VideoFileTypes=function(e){return e.VIDEO="video",e.EVIDEO="evideo",e}(VideoFileTypes||{}),safeJSONDecode=function(t){try{return JSON.parse(t)}catch(e){return console.warn("[utils/json] decode fail: ".concat(t),e),null}},parseToken=function(e){if(e){var t={},r=isBase64(e)?window.atob(e):e,n=safeJSONDecode(r);if(n&&"string"==typeof n.GetPlayInfoToken)n.GetPlayInfoToken.split("&").map((function(e){var r=e.split("=");r[0]&&r[1]&&(t[r[0]]=r[1])}));return t}},getQueryParams=function(e){var t={};return e.split("&").map((function(e){var r=e.split("=");r[0]&&r[1]&&(t[r[0]]=r[1])})),t},isEncryptPlay=function(e){var t,r;if(null==e||!e.playAuthToken)return!1;var n=parseToken(null==e?void 0:e.playAuthToken),i=null!==(t=null==n||null===(r=n.FileType)||void 0===r?void 0:r.toLocaleString())&&void 0!==t?t:"video";return!!n&&("evideo"===i||"eaudio"===i)},getFormat=function(e){var t,r,n;if(null==e||!e.playAuthToken)return"";var i=parseToken(null==e?void 0:e.playAuthToken),a=null!==(t=null==i||null===(r=i.FileType)||void 0===r?void 0:r.toLocaleString())&&void 0!==t?t:"video",o=null==i||null===(n=i.Format)||void 0===n?void 0:n.toLocaleString();return o||(Object.values(VideoFileTypes).includes(a)?"mp4":"m4a")},isTokenExpired=function(e){if(!e["X-Expires"]||!e["X-Date"])return!1;var t=parseInt(e["X-Expires"]);if(isNaN(t))return!1;var r=e["X-Date"].replace(/T/g," ").replace(/Z/g,""),n=dayjs.utc(r,"YYYYMMDD hhmmss");return!!n.isValid()&&n.add(t,"seconds").isBefore(dayjs())},formatDemotePriority=function(e){var t=(null==e?void 0:e.length)&&e.reduce((function(t,r,n){return t[r]={next:n+1>=e.length?null:e[n+1],pre:0===n?null:e[n-1]},t}),{});return console.log(t),t},getDefinitionInfo=function(e,t){if(!e||!e.Definition)return{definition:"240P"};if(t){var r=t[e.Definition];return r?"string"==typeof r?{definition:r}:_objectSpread2$c({},r||{}):{definition:e.Definition}}return{definition:e.Definition}},IntervalTimer$2=function(){function e(){_classCallCheck$j(this,e),this.timeID=null,this.func=null}return _createClass$k(e,[{key:"repeat",value:function(e,t){this.timeID=1,this.repeatInterval(e,t)}},{key:"repeatInterval",value:function(e,t){var r=this;this.timeID&&(null===this.func&&(this.func=e),this.func===e&&(this.timeID&&clearTimeout(this.timeID),this.timeID=null,this.timeID=setTimeout((function(){e(),r.repeatInterval(e,t)}),t)))}},{key:"clear",value:function(){clearTimeout(this.timeID),this.timeID=null}}]),e}(),XHR$2=_createClass$k((function t(r){var n=r.url,i=r.method,a=void 0===i?"GET":i,o=r.type,s=r.timeout,l=void 0===s?1e4:s,u=r.body,c=r.xhrSetup,d=r.cache,h=void 0===d||d;return _classCallCheck$j(this,t),new Promise((function(t,r){var i=new window.XMLHttpRequest,s=a.toUpperCase();if("GET"!==s&&"POST"!==s&&"HEAD"!==s)throw new Error("XHR ".concat(s," is not allowed"));if(o&&(i.responseType=o),l&&(i.timeout=l),i.onload=function(){200===i.status||206===i.status?t(i):r(i)},i.onerror=function(){r(i)},i.ontimeout=function(){r(i)},i.onabort=function(){r(i)},"GET"===s&&!h){var d=/\?/gi.test(n)?"&":"?";n+="".concat(d,"_=").concat((new Date).getTime())}if(i.open(s,"".concat(n),!0),c)try{c(i,n)}catch(e){console.error("xhr setup failure: ".concat(e.stack||e.message))}switch(s){case"POST":"text"===o&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(u);break;case"GET":case"HEAD":i.send()}}))})),isHls=function(e){return e&&0<e.toLowerCase().indexOf(".m3u8")},isMp4=function(e){return e&&0<e.toLowerCase().indexOf(".mp4")},isFlv=function(e){return e&&0<e.toLowerCase().indexOf(".flv")},isRtm=function(e){return e&&0<e.toLowerCase().indexOf(".sdp")},isDash=function(e){return e&&0<e.toLowerCase().indexOf(".mpd")},getStreamType=function(e){return isHls(e)?"hls":isFlv(e)?"flv":isRtm(e)?"rtm":isMp4(e)?"mp4":isDash(e)?"dash":"mp4"},retPromise$1=function(e){return e&&e.then?e:new Promise((function(e){e(null)}))},addUrlParam=function(e,t){if(!t)return e;var r=Object.entries(t).map((function(e){var t=_slicedToArray$7(e,2),r=t[0],n=t[1];return"".concat(r,"=").concat(null!=n?n:"")})).join("&");return e+=(-1===e.indexOf("?")?"?":"&")+r},getPluginConfig=function(e,t){var r;if(t&&e)return Object.keys(e).map((function(n){n.toLowerCase()===t.toLowerCase()&&(r=e[n])})),r},setPluginConfig=function(e,t,r,n){if(t&&r&&e)return Object.keys(e).map((function(i){i.toLowerCase()===t.toLowerCase()&&(e[i][r]=n)})),e},handleIcons=function(e){var t={};return e&&Object.entries(e).forEach((function(e){var r=_slicedToArray$7(e,2),n=r[0],i=r[1];i&&"string"!=typeof i&&(t[n]=i)})),t},isHevcSupported=function(){var e=navigator.userAgent.toLocaleLowerCase(),t=/(iphone)/.test(e)||/(ipad)/.test(e),r=/(quark)/.test(e);return!!(t&&!r||window.MediaSource&&window.MediaSource.isTypeSupported&&(window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||window.MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')))};function isBase64(e){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)}var matchHtmlRegExp=/["'&<>]/;function escapeHtml(e){var t,r=""+e,n=matchHtmlRegExp.exec(r);if(!n)return r;var i,a="",o=0;for(i=n.index;i<r.length;i++){switch(r.charCodeAt(i)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}o!==i&&(a+=r.substring(o,i)),o=i+1,a+=t}return o!==i?a+r.substring(o,i):a}var _excluded$6=["options","type","isLive","id","root","plugins","defaultConfig","languages","url","codec","playList","streamType","isMobile","useSoftDecoding","enableH265Degrade","checkExpireInterval","expireDetectType","onMediaExpired","onTokenExpired"],PlayerData=function(){function e(t){_classCallCheck$j(this,e),this.id="",this.type="",this.isLive=!1,this.options=null,this.isMobile=!1,this.playList=[],this.plugins=[],this.openSoftDecoding=!1,this.current={lineId:0,language:"",definition:"",streamType:"",codec:void 0};var r=t.options,n=t.type,i=t.isLive,a=t.id,o=t.root,s=t.plugins,l=void 0===s?[]:s,u=t.defaultConfig,c=t.languages;t.url;var d=t.codec;t.playList,t.streamType;var h=t.isMobile,f=void 0!==h&&h,p=t.useSoftDecoding,y=void 0!==p&&p,m=t.enableH265Degrade,g=void 0!==m&&m,v=t.checkExpireInterval,b=void 0===v?400:v,_=t.expireDetectType,E=void 0===_?[]:_,T=t.onMediaExpired,S=t.onTokenExpired,$=_objectWithoutProperties$5(t,_excluded$6);this.configs=t,this.options=Object.assign({},r,$),this.options.poster=escapeHtml(this.options.poster),this.options.icons=handleIcons(this.options.icons),this.id=a,this.root=o,this.type=n,this.isLive=!!(null!=i?i:"live"===n),this.defaultConfig=u,this.languageData=this.initI18nData(c),this.isMobile=f||"mobile"===sniffer$1.device,this.openSoftDecoding=y,this.enableH265Degrade=g,this.codec=d,this.checkExpireInterval=b,this.expireDetectType=E,this.onMediaExpired=T,this.onTokenExpired=S,this.initPlayData(t),this.current=MyProxy$1.observe(this.current),this.playList=MyProxy$1.observe(this.playList),this.plugins=_toConsumableArray$a(l)}return _createClass$k(e,[{key:"initPlayData",value:function(e){var t=this.initPlaylistAndGetCurrent(e);this.initCurrent(t)}},{key:"initPlaylistAndGetCurrent",value:function(e){var t,r=e.url,n=e.playList,i=e.streamType,a=void 0===i?"":i,o=null;if(n&&(this.playList=_toConsumableArray$a(n)),r)if(0===this.playList.length)this.playList=[_objectSpread2$c(_objectSpread2$c({},this.current),{},{url:r,streamType:a})];else{var s=this.getUrlList({url:r});s.length>0?o=s[0]:console.log("urlPlaylist")}var l=this.getCurrentByDefaultConfig();return l&&(o=l),null!==(t=o)&&void 0!==t?t:this.playList[0]}},{key:"isCurrentH265",value:function(){return!!this.codec&&this.codec.replaceAll(".","").toLowerCase()===CodecType.H265}},{key:"getCurrentByDefaultConfig",value:function(){if(this.defaultConfig){var e=this.defaultConfig,t=e.type,r=e.isLive,n=e.lineId,i=void 0===n?"":n,a=e.definition,o=void 0===a?"":a;if((null!=r?r:"live"===t)===this.isLive){if(!i&&!o)return console.log(""),void(this.isHitDefault=!1);var s=this.getUrlList({lineId:i,definition:o});return s.length>0?(this.isHitDefault=!0,s[0]):(console.log("playlist"),void(this.isHitDefault=!1))}}}},{key:"initCurrent",value:function(e){var t=this;Object.keys(this.current).forEach((function(r){t.current[r]=null==e?void 0:e[r]}));var r=(null==e?void 0:e.codec)||(null==e?void 0:e.Codec);r&&1===this.playList.length&&(this.codec=r)}},{key:"initI18nData",value:function(e){var t=[jp$1,zhHk],r=e&&Object.entries(e).reduce((function(e,r){var n=_slicedToArray$7(r,2),i=n[0],a=n[1];return PLAYER_LANGS.includes(i)?e.push({LANG:"zh"===i?"zh-cn":i,TEXT:a}):t.push({LANG:i,TEXT:a}),e}),[]);return{extraLangList:t,extendLangList:r}}},{key:"getCurrentUrl",value:function(){var e;return null===(e=this.getCurrentStreams()[0])||void 0===e?void 0:e.url}},{key:"getCurrentStreamType",value:function(){var e=this.getCurrentStreams();if(e.length){var t=e[0],r=t.url;return t.streamType||getStreamType(r)}return this.configs.streamType}},{key:"getCurrentStreams",value:function(){var e=this.current;return this.getUrlList(e)}},{key:"getLineList",value:function(){return cloneDeep(uniqBy(this.playList,"lineId"))}},{key:"getLineListByLineId",value:function(e){return this.playList.filter((function(t){var r;return(null==e?void 0:e.toString())===(null===(r=t.lineId)||void 0===r?void 0:r.toString())}))}},{key:"getDefinitionListByLineId",value:function(e){return cloneDeep(uniqBy(this.getLineListByLineId(e),"definition"))}},{key:"getUrlList",value:function(e){return this.playList.filter((function(t){return Object.keys(e).every((function(r){var n,i,a=(null===(n=e[r])||void 0===n?void 0:n.toString())===(null===(i=t[r])||void 0===i?void 0:i.toString()),o=!e[r];return a||o}))}))}},{key:"getNextDefinition",value:function(){var e,t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1?arguments[1]:void 0,i=r?"next":"prev",a=this.current,o=a.definition,s=a.lineId;if(o){var l=null===(e=this.getCurrentStreams())||void 0===e?void 0:e[0],u="auto"===o?l.mapDefinition:o,c=formatDemotePriority(n)||DefinitionLinked,d=Object.keys(c);if(d.includes(u)){for(var h=null===(t=c[u])||void 0===t?void 0:t[i],f=this.getDefinitionListByLineId(s);0===f.filter((function(e){return e.definition===h})).length&&h;){var p;h=null===(p=c[h])||void 0===p?void 0:p[i]}if(h)return"auto"===o&&h&&(l.mapDefinition=h),this.getUrlList({lineId:s,definition:h});console.log("")}}}}]),e}();function ownKeys$h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$h(Object(r),!0).forEach((function(t){_defineProperty$h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$a(){_regeneratorRuntime$a=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep$c(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$c(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$c(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$c(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$i(e,t,r){return t&&_defineProperties$i(e.prototype,t),r&&_defineProperties$i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$e(e,t)}function _getPrototypeOf$e(e){return(_getPrototypeOf$e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$e(e,t){return(_setPrototypeOf$e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$e(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$e(e)}function _createSuper$h(e){var t=_isNativeReflectConstruct$h();return function(){var r,n=_getPrototypeOf$e(e);if(t){var i=_getPrototypeOf$e(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$e(this,r)}}function ownKeys$g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$9(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$g(Object(r),!0).forEach((function(t){_defineProperty$g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$9(){_regeneratorRuntime$9=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function _typeof$9(e){return(_typeof$9="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$b(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$b(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$b(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$b(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$h(e,t,r){return t&&_defineProperties$h(e.prototype,t),r&&_defineProperties$h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$d(e,t)}function _getPrototypeOf$d(e){return(_getPrototypeOf$d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$d(e,t){return(_setPrototypeOf$d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$5(e,t,r){return(_construct$5=_isNativeReflectConstruct$g()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$d(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$5(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$5(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$5=function(e){if(null===e||!_isNativeFunction$5(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$5(e,arguments,_getPrototypeOf$d(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$d(r,e)},_wrapNativeSuper$5(e)}function _objectWithoutPropertiesLoose$4(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$4(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$4(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$d(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$d(e)}function _createSuper$g(e){var t=_isNativeReflectConstruct$g();return function(){var r,n=_getPrototypeOf$d(e);if(t){var i=_getPrototypeOf$d(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$d(this,r)}}function _superPropBase$2(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$d(e)););return e}function _get$2(){return _get$2="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase$2(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get$2.apply(this,arguments)}function _unsupportedIterableToArray$d(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$d(e,t):void 0}}function _arrayLikeToArray$d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper$4(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$d(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function createPublicPromise$4(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}function nowTime$3(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}var Buffer$5=function(){function e(){_classCallCheck$g(this,e)}return _createClass$h(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(error){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var a=r.length;if(a&&t){var o=r[a-1],s=o[1];if(e.start(n)-s<=t){var l=e.end(n);l>s&&(o[1]=l)}else r.push([e.start(n),e.end(n)])}else r.push([e.start(n),e.end(n)])}return r}},{key:"totalLength",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=e.buffers(t,n),h=0,f=d.length;h<f;h++){var p=d[h];if(r+n>=p[0]&&r<p[1])i=p[0],a=p[1],o=h;else{if(r+n<p[0]){s=p[0],l=p[1];break}r+n>p[1]&&(u=p[0],c=p[1])}}return{start:i,end:a,index:o,buffers:d,nextStart:s,nextEnd:l,prevStart:u,prevEnd:c,currentTime:r,behind:r-i,remaining:a?a-r:0,length:e.totalLength&&e.totalLength(d)}}}]),e}(),_ERR_CODE$2,ERR$2={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION"}},ERR_CODE$2=(_ERR_CODE$2={},_defineProperty$g(_ERR_CODE$2,ERR$2.MANIFEST,{HLS:1100}),_defineProperty$g(_ERR_CODE$2,ERR$2.NETWORK,2100),_defineProperty$g(_ERR_CODE$2,ERR$2.NETWORK_TIMEOUT,2101),_defineProperty$g(_ERR_CODE$2,ERR$2.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),_defineProperty$g(_ERR_CODE$2,ERR$2.REMUX,{FMP4:4100,MP4:4200}),_defineProperty$g(_ERR_CODE$2,ERR$2.MEDIA,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203}),_defineProperty$g(_ERR_CODE$2,ERR$2.OTHER,8e3),_ERR_CODE$2),StreamingError$2=function(e){_inherits$d(r,e);var t=_createSuper$g(r);function r(e,n,i,a,o){var s;return _classCallCheck$g(this,r),(s=t.call(this,o||(null==i?void 0:i.message))).errorType=e===ERR$2.NETWORK_TIMEOUT?ERR$2.NETWORK:e,s.originError=i,s.ext=a,s.errorCode=ERR_CODE$2[e][n]||ERR_CODE$2[e],s.errorMessage=s.message,s.errorCode||(s.errorType=ERR$2.OTHER,s.errorCode=ERR_CODE$2[s.errorType]),s}return _createClass$h(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=ERR$2.OTHER),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!=e&&e.isTimeout?ERR$2.NETWORK_TIMEOUT:ERR$2.NETWORK,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(_wrapNativeSuper$5(Error)),isBrowser$5="undefined"!=typeof window,Logger$c=function(){function e(t){_classCallCheck$g(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$h(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix,nowTime$3()].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix,nowTime$3()].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix,nowTime$3()].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix,nowTime$3()].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function getMediaSource$1(){try{return isBrowser$5?window.MediaSource:null}catch(e){}}_defineProperty$g(Logger$c,"disabled",!0);var MediaSource$2=getMediaSource$1(),OP_NAME$1={APPEND:"appendBuffer",REMOVE:"removeBuffer"},MSE$2=function(){function e(t,r){var n=this;_classCallCheck$g(this,e),_defineProperty$g(this,"media",null),_defineProperty$g(this,"mediaSource",null),_defineProperty$g(this,"_openPromise",createPublicPromise$4()),_defineProperty$g(this,"_queue",Object.create(null)),_defineProperty$g(this,"_sourceBuffer",Object.create(null)),_defineProperty$g(this,"_mseFullFlag",{}),_defineProperty$g(this,"_st",0),_defineProperty$g(this,"_opst",0),_defineProperty$g(this,"_logger",null),_defineProperty$g(this,"_config",null),_defineProperty$g(this,"_url",null),_defineProperty$g(this,"_onSBUpdateEnd",(function(e){var t=n._queue[e];if(t){var r=t.shift();if(r){var i=nowTime$3()-n._opst;n._logger.debug("UpdateEnd",r.opName,i,r.context),r.promise.resolve({name:r.opName,context:r.context,costtime:i}),n._startQueue(e)}}})),_defineProperty$g(this,"_onSBUpdateError",(function(e,t){var r=n._queue[e];if(r){var i=r[0];i&&(n._logger.error("UpdateError",e,i.opName,i.context),i.promise.reject(new StreamingError$2(ERR$2.MEDIA,ERR$2.SUB_TYPES.MSE_APPEND_BUFFER,t)))}})),this._config=Object.assign(e.getDefaultConfig(),r),t&&this.bindMedia(t),this._logger=new Logger$c("MSE"),this._config.openLog&&Logger$c.enable()}var t,r,n;return _createClass$h(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[e.VIDEO]}},{key:"updateDuration",value:function(e){var t=this;return this.mediaSource&&this.mediaSource.duration>e?Promise.resolve():this._enqueueBlockingOp((function(){t.isEnded?t._logger.debug("[debug mse] setDuration ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("[debug mse] setDuration"))}),"updateDuration")}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",(function r(){var n=nowTime$3()-e._st;e._logger.debug("MSE OPEN",n),t.removeEventListener("sourceopen",r),e._openPromise.resolve({costtime:n})})),this._openPromise=createPublicPromise$4()}return this._openPromise}},{key:"bindMedia",value:(n=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function e(t){var r,n,i=this;return _regeneratorRuntime$9().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(t&&MediaSource$2){e.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=t,r=this.mediaSource=new MediaSource$2,this._st=nowTime$3(),n=function e(){var n=nowTime$3()-i._st;i._logger.debug("MSE OPEN"),r.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),i._openPromise.resolve({costtime:n})},r.addEventListener("sourceopen",n),this._url=URL.createObjectURL(r),t.src=this._url,e.abrupt("return",this._openPromise);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unbindMedia",value:(r=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function e(){var t,r,n,i=this;return _regeneratorRuntime$9().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach((function(e){var t=i._queue[e];t&&t.forEach((function(e){return e.promise.resolve}))})),r=!!this.media&&this.media.readyState>=1,n="open"===t.readyState,r&&n)try{t.endOfStream()}catch(error){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(i._sourceBuffer[e])}catch(error){}}))}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(error){}this.media=null}this.mediaSource=null,this._openPromise=createPublicPromise$4(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(error){throw new StreamingError$2(ERR$2.MEDIA,ERR$2.SUB_TYPES.MSE_ADD_SB,error)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this,n=this._sourceBuffer[e];return this.mediaSource&&n&&n.mimeType!==t&&"function"==typeof n.changeType?this._enqueueOp(e,(function(){n.changeType(t),n.mimeType=t,r._onSBUpdateEnd(e)})):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,r){var n=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var i;n.mediaSource&&(n._logger.debug("MSE APPEND START",r),n._opst=nowTime$3(),null===(i=n._sourceBuffer[e])||void 0===i||i.appendBuffer(t))}),OP_NAME$1.APPEND,r):Promise.resolve()}},{key:"remove",value:function(e,t,r,n){var i=this,a=!1;return this._mseFullFlag[e]&&(a=!0),this._enqueueOp(e,(function(){if(i.mediaSource){var a=i._sourceBuffer[e];t>=r||!a?i._onSBUpdateEnd(e):(i._opst=nowTime$3(),i._logger.debug("MSE REMOVE START",e,t,r,n),a.remove(t,r))}}),OP_NAME$1.REMOVE,n,a)}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach((function(i){r=n._enqueueOp(i,(function(){if(n.mediaSource){var r=n._sourceBuffer[i];n._logger.debug("MSE clearBuffer START",i,e,t),r.remove(e,t)}}))})),r}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(r){e=t._enqueueOp(r,(function(){if(t.mediaSource){var e=t._sourceBuffer[r];t._logger.debug("MSE clearAllBuffer START",r),e.remove(0,Buffer$5.end(Buffer$5.get(e)))}}))})),e}},{key:"clearOpQueues",value:function(e){var t;this._logger.debug("MSE clearOpQueue START");var r=this._queue[e];if(r&&r[e]&&!(r.length<5)){var n=[];r.forEach((function(e){e.context&&e.context.isinit&&n.push(e)})),this._queue[e]=r.slice(0,2),n.length>0&&(t=this._queue[e]).push.apply(t,n)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var r=t.mediaSource;r&&"open"===r.readyState&&(t._logger.debug("MSE endOfStream START"),e?r.endOfStream(e):r.endOfStream())}),"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||null==r||!r.setLiveSeekableRange||"open"!==r.readyState||r.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return Buffer$5.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return Buffer$5.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return Buffer$5.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,r,n,i){var a=this;if(!this.mediaSource)return Promise.resolve();var o=this._queue[e]=this._queue[e]||[],s={exec:t,promise:createPublicPromise$4(),opName:r,context:n};return i?(o.splice(0,0,s),this._mseFullFlag[e]=!1,this._startQueue(e)):o.push(s),this.isOpened?1===o.length&&this._startQueue(e):this._openPromise.then((function(){1===o.length&&a._startQueue(e)})),s.promise}},{key:"_enqueueBlockingOp",value:(t=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function e(t,r){var n,i,a=this;return _regeneratorRuntime$9().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((n=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return i=[],n.forEach((function(e){var t=a._queue[e],n=createPublicPromise$4();i.push(n),t.push({exec:function(){return n.resolve()},promise:n,opName:r}),1===t.length&&a._startQueue(e)})),e.abrupt("return",Promise.all(i).then((function(){try{return t()}finally{n.forEach((function(e){var t=a._queue[e],r=a._sourceBuffer[e];null==t||t.shift(),r&&r.updating||a._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r&&!this._mseFullFlag[e])try{r.exec()}catch(error){error&&error.message&&error.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,this._logger.error("[MSE error],  context,",r.context," ,name,",r.opName,",err,SourceBuffer is full"),r.promise.reject(new StreamingError$2(ERR$2.MEDIA,ERR$2.SUB_TYPES.MSE_FULL,error))):(this._logger.error(error),r.promise.reject(new StreamingError$2(ERR$2.MEDIA,ERR$2.SUB_TYPES.MSE_OTHER,error)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this._enqueueOp(e,(function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)}),"setTimeoffset",r)}},{key:"abort",value:function(e,t){var r=this;return this.isOpened?this._enqueueOp(e,(function(){r._sourceBuffer[e].abort(),r._onSBUpdateEnd(e)}),"abort",t):Promise.resolve()}}],[{key:"getDefaultConfig",value:function(){return{openLog:!1}}},{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!MediaSource$2)return!1;try{return MediaSource$2.isTypeSupported(e)}catch(error){return this._logger.error(e,error),!1}}}]),e}();_defineProperty$g(MSE$2,"VIDEO","video"),_defineProperty$g(MSE$2,"AUDIO","audio");var es_promise_finally={},$$1T=_export$1,NativePromiseConstructor$5=promiseNativeConstructor$1,fails$1k=fails$1Q,getBuiltIn$q=getBuiltIn$A,isCallable$y=isCallable$Z,speciesConstructor$7=speciesConstructor$a,promiseResolve$3=promiseResolve$5,defineBuiltIn$p=defineBuiltIn$D,NativePromisePrototype$3=NativePromiseConstructor$5&&NativePromiseConstructor$5.prototype,NON_GENERIC$1=!!NativePromiseConstructor$5&&fails$1k((function(){NativePromisePrototype$3.finally.call({then:function(){}},(function(){}))}));if($$1T({target:"Promise",proto:!0,real:!0,forced:NON_GENERIC$1},{finally:function(e){var t=speciesConstructor$7(this,getBuiltIn$q("Promise")),r=isCallable$y(e);return this.then(r?function(r){return promiseResolve$3(t,e()).then((function(){return r}))}:e,r?function(r){return promiseResolve$3(t,e()).then((function(){throw r}))}:e)}}),isCallable$y(NativePromiseConstructor$5)){var method$2=getBuiltIn$q("Promise").prototype.finally;NativePromisePrototype$3.finally!==method$2&&defineBuiltIn$p(NativePromisePrototype$3,"finally",method$2,{unsafe:!0})}var es_typedArray_uint8Array={},typedArrayConstructor$1={exports:{}},arrayBufferBasicDetection$1="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,NATIVE_ARRAY_BUFFER$4=arrayBufferBasicDetection$1,DESCRIPTORS$G=descriptors$1,global$14=global$1v,isCallable$x=isCallable$Z,isObject$D=isObject$U,hasOwn$x=hasOwnProperty_1$1,classof$k=classof$u,tryToString$8=tryToString$e,createNonEnumerableProperty$g=createNonEnumerableProperty$o,defineBuiltIn$o=defineBuiltIn$D,defineProperty$n=objectDefineProperty$1.f,isPrototypeOf$c=objectIsPrototypeOf$1,getPrototypeOf$5=objectGetPrototypeOf$1,setPrototypeOf$b=objectSetPrototypeOf$1,wellKnownSymbol$w=wellKnownSymbol$V,uid$6=uid$9,InternalStateModule$f=internalState$1,enforceInternalState$4=InternalStateModule$f.enforce,getInternalState$c=InternalStateModule$f.get,Int8Array$8=global$14.Int8Array,Int8ArrayPrototype$3=Int8Array$8&&Int8Array$8.prototype,Uint8ClampedArray$2=global$14.Uint8ClampedArray,Uint8ClampedArrayPrototype$1=Uint8ClampedArray$2&&Uint8ClampedArray$2.prototype,TypedArray$3=Int8Array$8&&getPrototypeOf$5(Int8Array$8),TypedArrayPrototype$5=Int8ArrayPrototype$3&&getPrototypeOf$5(Int8ArrayPrototype$3),ObjectPrototype$6=Object.prototype,TypeError$8=global$14.TypeError,TO_STRING_TAG$5=wellKnownSymbol$w("toStringTag"),TYPED_ARRAY_TAG$3=uid$6("TYPED_ARRAY_TAG"),TYPED_ARRAY_CONSTRUCTOR$1="TypedArrayConstructor",NATIVE_ARRAY_BUFFER_VIEWS$6=NATIVE_ARRAY_BUFFER$4&&!!setPrototypeOf$b&&"Opera"!==classof$k(global$14.opera),TYPED_ARRAY_TAG_REQUIRED$1=!1,NAME$2,Constructor$1,Prototype$1,TypedArrayConstructorsList$1={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},BigIntArrayConstructorsList$1={BigInt64Array:8,BigUint64Array:8},isView$1=function(e){if(!isObject$D(e))return!1;var t=classof$k(e);return"DataView"===t||hasOwn$x(TypedArrayConstructorsList$1,t)||hasOwn$x(BigIntArrayConstructorsList$1,t)},getTypedArrayConstructor$9=function e(t){var r=getPrototypeOf$5(t);if(isObject$D(r)){var n=getInternalState$c(r);return n&&hasOwn$x(n,TYPED_ARRAY_CONSTRUCTOR$1)?n[TYPED_ARRAY_CONSTRUCTOR$1]:e(r)}},isTypedArray$3=function(e){if(!isObject$D(e))return!1;var t=classof$k(e);return hasOwn$x(TypedArrayConstructorsList$1,t)||hasOwn$x(BigIntArrayConstructorsList$1,t)},aTypedArray$V=function(e){if(isTypedArray$3(e))return e;throw TypeError$8("Target is not a typed array")},aTypedArrayConstructor$9=function(e){if(isCallable$x(e)&&(!setPrototypeOf$b||isPrototypeOf$c(TypedArray$3,e)))return e;throw TypeError$8(tryToString$8(e)+" is not a typed array constructor")},exportTypedArrayMethod$X=function(e,t,r,n){if(DESCRIPTORS$G){if(r)for(var i in TypedArrayConstructorsList$1){var a=global$14[i];if(a&&hasOwn$x(a.prototype,e))try{delete a.prototype[e]}catch(error){try{a.prototype[e]=t}catch(o){}}}TypedArrayPrototype$5[e]&&!r||defineBuiltIn$o(TypedArrayPrototype$5,e,r?t:NATIVE_ARRAY_BUFFER_VIEWS$6&&Int8ArrayPrototype$3[e]||t,n)}},exportTypedArrayStaticMethod$3=function(e,t,r){var n,i;if(DESCRIPTORS$G){if(setPrototypeOf$b){if(r)for(n in TypedArrayConstructorsList$1)if((i=global$14[n])&&hasOwn$x(i,e))try{delete i[e]}catch(error){}if(TypedArray$3[e]&&!r)return;try{return defineBuiltIn$o(TypedArray$3,e,r?t:NATIVE_ARRAY_BUFFER_VIEWS$6&&TypedArray$3[e]||t)}catch(error){}}for(n in TypedArrayConstructorsList$1)!(i=global$14[n])||i[e]&&!r||defineBuiltIn$o(i,e,t)}};for(NAME$2 in TypedArrayConstructorsList$1)Constructor$1=global$14[NAME$2],Prototype$1=Constructor$1&&Constructor$1.prototype,Prototype$1?enforceInternalState$4(Prototype$1)[TYPED_ARRAY_CONSTRUCTOR$1]=Constructor$1:NATIVE_ARRAY_BUFFER_VIEWS$6=!1;for(NAME$2 in BigIntArrayConstructorsList$1)Constructor$1=global$14[NAME$2],Prototype$1=Constructor$1&&Constructor$1.prototype,Prototype$1&&(enforceInternalState$4(Prototype$1)[TYPED_ARRAY_CONSTRUCTOR$1]=Constructor$1);if((!NATIVE_ARRAY_BUFFER_VIEWS$6||!isCallable$x(TypedArray$3)||TypedArray$3===Function.prototype)&&(TypedArray$3=function(){throw TypeError$8("Incorrect invocation")},NATIVE_ARRAY_BUFFER_VIEWS$6))for(NAME$2 in TypedArrayConstructorsList$1)global$14[NAME$2]&&setPrototypeOf$b(global$14[NAME$2],TypedArray$3);if((!NATIVE_ARRAY_BUFFER_VIEWS$6||!TypedArrayPrototype$5||TypedArrayPrototype$5===ObjectPrototype$6)&&(TypedArrayPrototype$5=TypedArray$3.prototype,NATIVE_ARRAY_BUFFER_VIEWS$6))for(NAME$2 in TypedArrayConstructorsList$1)global$14[NAME$2]&&setPrototypeOf$b(global$14[NAME$2].prototype,TypedArrayPrototype$5);if(NATIVE_ARRAY_BUFFER_VIEWS$6&&getPrototypeOf$5(Uint8ClampedArrayPrototype$1)!==TypedArrayPrototype$5&&setPrototypeOf$b(Uint8ClampedArrayPrototype$1,TypedArrayPrototype$5),DESCRIPTORS$G&&!hasOwn$x(TypedArrayPrototype$5,TO_STRING_TAG$5))for(NAME$2 in TYPED_ARRAY_TAG_REQUIRED$1=!0,defineProperty$n(TypedArrayPrototype$5,TO_STRING_TAG$5,{get:function(){return isObject$D(this)?this[TYPED_ARRAY_TAG$3]:void 0}}),TypedArrayConstructorsList$1)global$14[NAME$2]&&createNonEnumerableProperty$g(global$14[NAME$2],TYPED_ARRAY_TAG$3,NAME$2);var arrayBufferViewCore$1={NATIVE_ARRAY_BUFFER_VIEWS:NATIVE_ARRAY_BUFFER_VIEWS$6,TYPED_ARRAY_TAG:TYPED_ARRAY_TAG_REQUIRED$1&&TYPED_ARRAY_TAG$3,aTypedArray:aTypedArray$V,aTypedArrayConstructor:aTypedArrayConstructor$9,exportTypedArrayMethod:exportTypedArrayMethod$X,exportTypedArrayStaticMethod:exportTypedArrayStaticMethod$3,getTypedArrayConstructor:getTypedArrayConstructor$9,isView:isView$1,isTypedArray:isTypedArray$3,TypedArray:TypedArray$3,TypedArrayPrototype:TypedArrayPrototype$5},global$13=global$1v,fails$1j=fails$1Q,checkCorrectnessOfIteration$5=checkCorrectnessOfIteration$7,NATIVE_ARRAY_BUFFER_VIEWS$5=arrayBufferViewCore$1.NATIVE_ARRAY_BUFFER_VIEWS,ArrayBuffer$8=global$13.ArrayBuffer,Int8Array$7=global$13.Int8Array,typedArrayConstructorsRequireWrappers$1=!NATIVE_ARRAY_BUFFER_VIEWS$5||!fails$1j((function(){Int8Array$7(1)}))||!fails$1j((function(){new Int8Array$7(-1)}))||!checkCorrectnessOfIteration$5((function(e){new Int8Array$7,new Int8Array$7(null),new Int8Array$7(1.5),new Int8Array$7(e)}),!0)||fails$1j((function(){return 1!==new Int8Array$7(new ArrayBuffer$8(2),1,void 0).length})),toIntegerOrInfinity$n=toIntegerOrInfinity$v,toLength$h=toLength$m,$RangeError$a=RangeError,toIndex$5=function(e){if(void 0===e)return 0;var t=toIntegerOrInfinity$n(e),r=toLength$h(t);if(t!==r)throw $RangeError$a("Wrong length or index");return r},$Array$6=Array,abs$3=Math.abs,pow$5=Math.pow,floor$d=Math.floor,log$6=Math.log,LN2$1=Math.LN2,pack$1=function(e,t,r){var n,i,a,o=$Array$6(r),s=8*r-t-1,l=(1<<s)-1,u=l>>1,c=23===t?pow$5(2,-24)-pow$5(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=abs$3(e))!=e||e===1/0?(i=e!=e?1:0,n=l):(n=floor$d(log$6(e)/LN2$1),e*(a=pow$5(2,-n))<1&&(n--,a*=2),(e+=n+u>=1?c/a:c*pow$5(2,1-u))*a>=2&&(n++,a/=2),n+u>=l?(i=0,n=l):n+u>=1?(i=(e*a-1)*pow$5(2,t),n+=u):(i=e*pow$5(2,u-1)*pow$5(2,t),n=0));t>=8;)o[h++]=255&i,i/=256,t-=8;for(n=n<<t|i,s+=t;s>0;)o[h++]=255&n,n/=256,s-=8;return o[--h]|=128*d,o},unpack$1=function(e,t){var r,n=e.length,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,l=n-1,u=e[l--],c=127&u;for(u>>=7;s>0;)c=256*c+e[l--],s-=8;for(r=c&(1<<-s)-1,c>>=-s,s+=t;s>0;)r=256*r+e[l--],s-=8;if(0===c)c=1-o;else{if(c===a)return r?NaN:u?-1/0:1/0;r+=pow$5(2,t),c-=o}return(u?-1:1)*r*pow$5(2,c-t)},ieee754$1={pack:pack$1,unpack:unpack$1},toObject$s=toObject$D,toAbsoluteIndex$c=toAbsoluteIndex$h,lengthOfArrayLike$A=lengthOfArrayLike$K,arrayFill$3=function(e){for(var t=toObject$s(this),r=lengthOfArrayLike$A(t),n=arguments.length,i=toAbsoluteIndex$c(n>1?arguments[1]:void 0,r),a=n>2?arguments[2]:void 0,o=void 0===a?r:toAbsoluteIndex$c(a,r);o>i;)t[i++]=e;return t},global$12=global$1v,uncurryThis$1j=functionUncurryThis$1,DESCRIPTORS$F=descriptors$1,NATIVE_ARRAY_BUFFER$3=arrayBufferBasicDetection$1,FunctionName$2=functionName$1,createNonEnumerableProperty$f=createNonEnumerableProperty$o,defineBuiltIns$4=defineBuiltIns$6,fails$1i=fails$1Q,anInstance$d=anInstance$h,toIntegerOrInfinity$m=toIntegerOrInfinity$v,toLength$g=toLength$m,toIndex$4=toIndex$5,IEEE754$1=ieee754$1,getPrototypeOf$4=objectGetPrototypeOf$1,setPrototypeOf$a=objectSetPrototypeOf$1,getOwnPropertyNames$5=objectGetOwnPropertyNames$1.f,defineProperty$m=objectDefineProperty$1.f,arrayFill$2=arrayFill$3,arraySlice$g=arraySliceSimple$1,setToStringTag$e=setToStringTag$k,InternalStateModule$e=internalState$1,PROPER_FUNCTION_NAME$4=FunctionName$2.PROPER,CONFIGURABLE_FUNCTION_NAME$3=FunctionName$2.CONFIGURABLE,getInternalState$b=InternalStateModule$e.get,setInternalState$c=InternalStateModule$e.set,ARRAY_BUFFER$3="ArrayBuffer",DATA_VIEW$1="DataView",PROTOTYPE$3="prototype",WRONG_LENGTH$3="Wrong length",WRONG_INDEX$1="Wrong index",NativeArrayBuffer$3=global$12[ARRAY_BUFFER$3],$ArrayBuffer$1=NativeArrayBuffer$3,ArrayBufferPrototype$3=$ArrayBuffer$1&&$ArrayBuffer$1[PROTOTYPE$3],$DataView$1=global$12[DATA_VIEW$1],DataViewPrototype$3=$DataView$1&&$DataView$1[PROTOTYPE$3],ObjectPrototype$5=Object.prototype,Array$2=global$12.Array,RangeError$6=global$12.RangeError,fill$2=uncurryThis$1j(arrayFill$2),reverse$1=uncurryThis$1j([].reverse),packIEEE754$1=IEEE754$1.pack,unpackIEEE754$1=IEEE754$1.unpack,packInt8$1=function(e){return[255&e]},packInt16$1=function(e){return[255&e,e>>8&255]},packInt32$1=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},unpackInt32$1=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},packFloat32$1=function(e){return packIEEE754$1(e,23,4)},packFloat64$1=function(e){return packIEEE754$1(e,52,8)},addGetter$3=function(e,t){defineProperty$m(e[PROTOTYPE$3],t,{get:function(){return getInternalState$b(this)[t]}})},get$2=function(e,t,r,n){var i=toIndex$4(r),a=getInternalState$b(e);if(i+t>a.byteLength)throw RangeError$6(WRONG_INDEX$1);var o=getInternalState$b(a.buffer).bytes,s=i+a.byteOffset,l=arraySlice$g(o,s,s+t);return n?l:reverse$1(l)},set$3=function(e,t,r,n,i,a){var o=toIndex$4(r),s=getInternalState$b(e);if(o+t>s.byteLength)throw RangeError$6(WRONG_INDEX$1);for(var l=getInternalState$b(s.buffer).bytes,u=o+s.byteOffset,c=n(+i),d=0;d<t;d++)l[u+d]=c[a?d:t-d-1]};if(NATIVE_ARRAY_BUFFER$3){var INCORRECT_ARRAY_BUFFER_NAME$1=PROPER_FUNCTION_NAME$4&&NativeArrayBuffer$3.name!==ARRAY_BUFFER$3;if(fails$1i((function(){NativeArrayBuffer$3(1)}))&&fails$1i((function(){new NativeArrayBuffer$3(-1)}))&&!fails$1i((function(){return new NativeArrayBuffer$3,new NativeArrayBuffer$3(1.5),new NativeArrayBuffer$3(NaN),1!=NativeArrayBuffer$3.length||INCORRECT_ARRAY_BUFFER_NAME$1&&!CONFIGURABLE_FUNCTION_NAME$3})))INCORRECT_ARRAY_BUFFER_NAME$1&&CONFIGURABLE_FUNCTION_NAME$3&&createNonEnumerableProperty$f(NativeArrayBuffer$3,"name",ARRAY_BUFFER$3);else{$ArrayBuffer$1=function(e){return anInstance$d(this,ArrayBufferPrototype$3),new NativeArrayBuffer$3(toIndex$4(e))},$ArrayBuffer$1[PROTOTYPE$3]=ArrayBufferPrototype$3;for(var keys$7=getOwnPropertyNames$5(NativeArrayBuffer$3),j$2=0,key$6;keys$7.length>j$2;)(key$6=keys$7[j$2++])in $ArrayBuffer$1||createNonEnumerableProperty$f($ArrayBuffer$1,key$6,NativeArrayBuffer$3[key$6]);ArrayBufferPrototype$3.constructor=$ArrayBuffer$1}setPrototypeOf$a&&getPrototypeOf$4(DataViewPrototype$3)!==ObjectPrototype$5&&setPrototypeOf$a(DataViewPrototype$3,ObjectPrototype$5);var testView$1=new $DataView$1(new $ArrayBuffer$1(2)),$setInt8$1=uncurryThis$1j(DataViewPrototype$3.setInt8);testView$1.setInt8(0,2147483648),testView$1.setInt8(1,2147483649),!testView$1.getInt8(0)&&testView$1.getInt8(1)||defineBuiltIns$4(DataViewPrototype$3,{setInt8:function(e,t){$setInt8$1(this,e,t<<24>>24)},setUint8:function(e,t){$setInt8$1(this,e,t<<24>>24)}},{unsafe:!0})}else $ArrayBuffer$1=function(e){anInstance$d(this,ArrayBufferPrototype$3);var t=toIndex$4(e);setInternalState$c(this,{bytes:fill$2(Array$2(t),0),byteLength:t}),DESCRIPTORS$F||(this.byteLength=t)},ArrayBufferPrototype$3=$ArrayBuffer$1[PROTOTYPE$3],$DataView$1=function(e,t,r){anInstance$d(this,DataViewPrototype$3),anInstance$d(e,ArrayBufferPrototype$3);var n=getInternalState$b(e).byteLength,i=toIntegerOrInfinity$m(t);if(i<0||i>n)throw RangeError$6("Wrong offset");if(i+(r=void 0===r?n-i:toLength$g(r))>n)throw RangeError$6(WRONG_LENGTH$3);setInternalState$c(this,{buffer:e,byteLength:r,byteOffset:i}),DESCRIPTORS$F||(this.buffer=e,this.byteLength=r,this.byteOffset=i)},DataViewPrototype$3=$DataView$1[PROTOTYPE$3],DESCRIPTORS$F&&(addGetter$3($ArrayBuffer$1,"byteLength"),addGetter$3($DataView$1,"buffer"),addGetter$3($DataView$1,"byteLength"),addGetter$3($DataView$1,"byteOffset")),defineBuiltIns$4(DataViewPrototype$3,{getInt8:function(e){return get$2(this,1,e)[0]<<24>>24},getUint8:function(e){return get$2(this,1,e)[0]},getInt16:function(e){var t=get$2(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=get$2(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return unpackInt32$1(get$2(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return unpackInt32$1(get$2(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return unpackIEEE754$1(get$2(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return unpackIEEE754$1(get$2(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){set$3(this,1,e,packInt8$1,t)},setUint8:function(e,t){set$3(this,1,e,packInt8$1,t)},setInt16:function(e,t){set$3(this,2,e,packInt16$1,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){set$3(this,2,e,packInt16$1,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){set$3(this,4,e,packInt32$1,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){set$3(this,4,e,packInt32$1,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){set$3(this,4,e,packFloat32$1,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){set$3(this,8,e,packFloat64$1,t,arguments.length>2?arguments[2]:void 0)}});setToStringTag$e($ArrayBuffer$1,ARRAY_BUFFER$3),setToStringTag$e($DataView$1,DATA_VIEW$1);var arrayBuffer$1={ArrayBuffer:$ArrayBuffer$1,DataView:$DataView$1},isObject$C=isObject$U,floor$c=Math.floor,isIntegralNumber$3=Number.isInteger||function(e){return!isObject$C(e)&&isFinite(e)&&floor$c(e)===e},toIntegerOrInfinity$l=toIntegerOrInfinity$v,$RangeError$9=RangeError,toPositiveInteger$3=function(e){var t=toIntegerOrInfinity$l(e);if(t<0)throw $RangeError$9("The argument can't be less than 0");return t},toPositiveInteger$2=toPositiveInteger$3,$RangeError$8=RangeError,toOffset$5=function(e,t){var r=toPositiveInteger$2(e);if(r%t)throw $RangeError$8("Wrong offset");return r},classof$j=classof$u,uncurryThis$1i=functionUncurryThis$1,slice$3=uncurryThis$1i("".slice),isBigIntArray$5=function(e){return"Big"===slice$3(classof$j(e),0,3)},toPrimitive$4=toPrimitive$7,$TypeError$m=TypeError,toBigInt$7=function(e){var t=toPrimitive$4(e,"number");if("number"==typeof t)throw $TypeError$m("Can't convert number to bigint");return BigInt(t)},bind$h=functionBindContext$1,call$y=functionCall$1,aConstructor$4=aConstructor$6,toObject$r=toObject$D,lengthOfArrayLike$z=lengthOfArrayLike$K,getIterator$5=getIterator$9,getIteratorMethod$6=getIteratorMethod$b,isArrayIteratorMethod$4=isArrayIteratorMethod$7,isBigIntArray$4=isBigIntArray$5,aTypedArrayConstructor$8=arrayBufferViewCore$1.aTypedArrayConstructor,toBigInt$6=toBigInt$7,typedArrayFrom$3=function(e){var t,r,n,i,a,o,s,l,u=aConstructor$4(this),c=toObject$r(e),d=arguments.length,h=d>1?arguments[1]:void 0,f=void 0!==h,p=getIteratorMethod$6(c);if(p&&!isArrayIteratorMethod$4(p))for(l=(s=getIterator$5(c,p)).next,c=[];!(o=call$y(l,s)).done;)c.push(o.value);for(f&&d>2&&(h=bind$h(h,arguments[2])),r=lengthOfArrayLike$z(c),n=new(aTypedArrayConstructor$8(u))(r),i=isBigIntArray$4(n),t=0;r>t;t++)a=f?h(c[t],t):c[t],n[t]=i?toBigInt$6(a):+a;return n},$$1S=_export$1,global$11=global$1v,call$x=functionCall$1,DESCRIPTORS$E=descriptors$1,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$3=typedArrayConstructorsRequireWrappers$1,ArrayBufferViewCore$_=arrayBufferViewCore$1,ArrayBufferModule$4=arrayBuffer$1,anInstance$c=anInstance$h,createPropertyDescriptor$e=createPropertyDescriptor$k,createNonEnumerableProperty$e=createNonEnumerableProperty$o,isIntegralNumber$2=isIntegralNumber$3,toLength$f=toLength$m,toIndex$3=toIndex$5,toOffset$4=toOffset$5,toPropertyKey$7=toPropertyKey$b,hasOwn$w=hasOwnProperty_1$1,classof$i=classof$u,isObject$B=isObject$U,isSymbol$7=isSymbol$c,create$c=objectCreate$2,isPrototypeOf$b=objectIsPrototypeOf$1,setPrototypeOf$9=objectSetPrototypeOf$1,getOwnPropertyNames$4=objectGetOwnPropertyNames$1.f,typedArrayFrom$2=typedArrayFrom$3,forEach$5=arrayIteration$1.forEach,setSpecies$6=setSpecies$9,definePropertyModule$8=objectDefineProperty$1,getOwnPropertyDescriptorModule$4=objectGetOwnPropertyDescriptor$1,InternalStateModule$d=internalState$1,inheritIfRequired$8=inheritIfRequired$b,getInternalState$a=InternalStateModule$d.get,setInternalState$b=InternalStateModule$d.set,enforceInternalState$3=InternalStateModule$d.enforce,nativeDefineProperty$2=definePropertyModule$8.f,nativeGetOwnPropertyDescriptor$4=getOwnPropertyDescriptorModule$4.f,round$1=Math.round,RangeError$5=global$11.RangeError,ArrayBuffer$7=ArrayBufferModule$4.ArrayBuffer,ArrayBufferPrototype$2=ArrayBuffer$7.prototype,DataView$4=ArrayBufferModule$4.DataView,NATIVE_ARRAY_BUFFER_VIEWS$4=ArrayBufferViewCore$_.NATIVE_ARRAY_BUFFER_VIEWS,TYPED_ARRAY_TAG$2=ArrayBufferViewCore$_.TYPED_ARRAY_TAG,TypedArray$2=ArrayBufferViewCore$_.TypedArray,TypedArrayPrototype$4=ArrayBufferViewCore$_.TypedArrayPrototype,aTypedArrayConstructor$7=ArrayBufferViewCore$_.aTypedArrayConstructor,isTypedArray$2=ArrayBufferViewCore$_.isTypedArray,BYTES_PER_ELEMENT$1="BYTES_PER_ELEMENT",WRONG_LENGTH$2="Wrong length",fromList$1=function(e,t){aTypedArrayConstructor$7(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},addGetter$2=function(e,t){nativeDefineProperty$2(e,t,{get:function(){return getInternalState$a(this)[t]}})},isArrayBuffer$1=function(e){var t;return isPrototypeOf$b(ArrayBufferPrototype$2,e)||"ArrayBuffer"==(t=classof$i(e))||"SharedArrayBuffer"==t},isTypedArrayIndex$1=function(e,t){return isTypedArray$2(e)&&!isSymbol$7(t)&&t in e&&isIntegralNumber$2(+t)&&t>=0},wrappedGetOwnPropertyDescriptor$1=function(e,t){return t=toPropertyKey$7(t),isTypedArrayIndex$1(e,t)?createPropertyDescriptor$e(2,e[t]):nativeGetOwnPropertyDescriptor$4(e,t)},wrappedDefineProperty$1=function(e,t,r){return t=toPropertyKey$7(t),!(isTypedArrayIndex$1(e,t)&&isObject$B(r)&&hasOwn$w(r,"value"))||hasOwn$w(r,"get")||hasOwn$w(r,"set")||r.configurable||hasOwn$w(r,"writable")&&!r.writable||hasOwn$w(r,"enumerable")&&!r.enumerable?nativeDefineProperty$2(e,t,r):(e[t]=r.value,e)};DESCRIPTORS$E?(NATIVE_ARRAY_BUFFER_VIEWS$4||(getOwnPropertyDescriptorModule$4.f=wrappedGetOwnPropertyDescriptor$1,definePropertyModule$8.f=wrappedDefineProperty$1,addGetter$2(TypedArrayPrototype$4,"buffer"),addGetter$2(TypedArrayPrototype$4,"byteOffset"),addGetter$2(TypedArrayPrototype$4,"byteLength"),addGetter$2(TypedArrayPrototype$4,"length")),$$1S({target:"Object",stat:!0,forced:!NATIVE_ARRAY_BUFFER_VIEWS$4},{getOwnPropertyDescriptor:wrappedGetOwnPropertyDescriptor$1,defineProperty:wrappedDefineProperty$1}),typedArrayConstructor$1.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,i=e+(r?"Clamped":"")+"Array",a="get"+e,o="set"+e,s=global$11[i],l=s,u=l&&l.prototype,c={},d=function(e,t){nativeDefineProperty$2(e,t,{get:function(){return function(e,t){var r=getInternalState$a(e);return r.view[a](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var a=getInternalState$a(e);r&&(i=(i=round$1(i))<0?0:i>255?255:255&i),a.view[o](t*n+a.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};NATIVE_ARRAY_BUFFER_VIEWS$4?TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$3&&(l=t((function(e,t,r,i){return anInstance$c(e,u),inheritIfRequired$8(isObject$B(t)?isArrayBuffer$1(t)?void 0!==i?new s(t,toOffset$4(r,n),i):void 0!==r?new s(t,toOffset$4(r,n)):new s(t):isTypedArray$2(t)?fromList$1(l,t):call$x(typedArrayFrom$2,l,t):new s(toIndex$3(t)),e,l)})),setPrototypeOf$9&&setPrototypeOf$9(l,TypedArray$2),forEach$5(getOwnPropertyNames$4(s),(function(e){e in l||createNonEnumerableProperty$e(l,e,s[e])})),l.prototype=u):(l=t((function(e,t,r,i){anInstance$c(e,u);var a,o,s,c=0,h=0;if(isObject$B(t)){if(!isArrayBuffer$1(t))return isTypedArray$2(t)?fromList$1(l,t):call$x(typedArrayFrom$2,l,t);a=t,h=toOffset$4(r,n);var f=t.byteLength;if(void 0===i){if(f%n)throw RangeError$5(WRONG_LENGTH$2);if((o=f-h)<0)throw RangeError$5(WRONG_LENGTH$2)}else if((o=toLength$f(i)*n)+h>f)throw RangeError$5(WRONG_LENGTH$2);s=o/n}else s=toIndex$3(t),a=new ArrayBuffer$7(o=s*n);for(setInternalState$b(e,{buffer:a,byteOffset:h,byteLength:o,length:s,view:new DataView$4(a)});c<s;)d(e,c++)})),setPrototypeOf$9&&setPrototypeOf$9(l,TypedArray$2),u=l.prototype=create$c(TypedArrayPrototype$4)),u.constructor!==l&&createNonEnumerableProperty$e(u,"constructor",l),enforceInternalState$3(u).TypedArrayConstructor=l,TYPED_ARRAY_TAG$2&&createNonEnumerableProperty$e(u,TYPED_ARRAY_TAG$2,i);var h=l!=s;c[i]=l,$$1S({global:!0,constructor:!0,forced:h,sham:!NATIVE_ARRAY_BUFFER_VIEWS$4},c),BYTES_PER_ELEMENT$1 in l||createNonEnumerableProperty$e(l,BYTES_PER_ELEMENT$1,n),BYTES_PER_ELEMENT$1 in u||createNonEnumerableProperty$e(u,BYTES_PER_ELEMENT$1,n),setSpecies$6(i)}):typedArrayConstructor$1.exports=function(){};var createTypedArrayConstructor$g=typedArrayConstructor$1.exports;createTypedArrayConstructor$g("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var esnext_typedArray_at={},ArrayBufferViewCore$Z=arrayBufferViewCore$1,lengthOfArrayLike$y=lengthOfArrayLike$K,toIntegerOrInfinity$k=toIntegerOrInfinity$v,aTypedArray$U=ArrayBufferViewCore$Z.aTypedArray,exportTypedArrayMethod$W=ArrayBufferViewCore$Z.exportTypedArrayMethod;exportTypedArrayMethod$W("at",(function(e){var t=aTypedArray$U(this),r=lengthOfArrayLike$y(t),n=toIntegerOrInfinity$k(e),i=n>=0?n:r+n;return i<0||i>=r?void 0:t[i]}));var es_typedArray_copyWithin={},toObject$q=toObject$D,toAbsoluteIndex$b=toAbsoluteIndex$h,lengthOfArrayLike$x=lengthOfArrayLike$K,deletePropertyOrThrow$6=deletePropertyOrThrow$9,min$b=Math.min,arrayCopyWithin$1=[].copyWithin||function(e,t){var r=toObject$q(this),n=lengthOfArrayLike$x(r),i=toAbsoluteIndex$b(e,n),a=toAbsoluteIndex$b(t,n),o=arguments.length>2?arguments[2]:void 0,s=min$b((void 0===o?n:toAbsoluteIndex$b(o,n))-a,n-i),l=1;for(a<i&&i<a+s&&(l=-1,a+=s-1,i+=s-1);s-- >0;)a in r?r[i]=r[a]:deletePropertyOrThrow$6(r,i),i+=l,a+=l;return r},uncurryThis$1h=functionUncurryThis$1,ArrayBufferViewCore$Y=arrayBufferViewCore$1,$ArrayCopyWithin$1=arrayCopyWithin$1,u$ArrayCopyWithin$1=uncurryThis$1h($ArrayCopyWithin$1),aTypedArray$T=ArrayBufferViewCore$Y.aTypedArray,exportTypedArrayMethod$V=ArrayBufferViewCore$Y.exportTypedArrayMethod;exportTypedArrayMethod$V("copyWithin",(function(e,t){return u$ArrayCopyWithin$1(aTypedArray$T(this),e,t,arguments.length>2?arguments[2]:void 0)}));var es_typedArray_every={},ArrayBufferViewCore$X=arrayBufferViewCore$1,$every$2=arrayIteration$1.every,aTypedArray$S=ArrayBufferViewCore$X.aTypedArray,exportTypedArrayMethod$U=ArrayBufferViewCore$X.exportTypedArrayMethod;exportTypedArrayMethod$U("every",(function(e){return $every$2(aTypedArray$S(this),e,arguments.length>1?arguments[1]:void 0)}));var es_typedArray_fill={},ArrayBufferViewCore$W=arrayBufferViewCore$1,$fill$1=arrayFill$3,toBigInt$5=toBigInt$7,classof$h=classof$u,call$w=functionCall$1,uncurryThis$1g=functionUncurryThis$1,fails$1h=fails$1Q,aTypedArray$R=ArrayBufferViewCore$W.aTypedArray,exportTypedArrayMethod$T=ArrayBufferViewCore$W.exportTypedArrayMethod,slice$2=uncurryThis$1g("".slice),CONVERSION_BUG$1=fails$1h((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e}));exportTypedArrayMethod$T("fill",(function(e){var t=arguments.length;aTypedArray$R(this);var r="Big"===slice$2(classof$h(this),0,3)?toBigInt$5(e):+e;return call$w($fill$1,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),CONVERSION_BUG$1);var es_typedArray_filter={},lengthOfArrayLike$w=lengthOfArrayLike$K,arrayFromConstructorAndList$6=function(e,t){for(var r=0,n=lengthOfArrayLike$w(t),i=new e(n);n>r;)i[r]=t[r++];return i},ArrayBufferViewCore$V=arrayBufferViewCore$1,speciesConstructor$6=speciesConstructor$a,aTypedArrayConstructor$6=ArrayBufferViewCore$V.aTypedArrayConstructor,getTypedArrayConstructor$8=ArrayBufferViewCore$V.getTypedArrayConstructor,typedArraySpeciesConstructor$9=function(e){return aTypedArrayConstructor$6(speciesConstructor$6(e,getTypedArrayConstructor$8(e)))},arrayFromConstructorAndList$5=arrayFromConstructorAndList$6,typedArraySpeciesConstructor$8=typedArraySpeciesConstructor$9,typedArrayFromSpeciesAndList$1=function(e,t){return arrayFromConstructorAndList$5(typedArraySpeciesConstructor$8(e),t)},ArrayBufferViewCore$U=arrayBufferViewCore$1,$filter$2=arrayIteration$1.filter,fromSpeciesAndList$1=typedArrayFromSpeciesAndList$1,aTypedArray$Q=ArrayBufferViewCore$U.aTypedArray,exportTypedArrayMethod$S=ArrayBufferViewCore$U.exportTypedArrayMethod;exportTypedArrayMethod$S("filter",(function(e){var t=$filter$2(aTypedArray$Q(this),e,arguments.length>1?arguments[1]:void 0);return fromSpeciesAndList$1(this,t)}));var es_typedArray_find={},ArrayBufferViewCore$T=arrayBufferViewCore$1,$find$2=arrayIteration$1.find,aTypedArray$P=ArrayBufferViewCore$T.aTypedArray,exportTypedArrayMethod$R=ArrayBufferViewCore$T.exportTypedArrayMethod;exportTypedArrayMethod$R("find",(function(e){return $find$2(aTypedArray$P(this),e,arguments.length>1?arguments[1]:void 0)}));var es_typedArray_findIndex={},ArrayBufferViewCore$S=arrayBufferViewCore$1,$findIndex$1=arrayIteration$1.findIndex,aTypedArray$O=ArrayBufferViewCore$S.aTypedArray,exportTypedArrayMethod$Q=ArrayBufferViewCore$S.exportTypedArrayMethod;exportTypedArrayMethod$Q("findIndex",(function(e){return $findIndex$1(aTypedArray$O(this),e,arguments.length>1?arguments[1]:void 0)}));var esnext_typedArray_findLast={},bind$g=functionBindContext$1,IndexedObject$8=indexedObject$1,toObject$p=toObject$D,lengthOfArrayLike$v=lengthOfArrayLike$K,createMethod$b=function(e){var t=1==e;return function(r,n,i){for(var a,o=toObject$p(r),s=IndexedObject$8(o),l=bind$g(n,i),u=lengthOfArrayLike$v(s);u-- >0;)if(l(a=s[u],u,o))switch(e){case 0:return a;case 1:return u}return t?-1:void 0}},arrayIterationFromLast$1={findLast:createMethod$b(0),findLastIndex:createMethod$b(1)},ArrayBufferViewCore$R=arrayBufferViewCore$1,$findLast$1=arrayIterationFromLast$1.findLast,aTypedArray$N=ArrayBufferViewCore$R.aTypedArray,exportTypedArrayMethod$P=ArrayBufferViewCore$R.exportTypedArrayMethod;exportTypedArrayMethod$P("findLast",(function(e){return $findLast$1(aTypedArray$N(this),e,arguments.length>1?arguments[1]:void 0)}));var esnext_typedArray_findLastIndex={},ArrayBufferViewCore$Q=arrayBufferViewCore$1,$findLastIndex$1=arrayIterationFromLast$1.findLastIndex,aTypedArray$M=ArrayBufferViewCore$Q.aTypedArray,exportTypedArrayMethod$O=ArrayBufferViewCore$Q.exportTypedArrayMethod;exportTypedArrayMethod$O("findLastIndex",(function(e){return $findLastIndex$1(aTypedArray$M(this),e,arguments.length>1?arguments[1]:void 0)}));var es_typedArray_forEach={},ArrayBufferViewCore$P=arrayBufferViewCore$1,$forEach$3=arrayIteration$1.forEach,aTypedArray$L=ArrayBufferViewCore$P.aTypedArray,exportTypedArrayMethod$N=ArrayBufferViewCore$P.exportTypedArrayMethod;exportTypedArrayMethod$N("forEach",(function(e){$forEach$3(aTypedArray$L(this),e,arguments.length>1?arguments[1]:void 0)}));var es_typedArray_includes={},ArrayBufferViewCore$O=arrayBufferViewCore$1,$includes$2=arrayIncludes$1.includes,aTypedArray$K=ArrayBufferViewCore$O.aTypedArray,exportTypedArrayMethod$M=ArrayBufferViewCore$O.exportTypedArrayMethod;exportTypedArrayMethod$M("includes",(function(e){return $includes$2(aTypedArray$K(this),e,arguments.length>1?arguments[1]:void 0)}));var es_typedArray_indexOf={},ArrayBufferViewCore$N=arrayBufferViewCore$1,$indexOf$3=arrayIncludes$1.indexOf,aTypedArray$J=ArrayBufferViewCore$N.aTypedArray,exportTypedArrayMethod$L=ArrayBufferViewCore$N.exportTypedArrayMethod;exportTypedArrayMethod$L("indexOf",(function(e){return $indexOf$3(aTypedArray$J(this),e,arguments.length>1?arguments[1]:void 0)}));var es_typedArray_iterator={},global$10=global$1v,fails$1g=fails$1Q,uncurryThis$1f=functionUncurryThis$1,ArrayBufferViewCore$M=arrayBufferViewCore$1,ArrayIterators$1=es_array_iterator$1,wellKnownSymbol$v=wellKnownSymbol$V,ITERATOR$d=wellKnownSymbol$v("iterator"),Uint8Array$4=global$10.Uint8Array,arrayValues$1=uncurryThis$1f(ArrayIterators$1.values),arrayKeys$1=uncurryThis$1f(ArrayIterators$1.keys),arrayEntries$1=uncurryThis$1f(ArrayIterators$1.entries),aTypedArray$I=ArrayBufferViewCore$M.aTypedArray,exportTypedArrayMethod$K=ArrayBufferViewCore$M.exportTypedArrayMethod,TypedArrayPrototype$3=Uint8Array$4&&Uint8Array$4.prototype,GENERIC$1=!fails$1g((function(){TypedArrayPrototype$3[ITERATOR$d].call([1])})),ITERATOR_IS_VALUES$1=!!TypedArrayPrototype$3&&TypedArrayPrototype$3.values&&TypedArrayPrototype$3[ITERATOR$d]===TypedArrayPrototype$3.values&&"values"===TypedArrayPrototype$3.values.name,typedArrayValues$1=function(){return arrayValues$1(aTypedArray$I(this))};exportTypedArrayMethod$K("entries",(function(){return arrayEntries$1(aTypedArray$I(this))}),GENERIC$1),exportTypedArrayMethod$K("keys",(function(){return arrayKeys$1(aTypedArray$I(this))}),GENERIC$1),exportTypedArrayMethod$K("values",typedArrayValues$1,GENERIC$1||!ITERATOR_IS_VALUES$1,{name:"values"}),exportTypedArrayMethod$K(ITERATOR$d,typedArrayValues$1,GENERIC$1||!ITERATOR_IS_VALUES$1,{name:"values"});var es_typedArray_join={},ArrayBufferViewCore$L=arrayBufferViewCore$1,uncurryThis$1e=functionUncurryThis$1,aTypedArray$H=ArrayBufferViewCore$L.aTypedArray,exportTypedArrayMethod$J=ArrayBufferViewCore$L.exportTypedArrayMethod,$join$1=uncurryThis$1e([].join);exportTypedArrayMethod$J("join",(function(e){return $join$1(aTypedArray$H(this),e)}));var es_typedArray_lastIndexOf={},apply$e=functionApply$1,toIndexedObject$i=toIndexedObject$q,toIntegerOrInfinity$j=toIntegerOrInfinity$v,lengthOfArrayLike$u=lengthOfArrayLike$K,arrayMethodIsStrict$c=arrayMethodIsStrict$g,min$a=Math.min,$lastIndexOf$3=[].lastIndexOf,NEGATIVE_ZERO$3=!!$lastIndexOf$3&&1/[1].lastIndexOf(1,-0)<0,STRICT_METHOD$b=arrayMethodIsStrict$c("lastIndexOf"),FORCED$o=NEGATIVE_ZERO$3||!STRICT_METHOD$b,arrayLastIndexOf$1=FORCED$o?function(e){if(NEGATIVE_ZERO$3)return apply$e($lastIndexOf$3,this,arguments)||0;var t=toIndexedObject$i(this),r=lengthOfArrayLike$u(t),n=r-1;for(arguments.length>1&&(n=min$a(n,toIntegerOrInfinity$j(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:$lastIndexOf$3,ArrayBufferViewCore$K=arrayBufferViewCore$1,apply$d=functionApply$1,$lastIndexOf$2=arrayLastIndexOf$1,aTypedArray$G=ArrayBufferViewCore$K.aTypedArray,exportTypedArrayMethod$I=ArrayBufferViewCore$K.exportTypedArrayMethod;exportTypedArrayMethod$I("lastIndexOf",(function(e){var t=arguments.length;return apply$d($lastIndexOf$2,aTypedArray$G(this),t>1?[e,arguments[1]]:[e])}));var es_typedArray_map={},ArrayBufferViewCore$J=arrayBufferViewCore$1,$map$2=arrayIteration$1.map,typedArraySpeciesConstructor$7=typedArraySpeciesConstructor$9,aTypedArray$F=ArrayBufferViewCore$J.aTypedArray,exportTypedArrayMethod$H=ArrayBufferViewCore$J.exportTypedArrayMethod;exportTypedArrayMethod$H("map",(function(e){return $map$2(aTypedArray$F(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(typedArraySpeciesConstructor$7(e))(t)}))}));var es_typedArray_reduce={},aCallable$g=aCallable$p,toObject$o=toObject$D,IndexedObject$7=indexedObject$1,lengthOfArrayLike$t=lengthOfArrayLike$K,$TypeError$l=TypeError,createMethod$a=function(e){return function(t,r,n,i){aCallable$g(r);var a=toObject$o(t),o=IndexedObject$7(a),s=lengthOfArrayLike$t(a),l=e?s-1:0,u=e?-1:1;if(n<2)for(;;){if(l in o){i=o[l],l+=u;break}if(l+=u,e?l<0:s<=l)throw $TypeError$l("Reduce of empty array with no initial value")}for(;e?l>=0:s>l;l+=u)l in o&&(i=r(i,o[l],l,a));return i}},arrayReduce$1={left:createMethod$a(!1),right:createMethod$a(!0)},ArrayBufferViewCore$I=arrayBufferViewCore$1,$reduce$3=arrayReduce$1.left,aTypedArray$E=ArrayBufferViewCore$I.aTypedArray,exportTypedArrayMethod$G=ArrayBufferViewCore$I.exportTypedArrayMethod;exportTypedArrayMethod$G("reduce",(function(e){var t=arguments.length;return $reduce$3(aTypedArray$E(this),e,t,t>1?arguments[1]:void 0)}));var es_typedArray_reduceRight={},ArrayBufferViewCore$H=arrayBufferViewCore$1,$reduceRight$1=arrayReduce$1.right,aTypedArray$D=ArrayBufferViewCore$H.aTypedArray,exportTypedArrayMethod$F=ArrayBufferViewCore$H.exportTypedArrayMethod;exportTypedArrayMethod$F("reduceRight",(function(e){var t=arguments.length;return $reduceRight$1(aTypedArray$D(this),e,t,t>1?arguments[1]:void 0)}));var es_typedArray_reverse={},ArrayBufferViewCore$G=arrayBufferViewCore$1,aTypedArray$C=ArrayBufferViewCore$G.aTypedArray,exportTypedArrayMethod$E=ArrayBufferViewCore$G.exportTypedArrayMethod,floor$b=Math.floor;exportTypedArrayMethod$E("reverse",(function(){for(var e,t=this,r=aTypedArray$C(t).length,n=floor$b(r/2),i=0;i<n;)e=t[i],t[i++]=t[--r],t[r]=e;return t}));var es_typedArray_set={},global$$=global$1v,call$v=functionCall$1,ArrayBufferViewCore$F=arrayBufferViewCore$1,lengthOfArrayLike$s=lengthOfArrayLike$K,toOffset$3=toOffset$5,toIndexedObject$h=toObject$D,fails$1f=fails$1Q,RangeError$4=global$$.RangeError,Int8Array$6=global$$.Int8Array,Int8ArrayPrototype$2=Int8Array$6&&Int8Array$6.prototype,$set$1=Int8ArrayPrototype$2&&Int8ArrayPrototype$2.set,aTypedArray$B=ArrayBufferViewCore$F.aTypedArray,exportTypedArrayMethod$D=ArrayBufferViewCore$F.exportTypedArrayMethod,WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS$1=!fails$1f((function(){var e=new Uint8ClampedArray(2);return call$v($set$1,e,{length:1,0:3},1),3!==e[1]})),TO_OBJECT_BUG$1=WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS$1&&ArrayBufferViewCore$F.NATIVE_ARRAY_BUFFER_VIEWS&&fails$1f((function(){var e=new Int8Array$6(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));exportTypedArrayMethod$D("set",(function(e){aTypedArray$B(this);var t=toOffset$3(arguments.length>1?arguments[1]:void 0,1),r=toIndexedObject$h(e);if(WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS$1)return call$v($set$1,this,r,t);var n=this.length,i=lengthOfArrayLike$s(r),a=0;if(i+t>n)throw RangeError$4("Wrong length");for(;a<i;)this[t+a]=r[a++]}),!WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS$1||TO_OBJECT_BUG$1);var es_typedArray_slice={},ArrayBufferViewCore$E=arrayBufferViewCore$1,typedArraySpeciesConstructor$6=typedArraySpeciesConstructor$9,fails$1e=fails$1Q,arraySlice$f=arraySlice$n,aTypedArray$A=ArrayBufferViewCore$E.aTypedArray,exportTypedArrayMethod$C=ArrayBufferViewCore$E.exportTypedArrayMethod,FORCED$n=fails$1e((function(){new Int8Array(1).slice()}));exportTypedArrayMethod$C("slice",(function(e,t){for(var r=arraySlice$f(aTypedArray$A(this),e,t),n=typedArraySpeciesConstructor$6(this),i=0,a=r.length,o=new n(a);a>i;)o[i]=r[i++];return o}),FORCED$n);var es_typedArray_some={},ArrayBufferViewCore$D=arrayBufferViewCore$1,$some$3=arrayIteration$1.some,aTypedArray$z=ArrayBufferViewCore$D.aTypedArray,exportTypedArrayMethod$B=ArrayBufferViewCore$D.exportTypedArrayMethod;exportTypedArrayMethod$B("some",(function(e){return $some$3(aTypedArray$z(this),e,arguments.length>1?arguments[1]:void 0)}));var es_typedArray_sort={},global$_=global$1v,uncurryThis$1d=functionUncurryThis$1,fails$1d=fails$1Q,aCallable$f=aCallable$p,internalSort$2=arraySort$3,ArrayBufferViewCore$C=arrayBufferViewCore$1,FF$3=engineFfVersion$1,IE_OR_EDGE$2=engineIsIeOrEdge$1,V8$2=engineV8Version$1,WEBKIT$2=engineWebkitVersion$1,aTypedArray$y=ArrayBufferViewCore$C.aTypedArray,exportTypedArrayMethod$A=ArrayBufferViewCore$C.exportTypedArrayMethod,Uint16Array$2=global$_.Uint16Array,nativeSort$2=Uint16Array$2&&uncurryThis$1d(Uint16Array$2.prototype.sort),ACCEPT_INCORRECT_ARGUMENTS$1=!(!nativeSort$2||fails$1d((function(){nativeSort$2(new Uint16Array$2(2),null)}))&&fails$1d((function(){nativeSort$2(new Uint16Array$2(2),{})}))),STABLE_SORT$2=!!nativeSort$2&&!fails$1d((function(){if(V8$2)return V8$2<74;if(FF$3)return FF$3<67;if(IE_OR_EDGE$2)return!0;if(WEBKIT$2)return WEBKIT$2<602;var e,t,r=new Uint16Array$2(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(nativeSort$2(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0})),getSortCompare$2=function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}};exportTypedArrayMethod$A("sort",(function(e){return void 0!==e&&aCallable$f(e),STABLE_SORT$2?nativeSort$2(this,e):internalSort$2(aTypedArray$y(this),getSortCompare$2(e))}),!STABLE_SORT$2||ACCEPT_INCORRECT_ARGUMENTS$1);var es_typedArray_subarray={},ArrayBufferViewCore$B=arrayBufferViewCore$1,toLength$e=toLength$m,toAbsoluteIndex$a=toAbsoluteIndex$h,typedArraySpeciesConstructor$5=typedArraySpeciesConstructor$9,aTypedArray$x=ArrayBufferViewCore$B.aTypedArray,exportTypedArrayMethod$z=ArrayBufferViewCore$B.exportTypedArrayMethod;exportTypedArrayMethod$z("subarray",(function(e,t){var r=aTypedArray$x(this),n=r.length,i=toAbsoluteIndex$a(e,n);return new(typedArraySpeciesConstructor$5(r))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,toLength$e((void 0===t?n:toAbsoluteIndex$a(t,n))-i))}));var es_typedArray_toLocaleString={},global$Z=global$1v,apply$c=functionApply$1,ArrayBufferViewCore$A=arrayBufferViewCore$1,fails$1c=fails$1Q,arraySlice$e=arraySlice$n,Int8Array$5=global$Z.Int8Array,aTypedArray$w=ArrayBufferViewCore$A.aTypedArray,exportTypedArrayMethod$y=ArrayBufferViewCore$A.exportTypedArrayMethod,$toLocaleString$1=[].toLocaleString,TO_LOCALE_STRING_BUG$1=!!Int8Array$5&&fails$1c((function(){$toLocaleString$1.call(new Int8Array$5(1))})),FORCED$m=fails$1c((function(){return[1,2].toLocaleString()!=new Int8Array$5([1,2]).toLocaleString()}))||!fails$1c((function(){Int8Array$5.prototype.toLocaleString.call([1,2])}));exportTypedArrayMethod$y("toLocaleString",(function(){return apply$c($toLocaleString$1,TO_LOCALE_STRING_BUG$1?arraySlice$e(aTypedArray$w(this)):aTypedArray$w(this),arraySlice$e(arguments))}),FORCED$m);var es_typedArray_toString={},exportTypedArrayMethod$x=arrayBufferViewCore$1.exportTypedArrayMethod,fails$1b=fails$1Q,global$Y=global$1v,uncurryThis$1c=functionUncurryThis$1,Uint8Array$3=global$Y.Uint8Array,Uint8ArrayPrototype$1=Uint8Array$3&&Uint8Array$3.prototype||{},arrayToString$1=[].toString,join$6=uncurryThis$1c([].join);fails$1b((function(){arrayToString$1.call({})}))&&(arrayToString$1=function(){return join$6(this)});var IS_NOT_ARRAY_METHOD$1=Uint8ArrayPrototype$1.toString!=arrayToString$1;exportTypedArrayMethod$x("toString",arrayToString$1,IS_NOT_ARRAY_METHOD$1);var LoaderType$3={FETCH:"fetch",XHR:"xhr"},ResponseType$3={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},NetError$3=function(e){_inherits$d(r,e);var t=_createSuper$g(r);function r(e,n,i,a){var o;return _classCallCheck$g(this,r),_defineProperty$g(_assertThisInitialized$d(o=t.call(this,a)),"retryCount",0),_defineProperty$g(_assertThisInitialized$d(o),"isTimeout",!1),_defineProperty$g(_assertThisInitialized$d(o),"loaderType",LoaderType$3.FETCH),_defineProperty$g(_assertThisInitialized$d(o),"startTime",0),_defineProperty$g(_assertThisInitialized$d(o),"endTime",0),_defineProperty$g(_assertThisInitialized$d(o),"options",{}),o.url=e,o.request=n,o.response=i,o}return _createClass$h(r)}(_wrapNativeSuper$5(Error)),es_object_getPrototypeOf={},$$1R=_export$1,fails$1a=fails$1Q,toObject$n=toObject$D,nativeGetPrototypeOf$1=objectGetPrototypeOf$1,CORRECT_PROTOTYPE_GETTER$2=correctPrototypeGetter$1,FAILS_ON_PRIMITIVES$6=fails$1a((function(){nativeGetPrototypeOf$1(1)}));$$1R({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$6,sham:!CORRECT_PROTOTYPE_GETTER$2},{getPrototypeOf:function(e){return nativeGetPrototypeOf$1(toObject$n(e))}});var toString$C=Object.prototype.toString;function isObject$A(e){return null!==e&&"object"===_typeof$9(e)}function isPlainObject$3(e){if("[object Object]"!==toString$C.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate$3(e){return"[object Date]"===toString$C.call(e)}function getRangeValue$3(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode$4(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams$3(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate$3(t)?t=t.toISOString():isObject$A(t)&&(t=JSON.stringify(t)),"".concat(encode$4(e),"=").concat(encode$4(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse$3(e,t,r,n,i,a,o,s,l,u,c){return i=null!=i?parseFloat(i):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0),{data:e,done:t,option:{range:l,vid:u,index:s,contentLength:n,age:i,startTime:a,firstByteTime:o,endTime:Date.now(),priOptions:c},response:r}}function calculateSpeed$1(e,t){return Math.round(8*e*1e3/t/1024)}var EVENT$2={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},CACHESIZE$2=2097152,FetchLoader$3=function(e){_inherits$d(n,e);var t,r=_createSuper$g(n);function n(){var e;return _classCallCheck$g(this,n),_defineProperty$g(_assertThisInitialized$d(e=r.call(this)),"_abortController",null),_defineProperty$g(_assertThisInitialized$d(e),"_timeoutTimer",null),_defineProperty$g(_assertThisInitialized$d(e),"_reader",null),_defineProperty$g(_assertThisInitialized$d(e),"_response",null),_defineProperty$g(_assertThisInitialized$d(e),"_aborted",!1),_defineProperty$g(_assertThisInitialized$d(e),"_index",-1),_defineProperty$g(_assertThisInitialized$d(e),"_range",null),_defineProperty$g(_assertThisInitialized$d(e),"_receivedLength",0),_defineProperty$g(_assertThisInitialized$d(e),"_running",!1),_defineProperty$g(_assertThisInitialized$d(e),"_logger",null),_defineProperty$g(_assertThisInitialized$d(e),"_vid",""),_defineProperty$g(_assertThisInitialized$d(e),"_onProcessMinLen",0),_defineProperty$g(_assertThisInitialized$d(e),"_onCancel",null),_defineProperty$g(_assertThisInitialized$d(e),"_priOptions",null),e}return _createClass$h(n,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.vid,a=e.timeout,o=e.responseType,s=e.onProgress,l=e.index,u=e.onTimeout,c=e.onCancel,d=e.range,h=e.transformResponse,f=e.request,p=e.params,y=e.logger,m=e.method,g=e.headers,v=e.body,b=e.mode,_=e.credentials,E=e.cache,T=e.redirect,S=e.referrer,$=e.referrerPolicy,A=e.onProcessMinLen,w=e.priOptions;this._logger=y,this._aborted=!1,this._onProcessMinLen=A,this._onCancel=c,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=l,this._range=d||[0,0],this._vid=i||n,this._priOptions=w||{};var k={method:m,headers:g,body:v,mode:b,credentials:_,cache:E,redirect:T,referrer:S,referrerPolicy:$,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},I=!1;clearTimeout(this._timeoutTimer),n=setUrlParams$3(n,p);var C=getRangeValue$3(d);C&&(g=f?f.headers:k.headers=k.headers||(Headers?new Headers:{}),Headers&&g instanceof Headers?g.append("Range",C):g.Range=C),a&&(this._timeoutTimer=setTimeout((function(){if(I=!0,r.cancel(),u){var e=new NetError$3(n,k,null,"timeout");e.isTimeout=!0,u(e,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})}}),a));var P=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",d),new Promise((function(e,t){fetch(f||n,f?void 0:k).then(function(){var i=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function i(a){var u,c,f,p;return _regeneratorRuntime$9().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=a,!r._aborted&&r._running){i.next=4;break}return i.abrupt("return");case 4:if(h&&(a=h(a,n)||a),a.ok){i.next=7;break}throw new NetError$3(n,k,a,"bad network response");case 7:if(u=Date.now(),o!==ResponseType$3.TEXT){i.next=15;break}return i.next=11,a.text();case 11:c=i.sent,r._running=!1,i.next=37;break;case 15:if(o!==ResponseType$3.JSON){i.next=22;break}return i.next=18,a.json();case 18:c=i.sent,r._running=!1,i.next=37;break;case 22:if(!s){i.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(a,s,P,u),i.abrupt("return");case 29:return i.next=31,a.arrayBuffer();case 31:c=i.sent,c=new Uint8Array(c),r._running=!1,f=Date.now()-P,p=calculateSpeed$1(c.byteLength,f),r.emit(EVENT$2.REAL_TIME_SPEED,{speed:p,len:c.byteLength,time:f,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions});case 37:r._logger.debug("[fetch load end], index,",l,",range,",d),e(createResponse$3(c,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),P,u,l,d,r._vid,r._priOptions));case 39:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){var i;clearTimeout(r._timeoutTimer),r._running=!1,r._aborted&&!I||((e=e instanceof NetError$3?e:new NetError$3(n,k,null,null===(i=e)||void 0===i?void 0:i.message)).startTime=P,e.endTime=Date.now(),e.isTimeout=I,e.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},t(e))}))}))}},{key:"cancel",value:(t=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function e(){return _regeneratorRuntime$9().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,n){var i=this;if(!e.body||!e.body.getReader){this._running=!1;var a=new NetError$3(e.url,"",e,"onProgress of bad response.body.getReader");return a.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(a)}this._onProcessMinLen>0&&(this._cache=new Uint8Array(CACHESIZE$2),this._writeIdx=0);var o,s,l,u=this._reader=e.body.getReader(),c=function(){var a=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function a(){var d,h,f,p,y,m;return _regeneratorRuntime$9().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=Date.now(),a.prev=1,a.next=4,u.read();case 4:o=a.sent,l=Date.now(),a.next=13;break;case 8:return a.prev=8,a.t0=a.catch(1),l=Date.now(),i._aborted||(i._running=!1,a.t0.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i.reject(a.t0)),a.abrupt("return");case 13:if(d=i._range[0]+i._receivedLength,!i._aborted){a.next=18;break}return i._running=!1,t(void 0,!1,{range:[d,d],vid:i._vid,index:i._index,startTime:s,endTime:l,priOptions:i._priOptions},e),a.abrupt("return");case 18:h=o.value?o.value.byteLength:0,i._receivedLength+=h,i._logger.debug("fetchLoader,onProgress call,task,",i._range,", start,",d,", end,",i._range[0]+i._receivedLength,", done,",o.done),i._onProcessMinLen>0?i._writeIdx+h>=i._onProcessMinLen||o.done?((f=new Uint8Array(i._writeIdx+h)).set(i._cache.slice(0,i._writeIdx),0),h>0&&f.set(o.value,i._writeIdx),i._writeIdx=0,i._logger.debug("fetchLoader,onProgress enough,done,",o.done,",len,",f.byteLength,", writeIdx,",i._writeIdx)):h>0&&i._writeIdx+h<CACHESIZE$2?(i._cache.set(o.value,i._writeIdx),i._writeIdx+=h,i._logger.debug("fetchLoader,onProgress cache,len,",h,", writeIdx,",i._writeIdx)):h>0&&(p=new Uint8Array(i._writeIdx+h+2048),i._logger.debug("fetchLoader,onProgress extra start,size,",i._writeIdx+h+2048,", datalen,",h,", writeIdx,",i._writeIdx),p.set(i._cache.slice(0,i._writeIdx),0),h>0&&p.set(o.value,i._writeIdx),i._writeIdx+=h,delete i._cache,i._cache=p,i._logger.debug("fetchLoader,onProgress extra end,len,",h,", writeIdx,",i._writeIdx)):f=o.value,(f&&f.byteLength>0||o.done)&&t(f,o.done,{range:[i._range[0]+i._receivedLength-(f?f.byteLength:0),i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:s,endTime:l,priOptions:i._priOptions},e),o.done?(y=Date.now()-r,m=calculateSpeed$1(i._receivedLength,y),i.emit(EVENT$2.REAL_TIME_SPEED,{speed:m,len:i._receivedLength,time:y,vid:i._vid,index:i._index,range:i._range,priOptions:i._priOptions}),i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",o.done),i.resolve(createResponse$3(o,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),r,n,i._index,i._range,i._vid,i._priOptions))):c();case 24:case"end":return a.stop()}}),a,null,[[1,8]])})));return function(){return a.apply(this,arguments)}}();c()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),n}(EventEmitter$1);function getConfig$5(e){return _objectSpread2$9({loaderType:LoaderType$3.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType$3.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e)}var XhrLoader$3=function(t){_inherits$d(n,t);var r=_createSuper$g(n);function n(){var e;return _classCallCheck$g(this,n),_defineProperty$g(_assertThisInitialized$d(e=r.call(this)),"_xhr",null),_defineProperty$g(_assertThisInitialized$d(e),"_aborted",!1),_defineProperty$g(_assertThisInitialized$d(e),"_timeoutTimer",null),_defineProperty$g(_assertThisInitialized$d(e),"_range",null),_defineProperty$g(_assertThisInitialized$d(e),"_receivedLength",0),_defineProperty$g(_assertThisInitialized$d(e),"_url",null),_defineProperty$g(_assertThisInitialized$d(e),"_onProgress",null),_defineProperty$g(_assertThisInitialized$d(e),"_index",-1),_defineProperty$g(_assertThisInitialized$d(e),"_headers",null),_defineProperty$g(_assertThisInitialized$d(e),"_currentChunkSizeKB",384),_defineProperty$g(_assertThisInitialized$d(e),"_timeout",null),_defineProperty$g(_assertThisInitialized$d(e),"_xhr",null),_defineProperty$g(_assertThisInitialized$d(e),"_withCredentials",null),_defineProperty$g(_assertThisInitialized$d(e),"_startTime",-1),_defineProperty$g(_assertThisInitialized$d(e),"_loadCompleteResolve",null),_defineProperty$g(_assertThisInitialized$d(e),"_loadCompleteReject",null),_defineProperty$g(_assertThisInitialized$d(e),"_runing",!1),_defineProperty$g(_assertThisInitialized$d(e),"_logger",!1),_defineProperty$g(_assertThisInitialized$d(e),"_vid",""),_defineProperty$g(_assertThisInitialized$d(e),"_responseType",void 0),_defineProperty$g(_assertThisInitialized$d(e),"_credentials",void 0),_defineProperty$g(_assertThisInitialized$d(e),"_method",void 0),_defineProperty$g(_assertThisInitialized$d(e),"_transformResponse",void 0),_defineProperty$g(_assertThisInitialized$d(e),"_firstRtt",void 0),_defineProperty$g(_assertThisInitialized$d(e),"_onCancel",null),_defineProperty$g(_assertThisInitialized$d(e),"_priOptions",null),e}return _createClass$h(n,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("xhrLoader task, range",this._range),this._url=setUrlParams$3(e.url,e.params);var r=Date.now();return new Promise((function(e,r){t._loadCompleteResolve=e,t._loadCompleteReject=r,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof NetError$3?e:new NetError$3(t._url,t._request)).startTime=r,e.endTime=Date.now(),e.options={index:t._index,vid:t._vid,priOptions:t._priOptions},e}))}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===ResponseType$3.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,r=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-r&&(n=r+t),e=[r,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(t){var r=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(e){var t,n,i;r._running=!1;var a=new NetError$3(r._url,r._request,null==e||null===(t=e.currentTarget)||void 0===t?void 0:t.response,"xhr.onerror.status:"+(null==e||null===(n=e.currentTarget)||void 0===n?void 0:n.status)+",statusText,"+(null==e||null===(i=e.currentTarget)||void 0===i?void 0:i.statusText));a.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},r._loadCompleteReject(a)},n.ontimeout=function(e){r.cancel();var t=new NetError$3(r._url,r._request,{status:408},"timeout");r._onTimeout&&(t.isTimeout=!0,r._onTimeout(t,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})),t.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},r._loadCompleteReject(t)};var i=this._headers||{},a=getRangeValue$3(t);a&&(i.Range=a),i&&Object.keys(i).forEach((function(e){n.setRequestHeader(e,i[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",t),n.send(this._body)}catch(e){e.options={index:this._index,range:t,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(e)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t=e.target.status;if(t<200||t>299){var r=new NetError$3(this._url,null,_objectSpread2$9(_objectSpread2$9({},e.target.response),{},{status:t}),"bad response,status:"+t);return r.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(r)}var n,i=null,a=!1;if(this._responseType===ResponseType$3.ARRAY_BUFFER){var o=new Uint8Array(e.target.response);if(n=this._range[0]+this._receivedLength,o&&o.byteLength>0){this._receivedLength+=o.byteLength;var s=Date.now()-this._startTime,l=calculateSpeed$1(this._receivedLength,s);this.emit(EVENT$2.REAL_TIME_SPEED,{speed:l,len:this._receivedLength,time:s,vid:this._vid,index:this._index,range:[n,this._range[0]+this._receivedLength],priOptions:this._priOptions})}i=o,a=!(this._range.length>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",n,"end ",this._range[0]+this._receivedLength,",dataLen,",o?o.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",a)}else a=!0,i=e.target.response;var u={ok:t>=200&&t<300,status:t,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(u=this._transformResponse(u,this._url)||u),this._onProgress&&this._onProgress(i,a,{index:this._index,vid:this._vid,range:[n,this._range[0]+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},u),a?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(createResponse$3(this._onProgress?null:i,a,u,u.headers["content-length"],u.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,_get$2(_getPrototypeOf$d(n.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper$4(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),n}(EventEmitter$1),_excluded$5=["retry","retryDelay","onRetryError","transformError"],Task$3=function(){function e(t,r){_classCallCheck$g(this,e),this.promise=createPublicPromise$4(),this.alive=!!r.onProgress,!r.logger&&(r.logger=new Logger$c("Loader")),this._loaderType=t,this._loader=t===LoaderType$3.FETCH&&window.fetch?new FetchLoader$3:new XhrLoader$3,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._logger=r.logger}var t;return _createClass$h(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties$4(t,_excluded$5),s=function(){var t=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function t(){var l,u;return _regeneratorRuntime$9().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:l=t.sent,e.promise.resolve(l),t.next=25;break;case 7:if(t.prev=7,t.t0=t.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,u=t.t0,a&&(u=a(u)||u),i&&e._retryCount>0&&i(u,e._retryCount,{index:o.index,vid:o.vid,range:o.range,priOptions:o.priOptions}),e._retryCount++,!(e._retryCount<=r)){t.next=24;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",o.range),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 24:e.promise.reject(u);case 25:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function e(){return _regeneratorRuntime$9().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),e}();function isMediaPlaying(e){return e&&!e.paused&&!e.ended&&0!==e.playbackRate&&0!==e.readyState}function getVideoPlaybackQuality(e){if(!e)return{};if("function"==typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();return{droppedVideoFrames:t.droppedVideoFrames||t.corruptedVideoFrames,totalVideoFrames:t.totalVideoFrames,creationTime:t.creationTime}}return{droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDecodedFrameCount,creationTime:performance.now()}}function concatUint8Array$5(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((t=t.filter(Boolean)).length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function sleep$3(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var NetLoader$3=function(e){_inherits$d(n,e);var t,r=_createSuper$g(n);function n(e){var t;return _classCallCheck$g(this,n),_defineProperty$g(_assertThisInitialized$d(t=r.call(this,e)),"type",LoaderType$3.FETCH),_defineProperty$g(_assertThisInitialized$d(t),"_queue",[]),_defineProperty$g(_assertThisInitialized$d(t),"_alive",[]),_defineProperty$g(_assertThisInitialized$d(t),"_currentTask",null),_defineProperty$g(_assertThisInitialized$d(t),"_config",void 0),t._config=getConfig$5(e),t._config.loaderType!==LoaderType$3.XHR&&FetchLoader$3.isSupported()||(t.type=LoaderType$3.XHR),t.log=e.logger,t}return _createClass$h(n,[{key:"isFetch",value:function(){return this.type===LoaderType$3.FETCH}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?r=e:r.url=e||r.url||this._config.url,(r=Object.assign({},this._config,r)).params&&(r.params=Object.assign({},r.params)),r.headers&&isPlainObject$3(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&isPlainObject$3(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var n=new Task$3(this.type,r);return n.loader.on(EVENT$2.REAL_TIME_SPEED,(function(e){t.emit(EVENT$2.REAL_TIME_SPEED,e)})),this._queue.push(n),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),n.promise}},{key:"cancel",value:(t=_asyncToGenerator$b(_regeneratorRuntime$9().mark((function e(){var t;return _regeneratorRuntime$9().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,sleep$3();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(e){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader$3.isSupported()}}]),n}(EventEmitter$1),GapService=function(){function e(){_classCallCheck$g(this,e),_defineProperty$g(this,"_prevCurrentTime",0)}return _createClass$h(e,[{key:"do",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e){var i=e.currentTime,a=0;if(this._prevCurrentTime===i){var o=Buffer$5.info(Buffer$5.get(e),i);if(!o.buffers.length)return;r&&o.nextStart||o.nextStart&&o.nextStart-i<t?a=o.nextStart+.1:o.end&&o.end-i>n&&!e.seeking&&(a=i+.1)}this._prevCurrentTime=i,a&&i!==a&&(e.currentTime=a)}}}]),e}(),es_set={},internalMetadata={exports:{}},objectGetOwnPropertyNamesExternal={},classof$g=classofRaw$5,toIndexedObject$g=toIndexedObject$q,$getOwnPropertyNames$1=objectGetOwnPropertyNames$1.f,arraySlice$d=arraySliceSimple$1,windowNames="object"==("undefined"==typeof window?"undefined":_typeof$b(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],getWindowNames=function(e){try{return $getOwnPropertyNames$1(e)}catch(error){return arraySlice$d(windowNames)}};objectGetOwnPropertyNamesExternal.f=function(e){return windowNames&&"Window"==classof$g(e)?getWindowNames(e):$getOwnPropertyNames$1(toIndexedObject$g(e))};var fails$19=fails$1Q,arrayBufferNonExtensible=fails$19((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),fails$18=fails$1Q,isObject$z=isObject$U,classof$f=classofRaw$5,ARRAY_BUFFER_NON_EXTENSIBLE=arrayBufferNonExtensible,$isExtensible=Object.isExtensible,FAILS_ON_PRIMITIVES$5=fails$18((function(){$isExtensible(1)})),objectIsExtensible=FAILS_ON_PRIMITIVES$5||ARRAY_BUFFER_NON_EXTENSIBLE?function(e){return!!isObject$z(e)&&((!ARRAY_BUFFER_NON_EXTENSIBLE||"ArrayBuffer"!=classof$f(e))&&(!$isExtensible||$isExtensible(e)))}:$isExtensible,fails$17=fails$1Q,freezing=!fails$17((function(){return Object.isExtensible(Object.preventExtensions({}))})),$$1Q=_export$1,uncurryThis$1b=functionUncurryThis$1,hiddenKeys$6=hiddenKeys$b,isObject$y=isObject$U,hasOwn$v=hasOwnProperty_1$1,defineProperty$l=objectDefineProperty$1.f,getOwnPropertyNamesModule$2=objectGetOwnPropertyNames$1,getOwnPropertyNamesExternalModule=objectGetOwnPropertyNamesExternal,isExtensible=objectIsExtensible,uid$5=uid$9,FREEZING=freezing,REQUIRED=!1,METADATA=uid$5("meta"),id$1=0,setMetadata=function(e){defineProperty$l(e,METADATA,{value:{objectID:"O"+id$1++,weakData:{}}})},fastKey$1=function(e,t){if(!isObject$y(e))return"symbol"==_typeof$b(e)?e:("string"==typeof e?"S":"P")+e;if(!hasOwn$v(e,METADATA)){if(!isExtensible(e))return"F";if(!t)return"E";setMetadata(e)}return e[METADATA].objectID},getWeakData=function(e,t){if(!hasOwn$v(e,METADATA)){if(!isExtensible(e))return!0;if(!t)return!1;setMetadata(e)}return e[METADATA].weakData},onFreeze=function(e){return FREEZING&&REQUIRED&&isExtensible(e)&&!hasOwn$v(e,METADATA)&&setMetadata(e),e},enable=function(){meta$1.enable=function(){},REQUIRED=!0;var e=getOwnPropertyNamesModule$2.f,t=uncurryThis$1b([].splice),r={};r[METADATA]=1,e(r).length&&(getOwnPropertyNamesModule$2.f=function(r){for(var n=e(r),i=0,a=n.length;i<a;i++)if(n[i]===METADATA){t(n,i,1);break}return n},$$1Q({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:getOwnPropertyNamesExternalModule.f}))},meta$1=internalMetadata.exports={enable:enable,fastKey:fastKey$1,getWeakData:getWeakData,onFreeze:onFreeze};hiddenKeys$6[METADATA]=!0;var $$1P=_export$1,global$X=global$1v,uncurryThis$1a=functionUncurryThis$1,isForced$4=isForced_1$1,defineBuiltIn$n=defineBuiltIn$D,InternalMetadataModule=internalMetadata.exports,iterate$4=iterate$7,anInstance$b=anInstance$h,isCallable$w=isCallable$Z,isNullOrUndefined$9=isNullOrUndefined$h,isObject$x=isObject$U,fails$16=fails$1Q,checkCorrectnessOfIteration$4=checkCorrectnessOfIteration$7,setToStringTag$d=setToStringTag$k,inheritIfRequired$7=inheritIfRequired$b,collection$2=function(e,t,r){var n=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=n?"set":"add",o=global$X[e],s=o&&o.prototype,l=o,u={},c=function(e){var t=uncurryThis$1a(s[e]);defineBuiltIn$n(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!isObject$x(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!isObject$x(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!isObject$x(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(isForced$4(e,!isCallable$w(o)||!(i||s.forEach&&!fails$16((function(){(new o).entries().next()})))))l=r.getConstructor(t,e,n,a),InternalMetadataModule.enable();else if(isForced$4(e,!0)){var d=new l,h=d[a](i?{}:-0,1)!=d,f=fails$16((function(){d.has(1)})),p=checkCorrectnessOfIteration$4((function(e){new o(e)})),y=!i&&fails$16((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));p||((l=t((function(e,t){anInstance$b(e,s);var r=inheritIfRequired$7(new o,e,l);return isNullOrUndefined$9(t)||iterate$4(t,r[a],{that:r,AS_ENTRIES:n}),r}))).prototype=s,s.constructor=l),(f||y)&&(c("delete"),c("has"),n&&c("get")),(y||h)&&c(a),i&&s.clear&&delete s.clear}return u[e]=l,$$1P({global:!0,constructor:!0,forced:l!=o},u),setToStringTag$d(l,e),i||r.setStrong(l,e,n),l},defineProperty$k=objectDefineProperty$1.f,create$b=objectCreate$2,defineBuiltIns$3=defineBuiltIns$6,bind$f=functionBindContext$1,anInstance$a=anInstance$h,isNullOrUndefined$8=isNullOrUndefined$h,iterate$3=iterate$7,defineIterator$2=iteratorDefine$1,createIterResultObject$3=createIterResultObject$6,setSpecies$5=setSpecies$9,DESCRIPTORS$D=descriptors$1,fastKey=internalMetadata.exports.fastKey,InternalStateModule$c=internalState$1,setInternalState$a=InternalStateModule$c.set,internalStateGetterFor=InternalStateModule$c.getterFor,collectionStrong$2={getConstructor:function(e,t,r,n){var i=e((function(e,i){anInstance$a(e,a),setInternalState$a(e,{type:t,index:create$b(null),first:void 0,last:void 0,size:0}),DESCRIPTORS$D||(e.size=0),isNullOrUndefined$8(i)||iterate$3(i,e[n],{that:e,AS_ENTRIES:r})})),a=i.prototype,o=internalStateGetterFor(t),s=function(e,t,r){var n,i,a=o(e),s=l(e,t);return s?s.value=r:(a.last=s={index:i=fastKey(t,!0),key:t,value:r,previous:n=a.last,next:void 0,removed:!1},a.first||(a.first=s),n&&(n.next=s),DESCRIPTORS$D?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},l=function(e,t){var r,n=o(e),i=fastKey(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return defineBuiltIns$3(a,{clear:function(){for(var e=o(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,DESCRIPTORS$D?e.size=0:this.size=0},delete:function(e){var t=this,r=o(t),n=l(t,e);if(n){var i=n.next,a=n.previous;delete r.index[n.index],n.removed=!0,a&&(a.next=i),i&&(i.previous=a),r.first==n&&(r.first=i),r.last==n&&(r.last=a),DESCRIPTORS$D?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=o(this),n=bind$f(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!l(this,e)}}),defineBuiltIns$3(a,r?{get:function(e){var t=l(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),DESCRIPTORS$D&&defineProperty$k(a,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=internalStateGetterFor(t),a=internalStateGetterFor(n);defineIterator$2(e,t,(function(e,t){setInternalState$a(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?createIterResultObject$3("keys"==t?r.key:"values"==t?r.value:[r.key,r.value],!1):(e.target=void 0,createIterResultObject$3(void 0,!0))}),r?"entries":"values",!r,!0),setSpecies$5(t)}},collection$1=collection$2,collectionStrong$1=collectionStrong$2;collection$1("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),collectionStrong$1);var SeiService=function(){function e(t){var r=this;_classCallCheck$g(this,e),_defineProperty$g(this,"_seiSet",new Set),this.emitter=t,t.on(EVENT$2.SEI,(function(e){e&&r._seiSet.add(e)}))}return _createClass$h(e,[{key:"throw",value:function(e){var t=this;if(null!=e&&this._seiSet.size){var r=e-.2,n=e+.2,i=[];this._seiSet.forEach((function(e){e.time>=r&&e.time<=n&&i.push(e)})),i.forEach((function(e){t._seiSet.delete(e),t.emitter.emit(EVENT$2.SEI_IN_TIME,e)}))}}},{key:"reset",value:function(){this._seiSet.clear()}}]),e}(),BandwidthService=function(){function e(){_classCallCheck$g(this,e),_defineProperty$g(this,"_chunkSpeeds",[]),_defineProperty$g(this,"_speeds",[])}return _createClass$h(e,[{key:"addRecord",value:function(e,t){e&&t&&(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(e,t){e&&t&&(this._chunkSpeeds.push(8e3*e/t),this._chunkSpeeds=this._chunkSpeeds.slice(-100))}},{key:"getAvgSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds.reduce((function(e,t){return e+t}))/this._speeds.length:this._chunkSpeeds.reduce((function(e,t){return e+t}))/this._chunkSpeeds.length:0}},{key:"getLatestSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]:0}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),e}();function _classCallCheck$f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$g(e,t,r){return t&&_defineProperties$g(e.prototype,t),r&&_defineProperties$g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$c(e,t)}function _getPrototypeOf$c(e){return(_getPrototypeOf$c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$c(e,t){return(_setPrototypeOf$c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$c(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$c(e)}function _createSuper$f(e){var t=_isNativeReflectConstruct$f();return function(){var r,n=_getPrototypeOf$c(e);if(t){var i=_getPrototypeOf$c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$c(this,r)}}function _slicedToArray$6(e,t){return _arrayWithHoles$6(e)||_iterableToArrayLimit$6(e,t)||_unsupportedIterableToArray$c(e,t)||_nonIterableRest$6()}function _toConsumableArray$8(e){return _arrayWithoutHoles$8(e)||_iterableToArray$8(e)||_unsupportedIterableToArray$c(e)||_nonIterableSpread$8()}function _arrayWithoutHoles$8(e){if(Array.isArray(e))return _arrayLikeToArray$c(e)}function _arrayWithHoles$6(e){if(Array.isArray(e))return e}function _iterableToArray$8(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$6(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$c(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$c(e,t):void 0}}function _arrayLikeToArray$c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$8(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$6(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var es_array_includes={},$$1O=_export$1,$includes$1=arrayIncludes$1.includes,fails$15=fails$1Q,addToUnscopables$6=addToUnscopables$a,BROKEN_ON_SPARSE=fails$15((function(){return!Array(1).includes()}));$$1O({target:"Array",proto:!0,forced:BROKEN_ON_SPARSE},{includes:function(e){return $includes$1(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$6("includes");var es_string_includes={},isRegExp$1=isRegexp$1,$TypeError$k=TypeError,notARegexp$1=function(e){if(isRegExp$1(e))throw $TypeError$k("The method doesn't accept regular expressions");return e},wellKnownSymbol$u=wellKnownSymbol$V,MATCH$2=wellKnownSymbol$u("match"),correctIsRegexpLogic$1=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[MATCH$2]=!1,"/./"[e](t)}catch(n){}}return!1},$$1N=_export$1,uncurryThis$19=functionUncurryThis$1,notARegExp$2=notARegexp$1,requireObjectCoercible$g=requireObjectCoercible$p,toString$B=toString$O,correctIsRegExpLogic$2=correctIsRegexpLogic$1,stringIndexOf$1=uncurryThis$19("".indexOf);$$1N({target:"String",proto:!0,forced:!correctIsRegExpLogic$2("includes")},{includes:function(e){return!!~stringIndexOf$1(toString$B(requireObjectCoercible$g(this)),toString$B(notARegExp$2(e)),arguments.length>1?arguments[1]:void 0)}});var TrackType$3={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType$3={AVC:"avc",HEVC:"hevc"},AudioCodecType$2={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},WarningType$1={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},VideoTrack$2=function(){function e(){_classCallCheck$f(this,e),_defineProperty$f(this,"id",1),_defineProperty$f(this,"type",TrackType$3.VIDEO),_defineProperty$f(this,"codecType",VideoCodecType$3.AVC),_defineProperty$f(this,"pid",-1),_defineProperty$f(this,"hvcC",void 0),_defineProperty$f(this,"codec",""),_defineProperty$f(this,"timescale",0),_defineProperty$f(this,"formatTimescale",0),_defineProperty$f(this,"sequenceNumber",0),_defineProperty$f(this,"baseMediaDecodeTime",0),_defineProperty$f(this,"baseDts",0),_defineProperty$f(this,"duration",0),_defineProperty$f(this,"warnings",[]),_defineProperty$f(this,"samples",[]),_defineProperty$f(this,"pps",[]),_defineProperty$f(this,"sps",[]),_defineProperty$f(this,"vps",[]),_defineProperty$f(this,"fpsNum",0),_defineProperty$f(this,"fpsDen",0),_defineProperty$f(this,"sarRatio",[]),_defineProperty$f(this,"width",0),_defineProperty$f(this,"height",0),_defineProperty$f(this,"nalUnitSize",4),_defineProperty$f(this,"present",!1),_defineProperty$f(this,"isVideoEncryption",!1),_defineProperty$f(this,"isAudioEncryption",!1),_defineProperty$f(this,"isVideo",!0),_defineProperty$f(this,"kid",null),_defineProperty$f(this,"pssh",null),_defineProperty$f(this,"ext",void 0)}return _createClass$g(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),e}(),AudioTrack$2=function(){function e(){_classCallCheck$f(this,e),_defineProperty$f(this,"id",2),_defineProperty$f(this,"type",TrackType$3.AUDIO),_defineProperty$f(this,"codecType",AudioCodecType$2.AAC),_defineProperty$f(this,"pid",-1),_defineProperty$f(this,"codec",""),_defineProperty$f(this,"sequenceNumber",0),_defineProperty$f(this,"sampleDuration",0),_defineProperty$f(this,"timescale",0),_defineProperty$f(this,"formatTimescale",0),_defineProperty$f(this,"baseMediaDecodeTime",0),_defineProperty$f(this,"duration",0),_defineProperty$f(this,"warnings",[]),_defineProperty$f(this,"samples",[]),_defineProperty$f(this,"baseDts",0),_defineProperty$f(this,"sampleSize",16),_defineProperty$f(this,"sampleRate",0),_defineProperty$f(this,"channelCount",0),_defineProperty$f(this,"objectType",0),_defineProperty$f(this,"sampleRateIndex",0),_defineProperty$f(this,"config",[]),_defineProperty$f(this,"present",!1),_defineProperty$f(this,"isVideoEncryption",!1),_defineProperty$f(this,"isAudioEncryption",!1),_defineProperty$f(this,"kid",null),_defineProperty$f(this,"ext",void 0)}return _createClass$g(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===AudioCodecType$2.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}}]),e}(),VideoSample$2=function(){function e(t,r,n){_classCallCheck$f(this,e),_defineProperty$f(this,"flag",{}),_defineProperty$f(this,"keyframe",!1),_defineProperty$f(this,"gopId",0),_defineProperty$f(this,"duration",0),_defineProperty$f(this,"size",0),_defineProperty$f(this,"units",[]),_defineProperty$f(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return _createClass$g(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),AudioSample$2=_createClass$g((function e(t,r,n,i){_classCallCheck$f(this,e),_defineProperty$f(this,"duration",1024),_defineProperty$f(this,"flag",{dependsOn:2,isNonSyncSample:0}),_defineProperty$f(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,this.sampleOffset=i,n&&(this.duration=n)})),Sample$1=_createClass$g((function e(t,r){_classCallCheck$f(this,e),_defineProperty$f(this,"time",0),this.data=t,this.originPts=this.pts=r})),FlvScriptSample=function(e){_inherits$c(r,e);var t=_createSuper$f(r);function r(){return _classCallCheck$f(this,r),t.apply(this,arguments)}return _createClass$g(r)}(Sample$1),SeiSample$1=function(e){_inherits$c(r,e);var t=_createSuper$f(r);function r(){return _classCallCheck$f(this,r),t.apply(this,arguments)}return _createClass$g(r)}(Sample$1),MetadataTrack$2=function(){function e(){_classCallCheck$f(this,e),_defineProperty$f(this,"id",3),_defineProperty$f(this,"type",TrackType$3.METADATA),_defineProperty$f(this,"timescale",0),_defineProperty$f(this,"flvScriptSamples",[]),_defineProperty$f(this,"seiSamples",[])}return _createClass$g(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),es_number_isFinite={},global$W=global$1v,globalIsFinite=global$W.isFinite,numberIsFinite$1=Number.isFinite||function(e){return"number"==typeof e&&globalIsFinite(e)},$$1M=_export$1,numberIsFinite=numberIsFinite$1;$$1M({target:"Number",stat:!0},{isFinite:numberIsFinite});var Logger$b=function(){function e(t){_classCallCheck$f(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$g(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$f(Logger$b,"disabled",!0);var isBrowser$4="undefined"!=typeof window,ua$3=isBrowser$4&&navigator.userAgent.toLocaleLowerCase(),isSafari$2=isBrowser$4&&/^((?!chrome|android).)*safari/.test(ua$3),isFirefox$3=isBrowser$4&&ua$3.includes("firefox"),isAndroid$3=isBrowser$4&&ua$3.includes("android"),AAC$3=function(){function e(){_classCallCheck$f(this,e)}return _createClass$g(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,l=e.FREQ[s];if(!l)throw new Error("Invalid sampling index: ".concat(s));for(var u,c,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,y=f.codec,m=0,g=e.getFrameDuration(l);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(c=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;u=2*(1&~t[i+1]),o.push({pts:r+m*g,data:t.subarray(i+7+u,i+c)}),m++,i+=c}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:l,objectType:d,channelCount:h,codec:y,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(a){var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return isFirefox$3?e>=6?(n=5,i=e-3):(n=2,i=e):isAndroid$3?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();_defineProperty$f(AAC$3,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var LARGE_AV_FIRST_FRAME_GAP$1=500,AUDIO_GAP_OVERLAP_THRESHOLD_COUNT$1=3,MAX_SILENT_FRAME_DURATION$1=1e3,AUDIO_EXCETION_LOG_EMIT_DURATION$1=5e3,MAX_VIDEO_FRAME_DURATION$1=1e3,MAX_DTS_DELTA_WITH_NEXT_CHUNK$1=200,VIDEO_EXCETION_LOG_EMIT_DURATION=5e3,TRACK_BREACKED_CHECK_TIME=5,FlvFixer=function(){function e(t,r,n){_classCallCheck$f(this,e),this.videoTrack=t,this.audioTrack=r,this.metadataTrack=n,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return _createClass$g(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(1e3*t);var i=this.videoTrack,a=this.audioTrack;!r&&n||(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),r&&!n&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(a,i),!n&&t&&(this._audioNextPts=this._videoNextDts=t);var o=this._baseDtsInited&&(this._videoTimestampBreak||!this.videoTrack.exist())&&(this._audioTimestampBreak||!this.audioTrack.exist());if(o&&this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._fixVideo(i),this.metadataTrack.exist()){var s=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/s})),this.metadataTrack.flvScriptSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/s}))}i.samples.length&&(i.baseMediaDecodeTime=i.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/1e3)}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){var n;if(r.forEach((function(e){e.dts-=t._baseDts,e.pts-=t._baseDts})),e.fpsNum&&e.fpsDen)n=e.timescale*(e.fpsDen/e.fpsNum);else{var i=e.samples[0],a=e.samples[r.length-1];n=Math.floor((a.dts-i.dts)/(r.length-1))}var o=r.pop();if(this._videoLastSample&&r.unshift(this._videoLastSample),this._videoLastSample=o,r.length){if(void 0===this._videoNextDts){var s=r[0];this._videoNextDts=s.dts}var l=r.length,u=0,c=r[0],d=this._videoNextDts-c.dts;if(Math.abs(d)>MAX_DTS_DELTA_WITH_NEXT_CHUNK$1){var h;if(Math.abs(c.dts-this._lastVideoExceptionChunkFirstDtsDot)>VIDEO_EXCETION_LOG_EMIT_DURATION)this._lastVideoExceptionChunkFirstDtsDot=c.dts,e.warnings.push({type:WarningType$1.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:c.dts,nextSampleDts:null===(h=r[1])||void 0===h?void 0:h.dts,sampleDuration:d});this._videoTimestampBreak>=TRACK_BREACKED_CHECK_TIME?(this._videoNextDts=c.dts,this._videoTimestampBreak=0):(c.dts+=d,c.pts+=d,this.audioTrack.exist()||(this._videoTimestampBreak=1))}for(var f=0;f<l;f++){var p=r[f].dts,y=r[f+1];((u=f<l-1?y.dts-p:o?o.dts-p:n)>MAX_VIDEO_FRAME_DURATION$1||u<0)&&(this._videoTimestampBreak++,Math.abs(p-this._lastVideoExceptionLargeGapDot)>VIDEO_EXCETION_LOG_EMIT_DURATION&&(this._lastVideoExceptionLargeGapDot=p,e.warnings.push({type:WarningType$1.LARGE_VIDEO_GAP,time:p/e.timescale,dts:p,originDts:r[f].originDts,nextDts:this._videoNextDts,sampleDuration:u,refSampleDuration:n})),u=n),r[f].duration=u,this._videoNextDts+=u}}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach((function(e){e.dts=e.pts-=t._baseDts})),this._doFixAudioInternal(e,r,1e3))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,a=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=a=n[0].dts),this._baseDts=Math.min(i,a);var o=a-i;return Number.isFinite(o)&&Math.abs(o)>LARGE_AV_FIRST_FRAME_GAP$1&&t.warnings.push({type:WarningType$1.LARGE_AV_SHIFT,videoBaseDts:a,audioBasePts:i,baseDts:this._baseDts,delta:o}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){this._calculateBaseDts(this.audioTrack,this.videoTrack)&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoLastSample=null,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=e.codecType===AudioCodecType$2.AAC?AAC$3.getFrameDuration(e.timescale,r):this._getG711Duration(e));var n=e.sampleDuration,i=e.codecType===AudioCodecType$2.AAC?1024:n*e.timescale/1e3;if(void 0===this._audioNextPts){var a=t[0];this._audioNextPts=a.pts}for(var o=0;o<t.length;o++){var s=this._audioNextPts,l=t[o],u=l.pts-s;if(0===o&&this._audioTimestampBreak>=TRACK_BREACKED_CHECK_TIME&&(s=this._audioNextPts=l.dts,u=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&u>=AUDIO_GAP_OVERLAP_THRESHOLD_COUNT$1*n&&u<=MAX_SILENT_FRAME_DURATION$1&&!isSafari$2){var c=this._getSilentFrame(e)||t[0].data.subarray(),d=Math.floor(u/n);Math.abs(l.pts-this._lastAudioExceptionGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION$1&&(this._lastAudioExceptionGapDot=l.pts,e.warnings.push({type:WarningType$1.AUDIO_FILLED,pts:l.pts,originPts:l.originPts,count:d,nextPts:s,refSampleDuration:n}));for(var h=0;h<d;h++){var f=new AudioSample$2(Math.floor(this._audioNextPts+n)-Math.floor(this._audioNextPts),c,i);f.originPts=Math.floor(this._baseDts+s),t.splice(o,0,f),this._audioNextPts+=n,o++}o--}else u<=-AUDIO_GAP_OVERLAP_THRESHOLD_COUNT$1*n&&u>=-1*MAX_SILENT_FRAME_DURATION$1?(Math.abs(l.pts-this._lastAudioExceptionOverlapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION$1&&(this._lastAudioExceptionOverlapDot=l.pts,e.warnings.push({type:WarningType$1.AUDIO_DROPPED,pts:l.pts,originPts:l.originPts,nextPts:s,refSampleDuration:n})),t.splice(o,1),o--):(Math.abs(u)>MAX_SILENT_FRAME_DURATION$1&&(this._audioTimestampBreak++,Math.abs(l.pts-this._lastAudioExceptionLargeGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION$1&&(this._lastAudioExceptionLargeGapDot=l.pts,e.warnings.push({type:WarningType$1.LARGE_AUDIO_GAP,time:l.pts/1e3,pts:l.pts,originPts:l.originPts,nextPts:s,sampleDuration:u,refSampleDuration:n}))),l.dts=l.pts=s,l.duration=i,this._audioNextPts+=n)}}},{key:"_getG711Duration",value:function(e){var t=e.sampleSize,r=e.channelCount,n=e.sampleRate,i=e.samples[0];if(i)return 2*i.data.byteLength/r/(t/8)/n*1e3}},{key:"_getSilentFrame",value:function(e){return e.codecType===AudioCodecType$2.AAC?AAC$3.getSilentFrame(e.codec,e.channelCount):new Uint8Array(8*e.sampleDuration*e.channelCount)}}]),e}();function concatUint8Array$4(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function readBig32$3(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function getAvcCodec$2(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}function parse$3(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))}var NALu$2=function(){function e(){_classCallCheck$f(this,e)}return _createClass$g(e,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!==e[r]&&void 0!==e[r]&&1!==e[r];)r++;if((n=++r+2)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],a=0;a+t<n;)if(r=readBig32$3(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseSEI",value:function(e,t){for(var r=e.length,n=t?2:1,i=0,a=0,o="";255===e[n];)i+=255,n++;for(i+=e[n++];255===e[n];)a+=255,n++;if(a+=e[n++],5===i&&r>n+16)for(var s=0;s<16;s++)o+=e[n].toString(16),n++;return{payload:e.subarray(n),type:i,size:a,uuid:o}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),ExpGolomb$2=function(){function e(t){if(_classCallCheck$f(this,e),_defineProperty$f(this,"_bytesAvailable",void 0),_defineProperty$f(this,"_bitsAvailable",0),_defineProperty$f(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return _createClass$g(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}}]),e}(),AVC$2=function(){function e(){_classCallCheck$f(this,e)}return _createClass$g(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,l=31&t[5],u=0;u<l;u++)if(n=t[s]<<8|t[s+1],s+=2,n){var c=t.subarray(s,s+n);s+=n,a.push(c),r||(r=e.parseSPS(NALu$2.removeEPB(c)))}var d,h=t[s];s++;for(var f=0;f<h;f++)d=t[s]<<8|t[s+1],s+=2,d&&(o.push(t.subarray(s,s+d)),s+=d);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new ExpGolomb$2(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,l=0;l<s;l++)t.readBool()&&(l<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var u=t.readUEG();if(0===u)t.readUEG();else if(1===u){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var c=t.readUEG(),d=0;d<c;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var y,m,g,v,b,_=0,E=0,T=0,S=0;if(t.readBool()&&(_=t.readUEG(),E=t.readUEG(),T=t.readUEG(),S=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var $=t.readBits(32),A=t.readBits(32);m=t.readBool(),b=(g=A)/(v=2*$)}}return{codec:getAvcCodec$2(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(h+1)-2*(_+E)),height:(2-p)*(f+1)*16-(p?2:4)*(T+S),sarRatio:y,fpsNum:g,fpsDen:v,fps:b,fixedFrame:m}}}]),e}(),HEVC$2=function(){function e(){_classCallCheck$f(this,e)}return _createClass$g(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var n,i,a,o,s,l=1+(3&t[21]),u=[],c=[],d=[],h=23,f=t[22],p=0;p<f;p++){a=63&t[h],o=t[h+1]<<8|t[h+2],h+=3;for(var y=0;y<o;y++)if(s=t[h]<<8|t[h+1],h+=2,s){switch(a){case 32:var m=t.subarray(h,h+s);n||(n=e.parseVPS(NALu$2.removeEPB(m),r)),d.push(m);break;case 33:var g=t.subarray(h,h+s);i||(i=e.parseSPS(NALu$2.removeEPB(g),r)),u.push(g);break;case 34:c.push(t.subarray(h,h+s))}h+=s}}return{hvcC:r,sps:i,spsArr:u,ppsArr:c,vpsArr:d,nalUnitSize:l}}}},{key:"parseVPS",value:function(t,r){r=r||{};var n=new ExpGolomb$2(t);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),n.readBits(17),e._parseProfileTierLevel(n,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||{};var n=new ExpGolomb$2(t);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,i,r),n.readUEG();var a=r.chromaFormatIdc=n.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var s=0;3===a&&(s=n.readBits(1));var l,u,c,d,h=n.readUEG(),f=n.readUEG(),p=n.readBits(1);if(1===p&&(l=n.readUEG(),u=n.readUEG(),c=n.readUEG(),d=n.readUEG()),r.bitDepthLumaMinus8=n.readUEG(),r.bitDepthChromaMinus8=n.readUEG(),1===p){var y=1!==a&&2!==a||0!==s?1:2,m=1===a&&0===s?2:1;h-=y*(u+l),f-=m*(d+c)}return{codec:"hev1.1.6.L93.B0",width:h,height:f,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var a=[],o=[],s=0;s<t;s++)a[s]=e.readBits(1),o[s]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var l=0;l<t;l++)0!==a[l]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[l]&&e.readBits(8)}}]),e}(),UTF8$1=function(){function e(){_classCallCheck$f(this,e)}return _createClass$g(e,null,[{key:"decode",value:function(t){for(var r=[],n=t,i=0,a=t.length;i<a;)if(n[i]<128)r.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(e._checkContinuation(n,i,1)){var o=(31&n[i])<<6|63&n[i+1];if(o>=128){r.push(String.fromCharCode(65535&o)),i+=2;continue}}}else if(n[i]<240){if(e._checkContinuation(n,i,2)){var s=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(s>=2048&&55296!=(63488&s)){r.push(String.fromCharCode(65535&s)),i+=3;continue}}}else if(n[i]<248&&e._checkContinuation(n,i,3)){var l=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(l>65536&&l<1114112){l-=65536,r.push(String.fromCharCode(l>>>10|55296)),r.push(String.fromCharCode(1023&l|56320)),i+=4;continue}}r.push(String.fromCharCode(65533)),++i}return r.join("")}},{key:"_checkContinuation",value:function(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return!1;return!0}return!1}}]),e}(),AMF$1=function(){function e(){_classCallCheck$f(this,e)}return _createClass$g(e,null,[{key:"parse",value:function(t){if(!(t.length<3)){var r={},n=e._parseValue(new DataView(t.buffer,t.byteOffset,t.byteLength)),i=e._parseValue(new DataView(t.buffer,t.byteOffset+n.size,t.byteLength-n.size));return r[n.data]=i.data,r}}},{key:"_parseValue",value:function(t){var r,n=t.byteLength,i=1,a=!1;switch(t.getUint8(0)){case 0:r=t.getFloat64(1),i+=8;break;case 1:r=!!t.getUint8(1),i+=1;break;case 2:var o=e._parseString(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i));r=o.data,i+=o.size;break;case 3:r={};var s=0;for(9==(16777215&t.getUint32(n-4))&&(s=3);i<n-4;){var l=e._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-s)),u=l.size,c=l.data;if(l.isEnd)break;r[c.name]=c.value,i+=u}if(i<=n-3)9===(16777215&t.getUint32(i-1))&&(i+=3);break;case 8:r={},i+=4;var d=0;for(9==(16777215&t.getUint32(n-4))&&(d=3);i<n-8;){var h=e._parseObject(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i-d)),f=h.size,p=h.data;if(h.isEnd)break;r[p.name]=p.value,i+=f}if(i<=n-3)9===(16777215&t.getUint32(i-1))&&(i+=3);break;case 9:r=void 0,i=1,a=!0;break;case 10:r=[];var y=t.getUint32(1);i+=4;for(var m=0;m<y;m++){var g=e._parseValue(new DataView(t.buffer,t.byteOffset+i,t.byteLength-i)),v=g.data,b=g.size;r.push(v),i+=b}break;case 11:var _=t.getFloat64(i)+6e4*t.getInt16(i+8);r=new Date(_),i+=10;break;case 12:var E=t.getUint32(1);i+=4,r="",E>0&&(r=UTF8$1.decode(new Uint8Array(t.buffer,t.byteOffset+i,E))),i+=E;break;default:i=n}return{data:r,size:i,isEnd:a}}},{key:"_parseString",value:function(e){var t=e.getUint16(0),r="";return t>0&&(r=UTF8$1.decode(new Uint8Array(e.buffer,e.byteOffset+2,t))),{data:r,size:2+t}}},{key:"_parseObject",value:function(t){if(!(t.byteLength<3)){var r=e._parseString(t),n=e._parseValue(new DataView(t.buffer,t.byteOffset+r.size,t.byteLength-r.size));return{data:{name:r.data,value:n.data},size:r.size+n.size,isEnd:n.isEnd}}}}]),e}(),logger$8=new Logger$b("FlvDemuxer"),FlvDemuxer=function(){function e(t,r,n){_classCallCheck$f(this,e),_defineProperty$f(this,"_headerParsed",!1),_defineProperty$f(this,"_remainingData",null),_defineProperty$f(this,"_gopId",0),_defineProperty$f(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=t||new VideoTrack$2,this.audioTrack=r||new AudioTrack$2,this.metadataTrack=n||new MetadataTrack$2,this._fixer=new FlvFixer(this.videoTrack,this.audioTrack,this.metadataTrack)}return _createClass$g(e,[{key:"demux",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this.audioTrack,a=this.videoTrack,o=this.metadataTrack;if(!r&&n||(this._remainingData=null,this._headerParsed=!1),r?(a.reset(),i.reset(),o.reset()):(a.samples=[],i.samples=[],o.seiSamples=[],o.flvScriptSamples=[],a.warnings=[],i.warnings=[],this._remainingData&&(t=concatUint8Array$4(this._remainingData,t),this._remainingData=null)),!t.length)return{videoTrack:a,audioTrack:i,metadataTrack:o};var s=0;if(!this._headerParsed){if(!e.probe(t))throw new Error("Invalid flv file");i.present=(4&t[4])>>>2!=0,a.present=0!=(1&t[4]),this._headerParsed=!0,s=readBig32$3(t,5)+4}for(var l,u,c,d,h,f=t.length;s+15<f&&(l=t[s],!(s+15+(u=t[s+1]<<16|t[s+2]<<8|t[s+3])>f));)c=(t[s+7]<<24>>>0)+(t[s+4]<<16)+(t[s+5]<<8)+t[s+6],s+=11,d=t.subarray(s,s+u),8===l?this._parseAudio(d,c):9===l?this._parseVideo(d,c):18===l?this._parseScript(d,c):logger$8.warn("Invalid tag type: ".concat(l)),(h=readBig32$3(t,s+=u))!==11+u&&logger$8.warn("Invalid PrevTagSize ".concat(h," (").concat(11+u,")")),s+=4;return s<f&&(this._remainingData=t.subarray(s)),i.formatTimescale=a.formatTimescale=a.timescale=o.timescale=1e3,i.timescale=i.sampleRate||0,!i.exist()&&i.hasSample()&&i.reset(),!a.exist()&&a.hasSample()&&a.reset(),{videoTrack:a,audioTrack:i,metadataTrack:o}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseAudio",value:function(t,r){if(t.length){var n=(240&t[0])>>>4,i=this.audioTrack;if(10!==n&&7!==n&&8!==n)return logger$8.warn("Unsupported sound format: ".concat(n)),void i.reset();if(10!==n){var a=(12&t[0])>>2,o=(2&t[0])>>1,s=1&t[0];i.sampleRate=e.AUDIO_RATE[a],i.sampleSize=o?16:8,i.channelCount=s+1}10===n?this._parseAac(t,r):this._parseG711(t,r,n)}}},{key:"_parseG711",value:function(e,t,r){var n=this.audioTrack;n.codecType=7===r?AudioCodecType$2.G711PCMA:AudioCodecType$2.G711PCMU,n.sampleRate=8e3,n.codec=n.codecType,n.samples.push(new AudioSample$2(t,e.subarray(1)))}},{key:"_parseAac",value:function(e,t){var r=this.audioTrack;if(r.codecType=AudioCodecType$2.AAC,0===e[1]){var n=AAC$3.parseAudioSpecificConfig(e.subarray(2));n?(r.codec=n.codec,r.channelCount=n.channelCount,r.sampleRate=n.sampleRate,r.config=n.config,r.objectType=n.objectType,r.sampleRateIndex=n.samplingFrequencyIndex):(r.reset(),logger$8.warn("Cannot parse AudioSpecificConfig",e))}else if(1===e[1]){if(null==t)return;r.samples.push(new AudioSample$2(t,e.subarray(2)))}else logger$8.warn("Unknown AACPacketType: ".concat(e[1]))}},{key:"_parseVideo",value:function(e,t){var r=this;if(!(e.length<6)){var n=(240&e[0])>>>4,i=15&e[0],a=this.videoTrack;if(7!==i&&12!==i)return a.reset(),void logger$8.warn("Unsupported codecId: ".concat(i));var o=12===i;a.codecType=o?VideoCodecType$3.HEVC:VideoCodecType$3.AVC;var s=e[1],l=(e[2]<<16|e[3]<<8|e[4])<<8>>8;if(0===s){var u=e.subarray(5),c=o?HEVC$2.parseHEVCDecoderConfigurationRecord(u):AVC$2.parseAVCDecoderConfigurationRecord(u);if(c){var d=c.hvcC,h=c.sps,f=c.ppsArr,p=c.spsArr,y=c.vpsArr,m=c.nalUnitSize;d&&(a.hvcC=a.hvcC||d),h&&(a.codec=h.codec,a.width=h.width,a.height=h.height,a.sarRatio=h.sarRatio,a.fpsNum=h.fpsNum,a.fpsDen=h.fpsDen),p.length&&(a.sps=p),f.length&&(a.pps=f),y&&y.length&&(a.vps=y),m&&(a.nalUnitSize=m)}else logger$8.warn("Cannot parse ".concat(o?"HEVC":"AVC","DecoderConfigurationRecord"),e)}else if(1===s){var g=NALu$2.parseAvcC(e.subarray(5),a.nalUnitSize);if((g=this._checkAddMetaNalToUnits(o,g,a))&&g.length){var v=new VideoSample$2(t+l,t,g);1===n&&v.setToKeyframe(),a.samples.push(v),g.forEach((function(e){var n=o?e[0]>>>1&63:31&e[0];switch(n){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!o&&5!==n||o&&5===n)break;v.setToKeyframe();break;case 6:case 39:case 40:if(!o&&6!==n||o&&6===n)break;r.metadataTrack.seiSamples.push(new SeiSample$1(NALu$2.parseSEI(NALu$2.removeEPB(e),o),t+l))}})),v.keyframe&&this._gopId++,v.gopId=this._gopId}else logger$8.warn("Cannot parse NALUs",e)}else 2===s||logger$8.warn("Unknown AVCPacketType: ".concat(s))}}},{key:"_checkAddMetaNalToUnits",value:function(e,t,r){return e&&this._needAddMetaBeforeKeyFrameNal?t.map((function(e){return e[0]>>>1&63})).includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,t):(t.unshift(r.pps[0]),t.unshift(r.sps[0]),t.unshift(r.vps[0]),t.filter(Boolean)):(this._needAddMetaBeforeKeyFrameNal=!1,t)}},{key:"_parseScript",value:function(e,t){this.metadataTrack.flvScriptSamples.push(new FlvScriptSample(AMF$1.parse(e),t))}}],[{key:"probe",value:function(e){return 70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]&&readBig32$3(e,5)>=9}}]),e}();_defineProperty$f(FlvDemuxer,"AUDIO_RATE",[5500,11e3,22e3,44e3]);var es_regexp_flags={},global$V=global$1v,DESCRIPTORS$C=descriptors$1,defineBuiltInAccessor$5=defineBuiltInAccessor$8,regExpFlags$2=regexpFlags$3,fails$14=fails$1Q,RegExp$3=global$V.RegExp,RegExpPrototype$4=RegExp$3.prototype,FORCED$l=DESCRIPTORS$C&&fails$14((function(){var e=!0;try{RegExp$3(".","d")}catch(error){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(a.hasIndices="d"),a)i(o,a[o]);return Object.getOwnPropertyDescriptor(RegExpPrototype$4,"flags").get.call(t)!==n||r!==n}));FORCED$l&&defineBuiltInAccessor$5(RegExpPrototype$4,"flags",{configurable:!0,get:regExpFlags$2});var es_string_padStart={},uncurryThis$18=functionUncurryThis$1,toLength$d=toLength$m,toString$A=toString$O,$repeat$2=stringRepeat$1,requireObjectCoercible$f=requireObjectCoercible$p,repeat$4=uncurryThis$18($repeat$2),stringSlice$f=uncurryThis$18("".slice),ceil$2=Math.ceil,createMethod$9=function(e){return function(t,r,n){var i,a,o=toString$A(requireObjectCoercible$f(t)),s=toLength$d(r),l=o.length,u=void 0===n?" ":toString$A(n);return s<=l||""==u?o:((a=repeat$4(u,ceil$2((i=s-l)/u.length))).length>i&&(a=stringSlice$f(a,0,i)),e?o+a:a+o)}},stringPad$1={start:createMethod$9(!1),end:createMethod$9(!0)},userAgent$9=engineUserAgent$1,stringPadWebkitBug$1=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(userAgent$9),$$1L=_export$1,$padStart$1=stringPad$1.start,WEBKIT_BUG$1=stringPadWebkitBug$1;$$1L({target:"String",proto:!0,forced:WEBKIT_BUG$1},{padStart:function(e){return $padStart$1(this,e,arguments.length>1?arguments[1]:void 0)}});var es_array_from={},$$1K=_export$1,from=arrayFrom$3,checkCorrectnessOfIteration$3=checkCorrectnessOfIteration$7,INCORRECT_ITERATION=!checkCorrectnessOfIteration$3((function(e){Array.from(e)}));$$1K({target:"Array",stat:!0,forced:INCORRECT_ITERATION},{from:from});var es_arrayBuffer_constructor={},$$1J=_export$1,global$U=global$1v,arrayBufferModule$1=arrayBuffer$1,setSpecies$4=setSpecies$9,ARRAY_BUFFER$2="ArrayBuffer",ArrayBuffer$6=arrayBufferModule$1[ARRAY_BUFFER$2],NativeArrayBuffer$2=global$U[ARRAY_BUFFER$2];function Concat$2(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];n.forEach((function(e){t+=e.length}));var a=new e(t),o=0;return n.forEach((function(e){a.set(e,o),o+=e.length})),a}$$1J({global:!0,constructor:!0,forced:NativeArrayBuffer$2!==ArrayBuffer$6},{ArrayBuffer:ArrayBuffer$6}),setSpecies$4(ARRAY_BUFFER$2);var Buffer$4=function(){function e(){_classCallCheck$f(this,e),this.buffer=new Uint8Array(0)}return _createClass$g(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){t?e.buffer=Concat$2(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),UINT32_MAX$3=Math.pow(2,32)-1,MP4$4=function(){function e(){_classCallCheck$f(this,e)}return _createClass$g(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType$3.VIDEO&&e.codecType===VideoCodecType$3.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array$4(e.ftyp(t),e.moov(t))}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],parse$3(t.kid),[0,0,0,0]));return e.box(e.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(_toConsumableArray$8(t.map((function(t){return e.trak(t)}))),[r]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(_toConsumableArray$8(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]));return a}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]));return n}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType$3.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){var r=[];return t&&t.ext&&t.ext.stss&&r.push(e.stss(t.ext.stss.entries)),e.box(e.types.stbl,e.stsd(t),e.STTS,r[0],e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){var r;return r="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):e.avc1hev1(t),e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r)}},{key:"enca",value:function(t){var r=t.enca.channelCount,n=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,i,a,o)}},{key:"encv",value:function(t){var r,n,i=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],o=t.width,s=t.height,l=t.sarRatio[0],u=t.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((r=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(n,_toConsumableArray$8(i)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(r,_toConsumableArray$8(a))),h=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u]);return e.box(e.types.encv,c,e.box(e.types.avcC,d),e.box(e.types.btrt,h),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var r=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,r,n)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(parse$3(t.default_KID)));return e.box(e.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,r,e.box(e.types.frma,n),e.box(e.types.schm,i),a)}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType$3.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n,i,a=[],o=[];return t.sps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,_toConsumableArray$8(e))})),t.pps.forEach((function(e){i=e.byteLength,o.push(i>>>8&255),o.push(255&i),o.push.apply(o,_toConsumableArray$8(e))})),e.box(e.types.avcC,new Uint8Array((r=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(r,o)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,l=r.generalConstraintIndicatorFlags,u=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,l[0],l[1],l[2],l[3],l[4],l[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,u];var c=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,_toConsumableArray$8(e))};i.length&&(n.push(160,0,i.length),i.forEach(c)),a.length&&(n.push(161,0,a.length),a.forEach(c)),o.length&&(n.push(162,0,o.length),o.forEach(c))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=_slicedToArray$6(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(_toConsumableArray$8(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(t){return e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(_toConsumableArray$8(t.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){var r=e.tfhd(t.id),n=e.tfdt(t,t.baseMediaDecodeTime),i=0;if(t.isVideo&&t.videoSenc&&t.videoSenc.forEach((function(e){i+=8,e.subsamples&&e.subsamples.length&&(i+=2,i+=6*e.subsamples.length)})),t.videoSencLength=i,t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(t.isVideo){var a=e.saiz(t),o=e.saio(t),s=e.trun1(t),l=e.senc(t);return e.box(e.types.traf,r,n,a,o,s,l)}if(t.isAudioEncryption){var u=e.sbgp(),c=e.saiz(t),d=e.saio(t),h=e.senc(t),f=e.trun1(t);return e.box(e.types.traf,r,n,u,c,d,h,f)}var p=e.sbgp(),y=e.trun1(t);return e.box(e.types.traf,r,n,p,y)}if(t.isVideo){var m=e.trun1(t);return e.box(e.types.traf,r,n,m)}var g=e.sbgp(),v=e.saiz(t),b=e.saio(t),_=e.senc(t),E=e.trun1(t);return e.box(e.types.traf,r,n,g,v,b,_,E)}var T=e.sdtp(t);return e.box(e.types.traf,r,n,T,e.trun(t.samples,T.byteLength+76))}},{key:"sdtp",value:function(t){var r=new Buffer$4;return t.samples.forEach((function(e){r.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Buffer$4,n=Buffer$4.writeUint32(t.samples.length),i=null;if(t.isVideo){var a=t.videoSencLength;i=Buffer$4.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Buffer$4.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),i=Buffer$4.writeUint32(o)}return t.samples.forEach((function(e){r.write(Buffer$4.writeUint32(e.duration)),r.write(Buffer$4.writeUint32(e.size)),r.write(Buffer$4.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&r.write(Buffer$4.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(t){var r=new Buffer$4,n=t.samples.length,i=t.isVideo?16:8,a=t.isVideo?2:0,o=[],s=0;return t.isVideo?(o=t.videoSenc,s=t.videoSencLength):o=t.audioSenc,s=s||i*n,r.write(Buffer$4.writeUint32(16+s),e.types.senc,this.extension(0,a)),r.write(Buffer$4.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(Buffer$4.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){r.write(Buffer$4.writeUint16(e.BytesOfClearData)),r.write(Buffer$4.writeUint32(e.BytesOfProtectedData))})))})),r.buffer}},{key:"saio",value:function(t){var r=12*t.samples.length+141;!t.isVideo&&t.isAudioEncryption&&(r=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var r=t.samples.length,n=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,r){var n=Math.floor(r/(UINT32_MAX$3+1)),i=Math.floor(r%(UINT32_MAX$3+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],l=s.duration,u=s.size,c=s.flag,d=void 0===c?{}:c,h=s.cts,f=void 0===h?0:h;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,d.isLeading<<2|(null===d.dependsOn||void 0===d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null===d.isNonSyncSample||void 0===d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$8(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType$3.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array$4(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array$4(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,n=t.samples[0].duration,i=n*t.samples.length,a=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var s=0;if(t.isVideo){var l,u=0;t.videoSenc&&(l=t.videoSenc),t.isVideo&&l.forEach((function(e){u+=8,e.subsamples&&e.subsamples.length&&(u+=2,u+=6*e.subsamples.length)})),t.videoSencLength=u,s=o+141+16*t.samples.length+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(s=o+16*t.samples.length+84)}else s=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(s=o+169+12*t.samples.length+8*t.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,255&t.id,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,c)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();_defineProperty$f(MP4$4,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty$f(MP4$4,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty$f(MP4$4,"FTYPAVC1",MP4$4.box(MP4$4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty$f(MP4$4,"FTYPHEV1",MP4$4.box(MP4$4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty$f(MP4$4,"DINF",MP4$4.box(MP4$4.types.dinf,MP4$4.box(MP4$4.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty$f(MP4$4,"VMHD",MP4$4.box(MP4$4.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty$f(MP4$4,"SMHD",MP4$4.box(MP4$4.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty$f(MP4$4,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty$f(MP4$4,"STTS",MP4$4.box(MP4$4.types.stts,MP4$4.StblTable)),_defineProperty$f(MP4$4,"STSC",MP4$4.box(MP4$4.types.stsc,MP4$4.StblTable)),_defineProperty$f(MP4$4,"STSZ",MP4$4.box(MP4$4.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty$f(MP4$4,"STCO",MP4$4.box(MP4$4.types.stco,MP4$4.StblTable));var Logger$a=function(){function e(t,r){_classCallCheck$f(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=r}return _createClass$g(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$f(Logger$a,"disabled",!0);for(var FMP4Remuxer$3=function(){function e(t,r,n){_classCallCheck$f(this,e),this.videoTrack=t,this.audioTrack=r;var i=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=i&&Number(i[1])<50,this.log=new Logger$a("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return _createClass$g(e,[{key:"remux",value:function(){var e,t,r,n,i,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.videoTrack,l=this.audioTrack,u=s.exist(),c=l.exist(),d=[];return a&&(o&&o.initMerge?(u&&d.push(this.videoTrack),c&&d.push(this.audioTrack),r=MP4$4.initSegment(d)):(u&&(e=MP4$4.initSegment([this.videoTrack])),c&&(t=MP4$4.initSegment([this.audioTrack])))),u&&s.hasSample()&&(n=this._remuxVideo()),c&&l.hasSample()&&(i=this._remuxAudio()),s.samples=[],l.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var l=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,l+=4+e.byteLength})),s.size=l,u=o,n=s},s=0,l=t.length,u=0;s<l;s++)o(s,0,u,n);var c=MP4$4.mdat(i);return concatUint8Array$4(MP4$4.moof([e]),c)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,r){return t.set(r.data,e),e+r.size}),0);var r=MP4$4.mdat(t);return concatUint8Array$4(MP4$4.moof([e]),r)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),Base=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,[{key:"mixIn",value:function(e){return Object.assign(this,e)}},{key:"clone",value:function(){var e=new this.constructor;return Object.assign(e,this),e}}],[{key:"create",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return _construct$6(this,t)}}]),e}(),WordArray=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4*n.length;_classCallCheck$j(this,r),e=t.call(this);var a=n;if(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),(a instanceof Int8Array||a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array)&&(a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),a instanceof Uint8Array){for(var o=a.byteLength,s=[],l=0;l<o;l+=1)s[l>>>2]|=a[l]<<24-l%4*8;e.words=s,e.sigBytes=o}else e.words=n,e.sigBytes=i;return e}return _createClass$k(r,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Hex;return e.stringify(this)}},{key:"concat",value:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var a=0;a<i;a+=1){var o=r[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this}},{key:"clamp",value:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}},{key:"clone",value:function(){var e=_get$4(_getPrototypeOf$g(r.prototype),"clone",this).call(this);return e.words=this.words.slice(0),e}}],[{key:"random",value:function(e){for(var t,n=[],i=function(e){var t=e,r=987654321,n=4294967295;return function(){var e=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return e/=4294967296,(e+=.5)*(Math.random()>.5?1:-1)}},a=0;a<e;a+=4){var o=i(4294967296*(t||Math.random()));t=987654071*o(),n.push(4294967296*o()|0)}return new r(n,e)}}]),r}(Base),Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=1){var a=t[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new WordArray(r,t/2)}},Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=1){var a=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=1)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new WordArray(r,t)}},Utf8={stringify:function(t){try{return decodeURIComponent(escape(Latin1.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return Latin1.parse(unescape(encodeURIComponent(e)))}},BufferedBlockAlgorithm=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){var e;return _classCallCheck$j(this,r),(e=t.call(this))._minBufferSize=0,e}return _createClass$k(r,[{key:"reset",value:function(){this._data=new WordArray,this._nDataBytes=0}},{key:"_append",value:function(e){var t=e;"string"==typeof t&&(t=Utf8.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}},{key:"_process",value:function(e){var t,r=this._data,n=this.blockSize,i=r.words,a=r.sigBytes,o=a/(4*n),s=(o=e?Math.ceil(o):Math.max((0|o)-this._minBufferSize,0))*n,l=Math.min(4*s,a);if(s){for(var u=0;u<s;u+=n)this._doProcessBlock(i,u);t=i.splice(0,s),r.sigBytes-=l}return new WordArray(t,l)}},{key:"clone",value:function(){var e=_get$4(_getPrototypeOf$g(r.prototype),"clone",this).call(this);return e._data=this._data.clone(),e}}]),r}(Base),Hasher=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this)).blockSize=16,n.cfg=Object.assign(new Base,e),n.reset(),n}return _createClass$k(r,[{key:"reset",value:function(){_get$4(_getPrototypeOf$g(r.prototype),"reset",this).call(this),this._doReset()}},{key:"update",value:function(e){return this._append(e),this._process(),this}},{key:"finalize",value:function(e){return e&&this._append(e),this._doFinalize()}}],[{key:"_createHelper",value:function(e){return function(t,r){return new e(r).finalize(t)}}},{key:"_createHmacHelper",value:function(e){return function(t,r){return new HMAC(e,r).finalize(t)}}}]),r}(BufferedBlockAlgorithm),HMAC=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e,n){var i;_classCallCheck$j(this,r),i=t.call(this);var a=new e;i._hasher=a;var o=n;"string"==typeof o&&(o=Utf8.parse(o));var s=a.blockSize,l=4*s;o.sigBytes>l&&(o=a.finalize(n)),o.clamp();var u=o.clone();i._oKey=u;var c=o.clone();i._iKey=c;for(var d=u.words,h=c.words,f=0;f<s;f+=1)d[f]^=1549556828,h[f]^=909522486;return u.sigBytes=l,c.sigBytes=l,i.reset(),i}return _createClass$k(r,[{key:"reset",value:function(){var e=this._hasher;e.reset(),e.update(this._iKey)}},{key:"update",value:function(e){return this._hasher.update(e),this}},{key:"finalize",value:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}}]),r}(Base),parseLoop=function(e,t,r){for(var n=[],i=0,a=0;a<t;a+=1)if(a%4){var o=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;n[i>>>2]|=o<<24-i%4*8,i+=1}return WordArray.create(n,i)},Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],a=0;a<r;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<r;s+=1)i.push(n.charAt(o>>>6*(3-s)&63));var l=n.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){this._reverseMap=[],n=this._reverseMap;for(var i=0;i<r.length;i+=1)n[r.charCodeAt(i)]=i}var a=r.charAt(64);if(a){var o=e.indexOf(a);-1!==o&&(t=o)}return parseLoop(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},T=[],i$1=0;i$1<64;i$1+=1)T[i$1]=4294967296*Math.abs(Math.sin(i$1+1))|0;var FF$2=function(e,t,r,n,i,a,o){var s=e+(t&r|~t&n)+i+o;return(s<<a|s>>>32-a)+t},GG=function(e,t,r,n,i,a,o){var s=e+(t&n|r&~n)+i+o;return(s<<a|s>>>32-a)+t},HH=function(e,t,r,n,i,a,o){var s=e+(t^r^n)+i+o;return(s<<a|s>>>32-a)+t},II=function(e,t,r,n,i,a,o){var s=e+(r^(t|~n))+i+o;return(s<<a|s>>>32-a)+t},MD5Algo=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"_doReset",value:function(){this._hash=new WordArray([1732584193,4023233417,2562383102,271733878])}},{key:"_doProcessBlock",value:function(e,t){for(var r=e,n=0;n<16;n+=1){var i=t+n,a=e[i];r[i]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var o=this._hash.words,s=r[t+0],l=r[t+1],u=r[t+2],c=r[t+3],d=r[t+4],h=r[t+5],f=r[t+6],p=r[t+7],y=r[t+8],m=r[t+9],g=r[t+10],v=r[t+11],b=r[t+12],_=r[t+13],E=r[t+14],S=r[t+15],$=o[0],A=o[1],w=o[2],k=o[3];$=FF$2($,A,w,k,s,7,T[0]),k=FF$2(k,$,A,w,l,12,T[1]),w=FF$2(w,k,$,A,u,17,T[2]),A=FF$2(A,w,k,$,c,22,T[3]),$=FF$2($,A,w,k,d,7,T[4]),k=FF$2(k,$,A,w,h,12,T[5]),w=FF$2(w,k,$,A,f,17,T[6]),A=FF$2(A,w,k,$,p,22,T[7]),$=FF$2($,A,w,k,y,7,T[8]),k=FF$2(k,$,A,w,m,12,T[9]),w=FF$2(w,k,$,A,g,17,T[10]),A=FF$2(A,w,k,$,v,22,T[11]),$=FF$2($,A,w,k,b,7,T[12]),k=FF$2(k,$,A,w,_,12,T[13]),w=FF$2(w,k,$,A,E,17,T[14]),A=FF$2(A,w,k,$,S,22,T[15]),$=GG($,A,w,k,l,5,T[16]),k=GG(k,$,A,w,f,9,T[17]),w=GG(w,k,$,A,v,14,T[18]),A=GG(A,w,k,$,s,20,T[19]),$=GG($,A,w,k,h,5,T[20]),k=GG(k,$,A,w,g,9,T[21]),w=GG(w,k,$,A,S,14,T[22]),A=GG(A,w,k,$,d,20,T[23]),$=GG($,A,w,k,m,5,T[24]),k=GG(k,$,A,w,E,9,T[25]),w=GG(w,k,$,A,c,14,T[26]),A=GG(A,w,k,$,y,20,T[27]),$=GG($,A,w,k,_,5,T[28]),k=GG(k,$,A,w,u,9,T[29]),w=GG(w,k,$,A,p,14,T[30]),A=GG(A,w,k,$,b,20,T[31]),$=HH($,A,w,k,h,4,T[32]),k=HH(k,$,A,w,y,11,T[33]),w=HH(w,k,$,A,v,16,T[34]),A=HH(A,w,k,$,E,23,T[35]),$=HH($,A,w,k,l,4,T[36]),k=HH(k,$,A,w,d,11,T[37]),w=HH(w,k,$,A,p,16,T[38]),A=HH(A,w,k,$,g,23,T[39]),$=HH($,A,w,k,_,4,T[40]),k=HH(k,$,A,w,s,11,T[41]),w=HH(w,k,$,A,c,16,T[42]),A=HH(A,w,k,$,f,23,T[43]),$=HH($,A,w,k,m,4,T[44]),k=HH(k,$,A,w,b,11,T[45]),w=HH(w,k,$,A,S,16,T[46]),A=HH(A,w,k,$,u,23,T[47]),$=II($,A,w,k,s,6,T[48]),k=II(k,$,A,w,p,10,T[49]),w=II(w,k,$,A,E,15,T[50]),A=II(A,w,k,$,h,21,T[51]),$=II($,A,w,k,b,6,T[52]),k=II(k,$,A,w,c,10,T[53]),w=II(w,k,$,A,g,15,T[54]),A=II(A,w,k,$,l,21,T[55]),$=II($,A,w,k,y,6,T[56]),k=II(k,$,A,w,S,10,T[57]),w=II(w,k,$,A,f,15,T[58]),A=II(A,w,k,$,_,21,T[59]),$=II($,A,w,k,d,6,T[60]),k=II(k,$,A,w,v,10,T[61]),w=II(w,k,$,A,u,15,T[62]),A=II(A,w,k,$,m,21,T[63]),o[0]=o[0]+$|0,o[1]=o[1]+A|0,o[2]=o[2]+w|0,o[3]=o[3]+k|0}},{key:"_doFinalize",value:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32;var i=Math.floor(r/4294967296),a=r;t[15+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),t[14+(n+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=this._hash,s=o.words,l=0;l<4;l+=1){var u=s[l];s[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return o}},{key:"clone",value:function(){var e=_get$4(_getPrototypeOf$g(r.prototype),"clone",this).call(this);return e._hash=this._hash.clone(),e}}]),r}(Hasher);Hasher._createHelper(MD5Algo),Hasher._createHmacHelper(MD5Algo);var EvpKDFAlgo=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this)).cfg=Object.assign(new Base,{keySize:4,hasher:MD5Algo,iterations:1},e),n}return _createClass$k(r,[{key:"compute",value:function(e,t){for(var r,n=this.cfg,i=n.hasher.create(),a=WordArray.create(),o=a.words,s=n.keySize,l=n.iterations;o.length<s;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var u=1;u<l;u+=1)r=i.finalize(r),i.reset();a.concat(r)}return a.sigBytes=4*s,a}}]),r}(Base),Cipher=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e,n,i){var a;return _classCallCheck$j(this,r),(a=t.call(this)).cfg=Object.assign(new Base,i),a._xformMode=e,a._key=n,a.reset(),a}return _createClass$k(r,[{key:"reset",value:function(){_get$4(_getPrototypeOf$g(r.prototype),"reset",this).call(this),this._doReset()}},{key:"process",value:function(e){return this._append(e),this._process()}},{key:"finalize",value:function(e){return e&&this._append(e),this._doFinalize()}}],[{key:"createEncryptor",value:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)}},{key:"createDecryptor",value:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)}},{key:"_createHelper",value:function(e){var t=function(e){return"string"==typeof e?PasswordBasedCipher:SerializableCipher};return{encrypt:function(r,n,i){return t(n).encrypt(e,r,n,i)},decrypt:function(r,n,i){return t(n).decrypt(e,r,n,i)}}}}]),r}(BufferedBlockAlgorithm);Cipher._ENC_XFORM_MODE=1,Cipher._DEC_XFORM_MODE=2,Cipher.keySize=4,Cipher.ivSize=4;var BlockCipherMode=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e,n){var i;return _classCallCheck$j(this,r),(i=t.call(this))._cipher=e,i._iv=n,i}return _createClass$k(r,null,[{key:"createEncryptor",value:function(e,t){return this.Encryptor.create(e,t)}},{key:"createDecryptor",value:function(e,t){return this.Decryptor.create(e,t)}}]),r}(Base);function xorBlock(e,t,r){var n,i=e,a=this._iv;a?(n=a,this._iv=void 0):n=this._prevBlock;for(var o=0;o<r;o+=1)i[t+o]^=n[o]}var CBC=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r)}(BlockCipherMode);CBC.Encryptor=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"processBlock",value:function(e,t){var r=this._cipher,n=r.blockSize;xorBlock.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}]),r}(CBC),CBC.Decryptor=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"processBlock",value:function(e,t){var r=this._cipher,n=r.blockSize,i=e.slice(t,t+n);r.decryptBlock(e,t),xorBlock.call(this,e,t,n),this._prevBlock=i}}]),r}(CBC);var Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,a=[],o=0;o<n;o+=4)a.push(i);var s=WordArray.create(a,n);e.concat(s)},unpad:function(e){var t=e,r=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=r}},BlockCipher=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e,n,i){var a;return _classCallCheck$j(this,r),(a=t.call(this,e,n,Object.assign({mode:CBC,padding:Pkcs7},i))).blockSize=4,a}return _createClass$k(r,[{key:"reset",value:function(){var e;_get$4(_getPrototypeOf$g(r.prototype),"reset",this).call(this);var t=this.cfg,n=t.iv,i=t.mode;this._xformMode===this.constructor._ENC_XFORM_MODE?e=i.createEncryptor:(e=i.createDecryptor,this._minBufferSize=1),this._mode=e.call(i,this,n&&n.words),this._mode.__creator=e}},{key:"_doProcessBlock",value:function(e,t){this._mode.processBlock(e,t)}},{key:"_doFinalize",value:function(){var e,t=this.cfg.padding;return this._xformMode===this.constructor._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e}}]),r}(Cipher),CipherParams=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this)).mixIn(e),n}return _createClass$k(r,[{key:"toString",value:function(e){return(e||this.formatter).stringify(this)}}]),r}(Base),OpenSSLFormatter={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?WordArray.create([1398893684,1701076831]).concat(r).concat(t):t).toString(Base64)},parse:function(e){var t,r=Base64.parse(e),n=r.words;return 1398893684===n[0]&&1701076831===n[1]&&(t=WordArray.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),CipherParams.create({ciphertext:r,salt:t})}},SerializableCipher=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,null,[{key:"encrypt",value:function(e,t,r,n){var i=Object.assign(new Base,this.cfg,n),a=e.createEncryptor(r,i),o=a.finalize(t),s=a.cfg;return CipherParams.create({ciphertext:o,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:a.blockSize,formatter:i.format})}},{key:"decrypt",value:function(e,t,r,n){var i=t,a=Object.assign(new Base,this.cfg,n);return i=this._parse(i,a.format),e.createDecryptor(r,a).finalize(i.ciphertext)}},{key:"_parse",value:function(e,t){return"string"==typeof e?t.parse(e,this):e}}]),r}(Base);SerializableCipher.cfg=Object.assign(new Base,{format:OpenSSLFormatter});var OpenSSLKdf={execute:function(e,t,r,n){var i=n;i||(i=WordArray.random(8));var a=EvpKDFAlgo.create({keySize:t+r}).compute(e,i),o=WordArray.create(a.words.slice(t),4*r);return a.sigBytes=4*t,CipherParams.create({key:a,iv:o,salt:i})}},PasswordBasedCipher=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,null,[{key:"encrypt",value:function(e,t,r,n){var i=Object.assign(new Base,this.cfg,n),a=i.kdf.execute(r,e.keySize,e.ivSize);i.iv=a.iv;var o=SerializableCipher.encrypt.call(this,e,t,a.key,i);return o.mixIn(a),o}},{key:"decrypt",value:function(e,t,r,n){var i=t,a=Object.assign(new Base,this.cfg,n);i=this._parse(i,a.format);var o=a.kdf.execute(r,e.keySize,e.ivSize,i.salt);return a.iv=o.iv,SerializableCipher.decrypt.call(this,e,i,o.key,a)}}]),r}(SerializableCipher);PasswordBasedCipher.cfg=Object.assign(SerializableCipher.cfg,{kdf:OpenSSLKdf});for(var _SBOX=[],INV_SBOX=[],_SUB_MIX_0=[],_SUB_MIX_1=[],_SUB_MIX_2=[],_SUB_MIX_3=[],INV_SUB_MIX_0=[],INV_SUB_MIX_1=[],INV_SUB_MIX_2=[],INV_SUB_MIX_3=[],d$2=[],i=0;i<256;i+=1)d$2[i]=i<128?i<<1:i<<1^283;for(var x=0,xi=0,_i=0;_i<256;_i+=1){var sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^255&sx^99,_SBOX[x]=sx,INV_SBOX[sx]=x;var x2=d$2[x],x4=d$2[x2],x8=d$2[x4],t$1=257*d$2[sx]^16843008*sx;_SUB_MIX_0[x]=t$1<<24|t$1>>>8,_SUB_MIX_1[x]=t$1<<16|t$1>>>16,_SUB_MIX_2[x]=t$1<<8|t$1>>>24,_SUB_MIX_3[x]=t$1,t$1=16843009*x8^65537*x4^257*x2^16843008*x,INV_SUB_MIX_0[sx]=t$1<<24|t$1>>>8,INV_SUB_MIX_1[sx]=t$1<<16|t$1>>>16,INV_SUB_MIX_2[sx]=t$1<<8|t$1>>>24,INV_SUB_MIX_3[sx]=t$1,x?(x=x2^d$2[d$2[d$2[x8^x2]]],xi^=d$2[d$2[xi]]):(xi=1,x=xi)}var RCON=[0,1,2,4,8,16,32,64,128,27,54],AESAlgo=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"_doReset",value:function(){var e;if(!this._nRounds||this._keyPriorReset!==this._key){this._keyPriorReset=this._key;var t=this._keyPriorReset,r=t.words,n=t.sigBytes/4;this._nRounds=n+6;var i=4*(this._nRounds+1);this._keySchedule=[];for(var a=this._keySchedule,o=0;o<i;o+=1)o<n?a[o]=r[o]:(e=a[o-1],o%n?n>6&&o%n==4&&(e=_SBOX[e>>>24]<<24|_SBOX[e>>>16&255]<<16|_SBOX[e>>>8&255]<<8|_SBOX[255&e]):(e=_SBOX[(e=e<<8|e>>>24)>>>24]<<24|_SBOX[e>>>16&255]<<16|_SBOX[e>>>8&255]<<8|_SBOX[255&e],e^=RCON[o/n|0]<<24),a[o]=a[o-n]^e);this._invKeySchedule=[];for(var s=this._invKeySchedule,l=0;l<i;l+=1){var u=i-l;e=l%4?a[u]:a[u-4],s[l]=l<4||u<=4?e:INV_SUB_MIX_0[_SBOX[e>>>24]]^INV_SUB_MIX_1[_SBOX[e>>>16&255]]^INV_SUB_MIX_2[_SBOX[e>>>8&255]]^INV_SUB_MIX_3[_SBOX[255&e]]}}}},{key:"encryptBlock",value:function(e,t){this._doCryptBlock(e,t,this._keySchedule,_SUB_MIX_0,_SUB_MIX_1,_SUB_MIX_2,_SUB_MIX_3,_SBOX)}},{key:"decryptBlock",value:function(e,t){var r=e,n=r[t+1];r[t+1]=r[t+3],r[t+3]=n,this._doCryptBlock(r,t,this._invKeySchedule,INV_SUB_MIX_0,INV_SUB_MIX_1,INV_SUB_MIX_2,INV_SUB_MIX_3,INV_SBOX),n=r[t+1],r[t+1]=r[t+3],r[t+3]=n}},{key:"_doCryptBlock",value:function(e,t,r,n,i,a,o,s){for(var l=e,u=this._nRounds,c=l[t]^r[0],d=l[t+1]^r[1],h=l[t+2]^r[2],f=l[t+3]^r[3],p=4,y=1;y<u;y+=1){var m=n[c>>>24]^i[d>>>16&255]^a[h>>>8&255]^o[255&f]^r[p];p+=1;var g=n[d>>>24]^i[h>>>16&255]^a[f>>>8&255]^o[255&c]^r[p];p+=1;var v=n[h>>>24]^i[f>>>16&255]^a[c>>>8&255]^o[255&d]^r[p];p+=1;var b=n[f>>>24]^i[c>>>16&255]^a[d>>>8&255]^o[255&h]^r[p];p+=1,c=m,d=g,h=v,f=b}var _=(s[c>>>24]<<24|s[d>>>16&255]<<16|s[h>>>8&255]<<8|s[255&f])^r[p];p+=1;var E=(s[d>>>24]<<24|s[h>>>16&255]<<16|s[f>>>8&255]<<8|s[255&c])^r[p];p+=1;var T=(s[h>>>24]<<24|s[f>>>16&255]<<16|s[c>>>8&255]<<8|s[255&d])^r[p];p+=1;var S=(s[f>>>24]<<24|s[c>>>16&255]<<16|s[d>>>8&255]<<8|s[255&h])^r[p];p+=1,l[t]=_,l[t+1]=E,l[t+2]=T,l[t+3]=S}}]),r}(BlockCipher);AESAlgo.keySize=8;var AES=BlockCipher._createHelper(AESAlgo),CTR=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r)}(BlockCipherMode);CTR.Encryptor=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"processBlock",value:function(e,t){var r=e,n=this._cipher,i=n.blockSize,a=this._iv,o=this._counter;a&&(this._counter=a.slice(0),o=this._counter,this._iv=void 0);var s=o.slice(0);n.encryptBlock(s,0),o[i-1]=o[i-1]+1|0;for(var l=0;l<i;l+=1)r[t+l]^=s[l]}}]),r}(CTR),CTR.Decryptor=CTR.Encryptor;var NoPadding={pad:function(){},unpad:function(){}},InnerEvent={DEMUXED_TRACK:"demuxedtrack"},logger$7=new Logger$c("BufferService"),BufferService$1=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e4;_classCallCheck$h(this,e),_defineProperty$h(this,"flv",null),_defineProperty$h(this,"_demuxer",new FlvDemuxer),_defineProperty$h(this,"_remuxer",null),_defineProperty$h(this,"_mse",null),_defineProperty$h(this,"_softVideo",null),_defineProperty$h(this,"_sourceCreated",!1),_defineProperty$h(this,"_needInitSegment",!0),_defineProperty$h(this,"_discontinuity",!0),_defineProperty$h(this,"_contiguous",!1),_defineProperty$h(this,"_initSegmentId",""),_defineProperty$h(this,"_cachedBuffer",null),_defineProperty$h(this,"_demuxStartTime",0),_defineProperty$h(this,"_analyzeDuration",0),this.flv=t,this._analyzeDuration=n,r?this._softVideo=r:(this._remuxer=new FMP4Remuxer$3(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new MSE$2,this._mse.bindMedia(t.media))}var t,r,n,i,a,o;return _createClass$i(e,[{key:"baseDts",get:function(){var e,t;return null===(e=this._demuxer)||void 0===e||null===(t=e._fixer)||void 0===t?void 0:t._baseDts}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(e){this._contiguous=!1,this._demuxStartTime=e}},{key:"reset",value:(o=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){var t,r=arguments;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],!this._mse||t){e.next=6;break}return e.next=4,this._mse.unbindMedia();case 4:return e.next=6,this._mse.bindMedia(this.flv.media);case 6:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="";case 11:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"endOfStream",value:(a=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.flv.emit(EVENT$2.BUFFEREOS);case 5:e.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updateDuration",value:(i=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(t){return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(this._mse.isOpened){e.next=4;break}return e.next=4,this._mse.open();case 4:return logger$7.debug("update duration",t),e.next=7,this._mse.updateDuration(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"destroy",value:(n=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=3;break}return e.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"appendBuffer",value:(r=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(t){var r,n,i,a,o,s,l,u,c,d,h,f,p,y;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cachedBuffer&&(t=concatUint8Array$5(this._cachedBuffer,t),this._cachedBuffer=null),r=this._demuxer,t&&t.length&&r){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,r.demuxAndFix(t,this._discontinuity,this._contiguous,this._demuxStartTime),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(4),new StreamingError$2(ERR$2.DEMUX,ERR$2.SUB_TYPES.FLV,e.t0);case 11:if(n=r.videoTrack,i=r.audioTrack,a=r.metadataTrack,o=n.exist(),s=i.exist(),!(!o&&n.present||!s&&i.present)){e.next=27;break}if(l=0,(u=o?n:s?i:void 0)&&u.samples.length&&(l=(u.samples[u.samples.length-1].originPts-u.samples[0].originPts)/u.timescale*1e3),!(l>this._analyzeDuration)){e.next=25;break}logger$7.warn("analyze duration exceeded, ".concat(l,"ms"),u),n.present=o,i.present=s,this.flv.emit(EVENT$2.ANALYZE_DURATION_EXCEEDED,{duration:l}),e.next=27;break;case 25:return this._cachedBuffer=t,e.abrupt("return");case 27:if(c=n.type,d=i.type,this._fireEvents(n,i,a),this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0,h=this._mse,this.flv.emit(InnerEvent.DEMUXED_TRACK,n),(f="".concat(n.codec,"/").concat(n.width,"/").concat(n.height,"/").concat(i.codec,"/").concat(i.config))!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=f,this._emitMetaParsedEvent(n,i)),!h){e.next=63;break}if(this._sourceCreated){e.next=45;break}return e.next=41,h.open();case 41:o&&(logger$7.log("codec: video/mp4;codecs=".concat(n.codec)),h.createSource(c,"video/mp4;codecs=".concat(n.codec))),s&&(logger$7.log("codec: audio/mp4;codecs=".concat(i.codec)),h.createSource(d,"audio/mp4;codecs=".concat(i.codec))),this._sourceCreated=!0,this.flv.emit(EVENT$2.SOURCEBUFFER_CREATED);case 45:e.prev=45,p=this._remuxer.remux(this._needInitSegment),e.next=52;break;case 49:throw e.prev=49,e.t1=e.catch(45),new StreamingError$2(ERR$2.REMUX,ERR$2.SUB_TYPES.FMP4,e.t1);case 52:if(!this._needInitSegment||p.videoInitSegment||p.audioInitSegment){e.next=54;break}return e.abrupt("return");case 54:return this._needInitSegment=!1,y=[],p.videoInitSegment&&y.push(h.append(c,p.videoInitSegment)),p.audioInitSegment&&y.push(h.append(d,p.audioInitSegment)),p.videoSegment&&y.push(h.append(c,p.videoSegment)),p.audioSegment&&y.push(h.append(d,p.audioSegment)),e.abrupt("return",Promise.all(y));case 63:this._softVideo&&this._softVideo.appendBuffer(n,i);case 64:case"end":return e.stop()}}),e,this,[[4,8],[45,49]])}))),function(e){return r.apply(this,arguments)})},{key:"evictBuffer",value:(t=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(t){var r,n,i,a=this;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.flv.media,this._mse&&this._demuxer&&r&&t&&!(t<0)){e.next=3;break}return e.abrupt("return");case 3:if(n=r.currentTime,!((i=n-t)<=0)){e.next=7;break}return e.abrupt("return");case 7:if(!(Buffer$5.start(Buffer$5.get(r))+1>=i)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this._mse.clearBuffer(0,i).then((function(){return a.flv.emit(EVENT$2.REMOVE_BUFFER,{removeEnd:i})})));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_emitMetaParsedEvent",value:function(e,t){e.exist()&&this.flv.emit(EVENT$2.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.flv.emit(EVENT$2.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),logger$7.debug("track parsed",e,t)}},{key:"_fireEvents",value:function(e,t,r){var n=this;logger$7.debug(e.samples,t.samples),r.flvScriptSamples.forEach((function(e){n.flv.emit(EVENT$2.FLV_SCRIPT_DATA,e),logger$7.debug("flvScriptData",e)})),e.samples.forEach((function(e){e.keyframe&&n.flv.emit(EVENT$2.KEYFRAME,{pts:e.pts})})),e.warnings.forEach((function(e){var t;switch(e.type){case WarningType$1.LARGE_AV_SHIFT:t=EVENT$2.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case WarningType$1.LARGE_VIDEO_GAP:t=EVENT$2.LARGE_VIDEO_DTS_GAP_DETECT;break;case WarningType$1.LARGE_VIDEO_GAP_BETWEEN_CHUNK:t=EVENT$2.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT}t&&n.flv.emit(EVENT$2.STREAM_EXCEPTION,_objectSpread2$a(_objectSpread2$a({},e),{},{type:t})),logger$7.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case WarningType$1.LARGE_AUDIO_GAP:t=EVENT$2.LARGE_AUDIO_DTS_GAP_DETECT;break;case WarningType$1.AUDIO_FILLED:t=EVENT$2.AUDIO_GAP_DETECT;break;case WarningType$1.AUDIO_DROPPED:t=EVENT$2.AUDIO_OVERLAP_DETECT}t&&n.flv.emit(EVENT$2.STREAM_EXCEPTION,_objectSpread2$a(_objectSpread2$a({},e),{},{type:t})),logger$7.warn("audio exception",e)})),r.seiSamples.forEach((function(e){n.flv.emit(EVENT$2.SEI,_objectSpread2$a(_objectSpread2$a({},e),{},{sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))}}]),e}();function getOption$1(e){var t=_objectSpread2$a({retryCount:3,retryDelay:1e3,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1},e);return t.isLive&&t.preloadTime&&(t.maxLatency||(t.maxLatency=2*t.preloadTime),t.targetLatency||(t.targetLatency=t.preloadTime),null!==t.disconnectTime&&void 0!==t.disconnectTime||(t.disconnectTime=t.maxLatency)),t}function searchKeyframeIndex(e,t){var r=0,n=e.length-1,i=0,a=0,o=n;for(t<e[0]&&(r=0,a=o+1);a<=o;){if((i=a+Math.floor((o-a)/2))===n||t>=e[i]&&t<e[i+1]){r=i;break}e[i]<t?a=i+1:o=i-1}return r}var logger$6=new Logger$c("flv"),Flv$2=function(e){_inherits$e(u,e);var t,r,n,i,a,o,s,l=_createSuper$h(u);function u(e){var t;return _classCallCheck$h(this,u),_defineProperty$h(_assertThisInitialized$e(t=l.call(this)),"media",null),_defineProperty$h(_assertThisInitialized$e(t),"_loading",!1),_defineProperty$h(_assertThisInitialized$e(t),"_opts",null),_defineProperty$h(_assertThisInitialized$e(t),"_bufferService",null),_defineProperty$h(_assertThisInitialized$e(t),"_gapService",null),_defineProperty$h(_assertThisInitialized$e(t),"_mediaLoader",null),_defineProperty$h(_assertThisInitialized$e(t),"_maxChunkWaitTimer",null),_defineProperty$h(_assertThisInitialized$e(t),"_tickTimer",null),_defineProperty$h(_assertThisInitialized$e(t),"_tickInterval",500),_defineProperty$h(_assertThisInitialized$e(t),"_noEndOfStreamOnDone",!1),_defineProperty$h(_assertThisInitialized$e(t),"_urlSwitching",!1),_defineProperty$h(_assertThisInitialized$e(t),"_seamlessSwitching",!1),_defineProperty$h(_assertThisInitialized$e(t),"_keyframes",null),_defineProperty$h(_assertThisInitialized$e(t),"_acceptRanges",!0),_defineProperty$h(_assertThisInitialized$e(t),"_onProgress",function(){var e=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(r,n,i,a){var o,s,l,u,c,d,h;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i.startTime,s=i.endTime,l=i.st,u=i.firstByteTime,t._loading=!n,t._firstProgressEmit||(c=a.headers,t.emit(EVENT$2.TTFB,{url:t._opts.url,responseUrl:a.url,elapsed:l?u-l:s-o}),t.emit(EVENT$2.LOAD_RESPONSE_HEADERS,{headers:c}),t._acceptRanges=!(null==c||!c.get("Accept-Ranges"))||!(null==c||!c.get("Content-Range")),t._firstProgressEmit=!0),t._bufferService){e.next=5;break}return e.abrupt("return");case 5:return clearTimeout(t._maxChunkWaitTimer),t._bandwidthService.addChunkRecord(null==r?void 0:r.byteLength,s-o),e.prev=7,e.next=10,t._bufferService.appendBuffer(r);case 10:t.isLive&&(null===(d=t._bufferService)||void 0===d||d.evictBuffer(t._opts.bufferBehind)),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(7),e.abrupt("return",t._emitError(StreamingError$2.create(e.t0)));case 16:if(t._urlSwitching&&(t._urlSwitching=!1,t.emit(EVENT$2.SWITCH_URL_SUCCESS,{url:t._opts.url})),t._seamlessSwitching&&(t._seamlessSwitching=!1,t.media.play(),t._tick()),!n||t.media.seeking){e.next=28;break}if(t.emit(EVENT$2.LOAD_COMPLETE),logger$6.debug("load done",t._noEndOfStreamOnDone),!t._noEndOfStreamOnDone){e.next=25;break}t._noEndOfStreamOnDone=!1,e.next=26;break;case 25:return e.abrupt("return",t._end());case 26:e.next=30;break;case 28:(h=t._opts.maxReaderInterval)&&(clearTimeout(t._maxChunkWaitTimer),t._maxChunkWaitTimer=setTimeout((function(){logger$6.debug("onMaxChunkWait",h),t._end()}),h));case 30:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()),_defineProperty$h(_assertThisInitialized$e(t),"_onRetryError",(function(e,r){logger$6.debug("load retry",e,r),t.emit(EVENT$2.LOAD_RETRY,{error:StreamingError$2.network(e),retryTime:r})})),_defineProperty$h(_assertThisInitialized$e(t),"_end",(function(){t._clear(),t._bufferService&&t._bufferService.endOfStream(),logger$6.debug("end stream")})),_defineProperty$h(_assertThisInitialized$e(t),"_tick",(function(){clearTimeout(t._tickTimer);var e=_assertThisInitialized$e(t).media;if(e){t._tickTimer=setTimeout(t._tick,t._tickInterval);var r=Buffer$5.end(Buffer$5.get(e));if(!(r<.1)&&e.readyState){var n=t._opts;if(isMediaPlaying(e))t._gapService&&t._gapService.do(e,n.maxJumpDistance,t.isLive,3);else{if(!e.currentTime&&t._gapService)return void t._gapService.do(e,n.maxJumpDistance,t.isLive,3);n.isLive&&r>n.disconnectTime&&t.disconnect()}}}})),_defineProperty$h(_assertThisInitialized$e(t),"_onPlay",(function(){var e,r,n=t._opts.softDecode||(null===(e=t.media)||void 0===e||null===(r=e.buffered)||void 0===r?void 0:r.length);t.isLive&&!t._loading&&n&&t.replay(void 0,!0)})),_defineProperty$h(_assertThisInitialized$e(t),"_onSeeking",_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){var r,n,i,a,o;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLive||!t.seekable){e.next=14;break}if(r=t._keyframes.times,n=t._keyframes.filepositions,null!=r&&r.length&&null!=n&&n.length){e.next=5;break}return e.abrupt("return");case 5:if(i=t.media.currentTime,a=searchKeyframeIndex(t._keyframes.times,i),null!=(o=n[a])){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,t._mediaLoader.cancel();case 12:t._loadData(null,[o]),t._bufferService.unContiguous(r[a]);case 14:case"end":return e.stop()}}),e)})))),_defineProperty$h(_assertThisInitialized$e(t),"_onTimeupdate",(function(){if(t.media){var e=t._opts,r=t.media.currentTime;if(e.isLive&&e.maxLatency&&e.targetLatency){var n=Buffer$5.end(Buffer$5.get(t.media));n-r>=e.maxLatency&&(t.media.currentTime=n-e.targetLatency)}t._seiService.throw(r)}})),_defineProperty$h(_assertThisInitialized$e(t),"_onFlvScriptData",(function(e){var r,n,i,a,o=null===(r=e.data)||void 0===r||null===(n=r.onMetaData)||void 0===n?void 0:n.keyframes,s=null===(i=e.data)||void 0===i||null===(a=i.onMetaData)||void 0===a?void 0:a.duration;o&&(t._keyframes=o),!t._opts.isLive&&s&&t._bufferService.updateDuration(s)})),t._opts=getOption$1(e),t.media=t._opts.media||document.createElement("video"),t._opts.media=null,t._firstProgressEmit=!1,t._mediaLoader=new NetLoader$3(_objectSpread2$a(_objectSpread2$a({},t._opts.fetchOptions),{},{retry:t._opts.retryCount,retryDelay:t._opts.retryDelay,timeout:t._opts.loadTimeout,onRetryError:t._onRetryError,onProgress:t._onProgress,responseType:"arraybuffer"})),t._bufferService=new BufferService$1(_assertThisInitialized$e(t),t._opts.softDecode?t.media:void 0,t._opts.analyzeDuration),t._seiService=new SeiService(_assertThisInitialized$e(t)),t._bandwidthService=new BandwidthService,t._opts.softDecode||(t._gapService=new GapService),t.media.addEventListener("play",t._onPlay),t.media.addEventListener("seeking",t._onSeeking),t.media.addEventListener("timeupdate",t._onTimeupdate),t.on(EVENT$2.FLV_SCRIPT_DATA,t._onFlvScriptData),t}return _createClass$i(u,[{key:"version",get:function(){return"3.0.0-next.15"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"bufferInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return Buffer$5.info(Buffer$5.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"playbackQuality",value:function(){return getVideoPlaybackQuality(this.media)}},{key:"load",value:(s=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(t){var r,n=arguments;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]&&n[1],this._bufferService){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._reset(r);case 5:this._loadData(t),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"replay",value:(o=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){var t,r,n=this,i=arguments;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:this._opts.seamlesslyReload,r=i.length>1?i[1]:void 0,this.media){e.next=4;break}return e.abrupt("return");case 4:if(!t){e.next=11;break}return this._noEndOfStreamOnDone=!0,e.next=8,this._clear();case 8:setTimeout((function(){n._loadData(n._opts.url),n._bufferService.seamlessSwitch(),n._seamlessSwitching=!0})),e.next=13;break;case 11:return e.next=13,this.load();case 13:return e.abrupt("return",this.media.play(!r));case 14:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"disconnect",value:function(){return logger$6.debug("disconnect!"),this._clear()}},{key:"switchURL",value:(a=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(t,r){var n=this;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._bufferService){e.next=2;break}return e.abrupt("return");case 2:if(r&&this._opts.isLive){e.next=7;break}return e.next=5,this.load(t);case 5:return this._urlSwitching=!0,e.abrupt("return",this.media.play(!0));case 7:return this._noEndOfStreamOnDone=!0,e.next=10,this._clear();case 10:setTimeout((function(){n._loadData(t),n._bufferService.seamlessSwitch(),n._urlSwitching=!0,n._seamlessSwitching=!0}));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"destroy",value:(i=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=9,Promise.all([this._clear(),this._bufferService.destroy()]);case 9:this.media=null,this._bufferService=null;case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_emitError",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];logger$6.table(e),logger$6.error(e),logger$6.error(null===(t=this.media)||void 0===t?void 0:t.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(EVENT$2.SWITCH_URL_FAILED,e)),this.emit(EVENT$2.ERROR,e),r&&(this._seiService.reset(),this._end())}},{key:"_reset",value:(n=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){var t,r=arguments;return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],this._seiService.reset(),this._bandwidthService.reset(),e.next=5,this._clear();case 5:return e.next=7,this._bufferService.reset(t);case 7:this._firstProgressEmit=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_loadData",value:(r=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(t,r){return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&(this._opts.url=t),t=this._opts.url){e.next=4;break}throw new Error("Source url is missing");case 4:if(this.emit(EVENT$2.LOAD_START,{url:t}),logger$6.debug("load data, loding:",this._loading,t),!this._loading){e.next=9;break}return e.next=9,this._mediaLoader.cancel();case 9:return this._loading=!0,e.prev=10,e.next=13,this._mediaLoader.load({url:t,range:r});case 13:e.next=18;break;case 15:return e.prev=15,e.t0=e.catch(10),e.abrupt("return",this._emitError(StreamingError$2.network(e.t0)));case 18:case"end":return e.stop()}}),e,this,[[10,15]])}))),function(e,t){return r.apply(this,arguments)})},{key:"_clear",value:(t=_asyncToGenerator$c(_regeneratorRuntime$a().mark((function e(){return _regeneratorRuntime$a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),!this._mediaLoader){e.next=5;break}return e.next=5,this._mediaLoader.cancel();case 5:this._loading=!1;case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"isSupported",value:function(){return MSE$2.isSupported()}},{key:"enableLogger",value:function(){Logger$c.enable(),Logger$b.enable()}},{key:"disableLogger",value:function(){Logger$c.disable(),Logger$b.disable()}}]),u}(EventEmitter$1);try{localStorage.getItem("xgd")?Flv$2.enableLogger():Flv$2.disableLogger()}catch(error){}var PluginExtension$1=function(){function e(t,r){var n=this;_classCallCheck$h(this,e),_defineProperty$h(this,"_onLowDecode",(function(){var e,t,r,i,a=n._opts,o=a.media,s=a.innerDegrade,l=a.backupURL;null===(e=n._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("lowdecode",o.degradeInfo),null===(r=n._plugin)||void 0===r||null===(i=r.player)||void 0===i||i.emit("core_event",_objectSpread2$a(_objectSpread2$a({},o.degradeInfo),{},{eventName:EVENT$2.LOWDECODE})),1!==s&&3!==s||!l||n._degrade(l)})),_defineProperty$h(this,"_degrade",(function(e){var t=n._plugin.player,r=t.video;if("MVideo"===(null==r?void 0:r.TAG)){var i=t.video.degradeVideo;t.video=i,r.degrade(e),e&&(t.config.url=e);var a=t.root.firstChild;"MVideo"===a.TAG&&t.root.replaceChild(i,a);var o=n._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),_defineProperty$h(this,"forceDegradeToVideo",(function(e){var t=n._opts.innerDegrade;1!==t&&3!==t||n._degrade(e)})),this._opts=t,this._plugin=r,this._init()}return _createClass$i(e,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,i=e.decodeMode;t&&(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),t.setDecodeMode&&t.setDecodeMode(i),this._bindEvents())}},{key:"_bindEvents",value:function(){this._opts.media.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),e}(),Stats$1=function(){function e(){_classCallCheck$h(this,e),_defineProperty$h(this,"encodeType",""),_defineProperty$h(this,"audioCodec",""),_defineProperty$h(this,"videoCodec",""),_defineProperty$h(this,"domain",""),_defineProperty$h(this,"fps",0),_defineProperty$h(this,"bitrate",0),_defineProperty$h(this,"width",0),_defineProperty$h(this,"height",0),_defineProperty$h(this,"samplerate",0),_defineProperty$h(this,"channelCount",0),_defineProperty$h(this,"gop",0),_defineProperty$h(this,"_bitsAccumulateSize",0),_defineProperty$h(this,"_bitsAccumulateDuration",0)}return _createClass$i(e,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setVideoMeta",value:function(e){this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen&&(this.fps=e.fpsNum/e.fpsDen)}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if(!this.fps||this.fps>=100){var r=e[0];null!=r&&r.duration&&(this.fps=Math.round(1e3/r.duration))}e.forEach((function(e){1===e.gopId&&t.gop++,t._bitsAccumulateDuration+=e.duration,t._bitsAccumulateSize+=e.units.reduce((function(e,t){return e+t.length}),0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=8*t._bitsAccumulateSize,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)}))}}]),e}(),MediaStats$1=function(){function e(t){_classCallCheck$h(this,e),_defineProperty$h(this,"_plugin",void 0),_defineProperty$h(this,"_samples",[]),_defineProperty$h(this,"_bitrateCalcDuration",0),_defineProperty$h(this,"_stats",new Stats$1),this._plugin=t,this._bindEvents()}return _createClass$i(e,[{key:"getStats",value:function(){var e,t,r,n,i,a,o=(null===(e=this._plugin.player)||void 0===e?void 0:e.video)||{},s=o.currentTime,l=void 0===s?0:s,u=o.decodeFps,c=void 0===u?0:u;return _objectSpread2$a(_objectSpread2$a({},this._stats.getStats()),{},{downloadSpeed:null===(t=this._plugin.core)||void 0===t||null===(r=t.speedInfo)||void 0===r?void 0:r.call(t).speed,avgSpeed:null===(n=this._plugin.core)||void 0===n||null===(i=n.speedInfo)||void 0===i?void 0:i.call(n).avgSpeed,currentTime:l,bufferEnd:(null===(a=this._plugin.player)||void 0===a?void 0:a.getBufferedRange()[1])-l,decodeFps:c})}},{key:"_bindEvents",value:function(){var e,t=this;this._onceLoadStart(),null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function(e){e.eventName===EVENT$2.METADATA_PARSED&&("video"===e.type?t._stats.setVideoMeta(e.track):t._stats.setAudioMeta(e.track)),e.eventName===EVENT$2.TTFB&&t._stats.setDomain(e.responseUrl)}))}},{key:"_onceLoadStart",value:function(){var e,t=this;null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function e(r){r.eventName===EVENT$2.LOAD_START&&(t._plugin.player.off("core_event",e),t._plugin.core.on(InnerEvent.DEMUXED_TRACK,(function(e){return t._stats.updateBitrate(e.samples)})))}))}}]),e}(),FlvPlugin=function(e){_inherits$e(r,e);var t=_createSuper$h(r);function r(){var e;_classCallCheck$h(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$h(_assertThisInitialized$e(e=t.call.apply(t,[this].concat(i))),"flv",null),_defineProperty$h(_assertThisInitialized$e(e),"pluginExtension",null),_defineProperty$h(_assertThisInitialized$e(e),"_stats",new MediaStats$1(_assertThisInitialized$e(e))),_defineProperty$h(_assertThisInitialized$e(e),"getStats",(function(){return e._stats.getStats()})),_defineProperty$h(_assertThisInitialized$e(e),"destroy",(function(){var t;e.flv&&(e.flv.destroy(),e.flv=null),null===(t=e.pluginExtension)||void 0===t||t.destroy(),e.pluginExtension=null})),_defineProperty$h(_assertThisInitialized$e(e),"_onSwitchURL",(function(t,r){e.flv&&(e.player.config.url=t,e.flv.switchURL(t,r))})),_defineProperty$h(_assertThisInitialized$e(e),"_onDefinitionChange",(function(t){var r=t.to;e.flv&&e.flv.switchURL(r)})),e}return _createClass$i(r,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var e;return null===(e=this.flv)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t,r=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!r&&"video"!==r&&"audio"!==r}},{key:"beforePlayerInit",value:function(){var e=this,t=this.player.config;if(t.url){this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var r,n=t.flv||{};if(null!==n.disconnectTime&&void 0!==n.disconnectTime||(n.disconnectTime=0),this.flv=new Flv$2(_objectSpread2$a({softDecode:this.softDecode,isLive:t.isLive,media:this.player.video},n)),this.softDecode||BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var t,r;return null===(t=e.flv)||void 0===t||null===(r=t.media)||void 0===r?void 0:r.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new PluginExtension$1(_objectSpread2$a({media:this.player.video},t.flv),this),this.player.forceDegradeToVideo=function(){for(var t,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(t=e.pluginExtension)||void 0===t?void 0:t.forceDegradeToVideo.apply(t,n)}),t.isLive)null===(r=this.player)||void 0===r||r.useHooks("replay",(function(){var t;return null===(t=e.flv)||void 0===t?void 0:t.replay()}));this.on(URL_CHANGE,this._onSwitchURL),this.on(DESTROY,this.destroy),this._transError(),this._transCoreEvent(EVENT$2.TTFB),this._transCoreEvent(EVENT$2.LOAD_START),this._transCoreEvent(EVENT$2.LOAD_RESPONSE_HEADERS),this._transCoreEvent(EVENT$2.LOAD_COMPLETE),this._transCoreEvent(EVENT$2.LOAD_RETRY),this._transCoreEvent(EVENT$2.SOURCEBUFFER_CREATED),this._transCoreEvent(EVENT$2.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(EVENT$2.REMOVE_BUFFER),this._transCoreEvent(EVENT$2.BUFFEREOS),this._transCoreEvent(EVENT$2.KEYFRAME),this._transCoreEvent(EVENT$2.METADATA_PARSED),this._transCoreEvent(EVENT$2.SEI),this._transCoreEvent(EVENT$2.SEI_IN_TIME),this._transCoreEvent(EVENT$2.FLV_SCRIPT_DATA),this._transCoreEvent(EVENT$2.STREAM_EXCEPTION),this._transCoreEvent(EVENT$2.SWITCH_URL_SUCCESS),this._transCoreEvent(EVENT$2.SWITCH_URL_FAILED),this.flv.load(t.url,!0)}}},{key:"_transError",value:function(){var e=this;this.flv.on(EVENT$2.ERROR,(function(t){e.player&&e.player.emit(ERROR$3,new Errors$1(e.player,t))}))}},{key:"_transCoreEvent",value:function(e){var t=this;this.flv.on(e,(function(r){t.player&&t.player.emit("core_event",_objectSpread2$a(_objectSpread2$a({},r),{},{eventName:e}))}))}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(e){return Flv$2.isSupported(e)}}]),r}(BasePlugin);function ownKeys$f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$f(Object(r),!0).forEach((function(t){_defineProperty$e(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$8(){_regeneratorRuntime$8=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep$a(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$a(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$a(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$a(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$f(e,t,r){return t&&_defineProperties$f(e.prototype,t),r&&_defineProperties$f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$b(e,t)}function _getPrototypeOf$b(e){return(_getPrototypeOf$b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$b(e,t){return(_setPrototypeOf$b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$b(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$b(e)}function _createSuper$e(e){var t=_isNativeReflectConstruct$e();return function(){var r,n=_getPrototypeOf$b(e);if(t){var i=_getPrototypeOf$b(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$b(this,r)}}function _slicedToArray$5(e,t){return _arrayWithHoles$5(e)||_iterableToArrayLimit$5(e,t)||_unsupportedIterableToArray$b(e,t)||_nonIterableRest$5()}function _toConsumableArray$7(e){return _arrayWithoutHoles$7(e)||_iterableToArray$7(e)||_unsupportedIterableToArray$b(e)||_nonIterableSpread$7()}function _arrayWithoutHoles$7(e){if(Array.isArray(e))return _arrayLikeToArray$b(e)}function _arrayWithHoles$5(e){if(Array.isArray(e))return e}function _iterableToArray$7(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$5(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$b(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$b(e,t):void 0}}function _arrayLikeToArray$b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$7(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$5(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _classCallCheck$d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$e(e,t,r){return t&&_defineProperties$e(e.prototype,t),r&&_defineProperties$e(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$a(e,t)}function _getPrototypeOf$a(e){return(_getPrototypeOf$a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$a(e,t){return(_setPrototypeOf$a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$a(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$a(e)}function _createSuper$d(e){var t=_isNativeReflectConstruct$d();return function(){var r,n=_getPrototypeOf$a(e);if(t){var i=_getPrototypeOf$a(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$a(this,r)}}function _slicedToArray$4(e,t){return _arrayWithHoles$4(e)||_iterableToArrayLimit$4(e,t)||_unsupportedIterableToArray$a(e,t)||_nonIterableRest$4()}function _toConsumableArray$6(e){return _arrayWithoutHoles$6(e)||_iterableToArray$6(e)||_unsupportedIterableToArray$a(e)||_nonIterableSpread$6()}function _arrayWithoutHoles$6(e){if(Array.isArray(e))return _arrayLikeToArray$a(e)}function _arrayWithHoles$4(e){if(Array.isArray(e))return e}function _iterableToArray$6(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$4(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$a(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$a(e,t):void 0}}function _arrayLikeToArray$a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$6(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$4(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}_defineProperty$h(FlvPlugin,"Flv",Flv$2);var TrackType$2={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType$2={AVC:"avc",HEVC:"hevc"},AudioCodecType$1={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},WarningType={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},VideoTrack$1=function(){function e(){_classCallCheck$d(this,e),_defineProperty$d(this,"id",1),_defineProperty$d(this,"type",TrackType$2.VIDEO),_defineProperty$d(this,"codecType",VideoCodecType$2.AVC),_defineProperty$d(this,"pid",-1),_defineProperty$d(this,"hvcC",void 0),_defineProperty$d(this,"codec",""),_defineProperty$d(this,"timescale",0),_defineProperty$d(this,"formatTimescale",0),_defineProperty$d(this,"sequenceNumber",0),_defineProperty$d(this,"baseMediaDecodeTime",0),_defineProperty$d(this,"baseDts",0),_defineProperty$d(this,"duration",0),_defineProperty$d(this,"warnings",[]),_defineProperty$d(this,"samples",[]),_defineProperty$d(this,"pps",[]),_defineProperty$d(this,"sps",[]),_defineProperty$d(this,"vps",[]),_defineProperty$d(this,"fpsNum",0),_defineProperty$d(this,"fpsDen",0),_defineProperty$d(this,"sarRatio",[]),_defineProperty$d(this,"width",0),_defineProperty$d(this,"height",0),_defineProperty$d(this,"nalUnitSize",4),_defineProperty$d(this,"present",!1),_defineProperty$d(this,"isVideoEncryption",!1),_defineProperty$d(this,"isAudioEncryption",!1),_defineProperty$d(this,"isVideo",!0),_defineProperty$d(this,"kid",null),_defineProperty$d(this,"pssh",null),_defineProperty$d(this,"ext",void 0)}return _createClass$e(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),e}(),AudioTrack$1=function(){function e(){_classCallCheck$d(this,e),_defineProperty$d(this,"id",2),_defineProperty$d(this,"type",TrackType$2.AUDIO),_defineProperty$d(this,"codecType",AudioCodecType$1.AAC),_defineProperty$d(this,"pid",-1),_defineProperty$d(this,"codec",""),_defineProperty$d(this,"sequenceNumber",0),_defineProperty$d(this,"sampleDuration",0),_defineProperty$d(this,"timescale",0),_defineProperty$d(this,"formatTimescale",0),_defineProperty$d(this,"baseMediaDecodeTime",0),_defineProperty$d(this,"duration",0),_defineProperty$d(this,"warnings",[]),_defineProperty$d(this,"samples",[]),_defineProperty$d(this,"baseDts",0),_defineProperty$d(this,"sampleSize",16),_defineProperty$d(this,"sampleRate",0),_defineProperty$d(this,"channelCount",0),_defineProperty$d(this,"objectType",0),_defineProperty$d(this,"sampleRateIndex",0),_defineProperty$d(this,"config",[]),_defineProperty$d(this,"present",!1),_defineProperty$d(this,"isVideoEncryption",!1),_defineProperty$d(this,"isAudioEncryption",!1),_defineProperty$d(this,"kid",null),_defineProperty$d(this,"ext",void 0)}return _createClass$e(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===AudioCodecType$1.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}}]),e}(),VideoSample$1=function(){function e(t,r,n){_classCallCheck$d(this,e),_defineProperty$d(this,"flag",{}),_defineProperty$d(this,"keyframe",!1),_defineProperty$d(this,"gopId",0),_defineProperty$d(this,"duration",0),_defineProperty$d(this,"size",0),_defineProperty$d(this,"units",[]),_defineProperty$d(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return _createClass$e(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),AudioSample$1=_createClass$e((function e(t,r,n,i){_classCallCheck$d(this,e),_defineProperty$d(this,"duration",1024),_defineProperty$d(this,"flag",{dependsOn:2,isNonSyncSample:0}),_defineProperty$d(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,this.sampleOffset=i,n&&(this.duration=n)})),Sample=_createClass$e((function e(t,r){_classCallCheck$d(this,e),_defineProperty$d(this,"time",0),this.data=t,this.originPts=this.pts=r})),SeiSample=function(e){_inherits$a(r,e);var t=_createSuper$d(r);function r(){return _classCallCheck$d(this,r),t.apply(this,arguments)}return _createClass$e(r)}(Sample),MetadataTrack$1=function(){function e(){_classCallCheck$d(this,e),_defineProperty$d(this,"id",3),_defineProperty$d(this,"type",TrackType$2.METADATA),_defineProperty$d(this,"timescale",0),_defineProperty$d(this,"flvScriptSamples",[]),_defineProperty$d(this,"seiSamples",[])}return _createClass$e(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),Logger$9=function(){function e(t){_classCallCheck$d(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$e(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$d(Logger$9,"disabled",!0);var isBrowser$3="undefined"!=typeof window,ua$2=isBrowser$3&&navigator.userAgent.toLocaleLowerCase(),isSafari$1=isBrowser$3&&/^((?!chrome|android).)*safari/.test(ua$2),isFirefox$2=isBrowser$3&&ua$2.includes("firefox"),isAndroid$2=isBrowser$3&&ua$2.includes("android"),AAC$2=function(){function e(){_classCallCheck$d(this,e)}return _createClass$e(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,l=e.FREQ[s];if(!l)throw new Error("Invalid sampling index: ".concat(s));for(var u,c,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,y=f.codec,m=0,g=e.getFrameDuration(l);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(c=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;u=2*(1&~t[i+1]),o.push({pts:r+m*g,data:t.subarray(i+7+u,i+c)}),m++,i+=c}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:l,objectType:d,channelCount:h,codec:y,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(a){var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return isFirefox$2?e>=6?(n=5,i=e-3):(n=2,i=e):isAndroid$2?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();function concatUint8Array$3(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}_defineProperty$d(AAC$2,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var MAX_SIZE$1=Math.pow(2,32);function readBig16$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function readBig24$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}function readBig32$2(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function readBig64$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return readBig32$2(e,t)*MAX_SIZE$1+readBig32$2(e,t+4)}function getAvcCodec$1(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}function parse$2(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))}var NALu$1=function(){function e(){_classCallCheck$d(this,e)}return _createClass$e(e,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!==e[r]&&void 0!==e[r]&&1!==e[r];)r++;if((n=++r+2)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],a=0;a+t<n;)if(r=readBig32$2(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseSEI",value:function(e,t){for(var r=e.length,n=t?2:1,i=0,a=0,o="";255===e[n];)i+=255,n++;for(i+=e[n++];255===e[n];)a+=255,n++;if(a+=e[n++],5===i&&r>n+16)for(var s=0;s<16;s++)o+=e[n].toString(16),n++;return{payload:e.subarray(n),type:i,size:a,uuid:o}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),ExpGolomb$1=function(){function e(t){if(_classCallCheck$d(this,e),_defineProperty$d(this,"_bytesAvailable",void 0),_defineProperty$d(this,"_bitsAvailable",0),_defineProperty$d(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return _createClass$e(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}}]),e}(),AVC$1=function(){function e(){_classCallCheck$d(this,e)}return _createClass$e(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,l=31&t[5],u=0;u<l;u++)if(n=t[s]<<8|t[s+1],s+=2,n){var c=t.subarray(s,s+n);s+=n,a.push(c),r||(r=e.parseSPS(NALu$1.removeEPB(c)))}var d,h=t[s];s++;for(var f=0;f<h;f++)d=t[s]<<8|t[s+1],s+=2,d&&(o.push(t.subarray(s,s+d)),s+=d);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new ExpGolomb$1(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,l=0;l<s;l++)t.readBool()&&(l<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var u=t.readUEG();if(0===u)t.readUEG();else if(1===u){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var c=t.readUEG(),d=0;d<c;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var y,m,g,v,b,_=0,E=0,T=0,S=0;if(t.readBool()&&(_=t.readUEG(),E=t.readUEG(),T=t.readUEG(),S=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var $=t.readBits(32),A=t.readBits(32);m=t.readBool(),b=(g=A)/(v=2*$)}}return{codec:getAvcCodec$1(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(h+1)-2*(_+E)),height:(2-p)*(f+1)*16-(p?2:4)*(T+S),sarRatio:y,fpsNum:g,fpsDen:v,fps:b,fixedFrame:m}}}]),e}(),HEVC$1=function(){function e(){_classCallCheck$d(this,e)}return _createClass$e(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var n,i,a,o,s,l=1+(3&t[21]),u=[],c=[],d=[],h=23,f=t[22],p=0;p<f;p++){a=63&t[h],o=t[h+1]<<8|t[h+2],h+=3;for(var y=0;y<o;y++)if(s=t[h]<<8|t[h+1],h+=2,s){switch(a){case 32:var m=t.subarray(h,h+s);n||(n=e.parseVPS(NALu$1.removeEPB(m),r)),d.push(m);break;case 33:var g=t.subarray(h,h+s);i||(i=e.parseSPS(NALu$1.removeEPB(g),r)),u.push(g);break;case 34:c.push(t.subarray(h,h+s))}h+=s}}return{hvcC:r,sps:i,spsArr:u,ppsArr:c,vpsArr:d,nalUnitSize:l}}}},{key:"parseVPS",value:function(t,r){r=r||{};var n=new ExpGolomb$1(t);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),n.readBits(17),e._parseProfileTierLevel(n,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||{};var n=new ExpGolomb$1(t);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,i,r),n.readUEG();var a=r.chromaFormatIdc=n.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var s=0;3===a&&(s=n.readBits(1));var l,u,c,d,h=n.readUEG(),f=n.readUEG(),p=n.readBits(1);if(1===p&&(l=n.readUEG(),u=n.readUEG(),c=n.readUEG(),d=n.readUEG()),r.bitDepthLumaMinus8=n.readUEG(),r.bitDepthChromaMinus8=n.readUEG(),1===p){var y=1!==a&&2!==a||0!==s?1:2,m=1===a&&0===s?2:1;h-=y*(u+l),f-=m*(d+c)}return{codec:"hev1.1.6.L93.B0",width:h,height:f,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var a=[],o=[],s=0;s<t;s++)a[s]=e.readBits(1),o[s]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var l=0;l<t;l++)0!==a[l]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[l]&&e.readBits(8)}}]),e}(),LARGE_AV_FIRST_FRAME_GAP=45e3,AUDIO_GAP_OVERLAP_THRESHOLD_COUNT=3,MAX_SILENT_FRAME_DURATION=9e4,AUDIO_EXCETION_LOG_EMIT_DURATION=45e4,MAX_VIDEO_FRAME_DURATION=9e4,MAX_DTS_DELTA_WITH_NEXT_CHUNK=45e3,TsFixer=function(){function e(t,r,n){_classCallCheck$d(this,e),this.videoTrack=t,this.audioTrack=r,this.metadataTrack=n,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0}return _createClass$e(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(9e4*t);var i=this.videoTrack,a=this.audioTrack,o=i.samples,s=a.samples;if(o.length||s.length){var l=o[0],u=s[0],c=0;if(o.length&&s.length&&(c=l.dts-u.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),r&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t),!n){this._videoNextDts=c>0?t+c:t,this._audioNextPts=c>0?t:t-c;var d=l?l.dts-this._baseDts-this._videoNextDts:0,h=u?u.pts-this._baseDts-this._audioNextPts:0;Math.abs(d||h)>MAX_VIDEO_FRAME_DURATION&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._fixVideo(i),this.metadataTrack.exist()){var f=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/f}))}i.samples.length&&(i.baseMediaDecodeTime=i.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/9e4)}}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){if(r.forEach((function(e){e.dts-=t._baseDts,e.pts-=t._baseDts})),void 0===this._videoNextDts){var n=r[0];this._videoNextDts=n.dts}var i,a,o=r.length,s=0,l=r[0],u=r[1],c=this._videoNextDts-l.dts;if(Math.abs(c)>MAX_DTS_DELTA_WITH_NEXT_CHUNK)l.dts+=c,l.pts+=c,e.warnings.push({type:WarningType.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:l.dts,nextSampleDts:null===(i=r[1])||void 0===i?void 0:i.dts,sampleDuration:c}),u&&Math.abs(u.dts-l.dts)>MAX_VIDEO_FRAME_DURATION&&(this._videoTimestampBreak=!0,r.forEach((function(e,t){0!==t&&(e.dts+=c,e.pts+=c)})));if(e.fpsNum&&e.fpsDen)a=e.timescale*(e.fpsDen/e.fpsNum);else{var d=e.samples[0],h=e.samples[o-1];a=1===o?9e3:Math.floor((h.dts-d.dts)/(o-1))}for(var f=0;f<o;f++){var p=r[f].dts,y=r[f+1];if((s=f<o-1?y.dts-p:r[f-1]?Math.min(p-r[f-1].dts,a):a)>MAX_VIDEO_FRAME_DURATION||s<0){this._videoTimestampBreak=!0,s=this._audioTimestampBreak?a:Math.max(s,2700);var m=this._audioNextPts||0;y&&y.dts>m&&(s=a),e.warnings.push({type:WarningType.LARGE_VIDEO_GAP,time:p/e.timescale,dts:p,originDts:r[f].originDts,nextDts:this._videoNextDts,sampleDuration:s,refSampleDuration:a})}r[f].duration=s,this._videoNextDts+=s}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach((function(e){e.pts-=t._baseDts,e.dts=e.pts})),this._doFixAudioInternal(e,r,9e4))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,a=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=a=n[0].dts),this._baseDts=Math.min(i,a);var o=a-i;return Number.isFinite(o)&&Math.abs(o)>LARGE_AV_FIRST_FRAME_GAP&&t.warnings.push({type:WarningType.LARGE_AV_SHIFT,videoBaseDts:a,audioBasePts:i,baseDts:this._baseDts,delta:o}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){if(!this._calculateBaseDts(this.audioTrack,this.videoTrack))return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=AAC$2.getFrameDuration(e.timescale,r));var n=e.sampleDuration;if(void 0===this._audioNextPts){var i=t[0];this._audioNextPts=i.pts}for(var a=0;a<t.length;a++){var o=this._audioNextPts,s=t[a],l=s.pts-o;if(!this._audioTimestampBreak&&l>=AUDIO_GAP_OVERLAP_THRESHOLD_COUNT*n&&l<=MAX_SILENT_FRAME_DURATION&&!isSafari$1){var u=AAC$2.getSilentFrame(e.codec,e.channelCount)||t[0].data.subarray(),c=Math.floor(l/n);Math.abs(s.pts-this._lastAudioExceptionGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION&&(this._lastAudioExceptionGapDot=s.pts),e.warnings.push({type:WarningType.AUDIO_FILLED,pts:s.pts,originPts:s.originPts,count:c,nextPts:o,refSampleDuration:n});for(var d=0;d<c;d++){var h=new AudioSample$1(Math.floor(o),u);h.originPts=Math.floor(this._baseDts+o),t.splice(a,0,h),this._audioNextPts+=n,a++}a--}else l<=-AUDIO_GAP_OVERLAP_THRESHOLD_COUNT*n&&l>=-1*MAX_SILENT_FRAME_DURATION?(Math.abs(s.pts-this._lastAudioExceptionOverlapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION&&(this._lastAudioExceptionOverlapDot=s.pts,e.warnings.push({type:WarningType.AUDIO_DROPPED,pts:s.pts,originPts:s.originPts,nextPts:o,refSampleDuration:n})),t.splice(a,1),a--):(Math.abs(l)>=MAX_SILENT_FRAME_DURATION&&(this._audioTimestampBreak=!0,Math.abs(s.pts-this._lastAudioExceptionLargeGapDot)>AUDIO_EXCETION_LOG_EMIT_DURATION&&(this._lastAudioExceptionLargeGapDot=s.pts,e.warnings.push({type:WarningType.LARGE_AUDIO_GAP,time:s.pts/1e3,pts:s.pts,originPts:s.originPts,nextPts:o,sampleDuration:l,refSampleDuration:n}))),s.dts=s.pts=o,this._audioNextPts+=n)}}}]),e}(),logger$5=new Logger$9("TsDemuxer"),TsDemuxer=function(){function e(t,r,n){_classCallCheck$d(this,e),_defineProperty$d(this,"_pmtId",-1),_defineProperty$d(this,"_remainingPacketData",null),_defineProperty$d(this,"_videoPesData",[]),_defineProperty$d(this,"_audioPesData",[]),_defineProperty$d(this,"_gopId",0),this.videoTrack=t||new VideoTrack$1,this.audioTrack=r||new AudioTrack$1,this.metadataTrack=n||new MetadataTrack$1,this._fixer=new TsFixer(this.videoTrack,this.audioTrack,this.metadataTrack)}return _createClass$e(e,[{key:"demux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.audioTrack,i=this.videoTrack,a=this.metadataTrack;t&&(this._pmtId=-1,i.reset(),n.reset(),a.reset()),!r||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(i.samples=[],n.samples=[],a.seiSamples=[],i.warnings=[],n.warnings=[],this._remainingPacketData&&(e=concatUint8Array$3(this._remainingPacketData,e),this._remainingPacketData=null));var o=e.length,s=o%188;s&&(this._remainingPacketData=e.subarray(o-s),o-=s);for(var l=i.pid,u=n.pid,c=0;c<o;c+=188){if(71!==e[c])throw new Error("TS packet did not start with 0x47");var d=!!(64&e[c+1]),h=((31&e[c+1])<<8)+e[c+2],f=(48&e[c+3])>>4,p=void 0;if(f>1){if((p=c+5+e[c+4])===c+188)continue}else p=c+4;switch(h){case 0:d&&(p+=e[p]+1),this._pmtId=(31&e[p+10])<<8|e[p+11];break;case this._pmtId:d&&(p+=e[p]+1);var y=p+3+((15&e[p+1])<<8|e[p+2])-4,m=(15&e[p+10])<<8|e[p+11];for(p+=12+m;p<y;){var g=(31&e[p+1])<<8|e[p+2];switch(e[p]){case 15:n.pid=u=g;break;case 27:if(-1!==l)break;i.codecType=VideoCodecType$2.AVC,i.pid=l=g;break;case 36:if(-1!==l)break;i.codecType=VideoCodecType$2.HEVC,i.pid=l=g;break;default:logger$5.warn("Unsupported stream. type: ".concat(e[p],", pid: ").concat(g))}p+=5+((15&e[p+3])<<8|e[p+4])}break;case l:d&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(p,c+188));break;case u:d&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(p,c+188));break;case 17:case 8191:break;default:logger$5.warn("Unknown pid: ".concat(h))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=i.formatTimescale=i.timescale=a.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:i,audioTrack:n,metadataTrack:a}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var t=e._parsePES(concatUint8Array$3.apply(void 0,_toConsumableArray$6(this._videoPesData)));if(t){var r=NALu$1.parseAnnexB(t.data);r?this._createVideoSample(r,t.pts,t.dts):logger$5.warn("Cannot parse avc units",t),this._videoPesData=[]}else logger$5.warn("Cannot parse video pes",this._videoPesData)}}},{key:"_createVideoSample",value:function(e,t,r){var n=this;if(e.length){var i=this.videoTrack,a=i.codecType===VideoCodecType$2.HEVC,o=new VideoSample$1(t,r);e.forEach((function(e){var r=a?e[0]>>>1&63:31&e[0];switch(r){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!a&&5!==r||a&&5===r)break;o.setToKeyframe(),n._gopId++;break;case 6:case 39:case 40:if(!a&&6!==r||a&&6===r)break;return void n.metadataTrack.seiSamples.push(new SeiSample(NALu$1.parseSEI(NALu$1.removeEPB(e),a),t));case 32:if(!a)break;if(!i.vps.length){var s=HEVC$1.parseVPS(NALu$1.removeEPB(e),i.hvcC);i.hvcC=i.hvcC||s,i.vps=[e]}break;case 7:case 33:if(!a&&7!==r||a&&7===r)break;if(!i.sps.length){var l=NALu$1.removeEPB(e),u=a?HEVC$1.parseSPS(l,i.hvcC):AVC$1.parseSPS(l);i.sps=[e],i.hvcC=i.hvcC||u.hvcC,i.codec=u.codec,i.width=u.width,i.height=u.height,i.sarRatio=u.sarRatio,i.fpsNum=u.fpsNum,i.fpsDen=u.fpsDen}break;case 8:case 34:if(!a&&8!==r||a&&8===r)break;i.pps.length||(i.pps=[e])}o.units.push(e)})),o.gopId=this._gopId,this._pushVideoSample(i,o)}}},{key:"_pushVideoSample",value:function(e,t){if(t.units.length)if(null===t.pts||void 0===t.pts){logger$5.warn("Video sample no pts",t);var r=e.samples[e.samples.length-1];r?(t.pts=r.pts,t.dts=r.dts):logger$5.warn("Drop video sample",t)}else e.samples.push(t)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var t=e._parsePES(concatUint8Array$3.apply(void 0,_toConsumableArray$6(this._audioPesData)));t?(this._parseAacData(t),this._audioPesData=[]):logger$5.warn("Cannot parse audio pes",this._audioPesData)}}},{key:"_parseAacData",value:function(e){var t=this.audioTrack,r=e.pts;if(null==r){if(logger$5.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;r=t.samples[t.samples.length-1].pts+AAC$2.getFrameDuration(t.sampleRate)}var n,i=AAC$2.parseADTS(e.data,r);i?(t.codec=i.codec,t.channelCount=i.channelCount,t.sampleRate=i.sampleRate,t.objectType=i.objectType,t.sampleRateIndex=i.samplingFrequencyIndex,t.config=i.config,(n=t.samples).push.apply(n,_toConsumableArray$6(i.frames.map((function(e){return new AudioSample$1(e.pts,e.data)})))),i.skip&&logger$5.warn("Skip aac adts ".concat(i.skip," bits")),i.remaining&&logger$5.warn("Remaining aac adts ".concat(i.remaining," bits"))):logger$5.warn("Cannot parse aac adts",e)}}],[{key:"probe",value:function(e){return!!e.length&&(71===e[0]&&71===e[188]&&71===e[376])}},{key:"_parsePES",value:function(e){var t=e[8];if(!(null==t||e.length<t+9)&&1===(e[0]<<16|e[1]<<8|e[2])){var r=(e[4]<<8)+e[5];if(!(r&&r>e.length-6)){var n,i,a=e[7];return 192&a&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&a?n-(i=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(n=i):i=n),{data:e.subarray(9+t),pts:n,dts:i}}}}}]),e}(),MP4Parser$1=function(){function e(){_classCallCheck$d(this,e)}return _createClass$e(e,null,[{key:"findBox",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(!t)return i;for(var a=0,o="",s=0;t.length>7;){if(a=readBig32$2(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),s=8,1===a?(a=readBig64$1(t,8),s+=8):a||(a=t.length),!r[0]||o===r[0]){var l=t.subarray(0,a);if(!(r.length<2))return e.findBox(l.subarray(s),r.slice(1),n+s);i.push({start:n,size:a,headerSize:s,type:o,data:l})}n+=a,t=t.subarray(a)}return i}},{key:"tfhd",value:function(e){return parseBox$1(e,!0,(function(e,t){e.trackId=readBig32$2(t);var r=4,n=1&e.flags,i=2&e.flags,a=8&e.flags,o=16&e.flags,s=32&e.flags;n&&(r+=4,e.baseDataOffset=readBig32$2(t,r),r+=4),i&&(e.sampleDescriptionIndex=readBig32$2(t,r),r+=4),a&&(e.defaultSampleDuration=readBig32$2(t,r),r+=4),o&&(e.defaultSampleSize=readBig32$2(t,r),r+=4),s&&(e.defaultSampleFlags=readBig32$2(t,r))}))}},{key:"sidx",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=0;e.reference_ID=readBig32$2(t,r),r+=4,e.timescale=readBig32$2(t,r),r+=4,0===e.version?(e.earliest_presentation_time=readBig32$2(t,r),r+=4,e.first_offset=readBig32$2(t,r),r+=4):(e.earliest_presentation_time=readBig64$1(t,r),r+=8,e.first_offset=readBig64$1(t,r),r+=8),r+=2,e.references=[];var n=readBig16$1(t,r);r+=2;for(var i=0;i<n;i++){var a={};e.references.push(a);var o=readBig32$2(t,r);r+=4,a.reference_type=o>>31&1,a.referenced_size=2147483647&o,a.subsegment_duration=readBig32$2(t,r),o=readBig32$2(t,r+=4),r+=4,a.starts_with_SAP=o>>31&1,a.SAP_type=o>>28&7,a.SAP_delta_time=268435455&o}}))}},{key:"moov",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.mvhd=e.mvhd(e.findBox(r,["mvhd"],n)[0]),t.trak=e.findBox(r,["trak"],n).map((function(t){return e.trak(t)})),t.pssh=e.pssh(e.findBox(r,["pssh"],n)[0])}))}},{key:"mvhd",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32$2(t,16),e.duration=readBig64$1(t,20),r+=28):(e.timescale=readBig32$2(t,8),e.duration=readBig32$2(t,12),r+=16),e.nextTrackId=readBig32$2(t,r+76)}))}},{key:"trak",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.tkhd=e.tkhd(e.findBox(r,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(r,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=0;1===e.version?(e.trackId=readBig32$2(t,16),e.duration=readBig64$1(t,24),r+=32):(e.trackId=readBig32$2(t,8),e.duration=readBig32$2(t,16),r+=20),e.width=readBig32$2(t,r+52),e.height=readBig32$2(t,r+56)}))}},{key:"mdia",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.mdhd=e.mdhd(e.findBox(r,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(r,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(r,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32$2(t,16),e.duration=readBig64$1(t,20),r+=28):(e.timescale=readBig32$2(t,8),e.duration=readBig32$2(t,12),r+=16);var n=readBig16$1(t,r);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return parseBox$1(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.vmhd=e.vmhd(e.findBox(r,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(r,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(r,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return parseBox$1(e,!0,(function(e,t){e.graphicsmode=readBig16$1(t),e.opcolor=[readBig16$1(t,2),readBig16$1(t,4),readBig16$1(t,6)]}))}},{key:"smhd",value:function(e){return parseBox$1(e,!0,(function(e,t){e.balance=readBig16$1(t)}))}},{key:"stbl",value:function(t){return parseBox$1(t,!1,(function(t,r,n){var i,a,o;t.stsd=e.stsd(e.findBox(r,["stsd"],n)[0]),t.stts=e.stts(e.findBox(r,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(r,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(r,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(r,["stsz"],n)[0]),t.stco=e.stco(e.findBox(r,["stco"],n)[0]),t.stco||(t.co64=e.co64(e.findBox(r,["co64"],n)[0]),t.stco=t.co64);var s=null===(i=t.stsd.entries[0])||void 0===i||null===(a=i.sinf)||void 0===a||null===(o=a.schi)||void 0===o?void 0:o.tenc.default_IV_size;t.stss=e.stss(e.findBox(r,["stss"],n)[0]),t.senc=e.senc(e.findBox(r,["senc"],n)[0],s)}))}},{key:"senc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return parseBox$1(e,!0,(function(e,r){var n=0,i=readBig32$2(r,n);n+=4,e.samples=[];for(var a=0;a<i;a++){for(var o={InitializationVector:[]},s=0;s<t;s++)o.InitializationVector[s]=r[n+s];if(n+=t,2&e.flags){o.subsamples=[];var l=readBig16$1(r,n);n+=2;for(var u=0;u<l;u++){var c={};c.BytesOfClearData=readBig16$1(r,n),n+=2,c.BytesOfProtectedData=readBig32$2(r,n),n+=4,o.subsamples.push(c)}}e.samples.push(o)}}))}},{key:"pssh",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=[],n=[],i=0,a=0;a<16;a++)n.push(toHex$1(t[i+a]));if(i+=16,e.version>0){var o=readBig32$2(t,i);i+=4;for(var s=0;s<(""+o).length;s++)for(var l=0;l<16;l++){var u=t[i];i+=1,r.push(toHex$1(u))}}var c=readBig32$2(t,i);e.data_size=c,i+=4,e.kid=r,e.system_id=n,e.buffer=t}))}},{key:"stsd",value:function(t){return parseBox$1(t,!0,(function(t,r,n){t.entryCount=readBig32$2(r),t.entries=e.findBox(r.subarray(4),[],n+4).map((function(t){switch(t.type){case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t);case"enca":return parseBox$1(t,!1,(function(t,r,n){t.channelCount=readBig16$1(r,16),t.samplesize=readBig16$1(r,18),t.sampleRate=readBig32$2(r,24)/65536,r=r.subarray(28),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.esds=e.esds(e.findBox(r,["esds"],n)[0])}));case"encv":return parseBox$1(t,!1,(function(t,r,n){t.width=readBig16$1(r,24),t.height=readBig16$1(r,26),t.horizresolution=readBig32$2(r,28),t.vertresolution=readBig32$2(r,32),r=r.subarray(78),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.avcC=e.avcC(e.findBox(r,["avcC"],n)[0]),t.hvcC=e.hvcC(e.findBox(r,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(r,["pasp"],n)[0])}))}})).filter(Boolean)}))}},{key:"tenc",value:function(e){return parseBox$1(e,!1,(function(e,t){var r=6;e.default_IsEncrypted=t[r],r+=1,e.default_IV_size=t[r],r+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(toHex$1(t[r])),r+=1}))}},{key:"schi",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.tenc=e.tenc(e.findBox(r,["tenc"],n)[0])}))}},{key:"sinf",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.schi=e.schi(e.findBox(r,["schi"],n)[0]),t.frma=e.frma(e.findBox(r,["frma"],n)[0])}))}},{key:"frma",value:function(e){return parseBox$1(e,!1,(function(e,t){e.data_format="";for(var r=0;r<4;r++)e.data_format+=String.fromCharCode(t[r])}))}},{key:"avc1",value:function(t){return parseBox$1(t,!1,(function(t,r,n){var i=parseVisualSampleEntry$1(t,r),a=r.subarray(i);n+=i,t.avcC=e.avcC(e.findBox(a,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return parseBox$1(e,!1,(function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=getAvcCodec$1([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var r=6,n=0;n<e.spsLength;n++){var i=readBig16$1(t,r);r+=2,e.sps.push(t.subarray(r,r+i)),r+=i}e.ppsLength=t[r],r+=1,e.pps=[];for(var a=0;a<e.ppsLength;a++){var o=readBig16$1(t,r);r+=2,e.pps.push(t.subarray(r,r+=o)),r+=o}}))}},{key:"hvc1",value:function(t){return parseBox$1(t,!1,(function(t,r,n){var i=parseVisualSampleEntry$1(t,r),a=r.subarray(i);n+=i,t.hvcC=e.hvcC(e.findBox(a,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return parseBox$1(e,!1,(function(t,r){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=r[0];var n=r[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=readBig32$2(r,2),t.generalConstraintIndicatorFlags=r.subarray(6,12),t.generalLevelIdc=r[12],t.avgFrameRate=readBig16$1(r,19),t.numOfArrays=r[22],t.vps=[],t.sps=[],t.pps=[];for(var i=23,a=0,o=0,s=0,l=0;l<t.numOfArrays;l++){a=63&r[i],o=readBig16$1(r,i+1),i+=3;for(var u,c=[],d=0;d<o;d++)s=readBig16$1(r,i),i+=2,c.push(r.subarray(i,i+s)),i+=s;if(32===a)(u=t.vps).push.apply(u,c);else if(33===a){var h;(h=t.sps).push.apply(h,c)}else if(34===a){var f;(f=t.pps).push.apply(f,c)}}}))}},{key:"pasp",value:function(e){return parseBox$1(e,!1,(function(e,t){e.hSpacing=readBig32$2(t),e.vSpacing=readBig32$2(t,4)}))}},{key:"mp4a",value:function(t){return parseBox$1(t,!1,(function(t,r,n){var i=parseAudioSampleEntry$1(t,r);t.esds=e.esds(e.findBox(r.subarray(i),["esds"],n+i)[0])}))}},{key:"esds",value:function(e){return parseBox$1(e,!0,(function(e,t){e.codec="mp4a.";for(var r=0,n=0,i=0,a=0;t.length;){for(a=t[r=0],n=t[r+1],r+=2;128&n;)i=(127&n)<<7,n=t[r],r+=1;if(i+=127&n,3===a)t=t.subarray(r+3);else{if(4!==a){if(5===a){var o=e.config=t.subarray(r,r+i),s=(248&o[0])>>3;return 31===s&&o.length>=2&&(s=32+((7&o[0])<<3)+((224&o[1])>>5)),e.objectType=s,e.codec+=s.toString(16),void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}return void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}e.codec+=(t[r].toString(16)+".").padStart(3,"0"),t=t.subarray(r+13)}}}))}},{key:"alaw",value:function(e){return parseBox$1(e,!1,(function(e,t){parseAudioSampleEntry$1(e,t)}))}},{key:"stts",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$2(t),n=[],i=4,a=0;a<r;a++)n.push({count:readBig32$2(t,i),delta:readBig32$2(t,i+4)}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"ctts",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=readBig32$2(t),n=[],i=4;if(1===e.version)for(var a=0;a<r;a++)n.push({count:readBig32$2(t,i),offset:readBig32$2(t,i+4)}),i+=8;else for(var o=0;o<r;o++)n.push({count:readBig32$2(t,i),offset:-(1+~readBig32$2(t,i+4))}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stsc",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$2(t),n=[],i=4,a=0;a<r;a++)n.push({firstChunk:readBig32$2(t,i),samplesPerChunk:readBig32$2(t,i+4),sampleDescriptionIndex:readBig32$2(t,i+8)}),i+=12;e.entryCount=r,e.entries=n}))}},{key:"stsz",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=readBig32$2(t),n=readBig32$2(t,4),i=[];if(!r)for(var a=8,o=0;o<n;o++)i.push(readBig32$2(t,a)),a+=4;e.sampleSize=r,e.sampleCount=n,e.entrySizes=i}))}},{key:"stco",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$2(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32$2(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"co64",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$2(t),n=[],i=4,a=0;a<r;a++)n.push(readBig64$1(t,i)),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stss",value:function(e){return parseBox$1(e,!0,(function(e,t){for(var r=readBig32$2(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32$2(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"moof",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.mfhd=e.mfhd(e.findBox(r,["mfhd"],n)[0]),t.traf=e.findBox(r,["traf"],n).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return parseBox$1(e,!0,(function(e,t){e.sequenceNumber=readBig32$2(t)}))}},{key:"traf",value:function(t){return parseBox$1(t,!1,(function(t,r,n){t.tfhd=e.tfhd(e.findBox(r,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(r,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(r,["trun"],n)[0])}))}},{key:"trun",value:function(e){return parseBox$1(e,!0,(function(e,t){var r=e.version,n=e.flags,i=t.length,a=e.sampleCount=readBig32$2(t),o=4;if(i>o&&1&n&&(e.dataOffset=-(1+~readBig32$2(t,o)),o+=4),i>o&&4&n&&(e.firstSampleFlags=readBig32$2(t,o),o+=4),e.samples=[],i>o)for(var s,l=0;l<a;l++)s={},256&n&&(s.duration=readBig32$2(t,o),o+=4),512&n&&(s.size=readBig32$2(t,o),o+=4),1024&n&&(s.flags=readBig32$2(t,o),o+=4),2048&n&&(s.cts=r?-(1+~readBig32$2(t,o+4)):readBig32$2(t,o),o+=4),e.samples.push(s)}))}},{key:"tfdt",value:function(e){return parseBox$1(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=readBig64$1(t):e.baseMediaDecodeTime=readBig32$2(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,r){var n,i,a=e.trak;if(a&&a.length){var o=a.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),s=a.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(o&&t){var l,u,c,d,h,f,p,y=t,m=null===(l=o.tkhd)||void 0===l?void 0:l.trackId;null!=m&&(y.id=o.tkhd.trackId),y.tkhdDuration=o.tkhd.duration,y.mvhdDurtion=e.mvhd.duration,y.mvhdTimecale=e.mvhd.timescale,y.timescale=y.formatTimescale=o.mdia.mdhd.timescale,y.duration=o.mdia.mdhd.duration||y.mvhdDurtion/y.mvhdTimecale*y.timescale;var g,v,b,_,E,T,S,$,A=o.mdia.minf.stbl.stsd.entries[0];if(y.width=A.width,y.height=A.height,A.pasp&&(y.sarRatio=[A.pasp.hSpacing,A.pasp.vSpacing]),A.hvcC)y.codecType=VideoCodecType$2.HEVC,y.codec=A.hvcC.codec,y.vps=A.hvcC.vps,y.sps=A.hvcC.sps,y.pps=A.hvcC.pps,y.hvcC=A.hvcC.data;else{if(!A.avcC)throw new Error("unknown video stsd entry");y.codec=A.avcC.codec,y.sps=A.avcC.sps,y.pps=A.avcC.pps}if(y.present=!0,y.ext={},y.ext.stss=null===(u=o.mdia)||void 0===u||null===(c=u.minf)||void 0===c||null===(d=c.stbl)||void 0===d?void 0:d.stss,y.ext.ctts=null===(h=o.mdia)||void 0===h||null===(f=h.minf)||void 0===f||null===(p=f.stbl)||void 0===p?void 0:p.ctts,A&&"encv"===A.type)y.isVideoEncryption=!0,A.default_KID=null===(g=A.sinf)||void 0===g||null===(v=g.schi)||void 0===v?void 0:v.tenc.default_KID,A.default_IsEncrypted=null===(b=A.sinf)||void 0===b||null===(_=b.schi)||void 0===_?void 0:_.tenc.default_IsEncrypted,A.default_IV_size=null===(E=A.sinf)||void 0===E||null===(T=E.schi)||void 0===T?void 0:T.tenc.default_IV_size,y.videoSenc=o.mdia.minf.stbl.senc&&o.mdia.minf.stbl.senc.samples,A.data_format=null===(S=A.sinf)||void 0===S||null===($=S.frma)||void 0===$?void 0:$.data_format,y.useEME=e.useEME,y.kidValue=e.kidValue,y.pssh=e.pssh,y.encv=A}if(s&&r){var w,k,I,C,P,x,R,O,L,D=r,M=null===(w=s.tkhd)||void 0===w?void 0:w.trackId;null!=M&&(D.id=s.tkhd.trackId),D.tkhdDuration=s.tkhd.duration,D.mvhdDurtion=e.mvhd.duration,D.mvhdTimecale=e.mvhd.timescale,D.timescale=D.formatTimescale=s.mdia.mdhd.timescale,D.duration=s.mdia.mdhd.duration||D.mvhdDurtion/D.mvhdTimecale*D.timescale;var N,G,V,U,Z,B,F,j,W=s.mdia.minf.stbl.stsd.entries[0];switch(D.sampleSize=W.sampleSize,D.sampleRate=W.sampleRate,D.channelCount=W.channelCount,D.present=!0,W.type){case"alaw":D.codecType=D.codec=AudioCodecType$1.G711PCMA,D.sampleRate=8e3;break;case"ulaw":D.codecType=D.codec=AudioCodecType$1.G711PCMU,D.sampleRate=8e3;break;default:D.sampleDuration=AAC$2.getFrameDuration(D.sampleRate,D.timescale),D.sampleRateIndex=AAC$2.getRateIndexByRate(D.sampleRate),D.objectType=(null===(n=W.esds)||void 0===n?void 0:n.objectType)||2,W.esds&&(D.config=Array.from(W.esds.config)),D.codec=(null===(i=W.esds)||void 0===i?void 0:i.codec)||"mp4a.40.2"}if(D.sampleDuration=AAC$2.getFrameDuration(D.sampleRate,D.timescale),D.objectType=(null===(k=W.esds)||void 0===k?void 0:k.objectType)||2,W.esds&&(W.esds.config?D.config=Array.from(W.esds.config):console.warn("esds config is null")),D.codec=(null===(I=W.esds)||void 0===I?void 0:I.codec)||"mp4a.40.2",D.sampleRateIndex=AAC$2.getRateIndexByRate(D.sampleRate),D.ext={},D.ext.stss=null===(C=s.mdia)||void 0===C||null===(P=C.minf)||void 0===P||null===(x=P.stbl)||void 0===x?void 0:x.stss,D.ext.ctts=null===(R=s.mdia)||void 0===R||null===(O=R.minf)||void 0===O||null===(L=O.stbl)||void 0===L?void 0:L.ctts,D.present=!0,W&&"enca"===W.type)D.isAudioEncryption=!0,W.data_format=null===(N=W.sinf)||void 0===N||null===(G=N.frma)||void 0===G?void 0:G.data_format,W.default_KID=null===(V=W.sinf)||void 0===V||null===(U=V.schi)||void 0===U?void 0:U.tenc.default_KID,W.default_IsEncrypted=null===(Z=W.sinf)||void 0===Z||null===(B=Z.schi)||void 0===B?void 0:B.tenc.default_IsEncrypted,W.default_IV_size=null===(F=W.sinf)||void 0===F||null===(j=F.schi)||void 0===j?void 0:j.tenc.default_IV_size,D.audioSenc=s.mdia.minf.stbl.senc&&s.mdia.minf.stbl.senc.samples,D.useEME=e.useEME,D.kidValue=e.kidValue,D.enca=W}if(r&&(r.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!r&&r.isAudioEncryption),null!=t&&t.encv||null!=r&&r.enca){var X,H,K=null==t||null===(X=t.encv)||void 0===X?void 0:X.default_KID,Y=null==r||null===(H=r.enca)||void 0===H?void 0:H.default_KID,z=K||Y?(K||Y).join(""):null;t&&(t.kid=z),r&&(r.kid=z)}return t&&(t.flags=3841),r&&(r.flags=1793),{videoTrack:t,audioTrack:r}}}},{key:"evaluateDefaultDuration",value:function(e,t,r){var n,i=null==t||null===(n=t.samples)||void 0===n?void 0:n.length;return i?1024*i/t.timescale*e.timescale/r:1024}},{key:"moofToSamples",value:function(t,r,n){var i={};return t.mfhd&&(r&&(r.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var a=t.tfhd,o=t.tfdt,s=t.trun;if(a&&s){o&&(r&&r.id===a.trackId&&(r.baseMediaDecodeTime=o.baseMediaDecodeTime),n&&n.id===a.trackId&&(n.baseMediaDecodeTime=o.baseMediaDecodeTime));var l=a.defaultSampleSize||0,u=a.defaultSampleDuration||e.evaluateDefaultDuration(r,n,s.samples.length||s.sampleCount),c=s.dataOffset||0,d=0,h=-1;if(!s.samples.length&&s.sampleCount){i[a.trackId]=[];for(var f=0;f<s.sampleCount;f++)i[a.trackId].push({offset:c,dts:d,duration:u,size:l}),d+=u,c+=l}else i[a.trackId]=s.samples.map((function(e,t){return(e={offset:c,dts:d,pts:d+(e.cts||0),duration:e.duration||u,size:e.size||l,gopId:h,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(h++,e.gopId=h),d+=e.duration,c+=e.size,e}))}})),i}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var r=t.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),n=t.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(r||n){var i,a;if(r){var o,s,l=null===(o=r.mdia)||void 0===o||null===(s=o.minf)||void 0===s?void 0:s.stbl;if(!l)return;var u=l.stts,c=l.stsc,d=l.stsz,h=l.stco,f=l.stss,p=l.ctts;if(!(u&&c&&d&&h&&f))return;i=getSamples$1(u,c,d,h,p,f)}if(n){var y,m,g,v=null===(y=n.mdia)||void 0===y||null===(m=y.minf)||void 0===m?void 0:m.stbl;if(!v)return;var b=null===(g=n.mdia.mdhd)||void 0===g?void 0:g.timescale,_=v.stts,E=v.stsc,T=v.stsz,S=v.stco;if(!(b&&_&&E&&T&&S))return;a=getSamples$1(_,E,T,S)}return{videoSamples:i,audioSamples:a}}}}}]),e}();function getSamples$1(e,t,r,n,i,a){var o,s,l,u=[],c=null==i?void 0:i.entries,d=t.entries,h=n.entries,f=r.entrySizes,p=null==a?void 0:a.entries;p&&(o={},p.forEach((function(e){o[e-1]=!0}))),c&&(s=[],c.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)s.push(r)})));var y=-1,m=0,g=0,v=0,b=0,_=0,E=d[0].samplesPerChunk,T=d[1]?d[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,i=0;i<t;i++)l={dts:m,duration:n,size:f[g]||r.sampleSize,offset:h[v]+_,index:g},p&&(l.keyframe=o[g],l.keyframe&&y++,l.gopId=y),s&&g<s.length&&(l.pts=l.dts+s[g]),u.push(l),m+=n,++g<E?_+=l.size:(v++,_=0,v>=T&&(b++,T=d[b+1]?d[b+1].firstChunk-1:1/0),E+=d[b].samplesPerChunk)})),u}function parseVisualSampleEntry$1(e,t){return e.dataReferenceIndex=readBig16$1(t,6),e.width=readBig16$1(t,24),e.height=readBig16$1(t,26),e.horizresolution=readBig32$2(t,28),e.vertresolution=readBig32$2(t,32),e.frameCount=readBig16$1(t,40),e.depth=readBig16$1(t,74),78}function parseAudioSampleEntry$1(e,t){return e.dataReferenceIndex=readBig16$1(t,6),e.channelCount=readBig16$1(t,16),e.sampleSize=readBig16$1(t,18),e.sampleRate=readBig32$2(t,24)/65536,28}function parseBox$1(e,t,r){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=readBig24$1(e.data,e.headerSize+1),n.headerSize+=4),r(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var padStart$1=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},toHex$1=function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(padStart$1(Number(t).toString(16),2,0))})),e[0]},FMP4Demuxer=function(){function e(t,r,n){_classCallCheck$d(this,e),this.videoTrack=t||new VideoTrack$1,this.audioTrack=r||new AudioTrack$1,this.metadataTrack=n||new MetadataTrack$1}return _createClass$e(e,[{key:"demux",value:function(e,t){var r=this.videoTrack,n=this.audioTrack,i=r.exist(),a=n.exist();if(r.samples=[],n.samples=[],t){if(!a){var o=MP4Parser$1.findBox(t,["moov"])[0];if(!o)throw new Error("cannot found moov box");MP4Parser$1.moovToTrack(MP4Parser$1.moov(o),null,n)}var s=MP4Parser$1.findBox(t,["moof"])[0];if(s){var l=MP4Parser$1.moofToSamples(MP4Parser$1.moof(s),null,n)[n.id],u=n.baseMediaDecodeTime;if(l){var c=s.start;l.map((function(e){e.offset+=c;var r=t.subarray(e.offset,e.offset+e.size);n.samples.push(new AudioSample$1(e.dts+u,r,e.duration))}))}}}if(e){if(!i&&!a){var d=MP4Parser$1.findBox(e,["moov"])[0];if(!d)throw new Error("cannot found moov box");MP4Parser$1.moovToTrack(MP4Parser$1.moov(d),r,n)}var h=MP4Parser$1.findBox(e,["moof"])[0];if(h){var f,p=MP4Parser$1.moofToSamples(MP4Parser$1.moof(h),r,n),y=r.baseMediaDecodeTime,m=n.baseMediaDecodeTime,g=h.start;Object.keys(p).forEach((function(t){r.id==t?p[t].map((function(t){t.offset+=g;var n=new VideoSample$1((t.pts||t.dts)+y,t.dts+y);n.duration=t.duration,n.gopId=t.gopId,t.keyframe&&n.setToKeyframe();var i=e.subarray(t.offset,t.offset+t.size);n.data=i;for(var a=0,o=i.length-1;a<o;)f=readBig32$2(i,a),a+=4,n.units.push(i.subarray(a,a+f)),a+=f;r.samples.push(n)})):n.id==t&&p[t].map((function(t){t.offset+=g;var r=e.subarray(t.offset,t.offset+t.size);n.samples.push(new AudioSample$1(t.dts+m,r,t.duration))}))}))}}return{videoTrack:r,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return MP4Parser$1.probe(e)}}]),e}();function Concat$1(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];n.forEach((function(e){t+=e.length}));var a=new e(t),o=0;return n.forEach((function(e){a.set(e,o),o+=e.length})),a}var Buffer$3=function(){function e(){_classCallCheck$d(this,e),this.buffer=new Uint8Array(0)}return _createClass$e(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){t?e.buffer=Concat$1(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),UINT32_MAX$2=Math.pow(2,32)-1,MP4$3=function(){function e(){_classCallCheck$d(this,e)}return _createClass$e(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType$2.VIDEO&&e.codecType===VideoCodecType$2.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array$3(e.ftyp(t),e.moov(t))}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],parse$2(t.kid),[0,0,0,0]));return e.box(e.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(_toConsumableArray$6(t.map((function(t){return e.trak(t)}))),[r]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(_toConsumableArray$6(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]));return a}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]));return n}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType$2.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){var r=[];return t&&t.ext&&t.ext.stss&&r.push(e.stss(t.ext.stss.entries)),e.box(e.types.stbl,e.stsd(t),e.STTS,r[0],e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){var r;return r="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):e.avc1hev1(t),e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r)}},{key:"enca",value:function(t){var r=t.enca.channelCount,n=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,i,a,o)}},{key:"encv",value:function(t){var r,n,i=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],o=t.width,s=t.height,l=t.sarRatio[0],u=t.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((r=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(n,_toConsumableArray$6(i)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(r,_toConsumableArray$6(a))),h=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u]);return e.box(e.types.encv,c,e.box(e.types.avcC,d),e.box(e.types.btrt,h),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var r=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,r,n)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(parse$2(t.default_KID)));return e.box(e.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,r,e.box(e.types.frma,n),e.box(e.types.schm,i),a)}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType$2.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n,i,a=[],o=[];return t.sps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,_toConsumableArray$6(e))})),t.pps.forEach((function(e){i=e.byteLength,o.push(i>>>8&255),o.push(255&i),o.push.apply(o,_toConsumableArray$6(e))})),e.box(e.types.avcC,new Uint8Array((r=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(r,o)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,l=r.generalConstraintIndicatorFlags,u=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,l[0],l[1],l[2],l[3],l[4],l[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,u];var c=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,_toConsumableArray$6(e))};i.length&&(n.push(160,0,i.length),i.forEach(c)),a.length&&(n.push(161,0,a.length),a.forEach(c)),o.length&&(n.push(162,0,o.length),o.forEach(c))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=_slicedToArray$4(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(_toConsumableArray$6(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(t){return e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(_toConsumableArray$6(t.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){var r=e.tfhd(t.id),n=e.tfdt(t,t.baseMediaDecodeTime),i=0;if(t.isVideo&&t.videoSenc&&t.videoSenc.forEach((function(e){i+=8,e.subsamples&&e.subsamples.length&&(i+=2,i+=6*e.subsamples.length)})),t.videoSencLength=i,t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(t.isVideo){var a=e.saiz(t),o=e.saio(t),s=e.trun1(t),l=e.senc(t);return e.box(e.types.traf,r,n,a,o,s,l)}if(t.isAudioEncryption){var u=e.sbgp(),c=e.saiz(t),d=e.saio(t),h=e.senc(t),f=e.trun1(t);return e.box(e.types.traf,r,n,u,c,d,h,f)}var p=e.sbgp(),y=e.trun1(t);return e.box(e.types.traf,r,n,p,y)}if(t.isVideo){var m=e.trun1(t);return e.box(e.types.traf,r,n,m)}var g=e.sbgp(),v=e.saiz(t),b=e.saio(t),_=e.senc(t),E=e.trun1(t);return e.box(e.types.traf,r,n,g,v,b,_,E)}var T=e.sdtp(t);return e.box(e.types.traf,r,n,T,e.trun(t.samples,T.byteLength+76))}},{key:"sdtp",value:function(t){var r=new Buffer$3;return t.samples.forEach((function(e){r.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Buffer$3,n=Buffer$3.writeUint32(t.samples.length),i=null;if(t.isVideo){var a=t.videoSencLength;i=Buffer$3.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Buffer$3.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),i=Buffer$3.writeUint32(o)}return t.samples.forEach((function(e){r.write(Buffer$3.writeUint32(e.duration)),r.write(Buffer$3.writeUint32(e.size)),r.write(Buffer$3.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&r.write(Buffer$3.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(t){var r=new Buffer$3,n=t.samples.length,i=t.isVideo?16:8,a=t.isVideo?2:0,o=[],s=0;return t.isVideo?(o=t.videoSenc,s=t.videoSencLength):o=t.audioSenc,s=s||i*n,r.write(Buffer$3.writeUint32(16+s),e.types.senc,this.extension(0,a)),r.write(Buffer$3.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(Buffer$3.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){r.write(Buffer$3.writeUint16(e.BytesOfClearData)),r.write(Buffer$3.writeUint32(e.BytesOfProtectedData))})))})),r.buffer}},{key:"saio",value:function(t){var r=12*t.samples.length+141;!t.isVideo&&t.isAudioEncryption&&(r=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var r=t.samples.length,n=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,r){var n=Math.floor(r/(UINT32_MAX$2+1)),i=Math.floor(r%(UINT32_MAX$2+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],l=s.duration,u=s.size,c=s.flag,d=void 0===c?{}:c,h=s.cts,f=void 0===h?0:h;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,d.isLeading<<2|(null===d.dependsOn||void 0===d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null===d.isNonSyncSample||void 0===d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$6(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType$2.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array$3(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array$3(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,n=t.samples[0].duration,i=n*t.samples.length,a=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var s=0;if(t.isVideo){var l,u=0;t.videoSenc&&(l=t.videoSenc),t.isVideo&&l.forEach((function(e){u+=8,e.subsamples&&e.subsamples.length&&(u+=2,u+=6*e.subsamples.length)})),t.videoSencLength=u,s=o+141+16*t.samples.length+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(s=o+16*t.samples.length+84)}else s=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(s=o+169+12*t.samples.length+8*t.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,255&t.id,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,c)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();_defineProperty$d(MP4$3,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty$d(MP4$3,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty$d(MP4$3,"FTYPAVC1",MP4$3.box(MP4$3.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty$d(MP4$3,"FTYPHEV1",MP4$3.box(MP4$3.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty$d(MP4$3,"DINF",MP4$3.box(MP4$3.types.dinf,MP4$3.box(MP4$3.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty$d(MP4$3,"VMHD",MP4$3.box(MP4$3.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty$d(MP4$3,"SMHD",MP4$3.box(MP4$3.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty$d(MP4$3,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty$d(MP4$3,"STTS",MP4$3.box(MP4$3.types.stts,MP4$3.StblTable)),_defineProperty$d(MP4$3,"STSC",MP4$3.box(MP4$3.types.stsc,MP4$3.StblTable)),_defineProperty$d(MP4$3,"STSZ",MP4$3.box(MP4$3.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty$d(MP4$3,"STCO",MP4$3.box(MP4$3.types.stco,MP4$3.StblTable));var Logger$8=function(){function e(t,r){_classCallCheck$d(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=r}return _createClass$e(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$d(Logger$8,"disabled",!0);var FMP4Remuxer$2=function(){function e(t,r,n){_classCallCheck$d(this,e),this.videoTrack=t,this.audioTrack=r;var i=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=i&&Number(i[1])<50,this.log=new Logger$8("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return _createClass$e(e,[{key:"remux",value:function(){var e,t,r,n,i,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.videoTrack,l=this.audioTrack,u=s.exist(),c=l.exist(),d=[];return a&&(o&&o.initMerge?(u&&d.push(this.videoTrack),c&&d.push(this.audioTrack),r=MP4$3.initSegment(d)):(u&&(e=MP4$3.initSegment([this.videoTrack])),c&&(t=MP4$3.initSegment([this.audioTrack])))),u&&s.hasSample()&&(n=this._remuxVideo()),c&&l.hasSample()&&(i=this._remuxAudio()),s.samples=[],l.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var l=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,l+=4+e.byteLength})),s.size=l,u=o,n=s},s=0,l=t.length,u=0;s<l;s++)o(s,0,u,n);var c=MP4$3.mdat(i);return concatUint8Array$3(MP4$3.moof([e]),c)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,r){return t.set(r.data,e),e+r.size}),0);var r=MP4$3.mdat(t);return concatUint8Array$3(MP4$3.moof([e]),r)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),Event$4=_objectSpread2$8(_objectSpread2$8({},EVENT$2),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",DEMUXED_TRACK:"demuxedtrack"});function getConfig$4(e){var t=(null==e?void 0:e.media)||document.createElement("video");return _objectSpread2$8(_objectSpread2$8({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,loadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,targetLatency:(null==e?void 0:e.preloadTime)||10,maxLatency:null!=e&&e.preloadTime?2*e.preloadTime:20},e),{},{media:t})}function clamp(e,t,r){return Math.min(Math.max(e,t),r)}var Stream$1=function(){function e(t,r){_classCallCheck$e(this,e),_defineProperty$e(this,"live",void 0),_defineProperty$e(this,"id",0),_defineProperty$e(this,"bitrate",0),_defineProperty$e(this,"width",0),_defineProperty$e(this,"height",0),_defineProperty$e(this,"name",""),_defineProperty$e(this,"url",""),_defineProperty$e(this,"audioCodec",""),_defineProperty$e(this,"videoCodec",""),_defineProperty$e(this,"textCodec",""),_defineProperty$e(this,"startCC",0),_defineProperty$e(this,"endCC",0),_defineProperty$e(this,"startSN",0),_defineProperty$e(this,"endSN",-1),_defineProperty$e(this,"totalDuration",0),_defineProperty$e(this,"targetDuration",0),_defineProperty$e(this,"snDiff",null),_defineProperty$e(this,"segments",[]),_defineProperty$e(this,"audioStreams",[]),_defineProperty$e(this,"currentAudioStream",null),this.update(t,r)}return _createClass$f(e,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var e;return this.targetDuration||(null===(e=this.segments[0])||void 0===e?void 0:e.duration)||0}},{key:"liveEdge",get:function(){return this.endTime}},{key:"endTime",get:function(){var e;return(null===(e=this.lastSegment)||void 0===e?void 0:e.end)||0}},{key:"clearOldSegment",value:function(e,t){return this.currentAudioStream&&this._clearSegments(this.currentAudioStream,e,t),this._clearSegments(this,e,t)}},{key:"getAudioSegment",value:function(e){if(e&&this.currentAudioStream){var t=e.sn-this.snDiff;return this.currentAudioStream.segments.find((function(e){return e.sn===t}))}}},{key:"update",value:function(e,t){this.url=e.url,Array.isArray(e.segments)?(null!==this.live&&void 0!==this.live||(this.live=e.live),this._updateSegments(e,this),this.startCC=e.startCC,this.endCC=e.endCC,this.startSN=e.startSN,this.endSN=e.endSN||-1,this.totalDuration=e.totalDuration,this.targetDuration=e.targetDuration,this.live=e.live,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),(null===this.snDiff||void 0===this.snDiff)&&e.segments.length&&t.segments.length&&(this.snDiff=e.segments[0].sn-t.segments[0].sn))):(this.id=e.id,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.name=e.name,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.textCodec=e.textCodec,this.audioStreams=e.audioStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find((function(e){return e.default}))||this.audioStreams[0]))}},{key:"_clearSegments",value:function(e,t){for(var r=0,n=this.segments,i=0,a=n.length;i<a;i++)if(n[i].end>=e){r=i;break}return r>t&&(r=t),r&&(this.segments=this.segments.slice(r),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(r))),t-r}},{key:"_updateSegments",value:function(e,t){var r=t.segments;if(this.live){var n=r[r.length-1],i=(null==n?void 0:n.sn)||-1;if(i<e.endSN&&e.segments.length){var a=e.segments.findIndex((function(e){return e.sn===i})),o=a<0?e.segments:e.segments.slice(a+1);if(r.length&&o.length){var s=n.end;o.forEach((function(e){e.start=s,s=e.end}));var l=(null==n?void 0:n.cc)||-1;l>o[0].cc&&o.forEach((function(e){return e.cc+=l}))}t.segments=r.concat(o)}}else t.segments=e.segments}}]),e}(),Playlist=function(){function e(t){_classCallCheck$e(this,e),_defineProperty$e(this,"streams",[]),_defineProperty$e(this,"currentStream",null),_defineProperty$e(this,"dvrWindow",0),_defineProperty$e(this,"_segmentPointer",-1),this.hls=t}return _createClass$f(e,[{key:"lastSegment",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.lastSegment}},{key:"currentSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer]}},{key:"nextSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.segments}},{key:"liveEdge",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.liveEdge}},{key:"seekRange",get:function(){var e=this.currentSegments;if(e&&e.length)return[e[0].start,e[e.length-1].end]}},{key:"isEmpty",get:function(){var e;return!(null!==(e=this.currentSegments)&&void 0!==e&&e.length)}},{key:"isLive",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.live}},{key:"getAudioSegment",value:function(e){var t;return null===(t=this.currentStream)||void 0===t?void 0:t.getAudioSegment(e)}},{key:"moveSegmentPointer",value:function(e){var t;null==e&&(e=this._segmentPointer+1),this._segmentPointer=clamp(e,-1,null===(t=this.currentSegments)||void 0===t?void 0:t.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(e){var t;return null===(t=this.currentSegments)||void 0===t?void 0:t[e]}},{key:"setNextSegmentByIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._segmentPointer=e-1}},{key:"findSegmentIndexByTime",value:function(e){var t=this.currentSegments;if(t){for(var r,n=0,i=t.length;n<i;n++)if(e>=(r=t[n]).start&&e<r.end)return n;var a=t[t.length-1];if(Math.abs(e-a.end)<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(e,t){var r=this;if(e){if(e.isMaster)this.streams.length=e.streams.length,e.streams.filter((function(e){return e.url})).forEach((function(e,t){r.streams[t]?r.streams[t].update(e):r.streams[t]=new Stream$1(e)})),this.currentStream=this.streams[0];else if(Array.isArray(e.segments)){var n=this.currentStream;n?n.update(e,t):(this.reset(),this.currentStream=this.streams[0]=new Stream$1(e,t))}this.currentStream&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce((function(e,t){return e+=t.duration}),0))}}},{key:"clearOldSegment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=this.currentStream;if(this.dvrWindow&&t){var r=t.endTime-this.dvrWindow;if(!(r<=0)){var n=t.segments;n.length<=e||(this._segmentPointer=t.clearOldSegment(r,this._segmentPointer))}}}}]),e}(),Decryptor=function(){function e(){_classCallCheck$e(this,e);var t=window.crypto||window.msCrypto;this.subtle=t&&(t.subtle||t.webkitSubtle),this.externalDecryptor=null}var t,r;return _createClass$f(e,[{key:"decrypt",value:function(e,t){if(e||t){var r=[];return e&&(r[0]=this._decryptSegment(e)),t&&(r[1]=this._decryptSegment(t)),Promise.all(r)}}},{key:"_decryptSegment",value:(r=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){var r;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,!t.key){e.next=5;break}return e.next=4,this._decryptData(t.data,t.key,t.keyIv);case 4:r=e.sent;case 5:if(t.map){e.next=7;break}return e.abrupt("return",r);case 7:return e.abrupt("return",concatUint8Array$5(t.map,r));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_decryptData",value:(t=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t,r,n){var i;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.externalDecryptor){e.next=6;break}return e.next=3,this.externalDecryptor.decrypt(t,r,n);case 3:return e.abrupt("return",e.sent);case 6:if(this.subtle){e.next=8;break}throw new Error("crypto is not defined");case 8:return e.next=10,this.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return i=e.sent,e.t0=Uint8Array,e.next=14,this.subtle.decrypt({name:"AES-CBC",iv:n},i,t);case 14:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 16:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}(),logger$4=new Logger$c("Transmuxer"),Transmuxer=function(){function e(t,r,n){_classCallCheck$e(this,e),_defineProperty$e(this,"_initSegmentId",""),this.hls=t,this._demuxer=r?new FMP4Demuxer:new TsDemuxer,this._isMP4=r,n&&(this._remuxer=new FMP4Remuxer$2(this._demuxer.videoTrack,this._demuxer.audioTrack))}return _createClass$f(e,[{key:"transmux",value:function(e,t,r,n,i,a){var o=this._demuxer;try{this._isMP4?o.demux(e,t):o.demuxAndFix(concatUint8Array$5(e,t),r,n,i)}catch(error){throw new StreamingError$2(ERR$2.DEMUX,ERR$2.SUB_TYPES.HLS,error)}var s=o.videoTrack,l=o.audioTrack,u=o.metadataTrack,c="".concat(s.codec,"/").concat(s.width,"/").concat(s.height,"/").concat(l.codec,"/").concat(l.config);if(c!==this._initSegmentId&&(this._initSegmentId=c,a=!0),this._fireEvents(s,l,u,r||a),this.hls.emit(Event$4.DEMUXED_TRACK,s),!this._remuxer)return[s,l];try{var d=this._remuxer.remux(a),h=d.videoInitSegment,f=d.videoSegment,p=d.audioInitSegment,y=d.audioSegment,m=concatUint8Array$5(h,f),g=concatUint8Array$5(p,y);return[m?{codec:s.codec,data:m}:void 0,g?{codec:l.codec,data:g}:void 0]}catch(error){throw new StreamingError$2(ERR$2.REMUX,ERR$2.SUB_TYPES.FMP4,error)}}},{key:"_fireEvents",value:function(e,t,r,n){var i=this;logger$4.debug(e.samples,t.samples),n&&(e.exist()&&this.hls.emit(Event$4.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.hls.emit(Event$4.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),logger$4.debug("discontinuity",e,t)),e.warnings.forEach((function(e){var t;switch(e.type){case WarningType.LARGE_AV_SHIFT:t=Event$4.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case WarningType.LARGE_VIDEO_GAP:t=Event$4.LARGE_VIDEO_DTS_GAP_DETECT;break;case WarningType.LARGE_VIDEO_GAP_BETWEEN_CHUNK:t=Event$4.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT}t&&i.hls.emit(Event$4.STREAM_EXCEPTION,_objectSpread2$8(_objectSpread2$8({},e),{},{type:t})),logger$4.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case WarningType.LARGE_AUDIO_GAP:t=Event$4.LARGE_AUDIO_DTS_GAP_DETECT;break;case WarningType.AUDIO_FILLED:t=Event$4.AUDIO_GAP_DETECT;break;case WarningType.AUDIO_DROPPED:t=Event$4.AUDIO_OVERLAP_DETECT}t&&i.hls.emit(Event$4.STREAM_EXCEPTION,_objectSpread2$8(_objectSpread2$8({},e),{},{type:t})),logger$4.warn("audio exception",e)})),e.samples.forEach((function(e){e.keyframe&&i.hls.emit(Event$4.KEYFRAME,{pts:e.pts})})),r.seiSamples.forEach((function(e){i.hls.emit(Event$4.SEI,_objectSpread2$8(_objectSpread2$8({},e),{},{originPts:e.originPts/90,sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))}}]),e}(),logger$3=new Logger$c("BufferService"),BufferService=function(){function e(t){if(_classCallCheck$e(this,e),_defineProperty$e(this,"_decryptor",new Decryptor),_defineProperty$e(this,"_transmuxer",null),_defineProperty$e(this,"_mse",null),_defineProperty$e(this,"_softVideo",null),_defineProperty$e(this,"_sourceCreated",!1),_defineProperty$e(this,"_needInitSegment",!0),_defineProperty$e(this,"_directAppend",!1),this.hls=t,t.config.softDecode)this._softVideo=t.media;else{this._mse=new MSE$2;var r=this._mse.bindMedia(t.media);r&&r.then&&r.then((function(){t&&t.emit("sourceAttached")}))}t.config.decryptor&&(this._decryptor.externalDecryptor=t.config.decryptor)}var t,r,n,i,a,o,s,l;return _createClass$f(e,[{key:"baseDts",get:function(){var e,t,r;return null===(e=this._transmuxer)||void 0===e||null===(t=e._demuxer)||void 0===t||null===(r=t._fixer)||void 0===r?void 0:r._baseDts}},{key:"updateDuration",value:(l=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(logger$3.debug("update duration",t),!this._mse){e.next=9;break}if(this._mse.isOpened){e.next=5;break}return e.next=5,this._mse.open();case 5:return e.next=7,this._mse.updateDuration(t);case 7:e.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"createSource",value:function(e,t,r,n){if(!this._sourceCreated){var i=e||t;if(i){if(TsDemuxer.probe(i))this._transmuxer||(this._transmuxer=new Transmuxer(this.hls,!1,!this._softVideo));else{if(!MP4Parser$1.probe(i))throw new StreamingError$2(ERR$2.OTHER,null,null,null,"unsupported stream");if(this._softVideo)this._transmuxer||(this._transmuxer=new Transmuxer(this.hls,!0));else{this._directAppend=!0;var a=!1;e&&!r&&MP4Parser$1.findBox(e,["moov","trak"]).forEach((function(e){var t=MP4Parser$1.findBox(e.data,["trak","mdia","minf","stbl","stsd"])[0];if(t){var i=MP4Parser$1.stsd(t).entries[0];if(i)if(i.hvcC)r=i.hvcC.codec||"hev1.1.6.L93.B0";else if(i.avcC)r=i.avcC.codec;else if(i.sampleRate||i.esds){var o;n=(null===(o=i.esds)||void 0===o?void 0:o.codec)||"mp4a.40.2",a=!0}}})),t&&!n&&MP4Parser$1.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach((function(e){var t=MP4Parser$1.stsd(e).entries[0];t&&t.esds&&(n=t.esds.codec)})),e&&!r&&(r="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),a&&(r+=", ".concat(n),n=""),this._createMseSource(r,n)}}this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:(s=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t,r,n,i,a){var o,s,l,u,c,d,h,f;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.length||null!=r&&r.length){e.next=2;break}return e.abrupt("return");case 2:if(!this._directAppend){e.next=7;break}return o=[],t&&o.push(this._mse.append(MSE$2.VIDEO,t)),r&&o.push(this._mse.append(MSE$2.AUDIO,r)),e.abrupt("return",Promise.all(o));case 7:if(s=this._needInitSegment||n,l=this._transmuxer.transmux(t,r,n,i,a,this._needInitSegment||n),u=_slicedToArray$5(l,2),c=u[0],d=u[1],c&&!d&&this.hls.emit(Event$4.NO_AUDIO_TRACK),!this._softVideo){e.next=15;break}this._softVideo.appendBuffer(c,d),this._needInitSegment=!1,e.next=25;break;case 15:if(!this._mse){e.next=25;break}return(h=!this._sourceCreated)&&this._createMseSource(null==c?void 0:c.codec,null==d?void 0:d.codec),this._needInitSegment=!1,f=this._mse,o=[],s&&!h&&this._handleCodecChange(c,d),c&&o.push(f.append(MSE$2.VIDEO,c.data)),d&&o.push(f.append(MSE$2.AUDIO,d.data)),e.abrupt("return",Promise.all(o));case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return s.apply(this,arguments)})},{key:"evictBuffer",value:(o=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){var r,n,i,a=this;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.hls.media,this._mse&&r&&t&&!(t<0)){e.next=3;break}return e.abrupt("return");case 3:if(n=r.currentTime,!((i=n-t)<=0)){e.next=7;break}return e.abrupt("return");case 7:if(!(Buffer$5.start(Buffer$5.get(r))+1>=i)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this._mse.clearBuffer(0,i).then((function(){return a.hls.emit(EVENT$2.REMOVE_BUFFER,{removeEnd:i})})));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"clearAllBuffer",value:(a=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=2;break}return e.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"decryptBuffer",value:function(e,t){return this._decryptor.decrypt(e,t)}},{key:"reset",value:(i=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){var t,r=arguments;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],!this._mse||t){e.next=6;break}return e.next=4,this._mse.unbindMedia();case 4:return e.next=6,this._mse.bindMedia(this.hls.media);case 6:this._transmuxer=null,this._sourceCreated=!1,this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"endOfStream",value:(n=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.hls.emit(EVENT$2.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setLiveSeekableRange",value:(r=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t,r){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._mse&&this._mse.setLiveSeekableRange(t,r);case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"destroy",value:(t=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){var t;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._mse,this._mse=null,this._softVideo=null,!t){e.next=6;break}return e.next=6,t.unbindMedia();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_createMseSource",value:function(e,t){logger$3.debug("create mse source, videoCodec=".concat(e,", audioCodec=").concat(t));var r=this._mse;r&&(e&&(r.createSource(MSE$2.VIDEO,"video/mp4;codecs=".concat(e)),this._sourceCreated=!0),t&&(r.createSource(MSE$2.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0),this.hls.emit(EVENT$2.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(e,t){var r=this._mse;[{type:MSE$2.VIDEO,codecs:null==e?void 0:e.codec},{type:MSE$2.AUDIO,codecs:null==t?void 0:t.codec}].filter((function(e){return!!e.codecs})).forEach((function(e){var t=e.type,n=e.codecs,i=r.getSourceBuffer(t);if(i){var a=n.split(",")[0];new RegExp(a,"ig").test(i.mimeType)||r.changeType(t,"".concat(t,"/mp4;codecs=").concat(n))}}))}}]),e}(),MasterPlaylist=_createClass$f((function e(){_classCallCheck$e(this,e),_defineProperty$e(this,"version",0),_defineProperty$e(this,"streams",[]),_defineProperty$e(this,"isMaster",!0)})),AudioStream=_createClass$f((function e(){_classCallCheck$e(this,e),_defineProperty$e(this,"id",0),_defineProperty$e(this,"url",""),_defineProperty$e(this,"default",!1),_defineProperty$e(this,"group",""),_defineProperty$e(this,"name",""),_defineProperty$e(this,"lang",""),_defineProperty$e(this,"channels",0),_defineProperty$e(this,"segments",[])})),MasterStream=_createClass$f((function e(){_classCallCheck$e(this,e),_defineProperty$e(this,"id",0),_defineProperty$e(this,"bitrate",0),_defineProperty$e(this,"width",0),_defineProperty$e(this,"height",0),_defineProperty$e(this,"name",""),_defineProperty$e(this,"url",""),_defineProperty$e(this,"audioCodec",""),_defineProperty$e(this,"videoCodec",""),_defineProperty$e(this,"textCodec",""),_defineProperty$e(this,"audioGroup",""),_defineProperty$e(this,"audioStreams",[])})),MediaPlaylist=_createClass$f((function e(){_classCallCheck$e(this,e),_defineProperty$e(this,"version",0),_defineProperty$e(this,"url",""),_defineProperty$e(this,"type",""),_defineProperty$e(this,"startCC",0),_defineProperty$e(this,"endCC",0),_defineProperty$e(this,"startSN",0),_defineProperty$e(this,"endSN",0),_defineProperty$e(this,"totalDuration",0),_defineProperty$e(this,"targetDuration",0),_defineProperty$e(this,"live",!0),_defineProperty$e(this,"segments",[])})),MediaSegment=function(){function e(){_classCallCheck$e(this,e),_defineProperty$e(this,"sn",0),_defineProperty$e(this,"cc",0),_defineProperty$e(this,"url",""),_defineProperty$e(this,"title",""),_defineProperty$e(this,"start",0),_defineProperty$e(this,"duration",0),_defineProperty$e(this,"key",null),_defineProperty$e(this,"byteRange",null),_defineProperty$e(this,"isInitSegment",!1),_defineProperty$e(this,"initSegment",null),_defineProperty$e(this,"isLast",!1)}return _createClass$f(e,[{key:"end",get:function(){return this.start+this.duration}},{key:"setByteRange",value:function(e,t){this.byteRange=[0];var r=e.split("@");1===r.length&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(r[1]),this.byteRange[1]=this.byteRange[0]+parseInt(r[0])-1}}]),e}(),MediaSegmentKey=function(){function e(t){_classCallCheck$e(this,e),_defineProperty$e(this,"method",""),_defineProperty$e(this,"url",""),_defineProperty$e(this,"iv",null),_defineProperty$e(this,"keyFormat",""),_defineProperty$e(this,"keyFormatVersions",""),t instanceof e&&(this.method=t.method,this.url=t.url,this.keyFormat=t.keyFormat,this.keyFormatVersions=t.keyFormatVersions,t.iv&&(this.iv=new Uint8Array(t.iv)))}return _createClass$f(e,[{key:"clone",value:function(t){var r=new e(this);return null!=t&&r.setIVFromSN(t),r}},{key:"setIVFromSN",value:function(e){if(!this.iv&&"AES-128"===this.method&&"number"==typeof e&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=e>>8*(15-t)&255}}}]),e}(),REGEXP_TAG=/^#(EXT[^:]*)(?::(.*))?$/,REGEXP_ATTR=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,REGEXP_ABSOLUTE_URL=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,REGEXP_URL_PAIR=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function getLines(e){return e.split(/[\r\n]/).map((function(e){return e.trim()})).filter(Boolean)}function parseTag(e){var t=e.match(REGEXP_TAG);if(t&&t[1])return[t[1].replace("EXT-X-",""),t[2]]}function parseAttr(e){for(var t={},r=REGEXP_ATTR.exec(e);r;)t[r[1]]=r[2]||r[3],r=REGEXP_ATTR.exec(e);return t}function getAbsoluteUrl(e,t){if(!t||!e||REGEXP_ABSOLUTE_URL.test(e))return e;var r=REGEXP_URL_PAIR.exec(t);return r?"/"===e[0]?r[1]+e:r[1]+r[2]+e:e}var CODECS_REGEXP={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function getCodecs(e,t){var r=CODECS_REGEXP[e];if(r&&t&&t.length)for(var n=0;n<r.length;n++)for(var i=0;i<t.length;i++)if(r[n].test(t[i]))return t[i]}function parseMasterPlaylist(e,t){for(var r,n=new MasterPlaylist,i=0,a=[];r=e[i++];){var o=parseTag(r);if(o){var s=_slicedToArray$5(o,2),l=s[0],u=s[1];if("VERSION"===l)n.version=parseInt(u);else if("MEDIA"===l&&u){var c=parseAttr(u);if("AUDIO"===c.TYPE&&c.URI){var d=new AudioStream;d.url=getAbsoluteUrl(c.URI,t),d.default="YES"===c.DEFAULT,d.group=c["GROUP-ID"],d.name=c.NAME,d.lang=c.LANGUAGE,c.CHANNELS&&(d.channels=Number(c.CHANNELS.split("/")[0]),Number.isNaN(d.channels)&&(d.channels=0)),a.push(d)}}else if("STREAM-INF"===l&&u){var h=new MasterStream,f=parseAttr(u);if(h.bitrate=parseInt(f["AVERAGE-BANDWIDTH"]||f.BANDWIDTH),h.name=f.NAME,h.url=getAbsoluteUrl(e[i++],t),f.RESOLUTION){var p=_slicedToArray$5(f.RESOLUTION.split("x"),2),y=p[0],m=p[1];h.width=parseInt(y),h.height=parseInt(m)}if(f.CODECS){var g=f.CODECS.split(/[ ,]+/).filter(Boolean);h.videoCodec=getCodecs("video",g),h.audioCodec=getCodecs("audio",g),h.textCodec=getCodecs("text",g)}h.audioGroup=f.AUDIO,n.streams.push(h)}}}return n.streams.forEach((function(e,t){e.id=t})),a.length&&(a.forEach((function(e,t){e.id=t})),n.streams.forEach((function(e){e.audioGroup&&(e.audioStreams=a.filter((function(t){return t.group===e.audioGroup})))}))),n}function parseMediaPlaylist(e,t){var r=new MediaPlaylist;r.url=t;for(var n,i=new MediaSegment,a=null,o=null,s=0,l=0,u=0,c=0;n=e[c++];)if("#"===n[0]){var d=parseTag(n);if(d){var h=_slicedToArray$5(d,2),f=h[0],p=h[1];switch(f){case"VERSION":r.version=parseInt(p);break;case"PLAYLIST-TYPE":r.type=null==p?void 0:p.toUpperCase();break;case"TARGETDURATION":r.targetDuration=parseFloat(p);break;case"ENDLIST":var y=r.segments[r.segments.length-1];y&&(y.isLast=!0),r.live=!1;break;case"MEDIA-SEQUENCE":l=r.startSN=parseInt(p);break;case"DISCONTINUITY-SEQUENCE":u=r.startCC=parseInt(p);break;case"DISCONTINUITY":u++;break;case"BYTERANGE":i.setByteRange(p,r.segments[r.segments.length-1]);break;case"EXTINF":var m=_slicedToArray$5(p.split(","),2),g=m[0],v=m[1];i.start=s,i.duration=parseFloat(g),s+=i.duration,i.title=v;break;case"KEY":var b=parseAttr(p);if("NONE"===b.METHOD){o=null;break}if("AES-128"!==b.METHOD)throw new Error("encrypt ".concat(b.METHOD,"/").concat(b.KEYFORMAT," is not supported"));if((o=new MediaSegmentKey).method=b.METHOD,o.url=/^blob:/.test(b.URI)?b.URI:getAbsoluteUrl(b.URI,t),o.keyFormat=b.KEYFORMAT||"identity",o.keyFormatVersions=b.KEYFORMATVERSIONS,b.IV){var _=b.IV.slice(2);_=(1&_.length?"0":"")+_,o.iv=new Uint8Array(_.length/2);for(var E=0,T=_.length/2;E<T;E++)o.iv[E]=parseInt(_.slice(2*E,2*E+2),16)}break;case"MAP":var S=parseAttr(p);i.url=getAbsoluteUrl(S.URI,t),S.BYTERANGE&&i.setByteRange(S.BYTERANGE),i.isInitSegment=!0,i.sn=0,o&&(i.key=o.clone(0)),a=i,i=new MediaSegment}}}else i.sn=l,i.cc=u,i.url=getAbsoluteUrl(n,t),o&&(i.key=o.clone(l)),a&&(i.initSegment=a),r.segments.push(i),i=new MediaSegment,l++;var $=r.segments[r.segments.length-1];return $&&(r.endSN=$.sn),r.totalDuration=s,r.endCC=u,r}var M3U8Parser=function(){function e(){_classCallCheck$e(this,e)}return _createClass$f(e,null,[{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0;if(!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var n=getLines(t);return e.isMediaPlaylist(t)?parseMediaPlaylist(n,r):parseMasterPlaylist(n,r)}},{key:"isMediaPlaylist",value:function(e){return e.includes("#EXTINF:")||e.includes("#EXT-X-TARGETDURATION:")}}]),e}(),ManifestLoader=function(){function e(t){var r=this;_classCallCheck$e(this,e),_defineProperty$e(this,"_onLoaderRetry",(function(e,t){r.hls.emit(Event$4.LOAD_RETRY,{error:StreamingError$2.network(e),retryTime:t})})),this.hls=t,this._timer=null;var n=this.hls.config,i=n.retryCount,a=n.retryDelay,o=n.loadTimeout,s=n.fetchOptions;this._loader=new NetLoader$3(_objectSpread2$8(_objectSpread2$8({},s),{},{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._audioLoader=new NetLoader$3(_objectSpread2$8(_objectSpread2$8({},s),{},{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry}))}var t;return _createClass$f(e,[{key:"load",value:(t=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this._loader.load(t)],r&&n.push(this._audioLoader.load(r)),e.prev=2,e.next=5,Promise.all(n);case 5:if(o=e.sent,s=_slicedToArray$5(o,2),l=s[0],u=s[1],l){e.next=11;break}return e.abrupt("return",[]);case 11:i=l.data,a=null==u?void 0:u.data,e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(2),StreamingError$2.network(e.t0);case 18:c=this.hls.config.onPreM3U8Parse,e.prev=19,c&&(i=c(i)||i,a&&(a=c(a,!0)||a)),d=M3U8Parser.parse(i,t),a&&(h=M3U8Parser.parse(a,r)),e.next=28;break;case 25:throw e.prev=25,e.t1=e.catch(19),new StreamingError$2(ERR$2.MANIFEST,ERR$2.SUB_TYPES.HLS);case 28:return d&&(d.isMaster?this.hls.emit(Event$4.HLS_MANIFEST_LOADED,{playlist:d}):this.hls.emit(Event$4.HLS_LEVEL_LOADED,{playlist:d})),e.abrupt("return",[d,h]);case 30:case"end":return e.stop()}}),e,this,[[2,15],[19,25]])}))),function(e,r){return t.apply(this,arguments)})},{key:"poll",value:function(e,t,r,n,i){var a=this;clearTimeout(this._timer),i=i||3e3;var o=function(){var s=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function s(){var l;return _regeneratorRuntime$8().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return clearTimeout(a._timer),s.prev=1,s.next=4,a.load(e,t);case 4:if((l=s.sent)[0]){s.next=7;break}return s.abrupt("return");case 7:r(l[0],l[1]),s.next=13;break;case 10:s.prev=10,s.t0=s.catch(1),n(s.t0);case 13:a._timer=setTimeout(o,i);case 14:case"end":return s.stop()}}),s,null,[[1,10]])})));return function(){return s.apply(this,arguments)}}();this._timer=setTimeout(o,i)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),e}(),SegmentLoader=function(){function e(t){var r=this;_classCallCheck$e(this,e),_defineProperty$e(this,"_emitOnLoaded",(function(e,t){var n=e.data,i=e.response,a=e.option||{},o=a.firstByteTime,s=a.startTime,l=a.endTime,u=a.contentLength,c=l-s;r._bandwidthService.addRecord(u||n.byteLength,c),r.hls.emit(EVENT$2.SPEED,{time:c,byteLength:u,url:t}),r.hls.emit(EVENT$2.LOAD_COMPLETE,{url:t,elapsed:c||0}),r.hls.emit(EVENT$2.TTFB,{url:t,responseUrl:i.url,elapsed:o-s}),r.hls.emit(EVENT$2.LOAD_RESPONSE_HEADERS,{headers:i.headers})})),_defineProperty$e(this,"_onLoaderRetry",(function(e,t){r.hls.emit(EVENT$2.LOAD_RETRY,{error:StreamingError$2.network(e),retryTime:t})})),this.hls=t,this._bandwidthService=new BandwidthService,this._mapCache={},this._keyCache={};var n=this.hls.config,i=n.retryCount,a=n.retryDelay,o=n.loadTimeout,s=n.fetchOptions;this._segmentLoader=new NetLoader$3(_objectSpread2$8(_objectSpread2$8({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new NetLoader$3(_objectSpread2$8(_objectSpread2$8({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._keyLoader=new NetLoader$3(_objectSpread2$8(_objectSpread2$8({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry}))}var t,r;return _createClass$f(e,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,i=[];return e&&(i[0]=this.loadVideoSegment(e,r)),t&&(i[1]=this.loadAudioSegment(t,n)),Promise.all(i)}},{key:"loadVideoSegment",value:function(e,t){return this._loadSegment(this._segmentLoader,e,t)}},{key:"loadAudioSegment",value:function(e,t){return this._loadSegment(this._audioSegmentLoader,e,t)}},{key:"_loadSegment",value:(r=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t,r,n){var i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b=this;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=[],this.hls.emit(EVENT$2.LOAD_START,{url:r.url}),c[0]=t.load(r.url),n&&r.initSegment&&(h=r.initSegment.url,(a=this._mapCache[h])||(this.hls.emit(EVENT$2.LOAD_START,{url:h}),c[1]=t.load(h).then((function(e){e&&(Object.keys(b._mapCache)>30&&(b._mapCache={}),a=b._mapCache[h]=e.data,b._emitOnLoaded(e,h))}))),(f=null===(d=r.initSegment.key)||void 0===d?void 0:d.url)&&(u=r.initSegment.key.iv,(l=this._keyCache[f])||(this.hls.emit(EVENT$2.LOAD_START,{url:f}),c[2]=this._keyLoader.load(f).then((function(e){e&&(l=b._keyCache[f]=e.data,b._emitOnLoaded(e,f))}))))),(p=null===(i=r.key)||void 0===i?void 0:i.url)&&(s=r.key.iv,(o=this._keyCache[p])||(this.hls.emit(EVENT$2.LOAD_START,{url:p}),c[3]=this._keyLoader.load(p).then((function(e){e&&(o=b._keyCache[p]=e.data,b._emitOnLoaded(e,p))})))),e.next=8,Promise.all(c);case 8:if(y=e.sent,m=_slicedToArray$5(y,1),g=m[0]){e.next=13;break}return e.abrupt("return");case 13:return v=g.data,this._emitOnLoaded(g,r.url),e.abrupt("return",{data:v,map:a,key:o,mapKey:l,keyIv:s,mapKeyIv:u});case 16:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"reset",value:function(){this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:(t=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),logger$2=new Logger$c("hls"),Hls$1=function(e){_inherits$b(h,e);var t,r,n,i,a,o,s,l,u,c,d=_createSuper$e(h);function h(e){var t;return _classCallCheck$e(this,h),_defineProperty$e(_assertThisInitialized$b(t=d.call(this)),"version",h.version),_defineProperty$e(_assertThisInitialized$b(t),"media",null),_defineProperty$e(_assertThisInitialized$b(t),"config",null),_defineProperty$e(_assertThisInitialized$b(t),"_manifestLoader",null),_defineProperty$e(_assertThisInitialized$b(t),"_segmentLoader",null),_defineProperty$e(_assertThisInitialized$b(t),"_playlist",null),_defineProperty$e(_assertThisInitialized$b(t),"_bufferService",null),_defineProperty$e(_assertThisInitialized$b(t),"_gapService",null),_defineProperty$e(_assertThisInitialized$b(t),"_seiService",null),_defineProperty$e(_assertThisInitialized$b(t),"_prevSegSn",null),_defineProperty$e(_assertThisInitialized$b(t),"_prevSegCc",null),_defineProperty$e(_assertThisInitialized$b(t),"_tickTimer",null),_defineProperty$e(_assertThisInitialized$b(t),"_tickInterval",500),_defineProperty$e(_assertThisInitialized$b(t),"_segmentProcessing",!1),_defineProperty$e(_assertThisInitialized$b(t),"_reloadOnPlay",!1),_defineProperty$e(_assertThisInitialized$b(t),"_loadM3U8",function(){var e=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(r){var n,i,a,o;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t._manifestLoader.load(r);case 3:i=e.sent,a=_slicedToArray$5(i,1),n=a[0],e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),t._emitError(StreamingError$2.create(e.t0));case 11:if(n){e.next=13;break}return e.abrupt("return");case 13:if(t._playlist.upsertPlaylist(n),!n.isMaster){e.next=17;break}return e.next=17,t._refreshM3U8();case 17:if(t.emit(Event$4.STREAM_PARSED),!t.isLive){e.next=23;break}t._bufferService.setLiveSeekableRange(0,4294967295),n.isMaster||t._pollM3U8(r),e.next=27;break;case 23:return e.next=25,t._bufferService.updateDuration(t._playlist.currentStream.totalDuration);case 25:(o=t.config.startTime)&&(t.media.currentTime=o,t._playlist.setNextSegmentByIndex(t._playlist.findSegmentIndexByTime(o)||0));case 27:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()),_defineProperty$e(_assertThisInitialized$b(t),"_loadSegment",_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){var r,n;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._segmentProcessing&&t.media){e.next=2;break}return e.abrupt("return");case 2:if(r=t.media.currentTime,n=t._playlist.currentSegment,t._playlist.nextSegment&&!(n&&!t.isLive&&n.end-r>=t.config.preloadTime)){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",t._loadSegmentDirect());case 8:case"end":return e.stop()}}),e)})))),_defineProperty$e(_assertThisInitialized$b(t),"_onPlay",_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(t._disconnectTimer),!t._reloadOnPlay){e.next=6;break}t._reloadOnPlay=!1,t.replay(!0),e.next=9;break;case 6:return e.next=8,t._loadSegment();case 8:t._startTick();case 9:case"end":return e.stop()}}),e)})))),_defineProperty$e(_assertThisInitialized$b(t),"_onPause",(function(){if(t.isLive){if(!t._reloadOnPlay){var e=t.config.disconnectTime;if(null==e&&(e=t._playlist.dvrWindow),!Number.isFinite(e))return;clearTimeout(t._disconnectTimer),t._disconnectTimer=setTimeout((function(){t._reloadOnPlay=!0,t._clear()}),e||0)}}else t._stopTick()})),_defineProperty$e(_assertThisInitialized$b(t),"_onSeeking",_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){var r,n,i,a,o,s,l;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.media){e.next=2;break}return e.abrupt("return");case 2:if(r=t.media.currentTime,!(n=t._playlist.seekRange)){e.next=9;break}if(i=clamp(r,n[0]+.1,n[1]-.1),!(Math.abs(r-i)>=.1)){e.next=9;break}return t.media.currentTime=i,e.abrupt("return");case 9:if(!(a=t._playlist.currentSegment)){e.next=14;break}if(!((o=Buffer$5.info(Buffer$5.get(t.media),r,.1)).end&&o.end>=a.end)){e.next=14;break}return e.abrupt("return");case 14:if(s=t._playlist.findSegmentIndexByTime(r),l=t._playlist.getSegmentByIndex(s),null!=s&&l&&(!t._segmentProcessing||l!==t._playlist.nextSegment)){e.next=18;break}return e.abrupt("return");case 18:return logger$2.debug("seek to",r,l),t._playlist.setNextSegmentByIndex(s),t._stopTick(),e.next=23,t._segmentLoader.cancel();case 23:return e.next=25,t._loadSegmentDirect();case 25:t._startTick();case 26:case"end":return e.stop()}}),e)})))),_defineProperty$e(_assertThisInitialized$b(t),"_onTimeupdate",(function(){if(t.media){var e=t.config;if(e.isLive&&e.maxLatency&&e.targetLatency&&t.media){var r=t._playlist.liveEdge;if(!r)return;var n=r-t.media.currentTime;n>=e.maxLatency&&(logger$2.debug("latency jump",n),t.media.currentTime=r-e.targetLatency)}t._seiService.throw(t.media.currentTime)}})),_defineProperty$e(_assertThisInitialized$b(t),"_tick",(function(){if(t.media){t._startTick();var e=t.media;Buffer$5.end(Buffer$5.get(e))<.1||!e.readyState||(isMediaPlaying(e)?(t._loadSegment(),t._gapService&&t._gapService.do(e,t.config.maxJumpDistance,t.isLive)):e.readyState<2&&t._gapService&&t._gapService.do(e,t.config.maxJumpDistance,!e.currentTime||t.isLive))}})),t.config=e=getConfig$4(e),t.media=t.config.media,t._manifestLoader=new ManifestLoader(_assertThisInitialized$b(t)),t._segmentLoader=new SegmentLoader(_assertThisInitialized$b(t)),t._playlist=new Playlist(_assertThisInitialized$b(t)),t._bufferService=new BufferService(_assertThisInitialized$b(t)),t._seiService=new SeiService(_assertThisInitialized$b(t)),e.softDecode||(t._gapService=new GapService),t.media.addEventListener("play",t._onPlay),t.media.addEventListener("pause",t._onPause),t.media.addEventListener("seeking",t._onSeeking),t.media.addEventListener("timeupdate",t._onTimeupdate),t}return _createClass$f(h,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return Buffer$5.info(Buffer$5.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"playbackQuality",value:function(){return getVideoPlaybackQuality(this.media)}},{key:"load",value:(c=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){var r,n=arguments;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]&&n[1],t&&(this.config.url=t),t=this.config.url,e.next=5,this._reset(r);case 5:if(t&&(t=t.trim()),t){e.next=8;break}throw this._emitError(new StreamingError$2(ERR$2.OTHER,ERR$2.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 8:return e.next=10,this._loadM3U8(t);case 10:return e.next=12,this._loadSegment();case 12:this._startTick();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"replay",value:(u=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.startTime=0,!this.config.softDecode){e.next=5;break}this.load(),e.next=7;break;case 5:return e.next=7,this.load();case 7:return this._reloadOnPlay=!1,e.abrupt("return",this.media.play(!t));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"switchURL",value:(l=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){var r,n,i=arguments;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:0,this.config.startTime=r,this.config.url=t,e.prev=3,!this.config.softDecode){e.next=8;break}e.t0=this.load(t),e.next=11;break;case 8:return e.next=10,this.load(t);case 10:e.t0=e.sent;case 11:n=e.t0,e.next=18;break;case 14:throw e.prev=14,e.t1=e.catch(3),this.emit(Event$4.SWITCH_URL_FAILED,e.t1),e.t1;case 18:return this._reloadOnPlay=!1,n&&this.emit(Event$4.SWITCH_URL_SUCCESS,{url:t}),e.abrupt("return",this.media.play(!0));case 21:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e){return l.apply(this,arguments)})},{key:"switchStream",value:(s=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){var r,n,i,a,o,s=arguments;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(s.length>1&&void 0!==s[1])||s[1],n=this.currentStream,i=this.streams,n&&n.id!==t&&i&&!(i.length<2)){e.next=5;break}return e.abrupt("return");case 5:if(a=i.find((function(e){return e.id===t}))){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,this._clear();case 11:if(!r){e.next=14;break}return e.next=14,this._bufferService.clearAllBuffer();case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(8),this._emitError(StreamingError$2.create(e.t0));case 19:if(n.currentAudioStream&&a.audioStreams.length>2&&(o=n.currentAudioStream.id,a.currentAudioStream=a.audioStreams.find((function(e){return e.id===o}))||a.currentAudioStream),this._playlist.currentStream=a,e.prev=21,!this.isLive&&a.segments.length){e.next=25;break}return e.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=29,this._loadSegmentDirect();case 29:e.next=35;break;case 31:throw e.prev=31,e.t1=e.catch(21),this._playlist.currentStream=n,e.t1;case 35:return this._startTick(),e.abrupt("return",a);case 37:case"end":return e.stop()}}),e,this,[[8,16],[21,31]])}))),function(e){return s.apply(this,arguments)})},{key:"switchAudioStream",value:(o=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t){var r,n,i,a,o=arguments;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>1&&void 0!==o[1])||o[1],n=this.currentStream){e.next=4;break}return e.abrupt("return");case 4:if((i=n.currentAudioStream)&&i.id!==t&&!(n.audioStreams.length<2)){e.next=7;break}return e.abrupt("return");case 7:if(a=n.audioStreams.find((function(e){return e.id===t}))){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,this._clear();case 13:if(!r){e.next=16;break}return e.next=16,this._bufferService.clearAllBuffer();case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(10),this._emitError(StreamingError$2.create(e.t0));case 21:if(n.currentAudioStream=a,e.prev=22,!this.isLive&&a.segments.length){e.next=26;break}return e.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=30,this._loadSegmentDirect();case 30:e.next=36;break;case 32:throw e.prev=32,e.t1=e.catch(22),n.currentAudioStream=i,e.t1;case 36:return this._startTick(),e.abrupt("return",a);case 38:case"end":return e.stop()}}),e,this,[[10,18],[22,32]])}))),function(e){return o.apply(this,arguments)})},{key:"destroy",value:(a=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null;case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_refreshM3U8",value:function(){var e,t=this,r=this._playlist.currentStream;if(!r||!r.url)throw this._emitError(StreamingError$2.create(null,null,new Error("m3u8 url is not defined")));var n=r.url,i=null===(e=r.currentAudioStream)||void 0===e?void 0:e.url;return this._manifestLoader.load(n,i).then((function(e){var r=_slicedToArray$5(e,2),a=r[0],o=r[1];a&&(t._playlist.upsertPlaylist(a,o),t.isLive&&t._pollM3U8(n,i))})).catch((function(e){throw t._emitError(StreamingError$2.create(e))}))}},{key:"_pollM3U8",value:function(e,t){var r,n=this,i=this._playlist.isEmpty;this._manifestLoader.poll(e,t,(function(e,t){n._playlist.upsertPlaylist(e,t),e&&i&&!n._playlist.isEmpty&&n._loadSegment(),i&&(i=n._playlist.isEmpty)}),(function(e){n._emitError(StreamingError$2.create(e))}),1e3*((null===(r=this._playlist.lastSegment)||void 0===r?void 0:r.duration)||0))}},{key:"_loadSegmentDirect",value:(i=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){var t,r,n;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._playlist.nextSegment){e.next=3;break}return e.abrupt("return");case 3:return r=!1,n=null,e.prev=5,this._segmentProcessing=!0,e.next=9,this._reqAndBufferSegment(t,this._playlist.getAudioSegment(t));case 9:r=e.sent,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),n=e.t0;case 15:return e.prev=15,this._segmentProcessing=!1,e.finish(15);case 18:if(!n){e.next=20;break}return e.abrupt("return",this._emitError(StreamingError$2.create(n)));case 20:return r&&(this._playlist.moveSegmentPointer(),t.isLast?this._end():this._loadSegment()),e.abrupt("return",r);case 22:case"end":return e.stop()}}),e,this,[[5,12,15,18]])}))),function(){return i.apply(this,arguments)})},{key:"_reqAndBufferSegment",value:(n=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(t,r){var n,i,a,o,s,l,u,c;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t?t.cc:r.cc,a=this._prevSegCc!==i,e.next=4,this._segmentLoader.load(t,r,a);case 4:if((o=e.sent)[0]){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,(n=this._bufferService).decryptBuffer.apply(n,_toConsumableArray$7(o));case 9:if(s=e.sent){e.next=12;break}return e.abrupt("return");case 12:return l=t?t.sn:r.sn,u=t?t.start:r.start,c=this._playlist.currentStream,this._bufferService.createSource(s[0],s[1],null==c?void 0:c.videoCodec,null==c?void 0:c.audioCodec),e.next=18,this._bufferService.appendBuffer(s[0],s[1],a,this._prevSegSn===l-1,u);case 18:return e.next=20,this._bufferService.evictBuffer(this.config.bufferBehind);case 20:return this._prevSegCc=i,this._prevSegSn=l,e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_clear",value:(r=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),e.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_reset",value:(t=_asyncToGenerator$a(_regeneratorRuntime$8().mark((function e(){var t,r=arguments;return _regeneratorRuntime$8().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),e.next=9,this._clear();case 9:return e.abrupt("return",this._bufferService.reset(t));case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream()}},{key:"_stopTick",value:function(){clearTimeout(this._tickTimer)}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return logger$2.table(e),logger$2.error(e),logger$2.error(null===(t=this.media)||void 0===t?void 0:t.error),this.emit(Event$4.ERROR,e),r&&this._end(),this._seiService.reset(),e}}],[{key:"isSupported",value:function(){return MSE$2.isSupported()||!!WebAssembly}},{key:"enableLogger",value:function(){Logger$c.enable(),Logger$9.enable()}},{key:"disableLogger",value:function(){Logger$c.disable(),Logger$9.disable()}}]),h}(EventEmitter$1);_defineProperty$e(Hls$1,"version","3.0.0-next.28");try{localStorage.getItem("xgd")?Hls$1.enableLogger():Hls$1.disableLogger()}catch(error){}var PluginExtension=function(){function e(t,r){var n=this;_classCallCheck$e(this,e),_defineProperty$e(this,"_opts",null),_defineProperty$e(this,"_plugin",null),_defineProperty$e(this,"_onLowDecode",(function(){var e,t,r,i,a=n._opts,o=a.media,s=a.innerDegrade;null===(e=n._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("lowdecode",o.degradeInfo),null===(r=n._plugin)||void 0===r||null===(i=r.player)||void 0===i||i.emit("core_event",_objectSpread2$8(_objectSpread2$8({},o.degradeInfo),{},{eventName:Event$4.LOWDECODE})),1===s&&n._degrade(o.src)})),_defineProperty$e(this,"_degrade",(function(e){var t=n._plugin.player,r=t.video;if(!r||"MVideo"===r.TAG){var i=t.video.degradeVideo;t.video=i,r.degrade(e),e&&(t.config.url=e);var a=t.root.firstChild;"MVideo"===a.TAG&&t.root.replaceChild(i,a);var o=n._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),_defineProperty$e(this,"forceDegradeToVideo",(function(e){1===n._opts.innerDegrade&&n._degrade(e)})),this._opts=t,this._plugin=r,this._init()}return _createClass$f(e,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,i=e.isLive;t&&(i||!t.setPlayMode?(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),this._bindEvents()):t.setPlayMode("VOD"))}},{key:"_bindEvents",value:function(){this._opts.media.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),e}(),Stats=function(){function e(){_classCallCheck$e(this,e),_defineProperty$e(this,"encodeType",""),_defineProperty$e(this,"audioCodec",""),_defineProperty$e(this,"videoCodec",""),_defineProperty$e(this,"domain",""),_defineProperty$e(this,"fps",0),_defineProperty$e(this,"bitrate",0),_defineProperty$e(this,"width",0),_defineProperty$e(this,"height",0),_defineProperty$e(this,"samplerate",0),_defineProperty$e(this,"channelCount",0),_defineProperty$e(this,"gop",0),_defineProperty$e(this,"_bitsAccumulateSize",0),_defineProperty$e(this,"_bitsAccumulateDuration",0)}return _createClass$f(e,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setVideoMeta",value:function(e){this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen&&(this.fps=e.fpsNum/e.fpsDen)}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if(!this.fps||this.fps>=100){var r=e[0];null!=r&&r.duration&&(this.fps=Math.round(9e4/r.duration))}e.forEach((function(e){1===e.gopId&&t.gop++,t._bitsAccumulateDuration+=e.duration/90,t._bitsAccumulateSize+=e.units.reduce((function(e,t){return e+t.length}),0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=8*t._bitsAccumulateSize,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)}))}}]),e}(),MediaStats=function(){function e(t){_classCallCheck$e(this,e),_defineProperty$e(this,"_plugin",void 0),_defineProperty$e(this,"_samples",[]),_defineProperty$e(this,"_bitrateCalcDuration",0),_defineProperty$e(this,"_stats",new Stats),this._plugin=t,this._bindEvents()}return _createClass$f(e,[{key:"getStats",value:function(){var e,t,r,n,i,a,o=(null===(e=this._plugin.player)||void 0===e?void 0:e.video)||{},s=o.currentTime,l=void 0===s?0:s,u=o.decodeFps,c=void 0===u?0:u;return _objectSpread2$8(_objectSpread2$8({},this._stats.getStats()),{},{downloadSpeed:null===(t=this._plugin.core)||void 0===t||null===(r=t.speedInfo)||void 0===r?void 0:r.call(t).speed,avgSpeed:null===(n=this._plugin.core)||void 0===n||null===(i=n.speedInfo)||void 0===i?void 0:i.call(n).avgSpeed,currentTime:l,bufferEnd:(null===(a=this._plugin.player)||void 0===a?void 0:a.getBufferedRange()[1])-l,decodeFps:c})}},{key:"_bindEvents",value:function(){var e,t=this;this._onceLoadStart(),null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function(e){e.eventName===EVENT$2.METADATA_PARSED&&("video"===e.type?t._stats.setVideoMeta(e.track):t._stats.setAudioMeta(e.track)),e.eventName===EVENT$2.TTFB&&t._stats.setDomain(e.responseUrl)}))}},{key:"_onceLoadStart",value:function(){var e,t=this;null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function e(r){r.eventName===EVENT$2.LOAD_START&&(t._plugin.player.off("core_event",e),t._plugin.core.on(Event$4.DEMUXED_TRACK,(function(e){return t._stats.updateBitrate(e.samples)})))}))}}]),e}(),HlsPlugin=function(e){_inherits$b(r,e);var t=_createSuper$e(r);function r(){var e;_classCallCheck$e(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$e(_assertThisInitialized$b(e=t.call.apply(t,[this].concat(i))),"hls",null),_defineProperty$e(_assertThisInitialized$b(e),"pluginExtension",null),_defineProperty$e(_assertThisInitialized$b(e),"_stats",new MediaStats(_assertThisInitialized$b(e))),_defineProperty$e(_assertThisInitialized$b(e),"getStats",(function(){return e._stats.getStats()})),_defineProperty$e(_assertThisInitialized$b(e),"destroy",(function(){var t;e.hls&&(e.hls.destroy(),e.hls=null),null===(t=e.pluginExtension)||void 0===t||t.destroy(),e.pluginExtension=null})),_defineProperty$e(_assertThisInitialized$b(e),"_onSwitchURL",(function(t){var r=_assertThisInitialized$b(e),n=r.player,i=r.hls;if(i){var a=n.currentTime;n.config.url=t,i.switchURL(t,a).catch((function(e){}))}})),_defineProperty$e(_assertThisInitialized$b(e),"_onDefinitionChange",(function(t){var r=t.to;e.hls&&e.hls.switchURL(r).catch((function(e){}))})),e}return _createClass$f(r,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return null===(e=this.hls)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t,r=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!r&&"video"!==r&&"audio"!==r}},{key:"beforePlayerInit",value:function(){var e,t=this,r=new Promise((function(t,r){e=t})),n=this.player.config;if(n.url||n.__allowHlsEmptyUrl__){this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL;var i,a=n.hls||{};if(a.innerDegrade=a.innerDegrade||n.innerDegrade,null!==a.disconnectTime&&void 0!==a.disconnectTime||(a.disconnectTime=0),this.hls=new Hls$1(_objectSpread2$8({softDecode:this.softDecode,isLive:n.isLive,media:this.player.video,startTime:n.startTime,url:n.url},a)),this.softDecode?e(!0):(BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var e,r;return null===(e=t.hls)||void 0===e||null===(r=e.media)||void 0===r?void 0:r.src},configurable:!0}}),this.hls.on("sourceAttached",(function(){e(!0)}))),this.softDecode&&(this.pluginExtension=new PluginExtension(_objectSpread2$8({isLive:n.isLive,media:this.player.video},a),this),this.player.forceDegradeToVideo=function(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(e=t.pluginExtension)||void 0===e?void 0:e.forceDegradeToVideo.apply(e,n)}),n.isLive)null===(i=this.player)||void 0===i||i.useHooks("replay",(function(){var e;return null===(e=t.hls)||void 0===e?void 0:e.replay()}));return this.on(URL_CHANGE,this._onSwitchURL),this.on(DESTROY,this.destroy),this._transError(),this._transCoreEvent(EVENT$2.TTFB),this._transCoreEvent(EVENT$2.LOAD_START),this._transCoreEvent(EVENT$2.LOAD_RESPONSE_HEADERS),this._transCoreEvent(EVENT$2.LOAD_COMPLETE),this._transCoreEvent(EVENT$2.LOAD_RETRY),this._transCoreEvent(EVENT$2.SOURCEBUFFER_CREATED),this._transCoreEvent(EVENT$2.REMOVE_BUFFER),this._transCoreEvent(EVENT$2.BUFFEREOS),this._transCoreEvent(EVENT$2.KEYFRAME),this._transCoreEvent(EVENT$2.METADATA_PARSED),this._transCoreEvent(EVENT$2.SEI),this._transCoreEvent(EVENT$2.SEI_IN_TIME),this._transCoreEvent(EVENT$2.SPEED),this._transCoreEvent(EVENT$2.HLS_MANIFEST_LOADED),this._transCoreEvent(Event$4.STREAM_PARSED),this._transCoreEvent(Event$4.NO_AUDIO_TRACK),this._transCoreEvent(EVENT$2.HLS_LEVEL_LOADED),this._transCoreEvent(EVENT$2.STREAM_EXCEPTION),this._transCoreEvent(EVENT$2.SWITCH_URL_SUCCESS),this._transCoreEvent(EVENT$2.SWITCH_URL_FAILED),n.url&&this.hls.load(n.url,!0).catch((function(e){})),r}e()}},{key:"_transError",value:function(){var e=this;this.hls.on(Event$4.ERROR,(function(t){e.player&&e.player.emit(ERROR$3,new Errors$1(e.player,t))}))}},{key:"_transCoreEvent",value:function(e){var t=this;this.hls.on(e,(function(r){t.player&&t.player.emit("core_event",_objectSpread2$8(_objectSpread2$8({},r),{},{eventName:e}))}))}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e){return Hls$1.isSupported(e)}}]),r}(BasePlugin);_defineProperty$e(HlsPlugin,"Hls",Hls$1),_defineProperty$e(HlsPlugin,"EVENT",Event$4);var shakaPlayer_compiled={},exports2;exports2=shakaPlayer_compiled,function(){var t="undefined"!=typeof window?window:commonjsGlobal,r={};for(var n in function(t,r,n){var i,a="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},o=void 0!==t&&t===this?this:void 0!==r&&null!=r?r:this;function s(){s=function(){},o.Symbol||(o.Symbol=u)}var l,u=(l=0,function(e){return"jscomp_symbol_"+(e||"")+l++});function c(){s();var e=o.Symbol.iterator;e||(e=o.Symbol.iterator=o.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&a(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return d(this)}}),c=function(){}}function d(e){var t=0;return h((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))}function h(e){return c(),(e={next:e})[o.Symbol.iterator]=function(){return this},e}function f(e){c();var t=e[Symbol.iterator];return t?t.call(e):d(e)}function p(e,t){if(t){for(var r=o,n=e.split("."),i=0;i<n.length-1;i++){var s=n[i];s in r||(r[s]={}),r=r[s]}(s=t(i=r[n=n[n.length-1]]))!=i&&null!=s&&a(r,n,{configurable:!0,writable:!0,value:s})}}function y(e){return function(e){function t(t){return e.next(t)}function r(t){return e.throw(t)}return new Promise((function(n,i){!function e(a){a.done?n(a.value):Promise.resolve(a.value).then(t,r).then(e,i)}(e.next())}))}(e())}p("Promise",(function(e){function t(e){this.h=0,this.l=void 0,this.g=[];var t=this.i();try{e(t.resolve,t.reject)}catch(r){t.reject(r)}}function r(){this.g=null}function n(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;r.prototype.h=function(e){null==this.g&&(this.g=[],this.j()),this.g.push(e)},r.prototype.j=function(){var e=this;this.i((function(){e.m()}))};var i=o.setTimeout;r.prototype.i=function(e){i(e,0)},r.prototype.m=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(n){this.l(n)}}}this.g=null},r.prototype.l=function(e){this.i((function(){throw e}))},t.prototype.i=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.C),reject:e(this.j)}},t.prototype.C=function(e){if(e===this)this.j(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.F(e);else{e:switch(_typeof$b(e)){case"object":var r=null!=e;break e;case"function":r=!0;break e;default:r=!1}r?this.A(e):this.m(e)}},t.prototype.A=function(e){var t=void 0;try{t=e.then}catch(r){return void this.j(r)}"function"==typeof t?this.J(t,e):this.m(e)},t.prototype.j=function(e){this.o(2,e)},t.prototype.m=function(e){this.o(1,e)},t.prototype.o=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.l=t,this.u()},t.prototype.u=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)a.h(this.g[e]);this.g=null}};var a=new r;return t.prototype.F=function(e){var t=this.i();e.nc(t.resolve,t.reject)},t.prototype.J=function(e,t){var r=this.i();try{e.call(t,r.resolve,r.reject)}catch(n){r.reject(n)}},t.prototype.then=function(e,r){function n(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(r){a(r)}}:t}var i,a,o=new t((function(e,t){i=e,a=t}));return this.nc(n(e,i),n(r,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.nc=function(e,t){function r(){switch(n.h){case 1:e(n.l);break;case 2:t(n.l);break;default:throw Error("Unexpected state: "+n.h)}}var n=this;null==this.g?a.h(r):this.g.push(r)},t.resolve=n,t.reject=function(e){return new t((function(t,r){r(e)}))},t.race=function(e){return new t((function(t,r){for(var i=f(e),a=i.next();!a.done;a=i.next())n(a.value).nc(t,r)}))},t.all=function(e){var r=f(e),i=r.next();return i.done?n([]):new t((function(e,t){function a(t){return function(r){o[t]=r,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,n(i.value).nc(a(o.length-1),t),i=r.next()}while(!i.done)}))},t})),p("Promise.prototype.finally",(function(e){return e||function(e){return this.then((function(t){return Promise.resolve(e()).then((function(){return t}))}),(function(t){return Promise.resolve(e()).then((function(){throw t}))}))}}));var m,g="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var v;e:{var b={};try{b.__proto__={a:!0},v=b.a;break e}catch(l){}v=!1}m=v?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var _=m;function E(e,t){if(e.prototype=g(t.prototype),e.prototype.constructor=e,_)_(e,t);else for(var r in t)if("prototype"!=r)if(Object.defineProperties){var n=Object.getOwnPropertyDescriptor(t,r);n&&Object.defineProperty(e,r,n)}else e[r]=t[r];e.Lg=t.prototype}function T(){this.l=!1,this.i=null,this.B=void 0,this.s=1,this.h=this.j=0,this.o=this.g=null}function S(e){if(e.l)throw new TypeError("Generator is already running");e.l=!0}function $(e,t){e.g={ce:t,ne:!0},e.s=e.j||e.h}function A(e,t,r){return e.s=r,{value:t}}function w(e){e.s=0}function k(e,t,r){e.j=t,null!=r&&(e.h=r)}function I(e,t){e.j=0,e.h=t||0}function C(e,t){e.s=t,e.j=0}function P(e){e.j=0;var t=e.g.ce;return e.g=null,t}function x(e){e.o=[e.g],e.j=0,e.h=0}function R(e,t){var r=e.o.splice(0)[0];(r=e.g=e.g||r)?r.ne?e.s=e.j||e.h:null!=r.I&&e.h<r.I?(e.s=r.I,e.g=null):e.s=e.h:e.s=t}function O(e){this.g=new T,this.h=e}function L(e,t,r,n){try{var i=t.call(e.g.i,r);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.l=!1,i;var a=i.value}catch(o){return e.g.i=null,$(e.g,o),D(e)}return e.g.i=null,n.call(e.g,a),D(e)}function D(e){for(;e.g.s;)try{var t=e.h(e.g);if(t)return e.g.l=!1,{value:t.value,done:!1}}catch(r){e.g.B=void 0,$(e.g,r)}if(e.g.l=!1,e.g.g){if(t=e.g.g,e.g.g=null,t.ne)throw t.ce;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function M(e){this.next=function(t){return S(e.g),e.g.i?t=L(e,e.g.i.next,t,e.g.m):(e.g.m(t),t=D(e)),t},this.throw=function(t){return S(e.g),e.g.i?t=L(e,e.g.i.throw,t,e.g.m):($(e.g,t),t=D(e)),t},this.return=function(t){return function(e,t){S(e.g);var r=e.g.i;return r?L(e,"return"in r?r.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),D(e))}(e,t)},c(),this[Symbol.iterator]=function(){return this}}function N(e,t){return M.prototype=e.prototype,new M(new O(t))}function G(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function V(e,t,r){e instanceof String&&(e=String(e));for(var n=e.length,i=0;i<n;i++){var a=e[i];if(t.call(r,a,i,e))return{le:i,Qe:a}}return{le:-1,Qe:void 0}}function U(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""}T.prototype.m=function(e){this.B=e},T.prototype.return=function(e){this.g={return:e},this.s=this.h},T.prototype.I=function(e){this.s=e},p("Array.prototype.keys",(function(e){return e||function(){return function(e,t){c(),e instanceof String&&(e+="");var r=0,n={next:function(){if(r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n}(this,(function(e){return e}))}})),p("WeakMap",(function(e){function t(e){if(this.g=(o+=Math.random()+1).toString(),e){s(),c(),e=f(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function r(e){G(e,i)||a(e,i,{value:{}})}function n(e){var t=Object[e];t&&(Object[e]=function(e){return r(e),t(e)})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),r=Object.seal({}),n=new e([[t,2],[r,3]]);return 2==n.get(t)&&3==n.get(r)&&(n.delete(t),n.set(r,4),!n.has(t)&&4==n.get(r))}catch(i){return!1}}())return e;var i="$jscomp_hidden_"+Math.random();n("freeze"),n("preventExtensions"),n("seal");var o=0;return t.prototype.set=function(e,t){if(r(e),!G(e,i))throw Error("WeakMap key fail: "+e);return e[i][this.g]=t,this},t.prototype.get=function(e){return G(e,i)?e[i][this.g]:void 0},t.prototype.has=function(e){return G(e,i)&&G(e[i],this.g)},t.prototype.delete=function(e){return!(!G(e,i)||!G(e[i],this.g))&&delete e[i][this.g]},t})),p("Map",(function(e){function t(){var e={};return e.Na=e.next=e.head=e}function r(e,t){var r=e.g;return h((function(){if(r){for(;r.head!=e.g;)r=r.Na;for(;r.next!=r.head;)return r=r.next,{done:!1,value:t(r)};r=null}return{done:!0,value:void 0}}))}function n(e,t){var r=t&&_typeof$b(t);"object"==r||"function"==r?a.has(t)?r=a.get(t):(r=""+ ++o,a.set(t,r)):r="p_"+t;var n=e.h[r];if(n&&G(e.h,r))for(var i=0;i<n.length;i++){var s=n[i];if(t!=t&&s.key!=s.key||t===s.key)return{id:r,list:n,index:i,ga:s}}return{id:r,list:n,index:-1,ga:void 0}}function i(e){if(this.h={},this.g=t(),this.size=0,e){e=f(e);for(var r;!(r=e.next()).done;)r=r.value,this.set(r[0],r[1])}}if(function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(f([[t,"s"]]));if("s"!=r.get(t)||1!=r.size||r.get({x:4})||r.set({x:4},"t")!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&"s"==i.value[1]&&!((i=n.next()).done||4!=i.value[0].x||"t"!=i.value[1]||!n.next().done)}catch(a){return!1}}())return e;s(),c();var a=new WeakMap;i.prototype.set=function(e,t){var r=n(this,e);return r.list||(r.list=this.h[r.id]=[]),r.ga?r.ga.value=t:(r.ga={next:this.g,Na:this.g.Na,head:this.g,key:e,value:t},r.list.push(r.ga),this.g.Na.next=r.ga,this.g.Na=r.ga,this.size++),this},i.prototype.delete=function(e){return!(!(e=n(this,e)).ga||!e.list||(e.list.splice(e.index,1),e.list.length||delete this.h[e.id],e.ga.Na.next=e.ga.next,e.ga.next.Na=e.ga.Na,e.ga.head=null,this.size--,0))},i.prototype.clear=function(){this.h={},this.g=this.g.Na=t(),this.size=0},i.prototype.has=function(e){return!!n(this,e).ga},i.prototype.get=function(e){return(e=n(this,e).ga)&&e.value},i.prototype.entries=function(){return r(this,(function(e){return[e.key,e.value]}))},i.prototype.keys=function(){return r(this,(function(e){return e.key}))},i.prototype.values=function(){return r(this,(function(e){return e.value}))},i.prototype.forEach=function(e,t){for(var r,n=this.entries();!(r=n.next()).done;)r=r.value,e.call(t,r[1],r[0],this)},i.prototype[Symbol.iterator]=i.prototype.entries;var o=0;return i})),p("Set",(function(e){function t(e){if(this.g=new Map,e){e=f(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.g.size}return function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e(f([t]));if(!r.has(t)||1!=r.size||r.add(t)!=r||1!=r.size||r.add({x:4})!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&i.value[1]==t&&!(i=n.next()).done&&i.value[0]!=t&&4==i.value[0].x&&i.value[1]==i.value[0]&&n.next().done}catch(a){return!1}}()?e:(s(),c(),t.prototype.add=function(e){return this.g.set(e,e),this.size=this.g.size,this},t.prototype.delete=function(e){return e=this.g.delete(e),this.size=this.g.size,e},t.prototype.clear=function(){this.g.clear(),this.size=0},t.prototype.has=function(e){return this.g.has(e)},t.prototype.entries=function(){return this.g.entries()},t.prototype.values=function(){return this.g.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var r=this;this.g.forEach((function(n){return e.call(t,n,n,r)}))},t)})),p("Array.prototype.findIndex",(function(e){return e||function(e,t){return V(this,e,t).le}})),p("Array.prototype.find",(function(e){return e||function(e,t){return V(this,e,t).Qe}})),p("String.prototype.startsWith",(function(e){return e||function(e,t){for(var r=U(this,e,"startsWith"),n=r.length,i=e.length,a=Math.max(0,Math.min(0|t,r.length)),o=0;o<i&&a<n;)if(r[a++]!=e[o++])return!1;return o>=i}})),p("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),p("Array.prototype.includes",(function(e){return e||function(e,t){var r=this;r instanceof String&&(r=String(r));var n=r.length,i=t||0;for(0>i&&(i=Math.max(i+n,0));i<n;i++){var a=r[i];if(a===e||Object.is(a,e))return!0}return!1}})),p("String.prototype.includes",(function(e){return e||function(e,t){return-1!==U(this,e,"includes").indexOf(e,t||0)}})),p("Array.from",(function(e){return e||function(e,t,r){c(),t=null!=t?t:function(e){return e};var n=[],i=e[Symbol.iterator];if("function"==typeof i)for(e=i.call(e);!(i=e.next()).done;)n.push(t.call(r,i.value));else{i=e.length;for(var a=0;a<i;a++)n.push(t.call(r,e[a]))}return n}}));var Z="function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)G(n,i)&&(e[i]=n[i])}return e};p("Object.assign",(function(e){return e||Z}));var B=this;function F(e,t){var r,n=e.split("."),i=B;n[0]in i||!i.execScript||i.execScript("var "+n[0]);for(;n.length&&(r=n.shift());)n.length||void 0===t?i=i[r]?i[r]:i[r]={}:i[r]=t}function j(e,t){function r(){}r.prototype=t.prototype,e.Lg=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Wg=function(e,r,n){return t.prototype[r].apply(e,Array.prototype.slice.call(arguments,2))}}function W(e){this.i=Math.exp(Math.log(.5)/e),this.h=this.g=0}function X(e,t,r){var n=Math.pow(e.i,t);r=r*(1-n)+n*e.g,isNaN(r)||(e.g=r,e.h+=t)}function H(e){return e.g/(1-Math.pow(e.i,e.h))}function K(){this.h=new W(2),this.i=new W(5),this.g=0}B.g=!0,K.prototype.getBandwidthEstimate=function(e){return 128e3>this.g?e:Math.min(H(this.h),H(this.i))};var Y={sb:0,kc:function(){},ba:function(){},error:function(){},v:function(){},info:function(){},debug:function(){},K:function(){},O:function(){}};function z(e,t,r,n){for(var i=[],a=3;a<arguments.length;++a)i[a-3]=arguments[a];this.severity=e,this.category=t,this.code=r,this.data=i,this.handled=!1}t.console&&t.console.log.bind&&(Y.ba=console.warn.bind(console),Y.kc=console.error.bind(console),1<=Y.sb&&(Y.error=console.error.bind(console)),2<=Y.sb&&(Y.v=console.warn.bind(console)),3<=Y.sb&&(Y.info=console.info.bind(console)),4<=Y.sb&&(Y.debug=console.log.bind(console)),5<=Y.sb&&(Y.K=console.debug.bind(console)),6<=Y.sb&&(Y.O=console.debug.bind(console))),F("shaka.util.Error",z),z.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},z.Severity={RECOVERABLE:1,CRITICAL:2},z.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},z.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013};var J=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function Q(e){var t;e instanceof Q?(q(this,e.Ba),this.pb=e.pb,this.Aa=e.Aa,ee(this,e.Ob),this.pa=e.pa,te(this,e.g.clone()),this.bb=e.bb):e&&(t=String(e).match(J))?(q(this,t[1]||"",!0),this.pb=re(t[2]||""),this.Aa=re(t[3]||"",!0),ee(this,t[4]),this.pa=re(t[5]||"",!0),te(this,t[6]||"",!0),this.bb=re(t[7]||"")):this.g=new ce(null)}function q(e,t,r){e.Ba=r?re(t,!0):t,e.Ba&&(e.Ba=e.Ba.replace(/:$/,""))}function ee(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.Ob=t}else e.Ob=null}function te(e,t,r){t instanceof ce?e.g=t:(r||(t=ne(t,le)),e.g=new ce(t))}function re(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""}function ne(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,ie),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ie(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}(i=Q.prototype).Ba="",i.pb="",i.Aa="",i.Ob=null,i.pa="",i.bb="",i.toString=function(){var e=[],t=this.Ba;if(t&&e.push(ne(t,ae,!0),":"),t=this.Aa){e.push("//");var r=this.pb;r&&e.push(ne(r,ae,!0),"@"),e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.Ob)&&e.push(":",String(t))}return(t=this.pa)&&(this.Aa&&"/"!=t.charAt(0)&&e.push("/"),e.push(ne(t,"/"==t.charAt(0)?se:oe,!0))),(t=this.g.toString())&&e.push("?",t),(t=this.bb)&&e.push("#",ne(t,ue)),e.join("")},i.resolve=function(e){var t=this.clone();"data"===t.Ba&&(t=new Q);var r=!!e.Ba;r?q(t,e.Ba):r=!!e.pb,r?t.pb=e.pb:r=!!e.Aa,r?t.Aa=e.Aa:r=null!=e.Ob;var n=e.pa;if(r)ee(t,e.Ob);else if(r=!!e.pa){if("/"!=n.charAt(0))if(this.Aa&&!this.pa)n="/"+n;else{var i=t.pa.lastIndexOf("/");-1!=i&&(n=t.pa.substr(0,i+1)+n)}if(".."==n||"."==n)n="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){i=0==n.lastIndexOf("/",0),n=n.split("/");for(var a=[],o=0;o<n.length;){var s=n[o++];"."==s?i&&o==n.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),i&&o==n.length&&a.push("")):(a.push(s),i=!0)}n=a.join("/")}}return r?t.pa=n:r=""!==e.g.toString(),r?te(t,e.g.clone()):r=!!e.bb,r&&(t.bb=e.bb),t},i.clone=function(){return new Q(this)};var ae=/[#\/\?@]/g,oe=/[#\?:]/g,se=/[#\?]/g,le=/[#\?@]/g,ue=/#/g;function ce(e){this.g=e||null}(i=ce.prototype).na=null,i.qc=null,i.add=function(e,t){if(!this.na&&(this.na={},this.qc=0,this.g))for(var r=this.g.split("&"),n=0;n<r.length;n++){var i=r[n].indexOf("="),a=null;if(0<=i){var o=r[n].substring(0,i);a=r[n].substring(i+1)}else o=r[n];o=decodeURIComponent(o.replace(/\+/g," ")),a=a||"",this.add(o,decodeURIComponent(a.replace(/\+/g," ")))}return this.g=null,(r=this.na.hasOwnProperty(e)&&this.na[e])||(this.na[e]=r=[]),r.push(t),this.qc++,this},i.toString=function(){if(this.g)return this.g;if(!this.na)return"";var e,t=[];for(e in this.na)for(var r=encodeURIComponent(e),n=this.na[e],i=0;i<n.length;i++){var a=r;""!==n[i]&&(a+="="+encodeURIComponent(n[i])),t.push(a)}return this.g=t.join("&")},i.clone=function(){var e=new ce;if(e.g=this.g,this.na){var t,r={};for(t in this.na)r[t]=this.na[t].concat();e.na=r,e.qc=this.qc}return e};var de={df:function(e,t){return e.reduce(function(e,t,r){return t.catch(e.bind(null,r))}.bind(null,t),Promise.reject())},Rc:function(e,t){return e.concat(t)},Bc:function(){},Ra:function(e){return null!=e}};function he(e,t){if(0==t.length)return e;var r=t.map((function(e){return new Q(e)}));return e.map((function(e){return new Q(e)})).map((function(e){return r.map(e.resolve.bind(e))})).reduce(de.Rc,[]).map((function(e){return e.toString()}))}function fe(e,t){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:t||[],keyIds:[]}}var pe={Za:"video",Sb:"audio",za:"text",Ug:"image",Sg:"application"},ye=1/15;function me(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.resolve=e,r.reject=t,r}function ge(e){if(!e)return"";239==(e=new Uint8Array(e))[0]&&187==e[1]&&191==e[2]&&(e=e.subarray(3)),e=Te(e),e=escape(e);try{return decodeURIComponent(e)}catch(t){throw new z(2,2,2004)}}function ve(e,t,r){if(!e)return"";if(!r&&0!=e.byteLength%2)throw Y.error("Data has an incorrect length, must be even."),new z(2,2,2004);if(e instanceof ArrayBuffer)var n=e;else(r=new Uint8Array(e.byteLength)).set(new Uint8Array(e)),n=r.buffer;e=Math.floor(e.byteLength/2),r=new Uint16Array(e),n=new DataView(n);for(var i=0;i<e;i++)r[i]=n.getUint16(2*i,t);return Te(r)}function be(e){var t=new Uint8Array(e);if(239==t[0]&&187==t[1]&&191==t[2])return ge(t);if(254==t[0]&&255==t[1])return ve(t.subarray(2),!1);if(255==t[0]&&254==t[1])return ve(t.subarray(2),!0);var r=function(e,t){return e.byteLength<=t||32<=e[t]&&126>=e[t]}.bind(null,t);if(Y.debug("Unable to find byte-order-mark, making an educated guess."),0==t[0]&&0==t[2])return ve(e,!1);if(0==t[1]&&0==t[3])return ve(e,!0);if(r(0)&&r(1)&&r(2)&&r(3))return ge(e);throw new z(2,2,2003)}function _e(e){e=encodeURIComponent(e),e=unescape(e);for(var t=new Uint8Array(e.length),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t.buffer}function Ee(e,t){for(var r=new Uint8Array(2*e.length),n=new DataView(r.buffer),i=0;i<e.length;++i)n.setUint16(2*i,e.charCodeAt(i),t);return r.buffer}function Te(e){if(!Se)for(var t=function(e){try{var t=new Uint8Array(e);return 0<String.fromCharCode.apply(null,t).length}catch(r){return!1}},r={size:65536};0<r.size;(r={size:r.size}).size/=2)if(t(r.size)){Se=function(e){return function(t){for(var r="",n=0;n<t.length;n+=e.size)r+=String.fromCharCode.apply(null,t.subarray(n,n+e.size));return r}}(r);break}return Se(e)}me.prototype.resolve=function(){},me.prototype.reject=function(){},F("shaka.util.StringUtils.fromUTF8",ge),F("shaka.util.StringUtils.fromUTF16",ve),F("shaka.util.StringUtils.fromBytesAutoDetect",be),F("shaka.util.StringUtils.toUTF8",_e),F("shaka.util.StringUtils.toUTF16",Ee);var Se=null;F("shaka.util.StringUtils.resetFromCharCode",(function(){Se=null}));var $e={Mc:function(e,r){var n=Te(e);return r=null==r||r,n=t.btoa(n).replace(/\+/g,"-").replace(/\//g,"_"),r?n:n.replace(/=*$/,"")}};function Ae(){this.g=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.h=null,this.l=[],this.i=[],this.j=!1,this.g.on("data",this.o.bind(this)),this.g.on("done",this.m.bind(this))}function we(e,r){return!(!t.muxjs||"mp2t"!=e.toLowerCase().split(";")[0].split("/")[1])&&(r?MediaSource.isTypeSupported(ke(r,e)):MediaSource.isTypeSupported(ke("audio",e))||MediaSource.isTypeSupported(ke("video",e)))}function ke(e,t){var r=t.replace(/mp2t/i,"mp4");"audio"==e&&(r=r.replace("video","audio"));var n=/avc1\.(66|77|100)\.(\d+)/.exec(r);if(n){var i="avc1.",a=n[1],o=Number(n[2]);i=("66"==a?i+"4200":"77"==a?i+"4d00":i+"6400")+(o>>4).toString(16),i+=(15&o).toString(16),r=r.replace(n[0],i)}return r}function Ie(e){this.h=e,this.g=null}function Ce(e){this.h=e,this.g=null}function Pe(e,t){var r={maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0};this.o=null==e.maxAttempts?r.maxAttempts:e.maxAttempts,this.j=null==e.baseDelay?r.baseDelay:e.baseDelay,this.m=null==e.fuzzFactor?r.fuzzFactor:e.fuzzFactor,this.l=null==e.backoffFactor?r.backoffFactor:e.backoffFactor,this.g=0,this.h=this.j,(this.i=void 0!==t&&t)&&(this.g=1)}function xe(e){return y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:if(e.g>=e.o){if(!e.i)return t.return(Promise.reject());e.g=1,e.h=e.j}return r=e.g,e.g++,0==r?t.return():(n=e.h*(1+(2*Math.random()-1)*e.m),A(t,new Promise((function(e){new Ce(e).V(n/1e3)})),2));case 2:e.h*=e.l,w(t)}}))}))}function Re(e,t){this.promise=e,this.se=t,this.g=!1}function Oe(e){return new Re(Promise.reject(e),(function(){return Promise.resolve()}))}function Le(){var e=Promise.reject(new z(2,7,7001));return e.catch((function(){})),new Re(e,(function(){return Promise.resolve()}))}function De(e){return new Re(Promise.resolve(e),(function(){return Promise.resolve()}))}function Me(e){return new Re(e,(function(){return e.catch((function(){}))}))}function Ne(e){return new Re(Promise.all(e.map((function(e){return e.promise}))),(function(){return Promise.all(e.map((function(e){return e.abort()})))}))}function Ge(e,r){for(var n in r=void 0===r?{}:r)this[n]=r[n];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=t.performance&&t.performance.now?t.performance.now():Date.now(),this.type=e,this.isTrusted=!1,this.target=this.currentTarget=null,this.g=!1}function Ve(){this.g={}}function Ue(){this.hd=new Ve,this.jc=this}function Ze(e){var t=new Set;return function e(r){switch(_typeof$b(r)){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return r;default:if(!r||r.buffer&&r.buffer.constructor==ArrayBuffer)return r;if(t.has(r))return null;var n=r.constructor==Array;if(r.constructor!=Object&&!n)return null;t.add(r);var i,a=n?[]:{};for(i in r)a[i]=e(r[i]);return n&&(a.length=r.length),a}}(e)}function Be(e,t){return!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||e===t}function Fe(e,t){var r=e.indexOf(t);-1<r&&e.splice(r,1)}function je(e,t,r){if(r||(r=Be),e.length!=t.length)return!1;t=t.slice();for(var n={},i=(e=f(e)).next();!i.done;n={item:n.item},i=e.next()){if(n.item=i.value,-1==(i=t.findIndex(function(e){return function(t){return r(e.item,t)}}(n))))return!1;t[i]=t[t.length-1],t.pop()}return 0==t.length}function We(){this.g=[]}function Xe(e,t){e.g.push(t.finally((function(){Fe(e.g,t)})))}function He(e){Ue.call(this),this.j=!1,this.l=new We,this.g=new Set,this.h=new Set,this.i=e||null}F("shaka.util.Uint8ArrayUtils.toBase64",$e.Mc),$e.Ja=function(e){e=t.atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r},F("shaka.util.Uint8ArrayUtils.fromBase64",$e.Ja),$e.$c=function(e){for(var r=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)r[n/2]=t.parseInt(e.substr(n,2),16);return r},F("shaka.util.Uint8ArrayUtils.fromHex",$e.$c),$e.Nc=function(e){for(var t="",r=0;r<e.length;++r){var n=e[r].toString(16);1==n.length&&(n="0"+n),t+=n}return t},F("shaka.util.Uint8ArrayUtils.toHex",$e.Nc),$e.Ha=function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!=t[r])return!1;return!0},F("shaka.util.Uint8ArrayUtils.equal",$e.Ha),$e.concat=function(e){for(var t=[],r=0;r<arguments.length;++r)t[r]=arguments[r];for(var n=r=0;n<t.length;++n)r+=t[n].length;r=new Uint8Array(r);for(var i=n=0;i<t.length;++i)r.set(t[i],n),n+=t[i].length;return r},F("shaka.util.Uint8ArrayUtils.concat",$e.concat),Ae.prototype.destroy=function(){return this.g.dispose(),this.g=null,Promise.resolve()},Ae.prototype.o=function(e){this.i=e.captions;var t=new Uint8Array(e.data.byteLength+e.initSegment.byteLength);t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength),this.l.push(t)},Ae.prototype.m=function(){var e={data:$e.concat.apply(null,this.l),captions:this.i};this.h.resolve(e),this.j=!1},Ie.prototype.V=function(e){var r=this;this.stop();var n=!0,i=null;return this.g=function(){t.clearTimeout(i),n=!1},i=t.setTimeout((function(){n&&r.h()}),1e3*e),this},Ie.prototype.stop=function(){this.g&&(this.g(),this.g=null)},F("shaka.util.Timer",Ce),Ce.prototype.Lc=function(){return this.stop(),this.h(),this},Ce.prototype.tickNow=Ce.prototype.Lc,Ce.prototype.V=function(e){var t=this;return this.stop(),this.g=new Ie((function(){t.h()})).V(e),this},Ce.prototype.tickAfter=Ce.prototype.V,Ce.prototype.Oa=function(e){var t=this;return this.stop(),this.g=new Ie((function(){t.g.V(e),t.h()})).V(e),this},Ce.prototype.tickEvery=Ce.prototype.Oa,Ce.prototype.stop=function(){this.g&&(this.g.stop(),this.g=null)},Ce.prototype.stop=Ce.prototype.stop,F("shaka.util.AbortableOperation",Re),Re.failed=Oe,Re.aborted=Le,Re.completed=De,Re.notAbortable=Me,Re.prototype.abort=function(){return this.g=!0,this.se()},Re.prototype.abort=Re.prototype.abort,Re.all=Ne,Re.prototype.finally=function(e){return this.promise.then((function(){return e(!0)}),(function(){return e(!1)})),this},Re.prototype.finally=Re.prototype.finally,Re.prototype.ca=function(e,t){function r(r){return function(s){if(i.g&&r)a.reject(o);else{var l=r?e:t;l?n=function(e,t,r){try{var n=e(t);return n&&n.promise&&n.abort?(r.resolve(n.promise),function(){return n.abort()}):(r.resolve(n),function(){return Promise.resolve(n).then((function(){}),(function(){}))})}catch(i){return r.reject(i),function(){return Promise.resolve()}}}(l,s,a):(r?a.resolve:a.reject)(s)}}}function n(){return a.reject(o),i.abort()}var i=this,a=new me,o=new z(2,7,7001);return this.promise.then(r(!0),r(!1)),new Re(a,(function(){return n()}))},Re.prototype.chain=Re.prototype.ca,F("shaka.util.FakeEvent",Ge),Ge.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},Ge.prototype.stopImmediatePropagation=function(){this.g=!0},Ge.prototype.stopPropagation=function(){},(i=Ve.prototype).push=function(e,t){this.g.hasOwnProperty(e)?this.g[e].push(t):this.g[e]=[t]},i.get=function(e){return(e=this.g[e])?e.slice():null},i.getAll=function(){var e,t=[];for(e in this.g)t.push.apply(t,this.g[e]);return t},i.remove=function(e,t){var r=this.g[e];if(r)for(var n=0;n<r.length;++n)r[n]==t&&(r.splice(n,1),--n)},i.forEach=function(e){for(var t in this.g)e(t,this.g[t])},i.size=function(){return Object.keys(this.g).length},Ue.prototype.addEventListener=function(e,t){this.hd.push(e,t)},Ue.prototype.removeEventListener=function(e,t){this.hd.remove(e,t)},Ue.prototype.dispatchEvent=function(t){for(var r=this.hd.get(t.type)||[],n=0;n<r.length;++n){t.target=this.jc,t.currentTarget=this.jc;var i=r[n];try{i.handleEvent?i.handleEvent(t):i.call(this,t)}catch(e){Y.error("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(t.g)break}return t.defaultPrevented},We.prototype.destroy=function(){var e=[];return this.g.forEach((function(t){t.promise.catch((function(){})),e.push(t.abort())})),this.g=[],Promise.all(e)},j(He,Ue),F("shaka.net.NetworkingEngine",He),He.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},He.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3};var Ke={};function Ye(e,t,r){r=r||3;var n=Ke[e];(!n||r>=n.priority)&&(Ke[e]={priority:r,mg:t})}function ze(e,t){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null}}function Je(e,t,r,n,i,a,o){var s=new Q(r.uris[i]),l=s.Ba,u=!1;l||(q(s,l=(l=location.protocol).slice(0,-1)),r.uris[i]=s.toString()),l=l.toLowerCase();var c,d=(l=Ke[l])?l.mg:null;return d?Me(xe(n)).ca((function(){return e.j?Le():(c=Date.now(),d(r.uris[i],r,t,(function(r,n,i){e.i&&1==t&&(e.i(r,n),u=!0,o.g=i)})))})).ca((function(e){return null==e.timeMs&&(e.timeMs=Date.now()-c),{response:e,Nf:u}}),(function(s){if(s&&7001==s.code)throw s;if(e.j)return Le();if(s&&1==s.severity)return e.dispatchEvent(new Ge("retry",{error:s instanceof z?s:null})),i=(i+1)%r.uris.length,Je(e,t,r,n,i,s,o);throw s||a})):Oe(new z(2,1,1e3,s))}function Qe(){this.g=0}function qe(e,t,r){Re.call(this,e,t),this.h=r}function et(){}function tt(){this.g=new Ve}function rt(t,r,n,i){this.target=t,this.type=r,this.listener=n,this.g=function(t,r){if(null==r)return!1;if("boolean"==typeof r)return r;var n=new Set(["passive","capture"]);return Object.keys(r).filter((function(e){return!n.has(e)})),function(t){var r=nt;if(null==r){r=!1;try{var n={},i={get:function(){return r=!0,!1}};Object.defineProperty(n,"passive",i),Object.defineProperty(n,"capture",i),i=function(){},t.addEventListener("test",i,n),t.removeEventListener("test",i,n)}catch(e){r=!1}nt=r}return r||!1}(t)?r:r.capture||!1}(t,i),this.target.addEventListener(r,n,this.g)}He.registerScheme=Ye,He.unregisterScheme=function(e){delete Ke[e]},He.prototype.og=function(e){this.g.add(e)},He.prototype.registerRequestFilter=He.prototype.og,He.prototype.Ng=function(e){this.g.delete(e)},He.prototype.unregisterRequestFilter=He.prototype.Ng,He.prototype.bf=function(){this.g.clear()},He.prototype.clearAllRequestFilters=He.prototype.bf,He.prototype.pg=function(e){this.h.add(e)},He.prototype.registerResponseFilter=He.prototype.pg,He.prototype.Og=function(e){this.h.delete(e)},He.prototype.unregisterResponseFilter=He.prototype.Og,He.prototype.cf=function(){this.h.clear()},He.prototype.clearAllResponseFilters=He.prototype.cf,He.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}},He.makeRequest=ze,He.prototype.destroy=function(){return this.j=!0,this.g.clear(),this.h.clear(),this.l.destroy()},He.prototype.destroy=He.prototype.destroy,He.prototype.request=function(e,t){var r=this,n=new Qe;if(this.j){var i=Promise.reject(new z(2,7,7001));return i.catch((function(){})),new qe(i,(function(){return Promise.resolve()}),n)}t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?Ze(t.retryParameters):{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},t.uris=Ze(t.uris),i=function(e,t,r){for(var n=De(void 0),i={},a=(e=f(e.g)).next();!a.done;i={Gd:i.Gd},a=e.next())i.Gd=a.value,n=n.ca(function(e){return function(){return e.Gd(t,r)}}(i));return n.ca(void 0,(function(e){if(e&&7001==e.code)throw e;throw new z(2,1,1006,e)}))}(this,e,t);var a=i.ca((function(){return Je(r,e,t,new Pe(t.retryParameters,!1),0,null,n)})),o=a.ca((function(t){return function(e,t,r){for(var n=De(void 0),i=(e=f(e.h)).next();!i.done;i=e.next())n=n.ca(i.value.bind(null,t,r.response));return n.ca((function(){return r}),(function(e){if(e&&7001==e.code)throw e;var t=2;throw e instanceof z&&(t=e.severity),new z(t,1,1007,e)}))}(r,e,t)})),s=Date.now(),l=0;i.promise.then((function(){l=Date.now()-s}),(function(){}));var u=0;return a.promise.then((function(){u=Date.now()}),(function(){})),i=new qe((i=o.ca((function(t){var n=Date.now()-u,i=t.response;return i.timeMs+=l,i.timeMs+=n,t.Nf||!r.i||i.fromCache||1!=e||r.i(i.timeMs,i.data.byteLength),i}),(function(e){throw e&&(e.severity=2),e}))).promise,i.se,n),Xe(this.l,i),i},He.prototype.request=He.prototype.request,He.NumBytesRemainingClass=Qe,E(qe,Re),He.PendingRequest=qe,qe.all=Ne,qe.notAbortable=Me,qe.completed=De,qe.aborted=Le,qe.failed=Oe,F("shaka.util.IReleasable",et),et.prototype.release=function(){},F("shaka.util.EventManager",tt),tt.prototype.release=function(){this.nb(),this.g=null},tt.prototype.release=tt.prototype.release,tt.prototype.H=function(e,t,r,n){this.g&&(e=new rt(e,t,r,n),this.g.push(t,e))},tt.prototype.listen=tt.prototype.H,tt.prototype.ya=function(e,t,r,n){var i=this;this.H(e,t,(function n(a){i.ta(e,t,n),r(a)}),n)},tt.prototype.listenOnce=tt.prototype.ya,tt.prototype.ta=function(e,t,r){if(this.g)for(var n=this.g.get(t)||[],i=(n=f(n)).next();!i.done;i=n.next())(i=i.value).target!=e||r!=i.listener&&r||(i.ta(),this.g.remove(t,i))},tt.prototype.unlisten=tt.prototype.ta,tt.prototype.nb=function(){if(this.g){for(var e=this.g.getAll(),t=(e=f(e)).next();!t.done;t=e.next())t.value.ta();this.g.g={}}},tt.prototype.removeAll=tt.prototype.nb,rt.prototype.ta=function(){this.target.removeEventListener(this.type,this.listener,this.g),this.listener=this.target=null,this.g=!1},rt.prototype.unlisten=rt.prototype.ta;var nt=void 0;function it(e){return new Q(e=be(e)).Aa}function at(e,t,r){function n(e){new DataView(i.buffer).setUint32(a,e.byteLength,!0),a+=4,i.set(e,a),a+=e.byteLength}if(!r||!r.byteLength)throw new z(2,6,6015);t="string"==typeof t?new Uint8Array(Ee(t,!0)):new Uint8Array(t),e=Ee(e=be(e),!0);var i=new Uint8Array(12+e.byteLength+t.byteLength+r.byteLength),a=0;return n(new Uint8Array(e)),n(t),n(new Uint8Array(r)),i}function ot(e,t){for(var r=[],n=f(e),i=n.next();!i.done;i=n.next())r.push(t(i.value));return r}function st(e,t){for(var r=f(e),n=r.next();!n.done;n=r.next())if(!t(n.value))return!1;return!0}function lt(e){var t=new Map;return Object.keys(e).forEach((function(r){t.set(r,e[r])})),t}function ut(e){var t={};return e.forEach((function(e,r){t[r]=e})),t}function ct(e,t){var r=e;return t&&(r+='; codecs="'+t+'"'),r}function dt(e){return(e=e.split(/ *; */)).shift(),(e=e.find((function(e){return e.startsWith("codecs=")})))?e.split("=")[1].replace(/^"|"$/g,""):""}function ht(e){var t=(e=e.split("."))[0];return e.pop(),[t,e.join(".")]}F("shaka.util.FairPlayUtils.defaultGetContentId",it),F("shaka.util.FairPlayUtils.initDataTransform",at);var ft=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels");function pt(){return!(!t.MediaSource||!MediaSource.isTypeSupported)}function yt(e){return""!=_t().canPlayType(e)}function mt(){return bt("Tizen")}function gt(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!mt()}function vt(){if(!gt())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e||(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function bt(e){return(navigator.userAgent||"").includes(e)}function _t(){return Tt||(Et||(Et=new Ce((function(){Tt=null}))),(Tt=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(Tt=document.createElement("video")),Et.V(1),Tt)}var Et=null,Tt=null;function St(e,t){var r=this;t=void 0===t?1:t,this.J=e,this.C=new Set,this.m=this.o=null,this.Z=!1,this.P=0,this.g=null,this.u=new tt,this.h=new Map,this.F=[],this.A=new me,this.j=null,this.l=function(t){r.A.reject(t),e.onError(t)},this.wa=new Map,this.da=new Map,this.X=new Ce((function(){return function(e){var t=e.wa,r=e.da;r.clear(),t.forEach((function(e,t){return r.set(t,e)})),(t=Array.from(r.values())).length&&t.every((function(e){return"expired"==e}))&&e.l(new z(2,6,6014)),e.J.Dc(ut(r))}(r)})),this.i=!1,this.ua=new me,this.L=!1,this.M=[],this.va=!1,this.ea=new Ce((function(){!function(e){e.h.forEach((function(t,r){var n=t.xd,i=r.expiration;isNaN(i)&&(i=1/0),i!=n&&(e.J.onExpirationUpdated(r.sessionId,i),t.xd=i)}))}(r)})).Oa(t),this.A.catch((function(){}))}function $t(e,t,r){return e.F=r,e.L=0<r.length,At(e,t)}function At(e,r){var n=function(e){if(0==(e=lt(e.j.clearKeys)).size)return null;var r=[],n=[];e.forEach((function(e,t){var i=$e.$c(t),a=$e.$c(e);i={kty:"oct",kid:$e.Mc(i,!1),k:$e.Mc(a,!1)},r.push(i),n.push(i.kid)})),e=JSON.stringify({keys:r});var i=JSON.stringify({kids:n});return i=[{initData:new Uint8Array(_e(i)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+t.btoa(e),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:i,keyIds:[]}}(e);if(n)for(var i=f(r),a=i.next();!a.done;a=i.next())a.value.drmInfos=[n];for((n=r.some((function(e){return 0<e.drmInfos.length})))||function(e,t){var r=[];t.forEach((function(e,t){r.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:[]})}));for(var n=f(e),i=n.next();!i.done;i=n.next())i.value.drmInfos=r}(r,a=lt(e.j.servers)),a=(i=f(r)).next();!a.done;a=i.next())for(var o=(a=f(a.value.drmInfos)).next();!o.done;o=a.next())Bt(o.value,lt(e.j.servers),lt(e.j.advanced||{}));return a=function(e,t){for(var r=new Set,n=f(t),i=n.next();!i.done;i=n.next()){var a=f(i.value.drmInfos);for(i=a.next();!i.done;i=a.next())r.add(i.value)}for(n=f(r),i=n.next();!i.done;i=n.next())Bt(i.value,lt(e.j.servers),lt(e.j.advanced||{}));a=e.L?"required":"optional";var o=e.L?["persistent-license"]:["temporary"];for(n=new Map,r=f(r),i=r.next();!i.done;i=r.next())i=i.value,n.set(i.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:a,sessionTypes:o,label:i.keySystem,drmInfos:[]});for(r=f(t),i=r.next();!i.done;i=r.next()){a=(i=i.value).audio,o=i.video;var s=a?Rt(a):"",l=o?Rt(o):"",u=f(i.drmInfos);for(i=u.next();!i.done;i=u.next()){i=i.value;var c=n.get(i.keySystem);c.drmInfos.push(i),i.distinctiveIdentifierRequired&&(c.distinctiveIdentifier="required"),i.persistentStateRequired&&(c.persistentState="required"),a&&(c.audioCapabilities.push({robustness:i.audioRobustness||"",contentType:s}),"ac-3"==a.codecs.toLowerCase()&&mt()&&c.audioCapabilities.push({robustness:i.audioRobustness||"",contentType:ct(a.mimeType,"ec-3")})),o&&c.videoCapabilities.push({robustness:i.videoRobustness||"",contentType:l})}}return n}(e,r),a.size?(a=Ot(e,a),n?a:a.catch((function(){}))):(e.Z=!0,Promise.resolve())}function wt(e){return y((function t(){var r;return N(t,(function(t){switch(t.s){case 1:if(!(e.o&&e.g&&e.g.serverCertificate&&e.g.serverCertificate.length)){t.I(0);break}return k(t,3),A(t,e.o.setServerCertificate(e.g.serverCertificate),5);case 5:t.B||Y.v("Server certificates are not supported by the key system.  The server certificate has been ignored."),C(t,0);break;case 3:return r=P(t),t.return(Promise.reject(new z(2,6,6004,r.message)))}}))}))}function kt(e){var t=e.g?e.g.initData:[];return t.forEach((function(t){return It(e,t.initDataType,t.initData)})),e.F.forEach((function(t){return Lt(e,t)})),t.length||e.F.length||e.A.resolve(),e.A}function It(e,t,r){for(var n=e.h.values(),i=(n=f(n)).next();!i.done;i=n.next())if($e.Ha(r,i.value.initData)&&!bt("Tizen 2"))return void Y.debug("Ignoring duplicate init data.");!function(e,t,r){try{if(e.L){Y.K("Creating new persistent session");var n=e.o.createSession("persistent-license")}else Y.K("Creating new temporary session"),n=e.o.createSession()}catch(i){return void e.l(new z(2,6,6005,i.message))}e.u.H(n,"message",e.ye.bind(e)),e.u.H(n,"keystatuseschange",e.we.bind(e)),e.h.set(n,{initData:r,loaded:!1,xd:1/0,Ga:null});try{r=e.j.initDataTransform(r,e.g)}catch(i){return t=i,i instanceof z||(t=new z(2,6,6016,i)),void e.l(t)}n.generateRequest(t,r).catch((function(t){if(!e.i){if(e.h.delete(n),t.errorCode&&t.errorCode.systemCode){var r=t.errorCode.systemCode;0>r&&(r+=Math.pow(2,32)),r="0x"+r.toString(16)}e.l(new z(2,6,6006,t.message,t,r))}}))}(e,t,r)}function Ct(e){return e?e.keySystem:""}function Pt(e,t){if(navigator.userAgent.match(/Edge\//))return!0;if(t=t.toLowerCase(),mt()&&t.includes('codecs="ac-3"')){var r=t.replace("ac-3","ec-3");return e.C.has(t)||e.C.has(r)}return e.C.has(t)}function xt(e){return e=ot(e=e.h.keys(),(function(e){return e.sessionId})),Array.from(e)}function Rt(e){var t=ct(e.mimeType,e.codecs);return we(t)?ke(e.type,t):t}function Ot(e,t){if(1==t.size&&t.has(""))return Promise.reject(new z(2,6,6e3));for(var r=f(t.values()),n=r.next();!n.done;n=r.next())0==(n=n.value).audioCapabilities.length&&delete n.audioCapabilities,0==n.videoCapabilities.length&&delete n.videoCapabilities;var i=r=new me;return[!0,!1].forEach(function(e){var r=this;t.forEach((function(t,n){t.drmInfos.some((function(e){return!!e.licenseServerUri}))==e&&(i=i.catch(function(){if(!this.i)return navigator.requestMediaKeySystemAccess(n,[t])}.bind(r)))}))}.bind(e)),i=(i=i.catch((function(){return Promise.reject(new z(2,6,6001))}))).then(function(e){if(this.i)return Promise.reject();this.C.clear();var r=e.getConfiguration(),n=r.videoCapabilities||[],i=f(r.audioCapabilities||[]);for(r=i.next();!r.done;r=i.next())this.C.add(r.value.contentType.toLowerCase());for(r=(n=f(n)).next();!r.done;r=n.next())this.C.add(r.value.contentType.toLowerCase());n=e.keySystem,i=[];var a=[],o=[],s=[];return function(e,t,r,n,i){e.forEach((function(e){if(t.includes(e.licenseServerUri)||t.push(e.licenseServerUri),e.serverCertificate&&(r.some((function(t){return $e.Ha(t,e.serverCertificate)}))||r.push(e.serverCertificate)),e.initData&&e.initData.forEach((function(e){n.some((function(t){return!(!t.keyId||t.keyId!=e.keyId)||t.initDataType==e.initDataType&&$e.Ha(t.initData,e.initData)}))||n.push(e)})),e.keyIds)for(var a=0;a<e.keyIds.length;++a)i.includes(e.keyIds[a])||i.push(e.keyIds[a])}))}((r=t.get(e.keySystem)).drmInfos,i,a,o,s),1<a.length&&Y.v("Multiple unique server certificates found! Only the first will be used."),1<i.length&&Y.v("Multiple unique license server URIs found! Only the first will be used."),this.g={keySystem:n,licenseServerUri:i[0],distinctiveIdentifierRequired:"required"==r.distinctiveIdentifier,persistentStateRequired:"required"==r.persistentState,audioRobustness:(r.audioCapabilities?r.audioCapabilities[0].robustness:"")||"",videoRobustness:(r.videoCapabilities?r.videoCapabilities[0].robustness:"")||"",serverCertificate:a[0],initData:o,keyIds:s},this.g.licenseServerUri?e.createMediaKeys():Promise.reject(new z(2,6,6012,this.g.keySystem))}.bind(e)).then(function(e){if(this.i)return Promise.reject();Y.info("Created MediaKeys object for key system",this.g.keySystem),this.o=e,this.Z=!0}.bind(e)).catch(function(e){if(!this.i)return this.g=null,this.C.clear(),e instanceof z?Promise.reject(e):Promise.reject(new z(2,6,6002,e.message))}.bind(e)),r.reject(),i}function Lt(e,t){try{Y.K("Attempting to load an offline session",t);var r=e.o.createSession("persistent-license")}catch(a){var n=new z(2,6,6005,a.message);return e.l(n),Promise.reject(n)}e.u.H(r,"message",e.ye.bind(e)),e.u.H(r,"keystatuseschange",e.we.bind(e));var i={initData:null,loaded:!1,xd:1/0,Ga:null};return e.h.set(r,i),r.load(t).then(function(e){return this.i?Promise.reject():(Y.O("Loaded offline session",t,e),e?(i.loaded=!0,Zt(this)&&this.A.resolve(),r):(this.h.delete(r),void this.l(new z(2,6,6013))))}.bind(e),function(e){this.i||(this.h.delete(r),this.l(new z(2,6,6005,e.message)))}.bind(e))}function Dt(e,t){if(Ct(t).startsWith("com.apple.fps")){var r=t.serverCertificate;e=at(e,it(e),r)}return e}function Mt(e,t){var r=t.target;Y.K("Sending license request for session",r.sessionId,"of type",t.messageType);var n=e.h.get(r),i=e.g.licenseServerUri,a=e.j.advanced[e.g.keySystem];"individualization-request"==t.messageType&&a&&a.individualizationServer&&(i=a.individualizationServer),(i=ze([i],e.j.retryParameters)).body=t.message,i.method="POST",i.licenseRequestType=t.messageType,i.sessionId=r.sessionId,"com.microsoft.playready"!=e.g.keySystem&&"com.chromecast.playready"!=e.g.keySystem||function(e){var t=ve(e.body,!0,!0);if(t.includes("PlayReadyKeyMessage")){Y.debug("Unwrapping PlayReady request.");for(var r=(t=(new DOMParser).parseFromString(t,"application/xml")).getElementsByTagName("HttpHeader"),n=0;n<r.length;++n)e.headers[r[n].getElementsByTagName("name")[0].textContent]=r[n].getElementsByTagName("value")[0].textContent;e.body=$e.Ja(t.getElementsByTagName("Challenge")[0].textContent).buffer}else Y.debug("PlayReady request is already unwrapped."),e.headers["Content-Type"]="text/xml; charset=utf-8"}(i),e.g.keySystem.startsWith("com.apple.fps")&&e.j.fairPlayTransform&&function(e){var t=new Uint8Array(e.body);t="spc="+$e.Mc(t),e.headers["Content-Type"]="application/x-www-form-urlencoded",e.body=_e(t)}(i);var o=Date.now();e.J.Ib.request(2,i).promise.then(function(e){return this.i?Promise.reject():(this.g.keySystem.startsWith("com.apple.fps")&&this.j.fairPlayTransform&&function(e){try{var t=ge(e.data)}catch(r){return}"<ckc>"===(t=t.trim()).substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6));try{t=JSON.parse(t).ckc}catch(r){}e.data=$e.Ja(t).buffer}(e),this.P+=(Date.now()-o)/1e3,Y.K("Updating session",r.sessionId),r.update(e.data).then(function(){var e=this;this.J.onEvent(new Ge("drmsessionupdate")),n&&(n.Ga&&n.Ga.resolve(),new Ce((function(){n.loaded=!0,Zt(e)&&e.A.resolve()})).V(jt))}.bind(this)))}.bind(e),function(e){this.i||(e=new z(2,6,6007,e),this.l(e),n&&n.Ga&&n.Ga.reject(e))}.bind(e)).catch(function(e){this.i||(e=new z(2,6,6008,e.message),this.l(e),n&&n.Ga&&n.Ga.reject(e))}.bind(e))}function Nt(){var e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],t=[{videoCapabilities:e,persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:e}],r=new Map;return e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").map((function(e){return n=e,y((function e(){var i,a,o;return N(e,(function(e){switch(e.s){case 1:return k(e,2),A(e,navigator.requestMediaKeySystemAccess(n,t),4);case 4:return i=e.B,o=!!(a=i.getConfiguration().sessionTypes)&&a.includes("persistent-license"),bt("Tizen 3")&&(o=!1),r.set(n,{persistentState:o}),A(e,i.createMediaKeys(),5);case 5:C(e,0);break;case 2:P(e),r.set(n,null),w(e)}}))}));var n})),Promise.all(e).then((function(){return ut(r)}))}function Gt(e,t){var r=t.audio,n=t.video;if(r&&r.encrypted&&!Pt(e,r=Rt(r))||n&&n.encrypted&&!Pt(e,n=Rt(n)))return!1;var i=Ct(e.g);return 0==t.drmInfos.length||t.drmInfos.some((function(e){return e.keySystem==i}))}function Vt(e,t){if(!e.length)return t;if(!t.length)return e;for(var r=[],n=0;n<e.length;n++)for(var i=0;i<t.length;i++)if(e[n].keySystem==t[i].keySystem){var a=e[n];i=t[i];var o=[];o=(o=o.concat(a.initData||[])).concat(i.initData||[]);var s=[];s=(s=s.concat(a.keyIds)).concat(i.keyIds),r.push({keySystem:a.keySystem,licenseServerUri:a.licenseServerUri||i.licenseServerUri,distinctiveIdentifierRequired:a.distinctiveIdentifierRequired||i.distinctiveIdentifierRequired,persistentStateRequired:a.persistentStateRequired||i.persistentStateRequired,videoRobustness:a.videoRobustness||i.videoRobustness,audioRobustness:a.audioRobustness||i.audioRobustness,serverCertificate:a.serverCertificate||i.serverCertificate,initData:o,keyIds:s});break}return r}function Ut(e){return y((function t(){var r;return N(t,(function(t){if(1===t.s)return r=Array.from(e.h.keys()),e.h.clear(),A(t,Promise.all(r.map((function(e){return y((function t(){return N(t,(function(t){switch(t.s){case 1:return Y.K("Closing session",e.sessionId),k(t,2),A(t,function(e){return y((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return r=new Promise((function(e,t){new Ce(t).V(Ft)})),k(t,2),A(t,Promise.race([Promise.all([e.close(),e.closed]),r]),4);case 4:C(t,0);break;case 2:P(t),Y.v("Timeout waiting for session close"),w(t)}}))}))}(e),4);case 4:C(t,0);break;case 2:P(t),w(t)}}))}))}))),0)}))}))}function Zt(e){return st(e=e.h.values(),(function(e){return e.loaded}))}function Bt(e,r,n){!e.keySystem||"org.w3.clearkey"==e.keySystem&&e.licenseServerUri||(r.size&&(r=r.get(e.keySystem)||"",e.licenseServerUri=r),e.keyIds||(e.keyIds=[]),(n=n.get(e.keySystem))&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=n.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=n.persistentStateRequired),e.videoRobustness||(e.videoRobustness=n.videoRobustness),e.audioRobustness||(e.audioRobustness=n.audioRobustness),e.serverCertificate||(e.serverCertificate=n.serverCertificate)),t.cast&&t.cast.__platform__&&"com.microsoft.playready"==e.keySystem&&(e.keySystem="com.chromecast.playready"))}(i=St.prototype).destroy=function(){var e=this;return y((function t(){return N(t,(function(t){switch(t.s){case 1:return e.i?A(t,e.ua,0):(e.i=!0,A(t,function(e){return y((function t(){return N(t,(function(t){switch(t.s){case 1:return e.u.release(),e.u=null,e.A.reject(),e.ea.stop(),e.ea=null,e.X.stop(),e.X=null,A(t,Ut(e),2);case 2:if(!e.m){t.I(3);break}return k(t,4),A(t,e.m.setMediaKeys(null),6);case 6:C(t,5);break;case 4:P(t);case 5:e.m=null;case 3:e.g=null,e.C.clear(),e.o=null,e.F=[],e.j=null,e.l=null,e.J=null,w(t)}}))}))}(e),4));case 4:e.ua.resolve(),t.I(0)}}))}))},i.configure=function(e){this.j=e},i.Ub=function(e){var t=this;if(!this.o)return this.u.ya(e,"encrypted",(function(){t.l(new z(2,6,6010))})),Promise.resolve();this.m=e,this.u.ya(this.m,"play",(function(){for(var e=0;e<t.M.length;e++)Mt(t,t.M[e]);t.va=!0,t.M=[]})),"webkitCurrentPlaybackTargetIsWireless"in this.m&&this.u.H(this.m,"webkitcurrentplaybacktargetiswirelesschanged",(function(){return Ut(t)})),e=(e=this.m.setMediaKeys(this.o)).catch((function(e){return Promise.reject(new z(2,6,6003,e.message))}));var r=wt(this);return Promise.all([e,r]).then((function(){if(t.i)return Promise.reject();kt(t),t.g.initData.length||t.F.length||t.u.H(t.m,"encrypted",(function(e){return It(t,e.initDataType,new Uint8Array(e.initData))}))})).catch((function(e){if(!t.i)return Promise.reject(e)}))},i.Xb=function(){for(var e=1/0,t=this.h.keys(),r=(t=f(t)).next();!r.done;r=t.next())r=r.value,isNaN(r.expiration)||(e=Math.min(e,r.expiration));return e},i.ye=function(e){this.m&&this.j.delayLicenseRequestUntilPlayed&&this.m.paused&&!this.va?this.M.push(e):Mt(this,e)},i.we=function(e){e=e.target,Y.O("Key status changed for session",e.sessionId);var t=this.h.get(e),r=!1;e.keyStatuses.forEach(function(e,n){if("string"==typeof n){var i=n;n=e,e=i}if("com.microsoft.playready"==this.g.keySystem&&16==n.byteLength&&(bt("Trident/")||navigator.userAgent.match(/Edge?\//))){var a=(i=new DataView(n)).getUint32(0,!0),o=i.getUint16(4,!0),s=i.getUint16(6,!0);i.setUint32(0,a,!1),i.setUint16(4,o,!1),i.setUint16(6,s,!1)}"com.microsoft.playready"==this.g.keySystem&&"status-pending"==e&&(e="usable"),"status-pending"!=e&&(t.loaded=!0),"expired"==e&&(r=!0),i=$e.Nc(new Uint8Array(n)),this.wa.set(i,e)}.bind(this));var n=e.expiration-Date.now();(0>n||r&&1e3>n)&&t&&!t.Ga&&(Y.debug("Session has expired",e.sessionId),this.h.delete(e),e.close().catch((function(){}))),Zt(this)&&(this.A.resolve(),this.X.V(Wt))};var Ft=1,jt=5,Wt=.5;function Xt(){this.g=new muxjs.mp4.CaptionParser,this.l=[],this.j={}}function Ht(){}function Kt(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:e.length?e.end(e.length-1):null}function Yt(e,t,r){return r=void 0===r?0:r,!(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)||t>e.end(e.length-1))&&t+r>=e.start(0)}function zt(e,t){if(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0))return 0;for(var r=0,n=e.length-1;0<=n&&e.end(n)>t;--n)r+=e.end(n)-Math.max(e.start(n),t);return r}function Jt(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}function Qt(e,t,r){this.startTime=e,this.direction=ir,this.endTime=t,this.payload=r,this.region=new hr,this.position=null,this.positionAlign=qt,this.size=0,this.textAlign=er,this.writingMode=ar,this.lineInterpretation=or,this.line=null,this.lineHeight="",this.lineAlign=sr,this.displayAlign=rr,this.fontSize=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=ur,this.fontStyle=cr,this.fontFamily="",this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=!1}Xt.prototype.init=function(e){var t=muxjs.mp4.probe;e=new Uint8Array(e),this.l=t.videoTrackIds(e),this.j=t.timescale(e),this.g.init()},Xt.prototype.h=function(e,t){var r=new Uint8Array(e);(r=this.g.parse(r,this.l,this.j))&&r.captions&&t(r.captions),this.g.clearParsedCaptions()},Xt.prototype.i=function(){this.g.resetCaptionStream()},Ht.prototype.init=function(){},Ht.prototype.h=function(){},Ht.prototype.i=function(){},F("shaka.text.Cue",Qt),Qt.prototype.clone=function(){var e,t=new Qt(0,0,"");for(e in this)t[e]=this[e],t[e]&&t[e].constructor==Array&&(t[e]=t[e].slice());return t};var qt="auto";Qt.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:qt};var er="center",tr={LEFT:"left",RIGHT:"right",CENTER:er,START:"start",END:"end"};Qt.textAlign=tr;var rr="after",nr={BEFORE:"before",CENTER:"center",AFTER:rr};Qt.displayAlign=nr;var ir="ltr";Qt.direction={HORIZONTAL_LEFT_TO_RIGHT:ir,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var ar="horizontal-tb";Qt.writingMode={HORIZONTAL_TOP_TO_BOTTOM:ar,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var or=0;Qt.lineInterpretation={LINE_NUMBER:or,PERCENTAGE:1};var sr="start",lr={CENTER:"center",START:sr,END:"end"};Qt.lineAlign=lr;var ur=400;Qt.fontWeight={NORMAL:ur,BOLD:700};var cr="normal",dr={NORMAL:cr,ITALIC:"italic",OBLIQUE:"oblique"};function hr(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=fr,this.scroll=pr}Qt.fontStyle=dr,Qt.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},F("shaka.text.CueRegion",hr);var fr=1;hr.units={PX:0,PERCENTAGE:fr,LINES:2};var pr="";function yr(e){this.l=null,this.i=e,this.j=this.A=0,this.m=1/0,this.h=this.g=null,this.u="",this.o=new Map}hr.scrollMode={NONE:pr,UP:"up"};var mr={};function gr(e){return!!(mr[e]||t.muxjs&&"application/cea-608"==e)}function vr(e,t){"application/cea-608"!=t&&(e.l=new mr[t])}function br(e,t,r,n,i){for(var a=r+" "+n,o=new Map,s=(t=f(t)).next();!s.done;s=t.next()){var l=s.value;s=l.stream,o.has(s)||o.set(s,new Map),o.get(s).has(a)||o.get(s).set(a,[]),l.startTime+=i,l.endTime+=i,l.startTime>=e.j&&l.startTime<e.m&&(l=new Qt(l.startTime,l.endTime,l.text),o.get(s).get(a).push(l),s==e.u&&e.i.append([l]))}for(a=(i=f(o.keys())).next();!a.done;a=i.next())for(a=a.value,e.o.has(a)||e.o.set(a,new Map),s=(t=f(o.get(a).keys())).next();!s.done;s=t.next())s=s.value,l=o.get(a).get(s),e.o.get(a).set(s,l);e.g=null==e.g?Math.max(r,e.j):Math.min(e.g,Math.max(r,e.j)),e.h=Math.max(e.h,Math.min(n,e.m))}function _r(e,t,r){this.j=e,this.l=r,this.h={},this.g=null,this.i={},this.o=new tt,this.F=!1,this.u={},this.A=t,this.C=new me,this.m=function(e,t){var r=new MediaSource;return e.o.ya(r,"sourceopen",(function(){URL.revokeObjectURL(e.J),t.resolve()})),e.J=Er(r),e.j.src=e.J,r}(this,this.C),this.J=""}F("shaka.text.TextEngine.registerParser",(function(e,t){mr[e]=t})),F("shaka.text.TextEngine.unregisterParser",(function(e){delete mr[e]})),yr.prototype.destroy=function(){return this.i=this.l=null,this.o.clear(),Promise.resolve()},yr.prototype.xc=function(e){try{return this.l.parseMedia(new Uint8Array(e),{periodStart:0,segmentStart:null,segmentEnd:0})[0].startTime}catch(t){throw new z(2,2,2009,t)}},yr.prototype.remove=function(e,t){return Promise.resolve().then(function(){!this.i||!this.i.remove(e,t)||null==this.g||t<=this.g||e>=this.h||(e<=this.g&&t>=this.h?this.g=this.h=null:e<=this.g&&t<this.h?this.g=t:e>this.g&&t>=this.h&&(this.h=e))}.bind(this))};var Er=t.URL.createObjectURL;function Tr(e){var t=ct(e.mimeType,e.codecs),r=function(e){var t=[e.mimeType];return ft.forEach((function(r,n){var i=e[n];i&&t.push(r+'="'+i+'"')})),t.join(";")}(e);return gr(t)||MediaSource.isTypeSupported(r)||we(t,e.type)}function Sr(e,t){e.g||(e.g=new yr(e.l)),vr(e.g,t)}function $r(e){return!e.m||"ended"==e.m.readyState}function Ar(e,t){if("text"==t)var r=e.g.g;else r=!(r=kr(e,t))||1==r.length&&1e-6>r.end(0)-r.start(0)?null:1==r.length&&0>r.start(0)?0:r.length?r.start(0):null;return r}function wr(e,t){return"text"==t?e.g.h:Kt(kr(e,t))}function kr(e,t){try{return e.h[t].buffered}catch(r){return t in e.h&&Y.error("failed to get buffered range for "+t,r),null}}function Ir(e,r,n,i,a,o){return"text"==r?function(e,t,r,n){return Promise.resolve().then(function(){if(this.l&&this.i)if(null==r||null==n)this.l.parseInit(new Uint8Array(t));else{var e={periodStart:this.A,segmentStart:r,segmentEnd:n};e=this.l.parseMedia(new Uint8Array(t),e).filter(function(e){return e.startTime>=this.j&&e.startTime<this.m}.bind(this)),this.i.append(e),null==this.g&&(this.g=Math.max(r,this.j)),this.h=Math.min(n,this.m)}}.bind(e))}(e.g,n,i,a):e.u[r]?function(e,t){e.j=!0,e.h=new me,e.l=[],e.i=[];var r=new Uint8Array(t);return e.g.push(r),e.g.flush(),e.j&&e.h.reject(new z(2,3,3018)),e.h}(e.u[r],n).then(function(e){return this.g||Sr(this,"text/vtt"),e.captions&&e.captions.length&&br(this.g,e.captions,i,a,this.h.video.timestampOffset),xr(this,r,this.Me.bind(this,r,e.data.buffer))}.bind(e)):(o&&t.muxjs&&(e.g||Sr(e,"text/vtt"),null==i&&null==a?e.A.init(n):e.A.h(n,(function(t){t.length&&br(e.g,t,i,a,e.h.video.timestampOffset)}))),xr(e,r,e.Me.bind(e,r,n)))}function Cr(e,t){var r=wr(e,"video")||0;!function(e,t,r){if(e.u=t,t=e.o.get(t))for(var n=f(t.keys()),i=n.next();!i.done;i=n.next())(i=t.get(i.value).filter((function(e){return e.endTime<=r})))&&e.i.append(i)}(e.g,t,r)}function Pr(e,t){return"text"==t?e.g?(e.A.i(),e.g.remove(0,1/0)):Promise.resolve():xr(e,t,e.Ne.bind(e,t,0,e.m.duration))}function xr(e,t,r){if(e.F)return Promise.reject();if(r={start:r,p:new me},e.i[t].push(r),1==e.i[t].length)try{r.start()}catch(n){"QuotaExceededError"==n.name?r.p.reject(new z(2,3,3017,t)):r.p.reject(new z(2,3,3015,n)),Or(e,t)}return r.p}function Rr(e,t){if(e.F)return Promise.reject();var r,n=[];for(r in e.h){var i=new me,a={start:function(e){e.resolve()}.bind(null,i),p:i};e.i[r].push(a),n.push(i),1==e.i[r].length&&a.start()}return Promise.all(n).then(function(){try{t()}catch(n){var e=Promise.reject(new z(2,3,3015,n))}for(var r in this.h)Or(this,r);return e}.bind(e),function(e){throw e}.bind(e))}function Or(e,t){e.i[t].shift();var r=e.i[t][0];if(r)try{r.start()}catch(n){r.p.reject(new z(2,3,3015,n)),Or(e,t)}}function Lr(e,t){return e=Mr(e),t=Mr(t),e.split("-")[0]==t.split("-")[0]}function Dr(e,t){e=Mr(e),t=Mr(t);var r=e.split("-"),n=t.split("-");return r[0]==n[0]&&1==r.length&&2==n.length}function Mr(e){var t=e.split("-");return e=t[0]||"",t=t[1]||"",e=e.toLowerCase(),e=Vr.get(e)||e,(t=t.toUpperCase())?e+"-"+t:e}function Nr(e){return e.language?Mr(e.language):e.audio&&e.audio.language?Mr(e.audio.language):e.video&&e.video.language?Mr(e.video.language):"und"}function Gr(e,t){for(var r=Mr(e),n=new Set,i=f(t),a=i.next();!a.done;a=i.next())n.add(Mr(a.value));for(a=(i=f(n)).next();!a.done;a=i.next())if((a=a.value)==r)return a;for(a=(i=f(n)).next();!a.done;a=i.next())if(Dr(a=a.value,r))return a;for(a=(i=f(n)).next();!a.done;a=i.next()){var o=a=a.value,s=r;if(o=Mr(o),s=Mr(s),o=o.split("-"),s=s.split("-"),2==o.length&&2==s.length&&o[0]==s[0])return a}for(a=(n=f(n)).next();!a.done;a=n.next())if(Dr(r,i=a.value))return i;return null}(i=_r.prototype).destroy=function(){var e=this;this.F=!0;var t,r=[];for(t in this.i){var n=this.i[t],i=n[0];for(this.i[t]=n.slice(0,1),i&&r.push(i.p.catch(de.Bc)),i=1;i<n.length;++i)n[i].p.reject()}for(var a in this.g&&r.push(this.g.destroy()),this.l&&r.push(this.l.destroy()),this.u)r.push(this.u[a].destroy());return Promise.all(r).then((function(){e.o&&(e.o.release(),e.o=null),e.j&&(e.j.removeAttribute("src"),e.j.load(),e.j=null),e.m=null,e.g=null,e.l=null,e.h={},e.u={},e.A=null,e.i={}}))},i.init=function(e,t){var r=this;return y((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return i=pe,A(n,r.C,2);case 2:e.forEach((function(e,n){var a=ct(e.mimeType,e.codecs);n==i.za?Sr(r,a):(!t&&MediaSource.isTypeSupported(a)||!we(a,n)||(r.u[n]=new Ae,a=ke(n,a)),a=r.m.addSourceBuffer(a),r.o.H(a,"error",r.Dg.bind(r,n)),r.o.H(a,"updateend",r.Lb.bind(r,n)),r.h[n]=a,r.i[n]=[])})),w(n)}}))}))},i.bd=function(e){if(e.total=Jt(this.j.buffered),e.audio=Jt(kr(this,"audio")),e.video=Jt(kr(this,"video")),e.text=[],this.g){var t=this.g.g,r=this.g.h;null!=t&&null!=r&&e.text.push({start:t,end:r})}},i.remove=function(e,t,r){return"text"==e?this.g.remove(t,r):xr(this,e,this.Ne.bind(this,e,t,r))},i.flush=function(e){return"text"==e?Promise.resolve():xr(this,e,this.lf.bind(this,e))},i.endOfStream=function(e){return Rr(this,function(){$r(this)||(e?this.m.endOfStream(e):this.m.endOfStream())}.bind(this))},i.Fa=function(e){return Rr(this,function(){this.m.duration=e}.bind(this))},i.ha=function(){return this.m.duration},i.Me=function(e,t){this.h[e].appendBuffer(t)},i.Ne=function(e,t,r){r<=t?this.Lb(e):this.h[e].remove(t,r)},i.Ve=function(e){var t=this.h[e].appendWindowStart,r=this.h[e].appendWindowEnd;this.h[e].abort(),this.h[e].appendWindowStart=t,this.h[e].appendWindowEnd=r,this.Lb(e)},i.lf=function(e){this.j.currentTime-=.001,this.Lb(e)},i.Cg=function(e,t){0>t&&(t+=.001),this.h[e].timestampOffset=t,this.Lb(e)},i.zg=function(e,t,r){this.h[e].appendWindowStart=0,this.h[e].appendWindowEnd=r,this.h[e].appendWindowStart=t,this.Lb(e)},i.Dg=function(e){this.i[e][0].p.reject(new z(2,3,3014,this.j.error?this.j.error.code:0))},i.Lb=function(e){var t=this.i[e][0];t&&(t.p.resolve(),Or(this,e))};var Vr=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),Ur={$d:function(e,t){var r=e.periods.reduce((function(e,t){return e.concat(t.variants)}),[]);r=Ur.ee(r,t),r=Ur.Lf(r),r=Ur.jf(r);for(var n=Ur.kf(r),i=(r=f(e.periods)).next();!i.done;i=r.next())(i=i.value).variants=i.variants.filter((function(e){return Ur.he(e)==n||(Y.debug("Dropping Variant (better codec available)",e),!1)}))},Lf:function(e){for(var t=new Ve,r=(e=f(e)).next();!r.done;r=e.next()){r=r.value;var n=Ur.he(r);t.push(n,r)}return t},jf:function(e){var t=0,r=new Map,n=e.size();return e.forEach((function(e,i){for(var a=f(i),o=a.next();!o.done;o=a.next()){var s=(o=o.value).video;if(s&&s.width&&s.height){s=s.width*s.height*(s.frameRate||1),r.has(s)||r.set(s,new Ve);var l=r.get(s);l.push(e,o),l.size()===n&&(t=Math.max(t,s))}}})),t?r.get(t):e},kf:function(e){var t="",r=1/0;return e.forEach((function(e,n){for(var i=0,a=0,o=f(n),s=o.next();!s.done;s=o.next())i+=s.value.bandwidth||0,++a;i/=a,Y.debug("codecs",e,"avg bandwidth",i),i<r&&(t=e,r=i)})),t},he:function(e){var t="";e.video&&(t=ht(e.video.codecs)[0]);var r="";return e.audio&&(r=ht(e.audio.codecs)[0]),t+"-"+r},rd:function(e,t,r){function n(e,t,r){return e>=t&&e<=r}var i=e.video;return!(i&&i.width&&i.height&&(!n(i.width,t.minWidth,Math.min(t.maxWidth,r.width))||!n(i.height,t.minHeight,Math.min(t.maxHeight,r.height))||!n(i.width*i.height,t.minPixels,t.maxPixels))||e&&e.video&&e.video.frameRate&&!n(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||!n(e.bandwidth,t.minBandwidth,t.maxBandwidth))},Xd:function(e,t,r){var n=!1;return e.forEach((function(e){var i=e.allowedByApplication;e.allowedByApplication=Ur.rd(e,t,r),i!=e.allowedByApplication&&(n=!0)})),n},filterNewPeriod:function(e,t,r,n){n.variants=n.variants.filter((function(n){if(e&&e.Z&&!Gt(e,n))return Y.debug("Dropping variant - not compatible with key system",n),!1;var i=n.audio;return n=n.video,i&&!Tr(i)?(Y.debug("Dropping variant - audio not compatible with platform",Ur.fb(i)),!1):n&&!Tr(n)||bt("Xbox One")&&n&&(n.width&&1920<n.width||n.height&&1080<n.height)&&n.codecs.includes("avc1.")?(Y.debug("Dropping variant - video not compatible with platform",Ur.fb(n)),!1):i&&t&&!Ur.Yd(i,t)?(Y.debug("Droping variant - not compatible with active audio","active audio",Ur.fb(t),"variant.audio",Ur.fb(i)),!1):!(n&&r&&!Ur.Yd(n,r)&&(Y.debug("Droping variant - not compatible with active video","active video",Ur.fb(r),"variant.video",Ur.fb(n)),1))})),n.textStreams=n.textStreams.filter((function(e){var t=gr(ct(e.mimeType,e.codecs));return t||Y.debug("Dropping text stream. Is not supported by the platform.",e),t}))},Yd:function(e,t){return e.mimeType==t.mimeType&&e.codecs.split(".")[0]==t.codecs.split(".")[0]},Oc:function(e){var t=e.audio,r=e.video,n=t?t.codecs:null,i=r?r.codecs:null,a=[];i&&a.push(i),n&&a.push(n);var o=[];r&&o.push(r.mimeType),t&&o.push(t.mimeType),o=o[0]||null;var s=[];t&&s.push(t.kind),r&&s.push(r.kind),s=s[0]||null;var l=new Set;return t&&t.roles.forEach((function(e){return l.add(e)})),r&&r.roles.forEach((function(e){return l.add(e)})),e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:s,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:o,codecs:a.join(", "),audioCodec:n,videoCodec:i,primary:e.primary,roles:Array.from(l),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},r&&(e.videoId=r.id,e.originalVideoId=r.originalId,e.width=r.width||null,e.height=r.height||null,e.frameRate=r.frameRate||null,e.pixelAspectRatio=r.pixelAspectRatio||null,e.videoBandwidth=r.bandwidth||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.label=t.label,e.audioRoles=t.roles),e},Kc:function(e){return{id:e.id,active:!1,type:"text",bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:e.mimeType,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId}},gd:function(e){return e.__shaka_id||(e.__shaka_id=Ur.Uf++),e.__shaka_id},Uf:0,Of:function(e){var t=Ur.ke(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="application/cea-608"),e.kind&&(t.roles=[e.kind]),t},je:function(e){var t=Ur.ke(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind]),t},ke:function(e){return{id:Ur.gd(e),active:!1,type:"",bandwidth:0,language:Mr(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}},Gb:function(e){return e.allowedByApplication&&e.allowedByKeySystem},Bf:function(e){return e.filter((function(e){return Ur.Gb(e)}))},ee:function(e,t){for(var r=e.filter((function(e){return e.audio&&e.audio.channelsCount})),n=new Map,i=(r=f(r)).next();!i.done;i=r.next()){var a=(i=i.value).audio.channelsCount;n.has(a)||n.set(a,[]),n.get(a).push(i)}return 0==(r=Array.from(n.keys())).length?e:(i=r.filter((function(e){return e<=t}))).length?n.get(Math.max.apply(null,i)):n.get(Math.min.apply(null,r))},Wb:function(e,t,r){var n=e,i=e.filter((function(e){return e.primary}));i.length&&(n=i);var a=n.length?n[0].language:"";if(n=n.filter((function(e){return e.language==a})),t){var o=Gr(Mr(t),e.map((function(e){return e.language})));o&&(n=e.filter((function(e){return Mr(e.language)==o})))}if(r){if((e=Ur.de(n,r)).length)return e;Y.v("No exact match for the text role could be found.")}else if((e=n.filter((function(e){return 0==e.roles.length}))).length)return e;return(e=n.map((function(e){return e.roles})).reduce(de.Rc,[])).length?Ur.de(n,e[0]):n},de:function(e,t){return e.filter((function(e){return e.roles.includes(t)}))},ie:function(e,t,r){for(var n=0;n<r.length;n++)if(r[n].audio==e&&r[n].video==t)return r[n];return null},Pf:function(e){return"audio"==e.type},Sf:function(e){return"video"==e.type},Kf:function(e){var t=[];return e.audio&&t.push(e.audio),e.video&&t.push(e.video),t},fb:function(e){return Ur.Pf(e)?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:Ur.Sf(e)?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}};function Zr(){this.m=null,this.i=!1,this.h=new K,this.l=[],this.o=!1,this.g=this.j=null}function Br(e,t){return e&&(t=t.filter((function(t){return Ur.rd(t,e,{width:1/0,height:1/0})}))),t.sort((function(e,t){return e.bandwidth-t.bandwidth}))}function Fr(e,t){this.g=e,this.h=t}function jr(e,t){var r=new Fr(2,6),n=Hr,i=n.g,a=r.h-i.h;(0<(r.g-i.g||a)?n.i:n.h)(n.g,r,e,t)}function Wr(e,t,r,n){Y.ba([r,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",n].join(" "))}function Xr(e,t,r,n){Y.kc([r,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",n].join(""))}F("shaka.abr.SimpleAbrManager",Zr),Zr.prototype.stop=function(){this.m=null,this.i=!1,this.l=[],this.j=null},Zr.prototype.stop=Zr.prototype.stop,Zr.prototype.init=function(e){this.m=e},Zr.prototype.init=Zr.prototype.init,Zr.prototype.chooseVariant=function(){var e=Br(this.g.restrictions,this.l),t=this.h.getBandwidthEstimate(this.g.defaultBandwidthEstimate);this.l.length&&!e.length&&(Y.v("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),e=[(e=Br(null,this.l))[0]]);for(var r=e[0]||null,n=0;n<e.length;++n){var i=e[n],a=i.bandwidth/this.g.bandwidthDowngradeTarget,o=(e[n+1]||{bandwidth:1/0}).bandwidth/this.g.bandwidthUpgradeTarget;Y.O("Bandwidth ranges:",(i.bandwidth/1e6).toFixed(3),(a/1e6).toFixed(3),(o/1e6).toFixed(3)),t>=a&&t<=o&&(r=i)}return this.j=Date.now(),r},Zr.prototype.chooseVariant=Zr.prototype.chooseVariant,Zr.prototype.enable=function(){this.i=!0},Zr.prototype.enable=Zr.prototype.enable,Zr.prototype.disable=function(){this.i=!1},Zr.prototype.disable=Zr.prototype.disable,Zr.prototype.segmentDownloaded=function(e,t){Y.O("Segment downloaded:","deltaTimeMs="+e,"numBytes="+t,"lastTimeChosenMs="+this.j,"enabled="+this.i);var r=this.h;if(!(16e3>t)){var n=8e3*t/e,i=e/1e3;r.g+=t,X(r.h,i,n),X(r.i,i,n)}if(null!=this.j&&this.i)e:{if(Y.O("Suggesting Streams..."),this.o){if(Date.now()-this.j<1e3*this.g.switchInterval){Y.O("Still within switch interval...");break e}}else{if(!(128e3<=this.h.g)){Y.O("Still waiting for a good estimate...");break e}this.o=!0}r=this.chooseVariant(),n=this.h.getBandwidthEstimate(this.g.defaultBandwidthEstimate),Y.debug("Calling switch_(), bandwidth="+Math.round(n/1e3)+" kbps"),this.m(r)}},Zr.prototype.segmentDownloaded=Zr.prototype.segmentDownloaded,Zr.prototype.getBandwidthEstimate=function(){return this.h.getBandwidthEstimate(this.g.defaultBandwidthEstimate)},Zr.prototype.getBandwidthEstimate=Zr.prototype.getBandwidthEstimate,Zr.prototype.setVariants=function(e){this.l=e},Zr.prototype.setVariants=Zr.prototype.setVariants,Zr.prototype.configure=function(e){this.g=e},Zr.prototype.configure=Zr.prototype.configure,Fr.prototype.toString=function(){return"v"+this.g+"."+this.h};var Hr=null,Kr="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),Yr="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),zr=["loop","playbackRate"],Jr=["pause","play"],Qr="abrstatuschanged adaptation buffering drmsessionupdate emsg error expirationupdated largegap loading manifestparsed onstatechange onstateidle streaming textchanged texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged".split(" "),qr={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10},en={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},tn=[["getConfiguration","configure"]],rn=[["isTextTrackVisible","setTextTrackVisibility"]],nn="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay".split(" "),an=["attach","detach","load","unload"];function on(e){return JSON.stringify(e,(function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof Ge){var r={};for(i in t){var n=t[i];n&&"object"==_typeof$b(n)?"detail"==i&&(r[i]=n):i in Event||(r[i]=n)}return r}if(t instanceof Error){var i=new Set(["name","message","stack"]);for(r in t)i.add(r);for(r=(n=f(Object.getOwnPropertyNames(t))).next();!r.done;r=n.next())i.add(r.value);for(n={},r=(i=f(i)).next();!r.done;r=i.next())n[r=r.value]=t[r];i={__type__:"Error",contents:n}}else if(t instanceof TimeRanges)for(i={__type__:"TimeRanges",length:t.length,start:[],end:[]},r=0;r<t.length;++r)i.start.push(t.start(r)),i.end.push(t.end(r));else i=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t;return i}}))}function sn(e){return JSON.parse(e,(function(e,t){if("NaN"==t)var r=NaN;else if("-Infinity"==t)r=-1/0;else if("Infinity"==t)r=1/0;else if(t&&"object"==_typeof$b(t)&&"TimeRanges"==t.__type__)r=function(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}}(t);else if(t&&"object"==_typeof$b(t)&&"Uint8Array"==t.__type__)r=new Uint8Array(t.entries);else if(t&&"object"==_typeof$b(t)&&"Error"==t.__type__){r=t.contents;var n,i=Error(r.message);for(n in r)i[n]=r[n];r=i}else r=t;return r}))}function ln(e,t,r,n,i,a){this.X=e,this.j=new Ce(t),this.Z=r,this.u=!1,this.F=n,this.P=i,this.L=a,this.h=this.m=!1,this.M="",this.o=null,this.A=this.yd.bind(this),this.C=this.ag.bind(this),this.g={video:{},player:{}},this.J=0,this.i={},this.l=null,gn.add(this)}var un=!1,cn=null;function dn(e){for(var t=f(gn),r=t.next();!r.done;r=t.next())hn(r.value,e)}function hn(e,t){Y.debug("CastSender: onExistingSessionJoined");var r=e.L();e.l=new me,e.u=!0,e.Ad(r,t)}function fn(e){for(var t=f(gn),r=t.next();!r.done;r=t.next()){r=r.value;var n=e;Y.debug("CastSender: receiver status",n),un="available"==n,r.j.Lc()}}function pn(e){var t=cn;t.removeUpdateListener(e.A),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.C)}function yn(e){for(var t in e.i){var r=e.i[t];delete e.i[t],r.reject(new z(1,7,7e3))}}function mn(t,r){var n=on(r),i=cn;try{i.sendMessage("urn:x-cast:com.google.shaka.v2",n,(function(){}),Y.error)}catch(e){throw Y.error("Cast session sendMessage threw",e),n=new z(2,8,8005,e),t.F("player",new Ge("error",{detail:n})),t.Bb(),n}}(i=ln.prototype).destroy=function(){return gn.delete(this),yn(this),cn&&pn(this),this.j&&(this.j.stop(),this.j=null),this.P=this.F=null,this.h=this.m=!1,this.C=this.A=this.l=this.i=this.g=this.o=null,Promise.resolve()},i.la=function(){return this.h},i.Dd=function(){return this.M},i.init=function(){if(this.X.length)if(t.chrome&&chrome.cast&&chrome.cast.isAvailable){this.m=!0,this.j.Lc();var e=new chrome.cast.SessionRequest(this.X);e=new chrome.cast.ApiConfig(e,dn.bind(this),fn.bind(this),"origin_scoped"),chrome.cast.initialize(e,(function(){Y.debug("CastSender: init")}),(function(e){Y.error("CastSender: init error",e)})),un&&this.j.V(.02),(e=cn)&&e.status!=chrome.cast.SessionStatus.STOPPED?(Y.debug("CastSender: re-using existing connection"),hn(this,e)):cn=null}else t.__onGCastApiAvailable||(t.__onGCastApiAvailable=vn),t.__onGCastApiAvailable!=vn&&Y.ba("A global Cast SDK hook is already installed! Shaka Player will be unable to receive a notification when the Cast SDK is ready.")},i.Md=function(e){this.o=e,this.h&&mn(this,{type:"appData",appData:this.o})},i.cast=function(e){return this.m?un?this.h?Promise.reject(new z(1,8,8002)):(this.l=new me,chrome.cast.requestSession(this.Ad.bind(this,e),this.ve.bind(this)),this.l):Promise.reject(new z(1,8,8001)):Promise.reject(new z(1,8,8e3))},i.Bb=function(){if(this.h){if(yn(this),cn){pn(this);try{cn.stop((function(){}),(function(){}))}catch(l){}cn=null}this.yd()}},i.get=function(e,t){if("video"==e){if(Jr.includes(t))return this.Ee.bind(this,e,t)}else if("player"==e){if(en[t]&&!this.get("player","isLive")())return function(){};if(nn.includes(t))return this.Ee.bind(this,e,t);if(an.includes(t))return this.rg.bind(this,e,t);if(qr[t])return this.Be.bind(this,e,t)}return this.Be(e,t)},i.set=function(e,t,r){this.g[e][t]=r,mn(this,{type:"set",targetName:e,property:t,value:r})},i.Ad=function(e,t){Y.debug("CastSender: onSessionInitiated"),cn=t,t.addUpdateListener(this.A),t.addMessageListener("urn:x-cast:com.google.shaka.v2",this.C),this.yd(),mn(this,{type:"init",initState:e,appData:this.o}),this.l.resolve()},i.ve=function(e){var t=8003;switch(e.code){case"cancel":t=8004;break;case"timeout":t=8005;break;case"receiver_unavailable":t=8006}this.l.reject(new z(2,8,t,e))},i.Be=function(e,t){return this.g[e][t]},i.Ee=function(e,t,r){for(var n=[],i=2;i<arguments.length;++i)n[i-2]=arguments[i];mn(this,{type:"call",targetName:e,methodName:t,args:n})},i.rg=function(e,t,r){for(var n=[],i=2;i<arguments.length;++i)n[i-2]=arguments[i];i=new me;var a=this.J.toString();this.J++,this.i[a]=i;try{mn(this,{type:"asyncCall",targetName:e,methodName:t,args:n,id:a})}catch(o){i.reject(o)}return i},i.yd=function(){var e=!!cn&&"connected"==cn.status;if(Y.debug("CastSender: connection status",e),this.h&&!e){for(var t in this.P(),this.g)this.g[t]={};yn(this)}this.M=(this.h=e)?cn.receiver.friendlyName:"",this.j.Lc()},i.ag=function(e,t){var r=sn(t);switch(Y.O("CastSender: message",r),r.type){case"event":var n=r.event;this.F(r.targetName,new Ge(n.type,n));break;case"update":for(var i in n=r.update)for(var a in r=this.g[i]||{},n[i])r[a]=n[i][a];this.u&&(this.Z(),this.u=!1);break;case"asyncComplete":if(i=r.id,r=r.error,a=this.i[i],delete this.i[i],a)if(r){for(n in i=new z(r.severity,r.category,r.code),r)i[n]=r[n];a.reject(i)}else a.resolve()}};var gn=new Set;function vn(e){if(e)for(var t=(e=f(gn)).next();!t.done;t=e.next())t.value.init()}function bn(e,t,r){var n=this;Ue.call(this),this.i=e,this.h=t,this.o=this.l=this.j=this.u=this.m=null,this.C=r,this.A=new Map,this.g=new ln(r,(function(){return Tn(n)}),(function(){return Sn(n)}),(function(e,t){return wn(n,e,t)}),(function(){return $n(n)}),(function(){return En(n)})),function(e){for(var t in e.g.init(),e.o=new tt,Kr.forEach(function(e){this.o.H(this.i,e,this.L.bind(this))}.bind(e)),Qr.forEach(function(e){this.o.H(this.h,e,this.F.bind(this))}.bind(e)),e.m={},e.i)Object.defineProperty(e.m,t,{configurable:!1,enumerable:!0,get:e.J.bind(e,t),set:e.M.bind(e,t)});e.u={},_n(e,(function(t){Object.defineProperty(e.u,t,{configurable:!1,enumerable:!0,get:function(){return An(e,t)}})})),function(e){var t=new Map;_n(e,(function(r,n){if(t.has(n)){var i=t.get(n);r.length<i.length?e.A.set(r,i):e.A.set(i,r)}else t.set(n,r)}))}(e),e.j=new Ue,e.j.jc=e.m,e.l=new Ue,e.l.jc=e.u}(this)}function _n(e,t){function r(e){return"constructor"!=e&&"function"==typeof n[e]&&!i.has(e)}var n=e.h,i=new Set;for(a in n)r(a)&&(i.add(a),t(a,n[a]));for(var a=Object.getPrototypeOf(n),o=Object.getPrototypeOf({});a&&a!=o;){for(var s=f(Object.getOwnPropertyNames(a)),l=s.next();!l.done;l=s.next())r(l=l.value)&&(i.add(l),t(l,n[l]));a=Object.getPrototypeOf(a)}}function En(e){var t={video:{},player:{},playerAfterLoad:{},manifest:e.h.tc(),startTime:null};return e.i.pause(),zr.forEach(function(e){t.video[e]=this.i[e]}.bind(e)),e.i.ended||(t.startTime=e.i.currentTime),tn.forEach(function(e){var r=e[1];e=this.h[e[0]](),t.player[r]=e}.bind(e)),rn.forEach(function(e){var r=e[1];e=this.h[e[0]](),t.playerAfterLoad[r]=e}.bind(e)),t}function Tn(e){e.dispatchEvent(new Ge("caststatuschanged"))}function Sn(e){e.j.dispatchEvent(new Ge(e.m.paused?"pause":"play"))}function $n(e){tn.forEach(function(e){var t=e[1];e=this.g.get("player",e[0])(),this.h[t](e)}.bind(e));var t=e.g.get("player","getAssetUri")(),r=e.g.get("video","ended"),n=Promise.resolve(),i=e.i.autoplay,a=null;r||(a=e.g.get("video","currentTime")),t&&(e.i.autoplay=!1,n=e.h.load(t,a));var o={};zr.forEach(function(e){o[e]=this.g.get("video",e)}.bind(e)),n.then((function(){e.i&&(zr.forEach(function(e){this.i[e]=o[e]}.bind(e)),rn.forEach(function(e){var t=e[1];e=this.g.get("player",e[0])(),this.h[t](e)}.bind(e)),e.i.autoplay=i,t&&e.i.play())}),(function(t){e.h.dispatchEvent(new Ge("error",{detail:t}))}))}function An(e,t){if(e.A.has(t)&&(t=e.A.get(t)),"addEventListener"==t)return e.l.addEventListener.bind(e.l);if("removeEventListener"==t)return e.l.removeEventListener.bind(e.l);if("getMediaElement"==t)return function(){return this.m}.bind(e);if("getSharedConfiguration"==t)return Y.v("Can't share configuration across a network. Returning copy."),e.g.get("player","getConfiguration");if("getNetworkingEngine"==t)return e.g.la()&&Y.v("NOTE: getNetworkingEngine() is always local!"),e.h.Yb.bind(e.h);if(e.g.la()){if("getManifest"==t||"drmInfo"==t)return function(){return Y.ba(t+"() does not work while casting!"),null};if("getManifestUri"==t)return jr("getManifestUri",'Please use "getAssetUri" instead.'),An(e,"getAssetUri");if("attach"==t||"detach"==t)return function(){return Y.ba(t+"() does not work while casting!"),Promise.resolve()}}return e.g.la()&&0==Object.keys(e.g.g.video).length&&qr[t]||!e.g.la()?e.h[t].bind(e.h):e.g.get("player",t)}function wn(e,t,r){e.g.la()&&("video"==t?e.j.dispatchEvent(r):"player"==t&&e.l.dispatchEvent(r))}function kn(e,t,r,n){var i=this;Ue.call(this),this.g=e,this.h=t,this.i=new tt,this.L={video:e,player:t},this.C=r||function(){},this.M=n||function(e){return e},this.F=!1,this.m=!0,this.l=0,this.A=!1,this.u=!0,this.o=this.j=null,this.J=new Ce((function(){Cn(i)})),function(e){var t=cast.receiver.CastReceiverManager.getInstance();t.onSenderConnected=e.xe.bind(e),t.onSenderDisconnected=e.xe.bind(e),t.onSystemVolumeChanged=e.hf.bind(e),e.o=t.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.o.onMessage=e.Wf.bind(e),e.j=t.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.j.onMessage=e.fg.bind(e),t.start(),Kr.forEach(function(e){this.i.H(this.g,e,this.Ce.bind(this,"video"))}.bind(e)),Qr.forEach(function(e){this.i.H(this.h,e,this.Ce.bind(this,"player"))}.bind(e)),cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?e.h.Nd(3840,2160):e.h.Nd(1920,1080),e.i.H(e.g,"loadeddata",function(){this.A=!0}.bind(e)),e.i.H(e.h,"loading",function(){this.m=!1,In(this)}.bind(e)),e.i.H(e.g,"playing",function(){this.m=!1,In(this)}.bind(e)),e.i.H(e.g,"pause",function(){In(this)}.bind(e)),e.i.H(e.h,"unloading",function(){this.m=!0,In(this)}.bind(e)),e.i.H(e.g,"ended",function(){var e=this;new Ce((function(){e.g&&e.g.ended&&(e.m=!0,In(e))})).V(5)}.bind(e))}(this)}function In(e){Promise.resolve().then(function(){this.h&&(this.dispatchEvent(new Ge("caststatuschanged")),Pn(this)||On(this))}.bind(e))}function Cn(e){e.J.V(.5);var t={video:{},player:{}};if(Yr.forEach(function(e){t.video[e]=this.g[e]}.bind(e)),e.h.aa())for(var r in en)0==e.l%en[r]&&(t.player[r]=e.h[r]());for(var n in qr)0==e.l%qr[n]&&(t.player[n]=e.h[n]());(r=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=r.level,t.video.muted=r.muted),e.A&&(e.l+=1),Rn(e,{type:"update",update:t},e.j),Pn(e)}function Pn(e){return!(!e.u||!e.g.duration&&!e.h.aa()||(xn(e),e.u=!1,0))}function xn(e,t){t=void 0===t?0:t;var r={contentId:e.h.tc(),streamType:e.h.aa()?"LIVE":"BUFFERED",contentType:""};e.h.aa()||(r.duration=e.g.duration),On(e,t,r)}function Rn(e,t,r,n){e.F&&(e=on(t),n?r.getCastChannel(n).send(e):r.broadcast(e))}function On(e,t,r){t=void 0===t?0:t,r=void 0===r?null:r;var n=e.g.playbackRate,i=Ln;n={mediaSessionId:0,playbackRate:n,playerState:i=e.m?i.IDLE:e.h.jd()?i.Re:e.g.paused?i.Te:i.Ue,currentTime:e.g.currentTime,supportedMediaCommands:63,volume:{level:e.g.volume,muted:e.g.muted}},r&&(n.media=r),Rn(e,{requestId:t,type:"MEDIA_STATUS",status:[n]},e.o)}j(bn,Ue),F("shaka.cast.CastProxy",bn),bn.prototype.destroy=function(e){return e&&this.g.Bb(),this.o&&(this.o.release(),this.o=null),e=[],this.h&&(e.push(this.h.destroy()),this.h=null),this.g&&(e.push(this.g.destroy()),this.g=null),this.u=this.m=this.i=null,Promise.all(e)},bn.prototype.destroy=bn.prototype.destroy,bn.prototype.Mf=function(){return this.m},bn.prototype.getVideo=bn.prototype.Mf,bn.prototype.Df=function(){return this.u},bn.prototype.getPlayer=bn.prototype.Df,bn.prototype.Ye=function(){return this.g.m&&un},bn.prototype.canCast=bn.prototype.Ye,bn.prototype.la=function(){return this.g.la()},bn.prototype.isCasting=bn.prototype.la,bn.prototype.Dd=function(){return this.g.Dd()},bn.prototype.receiverName=bn.prototype.Dd,bn.prototype.cast=function(){var e=En(this);return this.g.cast(e).then(function(){if(this.h)return this.h.Ud()}.bind(this))},bn.prototype.cast=bn.prototype.cast,bn.prototype.Md=function(e){this.g.Md(e)},bn.prototype.setAppData=bn.prototype.Md,bn.prototype.Kg=function(){var e=this.g;if(e.h){var t=e.L();chrome.cast.requestSession(e.Ad.bind(e,t),e.ve.bind(e))}},bn.prototype.suggestDisconnect=bn.prototype.Kg,bn.prototype.af=function(e){var t=this;return y((function r(){return N(r,(function(r){switch(r.s){case 1:return e==t.C?r.return():(t.C=e,t.g.Bb(),A(r,t.g.destroy(),2));case 2:t.g=null,t.g=new ln(e,(function(){return Tn(t)}),(function(){return Sn(t)}),(function(e,r){return wn(t,e,r)}),(function(){return $n(t)}),(function(){return En(t)})),t.g.init(),w(r)}}))}))},bn.prototype.changeReceiverId=bn.prototype.af,bn.prototype.Bb=function(){this.g.Bb()},bn.prototype.forceDisconnect=bn.prototype.Bb,bn.prototype.J=function(e){if("addEventListener"==e)return this.j.addEventListener.bind(this.j);if("removeEventListener"==e)return this.j.removeEventListener.bind(this.j);if(this.g.la()&&0==Object.keys(this.g.g.video).length){var t=this.i[e];if("function"!=typeof t)return t}return this.g.la()?this.g.get("video",e):("function"==typeof(e=this.i[e])&&(e=e.bind(this.i)),e)},bn.prototype.M=function(e,t){this.g.la()?this.g.set("video",e,t):this.i[e]=t},bn.prototype.L=function(e){this.g.la()||this.j.dispatchEvent(new Ge(e.type,e))},bn.prototype.F=function(e){this.g.la()||this.l.dispatchEvent(e)},j(kn,Ue),F("shaka.cast.CastReceiver",kn),kn.prototype.isConnected=function(){return this.F},kn.prototype.isConnected=kn.prototype.isConnected,kn.prototype.Rf=function(){return this.m},kn.prototype.isIdle=kn.prototype.Rf,kn.prototype.destroy=function(){var e=this;return y((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return e.i&&(e.i.release(),e.i=null),r=[],e.h&&(r.push(e.h.destroy()),e.h=null),e.J&&(e.J.stop(),e.J=null),e.g=null,e.L=null,e.C=null,e.F=!1,e.m=!0,e.j=null,e.o=null,A(t,Promise.all(r),2);case 2:cast.receiver.CastReceiverManager.getInstance().stop(),w(t)}}))}))},kn.prototype.destroy=kn.prototype.destroy,(i=kn.prototype).xe=function(){this.l=0,this.u=!0,this.F=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,In(this)},i.Ce=function(e,t){this.h&&(Cn(this),Rn(this,{type:"event",targetName:e,event:t},this.j))},i.hf=function(){var e=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();e&&Rn(this,{type:"update",update:{video:{volume:e.level,muted:e.muted}}},this.j),Rn(this,{type:"event",targetName:"video",event:{type:"volumechange"}},this.j)},i.fg=function(e){var t=sn(e.data);switch(Y.debug("CastReceiver: message",t),t.type){case"init":this.l=0,this.A=!1,this.u=!0,function(e,t,r){for(var n in t.player)e.h[n](t.player[n]);e.C(r),r=Promise.resolve();var i=e.g.autoplay;t.manifest&&(e.g.autoplay=!1,r=e.h.load(t.manifest,t.startTime)),r.then((function(){if(e.h){for(var r in t.video)e.g[r]=t.video[r];for(var n in t.playerAfterLoad)e.h[n](t.playerAfterLoad[n]);e.g.autoplay=i,t.manifest&&(e.g.play(),On(e))}}),(function(t){e.h.dispatchEvent(new Ge("error",{detail:t}))}))}(this,t.initState,t.appData),Cn(this);break;case"appData":this.C(t.appData);break;case"set":var r=t.targetName,n=t.property;if(t=t.value,"video"==r){var i=cast.receiver.CastReceiverManager.getInstance();if("volume"==n){i.setSystemVolumeLevel(t);break}if("muted"==n){i.setSystemVolumeMuted(t);break}}this.L[r][n]=t;break;case"call":(r=this.L[t.targetName])[t.methodName].apply(r,t.args);break;case"asyncCall":r=t.targetName,n=t.methodName,"player"==r&&"load"==n&&(this.l=0,this.A=!1),i=t.id,e=e.senderId;var a=this.L[r];t=a[n].apply(a,t.args),"player"==r&&"load"==n&&(t=t.then(function(){this.u=!0}.bind(this))),t.then(this.Je.bind(this,e,i,null),this.Je.bind(this,e,i))}},i.Wf=function(e){var t=sn(e.data);switch(Y.debug("CastReceiver: message",t),t.type){case"PLAY":this.g.play(),On(this);break;case"PAUSE":this.g.pause(),On(this);break;case"SEEK":e=t.currentTime;var r=t.resumeState;null!=e&&(this.g.currentTime=Number(e)),r&&"PLAYBACK_START"==r?(this.g.play(),On(this)):r&&"PLAYBACK_PAUSE"==r&&(this.g.pause(),On(this));break;case"STOP":this.h.Ud().then(function(){this.h&&On(this)}.bind(this));break;case"GET_STATUS":xn(this,Number(t.requestId));break;case"VOLUME":e=(r=t.volume).level,r=r.muted;var n=this.g.volume,i=this.g.muted;null!=e&&(this.g.volume=Number(e)),null!=r&&(this.g.muted=r),n==this.g.volume&&i==this.g.muted||On(this);break;case"LOAD":this.l=0,this.u=this.A=!1,e=t.media,r=t.currentTime,n=this.M(e.contentId),i=t.autoplay||!0,this.C(e.customData),i&&(this.g.autoplay=!0),this.h.load(n,r).then(function(){this.h&&xn(this)}.bind(this)).catch(function(e){var r="LOAD_FAILED";7==e.category&&7e3==e.code&&(r="LOAD_CANCELLED"),Rn(this,{requestId:Number(t.requestId),type:r},this.o)}.bind(this));break;default:Y.v("Unrecognized message type from the generic Chromecast controller!",t.type),Rn(this,{requestId:Number(t.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.o)}},i.Je=function(e,t,r){this.h&&Rn(this,{type:"asyncComplete",id:t,error:r},this.j,e)};var Ln={IDLE:"IDLE",Ue:"PLAYING",Re:"BUFFERING",Te:"PAUSED"};function Dn(e,t){this.S=e,this.h=t==Mn,this.g=0}F("shaka.util.DataViewReader",Dn);var Mn=1;function Nn(){throw new z(2,3,3e3)}function Gn(){this.i=[],this.h=[],this.g=!1}function Vn(e){for(var t=jn(e);e.reader.Ca()&&!e.parser.g;)e.parser.Fc(e.start+t,e.reader,e.partialOkay)}function Un(e){for(var t=jn(e),r=e.reader.N();0<r&&!e.parser.g;--r)e.parser.Fc(e.start+t,e.reader,e.partialOkay)}function Zn(e){return function(t){e(t.reader.mb(t.reader.S.byteLength-t.reader.ka()))}}function Bn(e){for(var t=0,r=0;r<e.length;r++)t=t<<8|e.charCodeAt(r);return t}function Fn(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function jn(e){return 8+(e.has64BitSize?8:0)+(null!=e.flags?4:0)}function Wn(e){var t=this;this.g=[],this.h=[],this.data=[],(new Gn).box("moov",Vn).ma("pssh",(function(e){if(1<e.version)Y.v("Unrecognized PSSH version found!");else{var r=e.reader.S;if(r=new Uint8Array(r.buffer,r.byteOffset-12,e.size),t.data.push(r),t.g.push($e.Nc(e.reader.mb(16))),0<e.version){r=e.reader.N();for(var n=0;n<r;++n){var i=$e.Nc(e.reader.mb(16));t.h.push(i)}}}})).parse(e),0==this.data.length&&Y.v("No pssh box found!")}Dn.Endianness={Tg:0,Vg:Mn},Dn.prototype.Ca=function(){return this.g<this.S.byteLength},Dn.prototype.hasMoreData=Dn.prototype.Ca,Dn.prototype.ka=function(){return this.g},Dn.prototype.getPosition=Dn.prototype.ka,Dn.prototype.sf=function(){return this.S.byteLength},Dn.prototype.getLength=Dn.prototype.sf,Dn.prototype.ra=function(){try{var e=this.S.getUint8(this.g);return this.g+=1,e}catch(t){Nn()}},Dn.prototype.readUint8=Dn.prototype.ra,Dn.prototype.dc=function(){try{var e=this.S.getUint16(this.g,this.h);return this.g+=2,e}catch(t){Nn()}},Dn.prototype.readUint16=Dn.prototype.dc,Dn.prototype.N=function(){try{var e=this.S.getUint32(this.g,this.h);return this.g+=4,e}catch(t){Nn()}},Dn.prototype.readUint32=Dn.prototype.N,Dn.prototype.De=function(){try{var e=this.S.getInt32(this.g,this.h);return this.g+=4,e}catch(t){Nn()}},Dn.prototype.readInt32=Dn.prototype.De,Dn.prototype.Pb=function(){try{if(this.h)var e=this.S.getUint32(this.g,!0),t=this.S.getUint32(this.g+4,!0);else t=this.S.getUint32(this.g,!1),e=this.S.getUint32(this.g+4,!1)}catch(r){Nn()}if(2097151<t)throw new z(2,3,3001);return this.g+=8,t*Math.pow(2,32)+e},Dn.prototype.readUint64=Dn.prototype.Pb,Dn.prototype.mb=function(e){this.g+e>this.S.byteLength&&Nn();var t=new Uint8Array(this.S.buffer,this.S.byteOffset+this.g,e);return this.g+=e,t},Dn.prototype.readBytes=Dn.prototype.mb,Dn.prototype.U=function(e){this.g+e>this.S.byteLength&&Nn(),this.g+=e},Dn.prototype.skip=Dn.prototype.U,Dn.prototype.Fe=function(e){this.g<e&&Nn(),this.g-=e},Dn.prototype.rewind=Dn.prototype.Fe,Dn.prototype.seek=function(e){(0>e||e>this.S.byteLength)&&Nn(),this.g=e},Dn.prototype.seek=Dn.prototype.seek,Dn.prototype.Cd=function(){for(var e=this.g;this.Ca()&&0!=this.S.getUint8(this.g);)this.g+=1;return e=new Uint8Array(this.S.buffer,this.S.byteOffset+e,this.g-e),this.g+=1,ge(e)},Dn.prototype.readTerminatedString=Dn.prototype.Cd,F("shaka.util.Mp4Parser",Gn),Gn.prototype.box=function(e,t){var r=Bn(e);return this.i[r]=0,this.h[r]=t,this},Gn.prototype.box=Gn.prototype.box,Gn.prototype.ma=function(e,t){var r=Bn(e);return this.i[r]=1,this.h[r]=t,this},Gn.prototype.fullBox=Gn.prototype.ma,Gn.prototype.stop=function(){this.g=!0},Gn.prototype.stop=Gn.prototype.stop,Gn.prototype.parse=function(e,t){var r=new Uint8Array(e);for(r=new Dn(new DataView(r.buffer,r.byteOffset,r.byteLength),0),this.g=!1;r.Ca()&&!this.g;)this.Fc(0,r,t)},Gn.prototype.parse=Gn.prototype.parse,Gn.prototype.Fc=function(e,t,r){var n=t.ka(),i=t.N(),a=t.N(),o=!1;switch(Y.O("Parsing MP4 box",Fn(a)),i){case 0:i=t.S.byteLength-n;break;case 1:i=t.Pb(),o=!0}var s=this.h[a];if(s){var l=null,u=null;1==this.i[a]&&(l=(u=t.N())>>>24,u&=16777215),a=n+i,r&&a>t.S.byteLength&&(a=t.S.byteLength),a-=t.ka(),t=0<a?t.mb(a):new Uint8Array(0),s({parser:this,partialOkay:r||!1,version:l,flags:u,reader:t=new Dn(new DataView(t.buffer,t.byteOffset,t.byteLength),0),size:i,start:n+e,has64BitSize:o})}else t.U(Math.min(n+i-t.ka(),t.S.byteLength-t.ka()))},Gn.prototype.parseNext=Gn.prototype.Fc,Gn.children=Vn,Gn.sampleDescription=Un,Gn.allData=Zn,Gn.typeToString=Fn,Gn.headerSize=jn;var Xn={sc:function(e,t){var r=Xn.Y(e,t);return 1!=r.length?null:r[0]},Yc:function(e,t,r){return 1!=(e=Xn.fe(e,t,r)).length?null:e[0]},Y:function(e,t){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.tagName==t}))},fe:function(e,t,r){return Array.prototype.filter.call(e.childNodes,(function(e){return e instanceof Element&&e.localName==r&&e.namespaceURI==t}))},getAttributeNS:function(e,t,r){return e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null},uc:function(e){return Array.prototype.every.call(e.childNodes,(function(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE}))?e.textContent.trim():null},R:function(e,t,r,n){n=void 0===n?null:n;var i=null;return null!=(e=e.getAttribute(t))&&(i=r(e)),null==i?n:i},jg:function(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:Math.floor(e/1e3)):null},Ma:function(e){if(!e)return null;var t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e);return t?(e=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(e)?e:null):(Y.v("Invalid duration string:",e),null)},Hc:function(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null},parseInt:function(e){return 0==(e=Number(e))%1?e:null},Gc:function(e){return 0==(e=Number(e))%1&&0<e?e:null},Mb:function(e){return 0==(e=Number(e))%1&&0<=e?e:null},parseFloat:function(e){return e=Number(e),isNaN(e)?null:e},ff:function(e){var t;return e=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e),isNaN(e)?null:e},Ae:function(e,t){var r=new DOMParser;try{var n=r.parseFromString(e,"text/xml")}catch(a){}if(n&&n.documentElement.tagName==t)var i=n.documentElement;return i&&0<i.getElementsByTagName("parsererror").length?null:i},ze:function(e,t){try{var r=ge(e);return Xn.Ae(r,t)}catch(n){}}},Hn=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime");function Kn(e,t,r){var n=function(e){for(var t=[],r=(e=f(e)).next();!r.done;r=e.next())(r=Jn(r.value))&&t.push(r);return t}(e),i=null;e=[];var a=[],o=new Set(n.map((function(e){return e.keyId})));if(o.delete(null),1<o.size)throw new z(2,4,4010);if(r||(a=n.filter((function(e){return"urn:mpeg:dash:mp4protection:2011"!=e.Ge||(i=e.init||i,!1)}))).length&&(e=function(e,t,r){for(var n=[],i=(r=f(r)).next();!i.done;i=r.next()){i=i.value;var a=Hn.get(i.Ge);if(a){var o;if(o=Xn.Yc(i.node,"urn:microsoft:playready","pro")){o=$e.Ja(o.textContent);var s=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),l=o.length,u=s.length+16+l,c=new ArrayBuffer(u),d=new Uint8Array(c),h=0;(c=new DataView(c)).setUint32(h,u),h+=4,c.setUint32(h,1886614376),h+=4,c.setUint32(h,0),h+=4,d.set(s,h),h+=s.length,c.setUint32(h,l),h+=4,d.set(o,h),o=[{initData:d,initDataType:"cenc",keyId:i.keyId}]}else o=null;o=fe(a,i.init||e||o),(a=zn.get(a))&&(o.licenseServerUri=a(i)),n.push(o)}else for(a=(i=f(i=t(i.node)||[])).next();!a.done;a=i.next())n.push(a.value)}return n}(i,t,a),0==e.length&&(e=[fe("",i)])),n.length&&(r||!a.length))for(e=[],r=(t=f(Hn.values())).next();!r.done;r=t.next())"org.w3.clearkey"!=(r=r.value)&&e.push(fe(r,i));if(o=Array.from(o)[0]||null)for(r=(t=f(e)).next();!r.done;r=t.next())for(n=(r=f(r.value.initData)).next();!n.done;n=r.next())n.value.keyId=o;return{be:o,Xg:i,drmInfos:e,ge:!0}}var Yn,zn=(new Map).set("com.widevine.alpha",(function(e){return(e=Xn.Yc(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""})).set("com.microsoft.playready",(function(e){return(e=Xn.Yc(e.node,"urn:microsoft:playready","pro"))&&(e=function(e){var t=0,r=new DataView(e).getUint32(t,!0);if(t+=4,r!==e.byteLength)return Y.v("PlayReady Object with invalid length encountered."),[];t+=2,r=[];for(var n=new DataView(e);t<e.byteLength-1;){var i=n.getUint16(t,!0);t+=2;var a=n.getUint16(t,!0);t+=2;var o=new Uint8Array(e,t,a);r.push({type:i,value:o}),t+=a}return r}((e=$e.Ja(e.textContent)).buffer).filter((function(e){return 1===e.type}))[0])?(e=ve(e.value,!0),(e=Xn.Ae(e,"WRMHEADER"))?function(e){for(var t=(e=f(e.getElementsByTagName("DATA"))).next();!t.done;t=e.next())for(var r=(t=f(t.value.childNodes)).next();!r.done;r=t.next())if((r=r.value)instanceof Element&&"LA_URL"==r.tagName)return r.textContent;return""}(e):""):""}));function Jn(e){var t=e.getAttribute("schemeIdUri"),r=Xn.getAttributeNS(e,"urn:mpeg:cenc:2013","default_KID"),n=Xn.fe(e,"urn:mpeg:cenc:2013","pssh").map(Xn.uc);if(!t)return Y.error("Missing required schemeIdUri attribute on","ContentProtection element",e),null;if(t=t.toLowerCase(),r&&(r=r.replace(/-/g,"").toLowerCase()).includes(" "))throw new z(2,4,4009);var i=[];try{i=n.map((function(e){return{initDataType:"cenc",initData:$e.Ja(e),keyId:null}}))}catch(a){throw new z(2,4,4007)}return{node:e,Ge:t,keyId:r,init:0<i.length?i:null}}function Qn(e,r,n,i,a){var o={RepresentationID:r,Number:n,Bandwidth:i,Time:a};return e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(r,n,i,a){if("$$"==r)return"$";var s=o[n];if(null==s)return Y.v("URL template does not have an available substitution for identifier",'"'+n+'":',e),r;switch("RepresentationID"==n&&i&&(Y.v("URL template should not contain a width specifier for identifier",'"RepresentationID":',e),i=void 0),"Time"==n&&(s=Math.round(s)),a){case void 0:case"d":case"i":case"u":r=s.toString();break;case"o":r=s.toString(8);break;case"x":r=s.toString(16);break;case"X":r=s.toString(16).toUpperCase();break;default:r=s.toString()}return i=t.parseInt(i,10)||1,Array(Math.max(0,i-r.length)+1).join("0")+r}))}function qn(e,t){var r=ei(e,t,"timescale"),n=1;r&&(n=Xn.Gc(r)||1),r=ei(e,t,"duration"),(r=Xn.Gc(r||""))&&(r/=n);var i=ei(e,t,"startNumber"),a=Number(ei(e,t,"presentationTimeOffset"))||0,o=Xn.Mb(i||"");null!=i&&null!=o||(o=1);var s=ti(e,t,"SegmentTimeline");if(i=null,s){i=n;var l=e.$.duration||1/0;s=Xn.Y(s,"S");for(var u=[],c=-a,d=0;d<s.length;++d){var h=s[d],f=Xn.R(h,"t",Xn.Mb),p=Xn.R(h,"d",Xn.Mb),y=Xn.R(h,"r",Xn.parseInt);if(null!=f&&(f-=a),!p){Y.v('"S" element must have a duration:','ignoring the remaining "S" elements.',h);break}if(f=null!=f?f:c,0>(y=y||0))if(d+1<s.length){if(null==(y=Xn.R(s[d+1],"t",Xn.Mb))){Y.v('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',h);break}if(f>=y){Y.v('An "S" element cannot have a negative repeat','if its start time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',h);break}y=Math.ceil((y-f)/p)-1}else{if(1/0==l){Y.v('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',h);break}if(f/i>=l){Y.v('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',h);break}y=Math.ceil((l*i-f)/p)-1}for(0<u.length&&f!=c&&(Math.abs((f-c)/i)>=ye&&Y.v("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",h),u[u.length-1].end=f/i),h=0;h<=y;++h)c=f+p,u.push({start:f/i,end:c/i,Pg:f}),f=c}i=u}return{timescale:n,ia:r,ob:o,sa:a/n||0,Vd:a,W:i}}function ei(e,t,r){return[t(e.G),t(e.fa),t(e.qa)].filter(de.Ra).map((function(e){return e.getAttribute(r)})).reduce((function(e,t){return e||t}))}function ti(e,t,r){return[t(e.G),t(e.fa),t(e.qa)].filter(de.Ra).map((function(e){return Xn.sc(e,r)})).reduce((function(e,t){return e||t}))}function ri(e,t,r,n,i,a){if(a=void 0===a?0:a,Xn.getAttributeNS(e,"http://www.w3.org/1999/xlink","href")){var o=function(e,t,r,n,i,a){for(var o=Xn.getAttributeNS(e,"http://www.w3.org/1999/xlink","href"),s=Xn.getAttributeNS(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",l=0;l<e.attributes.length;l++){var u=e.attributes[l];"http://www.w3.org/1999/xlink"==u.namespaceURI&&(e.removeAttributeNS(u.namespaceURI,u.localName),--l)}if(5<=a)return Oe(new z(2,4,4028));if("onLoad"!=s)return Oe(new z(2,4,4027));var c=he([n],[o]);return i.request(0,ze(c,t)).ca((function(n){if(!(n=Xn.ze(n.data,e.tagName)))return Oe(new z(2,4,4001,o));for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);for(;n.childNodes.length;){var s=n.childNodes[0];n.removeChild(s),e.appendChild(s)}for(s=0;s<n.attributes.length;s++){var l=n.attributes[s].nodeName,u=n.getAttribute(l);e.setAttribute(l,u)}return ri(e,t,r,c[0],i,a+1)}))}(e,t,r,n,i,a);return r&&(o=o.ca(void 0,(function(){return ri(e,t,r,n,i,a)}))),o}o=[];for(var s=0;s<e.childNodes.length;s++){var l=e.childNodes[s];l instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==Xn.getAttributeNS(l,"http://www.w3.org/1999/xlink","href")?(e.removeChild(l),--s):"SegmentTimeline"!=l.tagName&&o.push(ri(l,t,r,n,i,a)))}return Ne(o).ca((function(){return e}))}function ni(e,t,r){this.i=e,this.h=t,this.g=r}function ii(e,t,r,n,i,a){this.position=e,this.startTime=t,this.endTime=r,this.i=n,this.h=i,this.g=a}function ai(e,t,r,n){var i,a=(new Gn).ma("sidx",(function(e){i=function(e,t,r,n){var i=[];n.reader.U(4);var a=n.reader.N();if(0==a)throw Y.error("Invalid timescale."),new z(2,3,3005);if(0==n.version)var o=n.reader.N(),s=n.reader.N();else o=n.reader.Pb(),s=n.reader.Pb();n.reader.U(2);var l=n.reader.dc();for(e=e+n.size+s,s=0;s<l;s++){var u=n.reader.N(),c=(2147483648&u)>>>31;u&=2147483647;var d=n.reader.N();if(n.reader.U(4),1==c)throw Y.error("Heirarchical SIDXs are not supported."),new z(2,3,3006);i.push(new ii(i.length,o/a-t,(o+d)/a-t,(function(){return r}),e,e+u-1)),o+=d,e+=u}return n.parser.stop(),i}(t,n,r,e)}));if(e&&a.parse(e),i)return i;throw Y.error('Invalid box type, expected "sidx".'),new z(2,3,3004)}function oi(e){this.g=e}function si(e,t){for(;e.g.length&&e.g[e.g.length-1].startTime>=t;)e.g.pop();for(;e.g.length&&0>=e.g[0].endTime;)e.g.shift();if(0!=e.g.length){var r=e.g[e.g.length-1];e.g[e.g.length-1]=new ii(r.position,r.startTime,t,r.i,r.h,r.g)}}function li(e){this.h=e,this.g=new Dn(e,0),Yn||(Yn=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function ui(e){var t=ci(e);if(7<t.length)throw new z(2,3,3002);for(var r=0,n=0;n<t.length;n++)r=256*r+t[n];t=r,r=ci(e);e:{n=$e.Ha;for(var i=0;i<Yn.length;i++)if(n(r,Yn[i])){n=!0;break e}n=!1}if(n)r=e.h.byteLength-e.g.ka();else{if(8==r.length&&224&r[1])throw new z(2,3,3001);for(n=r[0]&(1<<8-r.length)-1,i=1;i<r.length;i++)n=256*n+r[i];r=n}return r=e.g.ka()+r<=e.h.byteLength?r:e.h.byteLength-e.g.ka(),n=new DataView(e.h.buffer,e.h.byteOffset+e.g.ka(),r),e.g.U(r),new di(t,n)}function ci(e){var t,r=e.g.ra();for(t=1;8>=t&&!(r&1<<8-t);t++);if(8<t)throw new z(2,3,3002);var n=new Uint8Array(t);for(n[0]=r,r=1;r<t;r++)n[r]=e.g.ra();return n}function di(e,t){this.id=e,this.g=t}function hi(e){if(8<e.g.byteLength)throw new z(2,3,3002);if(8==e.g.byteLength&&224&e.g.getUint8(0))throw new z(2,3,3001);for(var t=0,r=0;r<e.g.byteLength;r++)t=256*t+e.g.getUint8(r);return t}function fi(){}function pi(e){var t=new li(e.g);if(179!=(e=ui(t)).id)throw Y.v("Not a CueTime element."),new z(2,3,3013);if(e=hi(e),183!=(t=ui(t)).id)throw Y.v("Not a CueTrackPositions element."),new z(2,3,3012);t=new li(t.g);for(var r=0;t.Ca();){var n=ui(t);if(241==n.id){r=hi(n);break}}return{Qg:e,qg:r}}function yi(e,t){var r=ti(e,t,"Initialization");if(!r)return null;var n=e.G.xa,i=r.getAttribute("sourceURL");i&&(n=he(e.G.xa,[i])),i=0;var a=null;return(r=Xn.R(r,"range",Xn.Hc))&&(i=r.start,a=r.end),new ni((function(){return n}),i,a)}function mi(e,t,r,n,i,a,o,s){var l=e.presentationTimeline,u=!e.zb||!e.$.ld,c=e.$.start,d=e.$.duration,h=t,f=null;return{createSegmentIndex:function(){var e=[h(n,i,a),"webm"==o?h(r.i(),r.h,r.g):null];return h=null,Promise.all(e).then((function(e){var t=e[0];e=e[1]||null,t="mp4"==o?ai(t,i,n,s):(new fi).parse(t,e,n,s),l.Jb(t,c),f=new oi(t),u&&si(f,d)}))},findSegmentPosition:function(e){return f.find(e)},getSegmentReference:function(e){return f.get(e)}}}function gi(e){return e.ec}function vi(e,t){var r=yi(e,bi),n=function(e){return[e.G.Ua,e.fa.Ua,e.qa.Ua].filter(de.Ra).map((function(e){return Xn.Y(e,"SegmentURL")})).reduce((function(e,t){return 0<e.length?e:t})).map((function(t){return t.getAttribute("indexRange")&&!e.me&&(e.me=!0,Y.v("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate.")),{Tf:t.getAttribute("media"),start:(t=Xn.R(t,"mediaRange",Xn.Hc,{start:0,end:null})).start,end:t.end}}))}(e),i=qn(e,bi),a=i.ob;0==a&&(Y.v("SegmentList@startNumber must be > 0"),a=1);var o=0;if(i.ia?o=i.ia*(a-1):i.W&&0<i.W.length&&(o=i.W[0].start),!(n={ia:i.ia,startTime:o,ob:a,sa:i.sa,W:i.W,jb:n}).ia&&!n.W&&1<n.jb.length)throw Y.v("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",e.G),new z(2,4,4002);if(!n.ia&&!e.$.duration&&!n.W&&1==n.jb.length)throw Y.v("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",e.G),new z(2,4,4002);if(n.W&&0==n.W.length)throw Y.v("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",e.G),new z(2,4,4002);return a=i=null,e.qa.id&&e.G.id&&(i=t[a=e.qa.id+","+e.G.id]),o=function(e,t,r,n){var i=n.jb.length;n.W&&n.W.length!=n.jb.length&&(i=Math.min(n.W.length,n.jb.length),Y.v("The number of items in the segment timeline and the number of segment","URLs do not match, truncating",n.jb.length,"to",i));for(var a=[],o=n.startTime,s=0;s<i;s++){var l=n.jb[s],u=he(r,[l.Tf]),c=void 0;c=null!=n.ia?o+n.ia:n.W?n.W[s].end:o+e,a.push(new ii(s+t,o,c,function(e){return e}.bind(null,u),l.start,l.end)),o=c}return a}(e.$.duration,n.ob,e.G.xa,n),i?(i.sd(o),a=e.presentationTimeline.$b(),i.Vc(a-e.$.start)):(e.presentationTimeline.Jb(o,e.$.start),i=new oi(o),a&&e.zb&&(t[a]=i)),e.zb&&e.$.ld||si(i,e.$.duration),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:i.find.bind(i),getSegmentReference:i.get.bind(i),initSegmentReference:r,sa:n.sa}}function bi(e){return e.Ua}function _i(e,t,r,n){var i=function(e){var t=ei(e,Ei,"initialization");if(!t)return null;var r=e.G.id,n=e.bandwidth||null,i=e.G.xa;return new ni((function(){var e=Qn(t,r,null,n,null);return he(i,[e])}),0,null)}(e),a=qn(e,Ei),o=ei(e,Ei,"media"),s=ei(e,Ei,"index");if(o=(a={ia:a.ia,timescale:a.timescale,ob:a.ob,sa:a.sa,Vd:a.Vd,W:a.W,qd:o,bc:s}).bc?1:0,o+=a.W?1:0,0==(o+=a.ia?1:0))throw Y.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",e.G),new z(2,4,4002);if(1!=o&&(Y.v("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",e.G),a.bc?(Y.info("Using the index URL template by default."),a.W=null):Y.info("Using the SegmentTimeline by default."),a.ia=null),!a.bc&&!a.qd)throw Y.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",e.G),new z(2,4,4002);if(a.bc){if("mp4"!=(r=e.G.mimeType.split("/")[1])&&"webm"!=r)throw Y.error("SegmentTemplate specifies an unsupported container type.",e.G),new z(2,4,4006);if("webm"==r&&!i)throw Y.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate uses a WebM container,","but does not contain an initialization URL template.",e.G),new z(2,4,4005);n=Qn(a.bc,e.G.id,null,e.bandwidth||null,null),e=mi(e,t,i,n=he(e.G.xa,[n]),0,null,r,a.sa)}else a.ia?(n||(e.presentationTimeline.ud(a.ia),e.presentationTimeline.vd(e.$.start)),e=function(e,t){var r=e.$.duration,n=t.ia,i=t.ob,a=t.timescale,o=t.qd,s=e.bandwidth||null,l=e.G.id,u=e.G.xa;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0>e||r&&e>=r?null:Math.floor(e/n)},getSegmentReference:function(e){var t=e*n,c=t+n;return r&&(c=Math.min(c,r)),0>c||r&&t>=r?null:new ii(e,t,c,(function(){var r=Qn(o,l,e+i,s,t*a);return he(u,[r])}),0,null)}}}(e,a)):(o=t=null,e.qa.id&&e.G.id&&(t=r[o=e.qa.id+","+e.G.id]),s=function(e,t){for(var r=[],n=0;n<t.W.length;n++){var i=n+t.ob;r.push(new ii(i,t.W[n].start,t.W[n].end,function(e,t,r,n,i,a){return he(n,[e=Qn(e,t,i,r,a)]).map((function(e){return e.toString()}))}.bind(null,t.qd,e.G.id,e.bandwidth||null,e.G.xa,i,t.W[n].Pg+t.Vd),0,null))}return r}(e,a),n=!e.zb||!e.$.ld,t?(n&&si(new oi(s),e.$.duration),t.sd(s),r=e.presentationTimeline.$b(),t.Vc(r-e.$.start)):(e.presentationTimeline.Jb(s,e.$.start),t=new oi(s),o&&e.zb&&(r[o]=t)),n&&si(t,e.$.duration),e={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:t.find.bind(t),getSegmentReference:t.get.bind(t)});return{createSegmentIndex:e.createSegmentIndex,findSegmentPosition:e.findSegmentPosition,getSegmentReference:e.getSegmentReference,initSegmentReference:i,sa:a.sa}}function Ei(e){return e.gc}F("shaka.media.InitSegmentReference",ni),ni.prototype.Tc=function(){return this.i()},ni.prototype.createUris=ni.prototype.Tc,ni.prototype.dd=function(){return this.h},ni.prototype.getStartByte=ni.prototype.dd,ni.prototype.cd=function(){return this.g},ni.prototype.getEndByte=ni.prototype.cd,F("shaka.media.SegmentReference",ii),ii.prototype.ka=function(){return this.position},ii.prototype.getPosition=ii.prototype.ka,ii.prototype.xc=function(){return this.startTime},ii.prototype.getStartTime=ii.prototype.xc,ii.prototype.qf=function(){return this.endTime},ii.prototype.getEndTime=ii.prototype.qf,ii.prototype.Tc=function(){return this.i()},ii.prototype.createUris=ii.prototype.Tc,ii.prototype.dd=function(){return this.h},ii.prototype.getStartByte=ii.prototype.dd,ii.prototype.cd=function(){return this.g},ii.prototype.getEndByte=ii.prototype.cd,F("shaka.media.SegmentIndex",oi),oi.prototype.destroy=function(){return this.g=null,Promise.resolve()},oi.prototype.destroy=oi.prototype.destroy,oi.prototype.find=function(e){for(var t=this.g.length-1,r=t;0<=r;--r){var n=this.g[r],i=r<t?this.g[r+1].startTime:n.endTime;if(e>=n.startTime&&e<i)return n.position}return this.g.length&&e<this.g[0].startTime?this.g[0].position:null},oi.prototype.find=oi.prototype.find,oi.prototype.get=function(e){return 0==this.g.length||0>(e-=this.g[0].position)||e>=this.g.length?null:this.g[e]},oi.prototype.get=oi.prototype.get,oi.prototype.offset=function(e){for(var t=0;t<this.g.length;++t)this.g[t].startTime+=e,this.g[t].endTime+=e},oi.prototype.offset=oi.prototype.offset,oi.prototype.sd=function(e){for(var t=[],r=0,n=0;r<this.g.length&&n<e.length;){var i=this.g[r],a=e[n];i.startTime<a.startTime?(t.push(i),r++):(i.startTime>a.startTime?0==r?t.push(a):Y.v("Refusing to rewrite original references on update!"):(.1<Math.abs(i.endTime-a.endTime)?t.push(new ii(i.position,a.startTime,a.endTime,a.i,a.h,a.g)):t.push(i),r++),n++)}for(;r<this.g.length;)t.push(this.g[r++]);if(t.length)for(r=t[t.length-1].position+1;n<e.length;)i=new ii(r++,(i=e[n++]).startTime,i.endTime,i.i,i.h,i.g),t.push(i);else t=e;this.g=t},oi.prototype.merge=oi.prototype.sd,oi.prototype.Vc=function(e){for(var t=0;t<this.g.length;++t)if(this.g[t].endTime>e)return void this.g.splice(0,t);this.g=[]},oi.prototype.evict=oi.prototype.Vc,li.prototype.Ca=function(){return this.g.Ca()},fi.prototype.parse=function(e,t,r,n){var i;if(440786851!=ui(t=new li(new DataView(t))).id)throw Y.error("Not an EBML element."),new z(2,3,3008);var a=ui(t);if(408125543!=a.id)throw Y.error("Not a Segment element."),new z(2,3,3009);for(t=a.g.byteOffset,a=new li(a.g),i=null;a.Ca();){var o=ui(a);if(357149030==o.id){i=o;break}}if(!i)throw Y.error("Not an Info element."),new z(2,3,3010);for(a=new li(i.g),i=1e6,o=null;a.Ca();){var s=ui(a);if(2807729==s.id)i=hi(s);else if(17545==s.id)if(4==(o=s).g.byteLength)o=o.g.getFloat32(0);else{if(8!=o.g.byteLength)throw new z(2,3,3003);o=o.g.getFloat64(0)}}if(null==o)throw new z(2,3,3011);if(i=o*(a=i/1e9),475249515!=(e=ui(new li(new DataView(e)))).id)throw Y.error("Not a Cues element."),new z(2,3,3007);return function(e,t,r,n,i,a){function o(){return i}var s=[];e=new li(e.g);for(var l=null,u=null;e.Ca();){var c=ui(e);if(187==c.id){var d=pi(c);d&&(c=r*d.Qg,d=t+d.qg,null!=l&&s.push(new ii(s.length,l-a,c-a,o,u,d-1)),l=c,u=d)}}return null!=l&&s.push(new ii(s.length,l-a,n-a,o,u,null)),s}(e,t,a,i,r,n)};var Ti={Nb:{},cc:{},Fd:function(e,t){Ti.cc[e]=t}};function Si(e,t,r){this.j=e,this.Ic=t,this.m=this.l=1/0,this.g=1,this.h=this.i=null,this.u=0,this.A=!0,this.o=0,this.C=void 0===r||r}function $i(e,t,r,n){return e=ze(e,n),0==t&&null==r||(e.headers.Range=r?"bytes="+t+"-"+r:"bytes="+t+"-"),e}function Ai(){var e=this;this.h=this.g=null,this.j=[],this.i=null,this.u=[],this.m=1,this.A={},this.C=0,this.F=new W(5),this.o=new Ce((function(){!function(e){y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return Y.info("Updating manifest..."),r=0,k(t,2),A(t,wi(e),4);case 4:r=t.B,C(t,3);break;case 2:n=P(t),e.h&&(n.severity=1,e.h.onError(n));case 3:if(!e.h)return t.return();Pi(e,r),w(t)}}))}))}(e)})),this.l=new We}function wi(e){var t=Date.now(),r=e.h.networkingEngine.request(0,ze(e.j,e.g.retryParameters));return Xe(e.l,r),r.promise.then((function(t){if(e.h)return t.uri&&!e.j.includes(t.uri)&&e.j.unshift(t.uri),function(e,t,r){if(!(t=Xn.ze(t,"MPD")))throw new z(2,4,4001,r);return t=ri(t,e.g.retryParameters,e.g.dash.xlinkFailGracefully,r,e.h.networkingEngine),Xe(e.l,t),t.promise.then((function(t){return function(e,t,r){return y((function n(){var i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b,_,E,T,S,$,k,I,C;return N(n,(function(n){switch(n.s){case 1:s=de,u=[r],0<(c=(l=Xn).Y(t,"Location").map(l.uc).filter(s.Ra)).length&&(d=he(u,c),u=e.j=d),h=l.Y(t,"BaseURL").map(l.uc),f=he(u,h),p=e.g.dash.ignoreMinBufferTime,y=0,p||(y=l.R(t,"minBufferTime",l.Ma)),e.C=l.R(t,"minimumUpdatePeriod",l.Ma,-1),m=l.R(t,"availabilityStartTime",l.jg),g=l.R(t,"timeShiftBufferDepth",l.Ma),v=l.R(t,"maxSegmentDuration",l.Ma),b=t.getAttribute("type")||"static",_=e.g.dash.ignoreSuggestedPresentationDelay,E=null,_||(E=l.R(t,"suggestedPresentationDelay",l.Ma)),e.i?T=e.i.presentationTimeline:(S=Math.max(e.g.dash.defaultPresentationDelay,1.5*y),T=new Si(m,null!=E?E:S,e.g.dash.autoCorrectDrift));for(var P={zb:"static"!=b,presentationTimeline:T,qa:null,$:null,fa:null,G:null,bandwidth:0,me:!1},x=f,R=Xn.R(t,"mediaPresentationDuration",Xn.Ma),O=[],L=0,D=Xn.Y(t,"Period"),M=0;M<D.length;M++){var N=D[M];L=Xn.R(N,"start",Xn.Ma,L);var G=Xn.R(N,"duration",Xn.Ma),V=null;if(M!=D.length-1){var U=Xn.R(D[M+1],"start",Xn.Ma);null!=U&&(V=U-L)}else null!=R&&(V=R-L);if(U=ye,V&&G&&Math.abs(V-G)>U&&Y.v("There is a gap/overlap between Periods",N),null==V&&(V=G),N=ki(e,P,x,{start:L,duration:V,node:N,ld:null==V||M==D.length-1}),O.push(N),G=P.qa.id,e.u.includes(G)||(e.u.push(G),e.i&&(e.h.filterNewPeriod(N),e.i.periods.push(N))),null==V){M!=D.length-1&&Y.v("Skipping Period",M+1,"and any subsequent Periods:","Period",M+1,"does not have a valid start time.",O[M+1]),L=null;break}L+=V}if(null==e.i&&e.h.filterAllPeriods(O),null!=R?(L!=R&&Y.v("@mediaPresentationDuration does not match the total duration of all","Periods."),i=O,a=R,o=!1):(i=O,a=L,o=!0),$=a,k=i,T.hc("static"==b),"static"!=b&&o||T.Fa($||1/0),T.aa()&&!isNaN(e.g.availabilityWindowOverride)&&(g=e.g.availabilityWindowOverride),null==g&&(g=1/0),T.Pd(g),T.ud(v||1),e.i){n.I(0);break}if(e.i={presentationTimeline:T,periods:k,offlineSessionIds:[],minBufferTime:y||0},!T.Pe()){n.I(0);break}return I=l.Y(t,"UTCTiming"),A(n,function(e,t,r){r=r.map((function(e){return{scheme:e.getAttribute("schemeIdUri"),value:e.getAttribute("value")}}));var n=e.g.dash.clockSyncUri;return!r.length&&n&&r.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:n}),de.df(r,function(e){var r=e.scheme;switch(e=e.value,r){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return Ri(this,t,e,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return Ri(this,t,e,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return r=Date.parse(e),isNaN(r)?0:r-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return Y.ba("NTP UTCTiming scheme is not supported"),Promise.reject();default:return Y.ba("Unrecognized scheme in UTCTiming element",r),Promise.reject()}}.bind(e)).catch((function(){return Y.ba("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),0}))}(e,f,I),4);case 4:if(C=n.B,!e.h)return n.return();T.Ke(C),w(n)}}))}))}(e,t,r)}))}(e,t.data,t.uri)})).then((function(){var r=(Date.now()-t)/1e3;return X(e.F,1,r),r}))}function ki(e,t,r,n){if(t.qa=xi(n.node,null,r),t.$=n,t.qa.id||(Y.info("No Period ID given for Period with start time "+n.start+",  Assigning a default"),t.qa.id="__shaka_period_"+n.start),Xn.Y(n.node,"EventStream").forEach(e.kg.bind(e,n.start,n.duration)),r=Xn.Y(n.node,"AdaptationSet").map(e.ig.bind(e,t)).filter(de.Ra),t.zb){t=[];for(var i=f(r),a=i.next();!a.done;a=i.next())for(var o=(a=f(a.value.tg)).next();!o.done;o=a.next())t.push(o.value);if(t.length!=new Set(t).size)throw new z(2,4,4018)}var s=r.filter((function(e){return!e.Td}));if(r.filter((function(e){return e.Td})).forEach((function(e){var t=e.Td.split(" ");s.forEach((function(r){t.includes(r.id)&&r.streams.forEach((function(t){t.trickModeVideo=e.streams.find((function(e){return ht(t.codecs)[0]==ht(e.codecs)[0]}))}))}))})),t=Ii(s,"video"),i=Ii(s,"audio"),!t.length&&!i.length)throw new z(2,4,4004);for(r=e.g.disableAudio,i.length&&!r||(i=[null]),r=e.g.disableVideo,t.length&&!r||(t=[null]),r=[],a=0;a<i.length;a++)for(o=0;o<t.length;o++)Ci(e,i[a],t[o],r);if(t=[],!e.g.disableText)for(e=Ii(s,"text"),i=0;i<e.length;i++)t.push.apply(t,e[i].streams);return{startTime:n.start,textStreams:t,variants:r}}function Ii(e,t){return e.filter((function(e){return e.contentType==t}))}function Ci(e,t,r,n){if(t||r)if(t&&r){var i=t.drmInfos,a=r.drmInfos;if(!i.length||!a.length||0<Vt(i,a).length){a=Vt(t.drmInfos,r.drmInfos);for(var o=0;o<t.streams.length;o++)for(var s=0;s<r.streams.length;s++)i=(r.streams[s].bandwidth||0)+(t.streams[o].bandwidth||0),i={id:e.m++,language:t.language,primary:t.pd||r.pd,audio:t.streams[o],video:r.streams[s],bandwidth:i,drmInfos:a,allowedByApplication:!0,allowedByKeySystem:!0},n.push(i)}}else for(a=t||r,o=0;o<a.streams.length;o++)i=a.streams[o].bandwidth||0,i={id:e.m++,language:a.language||"und",primary:a.pd,audio:t?a.streams[o]:null,video:r?a.streams[o]:null,bandwidth:i,drmInfos:a.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0},n.push(i)}function Pi(e,t){0>e.C||e.o.V(Math.max(3,e.C-t,H(e.F)))}function xi(e,t,r){t=t||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,wd:null,audioSamplingRate:null},r=r||t.xa;var n=Xn.Mb,i=Xn.ff,a=Xn.Y(e,"BaseURL").map(Xn.uc),o=e.getAttribute("contentType")||t.contentType,s=e.getAttribute("mimeType")||t.mimeType,l=e.getAttribute("codecs")||t.codecs;i=Xn.R(e,"frameRate",i)||t.frameRate;for(var u=e.getAttribute("sar")||t.pixelAspectRatio,c=Xn.Y(e,"InbandEventStream"),d=t.emsgSchemeIdUris.slice(),h=(c=f(c)).next();!h.done;h=c.next())h=h.value.getAttribute("schemeIdUri"),d.includes(h)||d.push(h);return c=function(e){for(var t=0;t<e.length;++t){var r=e[t],n=r.getAttribute("schemeIdUri");if(n&&(r=r.getAttribute("value")))switch(n){case"urn:mpeg:dash:outputChannelPositionList:2012":return r.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var i=parseInt(r,10);if(!i){Y.v("Channel parsing failure! Ignoring scheme and value",n,r);continue}return i;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(i=parseInt(r,16))){Y.v("Channel parsing failure! Ignoring scheme and value",n,r);continue}for(e=0;i;)1&i&&++e,i>>=1;return e;default:Y.v("Unrecognized audio channel scheme:",n,r)}}return null}(c=Xn.Y(e,"AudioChannelConfiguration"))||t.wd,h=Xn.R(e,"audioSamplingRate",n)||t.audioSamplingRate,o||(o=Oi(s,l)),{xa:he(r,a),ec:Xn.sc(e,"SegmentBase")||t.ec,Ua:Xn.sc(e,"SegmentList")||t.Ua,gc:Xn.sc(e,"SegmentTemplate")||t.gc,width:Xn.R(e,"width",n)||t.width,height:Xn.R(e,"height",n)||t.height,contentType:o,mimeType:s,codecs:l,frameRate:i,pixelAspectRatio:u,emsgSchemeIdUris:d,id:e.getAttribute("id"),wd:c,audioSamplingRate:h}}function Ri(e,t,r,n){return(t=ze(t=he(t,[r]),e.g.retryParameters)).method=n,t=e.h.networkingEngine.request(4,t),Xe(e.l,t),t.promise.then((function(e){if("HEAD"==n){if(!e.headers||!e.headers.date)return Y.v("UTC timing response is missing","expected date header"),0;e=e.headers.date}else e=ge(e.data);return e=Date.parse(e),isNaN(e)?(Y.v("Unable to parse date from UTC timing response"),0):e-Date.now()}))}function Oi(e,t){return gr(ct(e,t))?"text":e.split("/")[0]}function Li(e,t,r,n){this.h=e,this.type=t,this.g=r,this.segments=n||null}function Di(e,t,r,n){this.id=e,this.name=t,this.g=r,this.value=void 0===n?null:n}function Mi(e,t){this.name=e,this.value=t}function Ni(e,t,r){return(e=e.getAttribute(t))?e.value:r||null}function Gi(e,t){this.h=t,this.g=e}F("shaka.media.ManifestParser.registerParserByExtension",Ti.Fd),Ti.Qb=function(e,t){Ti.Nb[e]=t},F("shaka.media.ManifestParser.registerParserByMime",Ti.Qb),Ti.ng=function(){var e={};if(pt()){for(var t in Ti.Nb)e[t]=!0;for(var r in Ti.cc)e[r]=!0}t={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var n=(r=f(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!n.done;n=r.next())e[n=n.value]=pt()?!!Ti.Nb[n]:yt(n);for(var i in t)e[i]=pt()?!!Ti.cc[i]:yt(t[i]);return e},Ti.create=function(e,t,r,n){return y((function i(){var a,o;return N(i,(function(i){switch(i.s){case 1:return k(i,2),A(i,Ti.rf(e,t,r,n),4);case 4:return a=i.B,i.return(new a);case 2:throw(o=P(i)).severity=2,o}}))}))},Ti.rf=function(e,t,r,n){return y((function i(){var a,o,s,l,u;return N(i,(function(i){switch(i.s){case 1:if(a=Ti,n){if(o=a.Nb[n.toLowerCase()])return i.return(o);Y.v("Could not determine manifest type using MIME type ",n)}if(s=a.getExtension(e)){if(l=a.cc[s])return i.return(l);Y.v("Could not determine manifest type for extension ",s)}else Y.v("Could not find extension for ",e);if(n){i.I(2);break}return A(i,a.zf(e,t,r),3);case 3:if(n=i.B){if(u=Ti.Nb[n])return i.return(u);Y.v("Could not determine manifest type using MIME type",n)}case 2:throw new z(2,4,4e3,e)}}))}))},Ti.zf=function(e,t,r){return y((function n(){var i,a,o;return N(n,(function(n){switch(n.s){case 1:return(i=ze([e],r)).method="HEAD",A(n,t.request(0,i).promise,2);case 2:return a=n.B,o=a.headers["content-type"],n.return(o?o.toLowerCase().split(";").shift():"")}}))}))},Ti.getExtension=function(e){return 1==(e=new Q(e).pa.split("/").pop().split(".")).length?"":e.pop().toLowerCase()},Ti.isSupported=function(e,t){return!!pt()&&(t in Ti.Nb||Ti.getExtension(e)in Ti.cc)},F("shaka.media.PresentationTimeline",Si),Si.prototype.ha=function(){return this.l},Si.prototype.getDuration=Si.prototype.ha,Si.prototype.xf=function(){return this.g},Si.prototype.getMaxSegmentDuration=Si.prototype.xf,Si.prototype.Fa=function(e){this.l=e},Si.prototype.setDuration=Si.prototype.Fa,Si.prototype.Ff=function(){return this.j},Si.prototype.getPresentationStartTime=Si.prototype.Ff,Si.prototype.Ke=function(e){this.u=e},Si.prototype.setClockOffset=Si.prototype.Ke,Si.prototype.hc=function(e){this.A=e},Si.prototype.setStatic=Si.prototype.hc,Si.prototype.Pd=function(e){this.m=e},Si.prototype.setSegmentAvailabilityDuration=Si.prototype.Pd,Si.prototype.Ag=function(e){this.Ic=e},Si.prototype.setDelay=Si.prototype.Ag,Si.prototype.pf=function(){return this.Ic},Si.prototype.getDelay=Si.prototype.pf,Si.prototype.Jb=function(e,t){if(0!=e.length){var r=e[e.length-1].endTime+t;this.vd(e[0].startTime+t),this.g=e.reduce((function(e,t){return Math.max(e,t.endTime-t.startTime)}),this.g),this.h=Math.max(this.h,r),null!=this.j&&this.C&&(this.j=(Date.now()+this.u)/1e3-this.h-this.g),Y.K("notifySegments:","maxSegmentDuration="+this.g)}},Si.prototype.notifySegments=Si.prototype.Jb,Si.prototype.vd=function(e){this.i=null==this.i?e:Math.min(this.i,e)},Si.prototype.notifyMinSegmentStartTime=Si.prototype.vd,Si.prototype.ud=function(e){this.g=Math.max(this.g,e),Y.K("notifyNewSegmentDuration:","maxSegmentDuration="+this.g)},Si.prototype.notifyMaxSegmentDuration=Si.prototype.ud,Si.prototype.offset=function(e){null!=this.i&&(this.i+=e),null!=this.h&&(this.h+=e)},Si.prototype.offset=Si.prototype.offset,Si.prototype.aa=function(){return 1/0==this.l&&!this.A},Si.prototype.isLive=Si.prototype.aa,Si.prototype.ib=function(){return 1/0!=this.l&&!this.A},Si.prototype.isInProgress=Si.prototype.ib,Si.prototype.$b=function(){if(1/0==this.m)return this.o;var e=this.Db()-this.m;return Math.max(this.o,e)},Si.prototype.getSegmentAvailabilityStart=Si.prototype.$b,Si.prototype.Le=function(e){this.o=e},Si.prototype.setUserSeekStart=Si.prototype.Le,Si.prototype.Db=function(){return this.aa()||this.ib()?Math.min(Math.max(0,(Date.now()+this.u)/1e3-this.g-this.j),this.l):this.l},Si.prototype.getSegmentAvailabilityEnd=Si.prototype.Db,Si.prototype.Zb=function(e){var t=Math.max(this.i,this.o);if(1/0==this.m)return Math.ceil(1e3*t)/1e3;var r=this.Db()-this.m;return e=Math.min(r+e,this.Ka()),Math.max(t,e)},Si.prototype.getSafeSeekRangeStart=Si.prototype.Zb,Si.prototype.Cb=function(){return this.Zb(0)},Si.prototype.getSeekRangeStart=Si.prototype.Cb,Si.prototype.Ka=function(){var e=this.aa()||this.ib()?this.Ic:0;return Math.max(0,this.Db()-e)},Si.prototype.getSeekRangeEnd=Si.prototype.Ka,Si.prototype.Pe=function(){return!(null==this.j||null!=this.h&&this.C)},Si.prototype.usingPresentationStartTime=Si.prototype.Pe,F("shaka.dash.DashParser",Ai),(i=Ai.prototype).configure=function(e){this.g=e},i.start=function(e,t){var r=this;return y((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return r.j=[e],r.h=t,A(n,wi(r),2);case 2:if(i=n.B,r.h&&Pi(r,i),!r.h)throw new z(2,7,7001);return n.return(r.i)}}))}))},i.stop=function(){return this.g=this.h=null,this.j=[],this.i=null,this.u=[],this.A={},null!=this.o&&(this.o.stop(),this.o=null),this.l.destroy()},i.update=function(){wi(this).catch(function(e){this.h&&this.h.onError(e)}.bind(this))},i.onExpirationUpdated=function(){},i.ig=function(e,t){if(e.fa=xi(t,e.qa,null),"image"==e.fa.contentType)return Y.v("Skipping Image AdaptationSet",e.fa),null;var r=!1,n=Xn.Y(t,"Role"),i=n.map((function(e){return e.getAttribute("value")})).filter(de.Ra),a=void 0,o="text"==e.fa.contentType;o&&(a="subtitle");for(var s=0;s<n.length;s++){var l=n[s].getAttribute("schemeIdUri");if(null==l||"urn:mpeg:dash:role:2011"==l)switch(l=n[s].getAttribute("value"),l){case"main":r=!0;break;case"caption":case"subtitle":a=l}}var u=null,c=!1;Xn.Y(t,"EssentialProperty").forEach((function(e){"http://dashif.org/guidelines/trickmode"==e.getAttribute("schemeIdUri")?u=e.getAttribute("value"):c=!0})),s=Xn.Y(t,"Accessibility");var d=new Map;for(n={},l=(s=f(s)).next();!l.done;n={Vb:n.Vb},l=s.next()){var h=l.value;l=h.getAttribute("schemeIdUri"),h=h.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==l||"urn:scte:dash:cc:cea-708:2015"==l?(n.Vb=1,null!=h?h.split(";").forEach(function(e){return function(t){if(t.includes("=")){var r=(t=t.split("="))[0].startsWith("CC")?t[0]:"CC"+t[0];t=t[1].split(",")[0].split(":").pop()}else r="CC"+e.Vb,e.Vb+=2;d.set(r,Mr(t))}}(n)):d.set("CC1","und")):"urn:mpeg:dash:role:2011"==l&&null!=h&&(i.push(h),"captions"==h&&(a="caption"))}if(c)return null;var p=Kn(n=Xn.Y(t,"ContentProtection"),this.g.dash.customScheme,this.g.dash.ignoreDrmInfo);if(n=Mr(t.getAttribute("lang")||"und"),s=t.getAttribute("label"),(l=Xn.Y(t,"Label"))&&l.length&&(l=l[0]).textContent&&(s=l.textContent),0==(i=(l=Xn.Y(t,"Representation")).map(this.lg.bind(this,e,p,a,n,s,r,i,d)).filter((function(e){return!!e}))).length){if(this.g.dash.ignoreEmptyAdaptationSet||o)return null;throw new z(2,4,4003)}return e.fa.contentType&&"application"!=e.fa.contentType||(e.fa.contentType=Oi(i[0].mimeType,i[0].codecs),i.forEach((function(t){t.type=e.fa.contentType}))),i.forEach((function(e){p.drmInfos.forEach((function(t){e.keyId&&t.keyIds.push(e.keyId)}))})),o=l.map((function(e){return e.getAttribute("id")})).filter(de.Ra),{id:e.fa.id||"__fake__"+this.m++,contentType:e.fa.contentType,language:n,pd:r,streams:i,drmInfos:p.drmInfos,Td:u,tg:o}},i.lg=function(e,t,r,n,i,a,o,s,l){if(e.G=xi(l,e.fa,null),!function(e){var t=e.ec?1:0;return t+=e.Ua?1:0,0==(t+=e.gc?1:0)?"text"==e.contentType||"application"==e.contentType||(Y.v("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',e),!1):(1!=t&&(Y.v("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",e),e.ec?(Y.info("Using SegmentBase by default."),e.Ua=null):Y.info("Using SegmentList by default."),e.gc=null),!0)}(e.G))return Y.v("Skipping Representation",e.G),null;e.bandwidth=Xn.R(l,"bandwidth",Xn.Gc)||0;var u=e.G.contentType;u="text"==u||"application"==u;try{var c=this.ug.bind(this);if(e.G.ec)var d=function(e,t){var r=Number(ei(e,gi,"presentationTimeOffset"))||0,n=ei(e,gi,"timescale"),i=1;n&&(i=Xn.Gc(n)||1),r=r/i||0,n=yi(e,gi);var a=e.G.contentType;if(i=e.G.mimeType.split("/")[1],"text"!=a&&"mp4"!=i&&"webm"!=i)throw Y.error("SegmentBase specifies an unsupported container type.",e.G),new z(2,4,4006);if("webm"==i&&!n)throw Y.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",e.G),new z(2,4,4005);a=ti(e,gi,"RepresentationIndex");var o=ei(e,gi,"indexRange"),s=e.G.xa;if(o=Xn.Hc(o||""),a){var l=a.getAttribute("sourceURL");l&&(s=he(e.G.xa,[l])),o=Xn.R(a,"range",Xn.Hc,o)}if(!o)throw Y.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",e.G),new z(2,4,4002);return{createSegmentIndex:(i=mi(e,t,n,s,o.start,o.end,i,r)).createSegmentIndex,findSegmentPosition:i.findSegmentPosition,getSegmentReference:i.getSegmentReference,initSegmentReference:n,sa:r}}(e,c);else if(e.G.Ua)d=vi(e,this.A);else if(e.G.gc)d=_i(e,c,this.A,!!this.i);else{var h=e.G.xa,f=e.$.duration||0;d={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(e){return 0<=e&&e<f?1:null},getSegmentReference:function(e){return 1!=e?null:new ii(1,0,f,(function(){return h}),0,null)},initSegmentReference:null,sa:0}}}catch(p){if(u&&4002==p.code)return null;throw p}return l=function(e,t,r,n){var i=Kn(e,t,n);if(r.ge)e=1==r.drmInfos.length&&!r.drmInfos[0].keySystem,t=0==i.drmInfos.length,(0==r.drmInfos.length||e&&!t)&&(r.drmInfos=i.drmInfos),r.ge=!1;else if(0<i.drmInfos.length&&(r.drmInfos=r.drmInfos.filter((function(e){return i.drmInfos.some((function(t){return t.keySystem==e.keySystem}))})),0==r.drmInfos.length))throw new z(2,4,4008);return i.be||r.be}(l=Xn.Y(l,"ContentProtection"),this.g.dash.customScheme,t,this.g.dash.ignoreDrmInfo),{id:this.m++,originalId:e.G.id,createSegmentIndex:d.createSegmentIndex,findSegmentPosition:d.findSegmentPosition,getSegmentReference:d.getSegmentReference,initSegmentReference:d.initSegmentReference,presentationTimeOffset:d.sa,mimeType:e.G.mimeType,codecs:e.G.codecs,frameRate:e.G.frameRate,pixelAspectRatio:e.G.pixelAspectRatio,bandwidth:e.bandwidth,width:e.G.width,height:e.G.height,kind:r,encrypted:0<t.drmInfos.length,keyId:l,language:n,label:i,type:e.fa.contentType,primary:a,trickModeVideo:null,emsgSchemeIdUris:e.G.emsgSchemeIdUris,roles:o,channelsCount:e.G.wd,audioSamplingRate:e.G.audioSamplingRate,closedCaptions:s}},i.kg=function(e,t,r){var n=Xn.Mb,i=r.getAttribute("schemeIdUri")||"",a=r.getAttribute("value")||"",o=Xn.R(r,"timescale",n)||1;Xn.Y(r,"Event").forEach(function(r){var s=Xn.R(r,"presentationTime",n)||0,l=Xn.R(r,"duration",n)||0;l=(s=s/o+e)+l/o,null!=t&&(s=Math.min(s,e+t),l=Math.min(l,e+t)),r={schemeIdUri:i,value:a,startTime:s,endTime:l,id:r.getAttribute("id")||"",eventElement:r},this.h.onTimelineRegionAdded(r)}.bind(this))},i.ug=function(e,t,r){return e=$i(e,t,r,this.g.retryParameters),e=this.h.networkingEngine.request(1,e),Xe(this.l,e),e.promise.then((function(e){return e.data}))},Ti.Fd("mpd",Ai),Ti.Qb("application/dash+xml",Ai),Ti.Qb("video/vnd.mpeg.dash.mpd",Ai),Di.prototype.toString=function(){var e="#"+this.name,t=this.g?this.g.map((function(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)})):[];return this.value&&t.unshift(this.value),0<t.length&&(e+=":"+t.join(",")),e},Di.prototype.getAttribute=function(e){var t=this.g.filter((function(t){return t.name==e}));return t.length?t[0]:null};var Vi={Ab:function(e,t){return e.filter((function(e){return e.name==t}))},cb:function(e,t){var r=Vi.Ab(e,t);return r.length?r[0]:null},Zc:function(e,t,r){return e.filter((function(e){var n=e.getAttribute("TYPE");return e=e.getAttribute("GROUP-ID"),n.value==t&&e.value==r}))},Sc:function(e,t){return he([e],[t])[0]},kd:function(e){return/^#(?!EXT)/m.test(e)}};function Ui(e){this.h=e,this.g=0}function Zi(e){Bi(e,/[ \t]+/gm)}function Bi(e,t){t.lastIndex=e.g;var r=t.exec(e.h);return r=null==r?null:{position:r.index,length:r[0].length,wg:r},e.g==e.h.length||null==r||r.position!=e.g?null:(e.g+=r.length,r.wg)}function Fi(e){return e.g==e.h.length?null:(e=Bi(e,/[^ \t\n]*/gm))?e[0]:null}function ji(){this.g=0}function Wi(e,t,r){var n=(t=(t=ge(t)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(n[0]))throw new z(2,4,4015);t=0;for(var i=1;i<n.length;i++)if(!Vi.kd(n[i])){var a=Hi(e,n[i]);if(--e.g,Ki.includes(a.name)){t=1;break}"EXT-X-STREAM-INF"==a.name&&(i+=1)}for(i=[],a=1;a<n.length;)if(Vi.kd(n[a]))a+=1;else{var o=Hi(e,n[a]);if(Yi.includes(o.name)){if(1!=t)throw new z(2,4,4017);return new Li(r,t,i,e=Xi(e,r,n=n.splice(a,n.length-a),i))}i.push(o),a+=1,"EXT-X-STREAM-INF"==o.name&&(o.g.push(new Mi("URI",n[a])),a+=1)}return new Li(r,t,i)}function Xi(e,t,r,n){var i=[],a=[];return r.forEach((function(r){if(/^(#EXT)/.test(r))r=Hi(e,r),Ki.includes(r.name)?n.push(r):a.push(r);else{if(Vi.kd(r))return[];r=Vi.Sc(t,r.trim()),i.push(new Gi(r,a)),a=[]}})),i}function Hi(e,t){var r=e.g++,n=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!n)throw new z(2,4,4016,t);var i,a=n[1],o=n[2];if(n=[],o){var s;(s=Bi(o=new Ui(o),/^([^,=]+)(?:,|$)/g))&&(i=s[1]);for(var l=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;s=Bi(o,l);)n.push(new Mi(s[1],s[2]||s[3]))}return new Di(r,a,n,i)}var Ki="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST".split(" "),Yi="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE".split(" ");function zi(e){try{var t=zi.parse(e);return De({uri:e,Bd:e,data:t.data,headers:{"content-type":t.contentType}})}catch(r){return Oe(r)}}function Ji(){var e=this;this.g=this.j=null,this.ea=1,this.L=new Map,this.Z=new Set,this.h=new Map,this.i=null,this.F="",this.C=new ji,this.X=0,this.m=new Ce((function(){!function(e){y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return Y.info("Updating manifest..."),e.j?(k(t,2),A(t,e.update(),4)):t.return();case 4:r=e.X,e.m.V(r),C(t,0);break;case 2:if(n=P(t),!e.j)return t.return();n.severity=1,e.j.onError(n),e.m.V(.1),w(t)}}))}))}(e)})),this.l=ga,this.A=null,this.J=0,this.M=1/0,this.o=new We,this.P=[],this.u=new Map,this.da=!1}function Qi(e,t){return y((function r(){var n,i,a,o,s,l,u,c,d,h;return N(r,(function(r){switch(r.s){case 1:return n=Vi,i=va,a=t.We,A(r,ya(e,ze([a],e.g.retryParameters),0),2);case 2:if(o=r.B,1!=(s=Wi(e.C,o.data,o.uri)).type)throw new z(2,4,4017);return u=(l=n.cb(s.g,"EXT-X-MEDIA-SEQUENCE"))?Number(l.value):0,c=t.stream,A(r,oa(e,t.Pc,s,u,c.mimeType,c.codecs),3);case 3:d=r.B,t.fc.g=d,h=d[d.length-1],n.cb(s.g,"EXT-X-ENDLIST")&&(pa(e,i.$a),e.i.Fa(h.endTime)),w(r)}}))}))}function qi(e){e.forEach((function(e){if(e){var t=e.stream.codecs.split(",");t=t.filter((function(e){return"mp4a.40.34"!=e})),e.stream.codecs=t.join(",")}}))}function ea(e,t,r,n,i){return{id:e.ea++,language:t?t.language:"und",primary:!!t&&t.primary||!!r&&r.primary,audio:t,video:r,bandwidth:n,drmInfos:i,allowedByApplication:!0,allowedByKeySystem:!0}}function ta(e,t,r){return y((function n(){var i,a,o,s,l,u,c,d,h,f,p;return N(n,(function(n){switch(n.s){case 1:if(i=ua(t,"URI"),e.h.has(i))return n.return(e.h.get(i));if(a=ua(t,"TYPE").toLowerCase(),o=pe,"subtitles"==a&&(a=o.za),s=Mr(Ni(t,"LANGUAGE","und")),l=Ni(t,"NAME"),u=t.getAttribute("DEFAULT"),c="YES"==u,d=Ni(t,"CHANNELS"),"audio"==a)if(d){var y=d.split("/")[0];y=parseInt(y,10)}else y=null;else y=null;return h=y,f=Ni(t,"CHARACTERISTICS"),A(n,ra(e,i,r,a,s,c,l,h,null,f),2);case 2:return p=n.B,e.h.has(i)?n.return(e.h.get(i)):null==p?n.return(null):(e.L.set(t.id,p),e.h.set(i,p),n.return(p))}}))}))}function ra(e,t,r,n,i,a,o,s,l,u){return y((function c(){var d,h,p,m,g,v,b,_,E,T,S,$,w,I,x,R,O,L,D,M,G,V,U,Z,B,F,j,W;return N(c,(function(c){switch(c.s){case 1:return h=(d=Vi).Sc(e.F,t),A(c,ya(e,ze([h],e.g.retryParameters),0),2);case 2:if(p=c.B,h=p.uri,1!=(m=Wi(e.C,p.data,h)).type)throw new z(2,4,4017);g=[],m.segments.forEach((function(e){e=d.Ab(e.h,"EXT-X-KEY"),g.push.apply(g,e)})),v=!1,b=[],_=null;for(var X=f(g),H=X.next();!H.done;H=X.next())if(E=H.value,"NONE"!=(T=ua(E,"METHOD"))){if(v=!0,"AES-128"==T)return Y.v("Unsupported HLS Encryption",T),e.da=!0,c.return(null);S=ua(E,"KEYFORMAT"),(w=($=ma[S])?$(E):null)?(w.keyIds.length&&(_=w.keyIds[0]),b.push(w)):Y.v("Unsupported HLS KEYFORMAT",S)}if(v&&!b.length)throw new z(2,4,4026);return function(e,t){var r=va,n=Vi.cb(t.g,"EXT-X-PLAYLIST-TYPE"),i=Vi.cb(t.g,"EXT-X-ENDLIST");i=n&&"VOD"==n.value||i,n=n&&"EVENT"==n.value&&!i,n=!i&&!n,i?pa(e,r.$a):(pa(e,n?r.Wd:r.Se),r=ca(t.g,"EXT-X-TARGETDURATION"),r=Number(r.value),e.J=Math.max(r,e.J),e.M=Math.min(r,e.M))}(e,m),I=function(e,t){if(1==t.length)return t[0];var r=la(e,t);if(null!=r)return r;throw new z(2,4,4025,t)}(n,r),A(c,function(e,t,r,n){return y((function i(){var a,o,s,l,u,c,d,h,f,p;return N(i,(function(i){switch(i.s){case 1:return a=pe,o=n.segments[0].g,s=new Q(o),l=s.pa.split(".").pop(),u=fa[t],(c=u[l])?i.return(c):t==a.za?r&&"vtt"!=r&&"wvtt"!=r?i.return("application/mp4"):i.return("text/vtt"):((d=ze([o],e.g.retryParameters)).method="HEAD",A(i,ya(e,d,1),2));case 2:return h=i.B,(f=h.headers["content-type"])?i.return(f.split(";")[0]):(p=u.mp4,i.return(p))}}))}))}(e,n,I,m),3);case 3:return x=c.B,ha.includes(x)&&(I=""),O=(R=d.cb(m.g,"EXT-X-MEDIA-SEQUENCE"))?Number(R.value):0,k(c,4),A(c,oa(e,t,m,O,x,I),6);case 6:L=c.B,C(c,5);break;case 4:if(4035==(D=P(c)).code)return Y.ba("Skipping unsupported HLS stream",x,t),c.return(null);throw D;case 5:if(M=L[0].startTime,G=L[L.length-1].endTime,V=G-M,U=new oi(L),Z=na(m),B=void 0,"text"==n&&(B="subtitle"),F=[],u)for(H=(X=f(u.split(","))).next();!H.done;H=X.next())j=H.value,F.push(j);return W={id:e.ea++,originalId:o,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:U.find.bind(U),getSegmentReference:U.get.bind(U),initSegmentReference:Z,presentationTimeOffset:0,mimeType:x,codecs:I,kind:B,encrypted:v,keyId:_,language:i,label:o,type:n,primary:a,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:F,channelsCount:s,audioSamplingRate:null,closedCaptions:l},c.return({stream:W,fc:U,drmInfos:b,Pc:t,We:h,td:M,Yg:G,duration:V})}}))}))}function na(e){var t=Vi.Ab(e.g,"EXT-X-MAP");if(!t.length)return null;if(1<t.length)throw new z(2,4,4020);var r=ua(t=t[0],"URI"),n=Vi.Sc(e.h,r);return e=0,r=null,(t=Ni(t,"BYTERANGE"))&&(e=t.split("@"),t=Number(e[0]),r=(e=Number(e[1]))+t-1),new ni((function(){return[n]}),e,r)}function ia(e,t,r,n){var i=t.h,a=t.g;t=ca(i,"EXTINF").value.split(","),t=n+Number(t[0]);var o=0,s=null;return(i=Vi.cb(i,"EXT-X-BYTERANGE"))&&(o=i.value.split("@"),i=Number(o[0]),s=(o=o[1]?Number(o[1]):e.g+1)+i-1),new ii(r,n,t,(function(){return[a]}),o,s)}function aa(e){e.i&&(e.P.forEach((function(t){e.i.Jb(t,0)})),e.P=[])}function oa(e,t,r,n,i,a){return y((function o(){var s,l,u,c,d,h,f,p,m,g;return N(o,(function(o){switch(o.s){case 1:return s=r.segments,l=[],u=s[0].g,c=ia(null,s[0],n,0),d=na(r),A(o,function(e,t,r,n,i,a){return y((function o(){var s,l,u,c,d,h,f,p,y;return N(o,(function(o){switch(o.s){case 1:if(e.A){if(s=e.h.get(t),l=s.fc,u=l.get(n.position))return Y.K("Found segment start time in previous manifest"),o.return(u.startTime);Y.debug("Unable to find segment start time in previous manifest!")}if(Y.K("Fetching segment to find start time"),i=i.toLowerCase(),ha.includes(i))throw Y.ba("Raw formats are not yet supported.  Skipping "+i),new z(1,4,4035);if("video/webm"==i)throw Y.ba("WebM in HLS is not yet supported.  Skipping."),new z(1,4,4035);if("video/mp4"!=i&&"audio/mp4"!=i){o.I(2);break}return c=[sa(e,n)],r&&c.push(sa(e,r)),A(o,Promise.all(c),3);case 3:return d=o.B,h=d[0],f=d[1]||d[0],o.return(function(e,t,r,n){var i=0;if((new Gn).box("moov",Vn).box("trak",Vn).box("mdia",Vn).ma("mdhd",(function(e){e.reader.U(0==e.version?8:16),i=e.reader.N(),e.parser.stop()})).parse(n,!0),!i)throw Y.error("Unable to find timescale in init segment!"),new z(2,4,4030,e,t);var a=0,o=!1;if((new Gn).box("moof",Vn).box("traf",Vn).ma("tfdt",(function(e){a=(0==e.version?e.reader.N():e.reader.Pb())/i,o=!0,e.parser.stop()})).parse(r,!0),!o)throw new z(2,4,4030,e,t);return a}(t,h.uri,h.data,f.data));case 2:if("video/mp2t"!=i){o.I(4);break}return A(o,sa(e,n),5);case 5:return p=o.B,o.return(function(e,t,r){function n(){a.seek(o+188),71!=(s=a.ra())&&(a.seek(o+192),s=a.ra()),71!=s&&(a.seek(o+204),s=a.ra()),71!=s&&i(),a.Fe(1)}function i(){throw new z(2,4,4030,e,t)}for(var a=new Dn(new DataView(r),0),o=0,s=0;;)if(o=a.ka(),71!=(s=a.ra())&&i(),8191==(8191&(r=a.dc())))n();else if(16384&r){if(0!=(r=(48&a.ra())>>4)&&2!=r||i(),3==r&&(r=a.ra(),a.U(r)),1==a.N()>>8)return a.U(3),0!=(r=a.ra()>>6)&&1!=r||i(),0==a.ra()&&i(),(1073741824*((14&(r=a.ra()))>>1)+((65534&a.dc())<<14|(65534&a.dc())>>1))/9e4;n()}else n()}(t,p.uri,p.data));case 4:if("application/mp4"!=i&&!i.startsWith("text/")){o.I(6);break}return A(o,sa(e,n),7);case 7:return y=o.B,o.return(function(e,t,r){return gr(e=ct(e,t))?(vr(t=new yr(null),e),t.xc(r)):0}(i,a,y.data));case 6:throw new z(2,4,4030,t)}}))}))}(e,t,d,c,i,a),2);case 2:h=o.B,Y.debug("First segment",u.split("/").pop(),"starts at",h);for(var v=0;v<s.length;++v)f=s[v],p=l[l.length-1],m=0==v?h:p.endTime,g=ia(p,f,n+v,m),l.push(g);return e.P.push(l),aa(e),o.return(l)}}))}))}function sa(e,t){return y((function r(){var n,i,a,o,s,l;return N(r,(function(r){switch(r.s){case 1:return n=1,i=$i(t.i(),t.h,t.h+2048-1,e.g.retryParameters),a=$i(t.i(),t.h,t.g,e.g.retryParameters),e.g.hls.useFullSegmentsForStartTime?r.return(ya(e,a,n)):(k(r,2),A(r,ya(e,i,n),4));case 4:return o=r.B,r.return(o);case 2:if(7001==(s=P(r)).code)throw s;return Y.ba("Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",i.uris[0]),A(r,ya(e,a,n),5);case 5:return l=r.B,r.return(l)}}))}))}function la(e,t){for(var r=da[e],n=0;n<r.length;n++)for(var i=0;i<t.length;i++)if(r[n].test(t[i].trim()))return t[i].trim();return"text"==e?"":null}function ua(e,t){var r=e.getAttribute(t);if(!r)throw new z(2,4,4023,t);return r.value}function ca(e,t){var r=Vi.cb(e,t);if(!r)throw new z(2,4,4024,t);return r}F("shaka.net.DataUriPlugin",zi),zi.parse=function(e){var r=e.split(":");if(2>r.length||"data"!=r[0])throw Y.error("Bad data URI, failed to parse scheme"),new z(2,1,1004,e);if(2>(r=r.slice(1).join(":").split(",")).length)throw Y.error("Bad data URI, failed to extract encoding and MIME type"),new z(2,1,1004,e);var n=r[0];e=t.decodeURIComponent(r.slice(1).join(",")),r=n.split(";"),n=r[0];var i=!1;return 1<r.length&&"base64"==r[r.length-1]&&(i=!0,r.pop()),{data:i?$e.Ja(e).buffer:_e(e),contentType:n}},Ye("data",zi),F("shaka.hls.HlsParser",Ji),(i=Ji.prototype).configure=function(e){this.g=e},i.start=function(e,t){var r=this;return y((function n(){var i,a;return N(n,(function(n){switch(n.s){case 1:return r.j=t,A(n,ya(r,ze([e],r.g.retryParameters),0),2);case 2:return i=n.B,r.F=i.uri,A(n,function(e,t){return y((function r(){var n,i,a,o,s,l,u,c,d,h,p;return N(r,(function(r){switch(r.s){case 1:if(0!=(n=Wi(e.C,t,e.F)).type)throw new z(2,4,4022);return A(r,function(e,t){return y((function r(){var n,i,a,o,s,l,u,c,d,h,p,m;return N(r,(function(r){switch(r.s){case 1:return n=Vi,i=de,a=t.g,o=n.Ab(t.g,"EXT-X-MEDIA"),s=o.filter(function(e){return"SUBTITLES"==ua(e,"TYPE")}.bind(e)),l=s.map(function(e){var t=this;return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return t.g.disableText?r.return(null):(k(r,2),A(r,function(e,t){return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return ua(t,"TYPE"),A(r,ta(e,t,[]),2);case 2:return n=r.B,r.return(n.stream)}}))}))}(t,e),4));case 4:return r.return(r.B);case 2:if(n=P(r),t.g.hls.ignoreTextStreamFailures)return r.return(null);throw n}}))}))}.bind(e)),u=o.filter((function(e){return"CLOSED-CAPTIONS"==ua(e,"TYPE")})),function(e,t){for(var r=f(t),n=r.next();!n.done;n=r.next()){ua(n=n.value,"TYPE");var i=Ni(n,"LANGUAGE")||"und";i=Mr(i);var a=ua(n,"GROUP-ID");n=ua(n,"INSTREAM-ID"),e.u.get(a)||e.u.set(a,new Map),e.u.get(a).set(n,i)}}(e,u),A(r,Promise.all(l),2);case 2:return c=r.B,d=n.Ab(a,"EXT-X-STREAM-INF"),h=d.map(function(e){return function(e,t,r){return y((function n(){var i,a,o,s,l,u,c,d,h,p,m,g,v,b,_,E,T,S,$,w,k,I,C,P,x,R,O,L,D;return N(n,(function(n){switch(n.s){case 1:return i=pe,a=Vi,o=[],e.g.disableVideo||o.push("avc1.42E01E"),e.g.disableAudio||o.push("mp4a.40.2"),s=o.join(","),l=Ni(t,"CODECS",s),u=function(e){for(var t=new Set,r=[],n=(e=f(e)).next();!n.done;n=e.next()){var i=ht(n=n.value)[0];t.has(i)?Y.debug("Ignoring duplicate codec"):(r.push(n),t.add(i))}return r}(l.split(/\s*,\s*/)),c=t.getAttribute("RESOLUTION"),h=d=null,p=Ni(t,"FRAME-RATE"),m=Number(Ni(t,"AVERAGE-BANDWIDTH"))||Number(ua(t,"BANDWIDTH")),c&&(g=c.value.split("x"),d=g[0],h=g[1]),v=(v=a.Ab(r.g,"EXT-X-MEDIA")).filter((function(e){return"CLOSED-CAPTIONS"!=ua(e,"TYPE")})),v=v.filter((function(e){var t=Ni(e,"URI")||"";return"SUBTITLES"==(Ni(e,"TYPE")||"")||""!=t})),b=Ni(t,"AUDIO"),_=Ni(t,"VIDEO"),b?v=a.Zc(v,"AUDIO",b):_&&(v=a.Zc(v,"VIDEO",_)),(E=la(i.za,u))&&((T=Ni(t,"SUBTITLES"))&&(S=a.Zc(v,"SUBTITLES",T)).length&&($=e.L.get(S[0].id))&&($.stream.codecs=E),Fe(u,E)),w=v.map(function(e){return ta(this,e,u)}.bind(e)),k=[],I=[],A(n,Promise.all(w),2);case 2:if(P=(P=n.B).filter((function(e){return null!=e})),b?k=P:_&&(I=P),Y.debug("Guessing stream type for",t.toString()),R=!1,k.length||I.length?k.length?(L=ua(t,"URI"),D=k[0].Pc,L==D?(Y.debug("Guessing audio-only."),x=i.Sb,R=!0):(Y.debug("Guessing video."),x=i.Za)):(Y.debug("Guessing audio."),x=i.Sb):1==u.length?(O=la(i.Za,u),c||p||O?(Y.debug("Guessing video-only."),x=i.Za):(Y.debug("Guessing audio-only."),x=i.Sb)):(Y.debug("Guessing multiplexed audio+video."),x=i.Za,u=[u.join(",")]),R){n.I(3);break}return A(n,function(e,t,r,n){return y((function i(){var a,o,s,l,u;return N(i,(function(i){switch(i.s){case 1:return a=pe,o=ua(t,"URI"),e.h.has(o)?i.return(e.h.get(o)):(s=Ni(t,"CLOSED-CAPTIONS"),l=null,n==a.Za&&s&&"NONE"!=s&&(l=e.u.get(s)),A(i,ra(e,o,r,n,"und",!1,null,null,l,null),2));case 2:return null==(u=i.B)?i.return(null):e.h.has(o)?i.return(e.h.get(o)):(e.h.set(o,u),i.return(u))}}))}))}(e,t,u,x),4);case 4:C=n.B;case 3:if(C)C.stream.type==i.Sb?k=[C]:I=[C];else if(null===C)return Y.debug("streamInfo is null"),n.return([]);return I&&qi(I),k&&qi(k),n.return(function(e,t,r,n,i,a,o){r.forEach(function(e){(e=e.stream)&&(e.width=Number(i)||void 0,e.height=Number(a)||void 0,e.frameRate=Number(o)||void 0)}.bind(e));var s=!!e.g&&e.g.disableAudio;t.length&&!s||(t=[null]),s=!!e.g&&e.g.disableVideo,(!r.length||s)&&(r=[null]),s=[];for(var l=(t=f(t)).next();!l.done;l=t.next()){l=l.value;for(var u=f(r),c=u.next();!c.done;c=u.next()){var d=c.value;c=l?l.stream:null;var h=d?d.stream:null,p=l?l.drmInfos:null,y=d?d.drmInfos:null;d=(d?d.Pc:"")+" - "+(l?l.Pc:"");var m=void 0;if(c&&h){if(p.length&&y.length&&!(0<Vt(p,y).length)){Y.v("Incompatible DRM info in HLS variant.  Skipping.");continue}m=Vt(p,y)}else c?m=p:h&&(m=y);e.Z.has(d)?Y.debug("Skipping variant which only differs in text streams."):(c=ea(e,c,h,n,m),s.push(c),e.Z.add(d))}}return s}(e,k,I,m,d,h,p))}}))}))}(this,e,t)}.bind(e)),A(r,Promise.all(h),3);case 3:return p=r.B,m=(m=p.reduce(i.Rc,[])).filter((function(e){return null!=e})),r.return({startTime:0,variants:m,textStreams:c.filter((function(e){return null!=e}))})}}))}))}(e,n),2);case 2:if(i=r.B,!e.j)throw new z(2,7,7001);if(e.da&&0==i.variants.length)throw Y.info("No stream is created, because we don't support AES-128","encryption yet"),new z(2,4,4034);e.j.filterAllPeriods([i]),a=1/0,o=0,s=1/0;for(var m=f(e.h.values()),g=m.next();!g.done;g=m.next())l=g.value,a=Math.min(a,l.td),o=Math.max(o,l.td),"text"!=l.stream.type&&(s=Math.min(s,l.duration));if(e.l!=va.$a?(e.i=new Si(0,3*e.J),e.i.hc(!1)):(e.i=new Si(null,0),e.i.hc(!0)),aa(e),e.l!=va.$a){for(e.X=e.M,u=va,e.l==u.Wd&&(c=e.i.Ic,isNaN(e.g.availabilityWindowOverride)||(c=e.g.availabilityWindowOverride),e.i.Pd(c)),d=0;95443.7176888889<=o;)d+=95443.7176888889,o-=95443.7176888889;if(d)for(Y.debug("Offsetting live streams by",d,"to compensate for rollover"),g=(m=f(e.h.values())).next();!g.done;g=m.next())95443.7176888889>(h=g.value).td?(Y.K("Offset applied to",h.stream.type),h.stream.presentationTimeOffset=-d,h.fc.offset(d)):Y.K("Offset NOT applied to",h.stream.type)}else for(e.i.Fa(s),e.i.offset(-a),g=(m=f(e.h.values())).next();!g.done;g=m.next())(p=g.value).stream.presentationTimeOffset=a,p.fc.offset(-a),si(p.fc,s);e.A={presentationTimeline:e.i,periods:[i],offlineSessionIds:[],minBufferTime:0},w(r)}}))}))}(r,i.data),3);case 3:return 0<(a=r.X)&&r.m.V(a),n.return(r.A)}}))}))},i.stop=function(){this.m&&(this.m.stop(),this.m=null);var e=[];return this.o&&(e.push(this.o.destroy()),this.o=null),this.g=this.j=null,this.L.clear(),this.Z.clear(),this.h.clear(),this.A=null,Promise.all(e)},i.update=function(){if(this.l!=va.$a){for(var e=[],t=f(this.h.values()),r=t.next();!r.done;r=t.next())e.push(Qi(this,r.value));return Promise.all(e)}},i.onExpirationUpdated=function(){};var da={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]},ha=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],fa={audio:{mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},video:{mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"}};function pa(e,t){e.l=t,e.i&&e.i.hc(e.l==va.$a),e.l!=va.$a||e.m.stop()}function ya(e,t,r){if(!e.o)throw new z(2,7,7001);return t=e.j.networkingEngine.request(r,t),Xe(e.o,t),t.promise}var ma={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=ua(e,"METHOD");jr("HLS SAMPLE-AES-CENC","SAMPLE-AES-CENC will no longer be supported, see Issue #1227");var r=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];return r.includes(t)?(t=ua(e,"URI"),t=zi.parse(t),t=fe("com.widevine.alpha",[{initDataType:"cenc",initData:t=new Uint8Array(t.data)}]),(e=Ni(e,"KEYID"))&&(t.keyIds=[e.toLowerCase().substr(2)]),t):(Y.error("Widevine in HLS is only supported with [",r.join(", "),"], not",t),null)}},ga="VOD",va={$a:ga,Se:"EVENT",Wd:"LIVE"};function ba(){this.g=new Map}function _a(e,t,r){Ea(e,t).text=r}function Ea(e,t){return e.g.has(t)||e.g.set(t,new Ta),e.g.get(t)}function Ta(){this.text=this.variant=null}function Sa(e,t){this.g=e,this.h=new Set([e]);for(var r=f(t=t||[]),n=r.next();!n.done;n=r.next())this.add(n.value)}function $a(e,t){var r;if(!(r=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(r=e.audio&&t.audio)){r=e.audio;var n=t.audio;r=!(r.channelsCount==n.channelsCount&&Aa(r,n)&&wa(r.roles,n.roles))}return!r&&(r=e.video&&t.video)&&(r=!(Aa(r=e.video,n=t.video)&&wa(r.roles,n.roles))),!r}function Aa(e,t){if(e.mimeType!=t.mimeType)return!1;var r=e.codecs.split(",").map((function(e){return ht(e)[0]})),n=t.codecs.split(",").map((function(e){return ht(e)[0]}));if(r.length!=n.length)return!1;r.sort(),n.sort();for(var i=0;i<r.length;i++)if(r[i]!=n[i])return!1;return!0}function wa(e,t){var r=new Set(e),n=new Set(t);if(r.delete("main"),n.delete("main"),r.size!=n.size)return!1;for(var i=(r=f(r)).next();!i.done;i=r.next())if(!n.has(i.value))return!1;return!0}function ka(e){this.g=e,this.h=new Ia(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")}function Ia(e,t,r,n){this.i=e,this.j=t,this.g=r,this.h=void 0===n?"":n}function Ca(){this.g=Ra,this.h=(new Map).set(Ra,2).set(xa,1)}function Pa(e,t,r){e.h.set(Ra,r).set(xa,t)}Ti.Fd("m3u8",Ji),Ti.Qb("application/x-mpegurl",Ji),Ti.Qb("application/vnd.apple.mpegurl",Ji),Sa.prototype.add=function(e){return $a(this.g,e)?(this.h.add(e),!0):(Y.v("Rejecting variant - not compatible with root."),!1)},Sa.prototype.values=function(){return this.h.values()},ka.prototype.create=function(e){var t=this,r=e.filter((function(e){return $a(t.g,e)}));return r.length?new Sa(r[0],r):this.h.create(e)},Ia.prototype.create=function(e){var t=[];t=function(e,t){var r=Gr(Mr(t),e.map((function(e){return Nr(e)})));return r?e.filter((function(e){return r==Nr(e)})):[]}(e,this.i);var r=e.filter((function(e){return e.primary}));for((e=function(e,t){return e.filter((function(e){return!!e.audio&&(t?e.audio.roles.includes(t):0==e.audio.roles.length)}))}(t=t.length?t:r.length?r:e,this.j)).length?t=e:Y.v("No exact match for variant role could be found."),this.g&&((e=Ur.ee(t,this.g)).length?t=e:Y.v("No exact match for the channel count could be found.")),this.h&&(e=function(e,t){return e.filter((function(e){return!!e.audio&&e.audio.label.toLowerCase()==t.toLowerCase()}))}(t,this.h),e.length?t=e:Y.v("No exact match for variant label could be found.")),e=new Sa(t[0]),r=(t=f(t)).next();!r.done;r=t.next())r=r.value,$a(e.g,r)&&e.add(r);return e};var xa=0,Ra=1;function Oa(e,t){this.l=e,this.m=Da(e),this.g=e.g.currentTime,this.j=Date.now()/1e3,this.h=!1,this.o=t,this.i=function(){}}function La(e){this.g=e}function Da(e){if(e.g.paused||0==e.g.playbackRate||0==e.g.buffered.length)var t=!1;else e:{t=e.g.buffered,e=e.g.currentTime;for(var r=0;r<t.length;r++){var n=t.start(r),i=t.end(r);if(!(e<n-.1||e>i-.5)){t=!0;break e}}t=!1}return t}function Ma(e,t,r,n,i){var a=this;this.g=e,this.F=t,this.C=r,this.u=i,this.j=new tt,this.o=!1,this.A=e.readyState,this.i=!1,this.h=n,this.m=!1,this.j.H(e,"waiting",(function(){return Na(a)})),this.l=new Ce((function(){Na(a)})).Oa(.25)}function Na(e){if(0!=e.g.readyState){if(e.g.seeking){if(!e.o)return}else e.o=!1;if(!e.g.paused||0==e.g.currentTime){var t;if(e.g.readyState!=e.A&&(e.i=!1,e.A=e.g.readyState),!(t=!e.h)){var r=(t=e.h).l,n=Da(r),i=r.g.currentTime,a=Date.now()/1e3;t.g==i&&t.m==n||(t.j=a,t.g=i,t.m=n,t.h=!1),(n=(i=a-t.j)>=t.o&&n&&!t.h)&&(t.i(t.g,i),t.h=!0,t.g=r.g.currentTime),t=!n}if(t){a=e.C.smallGapLimit,t=e.g.currentTime;e:{if((r=e.g.buffered)&&r.length&&!(1==r.length&&1e-6>r.end(0)-r.start(0)))for(n=navigator.userAgent.match(/Edge\//)||bt("Trident/")||mt()||bt("CrKey")?.5:.1,i=0;i<r.length;i++)if(r.start(i)>t&&(0==i||r.end(i-1)-t<=n)){n=i;break e}n=null}if(null!=n&&(0!=n||e.m)){i=r.start(n);var o=e.F.Ka();if(!(i>=o)){a=(o=i-t)<=a;var s=!1;if(!(.001>o)){if(!a&&!e.i){e.i=!0;var l=new Ge("largegap",{currentTime:t,gapSize:o});l.cancelable=!0,e.u(l),e.C.jumpLargeGaps&&!l.defaultPrevented?s=!0:Y.info("Ignoring large gap at",t,"size",o)}(a||s)&&(0==n?Y.info("Jumping forward",o,"seconds because of gap before start time of",i):Y.info("Jumping forward",o,"seconds because of gap starting at",r.end(n-1),"and ending at",i),e.g.currentTime=i)}}}}}}}function Ga(e){var t=this;this.i=e,this.g=new Set,this.h=new Ce((function(){Va(t,!1)})).Oa(.25)}function Va(e,t){for(var r=f(e.g),n=r.next();!n.done;n=r.next())n.value.l(e.i.currentTime,t)}function Ua(e){for(var t=[],r=(e=f(e)).next();!r.done;r=e.next())for(var n=(r=f(r.value.variants)).next();!n.done;n=r.next())t.push(n.value);return t}function Za(e,t){for(var r=null,n=f(e),i=n.next();!i.done;i=n.next())t>=(i=i.value).startTime&&(r=i);return r}function Ba(e){this.i=e,this.g=null,this.h=function(){}}function Fa(e){var t=this;this.g=e,this.j=!1,this.i=this.g.wc(),this.h=new Ce((function(){t.g.pe(.25*t.i)}))}function ja(e){e.h.stop();var t=e.j?0:e.i;if(0<=t)try{return void(e.g.wc()!=t&&e.g.Od(t))}catch(r){}e.h.Oa(.25),0!=e.g.wc()&&e.g.Od(0)}function Wa(e,t,r,n){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?n():(t=Xa.get(t),r.ya(e,t,n))}Oa.prototype.release=function(){this.l=null,this.i=function(){}},Ma.prototype.release=function(){this.j&&(this.j.release(),this.j=null),null!=this.l&&(this.l.stop(),this.l=null),this.h&&(this.h.release(),this.h=null),this.g=this.F=this.u=null},Ma.prototype.zd=function(){this.m=!0,Na(this)},Ga.prototype.release=function(){this.h.stop();for(var e=f(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g.clear()},Ba.prototype.release=function(){this.g=this.i=null,this.h=function(){}},Ba.prototype.l=function(e){var t=this.g,r=this.i.periods;t!=(e=Za(r,e)||r[0])&&this.h(e),this.g=e},Fa.prototype.release=function(){this.h&&(this.h.stop(),this.h=null),this.g=null},Fa.prototype.set=function(e){this.i=e,ja(this)},Fa.prototype.vc=function(){return this.g.vc()};var Xa=new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Ha(e,t,r){var n=this;this.g=e,this.l=t,this.j=r,this.m=!1,this.h=new tt,this.i=new Qa(e),Wa(this.g,HTMLMediaElement.HAVE_METADATA,this.h,(function(){za(n,n.j)}))}function Ka(e){return e.m?e.g.currentTime:e.j}function Ya(e,t){0<e.g.readyState?qa(e.i,t):Wa(e.g,HTMLMediaElement.HAVE_METADATA,e.h,(function(){za(e,e.j)}))}function za(e,t){.001>Math.abs(e.g.currentTime-t)?Ja(e):(e.h.ya(e.g,"seeking",(function(){Ja(e)})),qa(e.i,0==e.g.currentTime?t:e.g.currentTime))}function Ja(e){e.m=!0,e.h.H(e.g,"seeking",(function(){return e.l()}))}function Qa(e){var t=this;this.h=e,this.m=10,this.l=this.i=this.j=0,this.g=new Ce((function(){0>=t.j?(Y.v(["Failed to move playhead from",t.i,"to",t.l].join(" ")),t.g.stop()):t.h.currentTime!=t.i?t.g.stop():(t.h.currentTime=t.l,t.j--)}))}function qa(e,t){e.i=e.h.currentTime,e.l=t,e.j=e.m,e.h.currentTime=t,e.g.Oa(.1)}function eo(e){var t=this;this.g=e,this.j=!1,this.i=null,this.h=new tt,Wa(this.g,HTMLMediaElement.HAVE_CURRENT_DATA,this.h,(function(){null==t.i?t.j=!0:(t.h.ya(t.g,"seeking",(function(){t.j=!0})),t.g.currentTime=Math.max(0,t.g.currentTime+t.i))}))}function to(e,t,r,n,i,a){var o=this;this.i=e,this.g=t.presentationTimeline,this.J=t.minBufferTime||0,this.m=r,this.F=i,this.u=null,this.j=new Ma(e,t.presentationTimeline,r,function(e,t){if(!t.stallEnabled)return null;var r=t.stallSkip,n=new Oa(new La(e),t.stallThreshold);return function(e,t){e.i=t}(n,(function(t,n){Y.debug("Stall detected at "+t+" for "+n+" seconds."),r?(Y.debug("Seeking forward "+r+" seconds to break stall."),e.currentTime+=r):(Y.debug("Pausing and unpausing to break stall."),e.pause(),e.play())})),n}(e,r),a),this.h=new Ha(e,(function(){e:{var e=o.j;e.o=!0,e.m=!1,e.i=!1,e=Ka(o.h);var t=no(o,e);if(.001<Math.abs(t-e)){var r=Date.now()/1e3;if(!o.u||o.u<r-1){o.u=r,Ya(o.h,t),e=void 0;break e}}Y.K("Seek to "+e),o.F(),e=void 0}return e}),function(e,t){return null==t?t=1/0>e.g.ha()?e.g.Cb():e.g.Ka():0>t&&(t=e.g.Ka()+t),ro(e,io(e,t))}(this,n)),this.o=new Ce((function(){if(0!=o.i.readyState&&!o.i.paused){var e=Ka(o.h),t=o.g.Cb(),r=o.g.Ka();3>r-t&&(t=r-3),e<t&&(t=no(o,e),Y.info("Jumping forward "+(t-e)+" seconds to catch up with the seek range."),o.i.currentTime=t)}})).Oa(.25)}function ro(e,t){var r=e.g.ha();return t>=r?r-e.m.durationBackoff:t}function no(e,t){var r=Yt.bind(null,e.i.buffered),n=Math.max(e.J,e.m.rebufferingGoal),i=e.m.safeSeekOffset,a=e.g.Cb(),o=e.g.Ka(),s=e.g.ha();3>o-a&&(a=o-3);var l=e.g.Zb(n),u=e.g.Zb(i);return n=e.g.Zb(n+i),t>=s?(Y.K("Playhead past duration."),ro(e,t)):t>o?(Y.K("Playhead past end."),o):t<a?r(u)?(Y.K("Playhead before start & start is buffered"),u):(Y.K("Playhead before start & start is unbuffered"),n):t>=l||r(t)?(Y.K("Playhead in safe region or in buffered region."),t):(Y.K("Playhead outside safe region & in unbuffered region."),n)}function io(e,t){var r=e.g.Cb();return t<r||t>(r=e.g.Ka())?r:t}function ao(e){var t=this;this.h=function(){},this.g=new Set,this.j=e,this.i=new Ce((function(){for(var e=t.j(),r=f(t.g),n=r.next();!n.done;n=r.next())(n=n.value).endTime<e.start&&t.g.delete(n)})).Oa(2)}function oo(e){var t=this;this.m=e,this.j=new Map,this.g=function(){},this.h=function(){},this.i=function(){},this.o=[{rb:null,qb:lo,hb:function(e,r){return t.g(e,r)}},{rb:so,qb:lo,hb:function(e,r){return t.g(e,r)}},{rb:uo,qb:lo,hb:function(e,r){return t.g(e,r)}},{rb:lo,qb:so,hb:function(e,r){return t.h(e,r)}},{rb:lo,qb:uo,hb:function(e,r){return t.h(e,r)}},{rb:so,qb:uo,hb:function(e,r){return t.i(e,r)}},{rb:uo,qb:so,hb:function(e,r){return t.i(e,r)}}]}Ha.prototype.release=function(){this.h&&(this.h.release(),this.h=null),null!=this.i&&(this.i.release(),this.i=null),this.l=function(){},this.g=null},Qa.prototype.release=function(){this.g&&(this.g.stop(),this.g=null),this.h=null},eo.prototype.release=function(){this.h&&(this.h.release(),this.h=null),this.g=null},eo.prototype.A=function(e){this.i=this.j?this.i:e},eo.prototype.l=function(){return(this.j?this.g.currentTime:this.i)||0},eo.prototype.C=function(){},to.prototype.release=function(){this.h&&(this.h.release(),this.h=null),this.j&&(this.j.release(),this.j=null),this.o&&(this.o.stop(),this.o=null),this.i=this.h=this.g=this.m=null,this.F=function(){}},to.prototype.A=function(e){Ya(this.h,e)},to.prototype.l=function(){var e=Ka(this.h);return 0<this.i.readyState&&!this.i.paused?io(this,e):e},to.prototype.C=function(){this.j.zd()},ao.prototype.release=function(){this.h=function(){},this.g.clear(),this.i.stop()},oo.prototype.release=function(){this.m=null,this.j.clear(),this.g=function(){},this.h=function(){},this.i=function(){}},oo.prototype.l=function(e,t){for(var r=f(this.m.g),n=r.next();!n.done;n=r.next()){n=n.value;var i=this.j.get(n),a=e<n.startTime?so:e>n.endTime?uo:lo;this.j.set(n,a);for(var o=f(this.o),s=o.next();!s.done;s=o.next())(s=s.value).rb==i&&s.qb==a&&s.hb(n,t)}};var so=1,lo=2,uo=3;function co(e,t){this.g=t,this.i=e,this.l=null,this.u=1,this.F=Promise.resolve(),this.m=[],this.o=new Map,this.h=new Map,this.C=!1,this.M=null,this.L=this.j=this.A=!1,this.J=0}function ho(e){return po(e,"audio")}function fo(e){return po(e,"video")}function po(e,t){var r=e.h.get(t);return r?r.Ta||r.stream:null}function yo(e,t){return y((function r(){var n,i,a,o,s,l,u,c,d;return N(r,(function(r){switch(r.s){case 1:return n=pe,A(r,Pr(e.g.T,n.za),2);case 2:return e.J++,e.L=!1,i=e.J,a=e.g.T,o=new Map,s=new Set,o.set(n.za,t),s.add(t),A(r,a.init(o,!1),3);case 3:return e.j?r.return():A(r,So(e,s),4);case 4:if(e.j)return r.return();l=e.g.T.l.isTextVisible()||e.l.alwaysStreamText,e.J!=i||e.h.has(n.za)||e.L||!l||(u=e.g.eb(),c=xo(e,u),d=Eo(t,c,0),e.h.set(n.za,d),Do(e,d,0)),w(r)}}))}))}function mo(e,t){var r=e.h.get("video");if(r){var n=r.stream;if(n)if(Y.debug("setTrickPlay",t),t){var i=n.trickModeVideo;i&&!r.Ta&&(Y.debug("Engaging trick mode stream",i),vo(e,i,!1,0,!1),r.Ta=n)}else(n=r.Ta)&&(Y.debug("Restoring non-trick-mode stream",n),r.Ta=null,vo(e,n,!0,0,!1))}}function go(e,t,r,n){var i=!1;if(t.video){var a=vo(e,t.video,r,n,!1);i=i||a}return t.audio&&(e=vo(e,t.audio,r,n,!1),i=i||e),i}function vo(e,t,r,n,i){var a=e.h.get(t.type);if(!a&&"text"==t.type&&e.l.ignoreTextStreamFailures)return yo(e,t),!0;if(!a)return!1;var o=Ro(e,t),s=Array.from(e.h.values()).every((function(e){return e.oa==a.oa}));return r&&o!=a.oa&&s?(Y.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),e.h.forEach((function(t){bo(e,t)})),!0):(a.Ta&&(Y.debug("switch during trick play mode",t),t.trickModeVideo?(a.Ta=t,t=t.trickModeVideo,Y.debug("switch found trick play stream",t)):(a.Ta=null,Y.debug("switch found no special trick play stream"))),!(!(s=e.m[o])||!s.Rb||!(s=e.o.get(t.id))||!s.Rb||(a.stream!=t||i?("text"==t.type&&Sr(e.g.T,ct(t.mimeType,t.codecs)),a.stream=t,a.Ac=!0,Y.debug("switch: switching to Stream "+Vo(a)),function(e,t,r){if(!t.lb)return!1;var n=e.g.eb(),i=wr(e.g.T,t.type),a=wo(e,t,n,i,r);return r=a&&a.g?a.g-a.h:null,a&&!r&&(r=(a.endTime-a.xc())*t.stream.bandwidth/8),!isNaN(r)&&((a=t.stream.initSegmentReference)&&(r+=(a.g?a.g-a.h:null)||0),a=e.g.getBandwidthEstimate(),8*r/a<i-n-Math.max(e.i.minBufferTime||0,e.l.rebufferingGoal)||t.lb.h.g>r)}(e,a,o)&&(Y.info("Aborting current segment request to switch."),a.lb.abort()),r&&(a.ab?a.Qc=!0:a.Sa?(a.Wa=!0,a.oc=n,a.Qc=!0):(Mo(a),Lo(e,a,!0,n).catch((function(t){e.g&&e.g.onError(t)})))),0):(Y.debug("switch: Stream "+Vo(a)+" already active"),1))))}function bo(e,t){var r=Vo(t);t.ab?Y.debug(r,"clear: already clearing the buffer"):t.Wa?Y.debug(r,"clear: already waiting"):t.Sa?(Y.debug(r,"clear: currently updating"),t.Wa=!0,t.oc=0):null==Ar(e.g.T,t.type)?(Y.debug(r,"clear: nothing buffered"),null==t.Pa&&Do(e,t,0)):(Y.debug(r,"clear: handling right now"),Mo(t),Lo(e,t,!1,0).catch((function(t){e.g&&e.g.onError(t)})))}function _o(e,t,r,n,i){return y((function a(){var o,s,l,u,c,d,h;return N(a,(function(a){switch(a.s){case 1:return o=e.g.eb(),s=xo(e,o),l=pe,u=new Map,c=new Set,t&&(u.set(l.Sb,t),c.add(t)),r&&(u.set(l.Za,r),c.add(r)),n&&(u.set(l.za,n),c.add(n)),d=e.g.T,h=e.l.forceTransmuxTS,A(a,d.init(u,h),2);case 2:return e.j?a.return():(function(e){var t=e.i.presentationTimeline.ha();1/0>t?e.g.T.Fa(t):e.g.T.Fa(Math.pow(2,32))}(e),A(a,So(e,c),3));case 3:if(e.j)return a.return();u.forEach((function(t,r){if(!e.h.has(r)){var n=Eo(t,s,i);e.h.set(r,n),Do(e,n,0)}})),w(a)}}))}))}function Eo(e,t,r){return{stream:e,type:e.type,Hb:null,La:null,Ta:null,Ac:!0,oa:t,endOfStream:!1,Sa:!1,Pa:null,Wa:!1,oc:0,Qc:!1,ab:!1,Ed:!1,ac:!1,Hd:r||0,lb:null}}function To(e,t){var r=e.m[t];if(r)return Y.debug("(all) Period "+t+" is being or has been set up"),r.promise;Y.debug("(all) setting up Period "+t),r={promise:new me,Rb:!1},e.m[t]=r;for(var n=new Set,i=f(e.i.periods[t].variants),a=i.next();!a.done;a=i.next())(a=a.value).video&&n.add(a.video),a.video&&a.video.trickModeVideo&&n.add(a.video.trickModeVideo),a.audio&&n.add(a.audio);for(a=(i=f(e.i.periods[t].textStreams)).next();!a.done;a=i.next())n.add(a.value);return e.F=e.F.then(function(){if(!this.j)return So(this,n)}.bind(e)).then(function(){this.j||(this.m[t].promise.resolve(),this.m[t].Rb=!0,Y.K("(all) setup Period "+t))}.bind(e)).catch(function(e){this.j||(this.m[t].promise.catch((function(){})),this.m[t].promise.reject(),delete this.m[t],Y.v("(all) failed to setup Period "+t),this.g.onError(e))}.bind(e)),r.promise}function So(e,t){return y((function r(){var n,i,a,o,s,l,u;return N(r,(function(r){switch(r.s){case 1:n=[];for(var c=f(t),d=c.next();!d.done;d=c.next())i=d.value,(a=e.o.get(i.id))?(Y.debug("(all) Stream "+i.id+" is being or has been set up"),n.push(a.promise)):(Y.K("(all) setting up Stream "+i.id),e.o.set(i.id,{promise:new me,Rb:!1}),n.push(i.createSegmentIndex()));return k(r,2),A(r,Promise.all(n),4);case 4:if(e.j)return r.return();C(r,3);break;case 2:if(o=P(r),e.j)return r.return();for(d=(r=f(t)).next();!d.done;d=r.next())s=d.value,e.o.get(s.id).promise.catch((function(){})),e.o.get(s.id).promise.reject(),e.o.delete(s.id);throw o;case 3:for(d=(c=f(t)).next();!d.done;d=c.next())l=d.value,(u=e.o.get(l.id)).Rb||(u.promise.resolve(),u.Rb=!0,Y.K("(all) setup Stream "+l.id));w(r)}}))}))}function $o(t,r){if(!t.j){var n=Vo(r);if(!r.Sa&&null!=r.Pa&&!r.ab)if(r.Pa=null,r.Wa)Y.debug(n,"skipping update and clearing the buffer"),Lo(t,r,r.Qc,r.oc);else{try{var i=function(e,t){if(Co(t))return Cr(e.g.T,t.stream.originalId||""),null;var r=Vo(t),n=e.g.eb(),i=Ao(e,t,n);Y.O(r,"timeNeeded="+i);var a=Ro(e,t.stream),o=xo(e,i),s=function(e,t,r){return"text"==t?null==(e=e.g).h||e.h<r?0:e.h-Math.max(r,e.g):zt(e=kr(e,t),r)}(e.g.T,t.type,n);Y.O(r,"update_:","presentationTime="+n,"bufferedAhead="+s);var l=Math.max(e.i.minBufferTime||0,e.l.rebufferingGoal,e.l.bufferingGoal)*e.u;if(i>=e.i.presentationTimeline.ha())return Y.debug(r,"buffered to end of presentation"),t.endOfStream=!0,"video"==t.type&&(i=e.h.get("text"))&&"application/cea-608"==i.stream.mimeType&&(i.endOfStream=!0),null;if(t.endOfStream=!1,t.oa=o,o!=a)return Y.debug(r,"need Period "+o,"presentationTime="+n,"timeNeeded="+i,"currentPeriodIndex="+a),null;if(s>=l)return Y.O(r,"buffering goal met"),.5;if(r=wr(e.g.T,t.type),!(r=wo(e,t,n,r,a)))return 1;var u=1/0;return Array.from(e.h.values()).forEach((function(t){Co(t)||(t=Ao(e,t,n),u=Math.min(u,t))})),i>=u+e.i.presentationTimeline.g?1:(t.Hd=0,function(e,t,r,n,i){var a=Vo(t),o=e.i.periods[n];Y.K(a,"fetchAndAppend_:","presentationTime="+r,"currentPeriod.startTime="+o.startTime,"reference.position="+i.position,"reference.startTime="+i.startTime,"reference.endTime="+i.endTime);var s=t.stream,l=e.i.presentationTimeline.ha(),u=e.i.periods[n+1];n=function(e,t,r,n,i){if(!t.Ac)return Promise.resolve();var a=Vo(t);return r=e.i.periods[r].startTime-t.stream.presentationTimeOffset,Y.K(a,"setting timestamp offset to "+r),Y.K(a,"setting append window start to "+n),Y.K(a,"setting append window end to "+i),n=function(e,t,r,n,i){return"text"==t?(e.g.A=r,(e=e.g).j=n,e.m=i,Promise.resolve()):Promise.all([xr(e,t,e.Ve.bind(e,t)),xr(e,t,e.Cg.bind(e,t,r)),xr(e,t,e.zg.bind(e,t,n,i))])}(e.g.T,t.type,r,n,i),t.stream.initSegmentReference?(Y.K(a,"fetching init segment"),e=Oo(e,t,t.stream.initSegmentReference).then(function(e){if(!this.j)return Y.K(a,"appending init segment"),Ir(this.g.T,t.type,e,null,null,t.stream.closedCaptions&&0<t.stream.closedCaptions.size)}.bind(e)).catch((function(e){return t.Ac=!0,Promise.reject(e)})),Promise.all([n,e])):n}(e,t,n,Math.max(0,o.startTime-.1),u?u.startTime+.01:l),t.Sa=!0,t.Ac=!1,Y.O(a,"fetching segment"),l=Oo(e,t,i),Promise.all([n,l]).then(function(e){if(!this.j&&!this.A)return function(e,t,r,n,i,a,o){var s=Vo(t),l=i.closedCaptions&&0<i.closedCaptions.size;return null!=i.emsgSchemeIdUris&&0<i.emsgSchemeIdUris.length&&(new Gn).ma("emsg",e.P.bind(e,n,a,i.emsgSchemeIdUris)).parse(o),function(e,t,r){var n=Vo(t);Y.O(n,"checking buffer length");var i=Math.max(e.l.bufferBehind,e.i.presentationTimeline.g),a=Ar(e.g.T,t.type);if(null==a)return Y.O(n,"buffer behind okay because nothing buffered:","presentationTime="+r,"bufferBehind="+i),Promise.resolve();var o=r-a,s=o-i;return.01>=s?(Y.O(n,"buffer behind okay:","presentationTime="+r,"bufferedBehind="+o,"bufferBehind="+i,"underflow="+Math.abs(s)),Promise.resolve()):(Y.K(n,"buffer behind too large:","presentationTime="+r,"bufferedBehind="+o,"bufferBehind="+i,"overflow="+s),e.g.T.remove(t.type,a,a+s).then(function(){this.j||Y.K(n,"evicted "+s+" seconds")}.bind(e)))}(e,t,r).then(function(){if(!this.j)return Y.K(s,"appending media segment"),Ir(this.g.T,t.type,o,a.startTime+n.startTime,a.endTime+n.startTime,l)}.bind(e)).then(function(){if(!this.j)return Y.O(s,"appended media segment"),t.Hb=i,t.La=a,Promise.resolve()}.bind(e))}(this,t,r,o,s,i,e[1])}.bind(e)).then(function(){this.j||this.A||(t.Sa=!1,t.Ed=!1,t.Wa||this.g.zd(),Do(this,t,0),function(e,t,r){if(!e.C){var n=Vo(t);if(1==(t=Array.from(e.h.values())).length&&"text"==t[0].type||(e.C=t.every((function(e){return"text"==e.type||!e.Wa&&!e.ab&&e.La}))),e.C){for(Y.debug(n,"startup complete"),r=Ro(e,r),e.m[r]||To(e,r).then(function(){this.j||(Y.K(n,"calling onCanSwitch()..."),this.g.te())}.bind(e)).catch(de.Bc),r=0;r<e.i.periods.length;++r)To(e,r).catch(de.Bc);e.g.gg&&(Y.K(n,"calling onStartupComplete()..."),e.g.gg())}}}(this,t,s),Y.K(a,"finished fetch and append"))}.bind(e)).catch(function(e){this.j||this.A||(t.Sa=!1,"text"==t.type&&this.l.ignoreTextStreamFailures?(1001==e.code?Y.v(a,"Text stream failed to download. Proceeding without it."):Y.v(a,"Text stream failed to parse. Proceeding without it."),this.h.delete("text")):7001==e.code?(t.Sa=!1,t.Pa=null,Do(this,t,0)):3017==e.code?function(e,t,r){var n=Vo(t);if(Array.from(e.h.values()).some((function(e){return e!=t&&e.Ed})))Y.debug(n,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var i=Math.round(100*e.u);if(20<i)e.u-=.2;else{if(!(4<i))return Y.error(n,"MediaSource threw QuotaExceededError too many times"),t.ac=!0,e.A=!0,void e.g.onError(r);e.u-=.04}Y.v(n,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*e.u))+"%"),t.Ed=!0}Do(e,t,4)}(this,t,e):(Y.error(a,"failed fetch and append: code="+e.code),t.ac=!0,e.severity=2,Go(this,e)))}.bind(e))}(e,t,n,a,r),null)}(t,r);null!=i&&(Do(t,r,i),r.ac=!1)}catch(e){return void Go(t,e)}i=Array.from(t.h.values()),function(e,t){var r=Vo(t),n=Ro(e,t.stream);if(t.oa!=n){var i=t.oa,a=Array.from(e.h.values());a.every((function(e){return e.oa==i||Co(e)}))?a.every(Po)?(Y.debug(r,"all need Period "+i),To(e,i).then(function(){if(!this.j)if(a.every(function(e){var t=Po(e),r=Ro(this,e.stream);return!!Co(e)||t&&e.oa==i&&r!=i}.bind(this))){var e=this.i.periods[i];Y.K(r,"calling onChooseStreams()...");var t=this.g.ue(e),n=new Map;t.variant&&t.variant.video&&n.set("video",t.variant.video),t.variant&&t.variant.audio&&n.set("audio",t.variant.audio),t.text&&n.set("text",t.text);for(var o=(t=f(this.h.keys())).next();!o.done;o=t.next())if(o=o.value,!n.has(o)&&"text"!=o)return Y.error(r,"invalid Streams chosen: missing "+o+" Stream"),void this.g.onError(new z(2,5,5005));for(o=(t=f(Array.from(n.keys()))).next();!o.done;o=t.next())if(o=o.value,!this.h.has(o)){if("text"!=o)return Y.error(r,"invalid Streams chosen: unusable "+o+" Stream"),void this.g.onError(new z(2,5,5005));_o(this,null,null,n.get("text"),e.startTime),n.delete(o)}for(o=(t=f(Array.from(this.h.keys()))).next();!o.done;o=t.next()){o=o.value;var s=this.h.get(o),l=n.get(o);if(l){var u=Co(s);u&&(s.oa=i,s.Hd=e.startTime),vo(this,l,!1,0,!1),u&&Co(s)||Do(this,this.h.get(o),0)}else this.h.delete(o)}Y.K(r,"calling onCanSwitch()..."),this.g.te()}else Y.debug(r,"ignoring transition to Period",i,"since another is happening")}.bind(e)).catch(de.Bc)):Y.debug(r,"all MediaStates need Period "+i+", but not all MediaStates are idle"):Y.debug(r,"not all MediaStates need Period "+i)}}(t,r),t.C&&i.every((function(e){return e.endOfStream}))&&(Y.K(n,"calling endOfStream()..."),t.g.T.endOfStream().then(function(){if(!this.j){var e=this.g.T.ha();0!=e&&e<this.i.presentationTimeline.ha()&&this.i.presentationTimeline.Fa(e)}}.bind(t)))}}}function Ao(e,t,r){return t.Hb&&t.La?(r=Ro(e,t.Hb),e.i.periods[r].startTime+t.La.endTime):Math.max(r,t.Hd)}function wo(e,t,r,n,i){var a=Vo(t);return t.La&&t.stream==t.Hb?(n=t.La.position+1,Y.O(a,"next position known:","position="+n),Io(e,t,i,n)):(t.La?(Y.K(a,"next position unknown: another Stream buffered"),a=Ro(e,t.Hb),a=ko(e,t,e.i.periods[a].startTime+t.La.endTime,i)):(Y.K(a,"next position unknown: nothing buffered"),a=ko(e,t,n||r,i)),null==a?null:(r=null,null==n&&(r=Io(e,t,i,Math.max(0,a-1))),r||Io(e,t,i,a)))}function ko(e,t,r,n){var i=Vo(t);return e=e.i.periods[n],Y.debug(i,"looking up segment:","presentationTime="+r,"currentPeriod.startTime="+e.startTime),r=Math.max(0,r-e.startTime),null==(t=t.stream.findSegmentPosition(r))&&Y.v(i,"cannot find segment:","currentPeriod.startTime="+e.startTime,"lookupTime="+r),t}function Io(e,t,r,n){var i=Vo(t);return r=e.i.periods[r],(t=t.stream.getSegmentReference(n))?(e=(n=e.i.presentationTimeline).$b(),n=n.Db(),r.startTime+t.endTime<e||r.startTime+t.startTime>n?(Y.O(i,"segment is not available:","currentPeriod.startTime="+r.startTime,"reference.startTime="+t.startTime,"reference.endTime="+t.endTime,"availabilityStart="+e,"availabilityEnd="+n),null):t):(Y.K(i,"segment does not exist:","currentPeriod.startTime="+r.startTime,"position="+n),null)}function Co(e){return e&&"text"==e.type&&"application/cea-608"==e.stream.mimeType}function Po(e){return!e.Sa&&null==e.Pa&&!e.Wa&&!e.ab}function xo(e,t){var r=Za(e.i.periods,t+ye);return r?e.i.periods.indexOf(r):0}function Ro(e,t){for(var r=e.i.periods,n=0;n<r.length;n++){for(var i=r[n],a=new Set,o=f(i.variants),s=o.next();!s.done;s=o.next())(s=s.value).audio&&a.add(s.audio),s.video&&a.add(s.video),s.video&&s.video.trickModeVideo&&a.add(s.video.trickModeVideo);for(o=(i=f(i.textStreams)).next();!o.done;o=i.next())a.add(o.value);if(a.has(t))return n}return-1}function Oo(e,t,r){var n=$i(r.i(),r.h,r.g,e.l.retryParameters);return Y.O("fetching: reference=",r),e=e.g.Ib.request(1,n),t.lb=e,e.promise.then((function(e){return t.lb=null,e.data}))}function Lo(e,t,r,n){return y((function i(){var a,o,s,l;return N(i,(function(i){switch(i.s){case 1:return a=Vo(t),t.Wa=!1,t.Qc=!1,t.oc=0,t.ab=!0,t.Hb=null,t.La=null,Y.debug(a,"clearing buffer"),n?(s=e.g.eb(),l=e.g.T.ha(),o=e.g.T.remove(t.type,s+n,l)):o=Pr(e.g.T,t.type).then(function(){if(!this.j&&r)return this.g.T.flush(t.type)}.bind(e)),A(i,o,2);case 2:if(e.j)return i.return();Y.debug(a,"cleared buffer"),t.ab=!1,t.endOfStream=!1,Do(e,t,0),w(i)}}))}))}function Do(e,t,r){var n=Vo(t),i=t.type;"text"!=i||e.h.has(i)?(Y.O(n,"updating in "+r+" seconds"),t.Pa=new Ie((function(){return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return k(r,2),A(r,$o(e,t),4);case 4:C(r,0);break;case 2:n=P(r),e.g&&e.g.onError(n),w(r)}}))}))})).V(r)):Y.K(n,"Text stream is unloaded. No update is needed.")}function Mo(e){null!=e.Pa&&(e.Pa.stop(),e.Pa=null)}function No(e){return y((function t(){return N(t,(function(t){if(1===t.s){if(e.lb)return A(t,e.lb.abort(),0);t.I(0)}}))}))}function Go(e,t){xe(e.M).then(function(){this.j||(this.g.onError(t),t.handled||this.l.failureCallback(t))}.bind(e))}function Vo(e){return"("+e.type+":"+e.stream.id+")"}function Uo(e,t,r,n,i,a){if(200<=r&&299>=r&&202!=r)return{uri:i||n,Bd:n,data:t,headers:e,fromCache:!!e["x-shaka-from-cache"]};i=null;try{i=be(t)}catch(o){}throw Y.debug("HTTP error text:",i),new z(401==r||403==r?2:1,1,1001,n,r,i,e,a)}function Zo(e,t,r,n){var i=new Zo.h;lt(t.headers).forEach((function(e,t){i.append(t,e)}));var a=new Zo.g,o={Zd:!1,Oe:!1};if(e=new Re(e=Zo.u(e,r,{body:t.body||void 0,headers:i,method:t.method,signal:a.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},o,n),(function(){return o.Zd=!0,a.abort(),Promise.resolve()})),t=t.retryParameters.timeout){var s=new Ce((function(){o.Oe=!0,a.abort()}));s.V(t/1e3),e.finally((function(){s.stop()}))}return e}function Bo(e,t,r,n){var i=new Bo.j,a=Date.now(),o=0;return new Re(new Promise((function(s,l){for(var u in i.open(t.method,e,!0),i.responseType="arraybuffer",i.timeout=t.retryParameters.timeout,i.withCredentials=t.allowCrossSiteCredentials,i.onabort=function(){l(new z(1,1,7001,e,r))},i.onload=function(t){for(var n=(t=t.target).getAllResponseHeaders().trim().split("\r\n"),i={},a=(n=f(n)).next();!a.done;a=n.next())i[(a=a.value.split(": "))[0].toLowerCase()]=a.slice(1).join(": ");try{var o=Uo(i,t.response,t.status,e,t.responseURL,r);s(o)}catch(u){l(u)}},i.onerror=function(t){l(new z(1,1,1002,e,t,r))},i.ontimeout=function(){l(new z(1,1,1003,e,r))},i.onprogress=function(e){var t=Date.now();(100<t-a||e.lengthComputable&&e.loaded==e.total)&&(n(t-a,e.loaded-o,e.total-e.loaded),o=e.loaded,a=t)},t.headers)i.setRequestHeader(u.toLowerCase(),t.headers[u]);i.send(t.body)})),(function(){return i.abort(),Promise.resolve()}))}function Fo(){this.g=this.j=this.h=0,this.i=new Map,this.l=0}function jo(e,t,r){this.m=e,this.h=new Map,this.i=!1,this.l=t,this.j=r,this.g=new Fo}function Wo(e,t,r,n,i,a){var o=function(e,t){e.h+=t;var r=e.l;return e.l++,e.i.set(r,t),r}(e.g,n);n=e.h.get(t)||Promise.resolve(),e.h.set(t,n.then((function(){return y((function t(){var n,s,l,u,c,d;return N(t,(function(t){switch(t.s){case 1:return A(t,function(e,t){return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return A(r,e.m.request(1,t).promise,2);case 2:return n=r.B,r.return(n.data)}}))}))}(e,r),2);case 2:if(n=t.B,e.i)throw new z(2,9,7001);if(i)for(var h in s=new Uint8Array(n),(l=new Wn(s)).data)u=Number(h),c=l.data[u],d=l.g[u],e.j(c,d);return e.g.close(o,n.byteLength),h=e.g,e.l(0==h.h?0:h.j/h.h,e.g.g),t.return(a(n))}}))}))})))}function Xo(e,t){var r=this;this.i=e,this.h=e.objectStore(t),this.g=new me,e.onabort=function(e){e.preventDefault(),r.g.reject()},e.onerror=function(e){e.preventDefault(),r.g.reject()},e.oncomplete=function(){r.g.resolve()}}function Ho(e,t){return new Promise((function(r,n){var i=e.h.openCursor();i.onerror=n,i.onsuccess=function(e){if(!(e=e.target.result))return r();t(e.key,e.value,e),e.continue()}}))}function Ko(e){this.h=e,this.g=[]}function Yo(e,t){return zo(e,t,"readwrite")}function zo(e,t,r){var n=new Xo(r=e.h.transaction([t],r),t);return e.g.push(n),n.promise().then((function(){Fe(e.g,n)}),(function(){Fe(e.g,n)})),n}function Jo(e,t,r){this.h=new Ko(e),this.i=t,this.g=r}function Qo(e){return Promise.reject(new z(2,9,9011,"Cannot add new value to "+e))}function qo(e,t,r,n){t=(e=Yo(e.h,t)).store();for(var i={},a=(r=f(r)).next();!a.done;i={key:i.key},a=r.next())i.key=a.value,t.delete(i.key).onsuccess=function(e){return function(){return n(e.key)}}(i);return e.promise()}function es(e,t,r){return y((function n(){var i,a,o,s,l,u,c;return N(n,(function(n){switch(n.s){case 1:for(i=zo(e.h,t,"readonly"),a=i.store(),o={},s=[],l={},u=f(r),c=u.next();!c.done;l={request:l.request,key:l.key},c=u.next())l.key=c.value,l.request=a.get(l.key),l.request.onsuccess=function(e){return function(){null==e.request.result&&s.push(e.key),o[e.key]=e.request.result}}(l);return A(n,i.promise(),2);case 2:if(s.length)throw new z(2,9,9012,"Could not find values for "+s);return n.return(r.map((function(e){return o[e]})))}}))}))}function ts(e){this.g=new Ko(e)}function rs(){this.g=new Map}function ns(e,t,r){if(!(e=e.g.get(t)))throw new z(2,9,9013,"Could not find mechanism with name "+t);if(!(t=e.getCells().get(r)))throw new z(2,9,9013,"Could not find cell with name "+r);return t}function is(e,t){as.set(e,t)}co.prototype.destroy=function(){var e=this;return y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:r=[];for(var i=f(e.h.values()),a=i.next();!a.done;a=i.next())Mo(n=a.value),r.push(No(n));return A(t,Promise.all(r),2);case 2:e.h.clear(),e.o.clear(),e.g=null,e.i=null,e.F=null,e.m=null,e.l=null,e.j=!0,w(t)}}))}))},co.prototype.configure=function(e){this.l=e,this.M=new Pe({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0},!0)},co.prototype.start=function(){var e=this;return y((function t(){var r,n,i;return N(t,(function(t){switch(t.s){case 1:return r=e.g.eb(),n=xo(e,r),(i=e.g.ue(e.i.periods[n])).variant||i.text?A(t,_o(e,i.variant?i.variant.audio:null,i.variant?i.variant.video:null,i.text,r),2):(Y.error("init: no Streams chosen"),t.return(new z(2,5,5005)));case 2:if(e.j)return t.return();Y.debug("init: completed initial Stream setup"),e.g&&e.g.Yf&&(Y.K("init: calling onInitialStreamsSetup()..."),e.g.Yf()),w(t)}}))}))},co.prototype.P=function(e,t,r,n){var i=n.reader.Cd(),a=n.reader.Cd(),o=n.reader.N(),s=n.reader.N(),l=n.reader.N(),u=n.reader.N();n=n.reader.mb(n.reader.S.byteLength-n.reader.ka()),e=e.startTime+t.startTime+s/o,r.includes(i)&&("urn:mpeg:dash:event:2012"==i?this.g.Zf():this.g.onEvent(new Ge("emsg",{detail:{startTime:e,endTime:e+l/o,schemeIdUri:i,value:a,timescale:o,presentationTimeDelta:s,eventDuration:l,id:u,messageData:n}})))},F("shaka.net.HttpFetchPlugin",Zo),Zo.u=function(e,t,r,n,i){return y((function a(){var o,s,l,u,c,d,h,f,p,m,g,v;return N(a,(function(a){switch(a.s){case 1:return o=Zo.l,s=Zo.i,d=c=0,h=Date.now(),k(a,2),A(a,o(e,r),4);case 4:return l=a.B,f=l.clone().body.getReader(),m=(p=l.headers.get("Content-Length"))?parseInt(p,10):0,new s({start:function(e){!function t(){return y((function r(){var n,a,o;return N(r,(function(r){switch(r.s){case 1:return k(r,2),A(r,f.read(),4);case 4:n=r.B,C(r,3);break;case 2:return a=P(r),Y.K("error reading from stream",a.message),r.return();case 3:n.done||(c+=n.value.byteLength),(100<(o=Date.now())-h||n.done)&&(i(o-h,c-d,m-c),d=c,h=o),n.done?e.close():(e.enqueue(n.value),t()),w(r)}}))}))}()}}),A(a,l.arrayBuffer(),5);case 5:u=a.B,C(a,3);break;case 2:if(g=P(a),n.Zd)throw new z(1,1,7001,e,t);if(n.Oe)throw new z(1,1,1003,e,t);throw new z(1,1,1002,e,g,t);case 3:return v={},l.headers.forEach((function(e,t){v[t.trim()]=e})),a.return(Uo(v,u,l.status,e,l.url,t))}}))}))},Zo.isSupported=function(){if(!t.ReadableStream)return!1;try{new ReadableStream({})}catch(l){return!1}return!(!t.fetch||!t.AbortController)},Zo.isSupported=Zo.isSupported,Zo.l=t.fetch,Zo.g=t.AbortController,Zo.i=t.ReadableStream,Zo.h=t.Headers,Zo.isSupported()&&(Ye("http",Zo,2),Ye("https",Zo,2)),F("shaka.net.HttpXHRPlugin",Bo),Bo.j=t.XMLHttpRequest,Ye("http",Bo,1),Ye("https",Bo,1),Fo.prototype.close=function(e,t){if(this.i.has(e)){var r=this.i.get(e);this.i.delete(e),this.j+=r,this.g+=t}},jo.prototype.destroy=function(){return this.i=!0,Promise.all(this.h.values()).then((function(){}),(function(){}))},Xo.prototype.abort=function(){try{this.i.abort()}catch(l){}return this.g.catch((function(){}))},Xo.prototype.store=function(){return this.h},Xo.prototype.promise=function(){return this.g},Ko.prototype.destroy=function(){return Promise.all(this.g.map((function(e){return e.abort()})))},(i=Jo.prototype).destroy=function(){return this.h.destroy()},i.hasFixedKeySpace=function(){return!0},i.addSegments=function(){return Qo(this.i)},i.removeSegments=function(e,t){return qo(this,this.i,e,t)},i.getSegments=function(e){var t=this;return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return A(r,es(t,t.i,e),2);case 2:return n=r.B,r.return(n.map((function(e){return t.ae(e)})))}}))}))},i.addManifests=function(){return Qo(this.g)},i.updateManifestExpiration=function(e,t){var r=Yo(this.h,this.g),n=r.store();return n.get(e).onsuccess=function(r){(r=r.target.result)&&(r.expiration=t,n.put(r,e))},r.promise()},i.removeManifests=function(e,t){return qo(this,this.g,e,t)},i.getManifests=function(e){var t=this;return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return A(r,es(t,t.g,e),2);case 2:return n=r.B,r.return(n.map((function(e){return t.pc(e)})))}}))}))},i.getAllManifests=function(){var e=this;return y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return r=zo(e.h,e.g,"readonly"),n=new Map,A(t,Ho(r,(function(t,r){n.set(t,e.pc(r))})),2);case 2:return A(t,r.promise(),3);case 3:return t.return(n)}}))}))},i.ae=function(e){return e},i.pc=function(e){return e},i.add=function(e,t){var r=this;return y((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:i=Yo(r.h,e),a=i.store(),o=[];for(var l=f(t),u=l.next();!u.done;u=l.next())s=u.value,a.add(s).onsuccess=function(e){o.push(e.target.result)};return A(n,i.promise(),2);case 2:return n.return(o)}}))}))},ts.prototype.destroy=function(){return this.g.destroy()},ts.prototype.getAll=function(){var e=this;return y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return r=zo(e.g,"session-ids","readonly"),n=[],A(t,Ho(r,(function(e,t){n.push(t)})),2);case 2:return A(t,r.promise(),3);case 3:return t.return(n)}}))}))},ts.prototype.add=function(e){for(var t=Yo(this.g,"session-ids"),r=t.store(),n=(e=f(e)).next();!n.done;n=e.next())r.add(n.value);return t.promise()},ts.prototype.remove=function(e){var t=this;return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return A(r,Ho(n=Yo(t.g,"session-ids"),(function(t,r,n){0<=e.indexOf(r.sessionId)&&n.delete()})),2);case 2:return A(r,n.promise(),0)}}))}))},rs.prototype.destroy=function(){for(var e=[],t=f(this.g.values()),r=t.next();!r.done;r=t.next())e.push(r.value.destroy());return this.g.clear(),Promise.all(e)},rs.prototype.init=function(){var e=this;as.forEach((function(t,r){var n=t();n?e.g.set(r,n):Y.info("Skipping "+r+" as it is not supported on this platform")}));for(var t=[],r=f(this.g.values()),n=r.next();!n.done;n=r.next())t.push(n.value.init());return Promise.all(t)},rs.prototype.erase=function(){var e=this;return y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return r=Array.from(e.g.values()),(n=0<r.length)||as.forEach((function(e){(e=e())&&r.push(e)})),A(t,Promise.all(r.map((function(e){return e.erase()}))),2);case 2:if(!n)return A(t,Promise.all(r.map((function(e){return e.destroy()}))),0);t.I(0)}}))}))},F("shaka.offline.StorageMuxer.register",is),F("shaka.offline.StorageMuxer.unregister",(function(e){as.delete(e)}));var as=new Map;function os(e){Jo.apply(this,arguments)}function ss(e){return function(e){var t=e.streams.filter((function(e){return"audio"==e.contentType})),r=e.streams.filter((function(e){return"video"==e.contentType}));if(!t.every((function(e){return e.variantIds}))||!r.every((function(e){return e.variantIds}))){t.forEach((function(e){e.variantIds=[]})),r.forEach((function(e){e.variantIds=[]}));var n=0;if(r.length&&!t.length){Y.debug("Found video-only content. Creating variants for video.");var i=n++;r.forEach((function(e){e.variantIds.push(i)}))}if(!r.length&&t.length){Y.debug("Found audio-only content. Creating variants for audio.");var a=n++;t.forEach((function(e){e.variantIds.push(a)}))}r.length&&t.length&&(Y.debug("Found audio-video content. Creating variants."),t.forEach((function(e){r.forEach((function(t){var r=n++;e.variantIds.push(r),t.variantIds.push(r)}))})))}}(e),e.streams.forEach((function(){})),{startTime:e.startTime,streams:e.streams.map(ls)}}function ls(e){var t=e.initSegmentUri?cs(e.initSegmentUri):null;return{id:e.id,originalId:null,primary:e.primary,presentationTimeOffset:e.presentationTimeOffset,contentType:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:t,encrypted:e.encrypted,keyId:e.keyId,segments:e.segments.map(us),variantIds:e.variantIds}}function us(e){var t=cs(e.uri);return{startTime:e.startTime,endTime:e.endTime,dataKey:t}}function cs(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new z(2,9,9004,"Could not parse uri "+e)}function ds(e,t,r,n){Jo.call(this,e,t,r),this.j=n}function hs(){this.l=this.i=this.h=this.g=this.j=null}function fs(e,t,r,n){this.g=e,this.l=t,this.j=r,this.i=n,this.h=["offline:",e,"/",t,"/",r,"/",n].join("")}function ps(e){if(null==(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)))return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var r=e[2];if(!r)return null;var n=e[3];return n&&null!=t?new fs(t,r,n,Number(e[4])):null}function ys(e,t){this.h=e,this.g=t}function ms(e,t,r){var n=t.streams.filter((function(e){return"audio"==e.contentType})),i=t.streams.filter((function(e){return"video"==e.contentType}));return n=function(e,t,r){for(var n=new Set,i=f(t),a=i.next();!a.done;a=i.next()){var o=f(a.value.variantIds);for(a=o.next();!a.done;a=o.next())n.add(a.value)}for(i=f(r),a=i.next();!a.done;a=i.next())for(a=(o=f(a.value.variantIds)).next();!a.done;a=o.next())n.add(a.value);for(i=new Map,n=f(n),a=n.next();!a.done;a=n.next())a=a.value,i.set(a,{id:a,language:"",primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0});for(t=f(t),n=t.next();!n.done;n=t.next())for(a=gs(e,n=n.value),n=(o=f(n.variantIds)).next();!n.done;n=o.next())(n=i.get(n.value)).language=a.language,n.primary=n.primary||a.primary,n.audio=a;for(r=f(r),t=r.next();!t.done;t=r.next())for(t=gs(e,n=t.value),n=(a=f(n.variantIds)).next();!n.done;n=a.next())(n=i.get(n.value)).primary=n.primary||t.primary,n.video=t;return i}(e,n,i),i=t.streams.filter((function(e){return"text"==e.contentType})).map((function(t){return gs(e,t)})),t.streams.forEach((function(n){n=n.segments.map((function(t,r){return vs(e,r,t)})),r.Jb(n,t.startTime)})),{startTime:t.startTime,variants:Array.from(n.values()),textStreams:i}}function gs(e,t){var r=t.segments.map((function(t,r){return vs(e,r,t)})),n=new oi(r);return r={id:t.id,originalId:t.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(e){return n.find(e)},getSegmentReference:function(e){return n.get(e)},initSegmentReference:null,presentationTimeOffset:t.presentationTimeOffset,mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate||void 0,pixelAspectRatio:t.pixelAspectRatio||void 0,kind:t.kind,encrypted:t.encrypted,keyId:t.keyId,language:t.language,label:t.label||null,type:t.contentType,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},null!=t.initSegmentKey&&(r.initSegmentReference=function(e,t){var r=new fs("segment",e.h,e.g,t);return new ni((function(){return[r.toString()]}),0,null)}(e,t.initSegmentKey)),r}function vs(e,t,r){var n=new fs("segment",e.h,e.g,r.dataKey);return new ii(t,r.startTime,r.endTime,(function(){return[n.toString()]}),0,null)}function bs(){this.g=null}function _s(e){var t=ps(e);return t&&"manifest"==t.g?_s.m(e):t&&"segment"==t.g?_s.o(t.key(),t):Oe(new z(2,1,9004,e))}function Es(e,t,r){return y((function n(){var i,a,o,s,l,u;return N(n,(function(n){switch(n.s){case 1:i=[];for(var c=[],d=f(r),h=d.next();!h.done;h=d.next()){h=h.value;for(var p=!1,m=f(c),g=m.next();!g.done;g=m.next())if(Ts((g=g.value).info,h)){g.sessionIds.push(h.sessionId),p=!0;break}p||c.push({info:h,sessionIds:[h.sessionId]})}a=f(c),o=a.next();case 2:if(o.done){n.I(4);break}return s=o.value,l=function(e,t,r){return y((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:return i=new St({Ib:t,onError:function(){},Dc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),k(n,2),i.configure(e),A(n,function(e,t,r,n,i,a){var o=new Map;return o.set(t,{audioCapabilities:i,videoCapabilities:a,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t,drmInfos:[{keySystem:t,licenseServerUri:r,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:n,initData:null,keyIds:null}]}),Ot(e,o)}(i,r.info.keySystem,r.info.licenseUri,r.info.serverCertificate,r.info.audioCapabilities,r.info.videoCapabilities),4);case 4:C(n,3);break;case 2:return a=P(n),Y.v("Error initializing EME",a),A(n,i.destroy(),5);case 5:case 9:return n.return([]);case 3:return k(n,6),A(n,wt(i),8);case 8:C(n,7);break;case 6:return o=P(n),Y.v("Error setting server certificate",o),A(n,i.destroy(),9);case 7:return s=[],A(n,Promise.all(r.sessionIds.map((function(e){return y((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return k(t,2),A(t,function(e,t){return y((function r(){var n,i,a;return N(r,(function(r){switch(r.s){case 1:return A(r,Lt(e,t),2);case 2:return(n=r.B)?(i=[],(a=e.h.get(n))&&(a.Ga=new me,i.push(a.Ga)),Y.O("Attempting to remove session",t),i.push(n.remove()),A(r,Promise.all(i),0)):(Y.O("Ignoring attempt to remove missing session",t),r.return())}}))}))}(i,e),4);case 4:s.push(e),C(t,0);break;case 2:r=P(t),Y.v("Error deleting offline session",r),w(t)}}))}))}))),10);case 10:return A(n,i.destroy(),11);case 11:return n.return(s)}}))}))}(e,t,s),A(n,l,5);case 5:u=n.B,i=i.concat(u),o=a.next(),n.I(2);break;case 4:return n.return(i)}}))}))}function Ts(e,t){function r(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&je(e.audioCapabilities,t.audioCapabilities,r)&&je(e.videoCapabilities,t.videoCapabilities,r)}function Ss(e,t){var r={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},n=this;this.m=t,this.i=e,this.j=r,this.o=null,this.l=[],this.h=this.g=null,this.u=!0,this.A=Promise.resolve().then((function(){return function(e){return y((function t(){return N(t,(function(t){if(1===t.s){if(e.u){if(0==e.l.length||e.g&&!e.g.gb)var r=!1;else{e.g&&(e.g.Da.kb(),e.g=null);var n=(r=e.l.shift()).create(e.j);n?(r.Da.Kb(),e.g={node:n.node,payload:n.payload,gb:n.gb,Da:r.Da}):r.Da.Ec(),r=!0}return r?r=Promise.resolve():e.g?r=function(e){return y((function t(){var r,n;return N(t,(function(t){switch(t.s){case 1:return e.i=e.m.Af(e.i,e.j,e.g.node,e.g.payload),k(t,2),e.h=e.m.ef(e.i,e.j,e.g.payload),A(t,e.h.promise,4);case 4:e.h=null,e.i==e.g.node&&(e.g.Da.Cc(),e.g=null),C(t,0);break;case 2:return 7001==(r=P(t)).code?e.g.Da.kb():e.g.Da.onError(r),e.g=null,e.h=null,n=e,A(t,e.m.handleError(e.j,r),5);case 5:n.i=t.B,w(t)}}))}))}(e):(e.m.Xf(e.i),e.o=new me,r=e.o),A(t,r,1)}t.I(0)}}))}))}(n)}))}function $s(e,t){var r={Kb:function(){},Cc:function(){},kb:function(){},onError:function(){},Ec:function(){},$g:function(){}};return e.l.push({create:t,Da:r}),e.h&&e.h.abort(),As(e),r}function As(e){e.o&&(e.o.resolve(),e.o=null)}function ws(e){this.g=null;for(var t=0;t<e.textTracks.length;++t){var r=e.textTracks[t];r.mode="disabled","Shaka Player TextTrack"==r.label&&(this.g=r)}this.g||(this.g=e.addTextTrack("subtitles","Shaka Player TextTrack")),this.g.mode="hidden"}function ks(e){if(e.startTime>=e.endTime)return Y.v("Invalid cue times: "+e.startTime+" - "+e.endTime),null;var t=new VTTCue(e.startTime,e.endTime,e.payload);t.lineAlign=e.lineAlign,t.positionAlign=e.positionAlign,e.size&&(t.size=e.size);try{t.align=e.textAlign}catch(r){}return"center"==e.textAlign&&"center"!=t.align&&(t.align="middle"),"vertical-lr"==e.writingMode?t.vertical="lr":"vertical-rl"==e.writingMode&&(t.vertical="rl"),1==e.lineInterpretation&&(t.snapToLines=!1),null!=e.line&&(t.line=e.line),null!=e.position&&(t.position=e.position),t}function Is(e,t){var r=e.mode;e.mode="showing"==r?"showing":"hidden";for(var n=e.cues,i=n.length-1;0<=i;i--){var a=n[i];a&&t(a)&&e.removeCue(a)}e.mode=r}function Cs(e,t,r,n,i){var a,o=i in n,s=!0;for(a in t){var l=i+"."+a,u=o?n[i]:r[a];o||a in r?void 0===t[a]?void 0===u||o?delete e[a]:e[a]=Ze(u):u.constructor==Object&&t[a]&&t[a].constructor==Object?(e[a]||(e[a]=Ze(u)),l=Cs(e[a],t[a],u,n,l),s=s&&l):_typeof$b(t[a])!=_typeof$b(u)||null==t[a]||"function"!=typeof t[a]&&t[a].constructor!=u.constructor?(Y.kc("Invalid config, wrong type for "+l),s=!1):("function"==typeof r[a]&&r[a].length!=t[a].length&&Y.ba("Unexpected number of arguments for "+l),e[a]=t[a]):(Y.kc("Invalid config, unrecognized key "+l),s=!1)}return s}function Ps(e,t){for(var r={},n=r,i=0,a=0;!(0>(i=e.indexOf(".",i)));)0!=i&&"\\"==e[i-1]||(n[a=e.substring(a,i).replace(/\\\./g,".")]={},n=n[a],a=i+1),i+=1;return n[e.substring(a).replace(/\\\./g,".")]=t,r}function xs(){}function Rs(){var e=5e5,t=1/0;navigator.connection&&(navigator.connection.downlink&&(e=1e6*navigator.connection.downlink),navigator.connection.saveData&&(t=360));var r={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:Dt,fairPlayTransform:!0,updateExpirationTime:1},n={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,dash:{customScheme:function(e){if(e)return null},clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1},hls:{ignoreTextStreamFailures:!1,useFullSegmentsForStartTime:!1}},i={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0},failureCallback:function(e){return Y.error("Unhandled streaming error",e),[e]},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0};(bt("Web0S")||mt()||bt("CrKey"))&&(i.stallSkip=0);var a={trackSelectionCallback:function(e){return y((function t(){return N(t,(function(t){if(1===t.s)return t.return(e)}))}))},progressCallback:function(e,t){return[e,t]},usePersistentLicense:!0},o={drm:r,manifest:n,streaming:i,offline:a,abrFactory:Zr,abr:{enabled:!0,defaultBandwidthEstimate:e,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:t,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return a.trackSelectionCallback=function(e){return y((function t(){return N(t,(function(t){if(1===t.s)return t.return(function(e,t){var r=e.filter((function(e){return"variant"==e.type})),n=[],i=Gr(t,r.map((function(e){return e.language})));i&&(n=r.filter((function(e){return Mr(e.language)==i}))),0==n.length&&(n=r.filter((function(e){return e.primary}))),0==n.length&&(1<new Set(r.map((function(e){return e.language}))).size&&Y.v("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),n=r);var a=n.filter((function(e){return e.height&&480>=e.height}));if(a.length&&(a.sort((function(e,t){return t.height-e.height})),n=a.filter((function(e){return e.height==a[0].height}))),r=[],n.length){var o=Math.floor(n.length/2);n.sort((function(e,t){return e.bandwidth-t.bandwidth})),r.push(n[o])}for(n=f(e),o=n.next();!o.done;o=n.next())"text"==(o=o.value).type&&r.push(o);return r}(e,o.preferredAudioLanguage))}))}))},o}function Os(e,t,r){var n={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return Cs(e,t,r||Rs(),n,"")}function Ls(){this.g=null,this.h=[]}function Ds(e,t){if(null==e.g)e.g={timestamp:Date.now()/1e3,state:t,duration:0};else{var r=Date.now()/1e3;e.g.duration=r-e.g.timestamp,e.g.state!=t&&(e.h.push(e.g),e.g={timestamp:r,state:t,duration:0})}}function Ms(e,t){var r=0;e.g&&e.g.state==t&&(r+=e.g.duration);for(var n=f(e.h),i=n.next();!i.done;i=n.next())r+=(i=i.value).state==t?i.duration:0;return r}function Ns(){this.h=this.i=null,this.g=[]}function Gs(){this.j=this.C=this.m=this.h=this.o=this.u=this.A=this.l=this.F=NaN,this.g=new Ls,this.i=new Ns}function Vs(e,r){var n=this;Ue.call(this),this.o=Il,this.g=null,this.ub=!1,this.l=new tt,this.Uc=this.u=this.Tb=this.i=this.C=this.j=this.rc=this.L=this.ic=this.J=this.wb=this.A=this.M=this.m=this.X=null,this.re=1e9,this.lc=new Set,this.yb=!0,this.wa=null,this.qe=!1,this.oe=0,this.va=null,this.Z=new ba,this.h=Js(this),this.mc={width:1/0,height:1/0},this.F=null,this.tb=new Ia(this.h.preferredAudioLanguage,this.h.preferredVariantRole,this.h.preferredAudioChannelCount),this.ua=this.h.preferredTextLanguage,this.Xa=this.h.preferredTextRole,this.Wc=[],r&&r(this),this.X=function(e){return new He((function(t,r){e.u&&e.u.segmentDownloaded(t,r)}))}(this),this.l.H(t,"online",(function(){n.Id()})),this.P={name:"detach"},this.da={name:"attach"},this.Qa={name:"unload"},this.nd={name:"manifest-parser"},this.md={name:"manifest"},this.vb={name:"media-source"},this.ad={name:"drm-engine"},this.ea={name:"load"},this.od={name:"src-equals-drm-engine"},this.xb={name:"src-equals"};var i=new Map;i.set(this.da,(function(e,t){return Me(function(e,t,r){return null==t.D&&(t.D=r.D,e.l.H(t.D,"error",(function(){var t=pl(e);t&&e.Va(t)}))),e.g=t.D,Promise.resolve()}(n,e,t))})),i.set(this.P,(function(e){return e.D&&(n.l.ta(e.D,"error"),e.D=null),n.g=null,Me(e=Promise.resolve())})),i.set(this.Qa,(function(e){return Me(Fs(n,e))})),i.set(this.vb,(function(e){return e=function(e,r){return y((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:return i=t.muxjs?new Xt:new Ht,a=e.h.textDisplayFactory,o=new a,e.fd=a,A(n,(s=new _r(r.D,i,o)).C,2);case 2:e.M=s,w(n)}}))}))}(n,e),Me(e)})),i.set(this.nd,(function(e,t){var r=function(e,t,r){return y((function n(){var i,a,o,s;return N(n,(function(n){switch(n.s){case 1:if(t.Ia=r.Ia,t.mimeType=r.mimeType,t.uri=r.uri,i=t.uri,a=e.X,e.Tb=i,t.Ia){e.C=t.Ia(),n.I(2);break}return o=e,A(n,Ti.create(i,a,e.h.manifest.retryParameters,t.mimeType),3);case 3:o.C=n.B;case 2:s=Ze(e.h.manifest),r.D&&"AUDIO"===r.D.nodeName&&(s.disableVideo=!0),e.C.configure(s),w(n)}}))}))}(n,e,t);return Me(r)})),i.set(this.md,(function(e){return function(e,t){var r=t.uri,n=e.X;e.rc=new ao((function(){return e.He()})),function(e,t){e.h=t}(e.rc,(function(t){fl(e,"timelineregionadded",t)}));var i={networkingEngine:n,filterNewPeriod:function(t){return e.Xc(t)},filterAllPeriods:function(t){return Qs(e,t)},onTimelineRegionAdded:function(t){var r=e.rc;e:{for(var n=f(r.g),i=n.next();!i.done;i=n.next())if((i=i.value).schemeIdUri==t.schemeIdUri&&i.id==t.id&&i.startTime==t.startTime&&i.endTime==t.endTime){n=i;break e}n=null}null==n&&(r.g.add(t),r.h(t))},onEvent:function(t){return e.dispatchEvent(t)},onError:function(t){return e.Va(t)}};return new Re(Promise.resolve().then((function(){return y((function t(){var n;return N(t,(function(t){switch(t.s){case 1:return n=e,A(t,e.C.start(r,i),2);case 2:if(n.i=t.B,e.dispatchEvent(new Ge("manifestparsed")),0==e.i.periods.length)throw new z(2,4,4014);!function(e){function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}e.some((function(e){return e.variants.some(t)}))&&(Y.debug("Found variant with audio and video content, so filtering out audio-only content in all periods."),e.forEach((function(e){e.variants=e.variants.filter(t)})))}(e.i.periods),w(t)}}))}))})),(function(){return Y.info("Aborting parser step..."),e.C.stop()}))}(n,e)})),i.set(this.ad,(function(e){return e=function(e,t){return y((function r(){return N(r,(function(r){switch(r.s){case 1:return e.m=js(e,{Ib:e.X,onError:function(t){e.Va(t)},Dc:function(t){yl(e,t)},onExpirationUpdated:function(t,r){ml(e,t,r)},onEvent:function(t){e.dispatchEvent(t)}}),e.m.configure(e.h.drm),A(r,$t(e.m,Ua(e.i.periods),e.i.offlineSessionIds),2);case 2:return A(r,e.m.Ub(t.D),3);case 3:Qs(e,e.i.periods),w(r)}}))}))}(n,e),Me(e)})),i.set(this.ea,(function(e,t){return Me(function(e,t,r){return y((function n(){var i,a,o,s,l,u,c,d,h,p;return N(n,(function(n){switch(n.s){case 1:return t.startTime=r.startTime,i=t.D,a=t.uri,e.Tb=a,e.J=new Fa({wc:function(){return t.D.playbackRate},vc:function(){return t.D.defaultPlaybackRate},Od:function(e){t.D.playbackRate=e},pe:function(e){t.D.currentTime+=e}}),e.F=new Gs,o=function(){return nl(e)},s=function(){return rl(e)},e.l.H(i,"playing",o),e.l.H(i,"pause",o),e.l.H(i,"ended",o),e.l.H(i,"ratechange",s),l=e.h.abrFactory,e.u&&e.Uc==l||(e.Uc=l,e.u=new l,e.u.configure(e.h.abr)),function(e,t){for(var r=0;r<t.length;r++){for(var n=t[r],i=new Map,a=f(n.variants),o=a.next();!o.done;o=a.next())if((o=o.value).video&&o.video.closedCaptions)for(var s=f((o=o.video).closedCaptions.keys()),l=s.next();!l.done;l=s.next())if(l=l.value,!i.has(l)){var u={id:e.re++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:"application/cea-608",codecs:"",kind:"caption",encrypted:!1,keyId:null,language:o.closedCaptions.get(l),label:null,type:"text",primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:o.roles,channelsCount:null,audioSamplingRate:null,closedCaptions:null};i.set(l,u)}for(a=(i=f(i.values())).next();!a.done;a=i.next())n.textStreams.push(a.value)}}(e,e.i.periods),e.tb=new Ia(e.h.preferredAudioLanguage,e.h.preferredVariantRole,e.h.preferredAudioChannelCount),e.ua=e.h.preferredTextLanguage,e.Xa=e.h.preferredTextRole,function(e,t,r){0<t&&(e.aa()?Y.v("|playRangeStart| has been configured for live content. Ignoring the setting."):e.Le(t)),r<e.ha()&&(e.aa()?Y.v("|playRangeEnd| has been configured for live content. Ignoring the setting."):e.Fa(r))}(e.i.presentationTimeline,e.h.playRangeStart,e.h.playRangeEnd),e.u.init((function(t,r,n){r=void 0!==r&&r,n=void 0===n?0:n,Y.debug("switch_");e:{for(var i=f(e.i.periods),a=i.next();!a.done;a=i.next())if((a=a.value).variants.includes(t)){i=a;break e}i=null}Ys(e,i,t,!0),e.j&&go(e.j,t,r,n)&&sl(e)})),e.A=function(e,t){return new to(e.g,e.i,e.h.streaming,t,(function(){e.wb&&Va(e.wb,!0),e.j&&function(e){function t(t){var i=e.g.T;return t="text"==t?null!=(t=i.g).g&&null!=t.h&&r>=t.g&&r<t.h:Yt(t=kr(i,t),r,n)}var r=e.g.eb(),n=e.l.smallGapLimit,i=!1,a=xo(e,r);if(st(e.h.values(),(function(e){return e.oa==a})))for(var o=f(e.h.keys()),s=o.next();!s.done;s=o.next())t(s=s.value)||(bo(e,e.h.get(s)),i=!0);else st(e.h.keys(),t)||(Y.debug("(all): seeked: unbuffered seek: clearing all buffers"),e.h.forEach((function(t){bo(e,t)})),i=!0);i||Y.debug("(all): seeked: buffered seek: presentationTime="+r)}(e.j),e.L&&Xs(e)}),(function(t){return e.dispatchEvent(t)}))}(e,t.startTime),e.wb=function(e){var t=new Ba(e.i);!function(e,t){e.h=t}(t,(function(){ll(e)}));var r=new oo(e.rc);!function(e,t,r,n){e.g=t,e.h=r,e.i=n}(r,(function(t){fl(e,"timelineregionenter",t)}),(function(t){fl(e,"timelineregionexit",t)}),(function(t,r){r||(fl(e,"timelineregionenter",t),fl(e,"timelineregionexit",t))}));var n=new Ga(e.g);return n.g.add(t),n.g.add(r),n}(e),u=Math.max(e.i.minBufferTime,e.h.streaming.rebufferingGoal),Ws(e,u),e.j=function(e){return new co(e.i,{eb:function(){return e.A.l()},getBandwidthEstimate:function(){return e.u.getBandwidthEstimate()},T:e.M,Ib:e.X,ue:e.Vf.bind(e),te:e.Ze.bind(e),onError:e.Va.bind(e),onEvent:function(t){return e.dispatchEvent(t)},Zf:e.$f.bind(e),zd:e.eg.bind(e)})}(e),e.j.configure(e.h.streaming),Ur.$d(e.i,e.h.preferredAudioChannelCount),e.o=Cl,e.dispatchEvent(new Ge("streaming")),A(n,e.j.start(),2);case 2:e.h.streaming.startAtSegmentBoundary&&(c=e.A.l(),d=function(e,t){function r(e,t){if(!e)return null;var r=e.findSegmentPosition(t-a.startTime);return null==r?null:(r=e.getSegmentReference(r))?r.startTime+a.startTime:null}var n=ho(e.j),i=fo(e.j),a=Tl(e);return n=r(n,t),null!=(i=r(i,t))&&null!=n?Math.max(i,n):null!=i?i:null!=n?n:t}(e,c),e.A.A(d)),e.i.periods.forEach(e.Xc.bind(e)),ll(e),sl(e),h=Tl(e)||e.i.periods[0],p=h.variants.some((function(e){return e.primary})),e.h.preferredAudioLanguage||p||Y.v("No preferred audio language set.  We will choose an arbitrary language initially"),il(e,h.variants),e.l.ya(i,"loadedmetadata",(function(){e.F.h=Date.now()/1e3-r.Rd})),w(n)}}))}))}(n,e,t))})),i.set(this.od,(function(e,t){var r=function(e,t,r){return y((function n(){var i,a;return N(n,(function(n){switch(n.s){case 1:return i=pe,e.m=js(e,{Ib:e.X,onError:function(t){e.Va(t)},Dc:function(t){yl(e,t)},onExpirationUpdated:function(t,r){ml(e,t,r)},onEvent:function(t){e.dispatchEvent(t)}}),e.m.configure(e.h.drm),a={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:r.mimeType?r.mimeType.split(";")[0]:"video/mp4",codecs:r.mimeType?dt(r.mimeType):"",encrypted:!0,keyId:null,language:"und",label:null,type:i.Za,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0},A(n,$t(e.m,[a],[]),2);case 2:return A(n,e.m.Ub(t.D),0)}}))}))}(n,e,t);return Me(r)})),i.set(this.xb,(function(e,t){return function(e,t,r){function n(){return nl(e)}if(t.uri=r.uri,t.startTime=r.startTime,e.Tb=t.uri,e.F=new Gs,e.A=new eo(t.D),null!=t.startTime&&e.A.A(t.startTime),e.J=new Fa({wc:function(){return t.D.playbackRate},vc:function(){return t.D.defaultPlaybackRate},Od:function(e){t.D.playbackRate=e},pe:function(e){t.D.currentTime+=e}}),Ws(e,e.h.streaming.rebufferingGoal),e.l.H(t.D,"playing",n),e.l.H(t.D,"pause",n),e.l.H(t.D,"ended",n),e.l.H(t.D,"ratechange",(function(){return rl(e)})),"none"!=e.g.preload&&e.l.ya(t.D,"loadedmetadata",(function(){e.F.h=Date.now()/1e3-r.Rd})),e.g.audioTracks&&(e.l.H(e.g.audioTracks,"addtrack",(function(){return ll(e)})),e.l.H(e.g.audioTracks,"removetrack",(function(){return ll(e)})),e.l.H(e.g.audioTracks,"change",(function(){return ll(e)}))),e.g.textTracks){var i=e.g.textTracks;e.l.H(i,"addtrack",(function(){return ll(e)})),e.l.H(i,"removetrack",(function(){return ll(e)})),e.l.H(i,"change",(function(){return ll(e)}))}t.D.src=t.uri,(mt()||bt("Web0S"))&&t.D.load(),e.o=Pl,e.dispatchEvent(new Ge("streaming"));var a=new me;Wa(e.g,HTMLMediaElement.HAVE_METADATA,e.l,(function(){a.resolve()}));var o=!1;return e.Wc.push((function(){o=!0})),Wa(e.g,HTMLMediaElement.HAVE_CURRENT_DATA,e.l,(function(){return y((function t(){return N(t,(function(t){switch(t.s){case 1:if(o)return t.return();if(function(e){var t=e.h.preferredAudioLanguage;if(""!=t){e.Jd(t);var r=e.h.preferredVariantRole;""!=r&&e.Jd(t,r)}}(e),Ks(e).find((function(e){return"disabled"!=e.mode}))){t.I(2);break}return A(t,new Promise((function(t){e.l.ya(e.g.textTracks,"change",t),new Ce(t).V(1)})),2);case 2:if(o)return t.return();!function(e){var t=e.h.preferredTextLanguage;if(""!=t){e.Kd(t);var r=e.h.preferredTextRole;""!=r&&e.Kd(t,r)}}(e),w(t)}}))}))})),e.g.error?a.reject(pl(e)):"none"==e.g.preload&&(Y.ba('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),a.resolve()),e.l.ya(e.g,"error",(function(){a.reject(pl(e))})),new Re(a,(function(){return a.reject(new z(2,7,7001)),Promise.resolve()}))}(n,e,t)})),this.Ya=new Ss(this.P,{Af:function(e,t,r,i){var a=null;return e==n.P&&(a=r==n.P?n.P:n.da),e==n.da&&(a=r==n.P||t.D!=i.D?n.P:r==n.da?n.da:r==n.vb||r==n.ea?n.vb:r==n.xb?n.od:null),e==n.vb&&(a=r==n.ea&&t.D==i.D?n.nd:n.Qa),e==n.nd&&(a=Al(n.ea,n.md,n.Qa,r,t,i)),e==n.md&&(a=Al(n.ea,n.ad,n.Qa,r,t,i)),e==n.ad&&(a=Al(n.ea,n.ea,n.Qa,r,t,i)),e==n.od&&(a=r==n.xb&&t.D==i.D?n.xb:n.Qa),e!=n.ea&&e!=n.xb||(a=n.Qa),e==n.Qa&&(a=i.D&&t.D==i.D?n.da:n.P),a},ef:function(e,t,r){return n.dispatchEvent(new Ge("onstatechange",{state:e.name})),i.get(e)(t,r)},handleError:function(e,t){return y((function r(){return N(r,(function(r){switch(r.s){case 1:return Y.v("The walker saw an error:"),t instanceof z?Y.v("Error Code:",t.code):(Y.v("Error Message:",t.message),Y.v("Error Stack:",t.stack)),A(r,Fs(n,e),2);case 2:return r.return(e.D?n.da:n.P)}}))}))},Xf:function(e){n.dispatchEvent(new Ge("onstateidle",{state:e.name}))}}),e&&this.Ub(e,!0)}E(os,Jo),os.prototype.updateManifestExpiration=function(e,t){var r=Yo(this.h,this.g),n=r.store(),i=new me;return n.get(e).onsuccess=function(r){(r=r.target.result)?(r.expiration=t,n.put(r),i.resolve()):i.reject(new z(2,9,9012,"Could not find values for "+e))},r.promise().then((function(){return i}))},os.prototype.pc=function(e){return{originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,periods:e.periods.map(ss),sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata}},os.prototype.ae=function(e){return{data:e.data}},E(ds,Jo),ds.prototype.hasFixedKeySpace=function(){return this.j},ds.prototype.addSegments=function(e){return this.j?Qo(this.i):this.add(this.i,e)},ds.prototype.addManifests=function(e){return this.j?Qo(this.g):this.add(this.g,e)},ds.prototype.pc=function(e){return null==e.expiration&&(e.expiration=1/0),e},(i=hs.prototype).init=function(){var e=this,r=new me,n=t.indexedDB.open("shaka_offline_db",4);return n.onsuccess=function(t){t=t.target.result,e.j=t;var n=t.objectStoreNames;n.contains("manifest")&&n.contains("segment")?(Y.debug("Mounting v1 idb storage cell"),n=new os(t,"segment","manifest")):n=null,e.g=n,(n=t.objectStoreNames).contains("manifest-v2")&&n.contains("segment-v2")?(Y.debug("Mounting v2 idb storage cell"),n=new ds(t,"segment-v2","manifest-v2",!0)):n=null,e.h=n,(n=t.objectStoreNames).contains("manifest-v3")&&n.contains("segment-v3")?(Y.debug("Mounting v3 idb storage cell"),n=new ds(t,"segment-v3","manifest-v3",!1)):n=null,e.i=n,t.objectStoreNames.contains("session-ids")?(Y.debug("Mounting session ID idb storage cell"),t=new ts(t)):t=null,e.l=t,r.resolve()},n.onupgradeneeded=function(e){e=e.target.result;for(var t=f(["segment-v3","manifest-v3","session-ids"]),r=t.next();!r.done;r=t.next())r=r.value,e.objectStoreNames.contains(r)||e.createObjectStore(r,{autoIncrement:!0})},n.onerror=function(e){r.reject(new z(2,9,9001,n.error)),e.preventDefault()},r},i.destroy=function(){var e=this;return y((function t(){return N(t,(function(t){switch(t.s){case 1:if(!e.g){t.I(2);break}return A(t,e.g.destroy(),2);case 2:if(!e.h){t.I(4);break}return A(t,e.h.destroy(),4);case 4:if(!e.i){t.I(6);break}return A(t,e.i.destroy(),6);case 6:if(!e.l){t.I(8);break}return A(t,e.l.destroy(),8);case 8:e.j&&e.j.close(),w(t)}}))}))},i.getCells=function(){var e=new Map;return this.g&&e.set("v1",this.g),this.h&&e.set("v2",this.h),this.i&&e.set("v3",this.i),e},i.getEmeSessionCell=function(){return this.l},i.erase=function(){var e=this;return y((function r(){return N(r,(function(r){switch(r.s){case 1:if(!e.g){r.I(2);break}return A(r,e.g.destroy(),2);case 2:if(!e.h){r.I(4);break}return A(r,e.h.destroy(),4);case 4:if(!e.i){r.I(6);break}return A(r,e.i.destroy(),6);case 6:return e.j&&e.j.close(),A(r,function(){var e=new me,r=t.indexedDB.deleteDatabase("shaka_offline_db");return r.onblocked=function(){Y.v("Deleting","shaka_offline_db","is being blocked")},r.onsuccess=function(){e.resolve()},r.onerror=function(t){e.reject(new z(2,9,9001,r.error)),t.preventDefault()},e}(),8);case 8:return e.j=null,e.g=null,e.h=null,e.i=null,A(r,e.init(),0)}}))}))},is("idb",(function(){return bt("CrKey")||!t.indexedDB?null:new hs})),fs.prototype.Ea=function(){return this.l},fs.prototype.ja=function(){return this.j},fs.prototype.key=function(){return this.i},fs.prototype.toString=function(){return this.h},(i=bs.prototype).configure=function(){},i.start=function(e){var t=this;return y((function r(){var n,i,a,o,s;return N(r,(function(r){switch(r.s){case 1:return n=ps(e),t.g=n,null==n||"manifest"!=n.g?r.return(Promise.reject(new z(2,1,9004,n))):(i=new rs,I(r,2),A(r,i.init(),4));case 4:return A(r,ns(i,n.Ea(),n.ja()),5);case 5:return A(r,r.B.getManifests([n.key()]),6);case 6:return a=r.B,o=a[0],s=new ys(n.Ea(),n.ja()),r.return(function(e,t){var r=new Si(null,0);r.Fa(t.duration);var n=t.periods.map((function(t){return ms(e,t,r)})),i=t.drmInfo?[t.drmInfo]:[];return t.drmInfo&&n.forEach((function(e){e.variants.forEach((function(e){e.drmInfos=i}))})),{presentationTimeline:r,minBufferTime:2,offlineSessionIds:t.sessionIds,periods:n}}(s,o));case 2:return x(r),A(r,i.destroy(),7);case 7:R(r,0)}}))}))},i.stop=function(){return Promise.resolve()},i.update=function(){},i.onExpirationUpdated=function(e,t){var r=this;return y((function n(){var i,a,o,s,l,u,c,d;return N(n,(function(n){switch(n.s){case 1:return i=r.g,a=new rs,k(n,2,3),A(n,a.init(),5);case 5:return A(n,ns(a,i.Ea(),i.ja()),6);case 6:return A(n,(o=n.B).getManifests([i.key()]),7);case 7:if(s=n.B,l=s[0],u=l.sessionIds.includes(e),c=null==l.expiration||l.expiration>t,!u||!c){n.I(3);break}return Y.debug("Updating expiration for stored content"),A(n,o.updateManifestExpiration(i.key(),t),3);case 3:return x(n),A(n,a.destroy(),10);case 10:R(n,0);break;case 2:d=P(n),Y.error("There was an error updating",i,d),n.I(3)}}))}))},Ti.Qb("application/x-offline-manifest",bs),F("shaka.offline.OfflineScheme",_s),_s.m=function(e){return De(e={uri:e,Bd:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}})},_s.o=function(e,t){var r=new rs;return De(void 0).ca((function(){return r.init()})).ca((function(){return ns(r,t.Ea(),t.ja())})).ca((function(e){return e.getSegments([t.key()])})).ca((function(e){return{uri:t,Bd:t,data:e[0].data,headers:{}}})).finally((function(){return r.destroy()}))},Ye("offline",_s),Ss.prototype.destroy=function(){var e=this;return y((function t(){return N(t,(function(t){switch(t.s){case 1:return e.u=!1,e.h&&e.h.abort(),As(e),A(t,e.A,2);case 2:e.g&&e.g.Da.kb();for(var r=f(e.l),n=r.next();!n.done;n=r.next())n.value.Da.kb();e.g=null,e.l=[],e.m=null,w(t)}}))}))},F("shaka.text.SimpleTextDisplayer",ws),ws.prototype.remove=function(e,t){return!!this.g&&(Is(this.g,(function(r){return r.startTime<t&&r.endTime>e})),!0)},ws.prototype.remove=ws.prototype.remove,ws.prototype.append=function(e){var t=ks,r=e.map((function(e){if(e.nestedCues.length){var t=e.nestedCues.map((function(e){return e.spacer?"\n":e.payload+" "})).join("").replace(/ $/m,"");(e=e.clone()).nestedCues=[],e.payload=t}return e})),n=[];e=this.g.cues?Array.from(this.g.cues):[];for(var i={},a=(r=f(r)).next();!a.done;i={Fb:i.Fb},a=r.next())i.Fb=a.value,e.some(function(e){return function(t){return t.startTime==e.Fb.startTime&&t.endTime==e.Fb.endTime&&t.text==e.Fb.payload}}(i))||(a=t(i.Fb))&&n.push(a);n.slice().sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:"line"in VTTCue.prototype?n.indexOf(t)-n.indexOf(e):n.indexOf(e)-n.indexOf(t)})).forEach(function(e){this.g.addCue(e)}.bind(this))},ws.prototype.append=ws.prototype.append,ws.prototype.destroy=function(){return this.g&&Is(this.g,(function(){return!0})),this.g=null,Promise.resolve()},ws.prototype.destroy=ws.prototype.destroy,ws.prototype.isTextVisible=function(){return"showing"==this.g.mode},ws.prototype.isTextVisible=ws.prototype.isTextVisible,ws.prototype.setTextVisibility=function(e){this.g.mode=e?"showing":"hidden"},ws.prototype.setTextVisibility=ws.prototype.setTextVisibility,F("shaka.util.ConfigUtils.mergeConfigObjects",Cs),F("shaka.util.ConfigUtils.convertToConfigObject",Ps),F("shaka.util.PlayerConfiguration",xs),xs.mergeConfigObjects=Os,j(Vs,Ue),F("shaka.Player",Vs),Vs.prototype.destroy=function(){var e=this;return y((function t(){var r;return N(t,(function(t){switch(t.s){case 1:return e.o==kl?t.return():(e.o=kl,r=$s(e.Ya,(function(){return{node:e.P,payload:{Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},gb:!1}})),A(t,new Promise((function(t){r.Kb=function(){Y.info("Preparing to destroy walker...")},r.Cc=function(){t(),e.dispatchEvent(new Ge("loaded"))},r.kb=function(){t()},r.onError=function(){t()},r.Ec=function(){t()}})),2));case 2:return A(t,e.Ya.destroy(),3);case 3:if(e.l&&(e.l.release(),e.l=null),e.Uc=null,e.u=null,e.h=null,!e.X){t.I(0);break}return A(t,e.X.destroy(),5);case 5:e.X=null,w(t)}}))}))},Vs.prototype.destroy=Vs.prototype.destroy,Vs.version="v2.5.23";var Us=["2","5"];Hr=new function(e){this.g=e,this.i=Wr,this.h=Xr}(new Fr(Number(Us[0]),Number(Us[1])));var Zs=["output-restricted","internal-error"],Bs={};function Fs(e,t){return y((function r(){var n;return N(r,(function(r){switch(r.s){case 1:return e.o!=kl&&(e.o=Il),n=e.Wc.map((function(e){return e()})),e.Wc=[],A(r,Promise.all(n),2);case 2:if(e.dispatchEvent(new Ge("unloading")),t.Ia=null,t.mimeType=null,t.startTime=null,t.uri=null,t.D&&(e.l.ta(t.D,"loadedmetadata"),e.l.ta(t.D,"playing"),e.l.ta(t.D,"pause"),e.l.ta(t.D,"ended"),e.l.ta(t.D,"ratechange")),e.wb&&(e.wb.release(),e.wb=null),e.ic&&(e.ic.stop(),e.ic=null),!e.C){r.I(3);break}return A(r,e.C.stop(),4);case 4:e.C=null;case 3:if(!e.u){r.I(5);break}return A(r,e.u.stop(),5);case 5:if(!e.j){r.I(7);break}return A(r,e.j.destroy(),8);case 8:e.j=null;case 7:if(e.J&&(e.J.release(),e.J=null),e.A&&(e.A.release(),e.A=null),!e.M){r.I(9);break}return A(r,e.M.destroy(),10);case 10:e.M=null;case 9:if(!t.D||!t.D.src){r.I(11);break}return A(r,new Promise((function(e){return new Ce(e).V(.1)})),12);case 12:t.D.removeAttribute("src"),t.D.load();case 11:if(!e.m){r.I(13);break}return A(r,e.m.destroy(),14);case 14:e.m=null;case 13:e.Z.g.clear(),e.Tb=null,e.L=null,e.lc.clear(),e.i=null,e.F=null,e.fd=null,e.yb=!0,tl(e),w(r)}}))}))}function js(e,t){return new St(t,e.h.drm.updateExpirationTime)}function Ws(e,t){e.L=new Ca,e.L.g=xa,Pa(e.L,t,Math.min(.5,t/2)),tl(e),e.ic=new Ce((function(){Xs(e)})).Oa(.25)}function Xs(e){switch(e.o){case Pl:var t=!!e.g.ended||Kt(e.g.buffered)>=e.g.duration-1;break;case Cl:e:if(e.g.ended||$r(e.M))t=!0;else{if(e.i.presentationTimeline.aa()){var r=e.i.presentationTimeline.Db();if(Kt(e.g.buffered)>=r){t=!0;break e}}t=!1}break;default:t=!1}var n=zt(e.g.buffered,e.g.currentTime),i=t,a=(r=e.L).h.get(r.g);t=r.g,n=i||n>=a?Ra:xa,r.g=n,t!=n&&tl(e)}function Hs(e){if(e.C){var t=Ze(e.h.manifest);e.g&&"AUDIO"===e.g.nodeName&&(t.disableVideo=!0),e.C.configure(t)}if(e.m&&e.m.configure(e.h.drm),e.j){e.j.configure(e.h.streaming);try{e.i.periods.forEach(e.Xc.bind(e))}catch(a){e.Va(a)}var r=ho(e.j),n=fo(e.j);t=Tl(e),r=Ur.ie(r,n,t.variants),e.u&&r&&r.allowedByApplication&&r.allowedByKeySystem?il(e,t.variants):(Y.debug("Choosing new streams after changing configuration"),al(e,t))}if(e.M&&(t=e.h.textDisplayFactory,e.fd!=t)){r=new t;var i=(n=e.M).l;n.l=r,i&&(r.setTextVisibility(i.isTextVisible()),i.destroy()),n.g&&(n.g.i=r),e.fd=t,e.j&&(r=(t=e.j).h.get("text"))&&vo(t,r.stream,!0,0,!0)}e.u&&(e.u.configure(e.h.abr),e.h.abr.enabled&&!e.yb?e.u.enable():e.u.disable(),hl(e)),e.L&&(t=e.h.streaming.rebufferingGoal,e.i&&(t=Math.max(t,e.i.minBufferTime)),Pa(e.L,t,Math.min(.5,t/2)))}function Ks(e){return Array.from(e.g.textTracks).filter((function(e){return"metadata"!=e.kind&&"chapters"!=e.kind&&"Shaka Player TextTrack"!=e.label}))}function Ys(e,t,r,n){Ea(e.Z,t).variant=r,(e=e.F.i).i!=r&&(e.i=r,e.g.push({timestamp:Date.now()/1e3,id:r.id,type:"variant",fromAdaptation:n,bandwidth:r.bandwidth}))}function zs(e,t,r,n){_a(e.Z,t,r),(e=e.F.i).h!=r&&(e.h=r,e.g.push({timestamp:Date.now()/1e3,id:r.id,type:"text",fromAdaptation:n,bandwidth:null}))}function Js(e){var t=Rs();return t.streaming.failureCallback=function(t){e.aa()&&[1001,1002,1003].includes(t.code)&&(t.severity=1,Y.v("Live streaming error.  Retrying automatically..."),e.Id())},t.textDisplayFactory=function(){return new ws(e.g)},t}function Qs(e,t){var r=e.j?ho(e.j):null,n=e.j?fo(e.j):null;if(t.forEach(Ur.filterNewPeriod.bind(null,e.m,r,n)),r=function(e,t){var r=0;return e.forEach((function(e){r+=t(e)?1:0})),r}(t,(function(e){return e.variants.some(Ur.Gb)})),0==r)throw new z(2,4,4032);if(r<t.length)throw new z(2,4,4011);t.forEach(function(e){Ur.Xd(e.variants,this.h.restrictions,this.mc)&&this.j&&Tl(this)==e&&ll(this),gl(this,e.variants)}.bind(e))}function qs(e,t,r,n){return r=void 0!==r&&r,n=void 0===n?0:n,e.yb?(e.wa=t,e.qe=r,e.oe=n,!0):((t=go(e.j,t,r,n))&&ul(e),t)}function el(e,t){if(e.yb)return e.va=t,!0;var r=vo(e.j,t,!0,0,!1);return r&&cl(e),r}function tl(e){var t=e.jd();if(e.F&&e.L&&e.A){var r=e.J;r.j=t,ja(r),nl(e)}e.dispatchEvent(new Ge("buffering",{buffering:t}))}function rl(e){var t=e.g.playbackRate;0!=t&&e.J.set(t)}function nl(e){if(e.F&&e.L){var t=e.F.g;e.L.g==xa?Ds(t,"buffering"):e.g.paused?Ds(t,"paused"):e.g.ended?Ds(t,"ended"):Ds(t,"playing")}}function il(e,t){try{gl(e,t)}catch(n){return e.Va(n),null}var r=t.filter((function(e){return Ur.Gb(e)}));return r=e.tb.create(r),e.u.setVariants(Array.from(r.values())),e.u.chooseVariant()}function al(e,t){var r=ol(e,t,!1),n=Ur.Wb(t.textStreams,e.ua,e.Xa)[0]||null,i=!1;n&&(e.h.streaming.alwaysStreamText||e.zc())&&(zs(e,t,n,!0),i=el(e,n)),(r||i)&&sl(e)}function ol(e,t,r){r=void 0===r||r;var n=il(e,t.variants),i=!1;return n&&(Ys(e,t,n,!0),i=qs(e,n,!0)),r&&i&&sl(e),i}function sl(e){vl(e,new Ge("adaptation"))}function ll(e){vl(e,new Ge("trackschanged"))}function ul(e){vl(e,new Ge("variantchanged"))}function cl(e){vl(e,new Ge("textchanged"))}function dl(e){vl(e,new Ge("texttrackvisibility"))}function hl(e){vl(e,new Ge("abrstatuschanged",{Zg:e.h.abr.enabled}))}function fl(e,t,r){e.dispatchEvent(new Ge(t,{detail:{schemeIdUri:r.schemeIdUri,value:r.value,startTime:r.startTime,endTime:r.endTime,id:r.id,eventElement:r.eventElement}}))}function pl(e){if(!e.g.error)return null;var t=e.g.error.code;if(1==t)return null;var r=e.g.error.msExtendedCode;return r&&(0>r&&(r+=Math.pow(2,32)),r=r.toString(16)),new z(2,3,3016,t,r,e.g.error.message)}function yl(e,t){if(e.j){var r=Tl(e),n=!1,i=Object.keys(t);0==i.length&&Y.v("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var a=1==i.length&&"00"==i[0];a&&Y.v("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks."),i.length&&e.i.periods.forEach((function(e){e.variants.forEach((function(e){Ur.Kf(e).forEach((function(r){var i=e.allowedByKeySystem;r.keyId&&(r=t[a?"00":r.keyId],e.allowedByKeySystem=!!r&&!Zs.includes(r)),i!=e.allowedByKeySystem&&(n=!0)}))}))})),i=ho(e.j);var o=fo(e.j);(i=Ur.ie(i,o,r.variants))&&!i.allowedByKeySystem&&(Y.debug("Choosing new variants after key status changed"),ol(e,r)),n&&(ll(e),il(e,r.variants))}}function ml(e,t,r){e.C&&e.C.onExpirationUpdated&&e.C.onExpirationUpdated(t,r),e.dispatchEvent(new Ge("expirationupdated"))}function gl(e,t){var r=e.m?ut(e.m.da):{},n=Object.keys(r);n=n.length&&"00"==n[0];for(var i=!1,a=!1,o=[],s=[],l=f(t),u=l.next();!u.done;u=l.next()){var c=[];(u=u.value).audio&&c.push(u.audio),u.video&&c.push(u.video);for(var d=(c=f(c)).next();!d.done;d=c.next())if((d=d.value).keyId){var h=r[n?"00":d.keyId];h?Zs.includes(h)&&(s.includes(h)||s.push(h)):o.includes(d.keyId)||o.push(d.keyId)}u.allowedByApplication?u.allowedByKeySystem&&(i=!0):a=!0}if(!i)throw new z(2,4,4012,{hasAppRestrictions:a,missingKeys:o,restrictedKeyStatuses:s})}function vl(e,t){y((function r(){return N(r,(function(r){switch(r.s){case 1:return A(r,Promise.resolve(),2);case 2:e.o!=kl&&e.dispatchEvent(t),w(r)}}))}))}function bl(e){for(var t=new Set,r=(e=f(e)).next();!r.done;r=e.next())(r=r.value).language?t.add(Mr(r.language)):t.add("und");return t}function _l(e){for(var t=new Map,r=(e=f(e)).next();!r.done;r=e.next()){var n=r.value;r="und";var i=[];for(n.language&&(r=Mr(n.language)),(i="variant"==n.type?n.audioRoles:n.roles)&&i.length||(i=[""]),t.has(r)||t.set(r,new Set),i=(n=f(i)).next();!i.done;i=n.next())i=i.value,t.get(r).add(i)}var a=[];return t.forEach((function(e,t){for(var r=f(e),n=r.next();!n.done;n=r.next())a.push({language:t,role:n.value})})),a}function El(e){return null==(e=Tl(e))?[]:e.variants.filter((function(e){return Ur.Gb(e)}))}function Tl(e){for(var t=e.A.l(),r=null,n=(e=f(e.i.periods)).next();!n.done;n=e.next())(n=n.value).startTime<=t&&(r=n);return r}function Sl(e){var t=Tl(e);return Ea(e.Z,t).variant}function $l(){return new z(2,7,7e3)}function Al(e,t,r,n,i,a){return n==e&&i.D==a.D&&i.uri==a.uri&&i.mimeType==a.mimeType&&i.Ia==a.Ia?t:r}function wl(e){return new Promise((function(t,r){e.kb=function(){return r($l())},e.Cc=function(){return t()},e.onError=function(e){return r(e)},e.Ec=function(){return r($l())}}))}Vs.registerSupportPlugin=function(e,t){Bs[e]=t},Vs.isBrowserSupported=function(){if(!(t.Promise&&t.Uint8Array&&Array.prototype.forEach))return!1;var e=vt();return!(e&&12>e||!(t.MediaKeys&&t.navigator&&t.navigator.requestMediaKeySystemAccess&&t.MediaKeySystemAccess&&t.MediaKeySystemAccess.prototype.getConfiguration))&&(!!pt()||yt("application/x-mpegurl"))},Vs.probeSupport=function(){return Nt().then((function(e){for(var t=Ti.ng(),r={},n=f('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),i=n.next();!i.done;i=n.next()){r[i=i.value]=pt()?!!gr(i)||MediaSource.isTypeSupported(i)||we(i):yt(i);var a=i.split(";")[0];r[a]=r[a]||r[i]}for(var o in e={manifest:t,media:r,drm:e},Bs)e[o]=Bs[o]();return e}))},Vs.prototype.Ub=function(e,t){if(t=void 0===t||t,this.o==kl)return Promise.reject($l());var r={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null};r.D=e,pt()||(t=!1);var n=t?this.vb:this.da,i=$s(this.Ya,(function(){return{node:n,payload:r,gb:!1}}));return i.Kb=function(){return Y.info("Starting attach...")},wl(i)},Vs.prototype.attach=Vs.prototype.Ub,Vs.prototype.detach=function(){var e=this;if(this.o==kl)return Promise.reject($l());var t=$s(this.Ya,(function(){return{node:e.P,payload:{Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},gb:!1}}));return t.Kb=function(){return Y.info("Starting detach...")},wl(t)},Vs.prototype.detach=Vs.prototype.detach,Vs.prototype.Ud=function(e){var t=this;if(e=void 0===e||e,this.o==kl)return Promise.reject($l());pt()||(e=!1);var r={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null},n=$s(this.Ya,(function(n){var i=n.D&&e?t.vb:n.D?t.da:t.P;return r.D=n.D,{node:i,payload:r,gb:!1}}));return n.Kb=function(){return Y.info("Starting unload...")},wl(n)},Vs.prototype.unload=Vs.prototype.Ud,Vs.prototype.load=function(e,t,r){if(this.o==kl)return Promise.reject($l());this.dispatchEvent(new Ge("loading"));var n={Ia:null,D:null,mimeType:null,startTime:null,Rd:null,uri:null};n.uri=e,n.Rd=Date.now()/1e3,r&&"string"!=typeof r&&(jr("Loading with a manifest parser factory","Please register a manifest parser and for the mime-type."),n.Ia=function(){return new r}),r&&"string"==typeof r&&(n.mimeType=r),void 0!==t&&(n.startTime=t);var i=function(e,t){if(t.Ia)return!1;if(!pt())return!0;var r=t.mimeType,n=t.uri||"";return r||(r={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"}[Ti.getExtension(n)]),!!r&&""!=(t.D||_t()).canPlayType(r)&&(!Ti.isSupported(n,r)||gt()&&e.h.streaming.useNativeHlsOnSafari)}(this,n)?this.xb:this.ea,a=$s(this.Ya,(function(e){return null==e.D?null:(n.D=e.D,{node:i,payload:n,gb:!0})}));return a.Kb=function(){return Y.info("Starting load of "+e+"...")},new Promise((function(e,t){a.Ec=function(){return t(new z(2,7,7002))},a.Cc=function(){return e()},a.kb=function(){return t($l())},a.onError=function(e){return t(e)}}))},Vs.prototype.load=Vs.prototype.load,Vs.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=Ps(e,t));var r=Os(this.h,e,Js(this));return Hs(this),r},Vs.prototype.configure=Vs.prototype.configure,Vs.prototype.getConfiguration=function(){var e=Js(this);return Os(e,this.h,Js(this)),e},Vs.prototype.getConfiguration=Vs.prototype.getConfiguration,Vs.prototype.vg=function(){for(var e in this.h)delete this.h[e];Os(this.h,Js(this),Js(this)),Hs(this)},Vs.prototype.resetConfiguration=Vs.prototype.vg,Vs.prototype.tf=function(){return this.o},Vs.prototype.getLoadMode=Vs.prototype.tf,Vs.prototype.yf=function(){return this.g},Vs.prototype.getMediaElement=Vs.prototype.yf,Vs.prototype.Yb=function(){return this.X},Vs.prototype.getNetworkingEngine=Vs.prototype.Yb,Vs.prototype.tc=function(){return this.Tb},Vs.prototype.getAssetUri=Vs.prototype.tc,Vs.prototype.wf=function(){return jr("getManifestUri",'Please use "getAssetUri" instead.'),this.tc()},Vs.prototype.getManifestUri=Vs.prototype.wf,Vs.prototype.aa=function(){return this.i?this.i.presentationTimeline.aa():!(!this.g||!this.g.src)&&1/0==this.g.duration},Vs.prototype.isLive=Vs.prototype.aa,Vs.prototype.ib=function(){return!!this.i&&this.i.presentationTimeline.ib()},Vs.prototype.isInProgress=Vs.prototype.ib,Vs.prototype.Qf=function(){if(this.i){if(!this.i.periods.length)return!1;var e=this.i.periods[0].variants;return!!e.length&&!e[0].video}return!(!this.g||!this.g.src)&&(this.g.videoTracks?0==this.g.videoTracks.length:0==this.g.videoHeight)},Vs.prototype.isAudioOnly=Vs.prototype.Qf,Vs.prototype.He=function(){if(this.i){var e=this.i.presentationTimeline;return{start:e.Cb(),end:e.Ka()}}return this.g&&this.g.src&&(e=this.g.seekable).length?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},Vs.prototype.seekRange=Vs.prototype.He,Vs.prototype.keySystem=function(){return Ct(this.drmInfo())},Vs.prototype.keySystem=Vs.prototype.keySystem,Vs.prototype.drmInfo=function(){return this.m?this.m.g:null},Vs.prototype.drmInfo=Vs.prototype.drmInfo,Vs.prototype.Xb=function(){return this.m?this.m.Xb():1/0},Vs.prototype.getExpiration=Vs.prototype.Xb,Vs.prototype.jd=function(){return!!this.L&&this.L.g==xa},Vs.prototype.isBuffering=Vs.prototype.jd,Vs.prototype.Cf=function(){if(this.J){var e=this.J;e=e.j?0:e.i}else e=0;return e},Vs.prototype.getPlaybackRate=Vs.prototype.Cf,Vs.prototype.Mg=function(e){0==e?Y.ba("A trick play rate of 0 is unsupported!"):(this.g.paused&&this.g.play(),this.J&&this.J.set(e),this.o==Cl&&mo(this.j,1<Math.abs(e)))},Vs.prototype.trickPlay=Vs.prototype.Mg,Vs.prototype.$e=function(){var e=this.J.vc();this.o==Pl&&this.J.set(e),this.o==Cl&&(this.J.set(e),mo(this.j,!1))},Vs.prototype.cancelTrickPlay=Vs.prototype.$e,Vs.prototype.ed=function(){if(this.i&&this.A){for(var e=Sl(this),t=[],r=f(El(this)),n=r.next();!n.done;n=r.next()){n=n.value;var i=Ur.Oc(n);i.active=n==e,t.push(i)}return t}return this.g&&this.g.audioTracks?Array.from(this.g.audioTracks).map((function(e){return Ur.je(e)})):[]},Vs.prototype.getVariantTracks=Vs.prototype.ed,Vs.prototype.Eb=function(){if(this.i&&this.A){for(var e=function(e){var t=Tl(e);if(null==t)return null;if(!Ea(e.Z,t).text){var r=Ur.Wb(t.textStreams,e.ua,e.Xa);r.length&&_a(e.Z,t,r[0])}return Ea(e.Z,t).text}(this),t=[],r=f(function(e){var t=Tl(e);return null==t?[]:t.textStreams.filter((function(t){return!e.lc.has(t)}))}(this)),n=r.next();!n.done;n=r.next()){n=n.value;var i=Ur.Kc(n);i.active=n==e,t.push(i)}return t}return this.g&&this.g.src&&this.g.textTracks?Ks(this).map((function(e){return Ur.Of(e)})):[]},Vs.prototype.getTextTracks=Vs.prototype.Eb,Vs.prototype.Ld=function(e){if(this.i&&this.j){var t=Tl(this),r=t.textStreams.find((function(t){return t.id==e.id}));r?(zs(this,t,r,!1),el(this,r),this.ua=r.language):Y.error("No stream with id",e.id)}else if(this.g&&this.g.src&&this.g.textTracks){for(r=(t=f(t=Ks(this))).next();!r.done;r=t.next())r=r.value,Ur.gd(r)==e.id?r.mode=this.ub?"showing":"hidden":r.mode="disabled";cl(this)}},Vs.prototype.selectTextTrack=Vs.prototype.Ld,Vs.prototype.xg=function(){jr("selectEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.");var e=this.Eb().filter((function(e){return"application/cea-608"==e.mimeType}));0<e.length?this.Ld(e[0]):Y.v("Unable to find the text track embedded in the video.")},Vs.prototype.selectEmbeddedTextTrack=Vs.prototype.xg,Vs.prototype.Rg=function(){jr("usingEmbeddedTextTrack","If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.");var e=this.Eb().filter((function(e){return e.active}))[0];return!!e&&"application/cea-608"==e.mimeType},Vs.prototype.usingEmbeddedTextTrack=Vs.prototype.Rg,Vs.prototype.Ie=function(e,t,r){if(r=void 0===r?0:r,this.i&&this.j){var n=Tl(this);this.h.abr.enabled&&Y.ba("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var i=n.variants.find((function(t){return t.id==e.id}));i?Ur.Gb(i)?(Ys(this,n,i,!1),qs(this,i,t,r),this.tb=new ka(i),il(this,n.variants)):Y.error("Unable to switch to restricted track",e.id):Y.error("No variant with id",e.id)}else if(this.g&&this.g.audioTracks){for(r=(t=f(t=Array.from(this.g.audioTracks))).next();!r.done;r=t.next())r=r.value,Ur.gd(r)==e.id&&(r.enabled=!0);ul(this)}},Vs.prototype.selectVariantTrack=Vs.prototype.Ie,Vs.prototype.nf=function(){return _l(this.ed())},Vs.prototype.getAudioLanguagesAndRoles=Vs.prototype.nf,Vs.prototype.Jf=function(){return _l(this.Eb())},Vs.prototype.getTextLanguagesAndRoles=Vs.prototype.Jf,Vs.prototype.mf=function(){return Array.from(bl(this.ed()))},Vs.prototype.getAudioLanguages=Vs.prototype.mf,Vs.prototype.If=function(){return Array.from(bl(this.Eb()))},Vs.prototype.getTextLanguages=Vs.prototype.If,Vs.prototype.Jd=function(e,t){if(this.i&&this.A){var r=Tl(this);if(this.tb=new Ia(e,t||"",0,""),!this.h.abr.enabled){var n=function(e,t){return e.video||t.video?e.video&&t.video?Math.abs((e.video.height||0)-(t.video.height||0))+Math.abs((e.video.width||0)-(t.video.width||0)):1/0:0},i=Tl(this)||this.i.periods[0],a=Ea(this.Z,i).variant,o=this.tb.create(i.variants);i=null;for(var s=(o=f(o.values())).next();!s.done;s=o.next())s=s.value,(!i||n(i,a)>n(s,a))&&(i=s);if(i)return r=Ur.Oc(i),void this.Ie(r,!0)}ol(this,r)}else if(this.g&&this.g.audioTracks){for(i=Array.from(this.g.audioTracks),r=Mr(e),a=n=null,o=(i=f(i)).next();!o.done;o=i.next())o=o.value,Mr((s=Ur.je(o)).language)==r&&(n=o,t?s.roles.includes(t)&&(a=o):0==s.roles.length&&(a=o));a?(a.enabled=!0,ul(this)):n&&(n.enabled=!0,ul(this))}},Vs.prototype.selectAudioLanguage=Vs.prototype.Jd,Vs.prototype.Kd=function(e,t){if(this.i&&this.A){var r=Tl(this);this.ua=e,this.Xa=t||"";var n=Ur.Wb(r.textStreams,this.ua,this.Xa)[0]||null;n&&(zs(this,r,n,!1),(this.h.streaming.alwaysStreamText||this.zc())&&el(this,n))}else{var i=Mr(e);(r=this.Eb().filter((function(e){return Mr(e.language)==i&&(!t||e.roles.includes(t))}))[0])&&this.Ld(r)}},Vs.prototype.selectTextLanguage=Vs.prototype.Kd,Vs.prototype.yg=function(e){if(this.i&&this.A){for(var t=Tl(this),r=null,n=f(El(this)),i=n.next();!i.done;i=n.next())if((i=i.value).audio.label==e){r=i;break}null==r?Y.v("No variants were found with label: "+e+". Ignoring the request to switch."):(this.tb=new Ia(r.language,"",0,e),ol(this,t))}},Vs.prototype.selectVariantsByLabel=Vs.prototype.yg,Vs.prototype.zc=function(){var e=this.ub;return this.M?this.M.l.isTextVisible():this.g&&this.g.src&&this.g.textTracks?Ks(this).some((function(e){return"showing"==e.mode})):e},Vs.prototype.isTextTrackVisible=Vs.prototype.zc,Vs.prototype.Bg=function(e){var t=this;return y((function r(){var n,i,a,o;return N(r,(function(r){switch(r.s){case 1:if(t.ub==(n=!!e))return r.return();if(t.ub=n,t.o!=Cl){if(t.g&&t.g.src&&t.g.textTracks)for(var s=f(Ks(t)),l=s.next();!l.done;l=s.next())"disabled"!=(i=l.value).mode&&(i.mode=n?"showing":"hidden");r.I(2);break}if(t.M.l.setTextVisibility(n),t.h.streaming.alwaysStreamText){r.I(2);break}if(!n){!function(e){e.L=!0;var t=e.h.get("text");t&&(Mo(t),No(t).catch((function(){})),e.h.delete("text"))}(t.j),r.I(2);break}if(po(t.j,"text")){r.I(2);break}if(a=Tl(t),!(0<(o=Ur.Wb(a.textStreams,t.ua,t.Xa)).length)){r.I(2);break}return A(r,yo(t.j,o[0]),2);case 2:dl(t),w(r)}}))}))},Vs.prototype.setTextTrackVisibility=Vs.prototype.Bg,Vs.prototype.Ef=function(){if(!this.aa())return Y.v("getPlayheadTimeAsDate is for live streams!"),null;var e=this.Ya.j,t=0;if(this.A)t=this.A.l();else if(e){if(null==e.startTime)return new Date;t=e.startTime}return this.i?new Date(1e3*(this.i.presentationTimeline.j+this.g.currentTime)):this.g&&this.g.getStartDate?(e=this.g.getStartDate(),isNaN(e.getTime())?(Y.v("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(e.getTime()+1e3*t)):(Y.v("No way to get playhead time as Date!"),null)},Vs.prototype.getPlayheadTimeAsDate=Vs.prototype.Ef,Vs.prototype.Gf=function(){if(!this.aa())return Y.v("getPresentationStartTimeAsDate is for live streams!"),null;if(this.i)return new Date(1e3*this.i.presentationTimeline.j);if(this.g&&this.g.getStartDate){var e=this.g.getStartDate();return isNaN(e.getTime())?(Y.v("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):e}return Y.v("No way to get presentation start time as Date!"),null},Vs.prototype.getPresentationStartTimeAsDate=Vs.prototype.Gf,Vs.prototype.bd=function(){var e={total:[],audio:[],video:[],text:[]};return this.o==Pl&&(e.total=Jt(this.g.buffered)),this.o==Cl&&this.M.bd(e),e},Vs.prototype.getBufferedInfo=Vs.prototype.bd,Vs.prototype.getStats=function(){if(this.o!=Cl&&this.o!=Pl)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,switchHistory:[],stateHistory:[]};nl(this);var e=this.g;if(e.getVideoPlaybackQuality){e=e.getVideoPlaybackQuality();var t=this.F,r=Number(e.totalVideoFrames);t.A=Number(e.droppedVideoFrames),t.u=r,this.F.o=Number(e.corruptedVideoFrames)}e=this.m&&(e=this.m).P?e.P:NaN,this.F.m=e,this.o==Cl&&((e=Sl(this))&&(this.F.C=e.bandwidth),e&&e.video&&(t=this.F,r=e.video.height||NaN,t.F=e.video.width||NaN,t.l=r),e=this.u.getBandwidthEstimate(),this.F.j=e);var n=this.F;e=n.F,t=n.l,r=n.C;for(var i=n.u,a=n.A,o=n.o,s=n.j,l=n.h,u=Ms(n.g,"playing"),c=Ms(n.g,"paused"),d=Ms(n.g,"buffering"),h=n.m,p=function(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var r=[],n=f(e.h),i=n.next();!i.done;i=n.next())r.push(t(i.value));return e.g&&r.push(t(e.g)),r}(n.g),y=[],m=(n=f(n.i.g)).next();!m.done;m=n.next())m=m.value,y.push({timestamp:m.timestamp,id:m.id,type:m.type,fromAdaptation:m.fromAdaptation,bandwidth:m.bandwidth});return{width:e,height:t,streamBandwidth:r,decodedFrames:i,droppedFrames:a,corruptedFrames:o,estimatedBandwidth:s,loadLatency:l,playTime:u,pauseTime:c,bufferingTime:d,licenseTime:h,stateHistory:p,switchHistory:y}},Vs.prototype.getStats=Vs.prototype.getStats,Vs.prototype.addTextTrack=function(e,t,r,n,i,a){var o=this;return y((function s(){var l,u,c,d,h,f,p,y,m;return N(s,(function(s){switch(s.s){case 1:if(o.o==Pl)throw Y.error("Cannot add text when loaded with src="),Error("State error!");if(o.o!=Cl)throw Y.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");if(l=Tl(o),u=pe,c=o.i.periods.indexOf(l),h=(d=c+1)>=o.i.periods.length?o.i.presentationTimeline.ha():o.i.periods[d].startTime,1/0==(f=h-l.startTime))throw new z(1,4,4033);return p=new ii(1,0,f,(function(){return[e]}),0,null),y={id:o.re++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(e){return 1==e?p:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:n,codecs:i||"",kind:r,encrypted:!1,keyId:null,language:t,label:a||null,type:u.za,primary:!1,frameRate:void 0,pixelAspectRatio:void 0,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},o.lc.add(y),l.textStreams.push(y),A(s,yo(o.j,y),2);case 2:return(m=po(o.j,"text"))&&_a(o.Z,l,m),o.lc.delete(y),Y.debug("Choosing new streams after adding a text stream"),al(o,l),ll(o),s.return(Ur.Kc(y))}}))}))},Vs.prototype.addTextTrack=Vs.prototype.addTextTrack,Vs.prototype.Nd=function(e,t){this.mc.width=e,this.mc.height=t},Vs.prototype.setMaxHardwareResolution=Vs.prototype.Nd,Vs.prototype.Id=function(){if(this.o==Cl){var e=this.j;if(e.j)Y.error("Unable to retry after StreamingEngine is destroyed!"),e=!1;else if(e.A)Y.error("Unable to retry after StreamingEngine encountered a fatal error!"),e=!1;else{for(var t=f(e.h.values()),r=t.next();!r.done;r=t.next()){var n=Vo(r=r.value);r.ac&&(Y.info(n,"Retrying after failure..."),r.ac=!1,Do(e,r,.1))}e=!0}}else e=!1;return e},Vs.prototype.retryStreaming=Vs.prototype.Id,Vs.prototype.uf=function(){return this.i},Vs.prototype.getManifest=Vs.prototype.uf,Vs.prototype.vf=function(){return this.C?this.C.constructor:null},Vs.prototype.getManifestParserFactory=Vs.prototype.vf,(i=Vs.prototype).Xc=function(e){var t=this.j?ho(this.j):null,r=this.j?fo(this.j):null;if(Ur.filterNewPeriod(this.m,t,r,e),!(t=e.variants).some(Ur.Gb))throw new z(2,4,4011);if(gl(this,e.variants),Ur.Xd(t,this.h.restrictions,this.mc)&&this.j&&Tl(this)==e&&ll(this),(e=this.m?this.m.g:null)&&this.m.o)for(r=(t=f(t)).next();!r.done;r=t.next())for(var n=(r=f(r.value.drmInfos)).next();!n.done;n=r.next())if((n=n.value).keySystem==e.keySystem)for(var i=(n=f(n.initData||[])).next();!i.done;i=n.next())i=i.value,It(this.m,i.initDataType,i.initData)},i.Vf=function(e){Y.debug("onChooseStreams_",e);try{Y.O("onChooseStreams_, choosing variant from ",e.variants),Y.O("onChooseStreams_, choosing text from ",e.textStreams),this.yb=!0,this.u.disable(),hl(this),Y.debug("Choosing new streams after period changed");var t=il(this,e.variants),r=Ur.Wb(e.textStreams,this.ua,this.Xa)[0]||null;this.wa&&(e.variants.includes(this.wa)&&(t=this.wa),this.wa=null),this.va&&(e.textStreams.includes(this.va)&&(r=this.va),this.va=null),t&&Ys(this,e,t,!0),r&&zs(this,e,r,!0);var n=this.j,i=n.h.get("video");if(i)var a=n.i.periods[i.oa];else{var o=n.h.get("audio");a=o?n.i.periods[o.oa]:null}var s=t?t.audio:null;if(!a&&r){var l;if(l=s){e=r;var u=Mr(this.h.preferredTextLanguage),c=Mr(s.language),d=Mr(e.language);l=Lr(d,u)&&!Lr(c,d)}l&&(this.ub=!0),this.ub&&this.M.l.setTextVisibility(!0),dl(this)}var h=this.h.streaming.alwaysStreamText||this.zc()?{variant:t,text:r}:{variant:t,text:null};return Y.O("onChooseStreams_, chose variant ",h.variant),Y.O("onChooseStreams_, chose text ",h.text),h}catch(f){return this.Va(f),{variant:null,text:null}}},i.Ze=function(){Y.debug("canSwitch_"),this.yb=!1,this.h.abr.enabled&&(this.u.enable(),hl(this)),this.wa&&(go(this.j,this.wa,this.qe,this.oe),ul(this),this.wa=null),this.va&&(vo(this.j,this.va,!0,0,!1),cl(this),this.va=null)},i.$f=function(){this.C&&this.C.update&&this.C.update()},i.eg=function(){this.A&&this.A.C()},i.Va=function(e){if(this.o!=kl){var t=new Ge("error",{detail:e});this.dispatchEvent(t),t.defaultPrevented&&(e.handled=!0)}};var kl=0,Il=1,Cl=2,Pl=3;function xl(e,t){var r=ms(new ys(e.Ea(),e.ja()),t.periods[0],new Si(null,0)),n=t.appMetadata||{};return r=Rl(r),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:r,appMetadata:n}}function Rl(e){for(var t=[],r=Ur.Bf(e.variants),n=(r=f(r)).next();!n.done;n=r.next())t.push(Ur.Oc(n.value));for(r=(e=f(e.textStreams)).next();!r.done;r=e.next())t.push(Ur.Kc(r.value));return t}function Ol(){this.g={}}function Ll(e,t){var r=t.audio,n=t.video;if(r&&!n&&(e.g[r.id]=r.bandwidth||t.bandwidth),!r&&n&&(e.g[n.id]=n.bandwidth||t.bandwidth),r&&n){var i=r.bandwidth||393216,a=n.bandwidth||t.bandwidth-i;0>=a&&(Y.v("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),a=t.bandwidth),e.g[r.id]=i,e.g[n.id]=a}}function Dl(e,t){var r=e.g[t];return null==r&&(r=0,Y.error("Asking for bitrate of stream not given to the estimator")),0==r&&Y.v("Using bitrate of 0, this stream won't affect progress"),r}function Ml(e){this.g=!1,this.h=new me,this.i=e}function Nl(e){var t=new Vl;e.periods.forEach((function(e,r){var n=Zl(e.variants);if(0==r)for(var i=(n=f(n.g)).next();!i.done;i=n.next())t.add(i.value);else!function(e,t){e.g=e.g.filter((function(e){return Ul(t,e)}))}(t,n)}));for(var r=(e=f(e.periods)).next();!r.done;r=e.next())(r=r.value).variants=r.variants.filter((function(e){return Ul(t,new Gl(e))}))}function Gl(e){var t=e.audio;e=e.video,this.h=t?t.mimeType:null,this.g=t?t.codecs.split(".")[0]:null,this.j=e?e.mimeType:null,this.i=e?e.codecs.split(".")[0]:null}function Vl(){this.g=[]}function Ul(e,t){return e.g.some((function(e){return t.h==e.h&&t.g==e.g&&t.j==e.j&&t.i==e.i}))}function Zl(e){for(var t=new Vl,r=(e=f(e)).next();!r.done;r=e.next())t.add(new Gl(r.value));return t}function Bl(e){var t=this;if(e&&e.constructor!=Vs)throw new z(2,9,9008);this.h=this.g=null,e?(this.g=e.h,this.h=e.Yb()):(this.g=Rs(),this.h=new He),this.j=!1,this.i=[],this.l=[];var r=!e;this.m=new Ml((function(){return y((function e(){var n;return N(e,(function(e){switch(e.s){case 1:return n=function(){},A(e,Promise.all(t.l.map((function(e){return e.then(n,n)}))),2);case 2:if(!r){e.I(3);break}return A(e,t.h.destroy(),3);case 3:t.g=null,t.h=null,w(e)}}))}))}))}function Fl(){if(pt())e:{for(var e=f(as.values()),t=e.next();!t.done;t=e.next())if(t=(t=t.value)()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function jl(e,t){for(var r=[],n=f(e.periods),i=n.next();!i.done;i=n.next())for(var a=(i=f(i.value.streams)).next();!a.done;a=i.next())a=a.value,t&&"video"==a.contentType?r.push({contentType:ct(a.mimeType,a.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=a.contentType||r.push({contentType:ct(a.mimeType,a.codecs),robustness:e.drmInfo.audioRobustness});return r}function Wl(e,t,r){return y((function n(){return N(n,(function(n){if(1===n.s)return A(n,function(e,t,r,n){return y((function i(){var a,o,s;return N(i,(function(i){switch(i.s){case 1:return n.drmInfo?(a=function(e){var t=Array.from(e.g.keys());if(!t.length)throw new z(2,9,9e3,"No supported storage mechanisms found");return e.g.get(t[0]).getEmeSessionCell()}(r),o=n.sessionIds.map((function(e){return{sessionId:e,keySystem:n.drmInfo.keySystem,licenseUri:n.drmInfo.licenseServerUri,serverCertificate:n.drmInfo.serverCertificate,audioCapabilities:jl(n,!1),videoCapabilities:jl(n,!0)}})),A(i,Es(t,e,o),2)):i.return();case 2:return s=i.B,A(i,a.remove(s),3);case 3:return A(i,a.add(o.filter((function(e){return-1==s.indexOf(e.sessionId)}))),0)}}))}))}(e.h,e.g.drm,r,t),0)}))}))}function Xl(e,t,r,n){function i(){s+=1,e.g.offline.progressCallback(l,s/o)}var a=function(e){var t=[];return e.periods.forEach((function(e){e.streams.forEach((function(e){null!=e.initSegmentKey&&t.push(e.initSegmentKey),e.segments.forEach((function(e){t.push(e.dataKey)}))}))})),t}(n),o=a.length+1,s=0,l=xl(r,n);return Promise.all([t.removeSegments(a,i),t.removeManifests([r.key()],i)])}function Hl(e,t,r,n,i,a){var o={id:a.id,originalId:a.originalId,primary:a.primary,presentationTimeOffset:a.presentationTimeOffset||0,contentType:a.type,mimeType:a.mimeType,codecs:a.codecs,frameRate:a.frameRate,pixelAspectRatio:a.pixelAspectRatio,kind:a.kind,language:a.language,label:a.label,width:a.width||null,height:a.height||null,initSegmentKey:null,encrypted:a.encrypted,keyId:a.keyId,segments:[],variantIds:[]};i=i.presentationTimeline.$b();var s=a.id,l=a.initSegmentReference;return l&&(l=$i(l.i(),l.h,l.g,e.g.streaming.retryParameters),Wo(t,s,l,.5*Dl(n,a.id),!0,(function(t){return y((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return A(n,r.addSegments([{data:t}]),2);case 2:i=n.B,e.i.push(i[0]),o.initSegmentKey=i[0],w(n)}}))}))}))),function(e,t,r){for(var n=null==(t=e.findSegmentPosition(t))?null:e.getSegmentReference(t);n;)r(n),n=e.getSegmentReference(++t)}(a,i,(function(i){var l=$i(i.i(),i.h,i.g,e.g.streaming.retryParameters);Wo(t,s,l,function(e,t,r){return r=r.endTime-r.startTime,Dl(e,t)*r}(n,a.id,i),!1,(function(t){return y((function n(){var a;return N(n,(function(n){switch(n.s){case 1:return A(n,r.addSegments([{data:t}]),2);case 2:a=n.B,e.i.push(a[0]),o.segments.push({startTime:i.startTime,endTime:i.endTime,dataKey:a[0]}),w(n)}}))}))}))})),o}function Kl(e){if(e.m.g)throw new z(2,9,7001)}function Yl(){if(!Fl())throw new z(2,9,9e3)}function zl(e,t){return y((function r(){return N(r,(function(r){switch(r.s){case 1:return e.l.push(t),I(r,2),A(r,t,4);case 4:return r.return(r.B);case 2:x(r),Fe(e.l,t),R(r,0)}}))}))}function Jl(e){var t=new Set(e.variants.map((function(e){return e.video}))),r=new Set(e.variants.map((function(e){return e.audio})));e=e.textStreams,1<t.size&&Y.v("Multiple video tracks selected to be stored");for(var n=(t=f(r)).next();!n.done;n=t.next()){n=n.value;for(var i=f(r),a=i.next();!a.done;a=i.next())n!=(a=a.value)&&n.language==a.language&&Y.v("Similar audio tracks were selected to be stored",n.id,a.id)}for(t=(r=f(e)).next();!t.done;t=r.next())for(t=t.value,i=(n=f(e)).next();!i.done;i=n.next())t!=(i=i.value)&&t.language==i.language&&Y.v("Similar text tracks were selected to be stored",t.id,i.id)}Vs.LoadMode={DESTROYED:kl,NOT_LOADED:Il,MEDIA_SOURCE:Cl,SRC_EQUALS:Pl},Ml.prototype.destroy=function(){var e=this;return this.g?this.h:(this.g=!0,this.i().then((function(){e.h.resolve()}),(function(){e.h.resolve()})))},Vl.prototype.add=function(e){Ul(this,e)||this.g.push(e)},F("shaka.offline.Storage",Bl),Bl.support=Fl,Bl.prototype.destroy=function(){return this.m.destroy()},Bl.prototype.destroy=Bl.prototype.destroy,Bl.prototype.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=Ps(e,t));var r=e,n=!1;return null!=r.trackSelectionCallback&&(n=!0,r.offline=r.offline||{},r.offline.trackSelectionCallback=r.trackSelectionCallback,delete r.trackSelectionCallback),null!=r.progressCallback&&(n=!0,r.offline=r.offline||{},r.offline.progressCallback=r.progressCallback,delete r.progressCallback),null!=r.usePersistentLicense&&(n=!0,r.offline=r.offline||{},r.offline.usePersistentLicense=r.usePersistentLicense,delete r.usePersistentLicense),n&&jr("Storage.configure with OfflineConfig","Please configure storage with a player configuration."),Os(this.g,e)},Bl.prototype.configure=Bl.prototype.configure,Bl.prototype.getConfiguration=function(){var e=Rs();return Os(e,this.g,Rs()),e},Bl.prototype.getConfiguration=Bl.prototype.getConfiguration,Bl.prototype.Yb=function(){return this.h},Bl.prototype.getNetworkingEngine=Bl.prototype.Yb,Bl.prototype.store=function(e,t,r){var n=this;return zl(this,function(e,t,r,n){return y((function i(){var a,o,s,l,u,c,d,h,p;return N(i,(function(i){switch(i.s){case 1:return Yl(),e.j?i.return(Promise.reject(new z(2,9,9006))):(e.j=!0,A(i,function(e,t,r){return y((function n(){var i,a,o,s,l,u;return N(n,(function(n){switch(n.s){case 1:return i=null,a=e.h,o={networkingEngine:a,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){i=e}},A(n,r(),2);case 2:return(s=n.B).configure(e.g.manifest),Kl(e),I(n,3),A(n,s.start(t,o),5);case 5:return l=n.B,Kl(e),u=function(e){for(var t=new Set,r=(e=f(e.periods)).next();!r.done;r=e.next()){for(var n=f((r=r.value).textStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(n=(r=f(r.variants)).next();!n.done;n=r.next())(n=n.value).audio&&t.add(n.audio),n.video&&t.add(n.video)}return t}(l),A(n,Promise.all(ot(u,(function(e){return e.createSegmentIndex()}))),6);case 6:if(Kl(e),i)throw i;return n.return(l);case 3:return x(n),A(n,s.stop(),7);case 7:R(n,0)}}))}))}(e,t,n),2));case 2:if(a=i.B,Kl(e),a.presentationTimeline.aa()||a.presentationTimeline.ib())throw new z(2,9,9005,t);return o=null,s=new rs,u=l=null,k(i,3,4),A(i,function(e,t,r){return y((function n(){var i,a,o;return N(n,(function(n){switch(n.s){case 1:return i=new St({Ib:e.h,onError:r,Dc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),a=Ua(t.periods),o=e.g,i.configure(o.drm),A(n,function(e,t,r){return e.F=[],e.L=r,At(e,t)}(i,a,o.offline.usePersistentLicense),2);case 2:return A(n,wt(i),3);case 3:return A(n,kt(i),4);case 4:return n.return(i)}}))}))}(e,a,(function(e){u=u||e})),6);case 6:if(o=i.B,Kl(e),u)throw u;return A(i,function(e,t,r){return y((function n(){var i,a;return N(n,(function(n){switch(n.s){case 1:return i={width:1/0,height:1/0},function(e,t,r){for(var n=(e=f(e.periods)).next();!n.done;n=e.next())(n=n.value).variants=n.variants.filter((function(e){return Ur.rd(e,t,r)}))}(t,e.g.restrictions,i),function(e){for(var t=(e=f(e.periods)).next();!t.done;t=e.next())(t=t.value).variants=t.variants.filter((function(e){var t=!0;return e.audio&&(t=t&&Tr(e.audio)),e.video&&(t=t&&Tr(e.video)),t}))}(t),function(e,t){for(var r=f(e.periods),n=r.next();!n.done;n=r.next())(n=n.value).variants=n.variants.filter((function(e){return Gt(t,e)}))}(t,r),Nl(t),a=e.g.preferredAudioChannelCount,Ur.$d(t,a),A(n,function(e,t){return y((function r(){var n,i,a,o;return N(r,(function(r){switch(r.s){case 1:n=null,i=f(e.periods),a=i.next();case 2:if(a.done){r.I(0);break}return o=a.value,n&&(o.variants=o.variants.filter((function(e){return Ul(n,new Gl(e))}))),A(r,t(o),5);case 5:n=Zl(o.variants),a=i.next(),r.I(2)}}))}))}(t,(function(t){return y((function r(){var n,i,a,o,s,l,u,c;return N(r,(function(r){switch(r.s){case 1:n=Ur,i=[];for(var d=f(t.variants),h=d.next();!h.done;h=d.next())a=h.value,i.push(n.Oc(a));for(h=(d=f(t.textStreams)).next();!h.done;h=d.next())o=h.value,i.push(n.Kc(o));return A(r,e.g.offline.trackSelectionCallback(i),2);case 2:for(s=r.B,l=new Set,u=new Set,h=(d=f(s)).next();!h.done;h=d.next())"variant"==(c=h.value).type&&l.add(c.id),"text"==c.type&&u.add(c.id);t.variants=t.variants.filter((function(e){return l.has(e.id)})),t.textStreams=t.textStreams.filter((function(e){return u.has(e.id)})),w(r)}}))}))})),2);case 2:(function(e){if(0==e.periods.length)throw new z(2,4,4014);for(var t=(e=f(e.periods)).next();!t.done;t=e.next())Jl(t.value)})(t),w(n)}}))}))}(e,a,o),7);case 7:return A(i,s.init(),8);case 8:return Kl(e),A(i,function(e){var t=null;if(e.g.forEach((function(e,r){e.getCells().forEach((function(e,n){e.hasFixedKeySpace()||t||(t={path:{Ea:r,ja:n},ja:e})}))})),t)return t;throw new z(2,9,9013,"Could not find a cell that supports add-operations")}(s),9);case 9:return l=i.B,Kl(e),A(i,function(e,t,r,n,i,a){return y((function o(){var s,l,u,c,d,h,p,m,g,v;return N(o,(function(o){switch(o.s){case 1:return s=function(e,t,r){var n=null==t.expiration?1/0:t.expiration;return{offlineUri:null,originalManifestUri:e,duration:t.presentationTimeline.ha(),size:0,expiration:n,tracks:t=Rl(t.periods[0]),appMetadata:r}}(i,n,a),l=n.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos&&e.drmInfos.length}))})),u=n.periods.some((function(e){return e.variants.some((function(e){return e.drmInfos.some((function(e){return e.initData&&e.initData.length}))}))})),d=null,(c=l&&!u)&&(h=r.g,d=Ql.get(h.keySystem)),p=new jo(e.h,(function(t,r){s.size=r,e.g.offline.progressCallback(s,t)}),(function(t,n){c&&e.g.offline.usePersistentLicense&&d==n&&It(r,"cenc",t)})),I(o,2),g=m=function(e,t,r,n,i,a,o){var s=new Ol,l=i.periods.map((function(n){return function(e,t,r,n,i,a){for(var o=f(a.variants),s=o.next();!s.done;s=o.next())Ll(n,s.value);for(o=f(a.textStreams),s=o.next();!s.done;s=o.next())n.g[s.value.id]=52;o=function(e){for(var t=new Set,r=f(e.textStreams),n=r.next();!n.done;n=r.next())t.add(n.value);for(e=f(e.variants),r=e.next();!r.done;r=e.next())(r=r.value).audio&&t.add(r.audio),r.video&&t.add(r.video);return t}(a);var l=new Map;for(o=f(o),s=o.next();!s.done;s=o.next()){var u=Hl(e,t,r,n,i,s=s.value);l.set(s.id,u)}return a.variants.forEach((function(e){e.audio&&l.get(e.audio.id).variantIds.push(e.id),e.video&&l.get(e.video.id).variantIds.push(e.id)})),{startTime:a.startTime,streams:Array.from(l.values())}}(e,t,r,s,i,n)})),u=n.g,c=e.g.offline.usePersistentLicense;return u&&c&&(u.initData=[]),{originalManifestUri:a,duration:i.presentationTimeline.ha(),size:0,expiration:n.Xb(),periods:l,sessionIds:c?xt(n):[],drmInfo:u,appMetadata:o}}(e,p,t,r,n,i,a),A(o,function(e){return y((function t(){return N(t,(function(t){switch(t.s){case 1:return A(t,Promise.all(e.h.values()),2);case 2:return t.return(e.g.g)}}))}))}(p),4);case 4:if(g.size=o.B,m.expiration=r.Xb(),v=xt(r),m.sessionIds=e.g.offline.usePersistentLicense?v:[],l&&e.g.offline.usePersistentLicense&&!v.length)throw new z(2,9,9007);return o.return(m);case 2:return x(o),A(o,p.destroy(),5);case 5:R(o,0)}}))}))}(e,l.ja,o,a,t,r),10);case 10:if(c=i.B,Kl(e),u)throw u;return A(i,l.ja.addManifests([c]),11);case 11:return d=i.B,Kl(e),h=new fs("manifest",l.path.Ea,l.path.ja,d[0]),i.return(xl(h,c));case 4:return x(i),e.j=!1,e.i=[],A(i,s.destroy(),12);case 12:if(!o){i.I(13);break}return A(i,o.destroy(),13);case 13:R(i,0);break;case 3:if(p=P(i),!l){i.I(15);break}return A(i,l.ja.removeSegments(e.i,(function(){})),15);case 15:throw u||p}}))}))}(this,e,t||{},(function(){return y((function t(){var i,a;return N(t,(function(t){switch(t.s){case 1:return r&&"string"!=typeof r?(jr("Storing with a manifest parser factory","Please register a manifest parser and for the mime-type."),i=r,t.return(new i)):A(t,Ti.create(e,n.h,n.g.manifest.retryParameters,r),2);case 2:return a=t.B,t.return(a)}}))}))})))},Bl.prototype.store=Bl.prototype.store,Bl.prototype.Hf=function(){return this.j},Bl.prototype.getStoreInProgress=Bl.prototype.Hf,Bl.prototype.remove=function(e){return zl(this,function(e,t){return y((function r(){var n,i,a,o,s,l;return N(r,(function(r){switch(r.s){case 1:return Yl(),null==(n=ps(t))||"manifest"!=n.g?r.return(Promise.reject(new z(2,9,9004,t))):(i=n,a=new rs,I(r,2),A(r,a.init(),4));case 4:return A(r,ns(a,i.Ea(),i.ja()),5);case 5:return A(r,(o=r.B).getManifests([i.key()]),6);case 6:return s=r.B,l=s[0],A(r,Promise.all([Wl(e,l,a),Xl(e,o,i,l)]),2);case 2:return x(r),A(r,a.destroy(),8);case 8:R(r,0)}}))}))}(this,e))},Bl.prototype.remove=Bl.prototype.remove,Bl.prototype.sg=function(){return zl(this,function(e){return y((function t(){var r,n,i,a,o,s,l,u,c;return N(t,(function(t){switch(t.s){case 1:return Yl(),r=e.h,n=e.g.drm,i=new rs,a=!1,I(t,2),A(t,i.init(),4);case 4:for(o=[],function(e,t){e.g.forEach((function(e){t(e.getEmeSessionCell())}))}(i,(function(e){return o.push(e)})),s=Promise.resolve(),l={},u=f(o),c=u.next();!c.done;l={Jc:l.Jc},c=u.next())l.Jc=c.value,s=s.then(function(e){return function(){return y((function t(){var i,o;return N(t,(function(t){switch(t.s){case 1:return A(t,e.Jc.getAll(),2);case 2:return i=t.B,A(t,Es(n,r,i),3);case 3:return o=t.B,A(t,e.Jc.remove(o),4);case 4:o.length!=i.length&&(a=!0),w(t)}}))}))}}(l));return A(t,s,2);case 2:return x(t),A(t,i.destroy(),6);case 6:R(t,3);break;case 3:return t.return(!a)}}))}))}(this))},Bl.prototype.removeEmeSessions=Bl.prototype.sg,Bl.prototype.list=function(){return zl(this,y((function e(){var t,r,n;return N(e,(function(e){switch(e.s){case 1:return Yl(),t=[],r=new rs,I(e,2),A(e,r.init(),4);case 4:return n=Promise.resolve(),function(e,t){e.g.forEach((function(e,r){e.getCells().forEach((function(e,n){t({Ea:r,ja:n},e)}))}))}(r,(function(e,r){n=n.then((function(){return y((function n(){return N(n,(function(n){switch(n.s){case 1:return A(n,r.getAllManifests(),2);case 2:n.B.forEach((function(r,n){var i=xl(new fs("manifest",e.Ea,e.ja,n),r);t.push(i)})),w(n)}}))}))}))})),A(e,n,2);case 2:return x(e),A(e,r.destroy(),6);case 6:R(e,3);break;case 3:return e.return(t)}}))})))},Bl.prototype.list=Bl.prototype.list,Bl.deleteAll=function(){return y((function e(){var t;return N(e,(function(e){switch(e.s){case 1:return t=new rs,I(e,2),A(e,t.erase(),2);case 2:return x(e),A(e,t.destroy(),5);case 5:R(e,0)}}))}))};var Ql=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb");Bs.offline=Fl,F("shaka.polyfill.installAll",(function(){for(var e=0;e<tu.length;++e)try{tu[e].Xe()}catch(t){Y.ba("Error installing polyfill!",t)}}));var ql,eu,tu=[];function ru(e,t){for(var r={priority:t=t||0,Xe:e},n=0;n<tu.length;n++)if(tu[n].priority<t)return void tu.splice(n,0,r);tu.push(r)}function nu(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var r=new Event(t,e);else(r=document.createEvent("Event")).initEvent(t,e.bubbles,e.cancelable);e.target.dispatchEvent(r)}function iu(e,t,r){"input"==e&&"range"===this.type&&(e="change"),HTMLInputElement.prototype.originalAddEventListener.call(this,e,t,r)}function au(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(t){for(var r=[],n=0;n<arguments.length;++n)r[n]=arguments[n];return(r=e.apply(this,r)).abort=function(){},r}}function ou(e,t){Y.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess");try{var r=new su(e,t);return Promise.resolve(r)}catch(n){return Promise.reject(n)}}function su(e,t){if(Y.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),this.keySystem=e,e.startsWith("com.apple.fps"))for(var r=f(t),n=r.next();!n.done;n=r.next()){var i=n.value;if("required"==i.persistentState)n=null;else{n={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label};var a=!1,o=!1;if(i.audioCapabilities)for(var s=f(i.audioCapabilities),l=s.next();!l.done;l=s.next())if((l=l.value).contentType){a=!0;var u=l.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,u)&&(n.audioCapabilities.push(l),o=!0)}if(i.videoCapabilities)for(l=(i=f(i.videoCapabilities)).next();!l.done;l=i.next())(s=l.value).contentType&&(a=!0,l=s.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,l)&&(n.videoCapabilities.push(s),o=!0));a||(o=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),n=o?n:null}if(n)return void(this.g=n)}throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r}function lu(e){Y.debug("PatchedMediaKeysApple.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&cu(t,null),delete this.mediaKeys,(this.mediaKeys=e)?cu(e,this):Promise.resolve()}function uu(e){Y.debug("PatchedMediaKeysApple.MediaKeys"),this.h=new WebKitMediaKeys(e),this.g=new tt}function cu(e,t){if(e.g.nb(),!t)return Promise.resolve();e.g.H(t,"webkitneedkey",hu);try{return Wa(t,HTMLMediaElement.HAVE_METADATA,e.g,(function(){t.webkitSetMediaKeys(e.h)})),Promise.resolve()}catch(r){return Promise.reject(r)}}function du(e){Y.debug("PatchedMediaKeysApple.MediaKeySession"),Ue.call(this),this.h=null,this.l=e,this.i=this.g=null,this.j=new tt,this.sessionId="",this.expiration=NaN,this.closed=new me,this.keyStatuses=new pu}function hu(e){if(Y.debug("PatchedMediaKeysApple.onWebkitNeedKey_",e),e=new Uint8Array(e.initData),new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=_e(e=ve(e.subarray(4),!0));var t=new Event("encrypted");t.initDataType="skd",t.initData=e,this.dispatchEvent(t)}function fu(e,t){var r=e.keyStatuses;r.size=null==t?0:1,r.g=t,e.dispatchEvent(new Ge("keystatuseschange"))}function pu(){this.size=0,this.g=void 0}function yu(e,t){Y.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess");try{var r=new mu(e,t);return Promise.resolve(r)}catch(n){return Promise.reject(n)}}function mu(e,t){Y.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=e;for(var r=!1,n=0;n<t.length;++n){var i=t[n],a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:i.initDataTypes,sessionTypes:["temporary"],label:i.label},o=!1;if(i.audioCapabilities)for(var s=0;s<i.audioCapabilities.length;++s){var l=i.audioCapabilities[s];if(l.contentType){o=!0;var u=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,u)&&(a.audioCapabilities.push(l),r=!0)}}if(i.videoCapabilities)for(s=0;s<i.videoCapabilities.length;++s)(l=i.videoCapabilities[s]).contentType&&(o=!0,u=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,u)&&(a.videoCapabilities.push(l),r=!0));if(o||(r=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==i.persistentState&&(r=!1),r)return void(this.g=a)}throw(r=Error("Unsupported keySystem")).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r}function gu(e){Y.debug("PatchedMediaKeysMs.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&bu(t,null),delete this.mediaKeys,(this.mediaKeys=e)?bu(e,this):Promise.resolve()}function vu(e){Y.debug("PatchedMediaKeysMs.MediaKeys"),this.h=new MSMediaKeys(e),this.g=new tt}function bu(e,t){if(e.g.nb(),!t)return Promise.resolve();e.g.H(t,"msneedkey",Eu);try{return Wa(t,HTMLMediaElement.HAVE_METADATA,e.g,(function(){t.msSetMediaKeys(e.h)})),Promise.resolve()}catch(r){return Promise.reject(r)}}function _u(e){Y.debug("PatchedMediaKeysMs.MediaKeySession"),Ue.call(this),this.i=null,this.l=e,this.h=this.g=null,this.j=new tt,this.sessionId="",this.expiration=NaN,this.closed=new me,this.keyStatuses=new Su}function Eu(e){if(Y.debug("PatchedMediaKeysMs.onMsNeedKey_",e),e.initData){var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",t.initData=function(e){if(!e)return e;var t=new Wn(e);if(1>=t.data.length)return e;e=[];for(var r={},n=(t=f(t.data)).next();!n.done;r={yc:r.yc},n=t.next())r.yc=n.value,e.some(function(e){return function(t){return $e.Ha(t,e.yc)}}(r))||e.push(r.yc);return $e.concat.apply($e,e instanceof Array?e:function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(f(e)))}(e.initData).buffer,this.dispatchEvent(t)}}function Tu(e,t){var r=e.keyStatuses;r.size=null==t?0:1,r.g=t,e.dispatchEvent(new Ge("keystatuseschange"))}function Su(){this.size=0,this.g=void 0}function $u(){return Y.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),Promise.reject(Error("The key system specified is not supported."))}function Au(e){return Y.debug("PatchedMediaKeysNop.setMediaKeys"),null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function wu(){throw new TypeError("Illegal constructor.")}function ku(){throw new TypeError("Illegal constructor.")}F("shaka.polyfill.register",ru),ru((function(){Zc()}),-1),ru((function(){if(t.Document){var e=Element.prototype;e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen,(e=Document.prototype).exitFullscreen=e.exitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen||e.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",nu),document.addEventListener("webkitfullscreenerror",nu),document.addEventListener("mozfullscreenchange",nu),document.addEventListener("mozfullscreenerror",nu),document.addEventListener("MSFullscreenChange",nu),document.addEventListener("MSFullscreenError",nu)}})),ru((function(){Y.debug("InputEvent.install"),bt("Trident/")&&!HTMLInputElement.prototype.originalAddEventListener&&(Y.info("Patching input event support on IE."),HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=iu)})),ru((function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})})),ru((function(){Y.debug("mathRound.install")})),ru((function(){Y.debug("MediaSource.install");var e=vt();t.MediaSource?t.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(Y.info("Patching Chromecast MSE bugs."),function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){var r=t.split(/ *; */);return r.shift(),r.some((function(e){return e.startsWith("codecs=")}))?cast.__platform__.canDisplayType(t):e(t)}}()):e?(function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"mp2t"!=t.split(/ *; */)[0].split("/")[1].toLowerCase()&&e(t)}}(),12>=e?(Y.info("Patching Safari 11 & 12 MSE bugs."),au(),function(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,r){return e.call(this,t,r-.001)}}()):(Y.info("Patching Safari 13 MSE bugs."),au())):bt("Tizen 2")||bt("Tizen 3")||bt("Tizen 4")?function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"opus"!=ht(t)[0]&&e(t)}}():Y.info("Using native MSE as-is."):Y.info("No MSE implementation available.")})),su.prototype.createMediaKeys=function(){Y.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var e=new uu(this.keySystem);return Promise.resolve(e)},su.prototype.getConfiguration=function(){return Y.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.g},uu.prototype.createSession=function(e){if(Y.debug("PatchedMediaKeysApple.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new du(this.h)},uu.prototype.setServerCertificate=function(e){return Y.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),Promise.resolve(!0)},j(du,Ue),(i=du.prototype).generateRequest=function(e,t){Y.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.g=new me;try{this.h=this.l.createSession("video/mp4",new Uint8Array(t)),this.sessionId=this.h.sessionId||"",this.j.H(this.h,"webkitkeymessage",this.Gg.bind(this)),this.j.H(this.h,"webkitkeyadded",this.Eg.bind(this)),this.j.H(this.h,"webkitkeyerror",this.Fg.bind(this)),fu(this,"status-pending")}catch(r){this.g.reject(r)}return this.g},i.load=function(){return Y.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){Y.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.i=new me;try{this.h.update(new Uint8Array(e))}catch(t){this.i.reject(t)}return this.i},i.close=function(){Y.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.h.close(),this.closed.resolve(),this.j.nb()}catch(l){this.closed.reject(l)}return this.closed},i.remove=function(){return Y.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},i.Gg=function(e){Y.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",e),this.g&&(this.g.resolve(),this.g=null),this.dispatchEvent(new Ge("message",{messageType:null==this.keyStatuses.g?"license-request":"license-renewal",message:e.message.buffer}))},i.Eg=function(e){Y.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",e),this.i&&(fu(this,"usable"),this.i.resolve(),this.i=null)},i.Fg=function(e){if(Y.debug("PatchedMediaKeysApple.onWebkitKeyError_",e),(e=Error("EME PatchedMediaKeysApple key error")).errorCode=this.h.error,null!=this.g)this.g.reject(e),this.g=null;else if(null!=this.i)this.i.reject(e),this.i=null;else switch(this.h.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:fu(this,"output-not-allowed");break;default:fu(this,"internal-error")}},(i=pu.prototype).forEach=function(e){this.g&&e(this.g,ql)},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=ql;return!(!this.g||!$e.Ha(new Uint8Array(e),new Uint8Array(t)))},i.entries=function(){},i.keys=function(){},i.values=function(){},ru((function(){t.HTMLVideoElement&&t.WebKitMediaKeys&&(Y.info("Using Apple-prefixed EME"),ql=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=lu,t.MediaKeys=uu,t.MediaKeySystemAccess=su,navigator.requestMediaKeySystemAccess=ou)})),mu.prototype.createMediaKeys=function(){Y.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var e=new vu(this.keySystem);return Promise.resolve(e)},mu.prototype.getConfiguration=function(){return Y.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.g},vu.prototype.createSession=function(e){if(Y.debug("PatchedMediaKeysMs.MediaKeys.createSession"),"temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new _u(this.h)},vu.prototype.setServerCertificate=function(){return Y.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},j(_u,Ue),(i=_u.prototype).generateRequest=function(e,t){Y.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.g=new me;try{this.i=this.l.createSession("video/mp4",new Uint8Array(t),null),this.j.H(this.i,"mskeymessage",this.dg.bind(this)),this.j.H(this.i,"mskeyadded",this.bg.bind(this)),this.j.H(this.i,"mskeyerror",this.cg.bind(this)),Tu(this,"status-pending")}catch(r){this.g.reject(r)}return this.g},i.load=function(){return Y.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){Y.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.h=new me;try{this.i.update(new Uint8Array(e))}catch(t){this.h.reject(t)}return this.h},i.close=function(){Y.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.i.close(),this.closed.resolve(),this.j.nb()}catch(l){this.closed.reject(l)}return this.closed},i.remove=function(){return Y.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},i.dg=function(e){Y.debug("PatchedMediaKeysMs.onMsKeyMessage_",e),this.g&&(this.g.resolve(),this.g=null),this.dispatchEvent(new Ge("message",{messageType:null==this.keyStatuses.g?"license-request":"license-renewal",message:e.message.buffer}))},i.bg=function(e){Y.debug("PatchedMediaKeysMs.onMsKeyAdded_",e),this.g?(Y.debug("Simulating completion for a PR persistent license."),Tu(this,"usable"),this.g.resolve(),this.g=null):this.h&&(Tu(this,"usable"),this.h.resolve(),this.h=null)},i.cg=function(e){if(Y.debug("PatchedMediaKeysMs.onMsKeyError_",e),(e=Error("EME PatchedMediaKeysMs key error")).errorCode=this.i.error,null!=this.g)this.g.reject(e),this.g=null;else if(null!=this.h)this.h.reject(e),this.h=null;else switch(this.i.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Tu(this,"output-not-allowed");break;default:Tu(this,"internal-error")}},(i=Su.prototype).forEach=function(e){this.g&&e(this.g,eu)},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=eu;return!(!this.g||!$e.Ha(new Uint8Array(e),new Uint8Array(t)))},i.entries=function(){},i.keys=function(){},i.values=function(){},ru((function(){!t.HTMLVideoElement||!t.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(Y.info("Using ms-prefixed EME v20140218"),eu=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=gu,t.MediaKeys=vu,t.MediaKeySystemAccess=mu,navigator.requestMediaKeySystemAccess=yu)})),wu.prototype.createSession=function(){},wu.prototype.setServerCertificate=function(){},ku.prototype.getConfiguration=function(){},ku.prototype.createMediaKeys=function(){},ru((function(){!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(Y.info("EME not available."),navigator.requestMediaKeySystemAccess=$u,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Au,t.MediaKeys=wu,t.MediaKeySystemAccess=ku)}),-10);var Iu,Cu="";function Pu(e){return Cu?Cu+e.charAt(0).toUpperCase()+e.slice(1):e}function xu(e,t){Y.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess");try{var r=new Ou(e,t);return Promise.resolve(r)}catch(n){return Promise.reject(n)}}function Ru(e){Y.debug("PatchedMediaKeysWebkit.setMediaKeys");var t=this.mediaKeys;return t&&t!=e&&Du(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&Du(e,this),Promise.resolve()}function Ou(e,t){Y.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess"),this.g=this.keySystem=e;var r=!1;"org.w3.clearkey"==e&&(this.g="webkit-org.w3.clearkey",r=!1);var n=!1,i=document.getElementsByTagName("video");i=i.length?i[0]:document.createElement("video");for(var a=0;a<t.length;++a){var o=t[a],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:o.initDataTypes,sessionTypes:["temporary"],label:o.label},l=!1;if(o.audioCapabilities)for(var u=0;u<o.audioCapabilities.length;++u){var c=o.audioCapabilities[u];if(c.contentType){l=!0;var d=c.contentType.split(";")[0];i.canPlayType(d,this.g)&&(s.audioCapabilities.push(c),n=!0)}}if(o.videoCapabilities)for(u=0;u<o.videoCapabilities.length;++u)(c=o.videoCapabilities[u]).contentType&&(l=!0,i.canPlayType(c.contentType,this.g)&&(s.videoCapabilities.push(c),n=!0));if(l||(n=i.canPlayType("video/mp4",this.g)||i.canPlayType("video/webm",this.g)),"required"==o.persistentState&&(r?(s.persistentState="required",s.sessionTypes=["persistent-license"]):n=!1),n)return void(this.h=s)}throw r="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(r="None of the requested configurations were supported."),(r=Error(r)).name="NotSupportedError",r.code=DOMException.NOT_SUPPORTED_ERR,r}function Lu(e){Y.debug("PatchedMediaKeysWebkit.MediaKeys"),this.l=e,this.h=null,this.g=new tt,this.i=[],this.j={}}function Du(e,t){e.h=t,e.g.nb();var r=Cu;t&&(e.g.H(t,r+"needkey",e.hg.bind(e)),e.g.H(t,r+"keymessage",e.Jg.bind(e)),e.g.H(t,r+"keyadded",e.Hg.bind(e)),e.g.H(t,r+"keyerror",e.Ig.bind(e)))}function Mu(e,t){var r=e.j[t];return r?(Y.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",r),r):(r=e.i.shift())?(r.sessionId=t,e.j[t]=r,Y.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",r),r):null}function Nu(e,t,r){Y.debug("PatchedMediaKeysWebkit.MediaKeySession"),Ue.call(this),this.j=e,this.m=!1,this.g=this.h=null,this.i=t,this.l=r,this.sessionId="",this.expiration=NaN,this.closed=new me,this.keyStatuses=new Uu}function Gu(e,t,r){if(e.m)return Promise.reject(Error("The session is already initialized."));e.m=!0;try{if("persistent-license"==e.l)if(r)var n=new Uint8Array(_e("LOAD_SESSION|"+r));else{var i=_e("PERSISTENT|"),a=new Uint8Array(i.byteLength+t.byteLength);a.set(new Uint8Array(i),0),a.set(new Uint8Array(t),i.byteLength),n=a}else n=new Uint8Array(t)}catch(s){return Promise.reject(s)}e.h=new me;var o=Pu("generateKeyRequest");try{e.j[o](e.i,n)}catch(s){if("InvalidStateError"!=s.name)return e.h=null,Promise.reject(s);new Ce((function(){try{e.j[o](e.i,n)}catch(t){e.h.reject(t),e.h=null}})).V(.01)}return e.h}function Vu(e,t){var r=e.keyStatuses;r.size=null==t?0:1,r.g=t,e.dispatchEvent(new Ge("keystatuseschange"))}function Uu(){this.size=0,this.g=void 0}function Zu(e){if("picture-in-picture"==(e=e.target).webkitPresentationMode){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)}function Bu(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function Fu(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function ju(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode("picture-in-picture")}function Wu(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}function Xu(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function Hu(e,r,n){return new t.TextTrackCue(e,r,n)}function Ku(e,r,n){return new t.TextTrackCue(e+"-"+r+"-"+n,e,r,n)}function Yu(){}Ou.prototype.createMediaKeys=function(){Y.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var e=new Lu(this.g);return Promise.resolve(e)},Ou.prototype.getConfiguration=function(){return Y.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.h},(i=Lu.prototype).createSession=function(e){if(Y.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),"temporary"!=(e=e||"temporary")&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.h||document.createElement("video");return t.src||(t.src="about:blank"),e=new Nu(t,this.l,e),this.i.push(e),e},i.setServerCertificate=function(){return Y.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},i.hg=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",e);var t=document.createEvent("CustomEvent");t.initCustomEvent("encrypted",!1,!1,null),t.initDataType="cenc",e.initData instanceof ArrayBuffer?t.initData=e.initData:t.initData=e.initData.buffer,this.h.dispatchEvent(t)},i.Jg=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",e);var t=Mu(this,e.sessionId);t?(e=new Ge("message",{messageType:null==t.keyStatuses.g?"licenserequest":"licenserenewal",message:e.message}),Y.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),t.h&&(t.h.resolve(),t.h=null),t.dispatchEvent(e)):Y.error("Session not found",e.sessionId)},i.Hg=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",e),(e=Mu(this,e.sessionId))&&(Y.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),Vu(e,"usable"),e.g&&e.g.resolve(),e.g=null)},i.Ig=function(e){Y.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",e);var t=Mu(this,e.sessionId);t&&t.handleError(e)},j(Nu,Ue),(i=Nu.prototype).handleError=function(e){Y.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",e);var t=Error("EME v0.1b key error"),r=e.errorCode;r.systemCode=e.systemCode,t.errorCode=r,!e.sessionId&&this.h?(45==e.systemCode&&(t.message="Unsupported session type."),this.h.reject(t),this.h=null):e.sessionId&&this.g?(this.g.reject(t),this.g=null):(t=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Vu(this,"output-restricted"):Vu(this,1==t?"expired":"internal-error"))},i.Qd=function(e,t){if(this.g)this.g.then(this.Qd.bind(this,e,t)).catch(this.Qd.bind(this,e,t));else{if(this.g=e,"webkit-org.w3.clearkey"==this.i){var r=ge(t),n=JSON.parse(r);"oct"!=n.keys[0].kty&&(this.g.reject(Error("Response is not a valid JSON Web Key Set.")),this.g=null),r=$e.Ja(n.keys[0].k),n=$e.Ja(n.keys[0].kid)}else r=new Uint8Array(t),n=null;var i=Pu("addKey");try{this.j[i](this.i,r,n,this.sessionId)}catch(a){this.g.reject(a),this.g=null}}},i.generateRequest=function(e,t){return Y.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),Gu(this,t,null)},i.load=function(e){return Y.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),"persistent-license"==this.l?Gu(this,null,e):Promise.reject(Error("Not a persistent session."))},i.update=function(e){Y.debug("PatchedMediaKeysWebkit.MediaKeySession.update",e);var t=new me;return this.Qd(t,e),t},i.close=function(){if(Y.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),"persistent-license"!=this.l){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=Pu("cancelKeyRequest");try{this.j[e](this.i,this.sessionId)}catch(t){}}return this.closed.resolve(),this.closed},i.remove=function(){return Y.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),"persistent-license"!=this.l?Promise.reject(Error("Not a persistent session.")):this.close()},(i=Uu.prototype).forEach=function(e){this.g&&e(this.g,Iu)},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=Iu;return!(!this.g||!$e.Ha(new Uint8Array(e),new Uint8Array(t)))},i.entries=function(){},i.keys=function(){},i.values=function(){},ru((function(){if(!(!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)Y.info("Using webkit-prefixed EME v0.1b"),Cu="webkit";else{if(!HTMLMediaElement.prototype.generateKeyRequest)return;Y.info("Using nonprefixed EME v0.1b")}Iu=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=xu,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ru,t.MediaKeys=Lu,t.MediaKeySystemAccess=Ou}})),ru((function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;e.requestPictureInPicture&&document.exitPictureInPicture||!e.webkitSupportsPresentationMode||(Y.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,e.requestPictureInPicture=Bu,Object.defineProperty(e,"disablePictureInPicture",{get:ju,set:Wu,enumerable:!0,configurable:!0}),document.exitPictureInPicture=Fu,document.addEventListener("webkitpresentationmodechanged",Zu,!0))}})),ru((function(){if(Y.debug("VideoPlayPromise.install"),t.HTMLMediaElement){var e=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var t=e.apply(this);return t&&t.catch((function(){})),t}}})),ru((function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;!e.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in e&&(e.getVideoPlaybackQuality=Xu)}})),ru((function(){if(t.VTTCue)Y.info("Using native VTTCue.");else if(t.TextTrackCue){var e=TextTrackCue.length;if(3==e)Y.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t.VTTCue=Hu;else if(6==e)Y.info("Using VTTCue polyfill from 6 argument TextTrackCue."),t.VTTCue=Ku;else{try{var r=!!Hu(1,2,"")}catch(n){r=!1}r&&(Y.info("Using VTTCue polyfill from 3 argument TextTrackCue."),t.VTTCue=Hu)}}else Y.error("VTTCue not available.")})),F("shaka.text.TtmlTextParser",Yu),Yu.prototype.parseInit=function(){},Yu.prototype.parseInit=Yu.prototype.parseInit,Yu.prototype.parseMedia=function(e,t){var r=ge(e),n=[],i=new DOMParser,a=null;if(""==r)return n;try{a=i.parseFromString(r,"text/xml")}catch(_){throw new z(2,2,2005,"Failed to parse TTML.")}if(a){if(r=a.getElementsByTagName("parsererror")[0])throw new z(2,2,2005,r.textContent);if(!(i=a.getElementsByTagName("tt")[0]))throw new z(2,2,2005,"TTML does not contain <tt> tag.");var o=Xn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","frameRate"),s=Xn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","subFrameRate"),l=Xn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier"),u=Xn.getAttributeNS(i,"http://www.w3.org/ns/ttml#parameter","tickRate");if(a=i.getAttribute("xml:space")||"default",r=Xn.getAttributeNS(i,"http://www.w3.org/ns/ttml#styling","extent"),"default"!=a&&"preserve"!=a)throw new z(2,2,2005,"Invalid xml:space value: "+a);a="default"==a,o=new Ec(o,s,l,u),s=uc(i.getElementsByTagName("metadata")[0]),l=uc(i.getElementsByTagName("styling")[0]),u=uc(i.getElementsByTagName("layout")[0]);for(var c=[],d=0;d<u.length;d++){var h,p,y=u[d],m=l,g=r,v=new hr,b=y.getAttribute("xml:id");b?(v.id=b,b=null,g&&(b=Qu.exec(g)||ec.exec(g)),g=b?Number(b[1]):null,b=b?Number(b[2]):null,(h=yc(y,m,"extent"))&&null!=(h=(p=Qu.exec(h))||ec.exec(h))&&(v.width=null!=g?100*Number(h[1])/g:Number(h[1]),v.height=null!=b?100*Number(h[2])/b:Number(h[2]),v.widthUnits=p||null!=g?fr:0,v.heightUnits=p||null!=b?fr:0),(y=yc(y,m,"origin"))&&null!=(h=(p=Qu.exec(y))||ec.exec(y))&&(v.viewportAnchorX=null!=g?100*Number(h[1])/g:Number(h[1]),v.viewportAnchorY=null!=b?100*Number(h[2])/b:Number(h[2]),v.viewportAnchorUnits=p||null!=g?fr:0)):(Y.v("TtmlTextParser parser encountered a region with no id. Region will be ignored."),v=null),v&&c.push(v)}for(r=cc(i.getElementsByTagName("body")[0]),i=(r=f(r)).next();!i.done;i=r.next())(i=hc(i.value,t.periodStart,o,s,l,u,c,a,!1))&&n.push(i)}return n},Yu.prototype.parseMedia=Yu.prototype.parseMedia;var zu,Ju,Qu=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,qu=/^(\d+px|\d+em)$/,ec=/^(\d+)px (\d+)px$/,tc=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,rc=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,nc=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,ic=/^(\d*(?:\.\d*)?)f$/,ac=/^(\d*(?:\.\d*)?)t$/,oc=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,sc={left:sr,center:"center",right:"end",start:sr,end:"end"},lc={left:"line-left",center:"center",right:"line-right"};function uc(e){var t=[];if(!e)return t;for(var r=f(e.childNodes),n=r.next();!n.done;n=r.next())(n=n.value).nodeType==Node.ELEMENT_NODE&&"br"!==n.nodeName&&(n=uc(n),t=t.concat(n));return t.length||t.push(e),t}function cc(e){if(!e)return[];for(var t=[],r=(e=f(e.childNodes)).next();!r.done;r=e.next())(r=r.value)instanceof Element&&(r.hasAttribute("begin")?t.push(r):t=t.concat(cc(r)));return t}function dc(e,t){for(var r="",n=f(e.childNodes),i=n.next();!i.done;i=n.next())"br"==(i=i.value).nodeName&&e.childNodes[0]!==i?r+="\n":i.childNodes&&0<i.childNodes.length?r+=dc(i,t):r+=t?i=(i=i.textContent.trim()).replace(/\s+/g," "):i.textContent;return r}function hc(e,t,r,n,i,a,o,s,l){if(l&&"br"==e.nodeName)return(e=new Qt(0,0,"")).spacer=!0,e;var u=/^[\s\n]*$/.test(e.textContent),c=e.nodeType==Node.ELEMENT_NODE&&!e.hasAttribute("begin")&&!e.hasAttribute("end");if(e.nodeType!=Node.ELEMENT_NODE||c&&u||c&&!l)return null;s="default"==(e.getAttribute("xml:space")||(s?"default":"preserve")),u=bc(e.getAttribute("begin"),r),c=bc(e.getAttribute("end"),r);var d=bc(e.getAttribute("dur"),r);if(null==c&&null!=d&&(c=u+d),!l&&(null==u||null==c))throw new z(2,2,2001);if(u=l&&null==u?0:u+t,c=l&&null==c?0:c+t,d="",l=[],Array.from(e.childNodes).find((function(e){return e.nodeType===Node.TEXT_NODE&&/\S+/.test(e.textContent)})))d=dc(e,s);else for(var h=f(e.childNodes),p=h.next();!p.done;p=h.next())(p=hc(p.value,t,r,n,i,a,o,s,!0))&&(p.startTime=p.startTime||u,p.endTime=p.endTime||c,l.push(p));if((t=new Qt(u,c,d)).nestedCues=l,(a=vc(e,"region",a,"")[0])&&a.getAttribute("xml:id")){var y=a.getAttribute("xml:id");t.region=o.filter((function(e){return e.id==y}))[0]}return function(e,t,r,n,i){"rtl"==pc(t,r,i,"direction")&&(e.direction="rtl");var a=pc(t,r,i,"writingMode");if("tb"==a||"tblr"==a?e.writingMode="vertical-lr":"tbrl"==a?e.writingMode="vertical-rl":"rltb"==a||"rl"==a?e.direction="rtl":a&&(e.direction=ir),(a=pc(t,r,i,"textAlign"))?(e.positionAlign=lc[a],e.lineAlign=sc[a],e.textAlign=tr[a.toUpperCase()]):e.textAlign="start",(a=pc(t,r,i,"displayAlign"))&&(e.displayAlign=nr[a.toUpperCase()]),(a=pc(t,r,i,"color"))&&(e.color=a),(a=pc(t,r,i,"backgroundColor"))&&(e.backgroundColor=a),(a=pc(t,r,i,"fontFamily"))&&(e.fontFamily=a),(a=pc(t,r,i,"fontWeight"))&&"bold"==a&&(e.fontWeight=700),(a=pc(t,r,i,"wrapOption"))&&"noWrap"==a&&(e.wrapLine=!1),(a=pc(t,r,i,"lineHeight"))&&a.match(qu)&&(e.lineHeight=a),(a=pc(t,r,i,"fontSize"))&&a.match(qu)&&(e.fontSize=a),(a=pc(t,r,i,"fontStyle"))&&(e.fontStyle=dr[a.toUpperCase()]),n){a=n.getAttribute("imageType")||n.getAttribute("imagetype");var o=n.getAttribute("encoding");n=n.textContent.trim(),"PNG"==a&&"Base64"==o&&n&&(e.backgroundImage="data:image/png;base64,"+n)}(r=yc(r,i,"textDecoration"))&&fc(e,r),(t=mc(t,i,"textDecoration"))&&fc(e,t)}(t,e,a,n=vc(e,"backgroundImage",n,"#","http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt")[0],i),t}function fc(e,t){for(var r=t.split(" "),n=0;n<r.length;n++)switch(r[n]){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&Fe(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&Fe(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&Fe(e.textDecoration,"overline")}}function pc(e,t,r,n){return(e=mc(e,r,n))?e:yc(t,r,n)}function yc(e,t,r){if(!e)return null;for(var n=uc(e),i=0;i<n.length;i++){var a=Xn.getAttributeNS(n[i],"http://www.w3.org/ns/ttml#styling",r);if(a)return a}return gc(e,t,r)}function mc(e,t,r){var n=Xn.getAttributeNS(e,"http://www.w3.org/ns/ttml#styling",r);return n||gc(e,t,r)}function gc(e,t,r){e=vc(e,"style",t,"");for(var n=null,i=0;i<e.length;i++){var a=Xn.getAttributeNS(e[i],"http://www.w3.org/ns/ttml#styling",r);a||(a=mc(e[i],t,r)),a&&(n=a)}return n}function vc(e,t,r,n,i){var a=[];if(!e||1>r.length)return a;var o=e;for(e=null;o&&!(e=i?Xn.getAttributeNS(o,i,t):o.getAttribute(t))&&(o=o.parentNode)instanceof Element;);if(t=e)for(i=(t=f(t=t.split(" "))).next();!i.done;i=t.next())for(i=i.value,o=(e=f(r)).next();!o.done;o=e.next())if(n+(o=o.value).getAttribute("xml:id")==i){a.push(o);break}return a}function bc(e,t){var r=null;if(tc.test(e)){r=tc.exec(e);var n=Number(r[1]),i=Number(r[2]),a=Number(r[3]),o=Number(r[4]);r=(a+=(o+=(Number(r[5])||0)/t.h)/t.frameRate)+60*i+3600*n}else rc.test(e)?r=_c(rc,e):nc.test(e)?r=_c(nc,e):ic.test(e)?(r=ic.exec(e),r=Number(r[1])/t.frameRate):ac.test(e)?(r=ac.exec(e),r=Number(r[1])/t.g):oc.test(e)&&(r=_c(oc,e));return r}function _c(e,t){var r=e.exec(t);return null==r||""==r[0]?null:(Number(r[4])||0)/1e3+(Number(r[3])||0)+60*(Number(r[2])||0)+3600*(Number(r[1])||0)}function Ec(e,t,r,n){this.frameRate=Number(e)||30,this.h=Number(t)||1,this.g=Number(n),0==this.g&&(this.g=e?this.frameRate*this.h:1),r&&(e=/^(\d+) (\d+)$/g.exec(r))&&(this.frameRate*=Number(e[1])/Number(e[2]))}function Tc(){this.g=new Yu}function Sc(){}function $c(e,t,r){var n;if(n=/^align:(start|middle|center|end|left|right)$/.exec(t))t=n[1],e.textAlign="middle"==t?er:tr[t.toUpperCase()];else if(n=/^vertical:(lr|rl)$/.exec(t))e.writingMode="lr"==n[1]?"vertical-lr":"vertical-rl";else if(n=/^size:([\d.]+)%$/.exec(t))e.size=Number(n[1]);else if(n=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))e.position=Number(n[1]),n[2]&&(t=n[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center");else{if(!(n=/^region:(.*)$/.exec(t))){e:{if(r=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))e.lineInterpretation=1,e.line=Number(r[1]),r[2]&&(e.lineAlign=lr[r[2].toUpperCase()]);else{if(!(r=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))){e=!1;break e}e.lineInterpretation=or,e.line=Number(r[1]),r[2]&&(e.lineAlign=lr[r[2].toUpperCase()])}e=!0}return e}(t=function(e,t){var r=e.filter((function(e){return e.id==t}));return r.length?r[0]:(Y.v("VTT parser could not find a region with id: ",t," The region will be ignored."),null)}(r,n[1]))&&(e.region=t)}return!0}function Ac(e){if(null==(e=Bi(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var t=Number(e[2]),r=Number(e[3]);return 59<t||59<r?null:Number(e[4])/1e3+r+60*t+3600*(Number(e[1])||0)}function wc(){this.g=null}function kc(e,t,r){var n,i,a;return(new Gn).box("payl",Zn((function(e){n=ge(e)}))).box("iden",Zn((function(e){i=ge(e)}))).box("sttg",Zn((function(e){a=ge(e)}))).parse(e),n?function(e,t,r,n,i){if(e=new Qt(n,i,e),t&&(e.id=t),r)for(t=new Ui(r),r=Fi(t);r;)$c(e,r,[])||Y.v("VTT parser encountered an invalid VTT setting: ",r," The setting will be ignored."),Zi(t),r=Fi(t);return e}(n,i,a,t,r):null}function Ic(){}function Cc(){zu?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(zu=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=Pc):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function Pc(e,t){var r=this;return y((function n(){var i;return N(n,(function(n){switch(n.s){case 1:return console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),A(n,zu.call(r,e,t),2);case 2:return Vc(i=n.B)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=zu,n.return(i)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=xc,n.return(xc.call(r,e,t)))}}))}))}function xc(e,t){var r=this;return y((function n(){var i,a,o,s,l,u,c,d;return N(n,(function(n){switch(n.s){case 1:console.assert(r==navigator,'bad "this" for requestMediaKeySystemAccess'),i=Gc(e),a=[];for(var h=f(t),p=h.next();!p.done;p=h.next())o=p.value,s=Rc(o.videoCapabilities,i),l=Rc(o.audioCapabilities,i),o.videoCapabilities&&o.videoCapabilities.length&&!s.length||o.audioCapabilities&&o.audioCapabilities.length&&!l.length||((u=Object.assign({},o)).videoCapabilities=s,u.audioCapabilities=l,a.push(u));if(!a.length)throw(c=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",c.code=DOMException.NOT_SUPPORTED_ERR,c;return A(n,zu.call(r,e,a),2);case 2:return d=n.B,n.return(new Nc(d,i))}}))}))}function Rc(e,t){return e?e.filter((function(e){return!e.encryptionScheme||e.encryptionScheme==t})):e}function Oc(){}function Lc(){Ju?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(Ju=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=Dc):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function Dc(e){var t=this;return y((function r(){var n,i;return N(r,(function(r){switch(r.s){case 1:return console.assert(t==navigator.mediaCapabilities,'bad "this" for decodingInfo'),A(r,Ju.call(t,e),2);case 2:return n=r.B,e.keySystemConfiguration?(i=n.keySystemAccess)&&Vc(i)?(console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=Ju,r.return(n)):(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=Mc,r.return(Mc.call(t,e))):r.return(n)}}))}))}function Mc(e){var t=this;return y((function r(){var n,i,a,o,s,l,u,c,d;return N(r,(function(r){switch(r.s){case 1:return console.assert(t==navigator.mediaCapabilities,'bad "this" for decodingInfo'),n=null,e.keySystemConfiguration&&(i=e.keySystemConfiguration,a=i.keySystem,o=i.audio&&i.audio.encryptionScheme,s=i.video&&i.video.encryptionScheme,n=Gc(a),l={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},o&&o!=n||s&&s!=n)?r.return(l):A(r,Ju.call(t,e),2);case 2:if((u=r.B).keySystemAccess){u.keySystemAccess=new Nc(u.keySystemAccess,n),r.I(3);break}if(!e.keySystemConfiguration){r.I(3);break}var h=e.keySystemConfiguration,f=[],p=[];return h.audio&&f.push({robustness:h.audio.robustness||"",contentType:e.audio.contentType}),h.video&&p.push({robustness:h.video.robustness||"",contentType:e.video.contentType}),h={initDataTypes:h.initDataType?[h.initDataType]:[],distinctiveIdentifier:h.distinctiveIdentifier,persistentState:h.persistentState,sessionTypes:h.sessionTypes},f.length&&(h.audioCapabilities=f),p.length&&(h.videoCapabilities=p),c=h,d=u,A(r,navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem,[c]),5);case 5:d.keySystemAccess=r.B;case 3:return r.return(u)}}))}))}function Nc(e,t){this.h=e,this.g=t,this.keySystem=e.keySystem}function Gc(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function Vc(e){var t=(e=e.getConfiguration()).audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}function Uc(){}function Zc(){Cc(),Lc()}mr["application/ttml+xml"]=Yu,F("shaka.text.Mp4TtmlParser",Tc),Tc.prototype.parseInit=function(e){var t=!1;if((new Gn).box("moov",Vn).box("trak",Vn).box("mdia",Vn).box("minf",Vn).box("stbl",Vn).ma("stsd",Un).box("stpp",(function(e){t=!0,e.parser.stop()})).parse(e),!t)throw new z(2,2,2007)},Tc.prototype.parseInit=Tc.prototype.parseInit,Tc.prototype.parseMedia=function(e,t){var r=!1,n=[];if((new Gn).box("mdat",Zn(function(e){r=!0,n=n.concat(this.g.parseMedia(e,t))}.bind(this))).parse(e),!r)throw new z(2,2,2007);return n},Tc.prototype.parseMedia=Tc.prototype.parseMedia,mr['application/mp4; codecs="stpp"']=Tc,mr['application/mp4; codecs="stpp.ttml.im1t"']=Tc,mr['application/mp4; codecs="stpp.TTML.im1t"']=Tc,F("shaka.text.VttTextParser",Sc),Sc.prototype.parseInit=function(){},Sc.prototype.parseInit=Sc.prototype.parseInit,Sc.prototype.parseMedia=function(e,t){var r=ge(e);if(r=(r=r.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(r[0]))throw new z(2,2,2e3);var n=t.segmentStart;if(null==n&&(n=0,r[0].includes("X-TIMESTAMP-MAP"))){var i=r[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),a=r[0].match(/MPEGTS:(\d+)/m);if(i&&a){if(null==(n=Ac(new Ui(i[1]))))throw new z(2,2,2e3);n=t.periodStart+(Number(a[1])/9e4-n)}}a=[];var o=r[0].split("\n");for(i=1;i<o.length;i++)if(/^Region:/.test(o[i])){var s=new Ui(o[i]),l=new hr;Fi(s),Zi(s);for(var u=Fi(s);u;){var c;e:{var d=l,h=u;if(c=/^id=(.*)$/.exec(h))d.id=c[1];else if(c=/^width=(\d{1,2}|100)%$/.exec(h))d.width=Number(c[1]);else if(c=/^lines=(\d+)$/.exec(h))d.height=Number(c[1]),d.heightUnits=2;else if(c=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))d.regionAnchorX=Number(c[1]),d.regionAnchorY=Number(c[2]);else if(c=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))d.viewportAnchorX=Number(c[1]),d.viewportAnchorY=Number(c[2]);else{if(!/^scroll=up$/.exec(h)){c=!1;break e}d.scroll="up"}c=!0}c||Y.v("VTT parser encountered an invalid VTTRegion setting: ",u," The setting will be ignored."),Zi(s),u=Fi(s)}a.push(l)}for(i=[],s=1;s<r.length;s++){if(c=o=r[s].split("\n"),d=n,o=a,1==c.length&&!c[0]||/^NOTE($|[ \t])/.test(c[0])||"STYLE"==c[0])o=null;else{l=null,c[0].includes("--\x3e")||(l=c[0],c.splice(0,1)),h=Ac(u=new Ui(c[0]));var f=Bi(u,/[ \t]+--\x3e[ \t]+/g),p=Ac(u);if(null==h||null==f||null==p)throw new z(2,2,2001);for(c=new Qt(h+d,p+d,c.slice(1).join("\n").trim()),Zi(u),d=Fi(u);d;)$c(c,d,o)||Y.v("VTT parser encountered an invalid VTT setting: ",d," The setting will be ignored."),Zi(u),d=Fi(u);null!=l&&(c.id=l),o=c}o&&i.push(o)}return i},Sc.prototype.parseMedia=Sc.prototype.parseMedia,mr["text/vtt"]=Sc,mr['text/vtt; codecs="vtt"']=Sc,mr['text/vtt; codecs="wvtt"']=Sc,F("shaka.text.Mp4VttParser",wc),wc.prototype.parseInit=function(e){var t=!1;if((new Gn).box("moov",Vn).box("trak",Vn).box("mdia",Vn).ma("mdhd",function(e){0==e.version?(e.reader.U(4),e.reader.U(4),this.g=e.reader.N(),e.reader.U(4)):(e.reader.U(8),e.reader.U(8),this.g=e.reader.N(),e.reader.U(8)),e.reader.U(4)}.bind(this)).box("minf",Vn).box("stbl",Vn).ma("stsd",Un).box("wvtt",(function(){t=!0})).parse(e),!this.g)throw new z(2,2,2008);if(!t)throw new z(2,2,2008)},wc.prototype.parseInit=wc.prototype.parseInit,wc.prototype.parseMedia=function(e,t){var r=this;if(!this.g)throw Y.error("No init segment for MP4+VTT!"),new z(2,2,2008);var n,i=0,a=[],o=[],s=!1,l=!1,u=!1,c=null;if((new Gn).box("moof",Vn).box("traf",Vn).ma("tfdt",(function(e){s=!0,i=0==e.version?e.reader.N():e.reader.Pb()})).ma("tfhd",(function(e){var t=e.flags;(e=e.reader).U(4),1&t&&e.U(8),2&t&&e.U(4),c=8&t?e.N():null})).ma("trun",(function(e){l=!0;var t=e.version,r=e.flags,n=(e=e.reader).N();1&r&&e.U(4),4&r&&e.U(4);for(var i=[],o=0;o<n;o++){var s={duration:null,sampleSize:null,Sd:null};256&r&&(s.duration=e.N()),512&r&&(s.sampleSize=e.N()),1024&r&&e.U(4),2048&r&&(s.Sd=0==t?e.N():e.De()),i.push(s)}a=i})).box("mdat",Zn((function(e){u=!0,n=e}))).parse(e),!u&&!s&&!l)throw new z(2,2,2008);var d=i,h=new Dn(new DataView(n.buffer,n.byteOffset,n.byteLength),0);return a.forEach((function(e){var n=e.duration||c,a=e.Sd?i+e.Sd:d;d=a+(n||0);var s=0;do{var l=h.N();s+=l;var u=h.N(),f=null;"vttc"==(u=Fn(u))?8<l&&(f=h.mb(l-8)):("vtte"!=u&&Y.error("Unknown box "+u+"! Skipping!"),h.U(l-8)),n?f&&o.push(kc(f,t.periodStart+a/r.g,t.periodStart+d/r.g)):Y.error("WVTT sample duration unknown, and no default found!")}while(e.sampleSize&&s<e.sampleSize)})),o.filter(de.Ra)},wc.prototype.parseMedia=wc.prototype.parseMedia,mr['application/mp4; codecs="wvtt"']=wc,F("shaka.util.Dom.createHTMLElement",(function(e){return document.createElement(e)})),F("shaka.util.Dom.createVideoElement",(function(){var e=document.createElement("video");return e.muted=!0,e.width=600,e.height=400,e})),F("shaka.util.Dom.asHTMLElement",(function(e){return e})),F("shaka.util.Dom.asHTMLMediaElement",(function(e){return e})),F("shaka.util.Dom.removeAllChildren",(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)})),F("EmeEncryptionSchemePolyfill",Ic),Ic.install=Cc,F("McEncryptionSchemePolyfill",Oc),Oc.install=Lc,Nc.prototype.getConfiguration=function(){var e=this.h.getConfiguration();if(e.videoCapabilities)for(var t=f(e.videoCapabilities),r=t.next();!r.done;r=t.next())r.value.encryptionScheme=this.g;if(e.audioCapabilities)for(r=(t=f(e.audioCapabilities)).next();!r.done;r=t.next())r.value.encryptionScheme=this.g;return e},Nc.prototype.createMediaKeys=function(){return this.h.createMediaKeys()},F("EncryptionSchemePolyfills",Uc),Uc.install=Zc,void 0!==n&&n.gf&&(n.gf=Uc)}.call(r,t,t,void 0),r.shaka)exports2[n]=r.shaka[n]}();var ShakaJsPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),_defineProperty$j(_assertThisInitialized$g(n=t.call(this,e)),"onAdaptation_",(function(){n.shakaplayer.getVariantTracks().forEach((function(e){if(e.active)for(var t=0;t<this.content.length;++t){var r=this.content[t];r.value===e.id?r.selected=!0:r.selected=!1}}))})),shakaPlayer_compiled.polyfill.installAll(),n}return _createClass$k(r,[{key:"afterCreate",value:function(){var e=this;this.content=[],this.url=this.player.config.url,shakaPlayer_compiled.Player.isBrowserSupported()&&this.on(URL_CHANGE,(function(t){/^blob/.test(t)||(e.url=t,e.loadUrl(t))}))}},{key:"beforePlayerInit",value:function(){if(!shakaPlayer_compiled.Player.isBrowserSupported())throw new Error("Browser not supported!");this._initShaka()}},{key:"destroy",value:function(){this.shakaplayer&&(this.shakaplayer.destroy(),this.shakaplayer=null)}},{key:"_initShaka",value:function(){var e=this.player;this.shakaplayer=new shakaPlayer_compiled.Player(e.video),this.shakaplayer.addEventListener("error",(function(e){console.error("Error code",e.detail.code,"object",e.detail)})),this.config.shakaOpts&&this.shakaplayer.configure(this.config.shakaOpts),this.shakaplayer.getNetworkingEngine().registerRequestFilter((function(e,t){e===shakaPlayer_compiled.net.NetworkingEngine.RequestType.LICENSE&&(t.headers["CWIP-Auth-Header"]="VGhpc0lzQVRlc3QK")})),this.shakaplayer.addEventListener("adaptation",this.onAdaptation_);this.shakaplayer.configure({abr:{enabled:!1}}),this.loadUrl(this.url)}},{key:"loadUrl",value:function(e){var t=this;this.shakaplayer.load(e).then((function(){console.log(" this.onTracksChanged_"),t.onTracksChanged_()})).catch((function(e){console.trace("event",e),console.error("Error code",e.detail.code,"object",e.detail)}))}},{key:"onTracksChanged_",value:function(){this.updateVariantTracks_()}},{key:"updateVariantTracks_",value:function(){var e=this.shakaplayer.getVariantTracks();e.sort((function(e,t){return e.bandwidth-t.bandwidth})),this.updateTrackOptions_(e)}},{key:"updateTrackOptions_",value:function(e){var t=this,r={variant:function(e){var t="";return e.width&&e.height&&(t+=e.height+"P"),t}};this.content=[],e.forEach((function(e){var n={};n.textContent=r[e.type](e),n.track=e,n.value=e.id,n.selected=e.active,t.content.push(n)})),this.updateDefinition()}},{key:"updateDefinition",value:function(){"mobile"!==sniffer$1.device&&console.log("updateDefinition",this.content)}}],[{key:"pluginName",get:function(){return"ShakaPlugin"}},{key:"defaultConfig",get:function(){return{shakaOpts:{}}}},{key:"isSupported",value:function(){return shakaPlayer_compiled.Player.isBrowserSupported()}}]),r}(BasePlugin);function ownKeys$e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$e(Object(r),!0).forEach((function(t){_defineProperty$c(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$7(){_regeneratorRuntime$7=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(w){s=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i,a,o,s,l=t&&t.prototype instanceof d?t:d,h=Object.create(l.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=_(r,o);if(n){if(n===c)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var l=u(i,a,o);if("normal"===l.type){if(s=o.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(s="completed",o.method="throw",o.arg=l.arg)}}),h}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(w){return{type:"throw",arg:w}}}e.wrap=l;var c={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y($([])));m&&m!==t&&r.call(m,i)&&(p=m);var g=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(i,a,o,s){var l=u(e[i],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function $(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=f,s(g,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},v(b.prototype),s(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new b(l(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(g),s(g,o,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=$,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:$(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}function _typeof$8(e){return(_typeof$8="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$9(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$9(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$9(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$9(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$d(e,t,r){return t&&_defineProperties$d(e.prototype,t),r&&_defineProperties$d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$9(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$9(e,t)}function _getPrototypeOf$9(e){return(_getPrototypeOf$9=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$9(e,t){return(_setPrototypeOf$9=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$9(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$9(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$9(e)}function _createSuper$c(e){var t=_isNativeReflectConstruct$c();return function(){var r,n=_getPrototypeOf$9(e);if(t){var i=_getPrototypeOf$9(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$9(this,r)}}function _unsupportedIterableToArray$9(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$9(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$9(e,t):void 0}}function _arrayLikeToArray$9(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper$3(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$9(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}var check=function(e){return e&&e.Math==Math&&e},global$T=check("object"==("undefined"==typeof globalThis?"undefined":_typeof$b(globalThis))&&globalThis)||check("object"==("undefined"==typeof window?"undefined":_typeof$b(window))&&window)||check("object"==("undefined"==typeof self?"undefined":_typeof$b(self))&&self)||check("object"==_typeof$b(commonjsGlobal)&&commonjsGlobal)||function(){return this}()||Function("return this")(),objectGetOwnPropertyDescriptor={},fails$13=function(e){try{return!!e()}catch(error){return!0}},fails$12=fails$13,descriptors=!fails$12((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),fails$11=fails$13,functionBindNative=!fails$11((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),NATIVE_BIND$5=functionBindNative,call$u=Function.prototype.call,functionCall=NATIVE_BIND$5?call$u.bind(call$u):function(){return call$u.apply(call$u,arguments)},objectPropertyIsEnumerable={},$propertyIsEnumerable$3={}.propertyIsEnumerable,getOwnPropertyDescriptor$7=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$7&&!$propertyIsEnumerable$3.call({1:2},1);objectPropertyIsEnumerable.f=NASHORN_BUG?function(e){var t=getOwnPropertyDescriptor$7(this,e);return!!t&&t.enumerable}:$propertyIsEnumerable$3;var createPropertyDescriptor$d=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},NATIVE_BIND$4=functionBindNative,FunctionPrototype$3=Function.prototype,call$t=FunctionPrototype$3.call,uncurryThisWithBind=NATIVE_BIND$4&&FunctionPrototype$3.bind.bind(call$t,call$t),functionUncurryThisRaw=function(e){return NATIVE_BIND$4?uncurryThisWithBind(e):function(){return call$t.apply(e,arguments)}},uncurryThisRaw$1=functionUncurryThisRaw,toString$z=uncurryThisRaw$1({}.toString),stringSlice$e=uncurryThisRaw$1("".slice),classofRaw$2=function(e){return stringSlice$e(toString$z(e),8,-1)},classofRaw$1=classofRaw$2,uncurryThisRaw=functionUncurryThisRaw,functionUncurryThis=function(e){if("Function"===classofRaw$1(e))return uncurryThisRaw(e)},uncurryThis$17=functionUncurryThis,fails$10=fails$13,classof$e=classofRaw$2,$Object$4=Object,split$3=uncurryThis$17("".split),indexedObject=fails$10((function(){return!$Object$4("z").propertyIsEnumerable(0)}))?function(e){return"String"==classof$e(e)?split$3(e,""):$Object$4(e)}:$Object$4,isNullOrUndefined$7=function(e){return null==e},isNullOrUndefined$6=isNullOrUndefined$7,$TypeError$j=TypeError,requireObjectCoercible$e=function(e){if(isNullOrUndefined$6(e))throw $TypeError$j("Can't call method on "+e);return e},IndexedObject$6=indexedObject,requireObjectCoercible$d=requireObjectCoercible$e,toIndexedObject$f=function(e){return IndexedObject$6(requireObjectCoercible$d(e))},documentAll$2="object"==("undefined"==typeof document?"undefined":_typeof$b(document))&&document.all,IS_HTMLDDA=void 0===documentAll$2&&void 0!==documentAll$2,documentAll_1={all:documentAll$2,IS_HTMLDDA:IS_HTMLDDA},$documentAll$1=documentAll_1,documentAll$1=$documentAll$1.all,isCallable$v=$documentAll$1.IS_HTMLDDA?function(e){return"function"==typeof e||e===documentAll$1}:function(e){return"function"==typeof e},isCallable$u=isCallable$v,$documentAll=documentAll_1,documentAll=$documentAll.all,isObject$w=$documentAll.IS_HTMLDDA?function(e){return"object"==_typeof$b(e)?null!==e:isCallable$u(e)||e===documentAll}:function(e){return"object"==_typeof$b(e)?null!==e:isCallable$u(e)},global$S=global$T,isCallable$t=isCallable$v,aFunction=function(e){return isCallable$t(e)?e:void 0},getBuiltIn$p=function(e,t){return arguments.length<2?aFunction(global$S[e]):global$S[e]&&global$S[e][t]},uncurryThis$16=functionUncurryThis,objectIsPrototypeOf=uncurryThis$16({}.isPrototypeOf),getBuiltIn$o=getBuiltIn$p,engineUserAgent=getBuiltIn$o("navigator","userAgent")||"",global$R=global$T,userAgent$8=engineUserAgent,process$5=global$R.process,Deno$1=global$R.Deno,versions=process$5&&process$5.versions||Deno$1&&Deno$1.version,v8=versions&&versions.v8,match,version$4;v8&&(match=v8.split("."),version$4=match[0]>0&&match[0]<4?1:+(match[0]+match[1])),!version$4&&userAgent$8&&(match=userAgent$8.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=userAgent$8.match(/Chrome\/(\d+)/),match&&(version$4=+match[1])));var engineV8Version=version$4,V8_VERSION$3=engineV8Version,fails$$=fails$13,symbolConstructorDetection=!!Object.getOwnPropertySymbols&&!fails$$((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&V8_VERSION$3&&V8_VERSION$3<41})),NATIVE_SYMBOL$6=symbolConstructorDetection,useSymbolAsUid=NATIVE_SYMBOL$6&&!Symbol.sham&&"symbol"==_typeof$b(Symbol.iterator),getBuiltIn$n=getBuiltIn$p,isCallable$s=isCallable$v,isPrototypeOf$a=objectIsPrototypeOf,USE_SYMBOL_AS_UID$1=useSymbolAsUid,$Object$3=Object,isSymbol$6=USE_SYMBOL_AS_UID$1?function(e){return"symbol"==_typeof$b(e)}:function(e){var t=getBuiltIn$n("Symbol");return isCallable$s(t)&&isPrototypeOf$a(t.prototype,$Object$3(e))},$String$4=String,tryToString$7=function(e){try{return $String$4(e)}catch(error){return"Object"}},isCallable$r=isCallable$v,tryToString$6=tryToString$7,$TypeError$i=TypeError,aCallable$e=function(e){if(isCallable$r(e))return e;throw $TypeError$i(tryToString$6(e)+" is not a function")},aCallable$d=aCallable$e,isNullOrUndefined$5=isNullOrUndefined$7,getMethod$6=function(e,t){var r=e[t];return isNullOrUndefined$5(r)?void 0:aCallable$d(r)},call$s=functionCall,isCallable$q=isCallable$v,isObject$v=isObject$w,$TypeError$h=TypeError,ordinaryToPrimitive$1=function(e,t){var r,n;if("string"===t&&isCallable$q(r=e.toString)&&!isObject$v(n=call$s(r,e)))return n;if(isCallable$q(r=e.valueOf)&&!isObject$v(n=call$s(r,e)))return n;if("string"!==t&&isCallable$q(r=e.toString)&&!isObject$v(n=call$s(r,e)))return n;throw $TypeError$h("Can't convert object to primitive value")},shared$7={exports:{}},isPure=!1,global$Q=global$T,defineProperty$j=Object.defineProperty,defineGlobalProperty$3=function(e,t){try{defineProperty$j(global$Q,e,{value:t,configurable:!0,writable:!0})}catch(error){global$Q[e]=t}return t},global$P=global$T,defineGlobalProperty$2=defineGlobalProperty$3,SHARED="__core-js_shared__",store$3=global$P[SHARED]||defineGlobalProperty$2(SHARED,{}),sharedStore=store$3,store$2=sharedStore;(shared$7.exports=function(e,t){return store$2[e]||(store$2[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.25.5",mode:"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.5/LICENSE",source:"https://github.com/zloirock/core-js"});var requireObjectCoercible$c=requireObjectCoercible$e,$Object$2=Object,toObject$m=function(e){return $Object$2(requireObjectCoercible$c(e))},uncurryThis$15=functionUncurryThis,toObject$l=toObject$m,hasOwnProperty$2=uncurryThis$15({}.hasOwnProperty),hasOwnProperty_1=Object.hasOwn||function(e,t){return hasOwnProperty$2(toObject$l(e),t)},uncurryThis$14=functionUncurryThis,id=0,postfix=Math.random(),toString$y=uncurryThis$14(1..toString),uid$4=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString$y(++id+postfix,36)},global$O=global$T,shared$6=shared$7.exports,hasOwn$u=hasOwnProperty_1,uid$3=uid$4,NATIVE_SYMBOL$5=symbolConstructorDetection,USE_SYMBOL_AS_UID=useSymbolAsUid,WellKnownSymbolsStore$1=shared$6("wks"),_Symbol$4=global$O.Symbol,symbolFor=_Symbol$4&&_Symbol$4.for,createWellKnownSymbol=USE_SYMBOL_AS_UID?_Symbol$4:_Symbol$4&&_Symbol$4.withoutSetter||uid$3,wellKnownSymbol$t=function(e){if(!hasOwn$u(WellKnownSymbolsStore$1,e)||!NATIVE_SYMBOL$5&&"string"!=typeof WellKnownSymbolsStore$1[e]){var t="Symbol."+e;NATIVE_SYMBOL$5&&hasOwn$u(_Symbol$4,e)?WellKnownSymbolsStore$1[e]=_Symbol$4[e]:WellKnownSymbolsStore$1[e]=USE_SYMBOL_AS_UID&&symbolFor?symbolFor(t):createWellKnownSymbol(t)}return WellKnownSymbolsStore$1[e]},call$r=functionCall,isObject$u=isObject$w,isSymbol$5=isSymbol$6,getMethod$5=getMethod$6,ordinaryToPrimitive=ordinaryToPrimitive$1,wellKnownSymbol$s=wellKnownSymbol$t,$TypeError$g=TypeError,TO_PRIMITIVE=wellKnownSymbol$s("toPrimitive"),toPrimitive$3=function(e,t){if(!isObject$u(e)||isSymbol$5(e))return e;var r,n=getMethod$5(e,TO_PRIMITIVE);if(n){if(void 0===t&&(t="default"),r=call$r(n,e,t),!isObject$u(r)||isSymbol$5(r))return r;throw $TypeError$g("Can't convert object to primitive value")}return void 0===t&&(t="number"),ordinaryToPrimitive(e,t)},toPrimitive$2=toPrimitive$3,isSymbol$4=isSymbol$6,toPropertyKey$6=function(e){var t=toPrimitive$2(e,"string");return isSymbol$4(t)?t:t+""},global$N=global$T,isObject$t=isObject$w,document$3=global$N.document,EXISTS$1=isObject$t(document$3)&&isObject$t(document$3.createElement),documentCreateElement$2=function(e){return EXISTS$1?document$3.createElement(e):{}},DESCRIPTORS$B=descriptors,fails$_=fails$13,createElement$1=documentCreateElement$2,ie8DomDefine=!DESCRIPTORS$B&&!fails$_((function(){return 7!=Object.defineProperty(createElement$1("div"),"a",{get:function(){return 7}}).a})),DESCRIPTORS$A=descriptors,call$q=functionCall,propertyIsEnumerableModule$2=objectPropertyIsEnumerable,createPropertyDescriptor$c=createPropertyDescriptor$d,toIndexedObject$e=toIndexedObject$f,toPropertyKey$5=toPropertyKey$6,hasOwn$t=hasOwnProperty_1,IE8_DOM_DEFINE$1=ie8DomDefine,$getOwnPropertyDescriptor$2=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor.f=DESCRIPTORS$A?$getOwnPropertyDescriptor$2:function(e,t){if(e=toIndexedObject$e(e),t=toPropertyKey$5(t),IE8_DOM_DEFINE$1)try{return $getOwnPropertyDescriptor$2(e,t)}catch(error){}if(hasOwn$t(e,t))return createPropertyDescriptor$c(!call$q(propertyIsEnumerableModule$2.f,e,t),e[t])};var objectDefineProperty={},DESCRIPTORS$z=descriptors,fails$Z=fails$13,v8PrototypeDefineBug=DESCRIPTORS$z&&fails$Z((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),isObject$s=isObject$w,$String$3=String,$TypeError$f=TypeError,anObject$r=function(e){if(isObject$s(e))return e;throw $TypeError$f($String$3(e)+" is not an object")},DESCRIPTORS$y=descriptors,IE8_DOM_DEFINE=ie8DomDefine,V8_PROTOTYPE_DEFINE_BUG$1=v8PrototypeDefineBug,anObject$q=anObject$r,toPropertyKey$4=toPropertyKey$6,$TypeError$e=TypeError,$defineProperty$1=Object.defineProperty,$getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE$1="configurable",WRITABLE="writable";objectDefineProperty.f=DESCRIPTORS$y?V8_PROTOTYPE_DEFINE_BUG$1?function(e,t,r){if(anObject$q(e),t=toPropertyKey$4(t),anObject$q(r),"function"==typeof e&&"prototype"===t&&"value"in r&&WRITABLE in r&&!r[WRITABLE]){var n=$getOwnPropertyDescriptor$1(e,t);n&&n[WRITABLE]&&(e[t]=r.value,r={configurable:CONFIGURABLE$1 in r?r[CONFIGURABLE$1]:n[CONFIGURABLE$1],enumerable:ENUMERABLE in r?r[ENUMERABLE]:n[ENUMERABLE],writable:!1})}return $defineProperty$1(e,t,r)}:$defineProperty$1:function(e,t,r){if(anObject$q(e),t=toPropertyKey$4(t),anObject$q(r),IE8_DOM_DEFINE)try{return $defineProperty$1(e,t,r)}catch(error){}if("get"in r||"set"in r)throw $TypeError$e("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var DESCRIPTORS$x=descriptors,definePropertyModule$7=objectDefineProperty,createPropertyDescriptor$b=createPropertyDescriptor$d,createNonEnumerableProperty$d=DESCRIPTORS$x?function(e,t,r){return definePropertyModule$7.f(e,t,createPropertyDescriptor$b(1,r))}:function(e,t,r){return e[t]=r,e},makeBuiltIn$3={exports:{}},DESCRIPTORS$w=descriptors,hasOwn$s=hasOwnProperty_1,FunctionPrototype$2=Function.prototype,getDescriptor=DESCRIPTORS$w&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn$s(FunctionPrototype$2,"name"),PROPER=EXISTS&&"something"===function(){}.name,CONFIGURABLE=EXISTS&&(!DESCRIPTORS$w||DESCRIPTORS$w&&getDescriptor(FunctionPrototype$2,"name").configurable),functionName={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE},uncurryThis$13=functionUncurryThis,isCallable$p=isCallable$v,store$1=sharedStore,functionToString$2=uncurryThis$13(Function.toString);isCallable$p(store$1.inspectSource)||(store$1.inspectSource=function(e){return functionToString$2(e)});var inspectSource$3=store$1.inspectSource,global$M=global$T,isCallable$o=isCallable$v,WeakMap$2=global$M.WeakMap,weakMapBasicDetection=isCallable$o(WeakMap$2)&&/native code/.test(String(WeakMap$2)),shared$5=shared$7.exports,uid$2=uid$4,keys$6=shared$5("keys"),sharedKey$4=function(e){return keys$6[e]||(keys$6[e]=uid$2(e))},hiddenKeys$5={},NATIVE_WEAK_MAP=weakMapBasicDetection,global$L=global$T,isObject$r=isObject$w,createNonEnumerableProperty$c=createNonEnumerableProperty$d,hasOwn$r=hasOwnProperty_1,shared$4=sharedStore,sharedKey$3=sharedKey$4,hiddenKeys$4=hiddenKeys$5,OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError$7=global$L.TypeError,WeakMap$1=global$L.WeakMap,set$2,get$1,has,enforce=function(e){return has(e)?get$1(e):set$2(e,{})},getterFor$2=function(e){return function(t){var r;if(!isObject$r(t)||(r=get$1(t)).type!==e)throw TypeError$7("Incompatible receiver, "+e+" required");return r}};if(NATIVE_WEAK_MAP||shared$4.state){var store=shared$4.state||(shared$4.state=new WeakMap$1);store.get=store.get,store.has=store.has,store.set=store.set,set$2=function(e,t){if(store.has(e))throw TypeError$7(OBJECT_ALREADY_INITIALIZED);return t.facade=e,store.set(e,t),t},get$1=function(e){return store.get(e)||{}},has=function(e){return store.has(e)}}else{var STATE=sharedKey$3("state");hiddenKeys$4[STATE]=!0,set$2=function(e,t){if(hasOwn$r(e,STATE))throw TypeError$7(OBJECT_ALREADY_INITIALIZED);return t.facade=e,createNonEnumerableProperty$c(e,STATE,t),t},get$1=function(e){return hasOwn$r(e,STATE)?e[STATE]:{}},has=function(e){return hasOwn$r(e,STATE)}}var internalState={set:set$2,get:get$1,has:has,enforce:enforce,getterFor:getterFor$2},fails$Y=fails$13,isCallable$n=isCallable$v,hasOwn$q=hasOwnProperty_1,DESCRIPTORS$v=descriptors,CONFIGURABLE_FUNCTION_NAME$2=functionName.CONFIGURABLE,inspectSource$2=inspectSource$3,InternalStateModule$b=internalState,enforceInternalState$2=InternalStateModule$b.enforce,getInternalState$9=InternalStateModule$b.get,defineProperty$i=Object.defineProperty,CONFIGURABLE_LENGTH=DESCRIPTORS$v&&!fails$Y((function(){return 8!==defineProperty$i((function(){}),"length",{value:8}).length})),TEMPLATE=String(String).split("String"),makeBuiltIn$2=makeBuiltIn$3.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!hasOwn$q(e,"name")||CONFIGURABLE_FUNCTION_NAME$2&&e.name!==t)&&(DESCRIPTORS$v?defineProperty$i(e,"name",{value:t,configurable:!0}):e.name=t),CONFIGURABLE_LENGTH&&r&&hasOwn$q(r,"arity")&&e.length!==r.arity&&defineProperty$i(e,"length",{value:r.arity});try{r&&hasOwn$q(r,"constructor")&&r.constructor?DESCRIPTORS$v&&defineProperty$i(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(error){}var n=enforceInternalState$2(e);return hasOwn$q(n,"source")||(n.source=TEMPLATE.join("string"==typeof t?t:"")),e};Function.prototype.toString=makeBuiltIn$2((function(){return isCallable$n(this)&&getInternalState$9(this).source||inspectSource$2(this)}),"toString");var isCallable$m=isCallable$v,definePropertyModule$6=objectDefineProperty,makeBuiltIn$1=makeBuiltIn$3.exports,defineGlobalProperty$1=defineGlobalProperty$3,defineBuiltIn$m=function(e,t,r,n){n||(n={});var i=n.enumerable,a=void 0!==n.name?n.name:t;if(isCallable$m(r)&&makeBuiltIn$1(r,a,n),n.global)i?e[t]=r:defineGlobalProperty$1(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(error){}i?e[t]=r:definePropertyModule$6.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},objectGetOwnPropertyNames={},ceil$1=Math.ceil,floor$a=Math.floor,mathTrunc=Math.trunc||function(e){var t=+e;return(t>0?floor$a:ceil$1)(t)},trunc$2=mathTrunc,toIntegerOrInfinity$i=function(e){var t=+e;return t!=t||0===t?0:trunc$2(t)},toIntegerOrInfinity$h=toIntegerOrInfinity$i,max$7=Math.max,min$9=Math.min,toAbsoluteIndex$9=function(e,t){var r=toIntegerOrInfinity$h(e);return r<0?max$7(r+t,0):min$9(r,t)},toIntegerOrInfinity$g=toIntegerOrInfinity$i,min$8=Math.min,toLength$c=function(e){return e>0?min$8(toIntegerOrInfinity$g(e),9007199254740991):0},toLength$b=toLength$c,lengthOfArrayLike$r=function(e){return toLength$b(e.length)},toIndexedObject$d=toIndexedObject$f,toAbsoluteIndex$8=toAbsoluteIndex$9,lengthOfArrayLike$q=lengthOfArrayLike$r,createMethod$8=function(e){return function(t,r,n){var i,a=toIndexedObject$d(t),o=lengthOfArrayLike$q(a),s=toAbsoluteIndex$8(n,o);if(e&&r!=r){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===r)return e||s||0;return!e&&-1}},arrayIncludes={includes:createMethod$8(!0),indexOf:createMethod$8(!1)},uncurryThis$12=functionUncurryThis,hasOwn$p=hasOwnProperty_1,toIndexedObject$c=toIndexedObject$f,indexOf$2=arrayIncludes.indexOf,hiddenKeys$3=hiddenKeys$5,push$b=uncurryThis$12([].push),objectKeysInternal=function(e,t){var r,n=toIndexedObject$c(e),i=0,a=[];for(r in n)!hasOwn$p(hiddenKeys$3,r)&&hasOwn$p(n,r)&&push$b(a,r);for(;t.length>i;)hasOwn$p(n,r=t[i++])&&(~indexOf$2(a,r)||push$b(a,r));return a},enumBugKeys$3=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys$1=objectKeysInternal,enumBugKeys$2=enumBugKeys$3,hiddenKeys$2=enumBugKeys$2.concat("length","prototype");objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(e){return internalObjectKeys$1(e,hiddenKeys$2)};var objectGetOwnPropertySymbols={};objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols;var getBuiltIn$m=getBuiltIn$p,uncurryThis$11=functionUncurryThis,getOwnPropertyNamesModule$1=objectGetOwnPropertyNames,getOwnPropertySymbolsModule$3=objectGetOwnPropertySymbols,anObject$p=anObject$r,concat$5=uncurryThis$11([].concat),ownKeys$d=getBuiltIn$m("Reflect","ownKeys")||function(e){var t=getOwnPropertyNamesModule$1.f(anObject$p(e)),r=getOwnPropertySymbolsModule$3.f;return r?concat$5(t,r(e)):t},hasOwn$o=hasOwnProperty_1,ownKeys$c=ownKeys$d,getOwnPropertyDescriptorModule$3=objectGetOwnPropertyDescriptor,definePropertyModule$5=objectDefineProperty,copyConstructorProperties$4=function(e,t,r){for(var n=ownKeys$c(t),i=definePropertyModule$5.f,a=getOwnPropertyDescriptorModule$3.f,o=0;o<n.length;o++){var s=n[o];hasOwn$o(e,s)||r&&hasOwn$o(r,s)||i(e,s,a(t,s))}},fails$X=fails$13,isCallable$l=isCallable$v,replacement=/#|\.prototype\./,isForced$3=function(e,t){var r=data[normalize(e)];return r==POLYFILL||r!=NATIVE&&(isCallable$l(t)?fails$X(t):!!t)},normalize=isForced$3.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced$3.data={},NATIVE=isForced$3.NATIVE="N",POLYFILL=isForced$3.POLYFILL="P",isForced_1=isForced$3,global$K=global$T,getOwnPropertyDescriptor$6=objectGetOwnPropertyDescriptor.f,createNonEnumerableProperty$b=createNonEnumerableProperty$d,defineBuiltIn$l=defineBuiltIn$m,defineGlobalProperty=defineGlobalProperty$3,copyConstructorProperties$3=copyConstructorProperties$4,isForced$2=isForced_1,_export=function(e,t){var r,n,i,a,o,s=e.target,l=e.global,u=e.stat;if(r=l?global$K:u?global$K[s]||defineGlobalProperty(s,{}):(global$K[s]||{}).prototype)for(n in t){if(a=t[n],i=e.dontCallGetSet?(o=getOwnPropertyDescriptor$6(r,n))&&o.value:r[n],!isForced$2(l?n:s+(u?".":"#")+n,e.forced)&&void 0!==i){if(_typeof$b(a)==_typeof$b(i))continue;copyConstructorProperties$3(a,i)}(e.sham||i&&i.sham)&&createNonEnumerableProperty$b(a,"sham",!0),defineBuiltIn$l(r,n,a,e)}},classof$d=classofRaw$2,isArray$7=Array.isArray||function(e){return"Array"==classof$d(e)},$TypeError$d=TypeError,MAX_SAFE_INTEGER$2=9007199254740991,doesNotExceedSafeInteger$6=function(e){if(e>MAX_SAFE_INTEGER$2)throw $TypeError$d("Maximum allowed index exceeded");return e},toPropertyKey$3=toPropertyKey$6,definePropertyModule$4=objectDefineProperty,createPropertyDescriptor$a=createPropertyDescriptor$d,createProperty$6=function(e,t,r){var n=toPropertyKey$3(t);n in e?definePropertyModule$4.f(e,n,createPropertyDescriptor$a(0,r)):e[n]=r},wellKnownSymbol$r=wellKnownSymbol$t,TO_STRING_TAG$4=wellKnownSymbol$r("toStringTag"),test$2={};test$2[TO_STRING_TAG$4]="z";var toStringTagSupport="[object z]"===String(test$2),TO_STRING_TAG_SUPPORT$2=toStringTagSupport,isCallable$k=isCallable$v,classofRaw=classofRaw$2,wellKnownSymbol$q=wellKnownSymbol$t,TO_STRING_TAG$3=wellKnownSymbol$q("toStringTag"),$Object$1=Object,CORRECT_ARGUMENTS="Arguments"==classofRaw(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(error){}},classof$c=TO_STRING_TAG_SUPPORT$2?classofRaw:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=tryGet(t=$Object$1(e),TO_STRING_TAG$3))?r:CORRECT_ARGUMENTS?classofRaw(t):"Object"==(n=classofRaw(t))&&isCallable$k(t.callee)?"Arguments":n},uncurryThis$10=functionUncurryThis,fails$W=fails$13,isCallable$j=isCallable$v,classof$b=classof$c,getBuiltIn$l=getBuiltIn$p,inspectSource$1=inspectSource$3,noop$1=function(){},empty=[],construct$2=getBuiltIn$l("Reflect","construct"),constructorRegExp=/^\s*(?:class|function)\b/,exec$a=uncurryThis$10(constructorRegExp.exec),INCORRECT_TO_STRING$4=!constructorRegExp.exec(noop$1),isConstructorModern=function(e){if(!isCallable$j(e))return!1;try{return construct$2(noop$1,empty,e),!0}catch(error){return!1}},isConstructorLegacy=function(e){if(!isCallable$j(e))return!1;switch(classof$b(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return INCORRECT_TO_STRING$4||!!exec$a(constructorRegExp,inspectSource$1(e))}catch(error){return!0}};isConstructorLegacy.sham=!0;var isConstructor$4=!construct$2||fails$W((function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern((function(){e=!0}))||e}))?isConstructorLegacy:isConstructorModern,isArray$6=isArray$7,isConstructor$3=isConstructor$4,isObject$q=isObject$w,wellKnownSymbol$p=wellKnownSymbol$t,SPECIES$6=wellKnownSymbol$p("species"),$Array$5=Array,arraySpeciesConstructor$1=function(e){var t;return isArray$6(e)&&(t=e.constructor,(isConstructor$3(t)&&(t===$Array$5||isArray$6(t.prototype))||isObject$q(t)&&null===(t=t[SPECIES$6]))&&(t=void 0)),void 0===t?$Array$5:t},arraySpeciesConstructor=arraySpeciesConstructor$1,arraySpeciesCreate$3=function(e,t){return new(arraySpeciesConstructor(e))(0===t?0:t)},fails$V=fails$13,wellKnownSymbol$o=wellKnownSymbol$t,V8_VERSION$2=engineV8Version,SPECIES$5=wellKnownSymbol$o("species"),arrayMethodHasSpeciesSupport$5=function(e){return V8_VERSION$2>=51||!fails$V((function(){var t=[];return(t.constructor={})[SPECIES$5]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},$$1I=_export,fails$U=fails$13,isArray$5=isArray$7,isObject$p=isObject$w,toObject$k=toObject$m,lengthOfArrayLike$p=lengthOfArrayLike$r,doesNotExceedSafeInteger$5=doesNotExceedSafeInteger$6,createProperty$5=createProperty$6,arraySpeciesCreate$2=arraySpeciesCreate$3,arrayMethodHasSpeciesSupport$4=arrayMethodHasSpeciesSupport$5,wellKnownSymbol$n=wellKnownSymbol$t,V8_VERSION$1=engineV8Version,IS_CONCAT_SPREADABLE=wellKnownSymbol$n("isConcatSpreadable"),IS_CONCAT_SPREADABLE_SUPPORT=V8_VERSION$1>=51||!fails$U((function(){var e=[];return e[IS_CONCAT_SPREADABLE]=!1,e.concat()[0]!==e})),SPECIES_SUPPORT=arrayMethodHasSpeciesSupport$4("concat"),isConcatSpreadable=function(e){if(!isObject$p(e))return!1;var t=e[IS_CONCAT_SPREADABLE];return void 0!==t?!!t:isArray$5(e)},FORCED$k=!IS_CONCAT_SPREADABLE_SUPPORT||!SPECIES_SUPPORT;$$1I({target:"Array",proto:!0,arity:1,forced:FORCED$k},{concat:function(e){var t,r,n,i,a,o=toObject$k(this),s=arraySpeciesCreate$2(o,0),l=0;for(t=-1,n=arguments.length;t<n;t++)if(isConcatSpreadable(a=-1===t?o:arguments[t]))for(i=lengthOfArrayLike$p(a),doesNotExceedSafeInteger$5(l+i),r=0;r<i;r++,l++)r in a&&createProperty$5(s,l,a[r]);else doesNotExceedSafeInteger$5(l+1),createProperty$5(s,l++,a);return s.length=l,s}});var fails$T=fails$13,arrayMethodIsStrict$b=function(e,t){var r=[][e];return!!r&&fails$T((function(){r.call(null,t||function(){return 1},1)}))},$$1H=_export,uncurryThis$$=functionUncurryThis,$indexOf$2=arrayIncludes.indexOf,arrayMethodIsStrict$a=arrayMethodIsStrict$b,nativeIndexOf$1=uncurryThis$$([].indexOf),NEGATIVE_ZERO$2=!!nativeIndexOf$1&&1/nativeIndexOf$1([1],1,-0)<0,STRICT_METHOD$a=arrayMethodIsStrict$a("indexOf");$$1H({target:"Array",proto:!0,forced:NEGATIVE_ZERO$2||!STRICT_METHOD$a},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return NEGATIVE_ZERO$2?nativeIndexOf$1(this,e,t)||0:$indexOf$2(this,e,t)}});var DESCRIPTORS$u=descriptors,isArray$4=isArray$7,$TypeError$c=TypeError,getOwnPropertyDescriptor$5=Object.getOwnPropertyDescriptor,SILENT_ON_NON_WRITABLE_LENGTH_SET=DESCRIPTORS$u&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(error){return error instanceof TypeError}}(),arraySetLength=SILENT_ON_NON_WRITABLE_LENGTH_SET?function(e,t){if(isArray$4(e)&&!getOwnPropertyDescriptor$5(e,"length").writable)throw $TypeError$c("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},$$1G=_export,toObject$j=toObject$m,lengthOfArrayLike$o=lengthOfArrayLike$r,setArrayLength$4=arraySetLength,doesNotExceedSafeInteger$4=doesNotExceedSafeInteger$6,fails$S=fails$13,INCORRECT_TO_LENGTH$1=fails$S((function(){return 4294967297!==[].push.call({length:4294967296},1)})),SILENT_ON_NON_WRITABLE_LENGTH$3=!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(error){return error instanceof TypeError}}();$$1G({target:"Array",proto:!0,arity:1,forced:INCORRECT_TO_LENGTH$1||SILENT_ON_NON_WRITABLE_LENGTH$3},{push:function(e){var t=toObject$j(this),r=lengthOfArrayLike$o(t),n=arguments.length;doesNotExceedSafeInteger$4(r+n);for(var i=0;i<n;i++)t[r]=arguments[i],r++;return setArrayLength$4(t,r),r}});var internalObjectKeys=objectKeysInternal,enumBugKeys$1=enumBugKeys$3,objectKeys$5=Object.keys||function(e){return internalObjectKeys(e,enumBugKeys$1)},DESCRIPTORS$t=descriptors,uncurryThis$_=functionUncurryThis,call$p=functionCall,fails$R=fails$13,objectKeys$4=objectKeys$5,getOwnPropertySymbolsModule$2=objectGetOwnPropertySymbols,propertyIsEnumerableModule$1=objectPropertyIsEnumerable,toObject$i=toObject$m,IndexedObject$5=indexedObject,$assign=Object.assign,defineProperty$h=Object.defineProperty,concat$4=uncurryThis$_([].concat),objectAssign=!$assign||fails$R((function(){if(DESCRIPTORS$t&&1!==$assign({b:1},$assign(defineProperty$h({},"a",{enumerable:!0,get:function(){defineProperty$h(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=$assign({},e)[r]||objectKeys$4($assign({},t)).join("")!=n}))?function(e,t){for(var r=toObject$i(e),n=arguments.length,i=1,a=getOwnPropertySymbolsModule$2.f,o=propertyIsEnumerableModule$1.f;n>i;)for(var s,l=IndexedObject$5(arguments[i++]),u=a?concat$4(objectKeys$4(l),a(l)):objectKeys$4(l),c=u.length,d=0;c>d;)s=u[d++],DESCRIPTORS$t&&!call$p(o,l,s)||(r[s]=l[s]);return r}:$assign,$$1F=_export,assign$4=objectAssign;$$1F({target:"Object",stat:!0,arity:2,forced:Object.assign!==assign$4},{assign:assign$4});var NATIVE_BIND$3=functionBindNative,FunctionPrototype$1=Function.prototype,apply$b=FunctionPrototype$1.apply,call$o=FunctionPrototype$1.call,functionApply="object"==("undefined"==typeof Reflect?"undefined":_typeof$b(Reflect))&&Reflect.apply||(NATIVE_BIND$3?call$o.bind(apply$b):function(){return call$o.apply(apply$b,arguments)}),uncurryThis$Z=functionUncurryThis,arraySlice$c=uncurryThis$Z([].slice),$TypeError$b=TypeError,validateArgumentsLength$8=function(e,t){if(e<t)throw $TypeError$b("Not enough arguments");return e},global$J=global$T,apply$a=functionApply,isCallable$i=isCallable$v,userAgent$7=engineUserAgent,arraySlice$b=arraySlice$c,validateArgumentsLength$7=validateArgumentsLength$8,MSIE$1=/MSIE .\./.test(userAgent$7),Function$3=global$J.Function,wrap$2=function(e){return MSIE$1?function(t,r){var n=validateArgumentsLength$7(arguments.length,1)>2,i=isCallable$i(t)?t:Function$3(t),a=n?arraySlice$b(arguments,2):void 0;return e(n?function(){apply$a(i,this,a)}:i,r)}:e},schedulersFix$1={setTimeout:wrap$2(global$J.setTimeout),setInterval:wrap$2(global$J.setInterval)},$$1E=_export,global$I=global$T,setInterval$2=schedulersFix$1.setInterval;$$1E({global:!0,bind:!0,forced:global$I.setInterval!==setInterval$2},{setInterval:setInterval$2});var $$1D=_export,global$H=global$T,setTimeout$2=schedulersFix$1.setTimeout;$$1D({global:!0,bind:!0,forced:global$H.setTimeout!==setTimeout$2},{setTimeout:setTimeout$2});var uncurryThis$Y=functionUncurryThis,aCallable$c=aCallable$e,isObject$o=isObject$w,hasOwn$n=hasOwnProperty_1,arraySlice$a=arraySlice$c,NATIVE_BIND$2=functionBindNative,$Function$1=Function,concat$3=uncurryThis$Y([].concat),join$5=uncurryThis$Y([].join),factories$1={},construct$1=function(e,t,r){if(!hasOwn$n(factories$1,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";factories$1[t]=$Function$1("C,a","return new C("+join$5(n,",")+")")}return factories$1[t](e,r)},functionBind$1=NATIVE_BIND$2?$Function$1.bind:function(e){var t=aCallable$c(this),r=t.prototype,n=arraySlice$a(arguments,1),i=function(){var r=concat$3(n,arraySlice$a(arguments));return this instanceof i?construct$1(t,r.length,r):t.apply(e,r)};return isObject$o(r)&&(i.prototype=r),i},$$1C=_export,bind$e=functionBind$1;$$1C({target:"Function",proto:!0,forced:Function.bind!==bind$e},{bind:bind$e});var uncurryThis$X=functionUncurryThis,defineBuiltIn$k=defineBuiltIn$m,DatePrototype$1=Date.prototype,INVALID_DATE$1="Invalid Date",TO_STRING$2="toString",nativeDateToString$1=uncurryThis$X(DatePrototype$1[TO_STRING$2]),thisTimeValue$3=uncurryThis$X(DatePrototype$1.getTime);String(new Date(NaN))!=INVALID_DATE$1&&defineBuiltIn$k(DatePrototype$1,TO_STRING$2,(function(){var e=thisTimeValue$3(this);return e==e?nativeDateToString$1(this):INVALID_DATE$1}));var uncurryThis$W=functionUncurryThis,aCallable$b=aCallable$e,NATIVE_BIND$1=functionBindNative,bind$d=uncurryThis$W(uncurryThis$W.bind),functionBindContext=function(e,t){return aCallable$b(e),void 0===t?e:NATIVE_BIND$1?bind$d(e,t):function(){return e.apply(t,arguments)}},bind$c=functionBindContext,uncurryThis$V=functionUncurryThis,IndexedObject$4=indexedObject,toObject$h=toObject$m,lengthOfArrayLike$n=lengthOfArrayLike$r,arraySpeciesCreate$1=arraySpeciesCreate$3,push$a=uncurryThis$V([].push),createMethod$7=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(l,u,c,d){for(var h,f,p=toObject$h(l),y=IndexedObject$4(p),m=bind$c(u,c),g=lengthOfArrayLike$n(y),v=0,b=d||arraySpeciesCreate$1,_=t?b(l,g):r||o?b(l,0):void 0;g>v;v++)if((s||v in y)&&(f=m(h=y[v],v,p),e))if(t)_[v]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:push$a(_,h)}else switch(e){case 4:return!1;case 7:push$a(_,h)}return a?-1:n||i?i:_}},arrayIteration={forEach:createMethod$7(0),map:createMethod$7(1),filter:createMethod$7(2),some:createMethod$7(3),every:createMethod$7(4),find:createMethod$7(5),findIndex:createMethod$7(6),filterReject:createMethod$7(7)},$forEach$2=arrayIteration.forEach,arrayMethodIsStrict$9=arrayMethodIsStrict$b,STRICT_METHOD$9=arrayMethodIsStrict$9("forEach"),arrayForEach=STRICT_METHOD$9?[].forEach:function(e){return $forEach$2(this,e,arguments.length>1?arguments[1]:void 0)},$$1B=_export,forEach$4=arrayForEach;$$1B({target:"Array",proto:!0,forced:[].forEach!=forEach$4},{forEach:forEach$4});var TO_STRING_TAG_SUPPORT$1=toStringTagSupport,classof$a=classof$c,objectToString=TO_STRING_TAG_SUPPORT$1?{}.toString:function(){return"[object "+classof$a(this)+"]"},TO_STRING_TAG_SUPPORT=toStringTagSupport,defineBuiltIn$j=defineBuiltIn$m,toString$x=objectToString;TO_STRING_TAG_SUPPORT||defineBuiltIn$j(Object.prototype,"toString",toString$x,{unsafe:!0});var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},documentCreateElement$1=documentCreateElement$2,classList=documentCreateElement$1("span").classList,DOMTokenListPrototype$2=classList&&classList.constructor&&classList.constructor.prototype,domTokenListPrototype=DOMTokenListPrototype$2===Object.prototype?void 0:DOMTokenListPrototype$2,global$G=global$T,DOMIterables$1=domIterables,DOMTokenListPrototype$1=domTokenListPrototype,forEach$3=arrayForEach,createNonEnumerableProperty$a=createNonEnumerableProperty$d,handlePrototype$1=function(e){if(e&&e.forEach!==forEach$3)try{createNonEnumerableProperty$a(e,"forEach",forEach$3)}catch(error){e.forEach=forEach$3}};for(var COLLECTION_NAME$1 in DOMIterables$1)DOMIterables$1[COLLECTION_NAME$1]&&handlePrototype$1(global$G[COLLECTION_NAME$1]&&global$G[COLLECTION_NAME$1].prototype);handlePrototype$1(DOMTokenListPrototype$1);var $$1A=_export,toObject$g=toObject$m,nativeKeys=objectKeys$5,fails$Q=fails$13,FAILS_ON_PRIMITIVES$4=fails$Q((function(){nativeKeys(1)}));$$1A({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$4},{keys:function(e){return nativeKeys(toObject$g(e))}});var isCallable$h=isCallable$v,$String$2=String,$TypeError$a=TypeError,aPossiblePrototype$1=function(e){if("object"==_typeof$b(e)||isCallable$h(e))return e;throw $TypeError$a("Can't set "+$String$2(e)+" as a prototype")},uncurryThis$U=functionUncurryThis,anObject$o=anObject$r,aPossiblePrototype=aPossiblePrototype$1,objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=uncurryThis$U(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(error){}return function(r,n){return anObject$o(r),aPossiblePrototype(n),t?e(r,n):r.__proto__=n,r}}():void 0),defineProperty$g=objectDefineProperty.f,proxyAccessor$2=function(e,t,r){r in e||defineProperty$g(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},isCallable$g=isCallable$v,isObject$n=isObject$w,setPrototypeOf$8=objectSetPrototypeOf,inheritIfRequired$6=function(e,t,r){var n,i;return setPrototypeOf$8&&isCallable$g(n=t.constructor)&&n!==r&&isObject$n(i=n.prototype)&&i!==r.prototype&&setPrototypeOf$8(e,i),e},classof$9=classof$c,$String$1=String,toString$w=function(e){if("Symbol"===classof$9(e))throw TypeError("Cannot convert a Symbol value to a string");return $String$1(e)},toString$v=toString$w,normalizeStringArgument$9=function(e,t){return void 0===e?arguments.length<2?"":t:toString$v(e)},isObject$m=isObject$w,createNonEnumerableProperty$9=createNonEnumerableProperty$d,installErrorCause$3=function(e,t){isObject$m(t)&&"cause"in t&&createNonEnumerableProperty$9(e,"cause",t.cause)},uncurryThis$T=functionUncurryThis,$Error$1=Error,replace$c=uncurryThis$T("".replace),TEST$1=String($Error$1("zxcasd").stack),V8_OR_CHAKRA_STACK_ENTRY$1=/\n\s*at [^:]*:[^\n]*/,IS_V8_OR_CHAKRA_STACK$1=V8_OR_CHAKRA_STACK_ENTRY$1.test(TEST$1),errorStackClear$1=function(e,t){if(IS_V8_OR_CHAKRA_STACK$1&&"string"==typeof e&&!$Error$1.prepareStackTrace)for(;t--;)e=replace$c(e,V8_OR_CHAKRA_STACK_ENTRY$1,"");return e},fails$P=fails$13,createPropertyDescriptor$9=createPropertyDescriptor$d,errorStackInstallable$1=!fails$P((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",createPropertyDescriptor$9(1,7)),7!==e.stack)})),getBuiltIn$k=getBuiltIn$p,hasOwn$m=hasOwnProperty_1,createNonEnumerableProperty$8=createNonEnumerableProperty$d,isPrototypeOf$9=objectIsPrototypeOf,setPrototypeOf$7=objectSetPrototypeOf,copyConstructorProperties$2=copyConstructorProperties$4,proxyAccessor$1=proxyAccessor$2,inheritIfRequired$5=inheritIfRequired$6,normalizeStringArgument$8=normalizeStringArgument$9,installErrorCause$2=installErrorCause$3,clearErrorStack$5=errorStackClear$1,ERROR_STACK_INSTALLABLE$1=errorStackInstallable$1,DESCRIPTORS$s=descriptors,wrapErrorConstructorWithCause$3=function(e,t,r,n){var i="stackTraceLimit",a=n?2:1,o=e.split("."),s=o[o.length-1],l=getBuiltIn$k.apply(null,o);if(l){var u=l.prototype;if(hasOwn$m(u,"cause")&&delete u.cause,!r)return l;var c=getBuiltIn$k("Error"),d=t((function(e,t){var r=normalizeStringArgument$8(n?t:e,void 0),i=n?new l(e):new l;return void 0!==r&&createNonEnumerableProperty$8(i,"message",r),ERROR_STACK_INSTALLABLE$1&&createNonEnumerableProperty$8(i,"stack",clearErrorStack$5(i.stack,2)),this&&isPrototypeOf$9(u,this)&&inheritIfRequired$5(i,this,d),arguments.length>a&&installErrorCause$2(i,arguments[a]),i}));d.prototype=u,"Error"!==s?setPrototypeOf$7?setPrototypeOf$7(d,c):copyConstructorProperties$2(d,c,{name:!0}):DESCRIPTORS$s&&i in l&&(proxyAccessor$1(d,l,i),proxyAccessor$1(d,l,"prepareStackTrace")),copyConstructorProperties$2(d,l);try{u.name!==s&&createNonEnumerableProperty$8(u,"name",s),u.constructor=d}catch(error){}return d}},$$1z=_export,global$F=global$T,apply$9=functionApply,wrapErrorConstructorWithCause$2=wrapErrorConstructorWithCause$3,WEB_ASSEMBLY$1="WebAssembly",WebAssembly$2=global$F[WEB_ASSEMBLY$1],FORCED$j=7!==Error("e",{cause:7}).cause,exportGlobalErrorCauseWrapper$1=function(e,t){var r={};r[e]=wrapErrorConstructorWithCause$2(e,t,FORCED$j),$$1z({global:!0,constructor:!0,arity:1,forced:FORCED$j},r)},exportWebAssemblyErrorCauseWrapper$1=function(e,t){if(WebAssembly$2&&WebAssembly$2[e]){var r={};r[e]=wrapErrorConstructorWithCause$2(WEB_ASSEMBLY$1+"."+e,t,FORCED$j),$$1z({target:WEB_ASSEMBLY$1,stat:!0,constructor:!0,arity:1,forced:FORCED$j},r)}};exportGlobalErrorCauseWrapper$1("Error",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper$1("EvalError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper$1("RangeError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper$1("ReferenceError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper$1("SyntaxError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper$1("TypeError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportGlobalErrorCauseWrapper$1("URIError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper$1("CompileError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper$1("LinkError",(function(e){return function(t){return apply$9(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper$1("RuntimeError",(function(e){return function(t){return apply$9(e,this,arguments)}}));var objectDefineProperties={},DESCRIPTORS$r=descriptors,V8_PROTOTYPE_DEFINE_BUG=v8PrototypeDefineBug,definePropertyModule$3=objectDefineProperty,anObject$n=anObject$r,toIndexedObject$b=toIndexedObject$f,objectKeys$3=objectKeys$5;objectDefineProperties.f=DESCRIPTORS$r&&!V8_PROTOTYPE_DEFINE_BUG?Object.defineProperties:function(e,t){anObject$n(e);for(var r,n=toIndexedObject$b(t),i=objectKeys$3(t),a=i.length,o=0;a>o;)definePropertyModule$3.f(e,r=i[o++],n[r]);return e};var getBuiltIn$j=getBuiltIn$p,html$2=getBuiltIn$j("document","documentElement"),anObject$m=anObject$r,definePropertiesModule$1=objectDefineProperties,enumBugKeys=enumBugKeys$3,hiddenKeys$1=hiddenKeys$5,html$1=html$2,documentCreateElement=documentCreateElement$2,sharedKey$2=sharedKey$4,GT=">",LT="<",PROTOTYPE$2="prototype",SCRIPT="script",IE_PROTO$1=sharedKey$2("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return LT+SCRIPT+GT+e+LT+"/"+SCRIPT+GT},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=documentCreateElement("iframe"),r="java"+SCRIPT+":";return t.style.display="none",html$1.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},activeXDocument,_NullProtoObject=function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch(error){}_NullProtoObject="undefined"!=typeof document?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);for(var e=enumBugKeys.length;e--;)delete _NullProtoObject[PROTOTYPE$2][enumBugKeys[e]];return _NullProtoObject()};hiddenKeys$1[IE_PROTO$1]=!0;var objectCreate$1=Object.create||function(e,t){var r;return null!==e?(EmptyConstructor[PROTOTYPE$2]=anObject$m(e),r=new EmptyConstructor,EmptyConstructor[PROTOTYPE$2]=null,r[IE_PROTO$1]=e):r=_NullProtoObject(),void 0===t?r:definePropertiesModule$1.f(r,t)},DESCRIPTORS$q=descriptors,fails$O=fails$13,anObject$l=anObject$r,create$a=objectCreate$1,normalizeStringArgument$7=normalizeStringArgument$9,nativeErrorToString$1=Error.prototype.toString,INCORRECT_TO_STRING$3=fails$O((function(){if(DESCRIPTORS$q){var e=create$a(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==nativeErrorToString$1.call(e))return!0}return"2: 1"!==nativeErrorToString$1.call({message:1,name:2})||"Error"!==nativeErrorToString$1.call({})})),errorToString$5=INCORRECT_TO_STRING$3?function(){var e=anObject$l(this),t=normalizeStringArgument$7(e.name,"Error"),r=normalizeStringArgument$7(e.message);return t?r?t+": "+r:t:r}:nativeErrorToString$1,defineBuiltIn$i=defineBuiltIn$m,errorToString$4=errorToString$5,ErrorPrototype$3=Error.prototype;ErrorPrototype$3.toString!==errorToString$4&&defineBuiltIn$i(ErrorPrototype$3,"toString",errorToString$4);var $$1y=_export,uncurryThis$S=functionUncurryThis,requireObjectCoercible$b=requireObjectCoercible$e,toIntegerOrInfinity$f=toIntegerOrInfinity$i,toString$u=toString$w,stringSlice$d=uncurryThis$S("".slice),max$6=Math.max,min$7=Math.min,FORCED$i=!"".substr||"b"!=="ab".substr(-1);$$1y({target:"String",proto:!0,forced:FORCED$i},{substr:function(e,t){var r,n,i=toString$u(requireObjectCoercible$b(this)),a=i.length,o=toIntegerOrInfinity$f(e);return o===1/0&&(o=0),o<0&&(o=max$6(a+o,0)),(r=void 0===t?a:toIntegerOrInfinity$f(t))<=0||r===1/0||o>=(n=min$7(o+r,a))?"":stringSlice$d(i,o,n)}});var apply$8=functionApply,toIndexedObject$a=toIndexedObject$f,toIntegerOrInfinity$e=toIntegerOrInfinity$i,lengthOfArrayLike$m=lengthOfArrayLike$r,arrayMethodIsStrict$8=arrayMethodIsStrict$b,min$6=Math.min,$lastIndexOf$1=[].lastIndexOf,NEGATIVE_ZERO$1=!!$lastIndexOf$1&&1/[1].lastIndexOf(1,-0)<0,STRICT_METHOD$8=arrayMethodIsStrict$8("lastIndexOf"),FORCED$h=NEGATIVE_ZERO$1||!STRICT_METHOD$8,arrayLastIndexOf=FORCED$h?function(e){if(NEGATIVE_ZERO$1)return apply$8($lastIndexOf$1,this,arguments)||0;var t=toIndexedObject$a(this),r=lengthOfArrayLike$m(t),n=r-1;for(arguments.length>1&&(n=min$6(n,toIntegerOrInfinity$e(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:$lastIndexOf$1,$$1x=_export,lastIndexOf$1=arrayLastIndexOf;$$1x({target:"Array",proto:!0,forced:lastIndexOf$1!==[].lastIndexOf},{lastIndexOf:lastIndexOf$1});var wellKnownSymbol$m=wellKnownSymbol$t,create$9=objectCreate$1,defineProperty$f=objectDefineProperty.f,UNSCOPABLES=wellKnownSymbol$m("unscopables"),ArrayPrototype$1=Array.prototype;null==ArrayPrototype$1[UNSCOPABLES]&&defineProperty$f(ArrayPrototype$1,UNSCOPABLES,{configurable:!0,value:create$9(null)});var addToUnscopables$5=function(e){ArrayPrototype$1[UNSCOPABLES][e]=!0},iterators={},fails$N=fails$13,correctPrototypeGetter=!fails$N((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),hasOwn$l=hasOwnProperty_1,isCallable$f=isCallable$v,toObject$f=toObject$m,sharedKey$1=sharedKey$4,CORRECT_PROTOTYPE_GETTER$1=correctPrototypeGetter,IE_PROTO=sharedKey$1("IE_PROTO"),$Object=Object,ObjectPrototype$4=$Object.prototype,objectGetPrototypeOf=CORRECT_PROTOTYPE_GETTER$1?$Object.getPrototypeOf:function(e){var t=toObject$f(e);if(hasOwn$l(t,IE_PROTO))return t[IE_PROTO];var r=t.constructor;return isCallable$f(r)&&t instanceof r?r.prototype:t instanceof $Object?ObjectPrototype$4:null},fails$M=fails$13,isCallable$e=isCallable$v,isObject$l=isObject$w,getPrototypeOf$3=objectGetPrototypeOf,defineBuiltIn$h=defineBuiltIn$m,wellKnownSymbol$l=wellKnownSymbol$t,ITERATOR$c=wellKnownSymbol$l("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf$3(getPrototypeOf$3(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0);var NEW_ITERATOR_PROTOTYPE=!isObject$l(IteratorPrototype$2)||fails$M((function(){var e={};return IteratorPrototype$2[ITERATOR$c].call(e)!==e}));NEW_ITERATOR_PROTOTYPE&&(IteratorPrototype$2={}),isCallable$e(IteratorPrototype$2[ITERATOR$c])||defineBuiltIn$h(IteratorPrototype$2,ITERATOR$c,(function(){return this}));var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},defineProperty$e=objectDefineProperty.f,hasOwn$k=hasOwnProperty_1,wellKnownSymbol$k=wellKnownSymbol$t,TO_STRING_TAG$2=wellKnownSymbol$k("toStringTag"),setToStringTag$c=function(e,t,r){e&&!r&&(e=e.prototype),e&&!hasOwn$k(e,TO_STRING_TAG$2)&&defineProperty$e(e,TO_STRING_TAG$2,{configurable:!0,value:t})},IteratorPrototype$1=iteratorsCore.IteratorPrototype,create$8=objectCreate$1,createPropertyDescriptor$8=createPropertyDescriptor$d,setToStringTag$b=setToStringTag$c,Iterators$4=iterators,returnThis$1=function(){return this},iteratorCreateConstructor=function(e,t,r,n){var i=t+" Iterator";return e.prototype=create$8(IteratorPrototype$1,{next:createPropertyDescriptor$8(+!n,r)}),setToStringTag$b(e,i,!1),Iterators$4[i]=returnThis$1,e},$$1w=_export,call$n=functionCall,FunctionName$1=functionName,isCallable$d=isCallable$v,createIteratorConstructor$1=iteratorCreateConstructor,getPrototypeOf$2=objectGetPrototypeOf,setPrototypeOf$6=objectSetPrototypeOf,setToStringTag$a=setToStringTag$c,createNonEnumerableProperty$7=createNonEnumerableProperty$d,defineBuiltIn$g=defineBuiltIn$m,wellKnownSymbol$j=wellKnownSymbol$t,Iterators$3=iterators,IteratorsCore=iteratorsCore,PROPER_FUNCTION_NAME$3=FunctionName$1.PROPER,CONFIGURABLE_FUNCTION_NAME$1=FunctionName$1.CONFIGURABLE,IteratorPrototype=IteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS,ITERATOR$b=wellKnownSymbol$j("iterator"),KEYS="keys",VALUES="values",ENTRIES$1="entries",returnThis=function(){return this},iteratorDefine=function(e,t,r,n,i,a,o){createIteratorConstructor$1(r,t,n);var s,l,u,c=function(e){if(e===i&&y)return y;if(!BUGGY_SAFARI_ITERATORS&&e in f)return f[e];switch(e){case KEYS:case VALUES:case ENTRIES$1:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",h=!1,f=e.prototype,p=f[ITERATOR$b]||f["@@iterator"]||i&&f[i],y=!BUGGY_SAFARI_ITERATORS&&p||c(i),m="Array"==t&&f.entries||p;if(m&&(s=getPrototypeOf$2(m.call(new e)))!==Object.prototype&&s.next&&(getPrototypeOf$2(s)!==IteratorPrototype&&(setPrototypeOf$6?setPrototypeOf$6(s,IteratorPrototype):isCallable$d(s[ITERATOR$b])||defineBuiltIn$g(s,ITERATOR$b,returnThis)),setToStringTag$a(s,d,!0)),PROPER_FUNCTION_NAME$3&&i==VALUES&&p&&p.name!==VALUES&&(CONFIGURABLE_FUNCTION_NAME$1?createNonEnumerableProperty$7(f,"name",VALUES):(h=!0,y=function(){return call$n(p,this)})),i)if(l={values:c(VALUES),keys:a?y:c(KEYS),entries:c(ENTRIES$1)},o)for(u in l)(BUGGY_SAFARI_ITERATORS||h||!(u in f))&&defineBuiltIn$g(f,u,l[u]);else $$1w({target:t,proto:!0,forced:BUGGY_SAFARI_ITERATORS||h},l);return f[ITERATOR$b]!==y&&defineBuiltIn$g(f,ITERATOR$b,y,{name:i}),Iterators$3[t]=y,l},createIterResultObject$2=function(e,t){return{value:e,done:t}},toIndexedObject$9=toIndexedObject$f,addToUnscopables$4=addToUnscopables$5,Iterators$2=iterators,InternalStateModule$a=internalState,defineProperty$d=objectDefineProperty.f,defineIterator$1=iteratorDefine,createIterResultObject$1=createIterResultObject$2,DESCRIPTORS$p=descriptors,ARRAY_ITERATOR="Array Iterator",setInternalState$9=InternalStateModule$a.set,getInternalState$8=InternalStateModule$a.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator$1(Array,"Array",(function(e,t){setInternalState$9(this,{type:ARRAY_ITERATOR,target:toIndexedObject$9(e),index:0,kind:t})}),(function(){var e=getInternalState$8(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,createIterResultObject$1(void 0,!0)):createIterResultObject$1("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values"),values=Iterators$2.Arguments=Iterators$2.Array;if(addToUnscopables$4("keys"),addToUnscopables$4("values"),addToUnscopables$4("entries"),DESCRIPTORS$p&&"values"!==values.name)try{defineProperty$d(values,"name",{value:"values"})}catch(error){}var arrayBufferBasicDetection="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,defineBuiltIn$f=defineBuiltIn$m,defineBuiltIns$2=function(e,t,r){for(var n in t)defineBuiltIn$f(e,n,t[n],r);return e},isPrototypeOf$8=objectIsPrototypeOf,$TypeError$9=TypeError,anInstance$9=function(e,t){if(isPrototypeOf$8(t,e))return e;throw $TypeError$9("Incorrect invocation")},toIntegerOrInfinity$d=toIntegerOrInfinity$i,toLength$a=toLength$c,$RangeError$7=RangeError,toIndex$2=function(e){if(void 0===e)return 0;var t=toIntegerOrInfinity$d(e),r=toLength$a(t);if(t!==r)throw $RangeError$7("Wrong length or index");return r},$Array$4=Array,abs$2=Math.abs,pow$4=Math.pow,floor$9=Math.floor,log$5=Math.log,LN2=Math.LN2,pack=function(e,t,r){var n,i,a,o=$Array$4(r),s=8*r-t-1,l=(1<<s)-1,u=l>>1,c=23===t?pow$4(2,-24)-pow$4(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=abs$2(e))!=e||e===1/0?(i=e!=e?1:0,n=l):(n=floor$9(log$5(e)/LN2),e*(a=pow$4(2,-n))<1&&(n--,a*=2),(e+=n+u>=1?c/a:c*pow$4(2,1-u))*a>=2&&(n++,a/=2),n+u>=l?(i=0,n=l):n+u>=1?(i=(e*a-1)*pow$4(2,t),n+=u):(i=e*pow$4(2,u-1)*pow$4(2,t),n=0));t>=8;)o[h++]=255&i,i/=256,t-=8;for(n=n<<t|i,s+=t;s>0;)o[h++]=255&n,n/=256,s-=8;return o[--h]|=128*d,o},unpack=function(e,t){var r,n=e.length,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,l=n-1,u=e[l--],c=127&u;for(u>>=7;s>0;)c=256*c+e[l--],s-=8;for(r=c&(1<<-s)-1,c>>=-s,s+=t;s>0;)r=256*r+e[l--],s-=8;if(0===c)c=1-o;else{if(c===a)return r?NaN:u?-1/0:1/0;r+=pow$4(2,t),c-=o}return(u?-1:1)*r*pow$4(2,c-t)},ieee754={pack:pack,unpack:unpack},toObject$e=toObject$m,toAbsoluteIndex$7=toAbsoluteIndex$9,lengthOfArrayLike$l=lengthOfArrayLike$r,arrayFill$1=function(e){for(var t=toObject$e(this),r=lengthOfArrayLike$l(t),n=arguments.length,i=toAbsoluteIndex$7(n>1?arguments[1]:void 0,r),a=n>2?arguments[2]:void 0,o=void 0===a?r:toAbsoluteIndex$7(a,r);o>i;)t[i++]=e;return t},toAbsoluteIndex$6=toAbsoluteIndex$9,lengthOfArrayLike$k=lengthOfArrayLike$r,createProperty$4=createProperty$6,$Array$3=Array,max$5=Math.max,arraySliceSimple=function(e,t,r){for(var n=lengthOfArrayLike$k(e),i=toAbsoluteIndex$6(t,n),a=toAbsoluteIndex$6(void 0===r?n:r,n),o=$Array$3(max$5(a-i,0)),s=0;i<a;i++,s++)createProperty$4(o,s,e[i]);return o.length=s,o},global$E=global$T,uncurryThis$R=functionUncurryThis,DESCRIPTORS$o=descriptors,NATIVE_ARRAY_BUFFER$2=arrayBufferBasicDetection,FunctionName=functionName,createNonEnumerableProperty$6=createNonEnumerableProperty$d,defineBuiltIns$1=defineBuiltIns$2,fails$L=fails$13,anInstance$8=anInstance$9,toIntegerOrInfinity$c=toIntegerOrInfinity$i,toLength$9=toLength$c,toIndex$1=toIndex$2,IEEE754=ieee754,getPrototypeOf$1=objectGetPrototypeOf,setPrototypeOf$5=objectSetPrototypeOf,getOwnPropertyNames$3=objectGetOwnPropertyNames.f,defineProperty$c=objectDefineProperty.f,arrayFill=arrayFill$1,arraySlice$9=arraySliceSimple,setToStringTag$9=setToStringTag$c,InternalStateModule$9=internalState,PROPER_FUNCTION_NAME$2=FunctionName.PROPER,CONFIGURABLE_FUNCTION_NAME=FunctionName.CONFIGURABLE,getInternalState$7=InternalStateModule$9.get,setInternalState$8=InternalStateModule$9.set,ARRAY_BUFFER$1="ArrayBuffer",DATA_VIEW="DataView",PROTOTYPE$1="prototype",WRONG_LENGTH$1="Wrong length",WRONG_INDEX="Wrong index",NativeArrayBuffer$1=global$E[ARRAY_BUFFER$1],$ArrayBuffer=NativeArrayBuffer$1,ArrayBufferPrototype$1=$ArrayBuffer&&$ArrayBuffer[PROTOTYPE$1],$DataView=global$E[DATA_VIEW],DataViewPrototype$2=$DataView&&$DataView[PROTOTYPE$1],ObjectPrototype$3=Object.prototype,Array$1=global$E.Array,RangeError$3=global$E.RangeError,fill$1=uncurryThis$R(arrayFill),reverse=uncurryThis$R([].reverse),packIEEE754=IEEE754.pack,unpackIEEE754=IEEE754.unpack,packInt8=function(e){return[255&e]},packInt16=function(e){return[255&e,e>>8&255]},packInt32=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},unpackInt32=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},packFloat32=function(e){return packIEEE754(e,23,4)},packFloat64=function(e){return packIEEE754(e,52,8)},addGetter$1=function(e,t){defineProperty$c(e[PROTOTYPE$1],t,{get:function(){return getInternalState$7(this)[t]}})},get=function(e,t,r,n){var i=toIndex$1(r),a=getInternalState$7(e);if(i+t>a.byteLength)throw RangeError$3(WRONG_INDEX);var o=getInternalState$7(a.buffer).bytes,s=i+a.byteOffset,l=arraySlice$9(o,s,s+t);return n?l:reverse(l)},set$1=function(e,t,r,n,i,a){var o=toIndex$1(r),s=getInternalState$7(e);if(o+t>s.byteLength)throw RangeError$3(WRONG_INDEX);for(var l=getInternalState$7(s.buffer).bytes,u=o+s.byteOffset,c=n(+i),d=0;d<t;d++)l[u+d]=c[a?d:t-d-1]};if(NATIVE_ARRAY_BUFFER$2){var INCORRECT_ARRAY_BUFFER_NAME=PROPER_FUNCTION_NAME$2&&NativeArrayBuffer$1.name!==ARRAY_BUFFER$1;if(fails$L((function(){NativeArrayBuffer$1(1)}))&&fails$L((function(){new NativeArrayBuffer$1(-1)}))&&!fails$L((function(){return new NativeArrayBuffer$1,new NativeArrayBuffer$1(1.5),new NativeArrayBuffer$1(NaN),1!=NativeArrayBuffer$1.length||INCORRECT_ARRAY_BUFFER_NAME&&!CONFIGURABLE_FUNCTION_NAME})))INCORRECT_ARRAY_BUFFER_NAME&&CONFIGURABLE_FUNCTION_NAME&&createNonEnumerableProperty$6(NativeArrayBuffer$1,"name",ARRAY_BUFFER$1);else{$ArrayBuffer=function(e){return anInstance$8(this,ArrayBufferPrototype$1),new NativeArrayBuffer$1(toIndex$1(e))},$ArrayBuffer[PROTOTYPE$1]=ArrayBufferPrototype$1;for(var keys$5=getOwnPropertyNames$3(NativeArrayBuffer$1),j$1=0,key$5;keys$5.length>j$1;)(key$5=keys$5[j$1++])in $ArrayBuffer||createNonEnumerableProperty$6($ArrayBuffer,key$5,NativeArrayBuffer$1[key$5]);ArrayBufferPrototype$1.constructor=$ArrayBuffer}setPrototypeOf$5&&getPrototypeOf$1(DataViewPrototype$2)!==ObjectPrototype$3&&setPrototypeOf$5(DataViewPrototype$2,ObjectPrototype$3);var testView=new $DataView(new $ArrayBuffer(2)),$setInt8=uncurryThis$R(DataViewPrototype$2.setInt8);testView.setInt8(0,2147483648),testView.setInt8(1,2147483649),!testView.getInt8(0)&&testView.getInt8(1)||defineBuiltIns$1(DataViewPrototype$2,{setInt8:function(e,t){$setInt8(this,e,t<<24>>24)},setUint8:function(e,t){$setInt8(this,e,t<<24>>24)}},{unsafe:!0})}else $ArrayBuffer=function(e){anInstance$8(this,ArrayBufferPrototype$1);var t=toIndex$1(e);setInternalState$8(this,{bytes:fill$1(Array$1(t),0),byteLength:t}),DESCRIPTORS$o||(this.byteLength=t)},ArrayBufferPrototype$1=$ArrayBuffer[PROTOTYPE$1],$DataView=function(e,t,r){anInstance$8(this,DataViewPrototype$2),anInstance$8(e,ArrayBufferPrototype$1);var n=getInternalState$7(e).byteLength,i=toIntegerOrInfinity$c(t);if(i<0||i>n)throw RangeError$3("Wrong offset");if(i+(r=void 0===r?n-i:toLength$9(r))>n)throw RangeError$3(WRONG_LENGTH$1);setInternalState$8(this,{buffer:e,byteLength:r,byteOffset:i}),DESCRIPTORS$o||(this.buffer=e,this.byteLength=r,this.byteOffset=i)},DataViewPrototype$2=$DataView[PROTOTYPE$1],DESCRIPTORS$o&&(addGetter$1($ArrayBuffer,"byteLength"),addGetter$1($DataView,"buffer"),addGetter$1($DataView,"byteLength"),addGetter$1($DataView,"byteOffset")),defineBuiltIns$1(DataViewPrototype$2,{getInt8:function(e){return get(this,1,e)[0]<<24>>24},getUint8:function(e){return get(this,1,e)[0]},getInt16:function(e){var t=get(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=get(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return unpackInt32(get(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return unpackInt32(get(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return unpackIEEE754(get(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return unpackIEEE754(get(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){set$1(this,1,e,packInt8,t)},setUint8:function(e,t){set$1(this,1,e,packInt8,t)},setInt16:function(e,t){set$1(this,2,e,packInt16,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){set$1(this,2,e,packInt16,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){set$1(this,4,e,packInt32,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){set$1(this,4,e,packInt32,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){set$1(this,4,e,packFloat32,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){set$1(this,8,e,packFloat64,t,arguments.length>2?arguments[2]:void 0)}});setToStringTag$9($ArrayBuffer,ARRAY_BUFFER$1),setToStringTag$9($DataView,DATA_VIEW);var arrayBuffer={ArrayBuffer:$ArrayBuffer,DataView:$DataView},isConstructor$2=isConstructor$4,tryToString$5=tryToString$7,$TypeError$8=TypeError,aConstructor$3=function(e){if(isConstructor$2(e))return e;throw $TypeError$8(tryToString$5(e)+" is not a constructor")},anObject$k=anObject$r,aConstructor$2=aConstructor$3,isNullOrUndefined$4=isNullOrUndefined$7,wellKnownSymbol$i=wellKnownSymbol$t,SPECIES$4=wellKnownSymbol$i("species"),speciesConstructor$5=function(e,t){var r,n=anObject$k(e).constructor;return void 0===n||isNullOrUndefined$4(r=anObject$k(n)[SPECIES$4])?t:aConstructor$2(r)},$$1v=_export,uncurryThis$Q=functionUncurryThis,fails$K=fails$13,ArrayBufferModule$3=arrayBuffer,anObject$j=anObject$r,toAbsoluteIndex$5=toAbsoluteIndex$9,toLength$8=toLength$c,speciesConstructor$4=speciesConstructor$5,ArrayBuffer$5=ArrayBufferModule$3.ArrayBuffer,DataView$3=ArrayBufferModule$3.DataView,DataViewPrototype$1=DataView$3.prototype,nativeArrayBufferSlice$1=uncurryThis$Q(ArrayBuffer$5.prototype.slice),getUint8$1=uncurryThis$Q(DataViewPrototype$1.getUint8),setUint8$1=uncurryThis$Q(DataViewPrototype$1.setUint8),INCORRECT_SLICE$1=fails$K((function(){return!new ArrayBuffer$5(2).slice(1,void 0).byteLength}));$$1v({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:INCORRECT_SLICE$1},{slice:function(e,t){if(nativeArrayBufferSlice$1&&void 0===t)return nativeArrayBufferSlice$1(anObject$j(this),e);for(var r=anObject$j(this).byteLength,n=toAbsoluteIndex$5(e,r),i=toAbsoluteIndex$5(void 0===t?r:t,r),a=new(speciesConstructor$4(this,ArrayBuffer$5))(toLength$8(i-n)),o=new DataView$3(this),s=new DataView$3(a),l=0;n<i;)setUint8$1(s,l++,getUint8$1(o,n++));return a}});var typedArrayConstructor={exports:{}},wellKnownSymbol$h=wellKnownSymbol$t,ITERATOR$a=wellKnownSymbol$h("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR$a]=function(){return this},Array.from(iteratorWithReturn,(function(){throw 2}))}catch(error){}var checkCorrectnessOfIteration$2=function(e,t){if(!t&&!SAFE_CLOSING)return!1;var r=!1;try{var n={};n[ITERATOR$a]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(error){}return r},NATIVE_ARRAY_BUFFER$1=arrayBufferBasicDetection,DESCRIPTORS$n=descriptors,global$D=global$T,isCallable$c=isCallable$v,isObject$k=isObject$w,hasOwn$j=hasOwnProperty_1,classof$8=classof$c,tryToString$4=tryToString$7,createNonEnumerableProperty$5=createNonEnumerableProperty$d,defineBuiltIn$e=defineBuiltIn$m,defineProperty$b=objectDefineProperty.f,isPrototypeOf$7=objectIsPrototypeOf,getPrototypeOf=objectGetPrototypeOf,setPrototypeOf$4=objectSetPrototypeOf,wellKnownSymbol$g=wellKnownSymbol$t,uid$1=uid$4,InternalStateModule$8=internalState,enforceInternalState$1=InternalStateModule$8.enforce,getInternalState$6=InternalStateModule$8.get,Int8Array$4=global$D.Int8Array,Int8ArrayPrototype$1=Int8Array$4&&Int8Array$4.prototype,Uint8ClampedArray$1=global$D.Uint8ClampedArray,Uint8ClampedArrayPrototype=Uint8ClampedArray$1&&Uint8ClampedArray$1.prototype,TypedArray$1=Int8Array$4&&getPrototypeOf(Int8Array$4),TypedArrayPrototype$2=Int8ArrayPrototype$1&&getPrototypeOf(Int8ArrayPrototype$1),ObjectPrototype$2=Object.prototype,TypeError$6=global$D.TypeError,TO_STRING_TAG$1=wellKnownSymbol$g("toStringTag"),TYPED_ARRAY_TAG$1=uid$1("TYPED_ARRAY_TAG"),TYPED_ARRAY_CONSTRUCTOR="TypedArrayConstructor",NATIVE_ARRAY_BUFFER_VIEWS$3=NATIVE_ARRAY_BUFFER$1&&!!setPrototypeOf$4&&"Opera"!==classof$8(global$D.opera),TYPED_ARRAY_TAG_REQUIRED=!1,NAME$1,Constructor,Prototype,TypedArrayConstructorsList={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},BigIntArrayConstructorsList={BigInt64Array:8,BigUint64Array:8},isView=function(e){if(!isObject$k(e))return!1;var t=classof$8(e);return"DataView"===t||hasOwn$j(TypedArrayConstructorsList,t)||hasOwn$j(BigIntArrayConstructorsList,t)},getTypedArrayConstructor$7=function e(t){var r=getPrototypeOf(t);if(isObject$k(r)){var n=getInternalState$6(r);return n&&hasOwn$j(n,TYPED_ARRAY_CONSTRUCTOR)?n[TYPED_ARRAY_CONSTRUCTOR]:e(r)}},isTypedArray$1=function(e){if(!isObject$k(e))return!1;var t=classof$8(e);return hasOwn$j(TypedArrayConstructorsList,t)||hasOwn$j(BigIntArrayConstructorsList,t)},aTypedArray$v=function(e){if(isTypedArray$1(e))return e;throw TypeError$6("Target is not a typed array")},aTypedArrayConstructor$5=function(e){if(isCallable$c(e)&&(!setPrototypeOf$4||isPrototypeOf$7(TypedArray$1,e)))return e;throw TypeError$6(tryToString$4(e)+" is not a typed array constructor")},exportTypedArrayMethod$w=function(e,t,r,n){if(DESCRIPTORS$n){if(r)for(var i in TypedArrayConstructorsList){var a=global$D[i];if(a&&hasOwn$j(a.prototype,e))try{delete a.prototype[e]}catch(error){try{a.prototype[e]=t}catch(o){}}}TypedArrayPrototype$2[e]&&!r||defineBuiltIn$e(TypedArrayPrototype$2,e,r?t:NATIVE_ARRAY_BUFFER_VIEWS$3&&Int8ArrayPrototype$1[e]||t,n)}},exportTypedArrayStaticMethod$2=function(e,t,r){var n,i;if(DESCRIPTORS$n){if(setPrototypeOf$4){if(r)for(n in TypedArrayConstructorsList)if((i=global$D[n])&&hasOwn$j(i,e))try{delete i[e]}catch(error){}if(TypedArray$1[e]&&!r)return;try{return defineBuiltIn$e(TypedArray$1,e,r?t:NATIVE_ARRAY_BUFFER_VIEWS$3&&TypedArray$1[e]||t)}catch(error){}}for(n in TypedArrayConstructorsList)!(i=global$D[n])||i[e]&&!r||defineBuiltIn$e(i,e,t)}};for(NAME$1 in TypedArrayConstructorsList)Constructor=global$D[NAME$1],Prototype=Constructor&&Constructor.prototype,Prototype?enforceInternalState$1(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor:NATIVE_ARRAY_BUFFER_VIEWS$3=!1;for(NAME$1 in BigIntArrayConstructorsList)Constructor=global$D[NAME$1],Prototype=Constructor&&Constructor.prototype,Prototype&&(enforceInternalState$1(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor);if((!NATIVE_ARRAY_BUFFER_VIEWS$3||!isCallable$c(TypedArray$1)||TypedArray$1===Function.prototype)&&(TypedArray$1=function(){throw TypeError$6("Incorrect invocation")},NATIVE_ARRAY_BUFFER_VIEWS$3))for(NAME$1 in TypedArrayConstructorsList)global$D[NAME$1]&&setPrototypeOf$4(global$D[NAME$1],TypedArray$1);if((!NATIVE_ARRAY_BUFFER_VIEWS$3||!TypedArrayPrototype$2||TypedArrayPrototype$2===ObjectPrototype$2)&&(TypedArrayPrototype$2=TypedArray$1.prototype,NATIVE_ARRAY_BUFFER_VIEWS$3))for(NAME$1 in TypedArrayConstructorsList)global$D[NAME$1]&&setPrototypeOf$4(global$D[NAME$1].prototype,TypedArrayPrototype$2);if(NATIVE_ARRAY_BUFFER_VIEWS$3&&getPrototypeOf(Uint8ClampedArrayPrototype)!==TypedArrayPrototype$2&&setPrototypeOf$4(Uint8ClampedArrayPrototype,TypedArrayPrototype$2),DESCRIPTORS$n&&!hasOwn$j(TypedArrayPrototype$2,TO_STRING_TAG$1))for(NAME$1 in TYPED_ARRAY_TAG_REQUIRED=!0,defineProperty$b(TypedArrayPrototype$2,TO_STRING_TAG$1,{get:function(){return isObject$k(this)?this[TYPED_ARRAY_TAG$1]:void 0}}),TypedArrayConstructorsList)global$D[NAME$1]&&createNonEnumerableProperty$5(global$D[NAME$1],TYPED_ARRAY_TAG$1,NAME$1);var arrayBufferViewCore={NATIVE_ARRAY_BUFFER_VIEWS:NATIVE_ARRAY_BUFFER_VIEWS$3,TYPED_ARRAY_TAG:TYPED_ARRAY_TAG_REQUIRED&&TYPED_ARRAY_TAG$1,aTypedArray:aTypedArray$v,aTypedArrayConstructor:aTypedArrayConstructor$5,exportTypedArrayMethod:exportTypedArrayMethod$w,exportTypedArrayStaticMethod:exportTypedArrayStaticMethod$2,getTypedArrayConstructor:getTypedArrayConstructor$7,isView:isView,isTypedArray:isTypedArray$1,TypedArray:TypedArray$1,TypedArrayPrototype:TypedArrayPrototype$2},global$C=global$T,fails$J=fails$13,checkCorrectnessOfIteration$1=checkCorrectnessOfIteration$2,NATIVE_ARRAY_BUFFER_VIEWS$2=arrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS,ArrayBuffer$4=global$C.ArrayBuffer,Int8Array$3=global$C.Int8Array,typedArrayConstructorsRequireWrappers=!NATIVE_ARRAY_BUFFER_VIEWS$2||!fails$J((function(){Int8Array$3(1)}))||!fails$J((function(){new Int8Array$3(-1)}))||!checkCorrectnessOfIteration$1((function(e){new Int8Array$3,new Int8Array$3(null),new Int8Array$3(1.5),new Int8Array$3(e)}),!0)||fails$J((function(){return 1!==new Int8Array$3(new ArrayBuffer$4(2),1,void 0).length})),isObject$j=isObject$w,floor$8=Math.floor,isIntegralNumber$1=Number.isInteger||function(e){return!isObject$j(e)&&isFinite(e)&&floor$8(e)===e},toIntegerOrInfinity$b=toIntegerOrInfinity$i,$RangeError$6=RangeError,toPositiveInteger$1=function(e){var t=toIntegerOrInfinity$b(e);if(t<0)throw $RangeError$6("The argument can't be less than 0");return t},toPositiveInteger=toPositiveInteger$1,$RangeError$5=RangeError,toOffset$2=function(e,t){var r=toPositiveInteger(e);if(r%t)throw $RangeError$5("Wrong offset");return r},classof$7=classof$c,getMethod$4=getMethod$6,isNullOrUndefined$3=isNullOrUndefined$7,Iterators$1=iterators,wellKnownSymbol$f=wellKnownSymbol$t,ITERATOR$9=wellKnownSymbol$f("iterator"),getIteratorMethod$5=function(e){if(!isNullOrUndefined$3(e))return getMethod$4(e,ITERATOR$9)||getMethod$4(e,"@@iterator")||Iterators$1[classof$7(e)]},call$m=functionCall,aCallable$a=aCallable$e,anObject$i=anObject$r,tryToString$3=tryToString$7,getIteratorMethod$4=getIteratorMethod$5,$TypeError$7=TypeError,getIterator$4=function(e,t){var r=arguments.length<2?getIteratorMethod$4(e):t;if(aCallable$a(r))return anObject$i(call$m(r,e));throw $TypeError$7(tryToString$3(e)+" is not iterable")},wellKnownSymbol$e=wellKnownSymbol$t,Iterators=iterators,ITERATOR$8=wellKnownSymbol$e("iterator"),ArrayPrototype=Array.prototype,isArrayIteratorMethod$3=function(e){return void 0!==e&&(Iterators.Array===e||ArrayPrototype[ITERATOR$8]===e)},classof$6=classof$c,uncurryThis$P=functionUncurryThis,slice$1=uncurryThis$P("".slice),isBigIntArray$3=function(e){return"Big"===slice$1(classof$6(e),0,3)},toPrimitive$1=toPrimitive$3,$TypeError$6=TypeError,toBigInt$4=function(e){var t=toPrimitive$1(e,"number");if("number"==typeof t)throw $TypeError$6("Can't convert number to bigint");return BigInt(t)},bind$b=functionBindContext,call$l=functionCall,aConstructor$1=aConstructor$3,toObject$d=toObject$m,lengthOfArrayLike$j=lengthOfArrayLike$r,getIterator$3=getIterator$4,getIteratorMethod$3=getIteratorMethod$5,isArrayIteratorMethod$2=isArrayIteratorMethod$3,isBigIntArray$2=isBigIntArray$3,aTypedArrayConstructor$4=arrayBufferViewCore.aTypedArrayConstructor,toBigInt$3=toBigInt$4,typedArrayFrom$1=function(e){var t,r,n,i,a,o,s,l,u=aConstructor$1(this),c=toObject$d(e),d=arguments.length,h=d>1?arguments[1]:void 0,f=void 0!==h,p=getIteratorMethod$3(c);if(p&&!isArrayIteratorMethod$2(p))for(l=(s=getIterator$3(c,p)).next,c=[];!(o=call$l(l,s)).done;)c.push(o.value);for(f&&d>2&&(h=bind$b(h,arguments[2])),r=lengthOfArrayLike$j(c),n=new(aTypedArrayConstructor$4(u))(r),i=isBigIntArray$2(n),t=0;r>t;t++)a=f?h(c[t],t):c[t],n[t]=i?toBigInt$3(a):+a;return n},getBuiltIn$i=getBuiltIn$p,definePropertyModule$2=objectDefineProperty,wellKnownSymbol$d=wellKnownSymbol$t,DESCRIPTORS$m=descriptors,SPECIES$3=wellKnownSymbol$d("species"),setSpecies$3=function(e){var t=getBuiltIn$i(e),r=definePropertyModule$2.f;DESCRIPTORS$m&&t&&!t[SPECIES$3]&&r(t,SPECIES$3,{configurable:!0,get:function(){return this}})},$$1u=_export,global$B=global$T,call$k=functionCall,DESCRIPTORS$l=descriptors,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$2=typedArrayConstructorsRequireWrappers,ArrayBufferViewCore$z=arrayBufferViewCore,ArrayBufferModule$2=arrayBuffer,anInstance$7=anInstance$9,createPropertyDescriptor$7=createPropertyDescriptor$d,createNonEnumerableProperty$4=createNonEnumerableProperty$d,isIntegralNumber=isIntegralNumber$1,toLength$7=toLength$c,toIndex=toIndex$2,toOffset$1=toOffset$2,toPropertyKey$2=toPropertyKey$6,hasOwn$i=hasOwnProperty_1,classof$5=classof$c,isObject$i=isObject$w,isSymbol$3=isSymbol$6,create$7=objectCreate$1,isPrototypeOf$6=objectIsPrototypeOf,setPrototypeOf$3=objectSetPrototypeOf,getOwnPropertyNames$2=objectGetOwnPropertyNames.f,typedArrayFrom=typedArrayFrom$1,forEach$2=arrayIteration.forEach,setSpecies$2=setSpecies$3,definePropertyModule$1=objectDefineProperty,getOwnPropertyDescriptorModule$2=objectGetOwnPropertyDescriptor,InternalStateModule$7=internalState,inheritIfRequired$4=inheritIfRequired$6,getInternalState$5=InternalStateModule$7.get,setInternalState$7=InternalStateModule$7.set,enforceInternalState=InternalStateModule$7.enforce,nativeDefineProperty$1=definePropertyModule$1.f,nativeGetOwnPropertyDescriptor$3=getOwnPropertyDescriptorModule$2.f,round=Math.round,RangeError$2=global$B.RangeError,ArrayBuffer$3=ArrayBufferModule$2.ArrayBuffer,ArrayBufferPrototype=ArrayBuffer$3.prototype,DataView$2=ArrayBufferModule$2.DataView,NATIVE_ARRAY_BUFFER_VIEWS$1=ArrayBufferViewCore$z.NATIVE_ARRAY_BUFFER_VIEWS,TYPED_ARRAY_TAG=ArrayBufferViewCore$z.TYPED_ARRAY_TAG,TypedArray=ArrayBufferViewCore$z.TypedArray,TypedArrayPrototype$1=ArrayBufferViewCore$z.TypedArrayPrototype,aTypedArrayConstructor$3=ArrayBufferViewCore$z.aTypedArrayConstructor,isTypedArray=ArrayBufferViewCore$z.isTypedArray,BYTES_PER_ELEMENT="BYTES_PER_ELEMENT",WRONG_LENGTH="Wrong length",fromList=function(e,t){aTypedArrayConstructor$3(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},addGetter=function(e,t){nativeDefineProperty$1(e,t,{get:function(){return getInternalState$5(this)[t]}})},isArrayBuffer=function(e){var t;return isPrototypeOf$6(ArrayBufferPrototype,e)||"ArrayBuffer"==(t=classof$5(e))||"SharedArrayBuffer"==t},isTypedArrayIndex=function(e,t){return isTypedArray(e)&&!isSymbol$3(t)&&t in e&&isIntegralNumber(+t)&&t>=0},wrappedGetOwnPropertyDescriptor=function(e,t){return t=toPropertyKey$2(t),isTypedArrayIndex(e,t)?createPropertyDescriptor$7(2,e[t]):nativeGetOwnPropertyDescriptor$3(e,t)},wrappedDefineProperty=function(e,t,r){return t=toPropertyKey$2(t),!(isTypedArrayIndex(e,t)&&isObject$i(r)&&hasOwn$i(r,"value"))||hasOwn$i(r,"get")||hasOwn$i(r,"set")||r.configurable||hasOwn$i(r,"writable")&&!r.writable||hasOwn$i(r,"enumerable")&&!r.enumerable?nativeDefineProperty$1(e,t,r):(e[t]=r.value,e)};DESCRIPTORS$l?(NATIVE_ARRAY_BUFFER_VIEWS$1||(getOwnPropertyDescriptorModule$2.f=wrappedGetOwnPropertyDescriptor,definePropertyModule$1.f=wrappedDefineProperty,addGetter(TypedArrayPrototype$1,"buffer"),addGetter(TypedArrayPrototype$1,"byteOffset"),addGetter(TypedArrayPrototype$1,"byteLength"),addGetter(TypedArrayPrototype$1,"length")),$$1u({target:"Object",stat:!0,forced:!NATIVE_ARRAY_BUFFER_VIEWS$1},{getOwnPropertyDescriptor:wrappedGetOwnPropertyDescriptor,defineProperty:wrappedDefineProperty}),typedArrayConstructor.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,i=e+(r?"Clamped":"")+"Array",a="get"+e,o="set"+e,s=global$B[i],l=s,u=l&&l.prototype,c={},d=function(e,t){nativeDefineProperty$1(e,t,{get:function(){return function(e,t){var r=getInternalState$5(e);return r.view[a](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var a=getInternalState$5(e);r&&(i=(i=round(i))<0?0:i>255?255:255&i),a.view[o](t*n+a.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};NATIVE_ARRAY_BUFFER_VIEWS$1?TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$2&&(l=t((function(e,t,r,i){return anInstance$7(e,u),inheritIfRequired$4(isObject$i(t)?isArrayBuffer(t)?void 0!==i?new s(t,toOffset$1(r,n),i):void 0!==r?new s(t,toOffset$1(r,n)):new s(t):isTypedArray(t)?fromList(l,t):call$k(typedArrayFrom,l,t):new s(toIndex(t)),e,l)})),setPrototypeOf$3&&setPrototypeOf$3(l,TypedArray),forEach$2(getOwnPropertyNames$2(s),(function(e){e in l||createNonEnumerableProperty$4(l,e,s[e])})),l.prototype=u):(l=t((function(e,t,r,i){anInstance$7(e,u);var a,o,s,c=0,h=0;if(isObject$i(t)){if(!isArrayBuffer(t))return isTypedArray(t)?fromList(l,t):call$k(typedArrayFrom,l,t);a=t,h=toOffset$1(r,n);var f=t.byteLength;if(void 0===i){if(f%n)throw RangeError$2(WRONG_LENGTH);if((o=f-h)<0)throw RangeError$2(WRONG_LENGTH)}else if((o=toLength$7(i)*n)+h>f)throw RangeError$2(WRONG_LENGTH);s=o/n}else s=toIndex(t),a=new ArrayBuffer$3(o=s*n);for(setInternalState$7(e,{buffer:a,byteOffset:h,byteLength:o,length:s,view:new DataView$2(a)});c<s;)d(e,c++)})),setPrototypeOf$3&&setPrototypeOf$3(l,TypedArray),u=l.prototype=create$7(TypedArrayPrototype$1)),u.constructor!==l&&createNonEnumerableProperty$4(u,"constructor",l),enforceInternalState(u).TypedArrayConstructor=l,TYPED_ARRAY_TAG&&createNonEnumerableProperty$4(u,TYPED_ARRAY_TAG,i);var h=l!=s;c[i]=l,$$1u({global:!0,constructor:!0,forced:h,sham:!NATIVE_ARRAY_BUFFER_VIEWS$1},c),BYTES_PER_ELEMENT in l||createNonEnumerableProperty$4(l,BYTES_PER_ELEMENT,n),BYTES_PER_ELEMENT in u||createNonEnumerableProperty$4(u,BYTES_PER_ELEMENT,n),setSpecies$2(i)}):typedArrayConstructor.exports=function(){};var createTypedArrayConstructor$f=typedArrayConstructor.exports;createTypedArrayConstructor$f("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var ArrayBufferViewCore$y=arrayBufferViewCore,lengthOfArrayLike$i=lengthOfArrayLike$r,toIntegerOrInfinity$a=toIntegerOrInfinity$i,aTypedArray$u=ArrayBufferViewCore$y.aTypedArray,exportTypedArrayMethod$v=ArrayBufferViewCore$y.exportTypedArrayMethod;exportTypedArrayMethod$v("at",(function(e){var t=aTypedArray$u(this),r=lengthOfArrayLike$i(t),n=toIntegerOrInfinity$a(e),i=n>=0?n:r+n;return i<0||i>=r?void 0:t[i]}));var tryToString$2=tryToString$7,$TypeError$5=TypeError,deletePropertyOrThrow$5=function(e,t){if(!delete e[t])throw $TypeError$5("Cannot delete property "+tryToString$2(t)+" of "+tryToString$2(e))},toObject$c=toObject$m,toAbsoluteIndex$4=toAbsoluteIndex$9,lengthOfArrayLike$h=lengthOfArrayLike$r,deletePropertyOrThrow$4=deletePropertyOrThrow$5,min$5=Math.min,arrayCopyWithin=[].copyWithin||function(e,t){var r=toObject$c(this),n=lengthOfArrayLike$h(r),i=toAbsoluteIndex$4(e,n),a=toAbsoluteIndex$4(t,n),o=arguments.length>2?arguments[2]:void 0,s=min$5((void 0===o?n:toAbsoluteIndex$4(o,n))-a,n-i),l=1;for(a<i&&i<a+s&&(l=-1,a+=s-1,i+=s-1);s-- >0;)a in r?r[i]=r[a]:deletePropertyOrThrow$4(r,i),i+=l,a+=l;return r},uncurryThis$O=functionUncurryThis,ArrayBufferViewCore$x=arrayBufferViewCore,$ArrayCopyWithin=arrayCopyWithin,u$ArrayCopyWithin=uncurryThis$O($ArrayCopyWithin),aTypedArray$t=ArrayBufferViewCore$x.aTypedArray,exportTypedArrayMethod$u=ArrayBufferViewCore$x.exportTypedArrayMethod;exportTypedArrayMethod$u("copyWithin",(function(e,t){return u$ArrayCopyWithin(aTypedArray$t(this),e,t,arguments.length>2?arguments[2]:void 0)}));var ArrayBufferViewCore$w=arrayBufferViewCore,$every$1=arrayIteration.every,aTypedArray$s=ArrayBufferViewCore$w.aTypedArray,exportTypedArrayMethod$t=ArrayBufferViewCore$w.exportTypedArrayMethod;exportTypedArrayMethod$t("every",(function(e){return $every$1(aTypedArray$s(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$v=arrayBufferViewCore,$fill=arrayFill$1,toBigInt$2=toBigInt$4,classof$4=classof$c,call$j=functionCall,uncurryThis$N=functionUncurryThis,fails$I=fails$13,aTypedArray$r=ArrayBufferViewCore$v.aTypedArray,exportTypedArrayMethod$s=ArrayBufferViewCore$v.exportTypedArrayMethod,slice=uncurryThis$N("".slice),CONVERSION_BUG=fails$I((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e}));exportTypedArrayMethod$s("fill",(function(e){var t=arguments.length;aTypedArray$r(this);var r="Big"===slice(classof$4(this),0,3)?toBigInt$2(e):+e;return call$j($fill,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),CONVERSION_BUG);var lengthOfArrayLike$g=lengthOfArrayLike$r,arrayFromConstructorAndList$4=function(e,t){for(var r=0,n=lengthOfArrayLike$g(t),i=new e(n);n>r;)i[r]=t[r++];return i},ArrayBufferViewCore$u=arrayBufferViewCore,speciesConstructor$3=speciesConstructor$5,aTypedArrayConstructor$2=ArrayBufferViewCore$u.aTypedArrayConstructor,getTypedArrayConstructor$6=ArrayBufferViewCore$u.getTypedArrayConstructor,typedArraySpeciesConstructor$4=function(e){return aTypedArrayConstructor$2(speciesConstructor$3(e,getTypedArrayConstructor$6(e)))},arrayFromConstructorAndList$3=arrayFromConstructorAndList$4,typedArraySpeciesConstructor$3=typedArraySpeciesConstructor$4,typedArrayFromSpeciesAndList=function(e,t){return arrayFromConstructorAndList$3(typedArraySpeciesConstructor$3(e),t)},ArrayBufferViewCore$t=arrayBufferViewCore,$filter$1=arrayIteration.filter,fromSpeciesAndList=typedArrayFromSpeciesAndList,aTypedArray$q=ArrayBufferViewCore$t.aTypedArray,exportTypedArrayMethod$r=ArrayBufferViewCore$t.exportTypedArrayMethod;exportTypedArrayMethod$r("filter",(function(e){var t=$filter$1(aTypedArray$q(this),e,arguments.length>1?arguments[1]:void 0);return fromSpeciesAndList(this,t)}));var ArrayBufferViewCore$s=arrayBufferViewCore,$find$1=arrayIteration.find,aTypedArray$p=ArrayBufferViewCore$s.aTypedArray,exportTypedArrayMethod$q=ArrayBufferViewCore$s.exportTypedArrayMethod;exportTypedArrayMethod$q("find",(function(e){return $find$1(aTypedArray$p(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$r=arrayBufferViewCore,$findIndex=arrayIteration.findIndex,aTypedArray$o=ArrayBufferViewCore$r.aTypedArray,exportTypedArrayMethod$p=ArrayBufferViewCore$r.exportTypedArrayMethod;exportTypedArrayMethod$p("findIndex",(function(e){return $findIndex(aTypedArray$o(this),e,arguments.length>1?arguments[1]:void 0)}));var bind$a=functionBindContext,IndexedObject$3=indexedObject,toObject$b=toObject$m,lengthOfArrayLike$f=lengthOfArrayLike$r,createMethod$6=function(e){var t=1==e;return function(r,n,i){for(var a,o=toObject$b(r),s=IndexedObject$3(o),l=bind$a(n,i),u=lengthOfArrayLike$f(s);u-- >0;)if(l(a=s[u],u,o))switch(e){case 0:return a;case 1:return u}return t?-1:void 0}},arrayIterationFromLast={findLast:createMethod$6(0),findLastIndex:createMethod$6(1)},ArrayBufferViewCore$q=arrayBufferViewCore,$findLast=arrayIterationFromLast.findLast,aTypedArray$n=ArrayBufferViewCore$q.aTypedArray,exportTypedArrayMethod$o=ArrayBufferViewCore$q.exportTypedArrayMethod;exportTypedArrayMethod$o("findLast",(function(e){return $findLast(aTypedArray$n(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$p=arrayBufferViewCore,$findLastIndex=arrayIterationFromLast.findLastIndex,aTypedArray$m=ArrayBufferViewCore$p.aTypedArray,exportTypedArrayMethod$n=ArrayBufferViewCore$p.exportTypedArrayMethod;exportTypedArrayMethod$n("findLastIndex",(function(e){return $findLastIndex(aTypedArray$m(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$o=arrayBufferViewCore,$forEach$1=arrayIteration.forEach,aTypedArray$l=ArrayBufferViewCore$o.aTypedArray,exportTypedArrayMethod$m=ArrayBufferViewCore$o.exportTypedArrayMethod;exportTypedArrayMethod$m("forEach",(function(e){$forEach$1(aTypedArray$l(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$n=arrayBufferViewCore,$includes=arrayIncludes.includes,aTypedArray$k=ArrayBufferViewCore$n.aTypedArray,exportTypedArrayMethod$l=ArrayBufferViewCore$n.exportTypedArrayMethod;exportTypedArrayMethod$l("includes",(function(e){return $includes(aTypedArray$k(this),e,arguments.length>1?arguments[1]:void 0)}));var ArrayBufferViewCore$m=arrayBufferViewCore,$indexOf$1=arrayIncludes.indexOf,aTypedArray$j=ArrayBufferViewCore$m.aTypedArray,exportTypedArrayMethod$k=ArrayBufferViewCore$m.exportTypedArrayMethod;exportTypedArrayMethod$k("indexOf",(function(e){return $indexOf$1(aTypedArray$j(this),e,arguments.length>1?arguments[1]:void 0)}));var global$A=global$T,fails$H=fails$13,uncurryThis$M=functionUncurryThis,ArrayBufferViewCore$l=arrayBufferViewCore,ArrayIterators=es_array_iterator,wellKnownSymbol$c=wellKnownSymbol$t,ITERATOR$7=wellKnownSymbol$c("iterator"),Uint8Array$2=global$A.Uint8Array,arrayValues=uncurryThis$M(ArrayIterators.values),arrayKeys=uncurryThis$M(ArrayIterators.keys),arrayEntries=uncurryThis$M(ArrayIterators.entries),aTypedArray$i=ArrayBufferViewCore$l.aTypedArray,exportTypedArrayMethod$j=ArrayBufferViewCore$l.exportTypedArrayMethod,TypedArrayPrototype=Uint8Array$2&&Uint8Array$2.prototype,GENERIC=!fails$H((function(){TypedArrayPrototype[ITERATOR$7].call([1])})),ITERATOR_IS_VALUES=!!TypedArrayPrototype&&TypedArrayPrototype.values&&TypedArrayPrototype[ITERATOR$7]===TypedArrayPrototype.values&&"values"===TypedArrayPrototype.values.name,typedArrayValues=function(){return arrayValues(aTypedArray$i(this))};exportTypedArrayMethod$j("entries",(function(){return arrayEntries(aTypedArray$i(this))}),GENERIC),exportTypedArrayMethod$j("keys",(function(){return arrayKeys(aTypedArray$i(this))}),GENERIC),exportTypedArrayMethod$j("values",typedArrayValues,GENERIC||!ITERATOR_IS_VALUES,{name:"values"}),exportTypedArrayMethod$j(ITERATOR$7,typedArrayValues,GENERIC||!ITERATOR_IS_VALUES,{name:"values"});var ArrayBufferViewCore$k=arrayBufferViewCore,uncurryThis$L=functionUncurryThis,aTypedArray$h=ArrayBufferViewCore$k.aTypedArray,exportTypedArrayMethod$i=ArrayBufferViewCore$k.exportTypedArrayMethod,$join=uncurryThis$L([].join);exportTypedArrayMethod$i("join",(function(e){return $join(aTypedArray$h(this),e)}));var ArrayBufferViewCore$j=arrayBufferViewCore,apply$7=functionApply,$lastIndexOf=arrayLastIndexOf,aTypedArray$g=ArrayBufferViewCore$j.aTypedArray,exportTypedArrayMethod$h=ArrayBufferViewCore$j.exportTypedArrayMethod;exportTypedArrayMethod$h("lastIndexOf",(function(e){var t=arguments.length;return apply$7($lastIndexOf,aTypedArray$g(this),t>1?[e,arguments[1]]:[e])}));var ArrayBufferViewCore$i=arrayBufferViewCore,$map$1=arrayIteration.map,typedArraySpeciesConstructor$2=typedArraySpeciesConstructor$4,aTypedArray$f=ArrayBufferViewCore$i.aTypedArray,exportTypedArrayMethod$g=ArrayBufferViewCore$i.exportTypedArrayMethod;exportTypedArrayMethod$g("map",(function(e){return $map$1(aTypedArray$f(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(typedArraySpeciesConstructor$2(e))(t)}))}));var aCallable$9=aCallable$e,toObject$a=toObject$m,IndexedObject$2=indexedObject,lengthOfArrayLike$e=lengthOfArrayLike$r,$TypeError$4=TypeError,createMethod$5=function(e){return function(t,r,n,i){aCallable$9(r);var a=toObject$a(t),o=IndexedObject$2(a),s=lengthOfArrayLike$e(a),l=e?s-1:0,u=e?-1:1;if(n<2)for(;;){if(l in o){i=o[l],l+=u;break}if(l+=u,e?l<0:s<=l)throw $TypeError$4("Reduce of empty array with no initial value")}for(;e?l>=0:s>l;l+=u)l in o&&(i=r(i,o[l],l,a));return i}},arrayReduce={left:createMethod$5(!1),right:createMethod$5(!0)},ArrayBufferViewCore$h=arrayBufferViewCore,$reduce$2=arrayReduce.left,aTypedArray$e=ArrayBufferViewCore$h.aTypedArray,exportTypedArrayMethod$f=ArrayBufferViewCore$h.exportTypedArrayMethod;exportTypedArrayMethod$f("reduce",(function(e){var t=arguments.length;return $reduce$2(aTypedArray$e(this),e,t,t>1?arguments[1]:void 0)}));var ArrayBufferViewCore$g=arrayBufferViewCore,$reduceRight=arrayReduce.right,aTypedArray$d=ArrayBufferViewCore$g.aTypedArray,exportTypedArrayMethod$e=ArrayBufferViewCore$g.exportTypedArrayMethod;exportTypedArrayMethod$e("reduceRight",(function(e){var t=arguments.length;return $reduceRight(aTypedArray$d(this),e,t,t>1?arguments[1]:void 0)}));var ArrayBufferViewCore$f=arrayBufferViewCore,aTypedArray$c=ArrayBufferViewCore$f.aTypedArray,exportTypedArrayMethod$d=ArrayBufferViewCore$f.exportTypedArrayMethod,floor$7=Math.floor;exportTypedArrayMethod$d("reverse",(function(){for(var e,t=this,r=aTypedArray$c(t).length,n=floor$7(r/2),i=0;i<n;)e=t[i],t[i++]=t[--r],t[r]=e;return t}));var global$z=global$T,call$i=functionCall,ArrayBufferViewCore$e=arrayBufferViewCore,lengthOfArrayLike$d=lengthOfArrayLike$r,toOffset=toOffset$2,toIndexedObject$8=toObject$m,fails$G=fails$13,RangeError$1=global$z.RangeError,Int8Array$2=global$z.Int8Array,Int8ArrayPrototype=Int8Array$2&&Int8Array$2.prototype,$set=Int8ArrayPrototype&&Int8ArrayPrototype.set,aTypedArray$b=ArrayBufferViewCore$e.aTypedArray,exportTypedArrayMethod$c=ArrayBufferViewCore$e.exportTypedArrayMethod,WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS=!fails$G((function(){var e=new Uint8ClampedArray(2);return call$i($set,e,{length:1,0:3},1),3!==e[1]})),TO_OBJECT_BUG=WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS&&ArrayBufferViewCore$e.NATIVE_ARRAY_BUFFER_VIEWS&&fails$G((function(){var e=new Int8Array$2(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));exportTypedArrayMethod$c("set",(function(e){aTypedArray$b(this);var t=toOffset(arguments.length>1?arguments[1]:void 0,1),r=toIndexedObject$8(e);if(WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS)return call$i($set,this,r,t);var n=this.length,i=lengthOfArrayLike$d(r),a=0;if(i+t>n)throw RangeError$1("Wrong length");for(;a<i;)this[t+a]=r[a++]}),!WORKS_WITH_OBJECTS_AND_GEERIC_ON_TYPED_ARRAYS||TO_OBJECT_BUG);var ArrayBufferViewCore$d=arrayBufferViewCore,typedArraySpeciesConstructor$1=typedArraySpeciesConstructor$4,fails$F=fails$13,arraySlice$8=arraySlice$c,aTypedArray$a=ArrayBufferViewCore$d.aTypedArray,exportTypedArrayMethod$b=ArrayBufferViewCore$d.exportTypedArrayMethod,FORCED$g=fails$F((function(){new Int8Array(1).slice()}));exportTypedArrayMethod$b("slice",(function(e,t){for(var r=arraySlice$8(aTypedArray$a(this),e,t),n=typedArraySpeciesConstructor$1(this),i=0,a=r.length,o=new n(a);a>i;)o[i]=r[i++];return o}),FORCED$g);var ArrayBufferViewCore$c=arrayBufferViewCore,$some$2=arrayIteration.some,aTypedArray$9=ArrayBufferViewCore$c.aTypedArray,exportTypedArrayMethod$a=ArrayBufferViewCore$c.exportTypedArrayMethod;exportTypedArrayMethod$a("some",(function(e){return $some$2(aTypedArray$9(this),e,arguments.length>1?arguments[1]:void 0)}));var arraySlice$7=arraySliceSimple,floor$6=Math.floor,mergeSort=function e(t,r){var n=t.length,i=floor$6(n/2);return n<8?insertionSort(t,r):merge(t,e(arraySlice$7(t,0,i),r),e(arraySlice$7(t,i),r),r)},insertionSort=function(e,t){for(var r,n,i=e.length,a=1;a<i;){for(n=a,r=e[a];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==a++&&(e[n]=r)}return e},merge=function(e,t,r,n){for(var i=t.length,a=r.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?n(t[o],r[s])<=0?t[o++]:r[s++]:o<i?t[o++]:r[s++];return e},arraySort$1=mergeSort,userAgent$6=engineUserAgent,firefox=userAgent$6.match(/firefox\/(\d+)/i),engineFfVersion=!!firefox&&+firefox[1],UA=engineUserAgent,engineIsIeOrEdge=/MSIE|Trident/.test(UA),userAgent$5=engineUserAgent,webkit=userAgent$5.match(/AppleWebKit\/(\d+)\./),engineWebkitVersion=!!webkit&&+webkit[1],global$y=global$T,uncurryThis$K=functionUncurryThis,fails$E=fails$13,aCallable$8=aCallable$e,internalSort$1=arraySort$1,ArrayBufferViewCore$b=arrayBufferViewCore,FF$1=engineFfVersion,IE_OR_EDGE$1=engineIsIeOrEdge,V8$1=engineV8Version,WEBKIT$1=engineWebkitVersion,aTypedArray$8=ArrayBufferViewCore$b.aTypedArray,exportTypedArrayMethod$9=ArrayBufferViewCore$b.exportTypedArrayMethod,Uint16Array$1=global$y.Uint16Array,nativeSort$1=Uint16Array$1&&uncurryThis$K(Uint16Array$1.prototype.sort),ACCEPT_INCORRECT_ARGUMENTS=!(!nativeSort$1||fails$E((function(){nativeSort$1(new Uint16Array$1(2),null)}))&&fails$E((function(){nativeSort$1(new Uint16Array$1(2),{})}))),STABLE_SORT$1=!!nativeSort$1&&!fails$E((function(){if(V8$1)return V8$1<74;if(FF$1)return FF$1<67;if(IE_OR_EDGE$1)return!0;if(WEBKIT$1)return WEBKIT$1<602;var e,t,r=new Uint16Array$1(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(nativeSort$1(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0})),getSortCompare$1=function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}};exportTypedArrayMethod$9("sort",(function(e){return void 0!==e&&aCallable$8(e),STABLE_SORT$1?nativeSort$1(this,e):internalSort$1(aTypedArray$8(this),getSortCompare$1(e))}),!STABLE_SORT$1||ACCEPT_INCORRECT_ARGUMENTS);var ArrayBufferViewCore$a=arrayBufferViewCore,toLength$6=toLength$c,toAbsoluteIndex$3=toAbsoluteIndex$9,typedArraySpeciesConstructor=typedArraySpeciesConstructor$4,aTypedArray$7=ArrayBufferViewCore$a.aTypedArray,exportTypedArrayMethod$8=ArrayBufferViewCore$a.exportTypedArrayMethod;exportTypedArrayMethod$8("subarray",(function(e,t){var r=aTypedArray$7(this),n=r.length,i=toAbsoluteIndex$3(e,n);return new(typedArraySpeciesConstructor(r))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,toLength$6((void 0===t?n:toAbsoluteIndex$3(t,n))-i))}));var global$x=global$T,apply$6=functionApply,ArrayBufferViewCore$9=arrayBufferViewCore,fails$D=fails$13,arraySlice$6=arraySlice$c,Int8Array$1=global$x.Int8Array,aTypedArray$6=ArrayBufferViewCore$9.aTypedArray,exportTypedArrayMethod$7=ArrayBufferViewCore$9.exportTypedArrayMethod,$toLocaleString=[].toLocaleString,TO_LOCALE_STRING_BUG=!!Int8Array$1&&fails$D((function(){$toLocaleString.call(new Int8Array$1(1))})),FORCED$f=fails$D((function(){return[1,2].toLocaleString()!=new Int8Array$1([1,2]).toLocaleString()}))||!fails$D((function(){Int8Array$1.prototype.toLocaleString.call([1,2])}));exportTypedArrayMethod$7("toLocaleString",(function(){return apply$6($toLocaleString,TO_LOCALE_STRING_BUG?arraySlice$6(aTypedArray$6(this)):aTypedArray$6(this),arraySlice$6(arguments))}),FORCED$f);var exportTypedArrayMethod$6=arrayBufferViewCore.exportTypedArrayMethod,fails$C=fails$13,global$w=global$T,uncurryThis$J=functionUncurryThis,Uint8Array$1=global$w.Uint8Array,Uint8ArrayPrototype=Uint8Array$1&&Uint8Array$1.prototype||{},arrayToString=[].toString,join$4=uncurryThis$J([].join);fails$C((function(){arrayToString.call({})}))&&(arrayToString=function(){return join$4(this)});var IS_NOT_ARRAY_METHOD=Uint8ArrayPrototype.toString!=arrayToString;exportTypedArrayMethod$6("toString",arrayToString,IS_NOT_ARRAY_METHOD);var lengthOfArrayLike$c=lengthOfArrayLike$r,arrayToReversed$3=function(e,t){for(var r=lengthOfArrayLike$c(e),n=new t(r),i=0;i<r;i++)n[i]=e[r-i-1];return n},arrayToReversed$2=arrayToReversed$3,ArrayBufferViewCore$8=arrayBufferViewCore,aTypedArray$5=ArrayBufferViewCore$8.aTypedArray,exportTypedArrayMethod$5=ArrayBufferViewCore$8.exportTypedArrayMethod,getTypedArrayConstructor$5=ArrayBufferViewCore$8.getTypedArrayConstructor;exportTypedArrayMethod$5("toReversed",(function(){return arrayToReversed$2(aTypedArray$5(this),getTypedArrayConstructor$5(this))}));var ArrayBufferViewCore$7=arrayBufferViewCore,uncurryThis$I=functionUncurryThis,aCallable$7=aCallable$e,arrayFromConstructorAndList$2=arrayFromConstructorAndList$4,aTypedArray$4=ArrayBufferViewCore$7.aTypedArray,getTypedArrayConstructor$4=ArrayBufferViewCore$7.getTypedArrayConstructor,exportTypedArrayMethod$4=ArrayBufferViewCore$7.exportTypedArrayMethod,sort$1=uncurryThis$I(ArrayBufferViewCore$7.TypedArrayPrototype.sort);exportTypedArrayMethod$4("toSorted",(function(e){void 0!==e&&aCallable$7(e);var t=aTypedArray$4(this),r=arrayFromConstructorAndList$2(getTypedArrayConstructor$4(t),t);return sort$1(r,e)}));var lengthOfArrayLike$b=lengthOfArrayLike$r,toIntegerOrInfinity$9=toIntegerOrInfinity$i,$RangeError$4=RangeError,arrayWith$3=function(e,t,r,n){var i=lengthOfArrayLike$b(e),a=toIntegerOrInfinity$9(r),o=a<0?i+a:a;if(o>=i||o<0)throw $RangeError$4("Incorrect index");for(var s=new t(i),l=0;l<i;l++)s[l]=l===o?n:e[l];return s},arrayWith$2=arrayWith$3,ArrayBufferViewCore$6=arrayBufferViewCore,isBigIntArray$1=isBigIntArray$3,toIntegerOrInfinity$8=toIntegerOrInfinity$i,toBigInt$1=toBigInt$4,aTypedArray$3=ArrayBufferViewCore$6.aTypedArray,getTypedArrayConstructor$3=ArrayBufferViewCore$6.getTypedArrayConstructor,exportTypedArrayMethod$3=ArrayBufferViewCore$6.exportTypedArrayMethod,PROPER_ORDER$1=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(error){return 8===error}}();exportTypedArrayMethod$3("with",{with:function(e,t){var r=aTypedArray$3(this),n=toIntegerOrInfinity$8(e),i=isBigIntArray$1(r)?toBigInt$1(t):+t;return arrayWith$2(r,getTypedArrayConstructor$3(r),n,i)}}.with,!PROPER_ORDER$1);var $$1t=_export,fails$B=fails$13,toIndexedObject$7=toIndexedObject$f,nativeGetOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f,DESCRIPTORS$k=descriptors,FAILS_ON_PRIMITIVES$3=fails$B((function(){nativeGetOwnPropertyDescriptor$2(1)})),FORCED$e=!DESCRIPTORS$k||FAILS_ON_PRIMITIVES$3;$$1t({target:"Object",stat:!0,forced:FORCED$e,sham:!DESCRIPTORS$k},{getOwnPropertyDescriptor:function(e,t){return nativeGetOwnPropertyDescriptor$2(toIndexedObject$7(e),t)}});var $$1s=_export,DESCRIPTORS$j=descriptors,defineProperty$a=objectDefineProperty.f;$$1s({target:"Object",stat:!0,forced:Object.defineProperty!==defineProperty$a,sham:!DESCRIPTORS$j},{defineProperty:defineProperty$a});var $$1r=_export,global$v=global$T,arrayBufferModule=arrayBuffer,setSpecies$1=setSpecies$3,ARRAY_BUFFER="ArrayBuffer",ArrayBuffer$2=arrayBufferModule[ARRAY_BUFFER],NativeArrayBuffer=global$v[ARRAY_BUFFER];$$1r({global:!0,constructor:!0,forced:NativeArrayBuffer!==ArrayBuffer$2},{ArrayBuffer:ArrayBuffer$2}),setSpecies$1(ARRAY_BUFFER);var anObject$h=anObject$r,regexpFlags$1=function(){var e=anObject$h(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},fails$A=fails$13,global$u=global$T,$RegExp$2=global$u.RegExp,UNSUPPORTED_Y$1=fails$A((function(){var e=$RegExp$2("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),MISSED_STICKY=UNSUPPORTED_Y$1||fails$A((function(){return!$RegExp$2("a","y").sticky})),BROKEN_CARET=UNSUPPORTED_Y$1||fails$A((function(){var e=$RegExp$2("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),regexpStickyHelpers={BROKEN_CARET:BROKEN_CARET,MISSED_STICKY:MISSED_STICKY,UNSUPPORTED_Y:UNSUPPORTED_Y$1},fails$z=fails$13,global$t=global$T,$RegExp$1=global$t.RegExp,regexpUnsupportedDotAll=fails$z((function(){var e=$RegExp$1(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),fails$y=fails$13,global$s=global$T,$RegExp=global$s.RegExp,regexpUnsupportedNcg=fails$y((function(){var e=$RegExp("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),call$h=functionCall,uncurryThis$H=functionUncurryThis,toString$t=toString$w,regexpFlags=regexpFlags$1,stickyHelpers=regexpStickyHelpers,shared$3=shared$7.exports,create$6=objectCreate$1,getInternalState$4=internalState.get,UNSUPPORTED_DOT_ALL=regexpUnsupportedDotAll,UNSUPPORTED_NCG=regexpUnsupportedNcg,nativeReplace=shared$3("native-string-replace",String.prototype.replace),nativeExec=RegExp.prototype.exec,patchedExec=nativeExec,charAt$e=uncurryThis$H("".charAt),indexOf$1=uncurryThis$H("".indexOf),replace$b=uncurryThis$H("".replace),stringSlice$c=uncurryThis$H("".slice),UPDATES_LAST_INDEX_WRONG=function(){var e=/a/,t=/b*/g;return call$h(nativeExec,e,"a"),call$h(nativeExec,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),UNSUPPORTED_Y=stickyHelpers.BROKEN_CARET,NPCG_INCLUDED=void 0!==/()??/.exec("")[1],PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED||UNSUPPORTED_Y||UNSUPPORTED_DOT_ALL||UNSUPPORTED_NCG;PATCH&&(patchedExec=function(e){var t,r,n,i,a,o,s,l=this,u=getInternalState$4(l),c=toString$t(e),d=u.raw;if(d)return d.lastIndex=l.lastIndex,t=call$h(patchedExec,d,c),l.lastIndex=d.lastIndex,t;var h=u.groups,f=UNSUPPORTED_Y&&l.sticky,p=call$h(regexpFlags,l),y=l.source,m=0,g=c;if(f&&(p=replace$b(p,"y",""),-1===indexOf$1(p,"g")&&(p+="g"),g=stringSlice$c(c,l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==charAt$e(c,l.lastIndex-1))&&(y="(?: "+y+")",g=" "+g,m++),r=new RegExp("^(?:"+y+")",p)),NPCG_INCLUDED&&(r=new RegExp("^"+y+"$(?!\\s)",p)),UPDATES_LAST_INDEX_WRONG&&(n=l.lastIndex),i=call$h(nativeExec,f?r:l,g),f?i?(i.input=stringSlice$c(i.input,m),i[0]=stringSlice$c(i[0],m),i.index=l.lastIndex,l.lastIndex+=i[0].length):l.lastIndex=0:UPDATES_LAST_INDEX_WRONG&&i&&(l.lastIndex=l.global?i.index+i[0].length:n),NPCG_INCLUDED&&i&&i.length>1&&call$h(nativeReplace,i[0],r,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&h)for(i.groups=o=create$6(null),a=0;a<h.length;a++)o[(s=h[a])[0]]=i[s[1]];return i});var regexpExec$2=patchedExec,$$1q=_export,exec$9=regexpExec$2;$$1q({target:"RegExp",proto:!0,forced:/./.exec!==exec$9},{exec:exec$9});var uncurryThis$G=functionUncurryThis,defineBuiltIn$d=defineBuiltIn$m,regexpExec$1=regexpExec$2,fails$x=fails$13,wellKnownSymbol$b=wellKnownSymbol$t,createNonEnumerableProperty$3=createNonEnumerableProperty$d,SPECIES$2=wellKnownSymbol$b("species"),RegExpPrototype$3=RegExp.prototype,fixRegexpWellKnownSymbolLogic=function(e,t,r,n){var i=wellKnownSymbol$b(e),a=!fails$x((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!fails$x((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[SPECIES$2]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!a||!o||r){var s=uncurryThis$G(/./[i]),l=t(i,""[e],(function(e,t,r,n,i){var o=uncurryThis$G(e),l=t.exec;return l===regexpExec$1||l===RegExpPrototype$3.exec?a&&!i?{done:!0,value:s(t,r,n)}:{done:!0,value:o(r,t,n)}:{done:!1}}));defineBuiltIn$d(String.prototype,e,l[0]),defineBuiltIn$d(RegExpPrototype$3,i,l[1])}n&&createNonEnumerableProperty$3(RegExpPrototype$3[i],"sham",!0)},uncurryThis$F=functionUncurryThis,toIntegerOrInfinity$7=toIntegerOrInfinity$i,toString$s=toString$w,requireObjectCoercible$a=requireObjectCoercible$e,charAt$d=uncurryThis$F("".charAt),charCodeAt$5=uncurryThis$F("".charCodeAt),stringSlice$b=uncurryThis$F("".slice),createMethod$4=function(e){return function(t,r){var n,i,a=toString$s(requireObjectCoercible$a(t)),o=toIntegerOrInfinity$7(r),s=a.length;return o<0||o>=s?e?"":void 0:(n=charCodeAt$5(a,o))<55296||n>56319||o+1===s||(i=charCodeAt$5(a,o+1))<56320||i>57343?e?charAt$d(a,o):n:e?stringSlice$b(a,o,o+2):i-56320+(n-55296<<10)+65536}},stringMultibyte={codeAt:createMethod$4(!1),charAt:createMethod$4(!0)},charAt$c=stringMultibyte.charAt,advanceStringIndex$2=function(e,t,r){return t+(r?charAt$c(e,t).length:1)},uncurryThis$E=functionUncurryThis,toObject$9=toObject$m,floor$5=Math.floor,charAt$b=uncurryThis$E("".charAt),replace$a=uncurryThis$E("".replace),stringSlice$a=uncurryThis$E("".slice),SUBSTITUTION_SYMBOLS=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&'`]|\d{1,2})/g,getSubstitution$1=function(e,t,r,n,i,a){var o=r+e.length,s=n.length,l=SUBSTITUTION_SYMBOLS_NO_NAMED;return void 0!==i&&(i=toObject$9(i),l=SUBSTITUTION_SYMBOLS),replace$a(a,l,(function(a,l){var u;switch(charAt$b(l,0)){case"$":return"$";case"&":return e;case"`":return stringSlice$a(t,0,r);case"'":return stringSlice$a(t,o);case"<":u=i[stringSlice$a(l,1,-1)];break;default:var c=+l;if(0===c)return a;if(c>s){var d=floor$5(c/10);return 0===d?a:d<=s?void 0===n[d-1]?charAt$b(l,1):n[d-1]+charAt$b(l,1):a}u=n[c-1]}return void 0===u?"":u}))},call$g=functionCall,anObject$g=anObject$r,isCallable$b=isCallable$v,classof$3=classofRaw$2,regexpExec=regexpExec$2,$TypeError$3=TypeError,regexpExecAbstract=function(e,t){var r=e.exec;if(isCallable$b(r)){var n=call$g(r,e,t);return null!==n&&anObject$g(n),n}if("RegExp"===classof$3(e))return call$g(regexpExec,e,t);throw $TypeError$3("RegExp#exec called on incompatible receiver")},apply$5=functionApply,call$f=functionCall,uncurryThis$D=functionUncurryThis,fixRegExpWellKnownSymbolLogic$2=fixRegexpWellKnownSymbolLogic,fails$w=fails$13,anObject$f=anObject$r,isCallable$a=isCallable$v,isNullOrUndefined$2=isNullOrUndefined$7,toIntegerOrInfinity$6=toIntegerOrInfinity$i,toLength$5=toLength$c,toString$r=toString$w,requireObjectCoercible$9=requireObjectCoercible$e,advanceStringIndex$1=advanceStringIndex$2,getMethod$3=getMethod$6,getSubstitution=getSubstitution$1,regExpExec$3=regexpExecAbstract,wellKnownSymbol$a=wellKnownSymbol$t,REPLACE=wellKnownSymbol$a("replace"),max$4=Math.max,min$4=Math.min,concat$2=uncurryThis$D([].concat),push$9=uncurryThis$D([].push),stringIndexOf=uncurryThis$D("".indexOf),stringSlice$9=uncurryThis$D("".slice),maybeToString=function(e){return void 0===e?e:String(e)},REPLACE_KEEPS_$0="$0"==="a".replace(/./,"$0"),REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE=!!/./[REPLACE]&&""===/./[REPLACE]("a","$0"),REPLACE_SUPPORTS_NAMED_GROUPS=!fails$w((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));fixRegExpWellKnownSymbolLogic$2("replace",(function(e,t,r){var n=REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE?"$":"$0";return[function(e,r){var n=requireObjectCoercible$9(this),i=isNullOrUndefined$2(e)?void 0:getMethod$3(e,REPLACE);return i?call$f(i,e,n,r):call$f(t,toString$r(n),e,r)},function(e,i){var a=anObject$f(this),o=toString$r(e);if("string"==typeof i&&-1===stringIndexOf(i,n)&&-1===stringIndexOf(i,"$<")){var s=r(t,a,o,i);if(s.done)return s.value}var l=isCallable$a(i);l||(i=toString$r(i));var u=a.global;if(u){var c=a.unicode;a.lastIndex=0}for(var d=[];;){var h=regExpExec$3(a,o);if(null===h)break;if(push$9(d,h),!u)break;""===toString$r(h[0])&&(a.lastIndex=advanceStringIndex$1(o,toLength$5(a.lastIndex),c))}for(var f="",p=0,y=0;y<d.length;y++){for(var m=toString$r((h=d[y])[0]),g=max$4(min$4(toIntegerOrInfinity$6(h.index),o.length),0),v=[],b=1;b<h.length;b++)push$9(v,maybeToString(h[b]));var _=h.groups;if(l){var E=concat$2([m],v,g,o);void 0!==_&&push$9(E,_);var T=toString$r(apply$5(i,void 0,E))}else T=getSubstitution(m,o,g,v,_,i);g>=p&&(f+=stringSlice$9(o,p,g)+T,p=g+m.length)}return f+stringSlice$9(o,p)}]}),!REPLACE_SUPPORTS_NAMED_GROUPS||!REPLACE_KEEPS_$0||REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE);var createTypedArrayConstructor$e=typedArrayConstructor.exports;createTypedArrayConstructor$e("Int8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$d=typedArrayConstructor.exports;createTypedArrayConstructor$d("Int16",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$c=typedArrayConstructor.exports;createTypedArrayConstructor$c("Int32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$b=typedArrayConstructor.exports;createTypedArrayConstructor$b("Uint16",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$a=typedArrayConstructor.exports;createTypedArrayConstructor$a("Uint32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$9=typedArrayConstructor.exports;createTypedArrayConstructor$9("Float32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var createTypedArrayConstructor$8=typedArrayConstructor.exports;createTypedArrayConstructor$8("Float64",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var call$e=functionCall,hasOwn$h=hasOwnProperty_1,isPrototypeOf$5=objectIsPrototypeOf,regExpFlags$1=regexpFlags$1,RegExpPrototype$2=RegExp.prototype,regexpGetFlags=function(e){var t=e.flags;return void 0!==t||"flags"in RegExpPrototype$2||hasOwn$h(e,"flags")||!isPrototypeOf$5(RegExpPrototype$2,e)?t:call$e(regExpFlags$1,e)},PROPER_FUNCTION_NAME$1=functionName.PROPER,defineBuiltIn$c=defineBuiltIn$m,anObject$e=anObject$r,$toString$3=toString$w,fails$v=fails$13,getRegExpFlags=regexpGetFlags,TO_STRING$1="toString",RegExpPrototype$1=RegExp.prototype,nativeToString=RegExpPrototype$1[TO_STRING$1],NOT_GENERIC=fails$v((function(){return"/a/b"!=nativeToString.call({source:"a",flags:"b"})})),INCORRECT_NAME=PROPER_FUNCTION_NAME$1&&nativeToString.name!=TO_STRING$1;(NOT_GENERIC||INCORRECT_NAME)&&defineBuiltIn$c(RegExp.prototype,TO_STRING$1,(function(){var e=anObject$e(this);return"/"+$toString$3(e.source)+"/"+$toString$3(getRegExpFlags(e))}),{unsafe:!0});var $$1p=_export,toObject$8=toObject$m,lengthOfArrayLike$a=lengthOfArrayLike$r,setArrayLength$3=arraySetLength,deletePropertyOrThrow$3=deletePropertyOrThrow$5,doesNotExceedSafeInteger$3=doesNotExceedSafeInteger$6,INCORRECT_RESULT$1=1!==[].unshift(0),SILENT_ON_NON_WRITABLE_LENGTH$2=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(error){return error instanceof TypeError}}();$$1p({target:"Array",proto:!0,arity:1,forced:INCORRECT_RESULT$1||SILENT_ON_NON_WRITABLE_LENGTH$2},{unshift:function(e){var t=toObject$8(this),r=lengthOfArrayLike$a(t),n=arguments.length;if(n){doesNotExceedSafeInteger$3(r+n);for(var i=r;i--;){var a=i+n;i in t?t[a]=t[i]:deletePropertyOrThrow$3(t,a)}for(var o=0;o<n;o++)t[o]=arguments[o]}return setArrayLength$3(t,r+n)}});var $$1o=_export,fails$u=fails$13,$imul$1=Math.imul,FORCED$d=fails$u((function(){return-5!=$imul$1(4294967295,5)||2!=$imul$1.length}));$$1o({target:"Math",stat:!0,forced:FORCED$d},{imul:function(e,t){var r=65535,n=+e,i=+t,a=r&n,o=r&i;return 0|a*o+((r&n>>>16)*o+a*(r&i>>>16)<<16>>>0)}});var mathSign$1=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1},sign$1=mathSign$1,abs$1=Math.abs,pow$3=Math.pow,EPSILON$1=pow$3(2,-52),EPSILON32$1=pow$3(2,-23),MAX32$1=pow$3(2,127)*(2-EPSILON32$1),MIN32$1=pow$3(2,-126),roundTiesToEven$1=function(e){return e+1/EPSILON$1-1/EPSILON$1},mathFround$1=Math.fround||function(e){var t,r,n=+e,i=abs$1(n),a=sign$1(n);return i<MIN32$1?a*roundTiesToEven$1(i/MIN32$1/EPSILON32$1)*MIN32$1*EPSILON32$1:(r=(t=(1+EPSILON32$1/EPSILON$1)*i)-(t-i))>MAX32$1||r!=r?a*(1/0):a*r},$$1n=_export,fround$1=mathFround$1;$$1n({target:"Math",stat:!0},{fround:fround$1});var $$1m=_export,floor$4=Math.floor,log$4=Math.log,LOG2E$1=Math.LOG2E;$$1m({target:"Math",stat:!0},{clz32:function(e){var t=e>>>0;return t?31-floor$4(log$4(t+.5)*LOG2E$1):32}});var $$1l=_export,trunc$1=mathTrunc;$$1l({target:"Math",stat:!0},{trunc:trunc$1});var isObject$h=isObject$w,classof$2=classofRaw$2,wellKnownSymbol$9=wellKnownSymbol$t,MATCH$1=wellKnownSymbol$9("match"),isRegexp=function(e){var t;return isObject$h(e)&&(void 0!==(t=e[MATCH$1])?!!t:"RegExp"==classof$2(e))},isRegExp=isRegexp,$TypeError$2=TypeError,notARegexp=function(e){if(isRegExp(e))throw $TypeError$2("The method doesn't accept regular expressions");return e},wellKnownSymbol$8=wellKnownSymbol$t,MATCH=wellKnownSymbol$8("match"),correctIsRegexpLogic=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[MATCH]=!1,"/./"[e](t)}catch(n){}}return!1},$$1k=_export,uncurryThis$C=functionUncurryThis,getOwnPropertyDescriptor$4=objectGetOwnPropertyDescriptor.f,toLength$4=toLength$c,toString$q=toString$w,notARegExp$1=notARegexp,requireObjectCoercible$8=requireObjectCoercible$e,correctIsRegExpLogic$1=correctIsRegexpLogic,nativeStartsWith$1=uncurryThis$C("".startsWith),stringSlice$8=uncurryThis$C("".slice),min$3=Math.min,CORRECT_IS_REGEXP_LOGIC$1=correctIsRegExpLogic$1("startsWith"),MDN_POLYFILL_BUG$1=!(CORRECT_IS_REGEXP_LOGIC$1||(descriptor2=getOwnPropertyDescriptor$4(String.prototype,"startsWith"),!descriptor2||descriptor2.writable)),descriptor2;$$1k({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG$1&&!CORRECT_IS_REGEXP_LOGIC$1},{startsWith:function(e){var t=toString$q(requireObjectCoercible$8(this));notARegExp$1(e);var r=toLength$4(min$3(arguments.length>1?arguments[1]:void 0,t.length)),n=toString$q(e);return nativeStartsWith$1?nativeStartsWith$1(t,n,r):stringSlice$8(t,r,r+n.length)===n}});var classof$1=classofRaw$2,global$r=global$T,engineIsNode="process"==classof$1(global$r.process),userAgent$4=engineUserAgent,engineIsIos=/(?:ipad|iphone|ipod).*applewebkit/i.test(userAgent$4),global$q=global$T,apply$4=functionApply,bind$9=functionBindContext,isCallable$9=isCallable$v,hasOwn$g=hasOwnProperty_1,fails$t=fails$13,html=html$2,arraySlice$5=arraySlice$c,createElement=documentCreateElement$2,validateArgumentsLength$6=validateArgumentsLength$8,IS_IOS$1=engineIsIos,IS_NODE$7=engineIsNode,set=global$q.setImmediate,clear$1=global$q.clearImmediate,process$4=global$q.process,Dispatch=global$q.Dispatch,Function$2=global$q.Function,MessageChannel=global$q.MessageChannel,String$1=global$q.String,counter=0,queue$1={},ONREADYSTATECHANGE="onreadystatechange",$location,defer,channel,port;try{$location=global$q.location}catch(error){}var run=function(e){if(hasOwn$g(queue$1,e)){var t=queue$1[e];delete queue$1[e],t()}},runner=function(e){return function(){run(e)}},listener=function(e){run(e.data)},post=function(e){global$q.postMessage(String$1(e),$location.protocol+"//"+$location.host)};set&&clear$1||(set=function(e){validateArgumentsLength$6(arguments.length,1);var t=isCallable$9(e)?e:Function$2(e),r=arraySlice$5(arguments,1);return queue$1[++counter]=function(){apply$4(t,void 0,r)},defer(counter),counter},clear$1=function(e){delete queue$1[e]},IS_NODE$7?defer=function(e){process$4.nextTick(runner(e))}:Dispatch&&Dispatch.now?defer=function(e){Dispatch.now(runner(e))}:MessageChannel&&!IS_IOS$1?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=bind$9(port.postMessage,port)):global$q.addEventListener&&isCallable$9(global$q.postMessage)&&!global$q.importScripts&&$location&&"file:"!==$location.protocol&&!fails$t(post)?(defer=post,global$q.addEventListener("message",listener,!1)):defer=ONREADYSTATECHANGE in createElement("script")?function(e){html.appendChild(createElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(e)}}:function(e){setTimeout(runner(e),0)});var task$1={set:set,clear:clear$1},userAgent$3=engineUserAgent,global$p=global$T,engineIsIosPebble=/ipad|iphone|ipod/i.test(userAgent$3)&&void 0!==global$p.Pebble,userAgent$2=engineUserAgent,engineIsWebosWebkit=/web0s(?!.*chrome)/i.test(userAgent$2),global$o=global$T,bind$8=functionBindContext,getOwnPropertyDescriptor$3=objectGetOwnPropertyDescriptor.f,macrotask=task$1.set,IS_IOS=engineIsIos,IS_IOS_PEBBLE=engineIsIosPebble,IS_WEBOS_WEBKIT=engineIsWebosWebkit,IS_NODE$6=engineIsNode,MutationObserver$1=global$o.MutationObserver||global$o.WebKitMutationObserver,document$2=global$o.document,process$3=global$o.process,Promise$1=global$o.Promise,queueMicrotaskDescriptor=getOwnPropertyDescriptor$3(global$o,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value,flush,head,last,notify$1,toggle,node,promise,then;queueMicrotask||(flush=function(){var e,t;for(IS_NODE$6&&(e=process$3.domain)&&e.exit();head;){t=head.fn,head=head.next;try{t()}catch(error){throw head?notify$1():last=void 0,error}}last=void 0,e&&e.enter()},IS_IOS||IS_NODE$6||IS_WEBOS_WEBKIT||!MutationObserver$1||!document$2?!IS_IOS_PEBBLE&&Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),promise.constructor=Promise$1,then=bind$8(promise.then,promise),notify$1=function(){then(flush)}):IS_NODE$6?notify$1=function(){process$3.nextTick(flush)}:(macrotask=bind$8(macrotask,global$o),notify$1=function(){macrotask(flush)}):(toggle=!0,node=document$2.createTextNode(""),new MutationObserver$1(flush).observe(node,{characterData:!0}),notify$1=function(){node.data=toggle=!toggle}));var microtask$1=queueMicrotask||function(e){var t={fn:e,next:void 0};last&&(last.next=t),head||(head=t,notify$1()),last=t},global$n=global$T,hostReportErrors$1=function(e,t){var r=global$n.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},perform$3=function(e){try{return{error:!1,value:e()}}catch(error){return{error:!0,value:error}}},Queue$1=function(){this.head=null,this.tail=null};Queue$1.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var queue=Queue$1,global$m=global$T,promiseNativeConstructor=global$m.Promise,engineIsDeno="object"==("undefined"==typeof Deno?"undefined":_typeof$b(Deno))&&Deno&&"object"==_typeof$b(Deno.version),IS_DENO$1=engineIsDeno,IS_NODE$5=engineIsNode,engineIsBrowser=!IS_DENO$1&&!IS_NODE$5&&"object"==("undefined"==typeof window?"undefined":_typeof$b(window))&&"object"==("undefined"==typeof document?"undefined":_typeof$b(document)),global$l=global$T,NativePromiseConstructor$4=promiseNativeConstructor,isCallable$8=isCallable$v,isForced$1=isForced_1,inspectSource=inspectSource$3,wellKnownSymbol$7=wellKnownSymbol$t,IS_BROWSER=engineIsBrowser,IS_DENO=engineIsDeno,V8_VERSION=engineV8Version;NativePromiseConstructor$4&&NativePromiseConstructor$4.prototype;var SPECIES$1=wellKnownSymbol$7("species"),SUBCLASSING=!1,NATIVE_PROMISE_REJECTION_EVENT$1=isCallable$8(global$l.PromiseRejectionEvent),FORCED_PROMISE_CONSTRUCTOR$5=isForced$1("Promise",(function(){var e=inspectSource(NativePromiseConstructor$4),t=e!==String(NativePromiseConstructor$4);if(!t&&66===V8_VERSION)return!0;if(!V8_VERSION||V8_VERSION<51||!/native code/.test(e)){var r=new NativePromiseConstructor$4((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[SPECIES$1]=n,!(SUBCLASSING=r.then((function(){}))instanceof n))return!0}return!t&&(IS_BROWSER||IS_DENO)&&!NATIVE_PROMISE_REJECTION_EVENT$1})),promiseConstructorDetection={CONSTRUCTOR:FORCED_PROMISE_CONSTRUCTOR$5,REJECTION_EVENT:NATIVE_PROMISE_REJECTION_EVENT$1,SUBCLASSING:SUBCLASSING},newPromiseCapability$2={},aCallable$6=aCallable$e,$TypeError$1=TypeError,PromiseCapability=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw $TypeError$1("Bad Promise constructor");t=e,r=n})),this.resolve=aCallable$6(t),this.reject=aCallable$6(r)};newPromiseCapability$2.f=function(e){return new PromiseCapability(e)};var $$1j=_export,IS_NODE$4=engineIsNode,global$k=global$T,call$d=functionCall,defineBuiltIn$b=defineBuiltIn$m,setPrototypeOf$2=objectSetPrototypeOf,setToStringTag$8=setToStringTag$c,setSpecies=setSpecies$3,aCallable$5=aCallable$e,isCallable$7=isCallable$v,isObject$g=isObject$w,anInstance$6=anInstance$9,speciesConstructor$2=speciesConstructor$5,task=task$1.set,microtask=microtask$1,hostReportErrors=hostReportErrors$1,perform$2=perform$3,Queue=queue,InternalStateModule$6=internalState,NativePromiseConstructor$3=promiseNativeConstructor,PromiseConstructorDetection=promiseConstructorDetection,newPromiseCapabilityModule$3=newPromiseCapability$2,PROMISE="Promise",FORCED_PROMISE_CONSTRUCTOR$4=PromiseConstructorDetection.CONSTRUCTOR,NATIVE_PROMISE_REJECTION_EVENT=PromiseConstructorDetection.REJECTION_EVENT,NATIVE_PROMISE_SUBCLASSING=PromiseConstructorDetection.SUBCLASSING,getInternalPromiseState=InternalStateModule$6.getterFor(PROMISE),setInternalState$6=InternalStateModule$6.set,NativePromisePrototype$2=NativePromiseConstructor$3&&NativePromiseConstructor$3.prototype,PromiseConstructor=NativePromiseConstructor$3,PromisePrototype=NativePromisePrototype$2,TypeError$5=global$k.TypeError,document$1=global$k.document,process$2=global$k.process,newPromiseCapability$1=newPromiseCapabilityModule$3.f,newGenericPromiseCapability=newPromiseCapability$1,DISPATCH_EVENT=!!(document$1&&document$1.createEvent&&global$k.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,Internal,OwnPromiseCapability,PromiseWrapper,nativeThen,isThenable=function(e){var t;return!(!isObject$g(e)||!isCallable$7(t=e.then))&&t},callReaction=function(e,t){var r,n,i,a=t.value,o=t.state==FULFILLED,s=o?e.ok:e.fail,l=e.resolve,u=e.reject,c=e.domain;try{s?(o||(t.rejection===UNHANDLED&&onHandleUnhandled(t),t.rejection=HANDLED),!0===s?r=a:(c&&c.enter(),r=s(a),c&&(c.exit(),i=!0)),r===e.promise?u(TypeError$5("Promise-chain cycle")):(n=isThenable(r))?call$d(n,r,l,u):l(r)):u(a)}catch(error){c&&!i&&c.exit(),u(error)}},notify=function(e,t){e.notified||(e.notified=!0,microtask((function(){for(var r,n=e.reactions;r=n.get();)callReaction(r,e);e.notified=!1,t&&!e.rejection&&onUnhandled(e)})))},dispatchEvent=function(e,t,r){var n,i;DISPATCH_EVENT?((n=document$1.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),global$k.dispatchEvent(n)):n={promise:t,reason:r},!NATIVE_PROMISE_REJECTION_EVENT&&(i=global$k["on"+e])?i(n):e===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",r)},onUnhandled=function(e){call$d(task,global$k,(function(){var t,r=e.facade,n=e.value;if(isUnhandled(e)&&(t=perform$2((function(){IS_NODE$4?process$2.emit("unhandledRejection",n,r):dispatchEvent(UNHANDLED_REJECTION,r,n)})),e.rejection=IS_NODE$4||isUnhandled(e)?UNHANDLED:HANDLED,t.error))throw t.value}))},isUnhandled=function(e){return e.rejection!==HANDLED&&!e.parent},onHandleUnhandled=function(e){call$d(task,global$k,(function(){var t=e.facade;IS_NODE$4?process$2.emit("rejectionHandled",t):dispatchEvent(REJECTION_HANDLED,t,e.value)}))},bind$7=function(e,t,r){return function(n){e(t,n,r)}},internalReject=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=REJECTED,notify(e,!0))},internalResolve=function e(t,r,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===r)throw TypeError$5("Promise can't be resolved itself");var i=isThenable(r);i?microtask((function(){var n={done:!1};try{call$d(i,r,bind$7(e,n,t),bind$7(internalReject,n,t))}catch(error){internalReject(n,error,t)}})):(t.value=r,t.state=FULFILLED,notify(t,!1))}catch(error){internalReject({done:!1},error,t)}}};if(FORCED_PROMISE_CONSTRUCTOR$4&&(PromiseConstructor=function(e){anInstance$6(this,PromisePrototype),aCallable$5(e),call$d(Internal,this);var t=getInternalPromiseState(this);try{e(bind$7(internalResolve,t),bind$7(internalReject,t))}catch(error){internalReject(t,error)}},PromisePrototype=PromiseConstructor.prototype,Internal=function(e){setInternalState$6(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:new Queue,rejection:!1,state:PENDING,value:void 0})},Internal.prototype=defineBuiltIn$b(PromisePrototype,"then",(function(e,t){var r=getInternalPromiseState(this),n=newPromiseCapability$1(speciesConstructor$2(this,PromiseConstructor));return r.parent=!0,n.ok=!isCallable$7(e)||e,n.fail=isCallable$7(t)&&t,n.domain=IS_NODE$4?process$2.domain:void 0,r.state==PENDING?r.reactions.add(n):microtask((function(){callReaction(n,r)})),n.promise})),OwnPromiseCapability=function(){var e=new Internal,t=getInternalPromiseState(e);this.promise=e,this.resolve=bind$7(internalResolve,t),this.reject=bind$7(internalReject,t)},newPromiseCapabilityModule$3.f=newPromiseCapability$1=function(e){return e===PromiseConstructor||e===PromiseWrapper?new OwnPromiseCapability(e):newGenericPromiseCapability(e)},isCallable$7(NativePromiseConstructor$3)&&NativePromisePrototype$2!==Object.prototype)){nativeThen=NativePromisePrototype$2.then,NATIVE_PROMISE_SUBCLASSING||defineBuiltIn$b(NativePromisePrototype$2,"then",(function(e,t){var r=this;return new PromiseConstructor((function(e,t){call$d(nativeThen,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete NativePromisePrototype$2.constructor}catch(error){}setPrototypeOf$2&&setPrototypeOf$2(NativePromisePrototype$2,PromisePrototype)}$$1j({global:!0,constructor:!0,wrap:!0,forced:FORCED_PROMISE_CONSTRUCTOR$4},{Promise:PromiseConstructor}),setToStringTag$8(PromiseConstructor,PROMISE,!1),setSpecies(PROMISE);var call$c=functionCall,anObject$d=anObject$r,getMethod$2=getMethod$6,iteratorClose$2=function(e,t,r){var n,i;anObject$d(e);try{if(!(n=getMethod$2(e,"return"))){if("throw"===t)throw r;return r}n=call$c(n,e)}catch(error){i=!0,n=error}if("throw"===t)throw r;if(i)throw n;return anObject$d(n),r},bind$6=functionBindContext,call$b=functionCall,anObject$c=anObject$r,tryToString$1=tryToString$7,isArrayIteratorMethod$1=isArrayIteratorMethod$3,lengthOfArrayLike$9=lengthOfArrayLike$r,isPrototypeOf$4=objectIsPrototypeOf,getIterator$2=getIterator$4,getIteratorMethod$2=getIteratorMethod$5,iteratorClose$1=iteratorClose$2,$TypeError=TypeError,Result=function(e,t){this.stopped=e,this.result=t},ResultPrototype=Result.prototype,iterate$2=function(e,t,r){var n,i,a,o,s,l,u,c=r&&r.that,d=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),f=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),y=bind$6(t,c),m=function(e){return n&&iteratorClose$1(n,"normal",e),new Result(!0,e)},g=function(e){return d?(anObject$c(e),p?y(e[0],e[1],m):y(e[0],e[1])):p?y(e,m):y(e)};if(h)n=e.iterator;else if(f)n=e;else{if(!(i=getIteratorMethod$2(e)))throw $TypeError(tryToString$1(e)+" is not iterable");if(isArrayIteratorMethod$1(i)){for(a=0,o=lengthOfArrayLike$9(e);o>a;a++)if((s=g(e[a]))&&isPrototypeOf$4(ResultPrototype,s))return s;return new Result(!1)}n=getIterator$2(e,i)}for(l=h?e.next:n.next;!(u=call$b(l,n)).done;){try{s=g(u.value)}catch(error){iteratorClose$1(n,"throw",error)}if("object"==_typeof$b(s)&&s&&isPrototypeOf$4(ResultPrototype,s))return s}return new Result(!1)},NativePromiseConstructor$2=promiseNativeConstructor,checkCorrectnessOfIteration=checkCorrectnessOfIteration$2,FORCED_PROMISE_CONSTRUCTOR$3=promiseConstructorDetection.CONSTRUCTOR,promiseStaticsIncorrectIteration=FORCED_PROMISE_CONSTRUCTOR$3||!checkCorrectnessOfIteration((function(e){NativePromiseConstructor$2.all(e).then(void 0,(function(){}))})),$$1i=_export,call$a=functionCall,aCallable$4=aCallable$e,newPromiseCapabilityModule$2=newPromiseCapability$2,perform$1=perform$3,iterate$1=iterate$2,PROMISE_STATICS_INCORRECT_ITERATION$1=promiseStaticsIncorrectIteration;$$1i({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION$1},{all:function(e){var t=this,r=newPromiseCapabilityModule$2.f(t),n=r.resolve,i=r.reject,a=perform$1((function(){var r=aCallable$4(t.resolve),a=[],o=0,s=1;iterate$1(e,(function(e){var l=o++,u=!1;s++,call$a(r,t,e).then((function(e){u||(u=!0,a[l]=e,--s||n(a))}),i)})),--s||n(a)}));return a.error&&i(a.value),r.promise}});var $$1h=_export,FORCED_PROMISE_CONSTRUCTOR$2=promiseConstructorDetection.CONSTRUCTOR,NativePromiseConstructor$1=promiseNativeConstructor,getBuiltIn$h=getBuiltIn$p,isCallable$6=isCallable$v,defineBuiltIn$a=defineBuiltIn$m,NativePromisePrototype$1=NativePromiseConstructor$1&&NativePromiseConstructor$1.prototype;if($$1h({target:"Promise",proto:!0,forced:FORCED_PROMISE_CONSTRUCTOR$2,real:!0},{catch:function(e){return this.then(void 0,e)}}),isCallable$6(NativePromiseConstructor$1)){var method$1=getBuiltIn$h("Promise").prototype.catch;NativePromisePrototype$1.catch!==method$1&&defineBuiltIn$a(NativePromisePrototype$1,"catch",method$1,{unsafe:!0})}var $$1g=_export,call$9=functionCall,aCallable$3=aCallable$e,newPromiseCapabilityModule$1=newPromiseCapability$2,perform=perform$3,iterate=iterate$2,PROMISE_STATICS_INCORRECT_ITERATION=promiseStaticsIncorrectIteration;$$1g({target:"Promise",stat:!0,forced:PROMISE_STATICS_INCORRECT_ITERATION},{race:function(e){var t=this,r=newPromiseCapabilityModule$1.f(t),n=r.reject,i=perform((function(){var i=aCallable$3(t.resolve);iterate(e,(function(e){call$9(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var $$1f=_export,call$8=functionCall,newPromiseCapabilityModule=newPromiseCapability$2,FORCED_PROMISE_CONSTRUCTOR$1=promiseConstructorDetection.CONSTRUCTOR;$$1f({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR$1},{reject:function(e){var t=newPromiseCapabilityModule.f(this);return call$8(t.reject,void 0,e),t.promise}});var anObject$b=anObject$r,isObject$f=isObject$w,newPromiseCapability=newPromiseCapability$2,promiseResolve$2=function(e,t){if(anObject$b(e),isObject$f(t)&&t.constructor===e)return t;var r=newPromiseCapability.f(e);return(0,r.resolve)(t),r.promise},$$1e=_export,getBuiltIn$g=getBuiltIn$p,FORCED_PROMISE_CONSTRUCTOR=promiseConstructorDetection.CONSTRUCTOR,promiseResolve$1=promiseResolve$2;getBuiltIn$g("Promise"),$$1e({target:"Promise",stat:!0,forced:FORCED_PROMISE_CONSTRUCTOR},{resolve:function(e){return promiseResolve$1(this,e)}});var $$1d=_export,uncurryThis$B=functionUncurryThis,IndexedObject$1=indexedObject,toIndexedObject$6=toIndexedObject$f,arrayMethodIsStrict$7=arrayMethodIsStrict$b,nativeJoin=uncurryThis$B([].join),ES3_STRINGS=IndexedObject$1!=Object,STRICT_METHOD$7=arrayMethodIsStrict$7("join",",");$$1d({target:"Array",proto:!0,forced:ES3_STRINGS||!STRICT_METHOD$7},{join:function(e){return nativeJoin(toIndexedObject$6(this),void 0===e?",":e)}});for(var itoc$2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ctoi$3={},index$4=0;index$4<66;index$4++)ctoi$3[itoc$2.charAt(index$4)]=index$4;var base64Map$1={itoc:itoc$2,ctoi:ctoi$3},$$1c=_export,getBuiltIn$f=getBuiltIn$p,uncurryThis$A=functionUncurryThis,fails$s=fails$13,toString$p=toString$w,hasOwn$f=hasOwnProperty_1,validateArgumentsLength$5=validateArgumentsLength$8,ctoi$2=base64Map$1.ctoi,disallowed$1=/[^\d+/a-z]/i,whitespaces$8=/[\t\n\f\r ]+/g,finalEq$1=/[=]+$/,$atob$1=getBuiltIn$f("atob"),fromCharCode$3=String.fromCharCode,charAt$a=uncurryThis$A("".charAt),replace$9=uncurryThis$A("".replace),exec$8=uncurryThis$A(disallowed$1.exec),NO_SPACES_IGNORE$1=fails$s((function(){return""!==$atob$1(" ")})),NO_ENCODING_CHECK$1=!fails$s((function(){$atob$1("a")})),NO_ARG_RECEIVING_CHECK$2=!NO_SPACES_IGNORE$1&&!NO_ENCODING_CHECK$1&&!fails$s((function(){$atob$1()})),WRONG_ARITY$2=!NO_SPACES_IGNORE$1&&!NO_ENCODING_CHECK$1&&1!==$atob$1.length;$$1c({global:!0,enumerable:!0,forced:NO_SPACES_IGNORE$1||NO_ENCODING_CHECK$1||NO_ARG_RECEIVING_CHECK$2||WRONG_ARITY$2},{atob:function(e){if(validateArgumentsLength$5(arguments.length,1),NO_ARG_RECEIVING_CHECK$2||WRONG_ARITY$2)return $atob$1(e);var t,r,n=replace$9(toString$p(e),whitespaces$8,""),i="",a=0,o=0;if(n.length%4==0&&(n=replace$9(n,finalEq$1,"")),n.length%4==1||exec$8(disallowed$1,n))throw new(getBuiltIn$f("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;t=charAt$a(n,a++);)hasOwn$f(ctoi$2,t)&&(r=o%4?64*r+ctoi$2[t]:ctoi$2[t],o++%4&&(i+=fromCharCode$3(255&r>>(-2*o&6))));return i}});var IS_NODE$3=engineIsNode,tryNodeRequire$3=function(e){try{if(IS_NODE$3)return Function('return require("'+e+'")')()}catch(error){}},makeBuiltIn=makeBuiltIn$3.exports,defineProperty$9=objectDefineProperty,defineBuiltInAccessor$4=function(e,t,r){return r.get&&makeBuiltIn(r.get,t,{getter:!0}),r.set&&makeBuiltIn(r.set,t,{setter:!0}),defineProperty$9.f(e,t,r)},domExceptionConstants$1={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}},$$1b=_export,tryNodeRequire$2=tryNodeRequire$3,getBuiltIn$e=getBuiltIn$p,fails$r=fails$13,create$5=objectCreate$1,createPropertyDescriptor$6=createPropertyDescriptor$d,defineProperty$8=objectDefineProperty.f,defineBuiltIn$9=defineBuiltIn$m,defineBuiltInAccessor$3=defineBuiltInAccessor$4,hasOwn$e=hasOwnProperty_1,anInstance$5=anInstance$9,anObject$a=anObject$r,errorToString$3=errorToString$5,normalizeStringArgument$6=normalizeStringArgument$9,DOMExceptionConstants$3=domExceptionConstants$1,clearErrorStack$4=errorStackClear$1,InternalStateModule$5=internalState,DESCRIPTORS$i=descriptors,DOM_EXCEPTION$5="DOMException",DATA_CLONE_ERR$1="DATA_CLONE_ERR",Error$4=getBuiltIn$e("Error"),NativeDOMException$3=getBuiltIn$e(DOM_EXCEPTION$5)||function(){try{(new(getBuiltIn$e("MessageChannel")||tryNodeRequire$2("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(error){if(error.name==DATA_CLONE_ERR$1&&25==error.code)return error.constructor}}(),NativeDOMExceptionPrototype$1=NativeDOMException$3&&NativeDOMException$3.prototype,ErrorPrototype$2=Error$4.prototype,setInternalState$5=InternalStateModule$5.set,getInternalState$3=InternalStateModule$5.getterFor(DOM_EXCEPTION$5),HAS_STACK$1="stack"in Error$4(DOM_EXCEPTION$5),codeFor$1=function(e){return hasOwn$e(DOMExceptionConstants$3,e)&&DOMExceptionConstants$3[e].m?DOMExceptionConstants$3[e].c:0},$DOMException$3=function(){anInstance$5(this,DOMExceptionPrototype$3);var e=arguments.length,t=normalizeStringArgument$6(e<1?void 0:arguments[0]),r=normalizeStringArgument$6(e<2?void 0:arguments[1],"Error"),n=codeFor$1(r);if(setInternalState$5(this,{type:DOM_EXCEPTION$5,name:r,message:t,code:n}),DESCRIPTORS$i||(this.name=r,this.message=t,this.code=n),HAS_STACK$1){var i=Error$4(t);i.name=DOM_EXCEPTION$5,defineProperty$8(this,"stack",createPropertyDescriptor$6(1,clearErrorStack$4(i.stack,1)))}},DOMExceptionPrototype$3=$DOMException$3.prototype=create$5(ErrorPrototype$2),createGetterDescriptor$1=function(e){return{enumerable:!0,configurable:!0,get:e}},getterFor$1=function(e){return createGetterDescriptor$1((function(){return getInternalState$3(this)[e]}))};DESCRIPTORS$i&&(defineBuiltInAccessor$3(DOMExceptionPrototype$3,"code",getterFor$1("code")),defineBuiltInAccessor$3(DOMExceptionPrototype$3,"message",getterFor$1("message")),defineBuiltInAccessor$3(DOMExceptionPrototype$3,"name",getterFor$1("name"))),defineProperty$8(DOMExceptionPrototype$3,"constructor",createPropertyDescriptor$6(1,$DOMException$3));var INCORRECT_CONSTRUCTOR$1=fails$r((function(){return!(new NativeDOMException$3 instanceof Error$4)})),INCORRECT_TO_STRING$2=INCORRECT_CONSTRUCTOR$1||fails$r((function(){return ErrorPrototype$2.toString!==errorToString$3||"2: 1"!==String(new NativeDOMException$3(1,2))})),INCORRECT_CODE$1=INCORRECT_CONSTRUCTOR$1||fails$r((function(){return 25!==new NativeDOMException$3(1,"DataCloneError").code}));INCORRECT_CONSTRUCTOR$1||25!==NativeDOMException$3[DATA_CLONE_ERR$1]||NativeDOMExceptionPrototype$1[DATA_CLONE_ERR$1];var FORCED_CONSTRUCTOR$3=INCORRECT_CONSTRUCTOR$1;$$1b({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR$3},{DOMException:FORCED_CONSTRUCTOR$3?$DOMException$3:NativeDOMException$3});var PolyfilledDOMException$3=getBuiltIn$e(DOM_EXCEPTION$5),PolyfilledDOMExceptionPrototype$3=PolyfilledDOMException$3.prototype;for(var key$4 in INCORRECT_TO_STRING$2&&NativeDOMException$3===PolyfilledDOMException$3&&defineBuiltIn$9(PolyfilledDOMExceptionPrototype$3,"toString",errorToString$3),INCORRECT_CODE$1&&DESCRIPTORS$i&&NativeDOMException$3===PolyfilledDOMException$3&&defineBuiltInAccessor$3(PolyfilledDOMExceptionPrototype$3,"code",createGetterDescriptor$1((function(){return codeFor$1(anObject$a(this).name)}))),DOMExceptionConstants$3)if(hasOwn$e(DOMExceptionConstants$3,key$4)){var constant$3=DOMExceptionConstants$3[key$4],constantName$3=constant$3.s,descriptor$3=createPropertyDescriptor$6(6,constant$3.c);hasOwn$e(PolyfilledDOMException$3,constantName$3)||defineProperty$8(PolyfilledDOMException$3,constantName$3,descriptor$3),hasOwn$e(PolyfilledDOMExceptionPrototype$3,constantName$3)||defineProperty$8(PolyfilledDOMExceptionPrototype$3,constantName$3,descriptor$3)}var $$1a=_export,global$j=global$T,getBuiltIn$d=getBuiltIn$p,createPropertyDescriptor$5=createPropertyDescriptor$d,defineProperty$7=objectDefineProperty.f,hasOwn$d=hasOwnProperty_1,anInstance$4=anInstance$9,inheritIfRequired$3=inheritIfRequired$6,normalizeStringArgument$5=normalizeStringArgument$9,DOMExceptionConstants$2=domExceptionConstants$1,clearErrorStack$3=errorStackClear$1,DESCRIPTORS$h=descriptors,DOM_EXCEPTION$4="DOMException",Error$3=getBuiltIn$d("Error"),NativeDOMException$2=getBuiltIn$d(DOM_EXCEPTION$4),$DOMException$2=function(){anInstance$4(this,DOMExceptionPrototype$2);var e=arguments.length,t=normalizeStringArgument$5(e<1?void 0:arguments[0]),r=normalizeStringArgument$5(e<2?void 0:arguments[1],"Error"),n=new NativeDOMException$2(t,r),i=Error$3(t);return i.name=DOM_EXCEPTION$4,defineProperty$7(n,"stack",createPropertyDescriptor$5(1,clearErrorStack$3(i.stack,1))),inheritIfRequired$3(n,this,$DOMException$2),n},DOMExceptionPrototype$2=$DOMException$2.prototype=NativeDOMException$2.prototype,ERROR_HAS_STACK$1="stack"in Error$3(DOM_EXCEPTION$4),DOM_EXCEPTION_HAS_STACK$1="stack"in new NativeDOMException$2(1,2),descriptor$2=NativeDOMException$2&&DESCRIPTORS$h&&Object.getOwnPropertyDescriptor(global$j,DOM_EXCEPTION$4),BUGGY_DESCRIPTOR$1=!(!descriptor$2||descriptor$2.writable&&descriptor$2.configurable),FORCED_CONSTRUCTOR$2=ERROR_HAS_STACK$1&&!BUGGY_DESCRIPTOR$1&&!DOM_EXCEPTION_HAS_STACK$1;$$1a({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR$2},{DOMException:FORCED_CONSTRUCTOR$2?$DOMException$2:NativeDOMException$2});var PolyfilledDOMException$2=getBuiltIn$d(DOM_EXCEPTION$4),PolyfilledDOMExceptionPrototype$2=PolyfilledDOMException$2.prototype;if(PolyfilledDOMExceptionPrototype$2.constructor!==PolyfilledDOMException$2)for(var key$3 in defineProperty$7(PolyfilledDOMExceptionPrototype$2,"constructor",createPropertyDescriptor$5(1,PolyfilledDOMException$2)),DOMExceptionConstants$2)if(hasOwn$d(DOMExceptionConstants$2,key$3)){var constant$2=DOMExceptionConstants$2[key$3],constantName$2=constant$2.s;hasOwn$d(PolyfilledDOMException$2,constantName$2)||defineProperty$7(PolyfilledDOMException$2,constantName$2,createPropertyDescriptor$5(6,constant$2.c))}var getBuiltIn$c=getBuiltIn$p,setToStringTag$7=setToStringTag$c,DOM_EXCEPTION$3="DOMException";setToStringTag$7(getBuiltIn$c(DOM_EXCEPTION$3),DOM_EXCEPTION$3);var $$19=_export,isArray$3=isArray$7,isConstructor$1=isConstructor$4,isObject$e=isObject$w,toAbsoluteIndex$2=toAbsoluteIndex$9,lengthOfArrayLike$8=lengthOfArrayLike$r,toIndexedObject$5=toIndexedObject$f,createProperty$3=createProperty$6,wellKnownSymbol$6=wellKnownSymbol$t,arrayMethodHasSpeciesSupport$3=arrayMethodHasSpeciesSupport$5,nativeSlice=arraySlice$c,HAS_SPECIES_SUPPORT$3=arrayMethodHasSpeciesSupport$3("slice"),SPECIES=wellKnownSymbol$6("species"),$Array$2=Array,max$3=Math.max;$$19({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$3},{slice:function(e,t){var r,n,i,a=toIndexedObject$5(this),o=lengthOfArrayLike$8(a),s=toAbsoluteIndex$2(e,o),l=toAbsoluteIndex$2(void 0===t?o:t,o);if(isArray$3(a)&&(r=a.constructor,(isConstructor$1(r)&&(r===$Array$2||isArray$3(r.prototype))||isObject$e(r)&&null===(r=r[SPECIES]))&&(r=void 0),r===$Array$2||void 0===r))return nativeSlice(a,s,l);for(n=new(void 0===r?$Array$2:r)(max$3(l-s,0)),i=0;s<l;s++,i++)s in a&&createProperty$3(n,i,a[s]);return n.length=i,n}});var aw$1=(_scriptDir="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){var r,n=void 0!==(t=t||{})?t:{},i={};for(r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);if(n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var a="";if(document.currentScript&&(a=document.currentScript.src),_scriptDir&&(a=_scriptDir),a=0!==a.indexOf("blob:")?a.substr(0,a.lastIndexOf("/")+1):"","object"!==("undefined"==typeof window?"undefined":_typeof$8(window))&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var o,s=n.print||console.log.bind(console),l=n.printErr||console.warn.bind(console);for(r in i)i.hasOwnProperty(r)&&(n[r]=i[r]);function u(e){u.shown||(u.shown={}),u.shown[e]||(u.shown[e]=1,l(e))}i=null,n.arguments&&n.arguments,Object.getOwnPropertyDescriptor(n,"arguments")||Object.defineProperty(n,"arguments",{configurable:!0,get:function(){U("Module.arguments has been replaced with plain arguments_")}}),n.thisProgram&&n.thisProgram,Object.getOwnPropertyDescriptor(n,"thisProgram")||Object.defineProperty(n,"thisProgram",{configurable:!0,get:function(){U("Module.thisProgram has been replaced with plain thisProgram")}}),n.quit&&n.quit,Object.getOwnPropertyDescriptor(n,"quit")||Object.defineProperty(n,"quit",{configurable:!0,get:function(){U("Module.quit has been replaced with plain quit_")}}),p(void 0===n.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),p(void 0===n.read,"Module.read option was removed (modify read_ in JS)"),p(void 0===n.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),p(void 0===n.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),p(void 0===n.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),Object.getOwnPropertyDescriptor(n,"read")||Object.defineProperty(n,"read",{configurable:!0,get:function(){U("Module.read has been replaced with plain read_")}}),Object.getOwnPropertyDescriptor(n,"readAsync")||Object.defineProperty(n,"readAsync",{configurable:!0,get:function(){U("Module.readAsync has been replaced with plain readAsync")}}),Object.getOwnPropertyDescriptor(n,"readBinary")||Object.defineProperty(n,"readBinary",{configurable:!0,get:function(){U("Module.readBinary has been replaced with plain readBinary")}}),ue=function(){U("cannot use the stack before compiled code is ready to run, and has provided stack access")},n.wasmBinary&&(o=n.wasmBinary),Object.getOwnPropertyDescriptor(n,"wasmBinary")||Object.defineProperty(n,"wasmBinary",{configurable:!0,get:function(){U("Module.wasmBinary has been replaced with plain wasmBinary")}}),n.noExitRuntime&&n.noExitRuntime,Object.getOwnPropertyDescriptor(n,"noExitRuntime")||Object.defineProperty(n,"noExitRuntime",{configurable:!0,get:function(){U("Module.noExitRuntime has been replaced with plain noExitRuntime")}});var c,d={Memory:function(e){return{buffer:new ArrayBuffer(65536*e.initial),grow:function(e){var t=this.buffer,r=de(e);return p(this.buffer!==t),r}}},Table:function(e){var t=new Array(e.initial);return t.grow=function(e){t.length>=1&&U("Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."),t.push(null)},t.set=function(e,r){t[e]=r},t.get=function(e){return t[e]},t},Module:function(e){return{}},Instance:function(e,t){var r;return{exports:(r=h,function(e,t,n){var i=t.memory,a=r,o=new e.Int8Array(n);new e.Int16Array(n);var s=new e.Int32Array(n),l=new e.Uint8Array(n);new e.Uint16Array(n);var u=new e.Uint32Array(n);new e.Float32Array(n),new e.Float64Array(n);var c=e.Math.imul;e.Math.fround,e.Math.abs,e.Math.clz32,e.Math.min,e.Math.max,e.Math.floor,e.Math.ceil,e.Math.sqrt,t.abort,e.NaN,e.Infinity;var d=t.emscripten_memcpy_big,h=t.emscripten_resize_heap,f=t.__unlock,p=t.__lock,y=9744;function m(e){var t,r=0;return t=T(),(e=(r=s[388])+e|0)>>>0<=t<<16>>>0||h(0|e)?(s[388]=e,r):(s[256]=48,-1)}function g(e){var t,r=0,n=0,i=0,a=0,o=0,c=0,d=0,h=0,f=0,p=0,g=0,v=0;y=t=y-16|0;e:{t:{r:{n:{i:{a:{o:{s:{l:{u:{c:{if((e|=0)>>>0<=244){if(3&(r=(o=s[261])>>>(e=(c=e>>>0<11?16:e+11&-8)>>>3))){e=(r=s[1092+(a=(n=e+(1&(-1^r))|0)<<3)>>2])+8|0,(0|(i=s[r+8>>2]))!=(0|(a=a+1084|0))?(s[i+12>>2]=a,s[a+8>>2]=i):(g=1044,v=E(n)&o,s[g>>2]=v),n<<=3,s[r+4>>2]=3|n,s[4+(r=r+n|0)>>2]=1|s[r+4>>2];break e}if(c>>>0<=(h=s[263])>>>0)break c;if(r){n=r=(e=(0-(e=(0-(n=2<<e)|n)&r<<e)&e)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1092+(i=(n=((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)|0)<<3)>>2],(0|(e=s[r+8>>2]))!=(0|(i=i+1084|0))?(s[e+12>>2]=i,s[i+8>>2]=e):(o=E(n)&o,s[261]=o),e=r+8|0,s[r+4>>2]=3|c,a=(n<<=3)-c|0,s[4+(d=r+c|0)>>2]=1|a,s[r+n>>2]=a,h&&(r=1084+((n=h>>>3)<<3)|0,i=s[266],(n=1<<n)&o?n=s[r+8>>2]:(s[261]=n|o,n=r),s[r+8>>2]=i,s[n+12>>2]=i,s[i+12>>2]=r,s[i+8>>2]=n),s[266]=d,s[263]=a;break e}if(!(p=s[262]))break c;for(n=r=(e=(p&0-p)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1348+(((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2],i=(-8&s[r+4>>2])-c|0,n=r;(e=s[n+16>>2])||(e=s[n+20>>2]);)i=(n=(a=(-8&s[e+4>>2])-c|0)>>>0<i>>>0)?a:i,r=n?e:r,n=e;if(f=s[r+24>>2],(0|(a=s[r+12>>2]))!=(0|r)){e=s[r+8>>2],s[e+12>>2]=a,s[a+8>>2]=e;break t}if(!(e=s[(n=r+20|0)>>2])){if(!(e=s[r+16>>2]))break u;n=r+16|0}for(;d=n,a=e,(e=s[(n=e+20|0)>>2])||(n=a+16|0,e=s[a+16>>2]););s[d>>2]=0;break t}if(c=-1,!(e>>>0>4294967231)&&(c=-8&(r=e+11|0),h=s[262])){n=0-c|0,o=0,(r>>>=8)&&(o=31,c>>>0>16777215||(o=28+((e=((o=(r<<=i=r+1048320>>>16&8)<<(e=r+520192>>>16&4))<<(r=o+245760>>>16&2)>>>15)-(r|e|i)|0)<<1|c>>>e+21&1)|0));d:{h:{if(i=s[1348+(o<<2)>>2])for(r=c<<(31==(0|o)?0:25-(o>>>1)|0),e=0;;){if(!((d=(-8&s[i+4>>2])-c|0)>>>0>=n>>>0||(a=i,n=d))){n=0,e=i;break h}if(d=s[i+20>>2],i=s[16+((r>>>29&4)+i|0)>>2],e=d?(0|d)==(0|i)?e:d:e,r<<=0!=(0|i),!i)break}else e=0;if(!(e|a)){if(!(e=(0-(e=2<<o)|e)&h))break c;i=r=(e=(e&0-e)-1|0)>>>12&16,i|=r=(e>>>=r)>>>5&8,i|=r=(e>>>=r)>>>2&4,e=s[1348+(((i|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2]}if(!e)break d}for(;n=(r=(i=(-8&s[e+4>>2])-c|0)>>>0<n>>>0)?i:n,a=r?e:a,e=(r=s[e+16>>2])||s[e+20>>2];);}if(!(!a|n>>>0>=s[263]-c>>>0)){if(d=s[a+24>>2],(0|a)!=(0|(r=s[a+12>>2]))){e=s[a+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;break r}if(!(e=s[(i=a+20|0)>>2])){if(!(e=s[a+16>>2]))break l;i=a+16|0}for(;o=i,r=e,(e=s[(i=e+20|0)>>2])||(i=r+16|0,e=s[r+16>>2]););s[o>>2]=0;break r}}}if((r=s[263])>>>0>=c>>>0){e=s[266],(n=r-c|0)>>>0>=16?(s[263]=n,i=e+c|0,s[266]=i,s[i+4>>2]=1|n,s[e+r>>2]=n,s[e+4>>2]=3|c):(s[266]=0,s[263]=0,s[e+4>>2]=3|r,s[4+(r=e+r|0)>>2]=1|s[r+4>>2]),e=e+8|0;break e}if((i=s[264])>>>0>c>>>0){r=i-c|0,s[264]=r,n=(e=s[267])+c|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|c,e=e+8|0;break e}if(e=0,n=a=c+47|0,s[379]?r=s[381]:(s[382]=-1,s[383]=-1,s[380]=4096,s[381]=4096,s[379]=t+12&-16^1431655768,s[384]=0,s[372]=0,r=4096),(n=(o=n+r|0)&(d=0-r|0))>>>0<=c>>>0)break e;if((r=s[371])&&(f=(h=s[369])+n|0)>>>0<=h>>>0|f>>>0>r>>>0)break e;if(4&l[1488])break a;c:{d:{if(r=s[267])for(e=1492;;){if((h=s[e>>2])+s[e+4>>2]>>>0>r>>>0&&h>>>0<=r>>>0)break d;if(!(e=s[e+8>>2]))break}if(-1==(0|(r=m(0))))break o;if(o=n,(i=(e=s[380])+-1|0)&r&&(o=(n-r|0)+(r+i&0-e)|0),o>>>0<=c>>>0|o>>>0>2147483646)break o;if((e=s[371])&&(d=(i=s[369])+o|0)>>>0<=i>>>0|d>>>0>e>>>0)break o;if((0|r)!=(0|(e=m(o))))break c;break i}if((o=d&o-i)>>>0>2147483646)break o;if((0|(r=m(o)))==(s[e>>2]+s[e+4>>2]|0))break s;e=r}if(r=e,!(c+48>>>0<=o>>>0|o>>>0>2147483646|-1==(0|e))){if((e=(e=s[381])+(a-o|0)&0-e)>>>0>2147483646)break i;if(-1!=(0|m(e))){o=e+o|0;break i}m(0-o|0);break o}if(-1!=(0|r))break i;break o}a=0;break t}r=0;break r}if(-1!=(0|r))break i}s[372]=4|s[372]}if(n>>>0>2147483646)break n;if((r=m(n))>>>0>=(e=m(0))>>>0|-1==(0|r)|-1==(0|e))break n;if((o=e-r|0)>>>0<=c+40>>>0)break n}e=s[369]+o|0,s[369]=e,e>>>0>u[370]&&(s[370]=e);i:{a:{o:{if(n=s[267]){for(e=1492;;){if(((i=s[e>>2])+(a=s[e+4>>2])|0)==(0|r))break o;if(!(e=s[e+8>>2]))break}break a}for(r>>>0>=(e=s[265])>>>0&&e||(s[265]=r),e=0,s[374]=o,s[373]=r,s[269]=-1,s[270]=s[379],s[376]=0;i=1084+(n=e<<3)|0,s[n+1092>>2]=i,s[n+1096>>2]=i,32!=(0|(e=e+1|0)););i=(e=o+-40|0)-(n=r+8&7?-8-r&7:0)|0,s[264]=i,n=r+n|0,s[267]=n,s[n+4>>2]=1|i,s[4+(e+r|0)>>2]=40,s[268]=s[383];break i}if(!(8&l[e+12|0]|r>>>0<=n>>>0|i>>>0>n>>>0)){s[e+4>>2]=a+o,r=(e=n+8&7?-8-n&7:0)+n|0,s[267]=r,e=(i=s[264]+o|0)-e|0,s[264]=e,s[r+4>>2]=1|e,s[4+(n+i|0)>>2]=40,s[268]=s[383];break i}}r>>>0<(a=s[265])>>>0&&(s[265]=r,a=0),i=r+o|0,e=1492;a:{o:{s:{l:{u:{c:{for(;;){if((0|i)!=s[e>>2]){if(e=s[e+8>>2])continue;break c}break}if(!(8&l[e+12|0]))break u}for(e=1492;;){if((i=s[e>>2])>>>0<=n>>>0&&(a=i+s[e+4>>2]|0)>>>0>n>>>0)break l;e=s[e+8>>2]}}if(s[e>>2]=r,s[e+4>>2]=s[e+4>>2]+o,s[4+(f=(r+8&7?-8-r&7:0)+r|0)>>2]=3|c,e=((r=i+(i+8&7?-8-i&7:0)|0)-f|0)-c|0,d=c+f|0,(0|r)==(0|n)){s[267]=d,e=s[264]+e|0,s[264]=e,s[d+4>>2]=1|e;break o}if(s[266]==(0|r)){s[266]=d,e=s[263]+e|0,s[263]=e,s[d+4>>2]=1|e,s[e+d>>2]=e;break o}if(1==(3&(n=s[r+4>>2]))){p=-8&n;u:if(n>>>0<=255){if(a=n>>>3,n=s[r+8>>2],(0|(i=s[r+12>>2]))==(0|n)){g=1044,v=s[261]&E(a),s[g>>2]=v;break u}s[n+12>>2]=i,s[i+8>>2]=n}else{if(h=s[r+24>>2],(0|(o=s[r+12>>2]))==(0|r))if((c=s[(i=r+20|0)>>2])||(c=s[(i=r+16|0)>>2])){for(;n=i,o=c,(c=s[(i=c+20|0)>>2])||(i=o+16|0,c=s[o+16>>2]););s[n>>2]=0}else o=0;else n=s[r+8>>2],s[n+12>>2]=o,s[o+8>>2]=n;if(h){n=s[r+28>>2];c:{if(s[(i=1348+(n<<2)|0)>>2]==(0|r)){if(s[i>>2]=o,o)break c;g=1048,v=s[262]&E(n),s[g>>2]=v;break u}if(s[h+(s[h+16>>2]==(0|r)?16:20)>>2]=o,!o)break u}s[o+24>>2]=h,(n=s[r+16>>2])&&(s[o+16>>2]=n,s[n+24>>2]=o),(n=s[r+20>>2])&&(s[o+20>>2]=n,s[n+24>>2]=o)}}r=r+p|0,e=e+p|0}if(s[r+4>>2]=-2&s[r+4>>2],s[d+4>>2]=1|e,s[e+d>>2]=e,e>>>0<=255){e=1084+((r=e>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=d,s[r+12>>2]=d,s[d+12>>2]=e,s[d+8>>2]=r;break o}if(r=0,(i=e>>>8)&&(r=31,e>>>0>16777215||(r=28+((r=((c=(i<<=a=i+1048320>>>16&8)<<(r=i+520192>>>16&4))<<(i=c+245760>>>16&2)>>>15)-(i|r|a)|0)<<1|e>>>r+21&1)|0)),s[(n=d)+28>>2]=r,s[d+16>>2]=0,s[d+20>>2]=0,n=1348+(r<<2)|0,(i=s[262])&(a=1<<r)){for(i=e<<(31==(0|r)?0:25-(r>>>1)|0),r=s[n>>2];;){if(n=r,(-8&s[r+4>>2])==(0|e))break s;if(r=i>>>29,i<<=1,!(r=s[16+(a=(4&r)+n|0)>>2]))break}s[a+16>>2]=d}else s[262]=i|a,s[n>>2]=d;s[d+24>>2]=n,s[d+12>>2]=d,s[d+8>>2]=d;break o}for(d=(e=o+-40|0)-(i=r+8&7?-8-r&7:0)|0,s[264]=d,i=r+i|0,s[267]=i,s[i+4>>2]=1|d,s[4+(e+r|0)>>2]=40,s[268]=s[383],s[(i=(e=(a+(a+-39&7?39-a&7:0)|0)-47|0)>>>0<n+16>>>0?n:e)+4>>2]=27,e=s[376],s[i+16>>2]=s[375],s[i+20>>2]=e,e=s[374],s[i+8>>2]=s[373],s[i+12>>2]=e,s[375]=i+8,s[374]=o,s[373]=r,s[376]=0,e=i+24|0;s[e+4>>2]=7,r=e+8|0,e=e+4|0,r>>>0<a>>>0;);if((0|n)==(0|i))break i;if(s[i+4>>2]=-2&s[i+4>>2],a=i-n|0,s[n+4>>2]=1|a,s[i>>2]=a,a>>>0<=255){e=1084+((r=a>>>3)<<3)|0,(i=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|i,r=e),s[e+8>>2]=n,s[r+12>>2]=n,s[n+12>>2]=e,s[n+8>>2]=r;break i}if(s[n+16>>2]=0,s[n+20>>2]=0,e=0,(i=a>>>8)&&(e=31,a>>>0>16777215||(e=28+((e=((d=(i<<=o=i+1048320>>>16&8)<<(e=i+520192>>>16&4))<<(i=d+245760>>>16&2)>>>15)-(i|e|o)|0)<<1|a>>>e+21&1)|0)),s[(r=n)+28>>2]=e,r=1348+(e<<2)|0,(i=s[262])&(o=1<<e)){for(e=a<<(31==(0|e)?0:25-(e>>>1)|0),r=s[r>>2];;){if(i=r,(0|a)==(-8&s[r+4>>2]))break a;if(r=e>>>29,e<<=1,!(r=s[16+(o=i+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+24>>2]=i}else s[262]=i|o,s[r>>2]=n,s[n+24>>2]=r;s[n+12>>2]=n,s[n+8>>2]=n;break i}e=s[n+8>>2],s[e+12>>2]=d,s[n+8>>2]=d,s[d+24>>2]=0,s[d+12>>2]=n,s[d+8>>2]=e}e=f+8|0;break e}e=s[i+8>>2],s[e+12>>2]=n,s[i+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=i,s[n+8>>2]=e}if(!((e=s[264])>>>0<=c>>>0)){r=e-c|0,s[264]=r,n=(e=s[267])+c|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|c,e=e+8|0;break e}}s[256]=48,e=0;break e}r:if(d){e=s[a+28>>2];n:{if(s[(i=1348+(e<<2)|0)>>2]==(0|a)){if(s[i>>2]=r,r)break n;h=E(e)&h,s[262]=h;break r}if(s[d+(s[d+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=d,(e=s[a+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[a+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}r:if(n>>>0<=15)e=n+c|0,s[a+4>>2]=3|e,s[4+(e=e+a|0)>>2]=1|s[e+4>>2];else if(s[a+4>>2]=3|c,s[4+(i=a+c|0)>>2]=1|n,s[n+i>>2]=n,n>>>0<=255)e=1084+((r=n>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=i,s[r+12>>2]=i,s[i+12>>2]=e,s[i+8>>2]=r;else{e=0,(c=n>>>8)&&(e=31,n>>>0>16777215||(e=28+((e=((d=(c<<=o=c+1048320>>>16&8)<<(e=c+520192>>>16&4))<<(c=d+245760>>>16&2)>>>15)-(c|e|o)|0)<<1|n>>>e+21&1)|0)),s[(r=i)+28>>2]=e,s[i+16>>2]=0,s[i+20>>2]=0,r=1348+(e<<2)|0;n:{if((c=1<<e)&h){for(e=n<<(31==(0|e)?0:25-(e>>>1)|0),c=s[r>>2];;){if((-8&s[(r=c)+4>>2])==(0|n))break n;if(c=e>>>29,e<<=1,!(c=s[16+(o=(4&c)+r|0)>>2]))break}s[o+16>>2]=i}else s[262]=c|h,s[r>>2]=i;s[i+24>>2]=r,s[i+12>>2]=i,s[i+8>>2]=i;break r}e=s[r+8>>2],s[e+12>>2]=i,s[r+8>>2]=i,s[i+24>>2]=0,s[i+12>>2]=r,s[i+8>>2]=e}e=a+8|0;break e}t:if(f){e=s[r+28>>2];r:{if(s[(n=1348+(e<<2)|0)>>2]==(0|r)){if(s[n>>2]=a,a)break r;g=1048,v=E(e)&p,s[g>>2]=v;break t}if(s[f+(s[f+16>>2]==(0|r)?16:20)>>2]=a,!a)break t}s[a+24>>2]=f,(e=s[r+16>>2])&&(s[a+16>>2]=e,s[e+24>>2]=a),(e=s[r+20>>2])&&(s[a+20>>2]=e,s[e+24>>2]=a)}i>>>0<=15?(e=i+c|0,s[r+4>>2]=3|e,s[4+(e=e+r|0)>>2]=1|s[e+4>>2]):(s[r+4>>2]=3|c,s[4+(c=r+c|0)>>2]=1|i,s[i+c>>2]=i,h&&(e=1084+((n=h>>>3)<<3)|0,a=s[266],(n=1<<n)&o?n=s[e+8>>2]:(s[261]=n|o,n=e),s[e+8>>2]=a,s[n+12>>2]=a,s[a+12>>2]=e,s[a+8>>2]=n),s[266]=c,s[263]=i),e=r+8|0}return y=t+16|0,0|e}function v(e){var t=0,r=0,n=0,i=0,a=0,o=0,l=0,c=0,d=0;e:if(e|=0){a=(n=e+-8|0)+(e=-8&(r=s[e+-4>>2]))|0;t:if(!(1&r)){if(!(3&r))break e;if((n=n-(r=s[n>>2])|0)>>>0<u[265])break e;if(e=e+r|0,s[266]==(0|n)){if(3==(3&(r=s[a+4>>2])))return s[263]=e,s[a+4>>2]=-2&r,s[n+4>>2]=1|e,void(s[e+n>>2]=e)}else{if(r>>>0<=255){if(i=s[n+8>>2],r>>>=3,(0|(t=s[n+12>>2]))==(0|i)){c=1044,d=s[261]&E(r),s[c>>2]=d;break t}s[i+12>>2]=t,s[t+8>>2]=i;break t}if(l=s[n+24>>2],(0|n)==(0|(r=s[n+12>>2])))if((t=s[(i=n+20|0)>>2])||(t=s[(i=n+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[n+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(!l)break t;i=s[n+28>>2];r:{if(s[(t=1348+(i<<2)|0)>>2]==(0|n)){if(s[t>>2]=r,r)break r;c=1048,d=s[262]&E(i),s[c>>2]=d;break t}if(s[l+(s[l+16>>2]==(0|n)?16:20)>>2]=r,!r)break t}if(s[r+24>>2]=l,(t=s[n+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),!(t=s[n+20>>2]))break t;s[r+20>>2]=t,s[t+24>>2]=r}}if(!(a>>>0<=n>>>0)&&1&(r=s[a+4>>2])){t:{if(!(2&r)){if(s[267]==(0|a)){if(s[267]=n,e=s[264]+e|0,s[264]=e,s[n+4>>2]=1|e,s[266]!=(0|n))break e;return s[263]=0,void(s[266]=0)}if(s[266]==(0|a))return s[266]=n,e=s[263]+e|0,s[263]=e,s[n+4>>2]=1|e,void(s[e+n>>2]=e);e=(-8&r)+e|0;r:if(r>>>0<=255){if(r>>>=3,(0|(t=s[a+8>>2]))==(0|(i=s[a+12>>2]))){c=1044,d=s[261]&E(r),s[c>>2]=d;break r}s[t+12>>2]=i,s[i+8>>2]=t}else{if(l=s[a+24>>2],(0|a)==(0|(r=s[a+12>>2])))if((t=s[(i=a+20|0)>>2])||(t=s[(i=a+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[a+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(l){i=s[a+28>>2];n:{if(s[(t=1348+(i<<2)|0)>>2]==(0|a)){if(s[t>>2]=r,r)break n;c=1048,d=s[262]&E(i),s[c>>2]=d;break r}if(s[l+(s[l+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=l,(t=s[a+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),(t=s[a+20>>2])&&(s[r+20>>2]=t,s[t+24>>2]=r)}}if(s[n+4>>2]=1|e,s[e+n>>2]=e,s[266]!=(0|n))break t;return void(s[263]=e)}s[a+4>>2]=-2&r,s[n+4>>2]=1|e,s[e+n>>2]=e}if(e>>>0<=255)return r=1084+((e>>>=3)<<3)|0,(t=s[261])&(e=1<<e)?e=s[r+8>>2]:(s[261]=e|t,e=r),s[r+8>>2]=n,s[e+12>>2]=n,s[n+12>>2]=r,void(s[n+8>>2]=e);s[n+16>>2]=0,s[n+20>>2]=0,t=0,(i=e>>>8)&&(t=31,e>>>0>16777215||(t=i,t<<=i=i+1048320>>>16&8,t=28+((t=((t<<=l=t+520192>>>16&4)<<(o=t+245760>>>16&2)>>>15)-(o|i|l)|0)<<1|e>>>t+21&1)|0)),s[(r=n)+28>>2]=t,o=1348+(t<<2)|0;t:if((i=s[262])&(r=1<<t)){i=e<<(31==(0|t)?0:25-(t>>>1)|0),r=s[o>>2];r:{for(;;){if(t=r,(-8&s[r+4>>2])==(0|e))break r;if(r=i>>>29,i<<=1,!(r=s[16+(o=t+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+12>>2]=n,s[n+24>>2]=t,s[n+8>>2]=n;break t}e=s[t+8>>2],s[e+12>>2]=n,s[t+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=t,s[n+8>>2]=e}else s[262]=r|i,s[o>>2]=n,s[n+12>>2]=n,s[n+24>>2]=o,s[n+8>>2]=n;if(e=s[269]+-1|0,s[269]=e,!e){for(n=1500;n=(e=s[n>>2])+8|0,e;);s[269]=-1}}}}function b(e){var t,r=0;return u[e+20>>2]<=u[e+28>>2]||(a[s[e+36>>2]](e,0,0),s[e+20>>2])?((r=s[e+4>>2])>>>0<(t=s[e+8>>2])>>>0&&(r=r-t|0,a[s[e+40>>2]](e,r,r>>31,1)),s[e+28>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,0):-1}function _(e){for(var t=0,r=0;r=t,e;)e&=e-1,t=t+1|0;return r}function E(e){var t;return(-1>>>(t=31&e)&-2)<<t|(-1<<(e=0-e&31)&-2)>>>e}function T(){return n.byteLength/65536|0}return{__wasm_call_ctors:function(){},malloc:g,openBox:function(e,t){e|=0,t|=0;var r,n,i,a=0;return y=r=y-16|0,s[r+12>>2]=0,s[r+8>>2]=0,s[r+4>>2]=0,s[r>>2]=0,function(e,t,r,n,i,a){var u=0,c=0,d=0,h=0,f=0,p=0;if(u=(l[e+2|0]^l[e+1|0]^l[0|e])<<24>>24,s[a>>2]=u+-48,u=47+(t-u|0)|0,s[n>>2]=u,f=r,p=g(u),s[f>>2]=p,c=s[a>>2],d=g(c),s[i>>2]=d,(0|c)>0)for(u=c;;){if(d=(c-u|0)+d|0,c=(t-c|0)+e|0,o[0|d]=l[(t-u|0)+e|0]^l[c+-1|0]^l[c+-2|0],(0|(u=u+-1|0))<1){u=s[n>>2];break}d=s[i>>2],c=s[a>>2]}if((0|u)>0)for(;t=s[r>>2]+h|0,h=h+1|0,o[0|t]=l[h+e|0],(0|h)<s[n>>2];);}(e,t,r+12|0,r+4|0,r+8|0,r),function(e,t){var r=0,n=0,i=0,a=0,s=0,u=0,c=0;if((0|t)>=1)for(i=85,a=250;n=_(r),s=l[0|(u=e+r|0)],c=n,n=1&r,o[0|u]=c+(21+((s^(n?i:a))<<24>>24)|0),a=n?a:s,i=n?s:i,(0|(r=r+1|0))!=(0|t););}(e=s[r+12>>2],t=s[r+4>>2]),n=function(e){var t=0;return(255&(t=e+-48|0))>>>0<=9?t<<24>>24:((e+-97&255)>>>0<26?e+-87|0:-1)<<24>>24}(o[0|e]),s[r>>2]=n,i=g(a=t-n|0),o[i+(a=a+-1|0)|0]=0,(0|a)>=1&&function(e,t,r){var n,i=0;if(r>>>0>=8192)d(0|e,0|t,0|r);else{n=e+r|0;e:if(3&(e^t))if(n>>>0<4)r=e;else if((i=n+-4|0)>>>0<e>>>0)r=e;else for(r=e;o[0|r]=l[0|t],o[r+1|0]=l[t+1|0],o[r+2|0]=l[t+2|0],o[r+3|0]=l[t+3|0],t=t+4|0,(r=r+4|0)>>>0<=i>>>0;);else{t:if((0|r)<1)r=e;else if(3&e)for(r=e;;){if(o[0|r]=l[0|t],t=t+1|0,(r=r+1|0)>>>0>=n>>>0)break t;if(!(3&r))break}else r=e;if(!((e=-4&n)>>>0<64||r>>>0>(i=e+-64|0)>>>0))for(;s[r>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],s[r+8>>2]=s[t+8>>2],s[r+12>>2]=s[t+12>>2],s[r+16>>2]=s[t+16>>2],s[r+20>>2]=s[t+20>>2],s[r+24>>2]=s[t+24>>2],s[r+28>>2]=s[t+28>>2],s[r+32>>2]=s[t+32>>2],s[r+36>>2]=s[t+36>>2],s[r+40>>2]=s[t+40>>2],s[r+44>>2]=s[t+44>>2],s[r+48>>2]=s[t+48>>2],s[r+52>>2]=s[t+52>>2],s[r+56>>2]=s[t+56>>2],s[r+60>>2]=s[t+60>>2],t=t- -64|0,(r=r- -64|0)>>>0<=i>>>0;);if(r>>>0>=e>>>0)break e;for(;s[r>>2]=s[t>>2],t=t+4|0,(r=r+4|0)>>>0<e>>>0;);}if(r>>>0<n>>>0)for(;o[0|r]=l[0|t],t=t+1|0,(0|n)!=(0|(r=r+1|0)););}}(i,e+1|0,t+(-1^n)|0),v(e),v(s[r+8>>2]),y=r+16|0,0|i},free:v,__errno_location:function(){return 1024},fflush:function e(t){var r=0;if(t|=0)return s[t+76>>2],0|b(t);if(s[260]&&(r=e(s[260])),p(1028),t=s[259])for(;u[t+20>>2]>u[t+28>>2]&&(r=b(t)|r),t=s[t+56>>2];);return f(1028),0|r},setThrew:function(e,t){e|=0,t|=0,s[385]||(s[386]=t,s[385]=e)},stackSave:function(){return 0|y},stackAlloc:function(e){return y=e=y-(e|=0)&-16,0|e},stackRestore:function(e){y=e|=0},__growWasmMemory:function(t){return 0|function(t){t|=0;var r=0|T(),a=r+t|0;if(r<a&&a<65536){var d=new ArrayBuffer(c(a,65536)),h=new e.Int8Array(d);h.set(o),o=h,o=new e.Int8Array(d),new e.Int16Array(d),s=new e.Int32Array(d),l=new e.Uint8Array(d),new e.Uint16Array(d),u=new e.Uint32Array(d),new e.Float32Array(d),new e.Float64Array(d),n=d,i.buffer=d}return r}(0|(t|=0))}}}({Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,Math:Math},K,c.buffer))}},instantiate:function(e,t){return{then:function(r,n){r({instance:new d.Instance(new d.Module(e,t))})}}},RuntimeError:Error};o=[],"object"!==_typeof$8(d)&&U("No WebAssembly support found. Build with -s WASM=0 to target JavaScript instead.");var h=new d.Table({initial:1,maximum:1,element:"anyfunc"}),f=!1;function p(e,t){e||U("Assertion failed: "+t)}var y,m,g,v,b,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function E(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;s>=2097152&&u("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to an UTF-8 string on the asm.js/wasm heap! (Valid unicode code points should be in range 0-0x1FFFFF)."),t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function T(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}function S(e,t){return e%t>0&&(e+=t-e%t),e}function $(e){y=e,n.HEAP8=m=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAP32=v=new Int32Array(e),n.HEAPU8=g=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=b=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var A=1712;p(!0,"stack must start aligned"),p(!0,"heap must start aligned");var w=8192;n.TOTAL_STACK&&p(w===n.TOTAL_STACK,"the stack size can no longer be determined at runtime");var k=n.TOTAL_MEMORY||65536;function I(){p(!0),b[429]=34821223,b[430]=2310721022,v[0]=1668509029}function C(){var e=b[429],t=b[430];34821223==e&&2310721022==t||U("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x02135467, but received 0x"+t.toString(16)+" "+e.toString(16)),1668509029!==v[0]&&U("Runtime error: The application has corrupted its heap memory area (address zero)!")}function P(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?n.dynCall_v(r):n.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}Object.getOwnPropertyDescriptor(n,"TOTAL_MEMORY")||Object.defineProperty(n,"TOTAL_MEMORY",{configurable:!0,get:function(){U("Module.TOTAL_MEMORY has been replaced with plain INITIAL_TOTAL_MEMORY")}}),p(k>=w,"TOTAL_MEMORY should be larger than TOTAL_STACK, was "+k+"! (TOTAL_STACK=8192)"),p("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&void 0!==Int32Array.prototype.subarray&&void 0!==Int32Array.prototype.set,"JS engine does not provide full typed array support"),(c=n.wasmMemory?n.wasmMemory:new d.Memory({initial:k/65536}))&&(y=c.buffer),p((k=y.byteLength)%65536==0),$(y),v[388]=9904,function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian!"}();var x=[],R=[],O=[],L=[],D=!1;p(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),p(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),p(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),p(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var M=0,N=null,G=null,V={};function U(t){throw n.onAbort&&n.onAbort(t),s(t+=""),l(t),f=!0,t="abort("+t+") at "+(i=function(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}(),n.extraStackTrace&&(i+="\n"+n.extraStackTrace()),r=/\b_Z[\w\d_]+/g,i.replace(r,(function(e){var t,r=(t=e,u("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),t);return e===r?e:r+" ["+e+"]"}))),new d.RuntimeError(t);var r,i}n.preloadedImages={},n.preloadedAudios={};var Z={error:function(){U("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with  -s FORCE_FILESYSTEM=1")},init:function(){Z.error()},createDataFile:function(){Z.error()},createPreloadedFile:function(){Z.error()},createLazyFile:function(){Z.error()},open:function(){Z.error()},mkdev:function(){Z.error()},registerDevice:function(){Z.error()},analyzePath:function(){Z.error()},loadFilesFromDB:function(){Z.error()},ErrnoError:function(){Z.error()}};n.FS_createDataFile=Z.createDataFile,n.FS_createPreloadedFile=Z.createPreloadedFile;var B="data:application/octet-stream;base64,";function F(e){return String.prototype.startsWith?e.startsWith(B):0===e.indexOf(B)}var j,W="aw.wasm";function X(){try{if(o)return new Uint8Array(o);var e=function(e){if(F(e))return function(e){try{for(var t=H(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(B.length))}(W);if(e)return e;throw"both async and sync fetching of the wasm failed"}catch(t){U(t)}}F(W)||(j=W,W=n.locateFile?n.locateFile(j,a):a+j),R.push({func:function(){se()}});var H="function"==typeof atob?atob:function(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(u++))<<2|(i=s.indexOf(e.charAt(u++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(u++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(r)),64!==o&&(l+=String.fromCharCode(n))}while(u<e.length);return l},K={__lock:function(){},__unlock:function(){},emscripten_memcpy_big:function(e,t,r){g.set(g.subarray(t,t+r),e)},emscripten_resize_heap:function(t){var r=m.length;p(t>r);var n=65536,i=2147418112;if(t>i)return l("Cannot enlarge memory, asked to go up to "+t+" bytes, but the limit is "+i+" bytes!"),!1;for(var a=Math.max(r,16777216);a<t;)(a=a<=536870912?S(2*a,n):Math.min(S((3*a+2147483648)/4,n),i))===r&&u("Cannot ask for more memory since we reached the practical limit in browsers (which is just below 2GB), so the request would have failed. Requesting only "+m.length);return function(t){try{return c.grow(t-y.byteLength+65535>>16),$(c.buffer),1}catch(e){console.error("emscripten_realloc_buffer: Attempted to grow heap from "+y.byteLength+" bytes to "+t+" bytes, but got error: "+e)}}(a)?(l("Warning: Enlarging memory arrays, this is not fast! "+[r,a]),!0):(l("Failed to grow the heap from "+r+" bytes to "+a+" bytes, not enough memory!"),!1)},memory:c,table:h},Y=function(){var t,r={env:K,wasi_unstable:K};function i(e,t){var r=e.exports;n.asm=r,function(e){if(M--,n.monitorRunDependencies&&n.monitorRunDependencies(M),e?(p(V[e]),delete V[e]):l("warning: run dependency removed without ID"),0==M&&(null!==N&&(clearInterval(N),N=null),G)){var t=G;G=null,t()}}("wasm-instantiate")}t="wasm-instantiate",M++,n.monitorRunDependencies&&n.monitorRunDependencies(M),t?(p(!V[t]),V[t]=1,null===N&&"undefined"!=typeof setInterval&&(N=setInterval((function(){if(f)return clearInterval(N),void(N=null);var e=!1;for(var t in V)e||(e=!0,l("still waiting on run dependencies:")),l("dependency: "+t);e&&l("(end of list)")}),1e4))):l("warning: run dependency added without ID");var a=n;function s(e){p(n===a,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),a=null,i(e.instance)}function u(e){return(o||"function"!=typeof fetch?new Promise((function(e,t){e(X())})):fetch(W,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+W+"'";return e.arrayBuffer()})).catch((function(){return X()}))).then((function(e){return d.instantiate(e,r)})).then(e,(function(e){l("failed to asynchronously prepare wasm: "+e),U(e)}))}if(n.instantiateWasm)try{return n.instantiateWasm(r,i)}catch(e){return l("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(o||"function"!=typeof d.instantiateStreaming||F(W)||"function"!=typeof fetch)return u(s);fetch(W,{credentials:"same-origin"}).then((function(e){return d.instantiateStreaming(e,r).then(s,(function(e){l("wasm streaming compile failed: "+e),l("falling back to ArrayBuffer instantiation"),u(s)}))}))}(),{}}(),z=Y.__wasm_call_ctors;Y.__wasm_call_ctors=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),z.apply(null,arguments)};var J=Y.malloc;Y.malloc=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),J.apply(null,arguments)};var Q=Y.openBox;Y.openBox=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),Q.apply(null,arguments)};var q=Y.free;Y.free=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),q.apply(null,arguments)};var ee=Y.__errno_location;Y.__errno_location=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ee.apply(null,arguments)};var te=Y.fflush;Y.fflush=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),te.apply(null,arguments)};var re=Y.setThrew;Y.setThrew=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),re.apply(null,arguments)};var ne=Y.stackSave;Y.stackSave=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ne.apply(null,arguments)};var ie=Y.stackAlloc;Y.stackAlloc=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ie.apply(null,arguments)};var ae=Y.stackRestore;Y.stackRestore=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ae.apply(null,arguments)};var oe=Y.__growWasmMemory;Y.__growWasmMemory=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),oe.apply(null,arguments)},n.asm=Y;var se=n.___wasm_call_ctors=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.__wasm_call_ctors.apply(null,arguments)},le=n._malloc=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.malloc.apply(null,arguments)};n._openBox=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.openBox.apply(null,arguments)},n._free=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.free.apply(null,arguments)},n.___errno_location=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.__errno_location.apply(null,arguments)},n._fflush=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.fflush.apply(null,arguments)},n._setThrew=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.setThrew.apply(null,arguments)};var ue=n.stackSave=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.stackSave.apply(null,arguments)};n.stackAlloc=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.stackAlloc.apply(null,arguments)},n.stackRestore=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.stackRestore.apply(null,arguments)};var ce,de=n.__growWasmMemory=function(){return p(D,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),p(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n.asm.__growWasmMemory.apply(null,arguments)};function he(e){function t(){ce||(ce=!0,f||(C(),p(!D),D=!0,P(R),C(),P(O),n.onRuntimeInitialized&&n.onRuntimeInitialized(),p(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(C(),n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),L.unshift(e);var e;P(L)}()))}M>0||(I(),function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),x.unshift(e);var e;P(x)}(),M>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),t()}),1)):t(),C()))}if(n.asm=Y,n.intArrayFromString=function(e,t,r){var n=r>0?r:T(e)+1,i=new Array(n),a=E(e,i,0,i.length);return t&&(i.length=a),i},Object.getOwnPropertyDescriptor(n,"intArrayToString")||(n.intArrayToString=function(){U("'intArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ccall")||(n.ccall=function(){U("'ccall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"cwrap")||(n.cwrap=function(){U("'cwrap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"setValue")||(n.setValue=function(){U("'setValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getValue")||(n.getValue=function(){U("'getValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"allocate")||(n.allocate=function(){U("'allocate' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getMemory")||(n.getMemory=function(){U("'getMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"AsciiToString")||(n.AsciiToString=function(){U("'AsciiToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToAscii")||(n.stringToAscii=function(){U("'stringToAscii' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF8ArrayToString")||(n.UTF8ArrayToString=function(){U("'UTF8ArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.UTF8ToString=function(e,t){return e?function(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&_)return _.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if(224==(240&o)?o=(15&o)<<12|s<<6|l:(240!=(248&o)&&u("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string on the asm.js/wasm heap to a JS string!"),o=(7&o)<<18|s<<12|l<<6|63&e[t++]),o<65536)a+=String.fromCharCode(o);else{var c=o-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}(g,e,t):""},Object.getOwnPropertyDescriptor(n,"stringToUTF8Array")||(n.stringToUTF8Array=function(){U("'stringToUTF8Array' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF8")||(n.stringToUTF8=function(){U("'stringToUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF8")||(n.lengthBytesUTF8=function(){U("'lengthBytesUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF16ToString")||(n.UTF16ToString=function(){U("'UTF16ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF16")||(n.stringToUTF16=function(){U("'stringToUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF16")||(n.lengthBytesUTF16=function(){U("'lengthBytesUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"UTF32ToString")||(n.UTF32ToString=function(){U("'UTF32ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stringToUTF32")||(n.stringToUTF32=function(){U("'stringToUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"lengthBytesUTF32")||(n.lengthBytesUTF32=function(){U("'lengthBytesUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.allocateUTF8=function(e){var t=T(e)+1,r=le(t);return r&&E(e,m,r,t),r},Object.getOwnPropertyDescriptor(n,"stackTrace")||(n.stackTrace=function(){U("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPreRun")||(n.addOnPreRun=function(){U("'addOnPreRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnInit")||(n.addOnInit=function(){U("'addOnInit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPreMain")||(n.addOnPreMain=function(){U("'addOnPreMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnExit")||(n.addOnExit=function(){U("'addOnExit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addOnPostRun")||(n.addOnPostRun=function(){U("'addOnPostRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeStringToMemory")||(n.writeStringToMemory=function(){U("'writeStringToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeArrayToMemory")||(n.writeArrayToMemory=function(){U("'writeArrayToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"writeAsciiToMemory")||(n.writeAsciiToMemory=function(){U("'writeAsciiToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addRunDependency")||(n.addRunDependency=function(){U("'addRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"removeRunDependency")||(n.removeRunDependency=function(){U("'removeRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"ENV")||(n.ENV=function(){U("'ENV' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"FS")||(n.FS=function(){U("'FS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"FS_createFolder")||(n.FS_createFolder=function(){U("'FS_createFolder' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createPath")||(n.FS_createPath=function(){U("'FS_createPath' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createDataFile")||(n.FS_createDataFile=function(){U("'FS_createDataFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createPreloadedFile")||(n.FS_createPreloadedFile=function(){U("'FS_createPreloadedFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createLazyFile")||(n.FS_createLazyFile=function(){U("'FS_createLazyFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createLink")||(n.FS_createLink=function(){U("'FS_createLink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_createDevice")||(n.FS_createDevice=function(){U("'FS_createDevice' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"FS_unlink")||(n.FS_unlink=function(){U("'FS_unlink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(n,"GL")||(n.GL=function(){U("'GL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"dynamicAlloc")||(n.dynamicAlloc=function(){U("'dynamicAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"loadDynamicLibrary")||(n.loadDynamicLibrary=function(){U("'loadDynamicLibrary' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"loadWebAssemblyModule")||(n.loadWebAssemblyModule=function(){U("'loadWebAssemblyModule' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getLEB")||(n.getLEB=function(){U("'getLEB' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getFunctionTables")||(n.getFunctionTables=function(){U("'getFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"alignFunctionTables")||(n.alignFunctionTables=function(){U("'alignFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"registerFunctions")||(n.registerFunctions=function(){U("'registerFunctions' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"addFunction")||(n.addFunction=function(){U("'addFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"removeFunction")||(n.removeFunction=function(){U("'removeFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getFuncWrapper")||(n.getFuncWrapper=function(){U("'getFuncWrapper' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"prettyPrint")||(n.prettyPrint=function(){U("'prettyPrint' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"makeBigInt")||(n.makeBigInt=function(){U("'makeBigInt' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"dynCall")||(n.dynCall=function(){U("'dynCall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getCompilerSetting")||(n.getCompilerSetting=function(){U("'getCompilerSetting' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackSave")||(n.stackSave=function(){U("'stackSave' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackRestore")||(n.stackRestore=function(){U("'stackRestore' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"stackAlloc")||(n.stackAlloc=function(){U("'stackAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"establishStackSpace")||(n.establishStackSpace=function(){U("'establishStackSpace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"print")||(n.print=function(){U("'print' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"printErr")||(n.printErr=function(){U("'printErr' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"getTempRet0")||(n.getTempRet0=function(){U("'getTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"setTempRet0")||(n.setTempRet0=function(){U("'setTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"callMain")||(n.callMain=function(){U("'callMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"abort")||(n.abort=function(){U("'abort' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.Pointer_stringify=function(e,t){U("this function has been removed - you should use UTF8ToString(ptr, maxBytesToRead) instead!")},Object.getOwnPropertyDescriptor(n,"warnOnce")||(n.warnOnce=function(){U("'warnOnce' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),n.writeStackCookie=I,n.checkStackCookie=C,n.abortStackOverflow=function(e){U("Stack overflow! Attempted to allocate "+e+" bytes on the stack, but stack has only "+(A-ue()+e)+" bytes available!")},Object.getOwnPropertyDescriptor(n,"intArrayFromBase64")||(n.intArrayFromBase64=function(){U("'intArrayFromBase64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"tryParseAsDataURI")||(n.tryParseAsDataURI=function(){U("'tryParseAsDataURI' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(n,"ALLOC_NORMAL")||Object.defineProperty(n,"ALLOC_NORMAL",{configurable:!0,get:function(){U("'ALLOC_NORMAL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_STACK")||Object.defineProperty(n,"ALLOC_STACK",{configurable:!0,get:function(){U("'ALLOC_STACK' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_DYNAMIC")||Object.defineProperty(n,"ALLOC_DYNAMIC",{configurable:!0,get:function(){U("'ALLOC_DYNAMIC' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"ALLOC_NONE")||Object.defineProperty(n,"ALLOC_NONE",{configurable:!0,get:function(){U("'ALLOC_NONE' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(n,"calledRun")||Object.defineProperty(n,"calledRun",{configurable:!0,get:function(){U("'calledRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}}),n.then=function(e){if(ce)e(n);else{var t=n.onRuntimeInitialized;n.onRuntimeInitialized=function(){t&&t(),e(n)}}return n},G=function e(){ce||he(),ce||(G=e)},n.run=he,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return he(),t}),_scriptDir,sameValue$1=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},call$7=functionCall,fixRegExpWellKnownSymbolLogic$1=fixRegexpWellKnownSymbolLogic,anObject$9=anObject$r,isNullOrUndefined$1=isNullOrUndefined$7,requireObjectCoercible$7=requireObjectCoercible$e,sameValue=sameValue$1,toString$o=toString$w,getMethod$1=getMethod$6,regExpExec$2=regexpExecAbstract;fixRegExpWellKnownSymbolLogic$1("search",(function(e,t,r){return[function(t){var r=requireObjectCoercible$7(this),n=isNullOrUndefined$1(t)?void 0:getMethod$1(t,e);return n?call$7(n,t,r):new RegExp(t)[e](toString$o(r))},function(e){var n=anObject$9(this),i=toString$o(e),a=r(t,n,i);if(a.done)return a.value;var o=n.lastIndex;sameValue(o,0)||(n.lastIndex=0);var s=regExpExec$2(n,i);return sameValue(n.lastIndex,o)||(n.lastIndex=o),null===s?-1:s.index}]}));var global$i=global$1v,apply$3=functionApply$1,isCallable$5=isCallable$Z,userAgent$1=engineUserAgent$1,arraySlice$4=arraySlice$n,validateArgumentsLength$4=validateArgumentsLength$c,MSIE=/MSIE .\./.test(userAgent$1),Function$1=global$i.Function,wrap$1=function(e){return MSIE?function(t,r){var n=validateArgumentsLength$4(arguments.length,1)>2,i=isCallable$5(t)?t:Function$1(t),a=n?arraySlice$4(arguments,2):void 0;return e(n?function(){apply$3(i,this,a)}:i,r)}:e},schedulersFix={setTimeout:wrap$1(global$i.setTimeout),setInterval:wrap$1(global$i.setInterval)},$$18=_export$1,global$h=global$1v,setInterval$1=schedulersFix.setInterval;$$18({global:!0,bind:!0,forced:global$h.setInterval!==setInterval$1},{setInterval:setInterval$1});var $$17=_export$1,global$g=global$1v,setTimeout$1=schedulersFix.setTimeout;function debounce$1(e,t,r){var n;return function(){var i=this,a=arguments,o=function(){n=null,r||e.apply(i,a)},s=r&&!n;clearTimeout(n),n=setTimeout(o,t),s&&e.apply(i,a)}}function _classCallCheck$b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$c(e,t,r){return t&&_defineProperties$c(e.prototype,t),r&&_defineProperties$c(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}$$17({global:!0,bind:!0,forced:global$g.setTimeout!==setTimeout$1},{setTimeout:setTimeout$1});var ProxyPromise$1=function(){function e(){var t,r;_classCallCheck$b(this,e);var n=new Promise((function(e,n){t=e,r=n}));return n.resolve=t,n.reject=r,n}return _createClass$c(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}(),$$16=_export$1,uncurryThis$z=functionUncurryThis$1,$Date$1=Date,thisTimeValue$2=uncurryThis$z($Date$1.prototype.getTime);$$16({target:"Date",stat:!0},{now:function(){return thisTimeValue$2(new $Date$1)}});var uncurryThis$y=functionUncurryThis$1,defineBuiltIn$8=defineBuiltIn$D,DatePrototype=Date.prototype,INVALID_DATE="Invalid Date",TO_STRING="toString",nativeDateToString=uncurryThis$y(DatePrototype[TO_STRING]),thisTimeValue$1=uncurryThis$y(DatePrototype.getTime);String(new Date(NaN))!=INVALID_DATE&&defineBuiltIn$8(DatePrototype,TO_STRING,(function(){var e=thisTimeValue$1(this);return e==e?nativeDateToString(this):INVALID_DATE}));var Raf=function(){function e(){_classCallCheck$b(this,e)}return _createClass$c(e,null,[{key:"install",value:function(){if(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame,!window.requestAnimationFrame){var e=Date.now();window.requestAnimationFrame=function(t){var r=Date.now(),n=Math.max(16.7-(r-e),0),i=setTimeout(t,n);return e=r+n,i}}window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}}]),e}(),uncurryThis$x=functionUncurryThis$1,aCallable$2=aCallable$p,isObject$d=isObject$U,hasOwn$c=hasOwnProperty_1$1,arraySlice$3=arraySlice$n,NATIVE_BIND=functionBindNative$1,$Function=Function,concat$1=uncurryThis$x([].concat),join$3=uncurryThis$x([].join),factories={},construct=function(e,t,r){if(!hasOwn$c(factories,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";factories[t]=$Function("C,a","return new C("+join$3(n,",")+")")}return factories[t](e,r)},functionBind=NATIVE_BIND?$Function.bind:function(e){var t=aCallable$2(this),r=t.prototype,n=arraySlice$3(arguments,1),i=function(){var r=concat$1(n,arraySlice$3(arguments));return this instanceof i?construct(t,r.length,r):t.apply(e,r)};return isObject$d(r)&&(i.prototype=r),i},$$15=_export$1,bind$5=functionBind;$$15({target:"Function",proto:!0,forced:Function.bind!==bind$5},{bind:bind$5});var FpsDetection=function(){function e(){_classCallCheck$b(this,e),this.fps=0,this.isStoped=!0,this.ticks=[],this.isSupport=!0,this.maxFps=0,this.step=this._step.bind(this),this.rafId=null}return _createClass$c(e,[{key:"_step",value:function(e){var t=this.ticks;if(t.unshift(e),t.length>10){var r=t.pop();r&&(this.fps=Math.floor(1e4/(e-r)),this.updateFpsInfo())}this.isStoped||(this.rafId=window.requestAnimationFrame(this.step))}},{key:"updateFpsInfo",value:function(){this.fps>this.maxFps&&(this.maxFps=this.fps)}},{key:"start",value:function(){void 0!==window.requestAnimationFrame&&(this.isStoped=!1,this.rafId=window.requestAnimationFrame(this.step))}},{key:"stop",value:function(){window.cancelAnimationFrame(this.rafId),this.isStoped=!0}}],[{key:"install",value:function(){Raf.install()}}]),e}(),Xml2Json=function(){function e(){_classCallCheck$b(this,e)}return _createClass$c(e,null,[{key:"parse",value:function(t){var r=e.parseXmlString(t);return null!==r?e.parseDOMChildren(r):null}},{key:"parseXmlString",value:function(e){if(void 0===e)return null;var t,r=new window.DOMParser;try{(t=r.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(n){t=null}return t}},{key:"parseDOMChildren",value:function(t,r){if(t.nodeType===Node.DOCUMENT_NODE){for(var n={},i=t.childNodes,a=0;a<i.length;a++){var o=i[a];o.nodeType===Node.ELEMENT_NODE&&(n=e.parseDOMChildren(o))}return n}if(t.nodeType===Node.ELEMENT_NODE){for(var s={__cnt:0},l=[],u=t.childNodes,c=0;c<u.length;c++){var d=u[c],h=e.getNodeLocalName(d);if(d.nodeType!==Node.COMMENT_NODE){var f=r+"."+h;if(s.__cnt++,null==s[h]){var p=e.parseDOMChildren(d,f);if("#text"!==h||/[^\s]/.test(p)){var y={};y[h]=p,l.push(y)}s[h]=p,e.toArrayAccessForm(s,h)}else{null!=s[h]&&(s[h]instanceof Array||(s[h]=[s[h]],e.toArrayAccessForm(s,h,f)));var m=e.parseDOMChildren(d,f);if("#text"!==h||/[^\s]/.test(m)){var g={};g[h]=m,l.push(g)}s[h][s[h].length]=m}}}for(var v=0;v<t.attributes.length;v++){var b=t.attributes[v];s.__cnt++;var _=b.value;s[b.name]=_}var E=t.prefix;return null!=E&&""!==E&&(s.__cnt++,s.__prefix=E),null!=s["#text"]&&(s.__text=s["#text"],s.__text instanceof Array&&(s.__text=s.__text.join("\n")),delete s["#text"],delete s["#text_asArray"]),null!=s["#cdata-section"]&&(s.__cdata=s["#cdata-section"],delete s["#cdata-section"],delete s["#cdata-section_asArray"]),1===s.__cnt&&null!=s.__text?s=s.__text:1===s.__cnt&&null!=s.__cdata&&(s=s.__cdata),delete s.__cnt,s}if(t.nodeType===Node.TEXT_NODE||t.nodeType===Node.CDATA_SECTION_NODE)return t.nodeValue}},{key:"getNodeLocalName",value:function(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!==t||(t=e.nodeName),t}},{key:"toArrayAccessForm",value:function(e,t){e[t]instanceof Array||(e[t]=[e[t]])}}]),e}(),es_arrayBuffer_slice={},$$14=_export$1,uncurryThis$w=functionUncurryThis$1,fails$q=fails$1Q,ArrayBufferModule$1=arrayBuffer$1,anObject$8=anObject$L,toAbsoluteIndex$1=toAbsoluteIndex$h,toLength$3=toLength$m,speciesConstructor$1=speciesConstructor$a,ArrayBuffer$1=ArrayBufferModule$1.ArrayBuffer,DataView$1=ArrayBufferModule$1.DataView,DataViewPrototype=DataView$1.prototype,nativeArrayBufferSlice=uncurryThis$w(ArrayBuffer$1.prototype.slice),getUint8=uncurryThis$w(DataViewPrototype.getUint8),setUint8=uncurryThis$w(DataViewPrototype.setUint8),INCORRECT_SLICE=fails$q((function(){return!new ArrayBuffer$1(2).slice(1,void 0).byteLength}));function isSupportRawCryptoCTR(){var e=new ProxyPromise$1,t=window.crypto||window.msCrypto;if(!t)return e.resolve(!1),e;var r=new Uint8Array(16),n=new Uint8Array([1]),i=null;try{t.subtle.generateKey({name:"AES-CTR",length:256},!1,["encrypt","decrypt"]).then((function(e){return i=e,t.subtle.encrypt({name:"AES-CTR",counter:r,length:128},e,n)})).then((function(e){return t.subtle.decrypt({name:"AES-CTR",counter:r,length:128},i,e)})).then((function(t){var r=new Uint8Array(t);e.resolve(r[0]===n[0])})).catch((function(){e.resolve(!1)}))}catch(error){e.resolve(!1)}return e}$$14({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:INCORRECT_SLICE},{slice:function(e,t){if(nativeArrayBufferSlice&&void 0===t)return nativeArrayBufferSlice(anObject$8(this),e);for(var r=anObject$8(this).byteLength,n=toAbsoluteIndex$1(e,r),i=toAbsoluteIndex$1(void 0===t?r:t,r),a=new(speciesConstructor$1(this,ArrayBuffer$1))(toLength$3(i-n)),o=new DataView$1(this),s=new DataView$1(a),l=0;n<i;)setUint8(s,l++,getUint8(o,n++));return a}});var $$13=_export$1,forEach$1=arrayForEach$1;$$13({target:"Array",proto:!0,forced:[].forEach!=forEach$1},{forEach:forEach$1});var IntervalTimer=function(){function e(){_classCallCheck$b(this,e),this.timeID=null,this.func=null}return _createClass$c(e,[{key:"repeat",value:function(e,t){this.timeID=1,this.repeatInterval(e,t)}},{key:"repeatInterval",value:function(e,t){var r=this;this.timeID&&(null===this.func&&(this.func=e),this.func===e&&(this.timeID&&clearTimeout(this.timeID),this.timeID=null,this.timeID=setTimeout((function(){e(),r.repeatInterval(e,t)}),t)))}},{key:"clear",value:function(){clearTimeout(this.timeID),this.timeID=null}}]),e}(),IntervalTimer$1=IntervalTimer,es_array_indexOf={},$$12=_export$1,uncurryThis$v=functionUncurryThis$1,$indexOf=arrayIncludes$1.indexOf,arrayMethodIsStrict$6=arrayMethodIsStrict$g,nativeIndexOf=uncurryThis$v([].indexOf),NEGATIVE_ZERO=!!nativeIndexOf&&1/nativeIndexOf([1],1,-0)<0,STRICT_METHOD$6=arrayMethodIsStrict$6("indexOf");$$12({target:"Array",proto:!0,forced:NEGATIVE_ZERO||!STRICT_METHOD$6},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return NEGATIVE_ZERO?nativeIndexOf(this,e,t)||0:$indexOf(this,e,t)}});var isSupport$3=_isLocalStorageUsable$2();function probeSupport$2(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function checkIfLocalStorageThrows$2(){var t="_localstorage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(e){return!0}}function _isLocalStorageUsable$2(){return probeSupport$2&&!checkIfLocalStorageThrows$2()}var proxyLocalStorage={length:isSupport$3?localStorage.length:0,clear:function(e){try{for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}catch(error){}},getItem:function(e){try{return localStorage.getItem(e)}catch(error){return null}},key:function(e){try{return localStorage.key(e)}catch(error){return null}},setItem:function(e,t){try{localStorage.setItem(e,t)}catch(error){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(error){}},isSupport:isSupport$3},proxyLocalStorage$1=proxyLocalStorage,LOGOPEN="undefined"!=typeof window&&(window.location.search.indexOf("log=true")>-1||!!proxyLocalStorage$1.getItem("abrdebug")||!!proxyLocalStorage$1.getItem("playerlog")),debug$2={},debugPrefix={log:"log",network:"network",abr:"abr",encrypt:"encrypt",segment:"segment",definition:"definition",content:"content",mse:"mse",media:"media",time:"time",preload:"preload",gap:"gap"};for(var item in debugPrefix)debug$2[item]=LOGOPEN?console.log.bind(window,"".concat(item,":")):function(){};var DEFAULT_PROGRESS_TIMER=1e3,DEFAULT_PRELOAD_TIME=50,DEFAULT_CHECK_BUFFER_TIME=10,DASH_BUFFER_BREAK=2e4,DASH_NO_INITSEGMENT=6e3,DASH_NO_CANPLAY=16e3,DEFAULT_END=1,SPPED_CACHE$1="danger_d_speed",MAX_TIMESTAMP=5e9,MIN_EXPIRE_INTERVAL=300,MONITOR_HEADERS$1={"x-cache":"x_cache","x-response-sinfo":"server_ip"},SIDX_EXCEPTION="sidx_exception",SEGMENT_SIZE_CONFIG={"360p":.45,"480p":.75,"720p":1.6,"1080p":5,"2k":7.5,"4k":12.5},PLAYER_START="player_start",WASM_START="wasm_start",WASM_READY="wasm_ready",INIT_FINISHED="init_finished",CORE_START="core_start",START_PLAY="start_play",ERROR_HANDLER="error_handler",ERROR_CATCHING="error_catching",ERROR_NO_MP4OPTS="error_no_mp4opts",ERROR_CATCH_FINISHED="error_catch_finished",NEXT_START="next_start",NEXT_FINISHED="next_finished",SEGMENT_STATE={NO_START:0,GOING:1,APPEND:2},MEDIA_CONTENT_ERR="media_exception",MP4_SOURCE_ERR="mp4_source_exception",TASK_REQUEST_EXPIRED="task_request_expired",CDM_LICENSE_ERROR="CDM_LICENSE_ERROR",CDM_LICENSE_SUCCESS="CDM_LICENSE_SUCCESS",MPD_SEEK_TYPE={NORMAL:0,SEEK:1,INIT:2},DASH_TYPE={MAIN:"0",BACK:"1"},CHANGE_STATES$2={INIT:"init",ERR:"error"},URL_DASH_TAG="currentDashType",TRANSFORM_IV=new Uint8Array([91,104,69,75,156,171,238,71,202,4,244,5]).buffer,$$11=_export,call$6=functionCall,isCallable$4=isCallable$v,anObject$7=anObject$r,toString$n=toString$w,DELEGATES_TO_EXEC=function(){var e=!1,t=/[ac]/;return t.exec=function(){return e=!0,/./.exec.apply(this,arguments)},!0===t.test("abc")&&e}(),nativeTest=/./.test;$$11({target:"RegExp",proto:!0,forced:!DELEGATES_TO_EXEC},{test:function(e){var t=anObject$7(this),r=toString$n(e),n=t.exec;if(!isCallable$4(n))return call$6(nativeTest,t,r);var i=call$6(n,t,r);return null!==i&&(anObject$7(i),!0)}});var ArrayBufferViewCore$5=arrayBufferViewCore,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$1=typedArrayConstructorsRequireWrappers,aTypedArrayConstructor$1=ArrayBufferViewCore$5.aTypedArrayConstructor,exportTypedArrayStaticMethod$1=ArrayBufferViewCore$5.exportTypedArrayStaticMethod;function checkIsMSBrowser(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),r=e.indexOf("Trident/");return t>0||r>0}function checkIsQQBrowser(){return window.navigator.userAgent.toLowerCase().indexOf("qqbrowser")>-1}function checkIsFirefoxBrowser(){var e=window.navigator.userAgent;return!(window.location.search.indexOf("firefox_dash=true")>-1||!!proxyLocalStorage$1.getItem("firefox_dash"))&&e.toLowerCase().indexOf("firefox")>-1}function checkIsSafariBrowser(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function checkIsChromeCoreBrowser(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1}function checkIsEdgeBrowser(){return navigator.userAgent.indexOf("Edge")>0||navigator.userAgent.indexOf("Edg/")>0}function checkIsIncompatibleBrowser(){var e=checkIsSafariBrowser(),t=checkIsMSBrowser(),r=checkIsFirefoxBrowser(),n=checkIsEdgeBrowser();return e||t||r||n}function checkWebAssemblySupport(){try{if("object"===("undefined"==typeof WebAssembly?"undefined":_typeof$8(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(e){console.log(e)}return!1}function checkMediaSourceSupport(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}exportTypedArrayStaticMethod$1("of",(function(){for(var e=0,t=arguments.length,r=new(aTypedArrayConstructor$1(this))(t);t>e;)r[e]=arguments[e++];return r}),TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS$1);var AV1MimeTypes=['video/mp4; codecs="av01.0.01M.08,mp4a.40.5"'];function isCodecSupported(e){if(!checkMediaSourceSupport())return!1;for(var t=0;t<e.length;t++){var r=e[t];if(MediaSource.isTypeSupported(r))return!0}return!1}function isAV1Supported(){return isCodecSupported(AV1MimeTypes)}function isEMESupported$1(){return!!navigator.requestMediaKeySystemAccess&&!checkIsIncompatibleBrowser()}function isSupported$1(){return checkWebAssemblySupport()&&checkMediaSourceSupport()&&!checkIsMSBrowser()}function isEncryptSupported(){return checkWebAssemblySupport()&&checkMediaSourceSupport()&&!checkIsMSBrowser()&&!checkIsQQBrowser()}function getDrmServerUrl(e){return new Promise((function(t,r){checkWebAssemblySupport()&&checkMediaSourceSupport()&&navigator.requestMediaKeySystemAccess||t(void 0);checkIsSafariBrowser();var n=checkIsChromeCoreBrowser(),i=checkIsEdgeBrowser();n&&!checkIsQQBrowser()?navigator.requestMediaKeySystemAccess("com.widevine.alpha",[{initDataTypes:["keyids","webm"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01e"'}]}]).then((function(r){t("https://".concat(e,"/video/drm/v1/widevine?aid=32&kid="))}),(function(){t(void 0)})):t(i?"https://".concat(e,"/video/drm/v1/playready?aid=32&kid="):void 0)}))}var isSupport$2=Object.freeze(Object.defineProperty({__proto__:null,AV1MimeTypes:AV1MimeTypes,checkWebAssemblySupport:checkWebAssemblySupport,getDrmServerUrl:getDrmServerUrl,isAV1Supported:isAV1Supported,isCodecSupported:isCodecSupported,isEMESupported:isEMESupported$1,isEncryptSupported:isEncryptSupported,isSupported:isSupported$1},Symbol.toStringTag,{value:"Module"})),whitespaces$7="\t\n\v\f\r \u2028\u2029\ufeff",uncurryThis$u=functionUncurryThis,requireObjectCoercible$6=requireObjectCoercible$e,toString$m=toString$w,whitespaces$6=whitespaces$7,replace$8=uncurryThis$u("".replace),whitespace="["+whitespaces$6+"]",ltrim=RegExp("^"+whitespace+whitespace+"*"),rtrim=RegExp(whitespace+whitespace+"*$"),createMethod$3=function(e){return function(t){var r=toString$m(requireObjectCoercible$6(t));return 1&e&&(r=replace$8(r,ltrim,"")),2&e&&(r=replace$8(r,rtrim,"")),r}},stringTrim={start:createMethod$3(1),end:createMethod$3(2),trim:createMethod$3(3)},global$f=global$T,fails$p=fails$13,uncurryThis$t=functionUncurryThis,toString$l=toString$w,trim$4=stringTrim.trim,whitespaces$5=whitespaces$7,$parseInt$3=global$f.parseInt,_Symbol$3=global$f.Symbol,ITERATOR$6=_Symbol$3&&_Symbol$3.iterator,hex$2=/^[+-]?0x/i,exec$7=uncurryThis$t(hex$2.exec),FORCED$c=8!==$parseInt$3(whitespaces$5+"08")||22!==$parseInt$3(whitespaces$5+"0x16")||ITERATOR$6&&!fails$p((function(){$parseInt$3(Object(ITERATOR$6))})),numberParseInt$1=FORCED$c?function(e,t){var r=trim$4(toString$l(e));return $parseInt$3(r,t>>>0||(exec$7(hex$2,r)?16:10))}:$parseInt$3,$$10=_export,$parseInt$2=numberParseInt$1;$$10({global:!0,forced:parseInt!=$parseInt$2},{parseInt:$parseInt$2});var $$$=_export,getBuiltIn$b=getBuiltIn$p,uncurryThis$s=functionUncurryThis,fails$o=fails$13,toString$k=toString$w,validateArgumentsLength$3=validateArgumentsLength$8,itoc$1=base64Map$1.itoc,$btoa=getBuiltIn$b("btoa"),charAt$9=uncurryThis$s("".charAt),charCodeAt$4=uncurryThis$s("".charCodeAt),NO_ARG_RECEIVING_CHECK$1=!!$btoa&&!fails$o((function(){$btoa()})),WRONG_ARG_CONVERSION=!!$btoa&&fails$o((function(){return"bnVsbA=="!==$btoa(null)})),WRONG_ARITY$1=!!$btoa&&1!==$btoa.length;$$$({global:!0,enumerable:!0,forced:NO_ARG_RECEIVING_CHECK$1||WRONG_ARG_CONVERSION||WRONG_ARITY$1},{btoa:function(e){if(validateArgumentsLength$3(arguments.length,1),NO_ARG_RECEIVING_CHECK$1||WRONG_ARG_CONVERSION||WRONG_ARITY$1)return $btoa(toString$k(e));for(var t,r,n=toString$k(e),i="",a=0,o=itoc$1;charAt$9(n,a)||(o="=",a%1);){if((r=charCodeAt$4(n,a+=3/4))>255)throw new(getBuiltIn$b("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");i+=charAt$9(o,63&(t=t<<8|r)>>8-a%1*8)}return i}});var $$_=_export,$filter=arrayIteration.filter,arrayMethodHasSpeciesSupport$2=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$2=arrayMethodHasSpeciesSupport$2("filter");$$_({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$2},{filter:function(e){return $filter(this,e,arguments.length>1?arguments[1]:void 0)}});var global$e=global$T,fails$n=fails$13,uncurryThis$r=functionUncurryThis,toString$j=toString$w,trim$3=stringTrim.trim,whitespaces$4=whitespaces$7,charAt$8=uncurryThis$r("".charAt),$parseFloat$3=global$e.parseFloat,_Symbol$2=global$e.Symbol,ITERATOR$5=_Symbol$2&&_Symbol$2.iterator,FORCED$b=1/$parseFloat$3(whitespaces$4+"-0")!=-1/0||ITERATOR$5&&!fails$n((function(){$parseFloat$3(Object(ITERATOR$5))})),numberParseFloat$1=FORCED$b?function(e){var t=trim$3(toString$j(e)),r=$parseFloat$3(t);return 0===r&&"-"==charAt$8(t,0)?-0:r}:$parseFloat$3,$$Z=_export,$parseFloat$2=numberParseFloat$1;$$Z({global:!0,forced:parseFloat!=$parseFloat$2},{parseFloat:$parseFloat$2});var uncurryThis$q=functionUncurryThis,thisNumberValue$2=uncurryThis$q(1..valueOf),DESCRIPTORS$g=descriptors,global$d=global$T,uncurryThis$p=functionUncurryThis,isForced=isForced_1,defineBuiltIn$7=defineBuiltIn$m,hasOwn$b=hasOwnProperty_1,inheritIfRequired$2=inheritIfRequired$6,isPrototypeOf$3=objectIsPrototypeOf,isSymbol$2=isSymbol$6,toPrimitive=toPrimitive$3,fails$m=fails$13,getOwnPropertyNames$1=objectGetOwnPropertyNames.f,getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f,defineProperty$6=objectDefineProperty.f,thisNumberValue$1=thisNumberValue$2,trim$2=stringTrim.trim,NUMBER="Number",NativeNumber=global$d[NUMBER],NumberPrototype=NativeNumber.prototype,TypeError$4=global$d.TypeError,arraySlice$2=uncurryThis$p("".slice),charCodeAt$3=uncurryThis$p("".charCodeAt),toNumeric=function(e){var t=toPrimitive(e,"number");return"bigint"==typeof t?t:toNumber(t)},toNumber=function(e){var t,r,n,i,a,o,s,l,u=toPrimitive(e,"number");if(isSymbol$2(u))throw TypeError$4("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=trim$2(u),43===(t=charCodeAt$3(u,0))||45===t){if(88===(r=charCodeAt$3(u,2))||120===r)return NaN}else if(48===t){switch(charCodeAt$3(u,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+u}for(o=(a=arraySlice$2(u,2)).length,s=0;s<o;s++)if((l=charCodeAt$3(a,s))<48||l>i)return NaN;return parseInt(a,n)}return+u};if(isForced(NUMBER,!NativeNumber(" 0o1")||!NativeNumber("0b1")||NativeNumber("+0x1"))){for(var NumberWrapper=function(e){var t=arguments.length<1?0:NativeNumber(toNumeric(e)),r=this;return isPrototypeOf$3(NumberPrototype,r)&&fails$m((function(){thisNumberValue$1(r)}))?inheritIfRequired$2(Object(t),r,NumberWrapper):t},keys$4=DESCRIPTORS$g?getOwnPropertyNames$1(NativeNumber):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),j=0,key$2;keys$4.length>j;j++)hasOwn$b(NativeNumber,key$2=keys$4[j])&&!hasOwn$b(NumberWrapper,key$2)&&defineProperty$6(NumberWrapper,key$2,getOwnPropertyDescriptor$2(NativeNumber,key$2));NumberWrapper.prototype=NumberPrototype,NumberPrototype.constructor=NumberWrapper,defineBuiltIn$7(global$d,NUMBER,NumberWrapper,{constructor:!0})}var $$Y=_export,uncurryThis$o=functionUncurryThis,toString$i=toString$w,fromCharCode$2=String.fromCharCode,charAt$7=uncurryThis$o("".charAt),exec$6=uncurryThis$o(/./.exec),stringSlice$7=uncurryThis$o("".slice),hex2=/^[\da-f]{2}$/i,hex4=/^[\da-f]{4}$/i;$$Y({global:!0},{unescape:function(e){for(var t,r,n=toString$i(e),i="",a=n.length,o=0;o<a;){if("%"===(t=charAt$7(n,o++)))if("u"===charAt$7(n,o)){if(r=stringSlice$7(n,o+1,o+5),exec$6(hex4,r)){i+=fromCharCode$2(parseInt(r,16)),o+=5;continue}}else if(r=stringSlice$7(n,o,o+2),exec$6(hex2,r)){i+=fromCharCode$2(parseInt(r,16)),o+=2;continue}i+=t}return i}});var toIntegerOrInfinity$5=toIntegerOrInfinity$i,toString$h=toString$w,requireObjectCoercible$5=requireObjectCoercible$e,$RangeError$3=RangeError,stringRepeat=function(e){var t=toString$h(requireObjectCoercible$5(this)),r="",n=toIntegerOrInfinity$5(e);if(n<0||n==1/0)throw $RangeError$3("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},$$X=_export,uncurryThis$n=functionUncurryThis,toIntegerOrInfinity$4=toIntegerOrInfinity$i,thisNumberValue=thisNumberValue$2,$repeat$1=stringRepeat,fails$l=fails$13,$RangeError$2=RangeError,$String=String,floor$3=Math.floor,repeat$3=uncurryThis$n($repeat$1),stringSlice$6=uncurryThis$n("".slice),nativeToFixed=uncurryThis$n(1..toFixed),pow$2=function e(t,r,n){return 0===r?n:r%2==1?e(t,r-1,n*t):e(t*t,r/2,n)},log$3=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t},multiply=function(e,t,r){for(var n=-1,i=r;++n<6;)i+=t*e[n],e[n]=i%1e7,i=floor$3(i/1e7)},divide=function(e,t){for(var r=6,n=0;--r>=0;)n+=e[r],e[r]=floor$3(n/t),n=n%t*1e7},dataToString=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var n=$String(e[t]);r=""===r?n:r+repeat$3("0",7-n.length)+n}return r},FORCED$a=fails$l((function(){return"0.000"!==nativeToFixed(8e-5,3)||"1"!==nativeToFixed(.9,0)||"1.25"!==nativeToFixed(1.255,2)||"1000000000000000128"!==nativeToFixed(0xde0b6b3a7640080,0)}))||!fails$l((function(){nativeToFixed({})}));$$X({target:"Number",proto:!0,forced:FORCED$a},{toFixed:function(e){var t,r,n,i,a=thisNumberValue(this),o=toIntegerOrInfinity$4(e),s=[0,0,0,0,0,0],l="",u="0";if(o<0||o>20)throw $RangeError$2("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return $String(a);if(a<0&&(l="-",a=-a),a>1e-21)if(r=(t=log$3(a*pow$2(2,69,1))-69)<0?a*pow$2(2,-t,1):a/pow$2(2,t,1),r*=4503599627370496,(t=52-t)>0){for(multiply(s,0,r),n=o;n>=7;)multiply(s,1e7,0),n-=7;for(multiply(s,pow$2(10,n,1),0),n=t-1;n>=23;)divide(s,1<<23),n-=23;divide(s,1<<n),multiply(s,1,1),divide(s,2),u=dataToString(s)}else multiply(s,0,r),multiply(s,1<<-t,0),u=dataToString(s)+repeat$3("0",o);return u=o>0?l+((i=u.length)<=o?"0."+repeat$3("0",o-i)+u:stringSlice$6(u,0,i-o)+"."+stringSlice$6(u,i-o)):l+u}});var $$W=_export,NativePromiseConstructor=promiseNativeConstructor,fails$k=fails$13,getBuiltIn$a=getBuiltIn$p,isCallable$3=isCallable$v,speciesConstructor=speciesConstructor$5,promiseResolve=promiseResolve$2,defineBuiltIn$6=defineBuiltIn$m,NativePromisePrototype=NativePromiseConstructor&&NativePromiseConstructor.prototype,NON_GENERIC=!!NativePromiseConstructor&&fails$k((function(){NativePromisePrototype.finally.call({then:function(){}},(function(){}))}));if($$W({target:"Promise",proto:!0,real:!0,forced:NON_GENERIC},{finally:function(e){var t=speciesConstructor(this,getBuiltIn$a("Promise")),r=isCallable$3(e);return this.then(r?function(r){return promiseResolve(t,e()).then((function(){return r}))}:e,r?function(r){return promiseResolve(t,e()).then((function(){throw r}))}:e)}}),isCallable$3(NativePromiseConstructor)){var method=getBuiltIn$a("Promise").prototype.finally;NativePromisePrototype.finally!==method&&defineBuiltIn$6(NativePromisePrototype,"finally",method,{unsafe:!0})}var $$V=_export,$map=arrayIteration.map,arrayMethodHasSpeciesSupport$1=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT$1=arrayMethodHasSpeciesSupport$1("map");$$V({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT$1},{map:function(e){return $map(this,e,arguments.length>1?arguments[1]:void 0)}});var $$U=_export,$reduce$1=arrayReduce.left,arrayMethodIsStrict$5=arrayMethodIsStrict$b,CHROME_VERSION$1=engineV8Version,IS_NODE$2=engineIsNode,STRICT_METHOD$5=arrayMethodIsStrict$5("reduce"),CHROME_BUG$1=!IS_NODE$2&&CHROME_VERSION$1>79&&CHROME_VERSION$1<83;$$U({target:"Array",proto:!0,forced:!STRICT_METHOD$5||CHROME_BUG$1},{reduce:function(e){var t=arguments.length;return $reduce$1(this,e,t,t>1?arguments[1]:void 0)}});var call$5=functionCall,fixRegExpWellKnownSymbolLogic=fixRegexpWellKnownSymbolLogic,anObject$6=anObject$r,isNullOrUndefined=isNullOrUndefined$7,toLength$2=toLength$c,toString$g=toString$w,requireObjectCoercible$4=requireObjectCoercible$e,getMethod=getMethod$6,advanceStringIndex=advanceStringIndex$2,regExpExec$1=regexpExecAbstract;fixRegExpWellKnownSymbolLogic("match",(function(e,t,r){return[function(t){var r=requireObjectCoercible$4(this),n=isNullOrUndefined(t)?void 0:getMethod(t,e);return n?call$5(n,t,r):new RegExp(t)[e](toString$g(r))},function(e){var n=anObject$6(this),i=toString$g(e),a=r(t,n,i);if(a.done)return a.value;if(!n.global)return regExpExec$1(n,i);var o=n.unicode;n.lastIndex=0;for(var s,l=[],u=0;null!==(s=regExpExec$1(n,i));){var c=toString$g(s[0]);l[u]=c,""===c&&(n.lastIndex=advanceStringIndex(i,toLength$2(n.lastIndex),o)),u++}return 0===u?null:l}]}));var PROPER_FUNCTION_NAME=functionName.PROPER,fails$j=fails$13,whitespaces$3=whitespaces$7,non="",stringTrimForced=function(e){return fails$j((function(){return!!whitespaces$3[e]()||non[e]()!==non||PROPER_FUNCTION_NAME&&whitespaces$3[e].name!==e}))},$$T=_export,$trim=stringTrim.trim,forcedStringTrimMethod=stringTrimForced;$$T({target:"String",proto:!0,forced:forcedStringTrimMethod("trim")},{trim:function(){return $trim(this)}});var util$1={ArrayBufferToString:function(e){for(var t="",r=new Uint8Array(e),n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t},StringToArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t},Base64ToHex:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=window.atob(e.replace(/-/g,"+").replace(/_/g,"/"));if(t){for(var n=[],i=0;i<r.length;i++)n.push(r.charCodeAt(i));return new Uint8Array(n).buffer}for(var a="",o=0;o<r.length;o++)a+=("0"+r.charCodeAt(o).toString(16)).substr(-2);return a},HexToBase64:function(e){for(var t="",r=0;r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return window.btoa(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},findBox:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var n=e.subBox.filter((function(e){return e.type===t}));n.length?n.forEach((function(e){return r.push(e)})):e.subBox.forEach((function(e){return util$1.findBox(e,t,r)}))}}else r.push(e);return(r=[].concat(r)).length>1?r:r[0]},padStart:function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},durationConvert:function(e){var t=0,r=0,n=0;return(e=e.slice(e.indexOf("PT")+2)).indexOf("H")>-1&&e.indexOf("M")>-1&&e.indexOf("S")>-1?(t=parseFloat(e.slice(0,e.indexOf("H"))),r=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("M"))),n=parseFloat(e.slice(e.indexOf("M")+1,e.indexOf("S")))):e.indexOf("H")>-1&&e.indexOf("M")>-1&&e.indexOf("S")<0?(t=parseFloat(e.slice(0,e.indexOf("H"))),r=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("M")))):e.indexOf("H")<0&&e.indexOf("M")>-1&&e.indexOf("S")>-1?(r=parseFloat(e.slice(0,e.indexOf("M"))),n=parseFloat(e.slice(e.indexOf("M")+1,e.indexOf("S")))):e.indexOf("H")>-1&&e.indexOf("M")<0&&e.indexOf("S")>-1?(t=parseFloat(e.slice(0,e.indexOf("H"))),n=parseFloat(e.slice(e.indexOf("H")+1,e.indexOf("S")))):e.indexOf("H")<0&&e.indexOf("M")<0&&e.indexOf("S")>-1?n=parseFloat(e.slice(0,e.indexOf("S"))):e.indexOf("H")<0&&e.indexOf("M")>-1&&e.indexOf("S")<0&&(r=parseFloat(e.slice(0,e.indexOf("M")))),3600*t+60*r+n},preFixInterge:function(e,t){return(Array(t).join(0)+e).slice(-t)},toHex:function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(util$1.padStart(Number(t).toString(16),2,0))})),e},sum:function(){for(var e=0,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e+=t})),e},toUTF8:function(e){for(var t=encodeURIComponent(e),r=unescape(t),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n.buffer},fromHex:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t},fromCharCode:function(e){for(var t="",r=0;r<e.length;r+=16e3){var n=e.subarray(r,r+16e3);t+=String.fromCharCode.apply(null,n)}return t},toBase64:function(e,t){var r=util$1.fromCharCode(e);t=void 0===t||t;var n=window.btoa(r).replace(/\+/g,"-").replace(/\//g,"_");return t?n:n.replace(/=*$/,"")},str2hex:function(e){if(""===e)return"";for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t},bufferToString:function(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()},stringToBuffer:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e[r]+e[r+1],16));return new Uint8Array(t)}};util$1.toHex=function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(util$1.padStart(Number(t).toString(16),2,0))})),e},util$1.formatIV=function(e){var t="";return e.forEach((function(e){t+=util$1.bufferToString(e)})),t},util$1.round=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number(e.toFixed(t))},util$1.isSogou=function(){return window.navigator.userAgent.toLowerCase().indexOf("metasr")>-1},util$1.isEdge=function(){var e=window.navigator.userAgent.toLowerCase();return e.indexOf("edge")>-1||e.indexOf("edg/")>-1},util$1.offInDestroy=function(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))},util$1.on=function(e,t,r,n){if(n)e.on(t,r),util$1.offInDestroy(e,t,r,n);else{e.on(t,(function n(i){r(i),e.off(t,n)}))}},util$1.once=function(e,t,r,n){if(n)e.once(t,r),util$1.offInDestroy(e,t,r,n);else{e.once(t,(function n(i){r(i),e.off(t,n)}))}},util$1.promisePolyfill=function(){Promise.prototype.finally||(Promise.prototype.finally={finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then((function(e){return t((function(){return e}))}),(function(e){return t((function(){return Promise.reject(e)}))}))}}.finally)},util$1.transformHeaders=function(e,t){var r=Object.assign({},e);return Object.keys(t).forEach((function(n){var i=t[n];e&&e[n]&&(r[i]=e[n],delete r[n])})),r},util$1.generateUniqueKey=function(e){var t=e.vid,r=e.start,n=e.end,i=e.mediaType,a=e.definition,o=e.codecType,s=e.format,l=e.bitrate;return r=r||0,n=n||0,o=o||"h264",s=s||"dash",t&&i?a?"".concat(t,"#").concat(i,"#").concat(a,"#").concat(r,"#").concat(n,"#").concat(o,"#").concat(s,"#").concat(l):"".concat(t,"#").concat(i,"#").concat(r,"#").concat(n,"#").concat(o,"#").concat(s,"#").concat(l):null},util$1.getDefinition=function(e){if(!e)return null;var t=e.split("#");return t.length>2?t[2]:null},util$1.exchangeListUrl=function(e){if(e&&0!==e.length)for(var t=0;t<e.length;t++)util$1.exchangeUrl(e[t])},util$1.exchangeUrl=function(e){if(e&&e.main_url&&e.backup_url_1){var t=e.main_url,r=e.backup_url_1,n=t.split("?");2===n.length&&-1===r.indexOf("?")?(e.main_url=r+"?"+n[1],e.backup_url_1=n[0]):(e.main_url=r,e.backup_url_1=t)}},util$1.validateFragment=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t instanceof ArrayBuffer){try{var n=new Uint8Array(t,4,4),i=String.fromCharCode.apply(null,n);if(2===r.length){var a=r[1]-r[0]+1;if(!(t.byteLength===a))return}if("moof"!==i&&"styp"!==i&&"ftyp"!==i)return!1}catch(e){return!1}return!0}return!1},util$1.validateUrlRange=function(e,t){var r=e||[];if(r.length>0)for(var n=0;n<r.length;n++){var i=r[n];if(/([0-9.\-A-Za-z]+)/.test(i)&&t.indexOf(i)>-1)return!0}return!1},util$1.isBase64=function(e){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)};var cipher=function(e){var t=function(e){return e.split("").map((function(e){return e.charCodeAt(0)}))},r=function(e){return("0"+Number(e).toString(16)).substr(-2)},n=function(r){return t(e).reduce((function(e,t){return e^t}),r)};return function(e){return e.split("").map(t).map(n).map(r).join("")}},decipher=function(e){var t=function(t){return(r=e,r.split("").map((function(e){return e.charCodeAt(0)}))).reduce((function(e,t){return e^t}),t);var r};return function(e){return e.match(/.{1,2}/g).map((function(e){return parseInt(e,16)})).map(t).map((function(e){return String.fromCharCode(e)})).join("")}},myCipher=cipher("vodTimestampSalt"),myDecipher=decipher("vodTimestampSalt");util$1.getUnionInfo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(e).concat(myCipher((new Date).getTime().toString()))},util$1.checkUnionInfoExpired=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;if(0===t.indexOf(e)){var n=parseInt(myDecipher(t.slice(e.length))),i=(new Date).getTime()-n;if(i>0&&i<=1e3*r)return!0}return!1},util$1.getCookieValue=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=document.cookie.split(";"),r=0;r<t.length;r++){var n=t[r].trim().split("=");if(n[0]===e)return n[1]}return null},util$1.nowTime=function(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}},util$1.getBitrateItem=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=t,a=util$1.getSelectorList(e,r),o=i.getSuitableBitrate?i.getSuitableBitrate(a,n):i.bitRateAdapter.select(a);return o},util$1.getSelectorList=function(e,t){for(var r=e.dynamic_video_list,n=[],i=0;i<r.length;i++){var a=r[i];n.push({bitrate:a.bitrate,definition:a.definition,duration:t})}return n};var charAt$6=stringMultibyte.charAt,toString$f=toString$w,InternalStateModule$4=internalState,defineIterator=iteratorDefine,createIterResultObject=createIterResultObject$2,STRING_ITERATOR="String Iterator",setInternalState$4=InternalStateModule$4.set,getInternalState$2=InternalStateModule$4.getterFor(STRING_ITERATOR);defineIterator(String,"String",(function(e){setInternalState$4(this,{type:STRING_ITERATOR,string:toString$f(e),index:0})}),(function(){var e,t=getInternalState$2(this),r=t.string,n=t.index;return n>=r.length?createIterResultObject(void 0,!0):(e=charAt$6(r,n),t.index+=e.length,createIterResultObject(e,!1))}));var global$c=global$T,DOMIterables=domIterables,DOMTokenListPrototype=domTokenListPrototype,ArrayIteratorMethods=es_array_iterator,createNonEnumerableProperty$2=createNonEnumerableProperty$d,wellKnownSymbol$5=wellKnownSymbol$t,ITERATOR$4=wellKnownSymbol$5("iterator"),TO_STRING_TAG=wellKnownSymbol$5("toStringTag"),ArrayValues=ArrayIteratorMethods.values,handlePrototype=function(e,t){if(e){if(e[ITERATOR$4]!==ArrayValues)try{createNonEnumerableProperty$2(e,ITERATOR$4,ArrayValues)}catch(error){e[ITERATOR$4]=ArrayValues}if(e[TO_STRING_TAG]||createNonEnumerableProperty$2(e,TO_STRING_TAG,t),DOMIterables[t])for(var r in ArrayIteratorMethods)if(e[r]!==ArrayIteratorMethods[r])try{createNonEnumerableProperty$2(e,r,ArrayIteratorMethods[r])}catch(error){e[r]=ArrayIteratorMethods[r]}}};for(var COLLECTION_NAME in DOMIterables)handlePrototype(global$c[COLLECTION_NAME]&&global$c[COLLECTION_NAME].prototype,COLLECTION_NAME);handlePrototype(DOMTokenListPrototype,"DOMTokenList");var PRELOAD_NEXT$3="PRELOAD_NEXT",PRELOAD_SEG_DONE$1="PRELOAD_SEG_DONE",STATES$1={PREPARE:"PREPARE",IDLE:"IDLE",PRELOADING:"PRELOADING",FINISH:"FINISH"},ONE_STEP_DONE$1="ONE_STEP_DONE",MEDIA_TYPES$2={VIDEO:0,AUDIO:1,MIXED:2},CACHE_TYPES$1={INDEXDB:0,MEMORY:1},DOWN_STATES$1={FAIL:-1,SUCCESS:0,DOWNLOADING:1},VTYPES$3={MP4:"MP4",DASH:"DASH",HLS:"HLS"},eventEmitter={exports:{}},d$1={exports:{}},_undefined$1=void 0,is$4=function(e){return e!==_undefined$1&&null!==e},isValue$6=is$4,possibleTypes={object:!0,function:!0,undefined:!0},is$3=function(e){return!!isValue$6(e)&&hasOwnProperty.call(possibleTypes,_typeof$b(e))},isObject$c=is$3,is$2=function(e){if(!isObject$c(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(error){return!1}},isPrototype=is$2,is$1=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(error){return!1}return!isPrototype(e)},isFunction$1=is$1,classRe=/^\s*class[\s{/}]/,functionToString$1=Function.prototype.toString,is=function(e){return!!isFunction$1(e)&&!classRe.test(functionToString$1.call(e))},isImplemented$2=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")},isImplemented$1=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}},noop=function(){},_undefined=noop(),isValue$5=function(e){return e!==_undefined&&null!==e},isValue$4=isValue$5,keys$3=Object.keys,shim$2=function(e){return keys$3(isValue$4(e)?Object(e):e)},keys$2=isImplemented$1()?Object.keys:shim$2,isValue$3=isValue$5,validValue=function(e){if(!isValue$3(e))throw new TypeError("Cannot use null or undefined");return e},keys$1=keys$2,value$1=validValue,max$2=Math.max,shim$1=function(t,r){var n,i,a,o=max$2(arguments.length,2);for(t=Object(value$1(t)),a=function(i){try{t[i]=r[i]}catch(e){n||(n=e)}},i=1;i<o;++i)keys$1(r=arguments[i]).forEach(a);if(void 0!==n)throw n;return t},assign$3=isImplemented$2()?Object.assign:shim$1,isValue$2=isValue$5,forEach=Array.prototype.forEach,create$4=Object.create,process$1=function(e,t){var r;for(r in e)t[r]=e[r]},normalizeOptions=function(e){var t=create$4(null);return forEach.call(arguments,(function(e){isValue$2(e)&&process$1(Object(e),t)})),t},str="razdwatrzy",isImplemented=function(){return"function"==typeof str.contains&&(!0===str.contains("dwa")&&!1===str.contains("foo"))},indexOf=String.prototype.indexOf,shim=function(e){return indexOf.call(this,e,arguments[1])>-1},contains$2=isImplemented()?String.prototype.contains:shim,isValue$1=is$4,isPlainFunction=is,assign$2=assign$3,normalizeOpts=normalizeOptions,contains$1=contains$2,d=d$1.exports=function(e,t){var r,n,i,a,o;return arguments.length<2||"string"!=typeof e?(a=t,t=e,e=null):a=arguments[2],isValue$1(e)?(r=contains$1.call(e,"c"),n=contains$1.call(e,"e"),i=contains$1.call(e,"w")):(r=i=!0,n=!1),o={value:t,configurable:r,enumerable:n,writable:i},a?assign$2(normalizeOpts(a),o):o};d.gs=function(e,t,r){var n,i,a,o;return"string"!=typeof e?(a=r,r=t,t=e,e=null):a=arguments[3],isValue$1(t)?isPlainFunction(t)?isValue$1(r)?isPlainFunction(r)||(a=r,r=void 0):r=void 0:(a=t,t=r=void 0):t=void 0,isValue$1(e)?(n=contains$1.call(e,"c"),i=contains$1.call(e,"e")):(n=!0,i=!1),o={get:t,set:r,configurable:n,enumerable:i},a?assign$2(normalizeOpts(a),o):o};var validCallable=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e};!function(e,t){var r,n,i,a,o,s,l,u=d$1.exports,c=validCallable,d=Function.prototype.apply,h=Function.prototype.call,f=Object.create,p=Object.defineProperty,y=Object.defineProperties,m=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};n=function(e,t){var n,a;return c(t),a=this,r.call(this,e,n=function(){i.call(a,e,n),d.call(t,this,arguments)}),n.__eeOnceListener__=t,this},a=function(e){var t,r,n,i,a;if(m.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"===_typeof$b(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)d.call(n,this,a)}else switch(arguments.length){case 1:h.call(i,this);break;case 2:h.call(i,this,arguments[1]);break;case 3:h.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];d.call(i,this,a)}},o={on:r=function(e,t){var r;return c(t),m.call(this,"__ee__")?r=this.__ee__:(r=g.value=f(null),p(this,"__ee__",g),g.value=null),r[e]?"object"===_typeof$b(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:n,off:i=function(e,t){var r,n,i,a;if(c(t),!m.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"===_typeof$b(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:a},s={on:u(r),once:u(n),off:u(i),emit:u(a)},l=y({},s),e.exports=t=function(e){return null==e?f(l):y(Object(e),s)},t.methods=o}(eventEmitter,eventEmitter.exports);var EventEmitter=eventEmitter.exports,DESCRIPTORS$f=descriptors$1,uncurryThis$m=functionUncurryThis$1,objectKeys$2=objectKeys$8,toIndexedObject$4=toIndexedObject$q,$propertyIsEnumerable$2=objectPropertyIsEnumerable$1.f,propertyIsEnumerable$1=uncurryThis$m($propertyIsEnumerable$2),push$8=uncurryThis$m([].push),createMethod$2=function(e){return function(t){for(var r,n=toIndexedObject$4(t),i=objectKeys$2(n),a=i.length,o=0,s=[];a>o;)r=i[o++],DESCRIPTORS$f&&!propertyIsEnumerable$1(n,r)||push$8(s,e?[r,n[r]]:n[r]);return s}},objectToArray$1={entries:createMethod$2(!0),values:createMethod$2(!1)},$$S=_export$1,$values$1=objectToArray$1.values;$$S({target:"Object",stat:!0},{values:function(e){return $values$1(e)}});var isValue=isValue$5,map={function:!0,object:!0},isObject$b=function(e){return isValue(e)&&map[_typeof$b(e)]||!1},isObject$a=isObject$b,validObject=function(e){if(!isObject$a(e))throw new TypeError(e+" is not an Object");return e},value=validObject,hasOwnProperty$1=Object.prototype.hasOwnProperty,allOff=function(e){var t,r=arguments[1];if(value(e),void 0===r)hasOwnProperty$1.call(e,"__ee__")&&delete e.__ee__;else{if(!(t=hasOwnProperty$1.call(e,"__ee__")&&e.__ee__))return;t[r]&&delete t[r]}},RETRY_MAX$1=10,PRELOADER$1=function(){function e(t,r,n,i,a){_classCallCheck$b(this,e),EventEmitter(this),this.state=STATES$1.PREPARE,this.options=t||{},this.logger=t.logger||function(){},this._preloadManager=r,this.player=r.player;var o=n.handlers,s=n.predictInst,l=n.readyPromise;this._predictInst=s,this._handlers=o,this._predictInstReadyPromise=l,this._toLoadList=[],this.retryCount=0,this._cachedHandler=i,this._cachedDataHanlder=a,this.cnt=0}return _createClass$c(e,[{key:"start",value:function(){var e=this,t=new ProxyPromise$1;return this._handlers.start(this.options).then((function(r){r.onObtain().then((function(n){e._predictInstReadyPromise.then((function(){e._predictInst.updateMediaInfos(n);var i=e._predictInst.preloadPredict(e.options),a=e._predictInst.cachedData;e._cachedDataHanlder(Object.assign({vid:e.options.vid},{data:a}));var o=Object.assign(i,e.options);r.onTransform(o).then((function(r){e._toLoadList=r,t.resolve(r)}))}))}))})).catch((function(e){t.reject(new Error("preload unit start error"))})),t}},{key:"preloadSeg",value:function(){var e=this;if(0===this._toLoadList.length)return this.state=STATES$1.FINISH,void this.emit(PRELOAD_SEG_DONE$1,!0);this.state="PRELOADING";var t=this._toLoadList.shift();this._handlers.onRequest(t,(function(r){var n=Object.assign({},t.extData,r);e._cachedHandler(n)})).then((function(){e.state=STATES$1.IDLE,e.emit(PRELOAD_SEG_DONE$1)})).catch((function(t){e.requestError(),e.emit(PRELOAD_SEG_DONE$1,!1)}))}},{key:"requestError",value:function(){this.retryCount++,this.state=STATES$1.IDLE,this.retryCount>=RETRY_MAX$1&&(this.state=STATES$1.FINISH),this.emit(ONE_STEP_DONE$1),this.logger("preload request error")}},{key:"cancelLoading",value:function(){this._toLoadList=[]}},{key:"destroy",value:function(){allOff(this)}}]),e}();function getIDB$1(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){}}var idb$1=getIDB$1(),idb$1$1=idb$1;function isIndexedDBValid$1(){try{if(!idb$1$1||!idb$1$1.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||r)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function executeCallback$1(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function executeTwoCallbacks$1(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function normalizeKey$1(e){return"string"!=typeof e&&(console.warn("".concat(e," used as a key, but it is not a string.")),e=String(e)),e}var dbContexts$1={},READ_ONLY$1="readonly",READ_WRITE$1="readwrite";function _deferReadiness$1(e){var t=dbContexts$1[e.name],r={};r.promise=new Promise((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function _advanceReadiness$1(e){var t=dbContexts$1[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _rejectReadiness$1(e,t){var r=dbContexts$1[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function _getConnection$1(e,t){return new Promise((function(r,n){if(dbContexts$1[e.name]=dbContexts$1[e.name]||createDbContext$1(),e.db){if(!t)return r(e.db);_deferReadiness$1(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=idb$1$1.open.apply(idb$1$1,i);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),_advanceReadiness$1(e)}}))}function _getOriginalConnection$1(e){return _getConnection$1(e,!1)}function _getUpgradedConnection$1(e){return _getConnection$1(e,!0)}function _isUpgradeNeeded$1(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function _tryReconnect$1(e){_deferReadiness$1(e);for(var t=dbContexts$1[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,_getOriginalConnection$1(e).then((function(t){return e.db=t,_isUpgradeNeeded$1(e)?_getUpgradedConnection$1(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(t){throw _rejectReadiness$1(e,t),t}))}function createTransaction$1(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(a){if(n>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return Promise.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_getUpgradedConnection$1(e)})).then((function(){return _tryReconnect$1(e).then((function(){createTransaction$1(e,t,r,n-1)}))})).catch(r);r(a)}}function createDbContext$1(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}var AsyncStorage$1=function(){function t(){_classCallCheck$b(this,t)}return _createClass$c(t,[{key:"ready",value:function(){return this._ready}},{key:"_initStorage",value:function(e){var t=this;t._defaultConfig=e;var r={db:null};if(e)for(var n in e)r[n]=e[n];var i=dbContexts$1[r.name];i||(i=createDbContext$1(),dbContexts$1[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=t._fullyReady);var a=[];function o(){return Promise.resolve()}for(var s=0;s<i.forages.length;s++){var l=i.forages[s];l!==t&&a.push(l._initReady().catch(o))}var u=i.forages.slice(0);return t._ready=Promise.all(a).then((function(){return r.db=i.db,_getOriginalConnection$1(r)})).then((function(e){return r.db=e,_isUpgradeNeeded$1(r,t._defaultConfig.version)?_getUpgradedConnection$1(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<u.length;n++){var a=u[n];a!==t&&(a._dbInfo.db=r.db,a._dbInfo.version=r.version)}})),t._ready}},{key:"probeSupport",get:function(){return isIndexedDBValid$1()}},{key:"getItem",value:function(t,r){var n=this;t=normalizeKey$1(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction$1(n._dbInfo,READ_ONLY$1,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).get(t);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),r(e)},s.onerror=function(){i(s.error)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback$1(i,r),i}},{key:"setItem",value:function(t,r,n){var i=this;t=normalizeKey$1(t);var a=new Promise((function(n,a){i.ready().then((function(){return r})).then((function(r){createTransaction$1(i._dbInfo,READ_WRITE$1,(function(o,s){if(o)return a(o);try{var l=s.objectStore(i._dbInfo.storeName);null===r&&(r=void 0);var u=l.put(r,t);s.oncomplete=function(){void 0===r&&(r=null),n(r)},s.onabort=s.onerror=function(){var e=u.error?u.error:u.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return executeCallback$1(a,n),a}},{key:"removeItem",value:function(t,r){var n=this;t=normalizeKey$1(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction$1(n._dbInfo,READ_WRITE$1,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).delete(t);o.oncomplete=function(){r()},o.onerror=function(){i(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback$1(i,r),i}},{key:"clear",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction$1(r._dbInfo,READ_WRITE$1,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).clear();a.oncomplete=function(){t()},a.onabort=a.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback$1(n,t),n}},{key:"length",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction$1(r._dbInfo,READ_ONLY$1,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback$1(n,t),n}},{key:"all",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction$1(r._dbInfo,READ_ONLY$1,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).openCursor(),s=[];o.onsuccess=function(){var e=o.result;e?(s.push({key:e.key,value:e.value}),e.continue()):t(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback$1(n,t),n}},{key:"_fullyReady",value:function(e){var t=this,r=t._initReady().then((function(){var e=dbContexts$1[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return executeTwoCallbacks$1(r,e,e),r}}]),t}(),IndexedDB=AsyncStorage$1;function _typeof$7(e){return(_typeof$7="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var MemoryCache$1=function(){function e(){_classCallCheck$b(this,e)}return _createClass$c(e,[{key:"_initStorage",value:function(e){var t=e.name+"_"+e.storeName;return this.key=t,window[t]&&"object"===_typeof$7(window[t])||(window[t]={}),this.store=window[t],Promise.resolve()}},{key:"getItem",value:function(e,t){var r=this.store[e];return void 0===r&&(r=null),this._internalPromise(t,r)}},{key:"setItem",value:function(e,t,r){return this.store[e]=t,this._internalPromise(r)}},{key:"removeItem",value:function(e,t){return delete this.store[e],this._internalPromise(t)}},{key:"clear",value:function(e){return this.store={},window[this.key]={},this._internalPromise(e)}},{key:"length",value:function(e){var t=Object.keys(this.store).length;return this._internalPromise(e,t)}},{key:"_internalPromise",value:function(e,t){var r=t?Promise.resolve(t):Promise.resolve();return executeCallback$1(r,e),r}},{key:"all",value:function(e){for(var t=[],r=Object.keys(this.store),n=0;n<r.length;n++){var i=r[n];t.push({key:i,value:this.store[i]})}return this._internalPromise(e,t)}},{key:"probeSupport",value:function(){return!0}}]),e}(),MemoryCache$1$1=MemoryCache$1,DefaultConfig$1={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},SPLIT$1="|",SESSION_KEY$1="__PRE_CACHE__KEYS",TIMESPLIT$1="$",MAX_CACHE$1=200,PreloadCache$1=function(){function e(t,r){_classCallCheck$b(this,e);var n=r===CACHE_TYPES$1.MEMORY?MemoryCache$1$1:IndexedDB;this._driver=new n,this._driver._initStorage(DefaultConfig$1).catch((function(){})),this._hasIdbForbidden=!1,this._maxCache=!t||t<=0?MAX_CACHE$1:t,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new ProxyPromise$1,this.init()}return _createClass$c(e,[{key:"getCachedKeysFromLocal",value:function(){var e=proxyLocalStorage$1.getItem(SESSION_KEY$1);if(e)for(var t=e.split(SPLIT$1),r=0;r<t.length;r++){var n=t[r],i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a}}},{key:"_getCacheKeyInfos",value:function(e){var t,r=e.split(TIMESPLIT$1);return 2===r.length&&(t=r[0],e=r[1]),{time:t,cachedKey:e}}},{key:"writeCachedKeysToLocal",value:function(e){var t=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(var r=0;r<e.length;r++){var n=e[r].key,i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a,t.push(n)}var s=t.join(SPLIT$1);proxyLocalStorage$1.setItem(SESSION_KEY$1,s)}},{key:"init",value:function(){var e=this;this._driver.setItem("test","test").then((function(){})).catch((function(){e._hasIdbForbidden=!0})).finally((function(){e._driver.removeItem("test").catch((function(){})),e._hasIdbForbidden&&(e._driver=new MemoryCache$1$1,e._driver._initStorage(DefaultConfig$1)),e._getAll(),e._readyPromise.resolve()}))}},{key:"_getAll",value:function(){var e=this;this._driver.all().then((function(t){e._cachedLength=t.length;var r=t.length-e._maxCache,n=t;if(r>0){var i=t.slice(0,r);n=t.slice(r);for(var a=0;a<i.length;a++)e.removeItem(i[a].key).then((function(){}))}e.writeCachedKeysToLocal(n)})).catch((function(){}))}},{key:"getItem",value:function(e,t){if(!this.hasItem(e))return Promise.resolve(!1);var r=this._getTimeKey(e).timeKey;return this._driver.getItem(r,t)}},{key:"setItem",value:function(e,t,r){var n=this;this._getTimeKey(e).timeKey&&this.removeItem(e);var i=(new Date).getTime();this._allCachedKeys[e]=1,this._allCachedTimeKeys[e]=i;var a=this._genTimeKey(e,i);return r=r?function(){n._getAll(),r()}:function(){n._getAll()},this._driver.setItem(a,t,r)}},{key:"_getTimeKey",value:function(e){var t=this._allCachedTimeKeys[e],r=e;return t&&(r=this._genTimeKey(e,t)),{timeKey:r,time:t}}},{key:"_genTimeKey",value:function(e,t){return"".concat(t).concat(TIMESPLIT$1).concat(e)}},{key:"removeItem",value:function(e,t){var r=this._getTimeKey(e).timeKey,n=this._driver.removeItem(r,t);return delete this._allCachedKeys[e],delete this._allCachedTimeKeys[e],n}},{key:"hasItem",value:function(e){return!!this._allCachedKeys[e]}},{key:"clear",value:function(e){return this._driver.clear(e)}},{key:"length",value:function(e){return this._driver.length(e)}},{key:"setMaxCache",value:function(e){"number"==typeof e&&e>0&&(this._maxCache=e)}}]),e}(),PreloadCache$1$1=PreloadCache$1,PRELOADER_KEY$1="DEFAULT",PreloaderManager$1=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck$b(this,e),EventEmitter(this),this._preloadDataList=[],this._currentPreloadInst=null,this._dashPreloadList=[],this.autoPreload=t.autoPreload||!1,this._onPreloadNext=this.onPreloadNextReady.bind(this),this.on(PRELOAD_NEXT$3,this._onPreloadNext),this._preloaderConfigs={},this.update(t,r,n),this._cacheInst=new PreloadCache$1$1(t.preloadMaxCacheCount,t.preloadCacheType),this._preloadCacheProgress={},this._ptag_=!0,this._cachedDatas={}}return _createClass$c(e,[{key:"_getProloaderKey",value:function(e){return e.vtype?e.vtype:PRELOADER_KEY$1}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r)throw new Error("PreloaderManager predictInst is null");var n=this._getProloaderKey(e);this._preloaderConfigs[n]={predictInst:r,readyPromise:r.init(e),handlers:t}}},{key:"cachedDatas",get:function(){return this._cachedDatas}},{key:"onCacheSegment",value:function(e){var t=e.vid,r=e.format,n=e.cacheKey,i=e.total,a=e.loaded,o=e.isInitSegment,s=e.mediaType,l=this.getProgressCacheKey(t,r,s),u=this._preloadCacheProgress[l];u||(u=this._preloadCacheProgress[l]={}),u[n]={total:i,loaded:a,isInitSegment:o}}},{key:"onCachePredict",value:function(e){var t=e.vid,r=e.data;t&&r&&(this._cachedDatas[t]=r)}},{key:"getProgressCacheKey",value:function(e,t,r){return"".concat(e,"-").concat(t,"-").concat(r)}},{key:"onPreloadNextReady",value:function(){this.onPreloadNext()}},{key:"onPreloadSegDone",value:function(){this.autoPreload&&this.emit(PRELOAD_NEXT$3)}},{key:"onPreloadNext",value:function(){var e=this;if(null==this._currentPreloadInst&&this._preloadDataList.length>0){if(this._preloadDataList.length>0){var t=this._preloadDataList.shift().data;if(t.payload){var r=this._getProloaderKey(t),n=this._preloaderConfigs[r];if(!n)return void console.warn("need to set vtype, no preloader",t);this._currentPreloadInst=new PRELOADER$1(t,this,n,(function(t){e.onCacheSegment(t)}),(function(t){e.onCachePredict(t)})),this._currentPreloadInst.on(PRELOAD_SEG_DONE$1,this.onPreloadSegDone.bind(this)),this._currentPreloadInst.start().then((function(){e._currentPreloadInst.preloadSeg()})).catch((function(){e._currentPreloadInst=null}))}}}else null!=this._currentPreloadInst&&(this._currentPreloadInst.state===STATES$1.IDLE?this._currentPreloadInst.preloadSeg():this._currentPreloadInst.state===STATES$1.FINISH?(this._currentPreloadInst.destroy(),this._currentPreloadInst=null):this._currentPreloadInst.state===STATES$1.PREPARE&&(this._currentPreloadInst.cnt++,this._currentPreloadInst.cnt>2&&(this._currentPreloadInst.destroy(),this._currentPreloadInst=null)))}},{key:"addDashPreloader",value:function(e){e&&e.data&&(this._preloadDataList.push(e),this.sort(this._preloadDataList),this.autoPreload&&this.emit(PRELOAD_NEXT$3))}},{key:"_addDashPreloader",value:function(e){e&&e.data&&this._preloadDataList.push(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.sort(e);for(var t=0;t<e.length;t++)this._addDashPreloader(e[t])}},{key:"sort",value:function(e){e.sort((function(e,t){return void 0===e.order&&void 0===e.order||e.order<t.order?-1:1}))}},{key:"destroy",value:function(){this.off(PRELOAD_NEXT$3,this._onPreloadNext)}},{key:"cancelLoading",value:function(){this._currentPreloadInst&&(this._currentPreloadInst.cancelLoading(),this._currentPreloadInst=null),this._preloadDataList=[]}},{key:"preloadCacheProgress",value:function(e){var t=e.vid,r=e.format,n=e.mediaType,i=e.prelaodType,a=e.bitrate,o=e.set_duration,s=e.set_size,l=e.media_type,u=e.start_time,c=this.getProgressCacheKey(t,r,n),d=this._preloadCacheProgress[c];if(d){for(var h=Object.values(d),f=0,p=0,y=0,m=0,g=0,v=0;v<h.length;v++){var b=h[v];b.isInitSegment&&(f=b.total,y=b.loaded,m=b.loaded===b.total?DOWN_STATES$1.SUCCESS:DOWN_STATES$1.DOWNLOADING),p+=b.total,g+=b.loaded}return{media_type:l,preload_type:i,stream_bitrate:a,header_size:f,content_total_size:p,start_time:u||-1,state_info:{set_duration:o,set_size:s,current_header_download_size:y,current_content_download_size:g,header_download_state:m,content_download_state:g===p?DOWN_STATES$1.SUCCESS:DOWN_STATES$1.DOWNLOADING}}}return null}},{key:"getPreloadTaskInfos",value:function(){}},{key:"getItem",value:function(e,t){return this._cacheInst.getItem(e,t)}},{key:"setItem",value:function(e,t,r){return this._cacheInst.setItem(e,t,r)}},{key:"removeItem",value:function(e,t){return this.removeItem(e,t)}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.GLOBAL_KEY+(t.globalKey?t.globalKey:""),a=window[i];if(a&&a._ptag_)return a.update(t,r,n),a;var o=new e(t,r,n);return window[i]=o,o}}]),e}();PreloaderManager$1.GLOBAL_KEY="__preloadcontext__";var PreloaderManager$1$1=PreloaderManager$1,PreloaderBase$1=function(){function t(e){_classCallCheck$b(this,t),EventEmitter(this),this.options=e,this.promisePolyfill(),this.before(),this.check(),this._preloadManager=PreloaderManager$1$1.getInstance(e,this.handlers,this.predictInst),this.loadingTasks=[]}return _createClass$c(t,[{key:"promisePolyfill",value:function(){Promise.prototype.finally||(Promise.prototype.finally={finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then((function(e){return t((function(){return e}))}),(function(e){return t((function(){return Promise.reject(e)}))}))}}.finally)}},{key:"before",value:function(){throw new Error("need")}},{key:"check",value:function(){if(!this.handlers)throw new Error("handlers null");if(!this.handlers.start||!this.handlers.onRequest)throw new Error("handlers callback null");if(!this.predictInst)throw new Error("predictInst null");if(!this.predictInst.__p__)throw new Error("predictInst need extends predictbase")}},{key:"preloadNext",value:function(){this._preloadManager.emit(PRELOAD_NEXT$3)}},{key:"preloadManager",get:function(){return this._preloadManager}},{key:"start",value:function(e){throw new Error("start need implment, return Promise")}},{key:"cancelLoading",value:function(){for(var t=0;t<this.loadingTasks.length;t++)try{var r=this.loadingTasks[t];"function"==typeof r.cancel&&r.cancel()}catch(e){}this.loadingTasks=[],this._preloadManager.cancelLoading()}},{key:"addTasker",value:function(e){this.loadingTasks.push(e)}},{key:"removeTasker",value:function(e){var t=this;setTimeout((function(){for(var r=t.loadingTasks.length-1;r>-1;r--)if(t.loadingTasks[r]===e){t.loadingTasks.splice(r,1);break}}))}},{key:"addDashPreloader",value:function(e){this._preloadManager.addDashPreloader(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._preloadManager.addDashPreloaderList(e)}}]),t}(),PredictBase$1=function(){function e(){_classCallCheck$b(this,e),this.bandwidth2item={},this._mediaInfos=null,this.__p__=!0}return _createClass$c(e,[{key:"init",value:function(){throw new Error("init func not implement, return promise")}},{key:"preloadPredict",value:function(e){throw new Error("preloadPredict error",e)}},{key:"updateMediaInfos",value:function(e){if(this._mediaInfos=e,this.bandwidth2item={},this.dynamic_video=e&&e.dynamic_video_list,this.dynamic_video&&this.dynamic_video.length>0)for(var t=0;t<this.dynamic_video.length;t++){var r=this.dynamic_video[t];this.bandwidth2item[r.bitrate||r.bandwidth]=r}}},{key:"getIdx",value:function(e,t){var r=0;return e.forEach((function(e,n){e.definition===t&&(r=n)})),r}},{key:"cachedData",get:function(){return null}}]),e}(),VTYPES$2=VTYPES$3,$$R=_export,uncurryThis$l=functionUncurryThis,aCallable$1=aCallable$e,toObject$7=toObject$m,lengthOfArrayLike$7=lengthOfArrayLike$r,deletePropertyOrThrow$2=deletePropertyOrThrow$5,toString$e=toString$w,fails$i=fails$13,internalSort=arraySort$1,arrayMethodIsStrict$4=arrayMethodIsStrict$b,FF=engineFfVersion,IE_OR_EDGE=engineIsIeOrEdge,V8=engineV8Version,WEBKIT=engineWebkitVersion,test$1=[],nativeSort=uncurryThis$l(test$1.sort),push$7=uncurryThis$l(test$1.push),FAILS_ON_UNDEFINED=fails$i((function(){test$1.sort(void 0)})),FAILS_ON_NULL=fails$i((function(){test$1.sort(null)})),STRICT_METHOD$4=arrayMethodIsStrict$4("sort"),STABLE_SORT=!fails$i((function(){if(V8)return V8<70;if(!(FF&&FF>3)){if(IE_OR_EDGE)return!0;if(WEBKIT)return WEBKIT<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)test$1.push({k:t+n,v:r})}for(test$1.sort((function(e,t){return t.v-e.v})),n=0;n<test$1.length;n++)t=test$1[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}})),FORCED$9=FAILS_ON_UNDEFINED||!FAILS_ON_NULL||!STRICT_METHOD$4||!STABLE_SORT,getSortCompare=function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:toString$e(t)>toString$e(r)?1:-1}};$$R({target:"Array",proto:!0,forced:FORCED$9},{sort:function(e){void 0!==e&&aCallable$1(e);var t=toObject$7(this);if(STABLE_SORT)return void 0===e?nativeSort(t):nativeSort(t,e);var r,n,i=[],a=lengthOfArrayLike$7(t);for(n=0;n<a;n++)n in t&&push$7(i,t[n]);for(internalSort(i,getSortCompare(e)),r=lengthOfArrayLike$7(i),n=0;n<r;)t[n]=i[n++];for(;n<a;)deletePropertyOrThrow$2(t,n++);return t}});var $$Q=_export,$every=arrayIteration.every,arrayMethodIsStrict$3=arrayMethodIsStrict$b,STRICT_METHOD$3=arrayMethodIsStrict$3("every");$$Q({target:"Array",proto:!0,forced:!STRICT_METHOD$3},{every:function(e){return $every(this,e,arguments.length>1?arguments[1]:void 0)}});var $$P=_export,getBuiltIn$9=getBuiltIn$p,apply$2=functionApply,call$4=functionCall,uncurryThis$k=functionUncurryThis,fails$h=fails$13,isArray$2=isArray$7,isCallable$2=isCallable$v,isObject$9=isObject$w,isSymbol$1=isSymbol$6,arraySlice$1=arraySlice$c,NATIVE_SYMBOL$4=symbolConstructorDetection,$stringify=getBuiltIn$9("JSON","stringify"),exec$5=uncurryThis$k(/./.exec),charAt$5=uncurryThis$k("".charAt),charCodeAt$2=uncurryThis$k("".charCodeAt),replace$7=uncurryThis$k("".replace),numberToString$2=uncurryThis$k(1..toString),tester=/[\uD800-\uDFFF]/g,low=/^[\uD800-\uDBFF]$/,hi=/^[\uDC00-\uDFFF]$/,WRONG_SYMBOLS_CONVERSION=!NATIVE_SYMBOL$4||fails$h((function(){var e=getBuiltIn$9("Symbol")();return"[null]"!=$stringify([e])||"{}"!=$stringify({a:e})||"{}"!=$stringify(Object(e))})),ILL_FORMED_UNICODE=fails$h((function(){return'"\\udf06\\ud834"'!==$stringify("\udf06\ud834")||'"\\udead"'!==$stringify("\udead")})),stringifyWithSymbolsFix=function(e,t){var r=arraySlice$1(arguments),n=t;if((isObject$9(t)||void 0!==e)&&!isSymbol$1(e))return isArray$2(t)||(t=function(e,t){if(isCallable$2(n)&&(t=call$4(n,this,e,t)),!isSymbol$1(t))return t}),r[1]=t,apply$2($stringify,null,r)},fixIllFormed=function(e,t,r){var n=charAt$5(r,t-1),i=charAt$5(r,t+1);return exec$5(low,e)&&!exec$5(hi,i)||exec$5(hi,e)&&!exec$5(low,n)?"\\u"+numberToString$2(charCodeAt$2(e,0),16):e};$stringify&&$$P({target:"JSON",stat:!0,arity:3,forced:WRONG_SYMBOLS_CONVERSION||ILL_FORMED_UNICODE},{stringify:function(e,t,r){var n=arraySlice$1(arguments),i=apply$2(WRONG_SYMBOLS_CONVERSION?stringifyWithSymbolsFix:$stringify,null,n);return ILL_FORMED_UNICODE&&"string"==typeof i?replace$7(i,tester,fixIllFormed):i}});var XHR$1=_createClass$d((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,n=t.method,i=void 0===n?"GET":n,a=t.type,o=void 0===a?"arraybuffer":a,s=t.data,l=void 0===s?{}:s;return _classCallCheck$c(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,a=i.toUpperCase(),s=[];for(var u in o&&(n.responseType=o),l)s.push("k=".concat(l[u]));if("GET"===a)n.open(a,"".concat(r,"?").concat(s.join("&"))),n.send();else{if("POST"!==a)throw new Error("xhr ".concat(a," is not supported"));n.open(a,r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(l))}n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)}}))})),ERROR_TYPE_CODE={data:1e3,runtime:1002,parse:1004,other:9999,notSupport:1005,canplay:1006,bufferbreak:1007,network:1003,pdnetwork:1008,licetwork:1009,media:1010},Errors=_createClass$d((function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;_classCallCheck$c(this,e);var a={errorType:t,errorTypeCode:ERROR_TYPE_CODE[t],errorCode:r,playerVersion:"3.0.45"};return n&&"object"===_typeof$8(n)&&Object.keys(n).map((function(e){return a[e]=n[e],e})),i&&(a.currentTime=i.currentTime||0,a.duration=i.duration||0,a.ended=i.ended?0:1,a.vtype="dash"===i.playerType?"DASH":"LOWER_MP4",i.config&&(a.vid=i.config.vid),i.error&&(a.videoError=i.error)),a}));Errors.NETWORK="network",Errors.PD_NETWORK="pdnetwork",Errors.LIC_NETWORK="licetwork",Errors.MSE="mse",Errors.PARSE="parse",Errors.FORMAT="format",Errors.DECODER="decoder",Errors.RUNTIME="runtime",Errors.CANPLAY="canplay",Errors.BUFFERBREAK="bufferbreak",Errors.TIMEOUT="timeout",Errors.OTHER="other",Errors.MEDIA="media",Errors.NETEORK_ERROR_CODES={timeout:-499895,401:-499898,403:-499897,404:-499898},Errors.MPD_PARSE_ERROR=-499970,Errors.MSE_PARSE_ERROR=-499971,Errors.DUR_PARSE_ERROR=-499972,Errors.SEG_PARSE_ERROR=-499973,Errors.LIC_PARSE_ERROR=-499974,Errors.SID_PARSE_ERROR=-499975,Errors.HEADER_PARSE_ERROR=-499976,Errors.BUF_PARSE_ERROR=-499977,Errors.BYTE_PARSE_ERROR=-499978,Errors.BOX_KEY_ERROR=-499983,Errors.NO_CANPLAY_ERROR=-499985,Errors.BUFFERBREAK_ERROR=-499986,Errors.NETWORK_DISCONNECT=-499900,Errors.CDM_LICENSE_ERROR=-499901,Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED=-499902,Errors.INIT_SEGMENT_ERROR=-499903,Errors.MSE_APPEND_ERROR=-499904;var $$O=_export,$find=arrayIteration.find,addToUnscopables$3=addToUnscopables$5,FIND="find",SKIPS_HOLES=!0;FIND in[]&&Array(1)[FIND]((function(){SKIPS_HOLES=!1})),$$O({target:"Array",proto:!0,forced:SKIPS_HOLES},{find:function(e){return $find(this,e,arguments.length>1?arguments[1]:void 0)}}),addToUnscopables$3(FIND);var $$N=_export,ArrayBufferModule=arrayBuffer,NATIVE_ARRAY_BUFFER=arrayBufferBasicDetection;$$N({global:!0,constructor:!0,forced:!NATIVE_ARRAY_BUFFER},{DataView:ArrayBufferModule.DataView});var Stream=function(){function e(t){if(_classCallCheck$c(this,e),!(t instanceof ArrayBuffer))throw new Errors(Errors.PARSE,Errors.BUF_PARSE_ERROR,{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return _createClass$d(e,[{key:"position",get:function(){return this.dataview.position},set:function(e){this.dataview.position=e}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"readString",value:function(e){if(this.position+e<=this.buffer.byteLength){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.readUint8());return t}throw new Errors(Errors.PARSE,Errors.BYTE_PARSE_ERROR,{line:124,handle:"[Stream] readString",msg:"readstring error"})}}],[{key:"readByte",value:function(e,t,r){var n;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw new Error("not supported for readByte 3");n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Errors(Errors.PARSE,Errors.BYTE_PARSE_ERROR,{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),Box=function(){function e(){_classCallCheck$c(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return _createClass$d(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new Errors(Errors.PARSE,Errors.HEADER_PARSE_ERROR,{line:20,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],r=0;r<16;r++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var r,n=this.size-t.position+this.start,i=this.type;this.data=t.buffer.slice(t.position,t.position+n),t.position+=this.data.byteLength,(r=e.containerBox.find((function(e){return e===i}))?e.containerParser:e[i])&&r instanceof Function&&r.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new Stream(this.data),r=t.buffer.byteLength;t.position<r;){var n=new e;n.readHeader(t),this.subBox.push(n),n.readBody(t)}delete this.data,t=null}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}}]),e}();Box.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra","udta"];var concat={};Object.defineProperty(concat,"__esModule",{value:!0}),concat.default=function(e){for(var t=0,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=!0,o=!1,s=void 0;try{for(var l,u=n[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;t+=c.length}}catch(b){o=!0,s=b}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}var d=new e(t),h=0,f=!0,p=!1,y=void 0;try{for(var m,g=n[Symbol.iterator]();!(f=(m=g.next()).done);f=!0){var v=m.value;d.set(v,h),h+=v.length}}catch(b){p=!0,y=b}finally{try{!f&&g.return&&g.return()}finally{if(p)throw y}}return d};var _concat=concat,_concat2=_interopRequireDefault(_concat);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var lib$1=_concat2.default;function MP4DecConfigDescrTag(e){var t,r=new Box;return r.type=e.readUint8(),128===(t=e.readUint8())?(r.extend=!0,e.skip(2),t=e.readUint8()+5):t+=2,r.size=t,r.typeID=e.readUint8(),r.streamUint=e.readUint8(),r.bufferSize=Stream.readByte(e.dataview,3),r.maximum=e.readUint32(),r.average=e.readUint32(),r.subBox.push(Box.MP4DecSpecificDescrTag(e)),r}var uncurryThis$j=functionUncurryThis,toLength$1=toLength$c,toString$d=toString$w,$repeat=stringRepeat,requireObjectCoercible$3=requireObjectCoercible$e,repeat$2=uncurryThis$j($repeat),stringSlice$5=uncurryThis$j("".slice),ceil=Math.ceil,createMethod$1=function(e){return function(t,r,n){var i,a,o=toString$d(requireObjectCoercible$3(t)),s=toLength$1(r),l=o.length,u=void 0===n?" ":toString$d(n);return s<=l||""==u?o:((a=repeat$2(u,ceil((i=s-l)/u.length))).length>i&&(a=stringSlice$5(a,0,i)),e?o+a:a+o)}},stringPad={start:createMethod$1(!1),end:createMethod$1(!0)},userAgent=engineUserAgent,stringPadWebkitBug=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(userAgent),$$M=_export,$padStart=stringPad.start,WEBKIT_BUG=stringPadWebkitBug;function MP4DecSpecificDescrTag(e){var t,r,n=new Box;n.type=e.readUint8(),128===(t=e.readUint8())?(n.extend=!0,e.skip(2),r=(t=e.readUint8()+5)-5):(r=t,t+=2),n.size=t;for(var i=[],a=0;a<r;a++)i.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return n.EScode=i,delete n.subBox,n}function MP4ESDescrTag(e){var t,r=new Box;return r.type=e.readUint8(),128===(t=e.readUint8())?(r.extend=!0,e.skip(2),t=e.readUint8()+5):t+=2,r.size=t,r.esID=e.readUint16(),r.priority=e.readUint8(),r.subBox.push(Box.MP4DecConfigDescrTag(e)),r.subBox.push(Box.SLConfigDescriptor(e)),r}function SLConfigDescriptor(e){var t,r=new Box;return r.type=e.readUint8(),128===(t=e.readUint8())?(r.extend=!0,e.skip(2),t=e.readUint8()+5):t+=2,r.size=t,r.SL=e.readUint8(),delete r.subBox,r}function av01(){var e=new Stream(this.data);for(this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),e.skip(2),this.data_reference_index=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),e.skip(50);e.position<e.buffer.byteLength;){var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e)}delete this.data,e=null}function av1C(){var e=new Stream(this.data),t=e.readUint8();this.marker=t>>7&1,console.assert(1===this.marker,"maker should 1"),this.version=127&t,console.assert(1===this.version,"version shoud 1"),t=e.readUint8(),this.seq_profile=t>>5&7,this.seq_level_idx_0=31&t,t=e.readUint8(),this.seq_tier_0=t>>7&1,this.high_bitdepth=t>>6&1,this.twelve_bit=t>>5&1,this.monochrome=t>>4&1,this.chroma_subsampling_x=t>>3&1,this.chroma_subsampling_y=t>>2&1,this.chroma_sample_position=3&t,t=e.readUint8(),this.initial_presentation_delay_present=t>>4&1,this.initial_presentation_delay_present&&(this.initial_presentation_delay_minus_one=15&t),this.configOBUs=new Uint8Array(e.buffer.slice(e.position))}function avc1$1(){var e=new Stream(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var t=0;t<31;t++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var r=new Box;r.readHeader(e),this.subBox.push(r),r.readBody(e)}delete this.data,e=null}$$M({target:"String",proto:!0,forced:WEBKIT_BUG},{padStart:function(e){return $padStart(this,e,arguments.length>1?arguments[1]:void 0)}});var Golomb=function(){function e(t){_classCallCheck$c(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return _createClass$d(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(r.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),r=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft?r<<t|this.readBits(t):r}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),SPSParser=function(){function e(){_classCallCheck$c(this,e)}return _createClass$d(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)}},{key:"parseSPS",value:function(t){var r=e._ebsp2rbsp(t),n=new Golomb(r);n.readByte();var i=n.readByte();n.readByte();var a=n.readByte();n.readUEG();var o=e.getProfileString(i),s=e.getLevelString(a),l=1,u=420,c=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(3===(l=n.readUEG())&&n.readBits(1),l<=3&&(u=[0,420,422,444][l]),c=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var d=3!==l?8:12,h=0;h<d;h++)n.readBool()&&(h<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var f=n.readUEG();if(0===f)n.readUEG();else if(1===f){n.readBits(1),n.readSEG(),n.readSEG();for(var p=n.readUEG(),y=0;y<p;y++)n.readSEG()}n.readUEG(),n.readBits(1);var m=n.readUEG(),g=n.readUEG(),v=n.readBits(1);0===v&&n.readBits(1),n.readBits(1);var b=0,_=0,E=0,T=0;n.readBool()&&(b=n.readUEG(),_=n.readUEG(),E=n.readUEG(),T=n.readUEG());var S=1,$=1,A=0,w=!0,k=0,I=0;if(n.readBool()){if(n.readBool()){var C=n.readByte();C>0&&C<16?(S=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][C-1],$=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][C-1]):255===C&&(S=n.readByte()<<8|n.readByte(),$=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var P=n.readBits(32),x=n.readBits(32);w=n.readBool(),A=(k=x)/(I=2*P)}}var R=1;1===S&&1===$||(R=S/$);var O=0,L=0;0===l?(O=1,L=2-v):(O=3===l?1:2,L=(1===l?2:1)*(2-v));var D=16*(m+1),M=16*(g+1)*(2-v);D-=(b+_)*O,M-=(E+T)*L;var N=Math.ceil(D*R);return n.destroy(),n=null,{profile_string:o,level_string:s,bit_depth:c,chroma_format:u,chroma_format_string:e.getChromaFormatString(u),frame_rate:{fixed:w,fps:A,fps_den:I,fps_num:k},par_ratio:{width:S,height:$},codec_size:{width:D,height:M},present_size:{width:N,height:M}}}},{key:"_skipScalingList",value:function(e,t){for(var r=8,n=8,i=0;i<t;i++)0!==n&&(n=(r+e.readSEG()+256)%256),r=0===n?r:n}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var r=t.frameRate.fps_den,n=t.frameRate.fps_num;t.refSampleDuration=Math.floor(t.timescale*(r/n))}}]),e}();function avcC$2(){var e=new Stream(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var r=[],n=0;n<t;n++)r.push(e.readUint8());this.spsInfo=SPSParser.parseSPS(new Uint8Array(r)),this.ppsCount=e.readUint8();var i=e.readUint16();this.ppsLength=i;for(var a=[],o=0;o<i;o++)a.push(Number(e.readUint8()).toString(16));this.pps=a,this.sps=r;for(var s=[],l=e.dataview.byteLength;e.position<l;)s.push(e.readUint8());this.last=s,delete this.subBox,delete this.data,e=null}function btrt$1(){var e=new Stream(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null}function co64(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null}function ctts$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var r=0,n=this.entryCount;r<n;r++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null}function dref(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var r=0;r<t;r++){var n=new Box;this.subBox.push(n),n.read(e)}delete this.data,e=null}function elst(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=[],r=e.readUint32();this.entries=t;for(var n=0;n<r;n++){var i={};t.push(i),1===this.version?(i.segment_duration=e.readUint64(),i.media_time=e.readUint64()):(i.segment_duration=e.readUint32(),i.media_time=e.readInt32()),i.media_rate_integer=e.readInt16(),i.media_rate_fraction=e.readInt16()}delete this.subBox,e=null}function enca(){var e=new Stream(this.data);for(e.readUint16(),e.readUint16(),e.readUint16(),this.data_reference_index=e.readUint16(),e.readUint32(),e.readUint32(),this.channelCount=e.readUint16(),this.samplesize=e.readUint16(),e.readUint16(),e.readUint16(),this.sampleRate=e.readUint32()/65536;e.position<e.buffer.byteLength;){var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e)}e=null}function encv(){var e=new Stream(this.data);for(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.readUint32(),this.frame_count=e.readUint16(),e.skip(32),this.depth=e.readUint16(),e.readUint16();e.position<e.buffer.byteLength;){var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e)}e=null}function esds(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);var t=Box.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null}function frma(){var e=new Stream(this.data);this.data_format="";for(var t=0;t<4;t++)this.data_format+=String.fromCharCode(e.readUint8())}function ftyp$1(){}var DESCRIPTORS$e=descriptors,FUNCTION_NAME_EXISTS=functionName.EXISTS,uncurryThis$i=functionUncurryThis,defineProperty$5=objectDefineProperty.f,FunctionPrototype=Function.prototype,functionToString=uncurryThis$i(FunctionPrototype.toString),nameRE=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,regExpExec=uncurryThis$i(nameRE.exec),NAME="name";function hdlr$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),e.skip(4),this.handleType="".concat(String.fromCharCode(e.readUint8())).concat(String.fromCharCode(e.readUint8())).concat(String.fromCharCode(e.readUint8())).concat(String.fromCharCode(e.readUint8())),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,e=null}function iods(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);for(var t=[],r=e.buffer.byteLength;e.position<r;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null}DESCRIPTORS$e&&!FUNCTION_NAME_EXISTS&&defineProperty$5(FunctionPrototype,NAME,{configurable:!0,get:function(){try{return regExpExec(nameRE,functionToString(this))[1]}catch(error){return""}}});var UTC=function(){function e(){_classCallCheck$c(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return _createClass$d(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+Number(e)),this.time.toLocaleString()}}]),e}();function mdhd$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,e=null}function mehd$1(){var e=new Stream(this.data);e.skip(4),this.fragment_duration=e.readUint32()}function mp4a$1(){var e=new Stream(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}function mvhd$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),Stream.readByte(e.dataview,8),Stream.readByte(e.dataview,2);for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,Stream.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox}function pasp(){var e=new Stream(this.data);this.hSpacing=e.readUint32(),this.vSpacing=e.readUint32(),e=null}var global$b=global$T,DESCRIPTORS$d=descriptors,defineBuiltInAccessor$2=defineBuiltInAccessor$4,regExpFlags=regexpFlags$1,fails$g=fails$13,RegExp$2=global$b.RegExp,RegExpPrototype=RegExp$2.prototype,FORCED$8=DESCRIPTORS$d&&fails$g((function(){var e=!0;try{RegExp$2(".","d")}catch(error){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(a.hasIndices="d"),a)i(o,a[o]);return Object.getOwnPropertyDescriptor(RegExpPrototype,"flags").get.call(t)!==n||r!==n}));function pssh$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24();for(var t=[],r=[],n=0;n<16;n++)r.push(util$1.toHex(e.readUint8()));if(this.version>0)for(var i=e.readUint32(),a=0;a<String(i).length;a++)for(var o=0;o<16;o++){var s=e.readUint8();t.push(util$1.toHex(s))}var l=e.readUint32();this.data_size=l,e.skip(l),this.kid=t,this.system_id=r,this.buffer=e.buffer,e=null}function saio(){var e=new Stream(this.data);this.entry_count=e.readUint32(),e=null}function saiz(){var e=new Stream(this.data);this.default_sample_info_size=e.readUint8(),e.readUint32(),this.sample_info_size=e.readUint32(),e=null}function schm(){var e=new Stream(this.data);this.scheme_version=e.readUint32(),this.scheme_type="";for(var t=0;t<4;t++)this.scheme_type+=String.fromCharCode(e.readUint8());if(1&this.flags){this.scheme_uri="";for(var r=0;r<this.size-this.hdr_size-8;r++)this.scheme_uri+=String.fromCharCode(e.readUint8())}}function senc(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24();var t=e.readUint32();if(this.samples=[],t)for(var r=0;r<t;r++){var n={},i=2&this.flags;if(i&&Math.floor(this.data.byteLength/t)<=16?n.InitializationVector=[e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()]:n.InitializationVector=[e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()],i){n.subsamples=[];for(var a=e.readUint16(),o=0;o<a;o++){var s={};s.BytesOfClearData=e.readUint16(),s.BytesOfProtectedData=e.readUint32(),n.subsamples.push(s)}}this.samples.push(n)}}function sidx(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.reference_ID=e.readUint32(),this.timescale=e.readUint32(),0===this.version?(this.earliest_presentation_time=e.readUint32(),this.first_offset=e.readUint32()):(this.earliest_presentation_time=e.readUint64(),this.first_offset=e.readUint64()),e.readUint16(),this.references=[];for(var t=e.readUint16(),r=0;r<t;r++){var n={};this.references.push(n);var i=e.readUint32();n.reference_type=i>>31&1,n.referenced_size=2147483647&i,n.subsegment_duration=e.readUint32(),i=e.readUint32(),n.starts_with_SAP=i>>31&1,n.SAP_type=i>>28&7,n.SAP_delta_time=268435455&i}e=null}function smhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null}function stco$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}function stsc$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var i,a,o=0,s=this.count;o<s-1;o++)i=t[o],a=t[o-1],i.chunk_count=t[o+1].first_chunk-i.first_chunk,i.first_sample=0===o?1:a.first_sample+a.chunk_count*a.samples_per_chunk;if(1===this.count){var l=t[0];l.first_sample=1,l.chunk_count=0}else if(this.count>1){var u=t[this.count-1],c=t[this.count-2];u.first_sample=c.first_sample+c.chunk_count*c.samples_per_chunk,u.chunk_count=0}delete this.subBox,delete this.data,e=null}function stsd$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new Box;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}function stss$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}function stsz$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var r=0,n=this.count;r<n;r++)this.sampleSize?t.push(this.sampleSize):t.push(e.readUint32());delete this.subBox,delete this.data,e=null}function stts$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],r=0,n=this.count;r<n;r++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null}function tenc(){var e=new Stream(this.data);e.skip(6),this.default_IsEncrypted=e.readUint8(),this.default_IV_size=e.readUint8(),this.default_KID=[];for(var t=0;t<16;t++)this.default_KID.push(util$1.toHex(e.readUint8()))}function tfhd$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24(),e.skip(3),this.track_id=e.readUint8(),this.hdr_size=16,this.size>this.hdr_size&&1&this.flags?(this.base_data_offset=e.readUint64(),this.hdr_size=this.hdr_size+8):this.base_data_offset=0,this.size>this.hdr_size&&2&this.flags?(this.default_sample_description_index=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_description_index=0,this.size>this.hdr_size&&8&this.flags?(this.default_sample_duration=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_duration=0,this.size>this.hdr_size&&16&this.flags?(this.default_sample_size=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_size=0,this.size>this.hdr_size&&32&this.flags?(this.default_sample_flags=e.readUint32(),this.hdr_size=this.hdr_size+4):this.default_sample_flags=0}function tkhd$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new UTC).setTime(1e3*this.create),this.modifyTime=(new UTC).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],r=0;r<9;r++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.subBox,e=null}function trun$1(){var e=new Stream(this.data);this.version=e.readUint8(),this.flags=e.readUint24(),this.samples=[],this.sampleInfos=[];var t,r,n=1&this.flags,i=4&this.flags,a=256&this.flags,o=512&this.flags,s=1024&this.flags,l=2048&this.flags,u=e.readUint32();for(n&&(this.dataOffset=e.readUint32()),i&&u&&(r=Box.parseSampleFlags([e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()]));u>0;)u--,t={},a&&(t.duration=e.readUint32()),o&&(t.size=e.readUint32()),s&&(t.flags=Box.parseSampleFlags([e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()])),l&&(t.compositionTimeOffset=e.readUint32()),this.samples.push(t.size),this.sampleInfos.push(t);r&&this.sampleInfos.length>0&&(this.sampleInfos[0].flags=r),delete this.subBox,e=null}FORCED$8&&defineBuiltInAccessor$2(RegExpPrototype,"flags",{configurable:!0,get:regExpFlags});var findBox$1=util$1.findBox;function udta(){}function meta(){var e=new Stream(this.data),t=e.buffer.byteLength;this.version=e.readUint8(),this.flag=Stream.readByte(e.dataview,3);for(var r=this;e.position<t;){var n=new Box;n.readHeader(e),r.subBox.push(n),n.readBody(e)}this.vid=null;var i=findBox$1(r,"keys"),a=findBox$1(r,"ilst");if(i&&a){var o=i.metaKeys.indexOf("comment");if(o>-1){var s=a.datas[o];"string"==typeof s&&s.indexOf("vid")>-1&&(this.vid=s.split(":")[1])}}if(!this.vid&&a)for(var l=0;l<a.datas.length;l++){var u=a.datas[l];if("string"==typeof u&&u.indexOf("vid")>-1){this.vid=u.split(":")[1];break}}delete r.data,e=null}function keys(){var e=new Stream(this.data);e.skip(4),this.count=e.readUint32(),this.metaKeys=[];for(var t=0;t<this.count;t++){var r=e.readUint32();r-=8,"mdta"!==e.readString(4)&&e.skip(r);var n=e.readString(r);this.metaKeys.push(n)}e=null}function ilst(){var e=new Stream(this.data),t=e.buffer.byteLength;for(this.datas=[];e.position<t;){e.skip(4);var r=e.readUint32()-1,n=e.readUint32();if("data"!==e.readString(4))e.skip(n-8);else{e.skip(8);var i=e.readString(n-16);this.datas[r]=i}}e=null}function vmhd(){var e=new Stream(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,e=null}Box.MP4DecConfigDescrTag=MP4DecConfigDescrTag,Box.MP4DecSpecificDescrTag=MP4DecSpecificDescrTag,Box.MP4ESDescrTag=MP4ESDescrTag,Box.SLConfigDescriptor=SLConfigDescriptor,Box.av01=av01,Box.av1C=av1C,Box.avc1=avc1$1,Box.avcC=avcC$2,Box.btrt=btrt$1,Box.co64=co64,Box.ctts=ctts$1,Box.dref=dref,Box.elst=elst,Box.enca=enca,Box.encv=encv,Box.esds=esds,Box.frma=frma,Box.ftyp=ftyp$1,Box.hdlr=hdlr$1,Box.iods=iods,Box.mdhd=mdhd$1,Box.mehd=mehd$1,Box.mp4a=mp4a$1,Box.mvhd=mvhd$1,Box.pasp=pasp,Box.pssh=pssh$1,Box.saio=saio,Box.saiz=saiz,Box.schm=schm,Box.senc=senc,Box.sidx=sidx,Box.smhd=smhd,Box.stco=stco$1,Box.stsc=stsc$1,Box.stsd=stsd$1,Box.stss=stss$1,Box.stsz=stsz$1,Box.stts=stts$1,Box.tenc=tenc,Box.tfhd=tfhd$1,Box.tkhd=tkhd$1,Box.trun=trun$1,Box.udta=udta,Box.meta=meta,Box.ilst=ilst,Box.keys=keys,Box.vmhd=vmhd;var Parse=_createClass$d((function e(t){_classCallCheck$c(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;var r=this;r.buffer?lib$1(Uint8Array,r.buffer,t):r.buffer=t;var n=t.byteLength;t.position=0;for(var i=new Stream(t);n-i.position>=8;){var a=new Box;if(a.readHeader(i),a.size-8<=n-i.position)a.readBody(i),r.boxes.push(a);else{if("mdat"!==a.type){r.nextBox=a,i.position-=8;break}a.readBody(i),r.boxes.push(a)}}r.buffer=new Uint8Array(r.buffer.slice(i.position))})),_CodecsConfigMap,CodecsItem=_createClass$d((function e(t,r,n,i,a,o){_classCallCheck$c(this,e),this.type=t,this.codecs=r,this.visualEntryBox=n,this.configurationBox=i,this.types=a,this.logCodeType=o})),CodecsTypes={AVC:"avc",AV1:"av1"},CodecsConfigMap=(_CodecsConfigMap={},_defineProperty$c(_CodecsConfigMap,CodecsTypes.AVC,new CodecsItem("avc","avc1.64001E","avc1","avcC",["h264"],"h264")),_defineProperty$c(_CodecsConfigMap,CodecsTypes.AV1,new CodecsItem("av1","av01.0.08M.08","av01","av1C",["av1"],"av1")),_CodecsConfigMap),MPD=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;_classCallCheck$c(this,t),EventEmitter(this),this.url=e,this.options=r,this.dash=n,this.mediaList={video:[],audio:[]},this.retryMax=10,this.retry=0,this.type="live",this.isEnd=!1,this.duration=0,this.videoCodecType=null,this.videoCodecs=null,this.hasSync=!1}var r;return _createClass$d(t,[{key:"calcVideoCodeType",value:function(e,t){if((e||t)&&!this.videoCodecType){var r=null;t?r=t.split(".")[0]:e&&(r=e.split(".")[0]);for(var n=Object.keys(CodecsConfigMap),i=0;i<n.length;i++){var a=n[i],o=CodecsConfigMap[a];if(o.types.concat(o.visualEntryBox).indexOf(r)>-1){this.videoCodecType=a,this.videoCodecs=o.codecs;break}}debug$2.log("mpd dataType:",e,"codecs:",t,"cal type:",this.videoCodecType,"videoCodecs",this.videoCodecs),this.videoCodecType||(this.videoCodecType=CodecsTypes.AVC,this.videoCodecs=CodecsConfigMap[CodecsTypes.AVC].codecs,console.warn("calcVideoCodeType default")),this.dash&&this.dash._pluginInst&&this.dash._pluginInst.setCodeInfo(this.videoCodecType)}}},{key:"fetch",value:(r=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(r){var n,i,a,o=this;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,i={TYPE:"LIVE",ENDLIST:""},a=[],e.abrupt("return",new Promise((function(e,s){new XHR$1({type:"",url:r}).then((function(l){var u=l.responseText;if(u){var c=t.parseMPD(u);c||s(new Error("parse mpd error"));var d=[];"static"===c.type&&(i.TYPE="VOD"),c.minBufferTime&&(i.minBufferTime=util$1.durationConvert(c.minBufferTime)),c.maxSegmentDuration&&(i.maxSegmentDuration=util$1.durationConvert(c.maxSegmentDuration)),c.mediaPresentationDuration&&(n.duration=util$1.durationConvert(c.mediaPresentationDuration));var h="";c.BaseURL&&(h=c.BaseURL[0]);var f=c.Period[0];!n.duration&&f&&f.duration&&(n.duration=util$1.durationConvert(f.duration)),i.duration=n.duration,f.AdaptationSet&&f.AdaptationSet.length>1&&f.AdaptationSet.forEach((function(e){var t="video/mp4",i="avc1.64001E",a="640",s="360",l="25",u="1:1",c="1",f="588633";e.mimeType&&("video/mp4"===(t=e.mimeType)?(i=e.codecs,a=parseFloat(e.width),s=parseFloat(e.height),l=parseFloat(e.frameRate),u=e.sar,c=e.startWithSAP,f=parseFloat(e.bandwidth),n.calcVideoCodeType(null,i)):"audio/mp4"===t&&(i=e.codecs,c=e.startWithSAP,f=parseFloat(e.bandwidth))),e.Representation.forEach((function(p){d.indexOf(p.id)>-1&&(p.id=(parseInt(d[d.length-1],10)+1).toString()),d.push(p.id);var y,m="",g=[],v=0,b=0,_=r.slice(0,r.lastIndexOf("/")+1)+h;p.mimeType&&(t=p.mimeType),p.mimeType&&(t=p.mimeType),"video/mp4"===t?(p.codecs&&(i=p.codecs,n.calcVideoCodeType(null,i)),p.width&&(a=parseFloat(p.width)),p.height&&(s=parseFloat(p.height)),p.frameRate&&(l=parseFloat(p.frameRate)),p.sar&&(u=p.sar),p.startWithSAP&&(c=p.startWithSAP),p.bandwidth&&(f=parseFloat(p.bandwidth))):"audio/mp4"===t&&(p.codecs&&(i=p.codecs),p.startWithSAP&&(c=p.startWithSAP),p.bandwidth&&(f=parseFloat(p.bandwidth))),p.BaseURL&&p.BaseURL.length>0&&(_+=p.BaseURL[0]),e.SegmentTemplate&&e.SegmentTemplate.length>0&&(y=e.SegmentTemplate[0]),p.SegmentTemplate&&p.SegmentTemplate.length>0&&(y=p.SegmentTemplate[0]);var E=!1;if((e.ContentProtection||p.ContentProtection)&&(E=!0),y){m=y.initialization,v=parseFloat(y.timescale),b=parseFloat(y.duration);for(var T=Math.round(b/v),S=parseInt(y.startNumber,10),$=S+Math.ceil(n.duration/T)-1,A=S;A<=$;A++){var w=T*(A-S),k=T*(A-S+1);A===$&&(T=n.duration-T*($-S),k=n.duration),g.push({idx:A,start:Math.round(w),end:Math.round(k),url:_+y.media.replace("$RepresentationID$",p.id).replace("$Number%04d$",util$1.preFixInterge(A,4)),downloaded:0,segmentDuration:T,height:s})}}if(f=parseInt(f),"video/mp4"===t){var I,C;if(o.options.dynamic_video&&o.options.dynamic_video.dynamic_video_list)for(var P=0;P<o.options.dynamic_video.dynamic_video_list.length;P++){var x=o.options.dynamic_video.dynamic_video_list[P];x.bitrate===f&&(I=x.size,C=x.definition)}n.mediaList.video.push({id:p.id,baseURL:_,initSegment:_+m.replace("$RepresentationID$",p.id),inited:!1,mediaSegments:g,mimeType:t,codecs:i,width:a,height:s,size:I,frameRate:l,sar:u,startWithSAP:c,bandwidth:f,timescale:v,duration:b,encrypted:E,definition:C})}else if("audio/mp4"===t){var R;if(o.options.dynamic_video&&o.options.dynamic_video.dynamic_audio_list)for(var O=0;O<o.options.dynamic_video.dynamic_audio_list.length;O++)o.options.dynamic_video.dynamic_audio_list[O].bitrate===f&&(R=o.options.dynamic_video.dynamic_audio_list[O].size);n.mediaList.audio.push({id:p.id,baseURL:_,initSegment:_+m.replace("$RepresentationID$",p.id),inited:!1,mediaSegments:g,mimeType:t,codecs:i,startWithSAP:c,bandwidth:f,size:R,timescale:v,duration:b,encrypted:E})}}))})),["video","audio"].forEach((function(e){n.mediaList[e].length>0&&(n.mediaList[e].selectedIdx="video"===e&&n.dash.selectedIdx||0,"video"===e&&n.mediaList[e].sort((function(t,r){return"video"===e?r.height-t.height:r.bandwidth-t.bandwidth})))})),0===n.mediaList.video.length&&0===n.mediaList.audio.length&&setTimeout((function(){n.dash.player&&n.dash.player.emit("NO_MEDIALIST",{dynamic_type:"segment_template"})})),e({meta:i,segments:a})}else n.dash.emit("error",new Errors(Errors.PARSE,Errors.MPD_PARSE_ERROR,{line:253,handle:"[MPD] parse",msg:"mpd segment template Parse error",url:r},n.dash.player)),s()})).catch((function(e){var t=403===e.status?TASK_REQUEST_EXPIRED:"mpd Request error";n.dash.emit("error",new Errors(Errors.PD_NETWORK,Errors.NETEORK_ERROR_CODES[e&&e.status?e.status:"timeout"],{line:258,handle:"[MPD] xhr",msg:t,url:r},n.dash.player)),s(e)}))})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"init",value:function(e){var t=this,r=t.options;if(r.dynamic_video.dynamic_type&&"segment_template"!==r.dynamic_video.dynamic_type){t.dashType="segment_base";var n=0;r.duration;var i=r.dynamic_video;["dynamic_video_list","dynamic_audio_list"].forEach((function(e){var a="dynamic_audio_list"===e;i[e].forEach((function(i){var o=parseInt(i.init_range.split("-")[0],10),s=parseInt(i.init_range.split("-")[1],10),l=parseInt(i.index_range.split("-")[0],10),u=parseInt(i.index_range.split("-")[1],10);a||t.calcVideoCodeType(i.codec_type),t.mediaList["dynamic_audio_list"===e?"audio":"video"].push({id:("dynamic_audio_list"===e?0:n++).toString(),baseURL:i.main_url,initSegment:i.main_url,initSegmentRange:[o,s],sidxRange:[l,u],inited:!1,hasSidx:!1,mediaSegments:[],mimeType:a?"audio/mp4":"video/mp4",codecs:a?"mp4a.40.2":i.codec_type&&i.codec_type.indexOf("h265")>-1?"hev1.1.6.L93.B0":t.videoCodecs,width:i.vwidth,height:i.vheight,bandwidth:parseInt(i.bitrate),size:i.size,timescale:-1,duration:r.duration,encrypted:i.encrypt,kid:i.kid,definition:i.definition,sidxRes:void 0})}))})),t.type="vod",["video","audio"].forEach((function(e){t.mediaList[e].length>0&&(t.mediaList[e].selectedIdx="video"===e&&t.dash.selectedIdx||0,"video"===e&&t.mediaList[e].sort((function(t,r){return"video"===e?r.height-t.height:r.bandwidth-t.bandwidth})))})),0===t.mediaList.video.length&&0===t.mediaList.audio.length&&t.dash&&t.dash.player&&setTimeout((function(){t.dash.player.emit("NO_MEDIALIST",{dynamic_type:"segment_base"})})),t.emit("ready")}else t.dashType="segment_template",t.fetch(r.dynamic_video.main_url).then((function(e){t.type=e.meta.TYPE.toLocaleLowerCase(),t.emit("ready")}),(function(){["video","audio"].forEach((function(e){t.mediaList[e]=[]})),t.retry++,t.retry,t.retryMax}))}},{key:"getSidx",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,a=this,o=a.mediaList[r][n],s=o.sidxRange[1];o.sidxFetching=!0;try{var l=t instanceof ArrayBuffer?t:t.buffer;new Parse(l).boxes.every((function(e){if("sidx"===e.type){var r=[],n=0,a=0,l=s+1,u=l-1;return e.references.forEach((function(t,i){a+=t.subsegment_duration,u+=t.referenced_size,r.push({idx:i+1,url:o.initSegment,start:Math.round(n/e.timescale),end:Math.round(a/e.timescale),startRaw:n/e.timescale,endRaw:a/e.timescale,range:[l,u],downloaded:0,segmentDuration:Math.round(t.subsegment_duration/e.timescale),reference_type:t.reference_type,starts_with_SAP:t.starts_with_SAP,SAP_type:t.SAP_type,SAP_delta_time:t.SAP_delta_time}),n=a+1,l=u+1})),r[0].startTime_=0,o.mediaDuration=0,r.forEach((function(e,t){o.mediaDuration+=e.segmentDuration,t>0&&(e.startTime_=r[t-1].startTime_+r[t-1].segmentDuration),t===r.length-1&&i&&(e.end=i)})),o.hasSidx=!0,o.mediaSegments=r,o.timescale=e.timescale,o.sidxRes=t,!1}return!0})),o.sidxFetching=!1}catch(e){throw o.sidxFetching=!1,a.dash.reportMonitorEvent(SIDX_EXCEPTION),new Errors(Errors.PARSE,Errors.SID_PARSE_ERROR,{line:398,handle:"[MPD] getSidx",msg:"mpd segment base Parse getSidx error"},a.dash.player)}}},{key:"checkInBuffered",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=this.dash.mse.buffered(e);if(!o)return!1;var s=this._inBufferd(t,i,o,n),l=this._inBufferd(r,a,o,n);return!(!s.in||!l.in||s.index!==l.index)}},{key:"_inBufferd",value:function(e,t,r,n){for(var i=0;i<r.length;i++){var a=util$1.round(r.start(i)),o=util$1.round(r.end(i));if(a<=e&&e<=o)return{index:i,in:!0};if(a<=t&&t<=o)return{index:i,in:!0}}return{in:!1}}},{key:"_doSyncAV",value:function(){var e=this.mediaList;if(!this.hasSync){var t=!1;if(e.video.length<1&&(t=!0),e.audio.length<1&&(t=!0),!t){var r=this.mediaList.video[this.mediaList.video.selectedIdx].mediaSegments,n=this.mediaList.audio[this.mediaList.audio.selectedIdx].mediaSegments,i=Math.min(r.length,n.length),a=n[i-1],o=r[i-1];a.incomplete=!0,o.incomplete=!0}this.hasSync=!0}}},{key:"syncAV",value:function(){this.hasSync=!1}},{key:"seek",value:function(e,t){var r=this;debug$2.log("mpd seek: ".concat(e));var n=this;this._doSyncAV();var i={};return new Promise((function(a,o){"vod"===r.type||void 0!==e?(["video","audio"].forEach((function(r){if(n.mediaList[r].length<1)return!0;var a=n.mediaList[r][n.mediaList[r].selectedIdx].mediaSegments;i[r]=a.filter((function(i,a){if(i.downloaded===SEGMENT_STATE.APPEND){if(n.checkInBuffered(r,i.start,i.end,0,i.startRaw,i.endRaw))return!1;if(i.incomplete)return!1;debug$2.log("".concat(r," ").concat(a," start:").concat(i.start," end:").concat(i.end," segment downloaded set false")),i.downloaded=SEGMENT_STATE.NO_START}var o=i.start>=t&&i.end<=e,s=i.start<=e&&e<=i.end;return!(!o&&!s||i.downloaded!==SEGMENT_STATE.NO_START)}))})),a(i)):o("media error2")}))}},{key:"clearBuffer",value:function(e,t,r){var n=this,i=r?[r]:["video","audio"];"vod"===n.type&&i.forEach((function(r){n.mediaList[r].length>0&&n.mediaList[r][n.mediaList[r].selectedIdx].mediaSegments.forEach((function(n,i){n.end<e||n.start>t||(debug$2.log("".concat(r," ").concat(i," start:").concat(n.start," end:").concat(n.end," segment downloaded set false")),n.downloaded=SEGMENT_STATE.NO_START)}))}))}}],[{key:"parseMPD",value:function(e){var t;if("string"==typeof e&&(t=e),e instanceof ArrayBuffer){var r=new Uint8Array(e);t=String.fromCharCode.apply(null,r)}if(!t)return null;var n=performance.now();return t=t.replace(/<(\/)?(\w+:)+(\w+)/g,"<$1$3"),debug$2.log("MPD cost",performance.now()-n),Xml2Json.parse(t)}},{key:"parseTime",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e.getAttribute(r);i&&(t[n||r]=util$1.durationConvert(i))}}]),t}();function ownKeys$b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$b(Object(r),!0).forEach((function(t){_defineProperty$b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$6(){_regeneratorRuntime$6=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(w){s=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i,a,o,s,l=t&&t.prototype instanceof d?t:d,h=Object.create(l.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=_(r,o);if(n){if(n===c)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var l=u(i,a,o);if("normal"===l.type){if(s=o.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(s="completed",o.method="throw",o.arg=l.arg)}}),h}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(w){return{type:"throw",arg:w}}}e.wrap=l;var c={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y($([])));m&&m!==t&&r.call(m,i)&&(p=m);var g=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(i,a,o,s){var l=u(e[i],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function $(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=f,s(g,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},v(b.prototype),s(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new b(l(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(g),s(g,o,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=$,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:$(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}function _typeof$6(e){return(_typeof$6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$8(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$8(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$8(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$8(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$b(e,t,r){return t&&_defineProperties$b(e.prototype,t),r&&_defineProperties$b(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$8(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$8(e,t)}function _getPrototypeOf$8(e){return(_getPrototypeOf$8=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$8(e,t){return(_setPrototypeOf$8=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$4(e,t,r){return(_construct$4=_isNativeReflectConstruct$b()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$8(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$4(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$4(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$4=function(e){if(null===e||!_isNativeFunction$4(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$4(e,arguments,_getPrototypeOf$8(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$8(r,e)},_wrapNativeSuper$4(e)}function _objectWithoutPropertiesLoose$3(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$3(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$3(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$8(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$8(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$8(e)}function _createSuper$b(e){var t=_isNativeReflectConstruct$b();return function(){var r,n=_getPrototypeOf$8(e);if(t){var i=_getPrototypeOf$8(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$8(this,r)}}function _unsupportedIterableToArray$8(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$8(e,t):void 0}}function _arrayLikeToArray$8(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper$2(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$8(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}var fails$f=fails$13,wellKnownSymbol$4=wellKnownSymbol$t,IS_PURE=isPure,ITERATOR$3=wellKnownSymbol$4("iterator"),urlConstructorDetection=!fails$f((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),IS_PURE&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[ITERATOR$3]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),anObject$5=anObject$r,iteratorClose=iteratorClose$2,callWithSafeIterationClosing$1=function(e,t,r,n){try{return n?t(anObject$5(r)[0],r[1]):t(r)}catch(error){iteratorClose(e,"throw",error)}},bind$4=functionBindContext,call$3=functionCall,toObject$6=toObject$m,callWithSafeIterationClosing=callWithSafeIterationClosing$1,isArrayIteratorMethod=isArrayIteratorMethod$3,isConstructor=isConstructor$4,lengthOfArrayLike$6=lengthOfArrayLike$r,createProperty$2=createProperty$6,getIterator$1=getIterator$4,getIteratorMethod$1=getIteratorMethod$5,$Array$1=Array,arrayFrom$1=function(e){var t=toObject$6(e),r=isConstructor(this),n=arguments.length,i=n>1?arguments[1]:void 0,a=void 0!==i;a&&(i=bind$4(i,n>2?arguments[2]:void 0));var o,s,l,u,c,d,h=getIteratorMethod$1(t),f=0;if(!h||this===$Array$1&&isArrayIteratorMethod(h))for(o=lengthOfArrayLike$6(t),s=r?new this(o):$Array$1(o);o>f;f++)d=a?i(t[f],f):t[f],createProperty$2(s,f,d);else for(c=(u=getIterator$1(t,h)).next,s=r?new this:[];!(l=call$3(c,u)).done;f++)d=a?callWithSafeIterationClosing(u,i,[l.value,f],!0):l.value,createProperty$2(s,f,d);return s.length=f,s},uncurryThis$h=functionUncurryThis,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexNonASCII=/[^\0-\u007E]/,regexSeparators=/[.\u3002\uFF0E\uFF61]/g,OVERFLOW_ERROR="Overflow: input needs wider integers to process",baseMinusTMin=base-tMin,$RangeError$1=RangeError,exec$4=uncurryThis$h(regexSeparators.exec),floor$2=Math.floor,fromCharCode$1=String.fromCharCode,charCodeAt$1=uncurryThis$h("".charCodeAt),join$2=uncurryThis$h([].join),push$6=uncurryThis$h([].push),replace$6=uncurryThis$h("".replace),split$2=uncurryThis$h("".split),toLowerCase$1=uncurryThis$h("".toLowerCase),ucs2decode=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=charCodeAt$1(e,r++);if(i>=55296&&i<=56319&&r<n){var a=charCodeAt$1(e,r++);56320==(64512&a)?push$6(t,((1023&i)<<10)+(1023&a)+65536):(push$6(t,i),r--)}else push$6(t,i)}return t},digitToBasic=function(e){return e+22+75*(e<26)},adapt=function(e,t,r){var n=0;for(e=r?floor$2(e/damp):e>>1,e+=floor$2(e/t);e>baseMinusTMin*tMax>>1;)e=floor$2(e/baseMinusTMin),n+=base;return floor$2(n+(baseMinusTMin+1)*e/(e+skew))},encode$3=function(e){var t,r,n=[],i=(e=ucs2decode(e)).length,a=initialN,o=0,s=initialBias;for(t=0;t<e.length;t++)(r=e[t])<128&&push$6(n,fromCharCode$1(r));var l=n.length,u=l;for(l&&push$6(n,delimiter);u<i;){var c=maxInt;for(t=0;t<e.length;t++)(r=e[t])>=a&&r<c&&(c=r);var d=u+1;if(c-a>floor$2((maxInt-o)/d))throw $RangeError$1(OVERFLOW_ERROR);for(o+=(c-a)*d,a=c,t=0;t<e.length;t++){if((r=e[t])<a&&++o>maxInt)throw $RangeError$1(OVERFLOW_ERROR);if(r==a){for(var h=o,f=base;;){var p=f<=s?tMin:f>=s+tMax?tMax:f-s;if(h<p)break;var y=h-p,m=base-p;push$6(n,fromCharCode$1(digitToBasic(p+y%m))),h=floor$2(y/m),f+=base}push$6(n,fromCharCode$1(digitToBasic(h))),s=adapt(o,d,u==l),o=0,u++}}o++,a++}return join$2(n,"")},stringPunycodeToAscii=function(e){var t,r,n=[],i=split$2(replace$6(toLowerCase$1(e),regexSeparators,"."),".");for(t=0;t<i.length;t++)r=i[t],push$6(n,exec$4(regexNonASCII,r)?"xn--"+encode$3(r):r);return join$2(n,".")},$$L=_export,global$a=global$T,call$2=functionCall,uncurryThis$g=functionUncurryThis,DESCRIPTORS$c=descriptors,USE_NATIVE_URL$1=urlConstructorDetection,defineBuiltIn$5=defineBuiltIn$m,defineBuiltIns=defineBuiltIns$2,setToStringTag$6=setToStringTag$c,createIteratorConstructor=iteratorCreateConstructor,InternalStateModule$3=internalState,anInstance$3=anInstance$9,isCallable$1=isCallable$v,hasOwn$a=hasOwnProperty_1,bind$3=functionBindContext,classof=classof$c,anObject$4=anObject$r,isObject$8=isObject$w,$toString$2=toString$w,create$3=objectCreate$1,createPropertyDescriptor$4=createPropertyDescriptor$d,getIterator=getIterator$4,getIteratorMethod=getIteratorMethod$5,validateArgumentsLength$2=validateArgumentsLength$8,wellKnownSymbol$3=wellKnownSymbol$t,arraySort=arraySort$1,ITERATOR$2=wellKnownSymbol$3("iterator"),URL_SEARCH_PARAMS="URLSearchParams",URL_SEARCH_PARAMS_ITERATOR=URL_SEARCH_PARAMS+"Iterator",setInternalState$3=InternalStateModule$3.set,getInternalParamsState=InternalStateModule$3.getterFor(URL_SEARCH_PARAMS),getInternalIteratorState=InternalStateModule$3.getterFor(URL_SEARCH_PARAMS_ITERATOR),getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,safeGetBuiltIn=function(e){if(!DESCRIPTORS$c)return global$a[e];var t=getOwnPropertyDescriptor$1(global$a,e);return t&&t.value},nativeFetch=safeGetBuiltIn("fetch"),NativeRequest=safeGetBuiltIn("Request"),Headers$1=safeGetBuiltIn("Headers"),RequestPrototype=NativeRequest&&NativeRequest.prototype,HeadersPrototype=Headers$1&&Headers$1.prototype,RegExp$1=global$a.RegExp,TypeError$3=global$a.TypeError,decodeURIComponent$1=global$a.decodeURIComponent,encodeURIComponent$1=global$a.encodeURIComponent,charAt$4=uncurryThis$g("".charAt),join$1=uncurryThis$g([].join),push$5=uncurryThis$g([].push),replace$5=uncurryThis$g("".replace),shift$1=uncurryThis$g([].shift),splice=uncurryThis$g([].splice),split$1=uncurryThis$g("".split),stringSlice$4=uncurryThis$g("".slice),plus=/\+/g,sequences=Array(4),percentSequence=function(e){return sequences[e-1]||(sequences[e-1]=RegExp$1("((?:%[\\da-f]{2}){"+e+"})","gi"))},percentDecode=function(e){try{return decodeURIComponent$1(e)}catch(error){return e}},deserialize=function(e){var t=replace$5(e,plus," "),r=4;try{return decodeURIComponent$1(t)}catch(error){for(;r;)t=replace$5(t,percentSequence(r--),percentDecode);return t}},find=/[!'()~]|%20/g,replacements={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},replacer=function(e){return replacements[e]},_serialize=function(e){return replace$5(encodeURIComponent$1(e),find,replacer)},URLSearchParamsIterator=createIteratorConstructor((function(e,t){setInternalState$3(this,{type:URL_SEARCH_PARAMS_ITERATOR,iterator:getIterator(getInternalParamsState(e).entries),kind:t})}),"Iterator",(function(){var e=getInternalIteratorState(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),URLSearchParamsState=function(e){this.entries=[],this.url=null,void 0!==e&&(isObject$8(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===charAt$4(e,0)?stringSlice$4(e,1):e:$toString$2(e)))};URLSearchParamsState.prototype={type:URL_SEARCH_PARAMS,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,a,o,s,l=getIteratorMethod(e);if(l)for(r=(t=getIterator(e,l)).next;!(n=call$2(r,t)).done;){if(a=(i=getIterator(anObject$4(n.value))).next,(o=call$2(a,i)).done||(s=call$2(a,i)).done||!call$2(a,i).done)throw TypeError$3("Expected sequence with length 2");push$5(this.entries,{key:$toString$2(o.value),value:$toString$2(s.value)})}else for(var u in e)hasOwn$a(e,u)&&push$5(this.entries,{key:u,value:$toString$2(e[u])})},parseQuery:function(e){if(e)for(var t,r,n=split$1(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=split$1(t,"="),push$5(this.entries,{key:deserialize(shift$1(r)),value:deserialize(join$1(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],push$5(r,_serialize(e.key)+"="+_serialize(e.value));return join$1(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var URLSearchParamsConstructor=function(){anInstance$3(this,URLSearchParamsPrototype);var e=arguments.length>0?arguments[0]:void 0;setInternalState$3(this,new URLSearchParamsState(e))},URLSearchParamsPrototype=URLSearchParamsConstructor.prototype;if(defineBuiltIns(URLSearchParamsPrototype,{append:function(e,t){validateArgumentsLength$2(arguments.length,2);var r=getInternalParamsState(this);push$5(r.entries,{key:$toString$2(e),value:$toString$2(t)}),r.updateURL()},delete:function(e){validateArgumentsLength$2(arguments.length,1);for(var t=getInternalParamsState(this),r=t.entries,n=$toString$2(e),i=0;i<r.length;)r[i].key===n?splice(r,i,1):i++;t.updateURL()},get:function(e){validateArgumentsLength$2(arguments.length,1);for(var t=getInternalParamsState(this).entries,r=$toString$2(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){validateArgumentsLength$2(arguments.length,1);for(var t=getInternalParamsState(this).entries,r=$toString$2(e),n=[],i=0;i<t.length;i++)t[i].key===r&&push$5(n,t[i].value);return n},has:function(e){validateArgumentsLength$2(arguments.length,1);for(var t=getInternalParamsState(this).entries,r=$toString$2(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){validateArgumentsLength$2(arguments.length,1);for(var r,n=getInternalParamsState(this),i=n.entries,a=!1,o=$toString$2(e),s=$toString$2(t),l=0;l<i.length;l++)(r=i[l]).key===o&&(a?splice(i,l--,1):(a=!0,r.value=s));a||push$5(i,{key:o,value:s}),n.updateURL()},sort:function(){var e=getInternalParamsState(this);arraySort(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=getInternalParamsState(this).entries,n=bind$3(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new URLSearchParamsIterator(this,"keys")},values:function(){return new URLSearchParamsIterator(this,"values")},entries:function(){return new URLSearchParamsIterator(this,"entries")}},{enumerable:!0}),defineBuiltIn$5(URLSearchParamsPrototype,ITERATOR$2,URLSearchParamsPrototype.entries,{name:"entries"}),defineBuiltIn$5(URLSearchParamsPrototype,"toString",(function(){return getInternalParamsState(this).serialize()}),{enumerable:!0}),setToStringTag$6(URLSearchParamsConstructor,URL_SEARCH_PARAMS),$$L({global:!0,constructor:!0,forced:!USE_NATIVE_URL$1},{URLSearchParams:URLSearchParamsConstructor}),!USE_NATIVE_URL$1&&isCallable$1(Headers$1)){var headersHas=uncurryThis$g(HeadersPrototype.has),headersSet=uncurryThis$g(HeadersPrototype.set),wrapRequestOptions=function(e){if(isObject$8(e)){var t,r=e.body;if(classof(r)===URL_SEARCH_PARAMS)return t=e.headers?new Headers$1(e.headers):new Headers$1,headersHas(t,"content-type")||headersSet(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),create$3(e,{body:createPropertyDescriptor$4(0,$toString$2(r)),headers:createPropertyDescriptor$4(0,t)})}return e};if(isCallable$1(nativeFetch)&&$$L({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return nativeFetch(e,arguments.length>1?wrapRequestOptions(arguments[1]):{})}}),isCallable$1(NativeRequest)){var RequestConstructor=function(e){return anInstance$3(this,RequestPrototype),new NativeRequest(e,arguments.length>1?wrapRequestOptions(arguments[1]):{})};RequestPrototype.constructor=RequestConstructor,RequestConstructor.prototype=RequestPrototype,$$L({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:RequestConstructor})}}var web_urlSearchParams_constructor={URLSearchParams:URLSearchParamsConstructor,getState:getInternalParamsState},$$K=_export,DESCRIPTORS$b=descriptors,USE_NATIVE_URL=urlConstructorDetection,global$9=global$T,bind$2=functionBindContext,uncurryThis$f=functionUncurryThis,defineBuiltIn$4=defineBuiltIn$m,defineBuiltInAccessor$1=defineBuiltInAccessor$4,anInstance$2=anInstance$9,hasOwn$9=hasOwnProperty_1,assign$1=objectAssign,arrayFrom=arrayFrom$1,arraySlice=arraySliceSimple,codeAt=stringMultibyte.codeAt,toASCII=stringPunycodeToAscii,$toString$1=toString$w,setToStringTag$5=setToStringTag$c,validateArgumentsLength$1=validateArgumentsLength$8,URLSearchParamsModule=web_urlSearchParams_constructor,InternalStateModule$2=internalState,setInternalState$2=InternalStateModule$2.set,getInternalURLState=InternalStateModule$2.getterFor("URL"),URLSearchParams$1=URLSearchParamsModule.URLSearchParams,getInternalSearchParamsState=URLSearchParamsModule.getState,NativeURL=global$9.URL,TypeError$2=global$9.TypeError,parseInt$1=global$9.parseInt,floor$1=Math.floor,pow$1=Math.pow,charAt$3=uncurryThis$f("".charAt),exec$3=uncurryThis$f(/./.exec),join=uncurryThis$f([].join),numberToString$1=uncurryThis$f(1..toString),pop=uncurryThis$f([].pop),push$4=uncurryThis$f([].push),replace$4=uncurryThis$f("".replace),shift=uncurryThis$f([].shift),split=uncurryThis$f("".split),stringSlice$3=uncurryThis$f("".slice),toLowerCase=uncurryThis$f("".toLowerCase),unshift=uncurryThis$f([].unshift),INVALID_AUTHORITY="Invalid authority",INVALID_SCHEME="Invalid scheme",INVALID_HOST="Invalid host",INVALID_PORT="Invalid port",ALPHA=/[a-z]/i,ALPHANUMERIC=/[\d+-.a-z]/i,DIGIT=/\d/,HEX_START=/^0x/i,OCT=/^[0-7]+$/,DEC=/^\d+$/,HEX=/^[\da-f]+$/i,FORBIDDEN_HOST_CODE_POINT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT=/[\0\t\n\r #/:<>?@[\\\]^|]/,LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,TAB_AND_NEW_LINE=/[\t\n\r]/g,EOF,parseIPv4=function(e){var t,r,n,i,a,o,s,l=split(e,".");if(l.length&&""==l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=l[n]))return e;if(a=10,i.length>1&&"0"==charAt$3(i,0)&&(a=exec$3(HEX_START,i)?16:8,i=stringSlice$3(i,8==a?1:2)),""===i)o=0;else{if(!exec$3(10==a?DEC:8==a?OCT:HEX,i))return e;o=parseInt$1(i,a)}push$4(r,o)}for(n=0;n<t;n++)if(o=r[n],n==t-1){if(o>=pow$1(256,5-t))return null}else if(o>255)return null;for(s=pop(r),n=0;n<r.length;n++)s+=r[n]*pow$1(256,3-n);return s},parseIPv6=function(e){var t,r,n,i,a,o,s,l=[0,0,0,0,0,0,0,0],u=0,c=null,d=0,h=function(){return charAt$3(e,d)};if(":"==h()){if(":"!=charAt$3(e,1))return;d+=2,c=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=r=0;r<4&&exec$3(HEX,h());)t=16*t+parseInt$1(h(),16),d++,r++;if("."==h()){if(0==r)return;if(d-=r,u>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;d++}if(!exec$3(DIGIT,h()))return;for(;exec$3(DIGIT,h());){if(a=parseInt$1(h(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;d++}l[u]=256*l[u]+i,2!=++n&&4!=n||u++}if(4!=n)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;l[u++]=t}else{if(null!==c)return;d++,c=++u}}if(null!==c)for(o=u-c,u=7;0!=u&&o>0;)s=l[u],l[u--]=l[c+o-1],l[c+--o]=s;else if(8!=u)return;return l},findLongestZeroSequence=function(e){for(var t=null,r=1,n=null,i=0,a=0;a<8;a++)0!==e[a]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=a),++i);return i>r&&(t=n,r=i),t},serializeHost=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)unshift(t,e%256),e=floor$1(e/256);return join(t,".")}if("object"==_typeof$b(e)){for(t="",n=findLongestZeroSequence(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=numberToString$1(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},C0ControlPercentEncodeSet={},fragmentPercentEncodeSet=assign$1({},C0ControlPercentEncodeSet,{" ":1,'"':1,"<":1,">":1,"`":1}),pathPercentEncodeSet=assign$1({},fragmentPercentEncodeSet,{"#":1,"?":1,"{":1,"}":1}),userinfoPercentEncodeSet=assign$1({},pathPercentEncodeSet,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),percentEncode=function(e,t){var r=codeAt(e,0);return r>32&&r<127&&!hasOwn$9(t,e)?e:encodeURIComponent(e)},specialSchemes={ftp:21,file:null,http:80,https:443,ws:80,wss:443},isWindowsDriveLetter=function(e,t){var r;return 2==e.length&&exec$3(ALPHA,charAt$3(e,0))&&(":"==(r=charAt$3(e,1))||!t&&"|"==r)},startsWithWindowsDriveLetter=function(e){var t;return e.length>1&&isWindowsDriveLetter(stringSlice$3(e,0,2))&&(2==e.length||"/"===(t=charAt$3(e,2))||"\\"===t||"?"===t||"#"===t)},isSingleDot=function(e){return"."===e||"%2e"===toLowerCase(e)},isDoubleDot=function(e){return".."===(e=toLowerCase(e))||"%2e."===e||".%2e"===e||"%2e%2e"===e},SCHEME_START={},SCHEME={},NO_SCHEME={},SPECIAL_RELATIVE_OR_AUTHORITY={},PATH_OR_AUTHORITY={},RELATIVE={},RELATIVE_SLASH={},SPECIAL_AUTHORITY_SLASHES={},SPECIAL_AUTHORITY_IGNORE_SLASHES={},AUTHORITY={},HOST={},HOSTNAME={},PORT={},FILE={},FILE_SLASH={},FILE_HOST={},PATH_START={},PATH={},CANNOT_BE_A_BASE_URL_PATH={},QUERY={},FRAGMENT={},URLState=function e(t,r,n){var i,a,o,s=$toString$1(t);if(r){if(a=this.parse(s))throw TypeError$2(a);this.searchParams=null}else{if(void 0!==n&&(i=new e(n,!0)),a=this.parse(s,null,i))throw TypeError$2(a);(o=getInternalSearchParamsState(new URLSearchParams$1)).bindURL(this),this.searchParams=o}};URLState.prototype={type:"URL",parse:function(e,t,r){var n,i,a,o,s=this,l=t||SCHEME_START,u=0,c="",d=!1,h=!1,f=!1;for(e=$toString$1(e),t||(s.scheme="",s.username="",s.password="",s.host=null,s.port=null,s.path=[],s.query=null,s.fragment=null,s.cannotBeABaseURL=!1,e=replace$4(e,LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE,"")),e=replace$4(e,TAB_AND_NEW_LINE,""),n=arrayFrom(e);u<=n.length;){switch(i=n[u],l){case SCHEME_START:if(!i||!exec$3(ALPHA,i)){if(t)return INVALID_SCHEME;l=NO_SCHEME;continue}c+=toLowerCase(i),l=SCHEME;break;case SCHEME:if(i&&(exec$3(ALPHANUMERIC,i)||"+"==i||"-"==i||"."==i))c+=toLowerCase(i);else{if(":"!=i){if(t)return INVALID_SCHEME;c="",l=NO_SCHEME,u=0;continue}if(t&&(s.isSpecial()!=hasOwn$9(specialSchemes,c)||"file"==c&&(s.includesCredentials()||null!==s.port)||"file"==s.scheme&&!s.host))return;if(s.scheme=c,t)return void(s.isSpecial()&&specialSchemes[s.scheme]==s.port&&(s.port=null));c="","file"==s.scheme?l=FILE:s.isSpecial()&&r&&r.scheme==s.scheme?l=SPECIAL_RELATIVE_OR_AUTHORITY:s.isSpecial()?l=SPECIAL_AUTHORITY_SLASHES:"/"==n[u+1]?(l=PATH_OR_AUTHORITY,u++):(s.cannotBeABaseURL=!0,push$4(s.path,""),l=CANNOT_BE_A_BASE_URL_PATH)}break;case NO_SCHEME:if(!r||r.cannotBeABaseURL&&"#"!=i)return INVALID_SCHEME;if(r.cannotBeABaseURL&&"#"==i){s.scheme=r.scheme,s.path=arraySlice(r.path),s.query=r.query,s.fragment="",s.cannotBeABaseURL=!0,l=FRAGMENT;break}l="file"==r.scheme?FILE:RELATIVE;continue;case SPECIAL_RELATIVE_OR_AUTHORITY:if("/"!=i||"/"!=n[u+1]){l=RELATIVE;continue}l=SPECIAL_AUTHORITY_IGNORE_SLASHES,u++;break;case PATH_OR_AUTHORITY:if("/"==i){l=AUTHORITY;break}l=PATH;continue;case RELATIVE:if(s.scheme=r.scheme,i==EOF)s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice(r.path),s.query=r.query;else if("/"==i||"\\"==i&&s.isSpecial())l=RELATIVE_SLASH;else if("?"==i)s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice(r.path),s.query="",l=QUERY;else{if("#"!=i){s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice(r.path),s.path.length--,l=PATH;continue}s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,s.path=arraySlice(r.path),s.query=r.query,s.fragment="",l=FRAGMENT}break;case RELATIVE_SLASH:if(!s.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){s.username=r.username,s.password=r.password,s.host=r.host,s.port=r.port,l=PATH;continue}l=AUTHORITY}else l=SPECIAL_AUTHORITY_IGNORE_SLASHES;break;case SPECIAL_AUTHORITY_SLASHES:if(l=SPECIAL_AUTHORITY_IGNORE_SLASHES,"/"!=i||"/"!=charAt$3(c,u+1))continue;u++;break;case SPECIAL_AUTHORITY_IGNORE_SLASHES:if("/"!=i&&"\\"!=i){l=AUTHORITY;continue}break;case AUTHORITY:if("@"==i){d&&(c="%40"+c),d=!0,a=arrayFrom(c);for(var p=0;p<a.length;p++){var y=a[p];if(":"!=y||f){var m=percentEncode(y,userinfoPercentEncodeSet);f?s.password+=m:s.username+=m}else f=!0}c=""}else if(i==EOF||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()){if(d&&""==c)return INVALID_AUTHORITY;u-=arrayFrom(c).length+1,c="",l=HOST}else c+=i;break;case HOST:case HOSTNAME:if(t&&"file"==s.scheme){l=FILE_HOST;continue}if(":"!=i||h){if(i==EOF||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()){if(s.isSpecial()&&""==c)return INVALID_HOST;if(t&&""==c&&(s.includesCredentials()||null!==s.port))return;if(o=s.parseHost(c))return o;if(c="",l=PATH_START,t)return;continue}"["==i?h=!0:"]"==i&&(h=!1),c+=i}else{if(""==c)return INVALID_HOST;if(o=s.parseHost(c))return o;if(c="",l=PORT,t==HOSTNAME)return}break;case PORT:if(!exec$3(DIGIT,i)){if(i==EOF||"/"==i||"?"==i||"#"==i||"\\"==i&&s.isSpecial()||t){if(""!=c){var g=parseInt$1(c,10);if(g>65535)return INVALID_PORT;s.port=s.isSpecial()&&g===specialSchemes[s.scheme]?null:g,c=""}if(t)return;l=PATH_START;continue}return INVALID_PORT}c+=i;break;case FILE:if(s.scheme="file","/"==i||"\\"==i)l=FILE_SLASH;else{if(!r||"file"!=r.scheme){l=PATH;continue}if(i==EOF)s.host=r.host,s.path=arraySlice(r.path),s.query=r.query;else if("?"==i)s.host=r.host,s.path=arraySlice(r.path),s.query="",l=QUERY;else{if("#"!=i){startsWithWindowsDriveLetter(join(arraySlice(n,u),""))||(s.host=r.host,s.path=arraySlice(r.path),s.shortenPath()),l=PATH;continue}s.host=r.host,s.path=arraySlice(r.path),s.query=r.query,s.fragment="",l=FRAGMENT}}break;case FILE_SLASH:if("/"==i||"\\"==i){l=FILE_HOST;break}r&&"file"==r.scheme&&!startsWithWindowsDriveLetter(join(arraySlice(n,u),""))&&(isWindowsDriveLetter(r.path[0],!0)?push$4(s.path,r.path[0]):s.host=r.host),l=PATH;continue;case FILE_HOST:if(i==EOF||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&isWindowsDriveLetter(c))l=PATH;else if(""==c){if(s.host="",t)return;l=PATH_START}else{if(o=s.parseHost(c))return o;if("localhost"==s.host&&(s.host=""),t)return;c="",l=PATH_START}continue}c+=i;break;case PATH_START:if(s.isSpecial()){if(l=PATH,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=EOF&&(l=PATH,"/"!=i))continue}else s.fragment="",l=FRAGMENT;else s.query="",l=QUERY;break;case PATH:if(i==EOF||"/"==i||"\\"==i&&s.isSpecial()||!t&&("?"==i||"#"==i)){if(isDoubleDot(c)?(s.shortenPath(),"/"==i||"\\"==i&&s.isSpecial()||push$4(s.path,"")):isSingleDot(c)?"/"==i||"\\"==i&&s.isSpecial()||push$4(s.path,""):("file"==s.scheme&&!s.path.length&&isWindowsDriveLetter(c)&&(s.host&&(s.host=""),c=charAt$3(c,0)+":"),push$4(s.path,c)),c="","file"==s.scheme&&(i==EOF||"?"==i||"#"==i))for(;s.path.length>1&&""===s.path[0];)shift(s.path);"?"==i?(s.query="",l=QUERY):"#"==i&&(s.fragment="",l=FRAGMENT)}else c+=percentEncode(i,pathPercentEncodeSet);break;case CANNOT_BE_A_BASE_URL_PATH:"?"==i?(s.query="",l=QUERY):"#"==i?(s.fragment="",l=FRAGMENT):i!=EOF&&(s.path[0]+=percentEncode(i,C0ControlPercentEncodeSet));break;case QUERY:t||"#"!=i?i!=EOF&&("'"==i&&s.isSpecial()?s.query+="%27":s.query+="#"==i?"%23":percentEncode(i,C0ControlPercentEncodeSet)):(s.fragment="",l=FRAGMENT);break;case FRAGMENT:i!=EOF&&(s.fragment+=percentEncode(i,fragmentPercentEncodeSet))}u++}},parseHost:function(e){var t,r,n;if("["==charAt$3(e,0)){if("]"!=charAt$3(e,e.length-1))return INVALID_HOST;if(!(t=parseIPv6(stringSlice$3(e,1,-1))))return INVALID_HOST;this.host=t}else if(this.isSpecial()){if(e=toASCII(e),exec$3(FORBIDDEN_HOST_CODE_POINT,e))return INVALID_HOST;if(null===(t=parseIPv4(e)))return INVALID_HOST;this.host=t}else{if(exec$3(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT,e))return INVALID_HOST;for(t="",r=arrayFrom(e),n=0;n<r.length;n++)t+=percentEncode(r[n],C0ControlPercentEncodeSet);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return hasOwn$9(specialSchemes,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&isWindowsDriveLetter(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,a=e.port,o=e.path,s=e.query,l=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=r+(n?":"+n:"")+"@"),u+=serializeHost(i),null!==a&&(u+=":"+a)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?o[0]:o.length?"/"+join(o,"/"):"",null!==s&&(u+="?"+s),null!==l&&(u+="#"+l),u},setHref:function(e){var t=this.parse(e);if(t)throw TypeError$2(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new URLConstructor(e.path[0]).origin}catch(error){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+serializeHost(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse($toString$1(e)+":",SCHEME_START)},getUsername:function(){return this.username},setUsername:function(e){var t=arrayFrom($toString$1(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=percentEncode(t[r],userinfoPercentEncodeSet)}},getPassword:function(){return this.password},setPassword:function(e){var t=arrayFrom($toString$1(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=percentEncode(t[r],userinfoPercentEncodeSet)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?serializeHost(e):serializeHost(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,HOST)},getHostname:function(){var e=this.host;return null===e?"":serializeHost(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,HOSTNAME)},getPort:function(){var e=this.port;return null===e?"":$toString$1(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=$toString$1(e))?this.port=null:this.parse(e,PORT))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+join(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,PATH_START))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=$toString$1(e))?this.query=null:("?"==charAt$3(e,0)&&(e=stringSlice$3(e,1)),this.query="",this.parse(e,QUERY)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=$toString$1(e))?("#"==charAt$3(e,0)&&(e=stringSlice$3(e,1)),this.fragment="",this.parse(e,FRAGMENT)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var URLConstructor=function(e){var t=anInstance$2(this,URLPrototype),r=validateArgumentsLength$1(arguments.length,1)>1?arguments[1]:void 0,n=setInternalState$2(t,new URLState(e,!1,r));DESCRIPTORS$b||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},URLPrototype=URLConstructor.prototype,accessorDescriptor=function(e,t){return{get:function(){return getInternalURLState(this)[e]()},set:t&&function(e){return getInternalURLState(this)[t](e)},configurable:!0,enumerable:!0}};if(DESCRIPTORS$b&&(defineBuiltInAccessor$1(URLPrototype,"href",accessorDescriptor("serialize","setHref")),defineBuiltInAccessor$1(URLPrototype,"origin",accessorDescriptor("getOrigin")),defineBuiltInAccessor$1(URLPrototype,"protocol",accessorDescriptor("getProtocol","setProtocol")),defineBuiltInAccessor$1(URLPrototype,"username",accessorDescriptor("getUsername","setUsername")),defineBuiltInAccessor$1(URLPrototype,"password",accessorDescriptor("getPassword","setPassword")),defineBuiltInAccessor$1(URLPrototype,"host",accessorDescriptor("getHost","setHost")),defineBuiltInAccessor$1(URLPrototype,"hostname",accessorDescriptor("getHostname","setHostname")),defineBuiltInAccessor$1(URLPrototype,"port",accessorDescriptor("getPort","setPort")),defineBuiltInAccessor$1(URLPrototype,"pathname",accessorDescriptor("getPathname","setPathname")),defineBuiltInAccessor$1(URLPrototype,"search",accessorDescriptor("getSearch","setSearch")),defineBuiltInAccessor$1(URLPrototype,"searchParams",accessorDescriptor("getSearchParams")),defineBuiltInAccessor$1(URLPrototype,"hash",accessorDescriptor("getHash","setHash"))),defineBuiltIn$4(URLPrototype,"toJSON",(function(){return getInternalURLState(this).serialize()}),{enumerable:!0}),defineBuiltIn$4(URLPrototype,"toString",(function(){return getInternalURLState(this).serialize()}),{enumerable:!0}),NativeURL){var nativeCreateObjectURL=NativeURL.createObjectURL,nativeRevokeObjectURL=NativeURL.revokeObjectURL;nativeCreateObjectURL&&defineBuiltIn$4(URLConstructor,"createObjectURL",bind$2(nativeCreateObjectURL,NativeURL)),nativeRevokeObjectURL&&defineBuiltIn$4(URLConstructor,"revokeObjectURL",bind$2(nativeRevokeObjectURL,NativeURL))}function createPublicPromise$3(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}setToStringTag$5(URLConstructor,"URL"),$$K({global:!0,constructor:!0,forced:!USE_NATIVE_URL,sham:!DESCRIPTORS$b},{URL:URLConstructor});var LoaderType$2={FETCH:"fetch",XHR:"xhr"},ResponseType$2={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},NetError$2=function(e){_inherits$8(r,e);var t=_createSuper$b(r);function r(e,n,i,a){var o;return _classCallCheck$a(this,r),_defineProperty$b(_assertThisInitialized$8(o=t.call(this,a)),"retryCount",0),_defineProperty$b(_assertThisInitialized$8(o),"isTimeout",!1),_defineProperty$b(_assertThisInitialized$8(o),"loaderType",LoaderType$2.FETCH),_defineProperty$b(_assertThisInitialized$8(o),"startTime",0),_defineProperty$b(_assertThisInitialized$8(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return _createClass$b(r)}(_wrapNativeSuper$4(Error)),$$J=_export;$$J({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var $$I=_export,fails$e=fails$13,toObject$5=toObject$m,nativeGetPrototypeOf=objectGetPrototypeOf,CORRECT_PROTOTYPE_GETTER=correctPrototypeGetter,FAILS_ON_PRIMITIVES$2=fails$e((function(){nativeGetPrototypeOf(1)}));$$I({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES$2,sham:!CORRECT_PROTOTYPE_GETTER},{getPrototypeOf:function(e){return nativeGetPrototypeOf(toObject$5(e))}});var toString$c=Object.prototype.toString;function isObject$7(e){return null!==e&&"object"===_typeof$6(e)}function isPlainObject$2(e){if("[object Object]"!==toString$c.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate$2(e){return"[object Date]"===toString$c.call(e)}function getRangeValue$2(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode$2(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams$2(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate$2(t)?t=t.toISOString():isObject$7(t)&&(t=JSON.stringify(t)),"".concat(encode$2(e),"=").concat(encode$2(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse$2(e,t,r,n,i,a,o,s,l,u){return i=null!=i?parseFloat(i):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0),{data:e,done:t,option:{range:l,vid:u,index:s,contentLength:n,age:i,startTime:a,firstByteTime:o,endTime:Date.now()},response:r}}var $$H=_export,toObject$4=toObject$m,toAbsoluteIndex=toAbsoluteIndex$9,toIntegerOrInfinity$3=toIntegerOrInfinity$i,lengthOfArrayLike$5=lengthOfArrayLike$r,setArrayLength$2=arraySetLength,doesNotExceedSafeInteger$2=doesNotExceedSafeInteger$6,arraySpeciesCreate=arraySpeciesCreate$3,createProperty$1=createProperty$6,deletePropertyOrThrow$1=deletePropertyOrThrow$5,arrayMethodHasSpeciesSupport=arrayMethodHasSpeciesSupport$5,HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport("splice"),max$1=Math.max,min$2=Math.min;$$H({target:"Array",proto:!0,forced:!HAS_SPECIES_SUPPORT},{splice:function(e,t){var r,n,i,a,o,s,l=toObject$4(this),u=lengthOfArrayLike$5(l),c=toAbsoluteIndex(e,u),d=arguments.length;for(0===d?r=n=0:1===d?(r=0,n=u-c):(r=d-2,n=min$2(max$1(toIntegerOrInfinity$3(t),0),u-c)),doesNotExceedSafeInteger$2(u+r-n),i=arraySpeciesCreate(l,n),a=0;a<n;a++)(o=c+a)in l&&createProperty$1(i,a,l[o]);if(i.length=n,r<n){for(a=c;a<u-n;a++)s=a+r,(o=a+n)in l?l[s]=l[o]:deletePropertyOrThrow$1(l,s);for(a=u;a>u-n+r;a--)deletePropertyOrThrow$1(l,a-1)}else if(r>n)for(a=u-n;a>c;a--)s=a+r-1,(o=a+n-1)in l?l[s]=l[o]:deletePropertyOrThrow$1(l,s);for(a=0;a<r;a++)l[a+c]=arguments[a+2];return setArrayLength$2(l,u-n+r),i}});var MaxQueueCapacity=10,INVALID_SPEED=0,SpeedSampler=function(){function e(){_classCallCheck$a(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,this._realTimeSpeed=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return _createClass$b(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0===e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}}],[{key:"getSpeed",value:function(){var e=INVALID_SPEED;if(this._netRecords.length<1)return e;var t=[];this._netRecords.map((function(e){t.push(e)})),t.sort((function(e,t){return e.mSpeedInbPS-t.mSpeedInbPS}));for(var r=t.length,n=0,i=0;i<r;i++)n+=t[i].mBytes;n/=2;for(var a=0;a<r;a++)if((n-=t[a].mBytes)<=0){e=t[a].mSpeedInbPS;break}return e<0?INVALID_SPEED:e}},{key:"getRealTimeSpeed",value:function(){return this._realTimeSpeed}},{key:"getRTT",value:function(){if(this._netRecords.length<1)return 0;var e=[];this._netRecords.map((function(t){e.push(t.mRTT)})),e.sort((function(e,t){return e-t}));var t=e.length;return t%2==0?(e[t/2-1]+e[t/2])/2:e[Math.floor(t/2)]}},{key:"netSampling",value:function(e){this._netRecords.push(e),this._realTimeSpeed=e.mSpeedInbPS,this._netRecords.length>MaxQueueCapacity&&this._netRecords.splice(0,1)}}]),e}();_defineProperty$b(SpeedSampler,"_netRecords",[]);var CACHESIZE$1=2097152,FetchLoader$2=function(){function e(){_classCallCheck$a(this,e),_defineProperty$b(this,"_abortController",null),_defineProperty$b(this,"_timeoutTimer",null),_defineProperty$b(this,"_reader",null),_defineProperty$b(this,"_response",null),_defineProperty$b(this,"_aborted",!1),_defineProperty$b(this,"_index",-1),_defineProperty$b(this,"_range",null),_defineProperty$b(this,"_receivedLength",0),_defineProperty$b(this,"_running",!1),_defineProperty$b(this,"_logger",null),_defineProperty$b(this,"_vid",""),_defineProperty$b(this,"_onProcessMinLen",0)}var t;return _createClass$b(e,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.vid,a=e.timeout,o=e.responseType,s=e.onProgress,l=e.index,u=e.onTimeout,c=e.range,d=e.transformResponse,h=e.request,f=e.params,p=e.logger,y=e.method,m=e.headers,g=e.body,v=e.mode,b=e.credentials,_=e.cache,E=e.redirect,T=e.referrer,S=e.referrerPolicy,$=e.onProcessMinLen;this._logger=p,this._aborted=!1,this._onProcessMinLen=$,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=l,this._range=c||[0,0],this._vid=i||n;var A={method:y,headers:m,body:g,mode:v,credentials:b,cache:_,redirect:E,referrer:T,referrerPolicy:S,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},w=!1;clearTimeout(this._timeoutTimer),n=setUrlParams$2(n,f);var k=getRangeValue$2(c);k&&((m=h?h.headers:A.headers=A.headers||new Headers)instanceof Headers?m.append("Range",k):m.Range=k),a&&(this._timeoutTimer=setTimeout((function(){if(w=!0,r.cancel(),u){var e=new NetError$2(n,A);e.isTimeout=!0,u(e)}}),a));var I=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",c),new Promise((function(e,t){fetch(h||n,h?void 0:A).then(function(){var i=_asyncToGenerator$8(_regeneratorRuntime$6().mark((function i(a){var u,h,f;return _regeneratorRuntime$6().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=a,!r._aborted&&r._running){i.next=4;break}return i.abrupt("return");case 4:if(d&&(a=d(a,n)||a),a.ok){i.next=7;break}throw new NetError$2(n,A,a,"bad network response");case 7:if(u=Date.now(),o!==ResponseType$2.TEXT){i.next=15;break}return i.next=11,a.text();case 11:h=i.sent,r._running=!1,i.next=36;break;case 15:if(o!==ResponseType$2.JSON){i.next=22;break}return i.next=18,a.json();case 18:h=i.sent,r._running=!1,i.next=36;break;case 22:if(!s){i.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(a,s,I,u),i.abrupt("return");case 29:return i.next=31,a.arrayBuffer();case 31:h=i.sent,h=new Uint8Array(h),r._running=!1,f=Date.now()-I,SpeedSampler.netSampling({mTime:f,mBytes:h.byteLength,mSpeedInbPS:8*h.byteLength/(f/1e3),mRTT:u-I});case 36:r._logger.debug("[fetch load end], index,",l,",range,",c),e(createResponse$2(h,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),I,u,l,c,r._vid));case 38:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){clearTimeout(r._timeoutTimer),r._running=!1,r._aborted&&!w||((e=e instanceof NetError$2?e:new NetError$2(n,A)).startTime=I,e.endTime=Date.now(),e.isTimeout=w,t(e))}))}))}},{key:"cancel",value:(t=_asyncToGenerator$8(_regeneratorRuntime$6().mark((function e(){return _regeneratorRuntime$6().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}case 15:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,n){var i=this;if(!e.body||!e.body.getReader)return this._running=!1,void this.reject(NetError$2(e.url,"",e,"onProgress of bad response.body.getReader"));this._onProcessMinLen>0&&(this._cache=new Uint8Array(CACHESIZE$1),this._writeIdx=0);var a,o,s,l=this._reader=e.body.getReader(),u=function(){var c=_asyncToGenerator$8(_regeneratorRuntime$6().mark((function c(){var d,h,f,p,y;return _regeneratorRuntime$6().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return o=Date.now(),c.prev=1,c.next=4,l.read();case 4:a=c.sent,s=Date.now(),c.next=13;break;case 8:return c.prev=8,c.t0=c.catch(1),s=Date.now(),i._aborted||(i._running=!1,i.reject(c.t0)),c.abrupt("return");case 13:if(d=i._range[0]+i._receivedLength,!i._aborted){c.next=18;break}return i._running=!1,t(void 0,!1,{range:[d,d],vid:i._vid,index:i._index,startTime:o,endTime:s},e),c.abrupt("return");case 18:h=a.value?a.value.byteLength:0,i._receivedLength+=h,i._logger.debug("fetchLoader,onProgress call,task,",i._range,", start,",d,", end,",i._range[0]+i._receivedLength,", done,",a.done),i._writeIdx+h>=i._onProcessMinLen||a.done?((f=new Uint8Array(i._writeIdx+h)).set(i._cache.slice(0,i._writeIdx),0),h>0&&f.set(a.value,i._writeIdx),i._writeIdx=0,i._logger.debug("fetchLoader,onProgress enough,done,",a.done,",len,",f.byteLength,", writeIdx,",i._writeIdx)):h>0&&i._writeIdx+h<CACHESIZE$1?(i._cache.set(a.value,i._writeIdx),i._writeIdx+=h,i._logger.debug("fetchLoader,onProgress cache,len,",h,", writeIdx,",i._writeIdx)):h>0&&(p=new Uint8Array(i._writeIdx+h+2048),i._logger.debug("fetchLoader,onProgress extra start,size,",i._writeIdx+h+2048,", datalen,",h,", writeIdx,",i._writeIdx),p.set(i._cache.slice(0,i._writeIdx),0),h>0&&p.set(a.value,i._writeIdx),i._writeIdx+=h,delete i._cache,i._cache=p,i._logger.debug("fetchLoader,onProgress extra end,len,",h,", writeIdx,",i._writeIdx)),(f&&f.byteLength>0||a.done)&&t(f,a.done,{range:[i._range[0]+i._receivedLength-f.byteLength,i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:o,endTime:s},e),y=Date.now()-r,i._logger.debug("[fetchLoader SPEED], fetch speed(b/s),",8*i._receivedLength/(y/1e3)),SpeedSampler.netSampling({mTime:y,mBytes:i._receivedLength,mSpeedInbPS:8*i._receivedLength/(y/1e3),mRTT:n-r}),a.done?(i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",a.done),i.resolve(createResponse$2(a,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),o,n,i._index,i._range,i._vid))):u();case 27:case"end":return c.stop()}}),c,null,[[1,8]])})));return function(){return c.apply(this,arguments)}}();u()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),e}();function getConfig$3(e){return _objectSpread2$6({loaderType:LoaderType$2.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType$2.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:1},e)}var XhrLoader$2=function(){function t(){_classCallCheck$a(this,t),_defineProperty$b(this,"_xhr",null),_defineProperty$b(this,"_aborted",!1),_defineProperty$b(this,"_timeoutTimer",null),_defineProperty$b(this,"_range",null),_defineProperty$b(this,"_receivedLength",0),_defineProperty$b(this,"_url",null),_defineProperty$b(this,"_onProgress",null),_defineProperty$b(this,"_index",-1),_defineProperty$b(this,"_headers",null),_defineProperty$b(this,"_chunkSizeKBList",[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192]),_defineProperty$b(this,"_currentChunkSizeKB",384),_defineProperty$b(this,"_currentSpeedNormalized",0),_defineProperty$b(this,"_zeroSpeedChunkCount",0),_defineProperty$b(this,"_timeout",null),_defineProperty$b(this,"_xhr",null),_defineProperty$b(this,"_withCredentials",null),_defineProperty$b(this,"_startTime",-1),_defineProperty$b(this,"_speedSampler",new SpeedSampler),_defineProperty$b(this,"_loadCompleteResolve",null),_defineProperty$b(this,"_loadCompleteReject",null),_defineProperty$b(this,"_runing",!1),_defineProperty$b(this,"_logger",!1),_defineProperty$b(this,"_vid",""),_defineProperty$b(this,"_responseType",void 0),_defineProperty$b(this,"_credentials",void 0),_defineProperty$b(this,"_method",void 0),_defineProperty$b(this,"_transformResponse",void 0),_defineProperty$b(this,"_firstRtt",void 0),_defineProperty$b(this,"_subRangeStartTime",void 0)}return _createClass$b(t,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range||[0,0],this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._request=e.request,this._credentials=e.credentials,this._logger.debug("xhrLoader task, range",this._range),this._url=setUrlParams$2(e.url,e.params);var r=Date.now();return new Promise((function(e,r){t._loadCompleteResolve=e,t._loadCompleteReject=r,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof NetError$2?e:new NetError$2(t._url,t._request)).startTime=r,e.endTime=Date.now(),e}))}},{key:"_startLoad",value:function(){var e=null;if(this._range&&this._range.length>1)if(this._onProgress){this._subRangeStartTime=Date.now(),this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,r=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-r&&(n=r+t),e=[r,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(t){var r=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._credentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(e){r._running=!1,r._loadCompleteReject(e)},n.ontimeout=function(e){if(r.cancel(),r._onTimeout){var t=new NetError$2(r._url,r._request);t.isTimeout=!0,r._onTimeout(t)}r._loadCompleteReject(e)};var i=getRangeValue$2(t),a=null;i&&((a=this._headers||{}).Range=i),a&&Object.keys(a).forEach((function(e){n.setRequestHeader(e,a[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",t),n.send()}catch(e){this._loadCompleteReject(e)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t=e.target.status;if(t<200||t>299)return this._loadCompleteReject(new NetError$2(this._url,null,_objectSpread2$6(_objectSpread2$6({},e.target.response),{},{status:t}),"bad response,status:"+t));var r=this._speedSampler.lastSecondKBps;if(0===r&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(r=this._speedSampler.currentKBps)),0!==r){var n=this._normalizeSpeed(r);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var i,a=null,o=!1;if(this._responseType===ResponseType$2.ARRAY_BUFFER){var s=new Uint8Array(e.target.response);if(i=this._range[0]+this._receivedLength,s&&s.byteLength>0){this._receivedLength+=s.byteLength;var l=Date.now()-this._subRangeStartTime;this._speedSampler.addBytes(s.byteLength),SpeedSampler.netSampling({mTime:l,mBytes:this._receivedLength,mSpeedInbPS:8*this._receivedLength/(l/1e3),mRTT:this._firstRtt-this._subRangeStartTime})}a=s,o=!(this._range.length>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",i,"end ",this._range[0]+this._receivedLength,",dataLen,",s?s.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",o)}else o=!0,a=e.target.response;var u={ok:t>=200&&t<300,status:t,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(u=this._transformResponse(u,this._url)||u),this._onProgress&&this._onProgress(a,o,{index:this._index,vid:this._vid,range:[i,this._range[0]+this._receivedLength],startTime:this._startTime,endTime:Date.now()},u),o?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(createResponse$2(this._onProgress?null:a,o,u,u.headers["content-length"],u.headers.age,this._startTime,-1,this._index,this._range,this._vid))):this._startLoad()}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,r=t.length-1,n=0,i=0,a=r;if(e<t[0])return t[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?i=n+1:a=n-1}}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper$2(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),t}(),bind$1=functionBindContext,uncurryThis$e=functionUncurryThis,IndexedObject=indexedObject,toObject$3=toObject$m,toPropertyKey$1=toPropertyKey$6,lengthOfArrayLike$4=lengthOfArrayLike$r,objectCreate=objectCreate$1,arrayFromConstructorAndList$1=arrayFromConstructorAndList$4,$Array=Array,push$3=uncurryThis$e([].push),arrayGroup=function(e,t,r,n){for(var i,a,o,s=toObject$3(e),l=IndexedObject(s),u=bind$1(t,r),c=objectCreate(null),d=lengthOfArrayLike$4(l),h=0;d>h;h++)o=l[h],(a=toPropertyKey$1(u(o,h,s)))in c?push$3(c[a],o):c[a]=[o];if(n&&(i=n(s))!==$Array)for(a in c)c[a]=arrayFromConstructorAndList$1(i,c[a]);return c},$$G=_export,$group=arrayGroup,addToUnscopables$2=addToUnscopables$5;$$G({target:"Array",proto:!0},{group:function(e){var t=arguments.length>1?arguments[1]:void 0;return $group(this,e,t)}}),addToUnscopables$2("group");var Logger$7=function(){function e(t){_classCallCheck$a(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$b(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$b(Logger$7,"disabled",!0);var _excluded$4=["retry","retryDelay","onRetryError","transformError"],Task$2=function(){function e(t,r){_classCallCheck$a(this,e),this.promise=createPublicPromise$3(),this.alive=!!r.onProgress,!r.logger&&(r.logger=new Logger$7("Loader")),this._loaderType=t,this._loader=t===LoaderType$2.FETCH?new FetchLoader$2:new XhrLoader$2,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._logger=r.logger}var t;return _createClass$b(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties$3(t,_excluded$4),s=function(){var t=_asyncToGenerator$8(_regeneratorRuntime$6().mark((function t(){var l,u;return _regeneratorRuntime$6().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:l=t.sent,e.promise.resolve(l),t.next=28;break;case 7:if(t.prev=7,t.t0=t.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(!(t.t0.response&&t.t0.response.status>=400&&t.t0.response.status<=599)){t.next=16;break}return e.promise.reject(t.t0),t.abrupt("return");case 16:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,u=t.t0,a&&(u=a(u)||u),i&&e._retryCount>0&&i(u,e._retryCount,r),e._retryCount++,!(e._retryCount<=r)){t.next=27;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",o.range),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 27:e.promise.reject(u);case 28:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$8(_regeneratorRuntime$6().mark((function e(){return _regeneratorRuntime$6().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}}]),e}();function sleep$2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var NetLoader$2=function(){function e(t){_classCallCheck$a(this,e),_defineProperty$b(this,"type",LoaderType$2.FETCH),_defineProperty$b(this,"_queue",[]),_defineProperty$b(this,"_alive",[]),_defineProperty$b(this,"_currentTask",null),this._config=getConfig$3(t),this._config.loaderType!==LoaderType$2.XHR&&FetchLoader$2.isSupported()||(this.type=LoaderType$2.XHR),this.log=t.logger}var t;return _createClass$b(e,[{key:"isFetch",value:function(){return this.type===LoaderType$2.FETCH}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?t=e:t.url=e||t.url||this._config.url,(t=Object.assign({},this._config,t)).params&&(t.params=Object.assign({},t.params)),t.headers&&isPlainObject$2(t.headers)&&(t.headers=Object.assign({},t.headers)),t.body&&isPlainObject$2(t.body)&&(t.body=Object.assign({},t.body)),t.transformRequest&&(t=t.transformRequest(t)||t),t.logger=this.log;var r=new Task$2(this.type,t);return this._queue.push(r),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),r.promise}},{key:"cancel",value:(t=_asyncToGenerator$8(_regeneratorRuntime$6().mark((function e(){var t;return _regeneratorRuntime$6().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,sleep$2();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(e){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader$2.isSupported()}},{key:"getSpeed",value:function(){return SpeedSampler.getSpeed()}},{key:"getRealTimeSpeed",value:function(){return SpeedSampler.getRealTimeSpeed()}},{key:"getRTT",value:function(){return SpeedSampler.getRTT()}}]),e}();function getAllHeaders(e){if(e instanceof Headers){var t,r={},n=_createForOfIteratorHelper$3(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i[0]]=i[1]}}catch(a){n.e(a)}finally{n.f()}return r}return e}var Loader=function(){function e(t,r){_classCallCheck$c(this,e),this._config=_objectSpread2$7({responseType:"arraybuffer"},t),this._preloadManager=r,this.videoLogger=new Logger$7("VideoLoader_",this._config.vid),this.audioLogger=new Logger$7("AudioLoader_",this._config.vid),t.openLog&&Logger$7.enable(),this._videoLoader=new NetLoader$2(_objectSpread2$7(_objectSpread2$7({},this._config),{},{logger:this.videoLogger})),this._audioLoader=new NetLoader$2(_objectSpread2$7(_objectSpread2$7({},this._config),{},{logger:this.audioLogger})),this._isSupportUrlRange="fetch"===this._videoLoader.type}var t,r;return _createClass$d(e,[{key:"load",value:(r=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function t(r,n,i,a){var o,s,l,u,c,d,h,f,p,y,m,g,v,b,_,E=arguments;return _regeneratorRuntime$7().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=E.length>4&&void 0!==E[4]&&E[4],s=E.length>5&&void 0!==E[5]?E[5]:null,l=a.cacheKey||util$1.generateUniqueKey(a),u={start:a.start,end:a.end,bandwidth:a.bandwidth||a.bitrate,sequence:a.idx,fps:a.fps,mediaType:r,selectedIdx:a.selectedIdx,definition:a.definition},!this._preloadManager){t.next=11;break}return t.next=7,this._preloadManager.getItem(l);case 7:if(!((c=t.sent).res instanceof ArrayBuffer)){t.next=11;break}return s&&s(c.res,!0,{range:i},null,a),t.abrupt("return",{res:c.res,headers:c.headers,status:c.status,fromCache:!0,selectedIdx:a.selectedIdx,extData:u,cacheKey:l});case 11:if(d=!s||this._isSupportUrlRange,h=d&&(this._config.useUrlRange||a.useUrlRange||!1),f=n,h&&i&&i.length>1&&(f=n+(n.split("?")[1]?"&":"?")+"range=".concat(i[0],"-").concat(i[1])),i&&0!==i.length&&!h||(i=void 0),debug$2.log("load res: ",a),t.prev=17,p="video"===r?this._videoLoader:this._audioLoader){t.next=21;break}return t.abrupt("return");case 21:return t.next=23,p.load(f,{range:i,onProgress:s,selectedIdx:a.selectedIdx,sequence:a.idx,initSegment:a.initSegment,onProcessMinLen:this._config.onProcessMinLen});case 23:if(y=t.sent){t.next=26;break}return t.abrupt("return",null);case 26:return m=y.data,g=y.response,v={res:m instanceof Uint8Array?m.buffer:m,headers:getAllHeaders(g.headers),status:g.status},o&&this._preloadManager.setItem(l,v).catch((function(){})),e.historySpeed.length>=20&&e.historySpeed.shift(),e.historySpeed.push(NetLoader$2.getSpeed()),t.abrupt("return",_objectSpread2$7(_objectSpread2$7({},v),{},{extData:u,selectedIdx:a.selectedIdx,cacheKey:l}));case 34:return t.prev=34,t.t0=t.catch(17),t.abrupt("return",{res:"error",status:null===(b=t.t0.response)||void 0===b?void 0:b.status,header:getAllHeaders(null===(_=t.t0.response)||void 0===_?void 0:_.headers),cacheKey:l});case 37:case"end":return t.stop()}}),t,this,[[17,34]])}))),function(e,t,n,i){return r.apply(this,arguments)})},{key:"cancel",value:(t=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var r;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return r="video"===t?this._videoLoader:this._audioLoader,e.next=4,r.cancel();case 4:e.next=10;break;case 6:return e.next=8,this._audioLoader.cancel();case 8:return e.next=10,this._videoLoader.cancel();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.cancel(),this._audioLoader=null,this._videoLoader=null}}],[{key:"currentSpeed",get:function(){return NetLoader$2.getRealTimeSpeed()}},{key:"historyAvspeed",get:function(){var t=e.historySpeed.reduce((function(e,t){return e+t}),0);return 0===e.historySpeed.length?0:t/e.historySpeed.length}}]),e}();Loader.historySpeed=[];var es_parseInt={},global$8=global$1v,fails$d=fails$1Q,uncurryThis$d=functionUncurryThis$1,toString$b=toString$O,trim$1=stringTrim$1.trim,whitespaces$2=whitespaces$b,$parseInt$1=global$8.parseInt,_Symbol$1=global$8.Symbol,ITERATOR$1=_Symbol$1&&_Symbol$1.iterator,hex$1=/^[+-]?0x/i,exec$2=uncurryThis$d(hex$1.exec),FORCED$7=8!==$parseInt$1(whitespaces$2+"08")||22!==$parseInt$1(whitespaces$2+"0x16")||ITERATOR$1&&!fails$d((function(){$parseInt$1(Object(ITERATOR$1))})),numberParseInt=FORCED$7?function(e,t){var r=trim$1(toString$b(e));return $parseInt$1(r,t>>>0||(exec$2(hex$1,r)?16:10))}:$parseInt$1,$$F=_export$1,$parseInt=numberParseInt;$$F({global:!0,forced:parseInt!=$parseInt},{parseInt:$parseInt});var collection=collection$2,collectionStrong=collectionStrong$2;collection("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),collectionStrong);var es_parseFloat={},global$7=global$1v,fails$c=fails$1Q,uncurryThis$c=functionUncurryThis$1,toString$a=toString$O,trim=stringTrim$1.trim,whitespaces$1=whitespaces$b,charAt$2=uncurryThis$c("".charAt),$parseFloat$1=global$7.parseFloat,_Symbol=global$7.Symbol,ITERATOR=_Symbol&&_Symbol.iterator,FORCED$6=1/$parseFloat$1(whitespaces$1+"-0")!=-1/0||ITERATOR&&!fails$c((function(){$parseFloat$1(Object(ITERATOR))})),numberParseFloat=FORCED$6?function(e){var t=trim(toString$a(e)),r=$parseFloat$1(t);return 0===r&&"-"==charAt$2(t,0)?-0:r}:$parseFloat$1,$$E=_export$1,$parseFloat=numberParseFloat;$$E({global:!0,forced:parseFloat!=$parseFloat},{parseFloat:$parseFloat});var es_typedArray_int32Array={},createTypedArrayConstructor$7=typedArrayConstructor$1.exports;createTypedArrayConstructor$7("Int32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var SPPED_CACHE="danger_d_speed";function convert32ToC64(e){var t=e.toString(16);return t.length<=8?{high:0,low:e}:{high:parseInt(t.substr(0,t.length-8),16),low:parseInt(t.substr(t.length-8),16)}}var BaseAbr=function(){function e(t,r,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{logger:function(){},openLog:!1};_classCallCheck$b(this,e),this.bitrate=r,this.segment_duration=i||5e3,this.logger=a.logger,this.openLog=a.openLog,this.cdnHost=t.cdnHost,this._loadedPromise=new ProxyPromise$1,this._wasmPromise=new ProxyPromise$1,this.config=t,this.autoBitrateOpts=t.autoBitrateOpts||{},this.stall_penalty=this.autoBitrateOpts.stall_penalty||11,this.switch_penalty=this.autoBitrateOpts.switch_penalty||4,this.interval=this.autoBitrateOpts.interval||1e3;var o=t.progressTimer||1e3,s=this.autoBitrateOpts.startInterval||o;this.initInterval=.8*s,this._prealodMethod=t.preloadmethod||0,this._videoWidth=0,this._videoHeight=0,this._hasDeviceInfoChanged=!0,this.updateMediaInfos(n,!1)}return _createClass$c(e,[{key:"onLoadWasm",value:function(){var e=this,t=this.module={onRuntimeInitialized:function(){e._wasmPromise.resolve()}};return(0,this.autoBitrateOpts.module)(t),this._wasmPromise}},{key:"updateMediaInfos",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._heightToDefitionConfig=new Map,this._bitrateToDefitionConfig=new Map,e?(this.mediaInfos=e,this.mediaInfos.dynamic_video_list.forEach((function(e){t._heightToDefitionConfig.set(e.vheight,e),t._bitrateToDefitionConfig.set(e.bitrate,e)}))):r&&console.error("baseAbr mediaInfos null")}},{key:"parseMPD",value:function(){if(this.setDebugModel(this.openLog),this.mediaInfos){this.logger("mediaInfos",this.mediaInfos);try{for(var e=[],t=this.mediaInfos.dynamic_video_list,r=0;r<t.length;r++){var n=t[r];e.push({stream_id:"s".concat(r),bandwidth:n.bitrate||n.bandwidth,width:n.vwidth||n.width,height:n.vheight||n.height,codec:n.codecs||n.codec_type||"h264",frame_rate:Number(n.fps)||-1,segment_duration:this.segment_duration})}var i={v_adaptation:e},a=JSON.stringify(i);this.module.ccall("parseMPD","null",["string"],[a])}catch(error){}}else console.warn("mediaInfos is null")}},{key:"_getDefautSpeed",value:function(e){var t=0,r=window.navigator.connection;if(r&&r.downlink)t=1024*navigator.connection.downlink/8,this.logger("initSpeed connect",t);else try{t=parseFloat(proxyLocalStorage$1.getItem(SPPED_CACHE))||0,this.logger("initSpeed connect",t)}catch(error){}return 0===t&&(t=e&&e.historyAvspeed||0,this.logger("initSpeed history",t)),t}},{key:"setDebugModel",value:function(e){this.module._setDebugModel(e)}},{key:"updateBitrate",value:function(e){this.bitrate=e}},{key:"_updatePreloadSupplier",value:function(e,t){this.module._updatePreloadSupplier(e,t)}},{key:"updatePreloadSupplier",value:function(e){var t=this._getDefautSpeed();this._updatePreloadSupplier(t,e)}},{key:"getPreloadBitrate",value:function(){var e,t=null,r=[];try{this.logger("preloadMethod",this._prealodMethod),e=this.module._getPreloadBitrate(this._prealodMethod);for(var n=0;n<5;n++)r.push(this.module.HEAP32[e/Int32Array.BYTES_PER_ELEMENT+n]);var i={bitrate:r[0],pduration:r[1],preloadType:r[2],size:r[3],mediaType:r[4]};return this.logger("getPreloadBitrate",i),i}catch(error){t=null,console.log("getPreloadBitrate",error)}finally{this.module._free(e)}return t}},{key:"_updateDeviceInfo",value:function(e){try{if(this._hasDeviceInfoChanged){var t=window.devicePixelRatio||1;this.module._updateDeviceInfo(this._videoWidth||Number(this.config.width),this._videoHeight||Number(this.config.height),t,e||-1)}this._hasDeviceInfoChanged=!1}catch(error){console.log("_updateDeviceInfo")}}},{key:"preload",value:function(e){this.parseMPD(),this.updatePreloadSupplier(e),this._updateDeviceInfo(-1);var t=window.devicePixelRatio||1;return this.logger("baseAbr updateDeviceInfo width",this._videoWidth||Number(this.config.width),"height",this._videoHeight||Number(this.config.height),"dpr",t),this.getPreloadBitrate()}}]),e}();BaseAbr.SPPED_CACHE=SPPED_CACHE;var es_reflect_construct={},$$D=_export$1,getBuiltIn$8=getBuiltIn$A,apply$1=functionApply$1,bind=functionBind,aConstructor=aConstructor$6,anObject$3=anObject$L,isObject$6=isObject$U,create$2=objectCreate$2,fails$b=fails$1Q,nativeConstruct=getBuiltIn$8("Reflect","construct"),ObjectPrototype$1=Object.prototype,push$2=[].push,NEW_TARGET_BUG=fails$b((function(){function e(){}return!(nativeConstruct((function(){}),[],e)instanceof e)})),ARGS_BUG=!fails$b((function(){nativeConstruct((function(){}))})),FORCED$5=NEW_TARGET_BUG||ARGS_BUG;function _arrayLikeToArray$7(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _arrayWithoutHoles$5(e){if(Array.isArray(e))return _arrayLikeToArray$7(e)}function _iterableToArray$5(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray$7(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$7(e,t):void 0}}function _nonIterableSpread$5(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray$5(e){return _arrayWithoutHoles$5(e)||_iterableToArray$5(e)||_unsupportedIterableToArray$7(e)||_nonIterableSpread$5()}function _assertThisInitialized$7(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _setPrototypeOf$7(e,t){return(_setPrototypeOf$7=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inherits$7(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$7(e,t)}function _possibleConstructorReturn$7(e,t){if(t&&("object"===_typeof$7(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$7(e)}function _getPrototypeOf$7(e){return(_getPrototypeOf$7=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _createSuper$a(e){var t=_isNativeReflectConstruct$a();return function(){var r,n=_getPrototypeOf$7(e);if(t){var i=_getPrototypeOf$7(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$7(this,r)}}function _isNativeReflectConstruct$a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}$$D({target:"Reflect",stat:!0,forced:FORCED$5,sham:FORCED$5},{construct:function(e,t){aConstructor(e),anObject$3(t);var r=arguments.length<3?e:aConstructor(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return nativeConstruct(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return apply$1(push$2,n,t),new(apply$1(bind,e,n))}var i=r.prototype,a=create$2(isObject$6(i)?i:ObjectPrototype$1),o=apply$1(e,a,t);return isObject$6(o)?o:a}});var ABR_EVENTS={ABR_CHANGE:"ABR_CHANGE_A",ABR_UPDATE_SPEC:"ABR_UPDATE_SPEC",START_ABR:"START_ABR",UPDATE_AUTO_DESC:"UPDATE_AUTO_DESC",ABR_START_PROGRESS:"ABR_START_PROGRESS",MAX_BUFFER_CHANGE:"MAX_BUFFER_CHANGE"},INIT_BIRTATE=0,AUTO_FLAG="__auto__",MIN_WAITIONG$1=200,SEEKING_STATE={SEEK_NO:0,SEEK_FORWARD:1,SEEK_BACKWORD:-1},STALL_STATE={STALL_NO:0,STALL:1},AVG_ARGS={PLAYBACK_BITRATE:"avg_play_bitrate",DOWNLOAD_BITRATE:"avg_download_bitrate",DOWNLOAD_NETWORK_SPEED:"avg_download_speed",PREDICT_NETWORK_SPEED:"avg_predict_speed",BUFFER_LENGTH:"avg_buffer_length",QOE:"avg_qoe"},ABR=function(t){_inherits$7(n,t);var r=_createSuper$a(n);function n(e,t,i,a,o){var s,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{logger:function(){},openLog:!1};_classCallCheck$b(this,n),(s=r.call(this,t,i,a,o,l)).player=e,s.timerId=0,s.isOpenAutoDefi=!!s.autoBitrateOpts.isOpenAutoDefi,s.onPlayrateChange=s._onPlayrateChange.bind(_assertThisInitialized$7(s)),s.onPlay=s._onPlay.bind(_assertThisInitialized$7(s)),s._stop=s.stop.bind(_assertThisInitialized$7(s)),s._bufferRange=new Map,s._sortedBufferRange=[],s._lastCheckResolutionStamp=0,s._currentDefinition=null,s._isSeeking=!1,s._waitingStartTime=0,s._stallCount=0,s._seekState=SEEKING_STATE.SEEK_NO,s._stallState=STALL_STATE.STALL_NO,s._videoCurrentTime=0,s.listeners=[{evt:"playbackrateChange",handler:s.onPlayrateChange},{evt:"ended",handler:s._stop},{evt:"error",handler:s._stop},{evt:"timeupdate",handler:s._onTimeUpdate.bind(_assertThisInitialized$7(s))},{evt:"addVideoBufferEnd",handler:s._bufferRangeUpdate.bind(_assertThisInitialized$7(s))},{evt:"canplay",handler:s._updateAutoDesc.bind(_assertThisInitialized$7(s))},{evt:"play",handler:s._onplayStart.bind(_assertThisInitialized$7(s))},{evt:ABR_EVENTS.MAX_BUFFER_CHANGE,handler:s._onMaxBufferChange.bind(_assertThisInitialized$7(s))},{evt:"seeking",handler:s._onSeeking.bind(_assertThisInitialized$7(s))},{evt:"seeked",handler:s._onSeekEnd.bind(_assertThisInitialized$7(s))},{evt:"waiting",handler:s._onWaiting.bind(_assertThisInitialized$7(s))},{evt:"playing",handler:s._onPlaying.bind(_assertThisInitialized$7(s))}],s._hasStart=!1,s.listeners.forEach((function(e){var t=e.evt,r=e.handler;s.player.on(t,r)})),s._isPaused=!1,s._hasAddFrament=!1,s._eventInfo={local_time_ms:0,internet_speed:0,buffer_length:0,last_bitrate:0,now_bitrate:0,play_speed:1},s._bitrateSet=[],s._generalInfo={},s._currentInAbr=!1,s._hasCalcTimelineLog=!1,s._abr_play_info={start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[],qoe_record:[],qoe_a_record:[],qoe_b_record:[],qoe_c_record:[]}},s._abrMethod=s.autoBitrateOpts.method||0,s.logger("abr: constructor"),s._loopInterval=s.initInterval,s._tickCount=0,s._fps=30,FpsDetection.install(),s.startTime=performance.now(),s.logger("time abr",(new Date).getTime()),s._maxCacheTimeVideo=s.config.maxBufferLength||s.config.preloadTime||50,s._maxCacheTimeAudio=s._maxCacheTimeVideo,s._prevDefinitionItem=null,s._currentItem=null,s._switchCount=0,s._switchBitrate=0,s._avgStatItems={};for(var u=Object.keys(AVG_ARGS),c=0;c<u.length;c++){var d=u[c],h=AVG_ARGS[d];s._avgStatItems[h]=new AvgStat}return s._qoeArgs=[0,0,0,0],s._abrUsed=-1,s._abrAlwaysOn=1,s._prelaodInfo=null,s._hasLogStartInfo=!1,s._hasExecuteAbrAlgo=!1,s._lastExecuteTimeInMs=0,s}return _createClass$c(n,[{key:"init",value:function(e){return this._mediaList=e,this.isOpenAutoDefi?this.onLoadWasm():this._wasmPromise.resolve(),this._wasmPromise}},{key:"execute",value:function(){return this.listenSize(),this.initFps(),this.onWinElemSizeChange(),this.onPlay()}},{key:"_onSeeking",value:function(){this._isSeeking=!0,this.player.currentTime<this._videoCurrentTime?this._seekState=SEEKING_STATE.SEEK_BACKWORD:this._seekState=SEEKING_STATE.SEEK_FORWARD,this.logger("seekState",this._seekState)}},{key:"_onSeekEnd",value:function(){this._isSeeking=!1}},{key:"_onWaiting",value:function(){var e=this;this._isSeeking||this._waitingStartTime>0||(this._waitingStartTime=(new Date).getTime(),this._stallId=setTimeout((function(){clearTimeout(e._stallId),e._stallCount++,e._stallState=STALL_STATE.STALL}),MIN_WAITIONG$1))}},{key:"_onPlaying",value:function(){this._waitingStartTime=0,this._stallState=STALL_STATE.STALL_NO,clearTimeout(this._stallId)}},{key:"initFps",value:function(){this.fpsDetection=new FpsDetection,this.fpsDetection.start(),this._fps=this.fpsDetection.fps,this._hasDeviceInfoChanged=!0}},{key:"listenSize",value:function(){this.mediaElem=this.player.video,this._onWinSizeChange=debounce$1(this.onWinElemSizeChange.bind(this),1e3,!1),window.addEventListener("resize",this._onWinSizeChange)}},{key:"onWinElemSizeChange",value:function(){if(this.mediaElem){var e=this.mediaElem.getBoundingClientRect();this._videoWidth=Math.floor(e.width),this._videoHeight=Math.floor(e.height),this._hasDeviceInfoChanged=!0}}},{key:"_onMaxBufferChange",value:function(e){var t=e.videoCacheTime,r=e.audioCacheTime;this._maxCacheTimeAudio=r,this._maxCacheTimeVideo=t}},{key:"_onTimeUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._sortedBufferRange&&0!==this._sortedBufferRange.length&&this._currentInAbr){this._videoCurrentTime=this.player.currentTime;var r=Date.now();if(!(r-this._lastCheckResolutionStamp<1e3&&0!==this._lastCheckResolutionStamp)||t){this._lastCheckResolutionStamp=r;for(var n=this.player.currentTime,i=0,a=this._sortedBufferRange.length-1,o=null;i<=a;){var s=Math.floor(i+(a-i)/2),l=this._sortedBufferRange[s];if(n<l.start)a=s-1;else{if(!(n>=l.end)){o=l;break}i=s+1}}if(o){var u=this._bitrateToDefitionConfig.get(o.bandwidth),c=u&&u.definition;if(this._currentDefinition===c&&!t||!c)return void(c||this.logger("error defintion, mpd"));this._currentDefinition=c,this._prevDefinitionItem=this._currentItem,this._currentFps=u.fps,this._currentItem=u,this._emitAutoDescChange(c,!1,this._currentFps,u)}}}}},{key:"_emitAutoDescChange",value:function(e,t,r,n){console.log("[ABR],emitAutoDescChange, definition, ",e,",item,",n,",pre_item,",this._prevDefinitionItem),this.player.emit(ABR_EVENTS.UPDATE_AUTO_DESC,{definition:e,reset:t,fps:r,item:n,pre_item:this._prevDefinitionItem})}},{key:"_onplayStart",value:function(){this._hasStart=!0,this.logger("onplaystart")}},{key:"_updateAutoDesc",value:function(){var e=this;this._currentInAbr&&this._currentDefinition&&(this._updateId=setTimeout((function(){clearTimeout(e._updateId),e._emitAutoDescChange(e._currentDefinition,!1,e._currentFps,e._currentItem)}),0))}},{key:"_bufferRangeUpdate",value:function(e){if(void 0!==e.start){null===this._currentItem&&this._onTimeUpdate(null,!0);var t=e.start;this._hasAddFrament=!0,this._bufferRange.set(t,e);var r=_toConsumableArray$5(this._bufferRange.values());this._sortedBufferRange=r.sort((function(e,t){return e.start-t.start})),this.avgStat(AVG_ARGS.DOWNLOAD_BITRATE,e.bandwidth)}}},{key:"_onPlayrateChange",value:function(){this.module&&this.updateBufferInfo()}},{key:"_onPlay",value:function(){var e=this;if(!this.isOpenAutoDefi)return this.logger("onPlay"),INIT_BIRTATE;var t=INIT_BIRTATE;try{this.logger("abr: loadeddata"),this.updateSwitchInfo(),this.parseMPD(),this.updateDeviceInfo();var r=n.getIsPlayAutoDefi(this.autoBitrateOpts);if(this.isOpenAutoDefi&&r){this._abrUsed=1;var i=this._getDefautSpeed(this.player);t=this._loopAbr(i),this.start(),this.logger("time abr start prgress",(new Date).getTime()),this.logger("time abr costTime",performance.now()-this.startTime),this.logger("abr onplay"),this.startTimer=setTimeout((function(){e._loopInterval=e.interval,clearTimeout(e.startTimer),e.logger("interval change")}),5e3)}}catch(error){this.logger("abr: loadeddata error",error),this.logger("time abr costTime err",performance.now()-this.startTime)}return t}},{key:"start",value:function(){if(this.logger("abr: start"),this._isPaused=!1,!this._hasCalcTimelineLog){var e=1===Math.floor(100*Math.random());this._abr_play_info.is_hint=e?1:0}this._hasCalcTimelineLog=!0,this._loop()}},{key:"_loop",value:function(){var e=this;this._isPaused||(clearTimeout(this.timerId),this.timerId=setTimeout((function(){if(!e.player.paused||!e.player.config.autoplay&&!e._hasStart){var t=e._hasAddFrament?void 0:e._getDefautSpeed(e.player);e._loopAbr(t)}e._loop()}),this._loopInterval))}},{key:"updateDeviceInfo",value:function(){try{if(this.fpsDetection){var e=this.fpsDetection.fps;e!==this._fps&&(this._fps=e,this._hasDeviceInfoChanged=!0)}this._updateDeviceInfo(this._fps)}catch(error){}}},{key:"updateBufferInfo",value:function(e){var t=this.player.playbackRate,r=this.bufferLength,n=e||Math.floor(this.player.downloadSpeed);return this._tickCount<5&&0===n&&(n=this._getDefautSpeed(this.player),this.logger("initSpeed fix")),this.logger("maxCacheTimeAudio:",this._maxCacheTimeAudio,"maxCacheVideoTime",this._maxCacheTimeVideo,"seekState",this._seekState,"stallState",this._stallState),this.module._updateBufferInfo(t,this._maxCacheTimeAudio,this._maxCacheTimeVideo,r,r,n,this._seekState,this.player.currentTime,this._stallState),this._seekState=SEEKING_STATE.SEEK_NO,this._eventInfo={internet_speed:n,buffer_length:r,last_bitrate:this.bitrate,play_speed:t},this.logger("playRate:",t,"buff:",r,"downloadSpeed:",n),{buffer:r,downloadSpeed:n}}},{key:"updateSwitchInfo",value:function(){var e=(new Date).getTime();this._openTimeMs=e,this._abr_play_info.start_play_time_ms=e;var t=this.player.config.preloadTime||50,r=convert32ToC64(e),n=this.autoBitrateOpts.noStallCheckTime||5,i=this.openLog;this.logger("openTime:",e,"this.logger",i),this.module._updateSwitchInfo(r.low,r.high,n,i,this.stall_penalty,this.switch_penalty);var a=this._mediaList.video,o=a.map((function(e){var t=e.bandwidth,r=e.bitrate;return t||r}));this._bitrateSet=o.map((function(e,t){return{bitrate:e,codecs:a[t].codecs||a[t].codec_type}})),this._generalInfo={max_cache_time:t,bitrate_set:this._bitrateSet,segment_duration:this.segment_duration,preload_info:{},startup_info:{}}}},{key:"updatePreloadCacheInfo",value:function(t){try{this._prelaodInfo=t,this.logger("update preloadInfo",t),t&&t.item_num!==t.items.length&&(this.logger("preloadInfo invalid"),this._prelaodInfo=null)}catch(e){this.logger("updatePreloadCacheInfo",e),this._prelaodInfo=null}}},{key:"updatePreloadLogInfo",value:function(e){this._generalInfo.preload_info=e||{}}},{key:"_updatePreloadInfo",value:function(){try{var t=this.player.getPreloadInfos();if(t){var r=t.preloadInfo,n=t.abr;this.updatePreloadLogInfo(r),n&&this.updatePreloadCacheInfo(r)}if(this.logger("_updatePreloadInfo preloadinfos",t),null!=this._prelaodInfo){var i=JSON.stringify(this._prelaodInfo);this.module.ccall("updatePreloadInfo","null",["string"],[i])}else this.logger("_updatePreloadInfo preloadinfo null, no preload")}catch(e){this.logger("_updatePreloadInfo err",e)}}},{key:"_loopAbr",value:function(e){var t;this._tickCount++;var r=[];try{this.updateDeviceInfo();var n=this.updateBufferInfo(e),i=n.downloadSpeed,a=n.buffer;t=this.module._getPredictedBitrate(this.bitrate,this._abrMethod);for(var o=0;o<7;o++)r.push(this.module.HEAP32[t/Int32Array.BYTES_PER_ELEMENT+o]);var s=r[0],l=1===r[1];this._eventInfo.now_bitrate=s,this._eventInfo.local_time_ms=(new Date).getTime();var u=0;if(s!==this.bitrate&&0!==s){var c=this.bitrate;u=Math.abs(c-s);for(var d=[],h=this.player.video.buffered,f=0;f<h.length;f++)d.push({start:h.start(f),end:h.end(f)});var p=this._videoWidth||Number(this.config.width),y=this._videoHeight||Number(this.config.height),m=(new Date).getTime(),g={speed:"".concat(i," KB/s"),buffer_length:"".concat(a," s"),video_pos:this.player.currentTime,all_buffers:d,seek_state:this._seekState,stall_state:this._stallState,screen_width:p,screen_height:y,dpr:window&&window.devicePixelRatio,playbackRate:this.player.playbackRate,bitrateSet:this._bitrateSet,abrMethod:this._abrMethod,delta:this._hasExecuteAbrAlgo?m-this._lastExecuteTimeInMs:0};this._lastExecuteTimeInMs=m,this._hasExecuteAbrAlgo=!0,this.player.emit(ABR_EVENTS.ABR_CHANGE,this.bitrate,s,l,JSON.stringify(g)),this.logger("abr loop predicte:",s,"willStall:",l,"switchBitrate",u,"cur",c),this.bitrate=s}this._hasLogStartInfo||(this._hasLogStartInfo=!0,this._generalInfo.startup_info={predict_bitrate:s,download_speed:i,screen_width:this._videoWidth||Number(this.config.width),screen_height:this._videoHeight||Number(this.config.height),device_pixel_ratio:window&&window.devicePixelRatio,screen_fps:this._fps,startup_method:this._abrMethod}),this.player.emit("ABR_LOOP"),this.onAbrLoop(i,r[2],u,r.slice(3))}catch(error){this.logger("abr error",error),console.log("error",error)}finally{this.module._free(t)}return this.bitrate}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===e&&(this._abrAlwaysOn=-1),clearTimeout(this.timerId),this._isPaused=!0,this.logger("abr: stop")}},{key:"destroy",value:function(){var e=this;this._stop(),this.listeners.forEach((function(t){var r=t.evt,n=t.handler;e.player.off(r,n)})),this.player=null,this._heightToDefitionConfig=null,this._bitrateToDefitionConfig=null,this._bufferRange=null,this._sortedBufferRange=null,this.module=null,clearTimeout(this._stallId),clearTimeout(this._updateId),clearTimeout(this.startTimer),window.removeEventListener("resize",this._onWinSizeChange),this.fpsDetection&&this.fpsDetection.stop(),this.player=null}},{key:"eventInfo",get:function(){return this._eventInfo}},{key:"generalInfo",get:function(){return this._generalInfo}},{key:"bufferLength",get:function(){var e=this.player.getBufferedRange(),t=this.player.video.currentTime,r=e[1]-Math.max(e[0],t);return r=Math.max(0,r).toFixed(2),parseFloat(r)}},{key:"downloadSpeed",get:function(){return Math.floor(this.player.downloadSpeed)}},{key:"nowBitrate",get:function(){return this.bitrate}},{key:"openTimeMs",get:function(){return this._openTimeMs}},{key:"isCurrentInAbr",get:function(){return this._currentInAbr},set:function(e){this._currentInAbr=e}},{key:"onAbrLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(this._qoeArgs=n,this._currentItem&&this.avgStat(AVG_ARGS.PLAYBACK_BITRATE,this._currentItem.bitrate),this.avgStat(AVG_ARGS.DOWNLOAD_NETWORK_SPEED,1e3*e*8),this.avgStat(AVG_ARGS.PREDICT_NETWORK_SPEED,t),this.avgStat(AVG_ARGS.BUFFER_LENGTH,this.bufferLength),this.avgStat(AVG_ARGS.QOE,this.getQoeRelValue(0)),r>0&&(this._switchCount++,this._switchBitrate+=r),this._abr_play_info.is_hint){var i=this,a=((new Date).getTime()-this.openTimeMs)/1e3;a=parseFloat(a.toFixed(2)),this._abr_play_info.playback_info.internet_speed_record.push([a,i.downloadSpeed]),this._abr_play_info.playback_info.play_bitrate_record.push([a,i.nowBitrate]),this._abr_play_info.playback_info.buffer_length_record.push([a,i.bufferLength]),this._abr_play_info.playback_info.play_speed_record.push([a,this.player.playbackRate]),this._abr_play_info.playback_info.qoe_record.push([a,this.getQoeRelValue(0)]),this._abr_play_info.playback_info.qoe_a_record.push([a,this.getQoeRelValue(1)]),this._abr_play_info.playback_info.qoe_b_record.push([a,this.getQoeRelValue(2)]),this._abr_play_info.playback_info.qoe_c_record.push([a,this.getQoeRelValue(3)])}}},{key:"getQoeRelValue",value:function(e){return this._qoeArgs[e]/100}},{key:"avgStat",value:function(e,t){var r=this._avgStatItems[e];r&&r.add(t)}},{key:"getAbrPlayInfo",value:function(){return this._abr_play_info}},{key:"updateAbrMethod",value:function(e){this._abrMethod=e}},{key:"getAbrMethod",value:function(){return this._abrMethod}},{key:"getAbrVVStats",value:function(){for(var e={},t=Object.keys(AVG_ARGS),r=0;r<t.length;r++){var n=t[r],i=AVG_ARGS[n],a=this._avgStatItems[i];e[i]=a.avg()}return e.switch_counts=this._switchCount,e.avg_switch_bitrate=0===this._switchCount?0:this._switchBitrate/this._switchCount,e.abr_qoe=this.getQoeRelValue(0),e.abr_qoe_a=this.getQoeRelValue(1),e.abr_qoe_b=this.getQoeRelValue(2),e.abr_qoe_c=this.getQoeRelValue(3),e.abr_method=this._abrMethod,e.abr_used=this._abrUsed,e.abr_always_on=this._abrAlwaysOn,this.logger("abrVVStats",e),e}}],[{key:"getIsPlayAutoDefi",value:function(e){return!!e.isPlayAutoDefi}}]),n}(BaseAbr),AvgStat=function(){function e(){_classCallCheck$b(this,e),this.total=0,this.count=0}return _createClass$c(e,[{key:"add",value:function(e){this.total+=e,this.count++}},{key:"avg",value:function(){if(0===this.count)return 0;var e=this.total/this.count;return Math.floor(e)}}]),e}(),MEDIA_TYPES$1=MEDIA_TYPES$2,PrelaodAbr=function(e){_inherits$9(r,e);var t=_createSuper$c(r);function r(e,n,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{logger:function(){},openLog:!1};return _classCallCheck$c(this,r),t.call(this,e,n,i,a,o)}return _createClass$d(r,[{key:"init",value:function(){return this.onLoadWasm()}},{key:"preloadPredict",value:function(){return this.preload(MEDIA_TYPES$1.VIDEO)}}]),r}(BaseAbr),MixedPredict=function(e){_inherits$9(r,e);var t=_createSuper$c(r);function r(e){var n;return _classCallCheck$c(this,r),(n=t.call(this)).loggerConfig=e,n._isWasmSupport=checkWebAssemblySupport(),n}return _createClass$d(r,[{key:"init",value:function(e){var t=e.autoBitrateOpts||{},r=t.module;return this.isOpenAbr=t.isOpenAutoDefi,this.isOpenAbr&&!r&&(console.warn("if open abr, need [module], abr open change to close"),this.isOpenAbr=!1),this._isWasmSupport&&r&&this.isOpenAbr?(this._abrPreloadInst=new PrelaodAbr(e,0,null,5,this.loggerConfig),this._abrPreloadInst.init()):Promise.resolve()}},{key:"preloadPredict",value:function(e){var t=this._mediaInfos,r=0,n=0;if(this._isWasmSupport&&this.isOpenAbr&&(e.useAbr||void 0===e.useAbr)){this._abrPreloadInst.updateMediaInfos(this._mediaInfos);var i=this._abrPreloadPredict();r=i.videoIdx,n=i.time}else r=this.getIdx(t.dynamic_video_list,e.defaultDefinition),this._cachedData=null;var a=t.dynamic_video_list[r]||t.dynamic_video_list[0];return{bandwidth:a.bitrate||a.bandwidth,executeTime:n}}},{key:"_abrPreloadPredict",value:function(){var e=this._abrPreloadInst.preloadPredict();this._cachedData=e;var t=e.bitrate,r=0,n=this.bandwidth2item[t];if(n){var i=n.definition;r=this.getIdx(this._mediaInfos.dynamic_video_list,i)}return{videoIdx:r,time:e.pduration}}},{key:"cachedData",get:function(){return this._cachedData}}]),r}(PredictBase$1);function transformTopModel(e){e.duration=e.dashOpts.Data.Duration,e.dashOpts.dynamic_video=e.dashOpts.Data,e.dashOpts.dynamic_video.dynamic_video_list=[],e.dashOpts.dynamic_video.dynamic_audio_list=[],e.dashOpts.dynamic_video.dynamic_type=e.dashOpts.Data.AdaptiveInfo.AdaptiveType,e.dashOpts.dynamic_video.main_url=e.dashOpts.Data.AdaptiveInfo.MainPlayUrl;for(var t=0;t<e.dashOpts.Data.PlayInfoList.length;t++){var r=e.dashOpts.Data.PlayInfoList[t],n={backup_url_1:r.BackupPlayUrl,bitrate:e.dashOpts.Data.VideoID?r.Bitrate:1e3*r.Bitrate,check_info:r.CheckInfo,codec_type:r.Codec,definition:r.Definition,encrypt:!(!r.PlayAuth||!r.PlayAuthID&&!r.PlayAuthId),file_hash:r.FileHash||r.Md5,file_id:r.FileID,index_range:r.IndexRange,init_range:r.InitRange,kid:r.PlayAuthID||r.PlayAuthId,logo_type:r.Logo||r.LogoType,main_url:r.MainPlayUrl,preload_interval:r.PreloadInterval,preload_max_step:r.PreloadMaxStep,preload_min_step:r.PreloadMinStep,preload_size:r.PreloadSize,quality:r.Quality,size:r.Size,spade_a:r.PlayAuth,vheight:r.Height,vtype:r.Format,vwidth:r.Width};"video"===r.MediaType||"video"===r.FileType?e.dashOpts.dynamic_video.dynamic_video_list.push(n):"audio"!==r.MediaType&&"audio"!==r.FileType||e.dashOpts.dynamic_video.dynamic_audio_list.push(n)}}var _BITRATE_SELECTOR$1=null,DashPreloader=function(t){_inherits$9(i,t);var r,n=_createSuper$c(i);function i(e,t,r){var a;return _classCallCheck$c(this,i),t.vtype=VTYPES$2.DASH,(a=n.call(this,t)).player=e,a.logger=r||function(){},a.loader=new Loader({},a.preloadManager),a}return _createClass$d(i,[{key:"before",value:function(){var t=this;this.handlers={start:function(e){return t.start(e)},onRequest:function(e,r){var n=e.url,i=e.range,a=e.extData;return t.getData(n,i,a,r)}},this.loggerConfig={logger:function(){},openLog:!1};try{!!localStorage.getItem("abrdebug")&&(this.loggerConfig.logger=console.log,this.loggerConfig.openLog=!0)}catch(e){}this.predictInst=new MixedPredict(this.loggerConfig)}},{key:"start",value:function(e){var t=this,r=new ProxyPromise$1,n=e.payload;if("TOP"===e.playInfoType){var a={dashOpts:e.payload};transformTopModel(a),n=a.dashOpts.dynamic_video}n.dynamic_video_list&&n.dynamic_video_list.forEach((function(e){e.bitrate=e.real_bitrate||e.bitrate})),n.dynamic_audio_list&&n.dynamic_audio_list.forEach((function(e){e.bitrate=e.real_bitrate||e.bitrate}));var o=new MPD("anytext",{dynamic_video:n},this),s={mediaInfos:{dynamic_video_list:[],dynamic_audio_list:[]},onObtain:function(e){var t=new ProxyPromise$1;return t.resolve(s.mediaInfos),t},onTransform:function(r){var a=new ProxyPromise$1;if(i.BitRateAdapter){var s=t.getUserSelectDefinition(),l=util$1.getSelectorList(n,e.duration),u=i.BitRateAdapter.getSuitableBitrate(l,s);t.logger("[xgplayer-encrypt] preloader getSuitableBitrate",u,"userSelectDefinition",s),u&&(r.bandwidth=u.bitrate)}var c=o.mediaList.video||[],d=o.mediaList.audio||[],h=e.vid;if("segment_template"===o.dashType)t._calRequests(o,r,a,e,!0);else{var f=[];if(d&&d.length>0){var p=t.makeInitBaseSegemntRequest(o,e.duration,"audio",0,void 0,h);f.push(p)}if(c&&c.length>0){var y=t._calVideoItemIdx(c,r.bandwidth)||0,m=c[y].definition,g=t.makeInitBaseSegemntRequest(o,e.duration,"video",y,m,h);f.push(g)}Promise.all(f).then((function(){t._calRequests(o,r,a,e)})).catch((function(e){console.warn&&console.warn("catch no reqeuset",e),a.resolve([])}))}return a}};return o.once("ready",(function(){s.type=o.type,s.mediaInfos.dynamic_video_list=o.mediaList.video||[],s.mediaInfos.dynamic_audio_list=o.mediaList.audio||[],r.resolve(s)})),o.init(),r}},{key:"_calRequests",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=[],o=t.bandwidth,s=t.time,l=t.executeTime,u=e.mediaList.video||[],c=e.mediaList.audio||[],d=n.vid;if(c&&c.length>0){var h=this._calUrls(c[0],s,l,"audio",d,null,i);a=a.concat(h)}if(u&&u.length>0){var f=this._calVideoItemIdx(u,o)||0,p=u[f],y=this._calUrls(p,s,l,"video",d,p.definition,i);a=a.concat(y)}0===a.length&&console.warn&&console.warn("no reqeusts from preloader"),r.resolve(a)}},{key:"_calUrls",value:function(e,t,r,n,i,a){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=[];if(e){var l=e;o&&s.push({url:l.initSegment,range:l.initSegmentRange||[],extData:{cacheKey:util$1.generateUniqueKey({vid:i,mediaType:n,codecType:l.codec_type,format:"dash",bitrate:l.bandwidth||l.bitrate}),vid:i,format:"dash",isInitSegment:!0,mediaType:n,useUrlRange:util$1.validateUrlRange(this.options.url_range_domains,l.initSegment)}});var u=e.mediaSegments,c=this._calStartEnd(u,t,r),d=u[c];s.push({url:d.url,range:d.range||[],extData:{cacheKey:util$1.generateUniqueKey({vid:i,mediaType:n,codecType:l.codec_type,format:"dash",start:d.start,end:d.end,definition:a,bitrate:l.bandwidth||l.bitrate}),vid:i,format:"dash",isInitSegment:!1,mediaType:n,useUrlRange:util$1.validateUrlRange(this.options.url_range_domains,d.url)}})}return s}},{key:"_calStartEnd",value:function(e,t,r){for(var n=-1,i=0;i<e.length;i++){var a=e[i],o=t||0;if(a.start>=o&&o<a.end){n=i;break}}return-1===n&&(n=0),n}},{key:"_calVideoItemIdx",value:function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n&&n.bandwidth===t)return r}return null}},{key:"getData",value:(r=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var r,n,i,a,o,s,l,u=arguments;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:[],n=u.length>2&&void 0!==u[2]?u[2]:{},i=u.length>3?u[3]:void 0,e.prev=3,e.next=6,this.loader.load(n.mediaType,t,r,n,!0);case 6:return a=e.sent,o=a.res,s=a.headers,l=a.cacheKey,i&&i({total:o.byteLength,loaded:o.byteLength,cacheKey:l||n.cacheKey}),e.abrupt("return",{res:o,headers:s});case 14:return e.prev=14,e.t0=e.catch(3),console.log("preload get data error",e.t0),e.abrupt("return",{res:null});case 18:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e){return r.apply(this,arguments)})},{key:"makeInitBaseSegemntRequest",value:function(e,t,r,n,i,a){var o=this,s=new ProxyPromise$1,l=e.mediaList[r][n],u=[l.initSegmentRange[0],l.sidxRange[1]],c=l.initSegment,d={mediaType:r,vid:a,definition:i,useUrlRange:util$1.validateUrlRange(this.options.url_range_domains,c),timeout:-1,isInitSegment:!0,bitrate:l.bandwidth||l.bitrate};return this.getData(c,u,d,(function(e){var t=Object.assign({},e,{vid:a,mediaType:r,isInitSegment:!0,format:"dash"});o._preloadManager.onCacheSegment(t)}),-1).then((function(i){var a=i.res;a&&"error"!==a?o.handleInitData(a,u,l.sidxRange).then((function(i){i.sidxSegmentRes&&e.getSidx(i.sidxSegmentRes,r,n,t),util$1.validateFragment(i.initSegmentRes,u)?s.resolve(i.initSegmentRes):(s.reject({mediaType:r,index:n,initSegmentRange:u,url:c,rejected:!0}),o.logger("initSegmentRequest "))})).catch((function(e){s.reject({mediaType:r,index:n,initSegmentRange:u,url:c,rejected:!0}),o.logger("initSegmentRequest error",e)})):s.reject({mediaType:r,index:n,initSegmentRange:u,url:c,rejected:!0})})).catch((function(e){s.reject({mediaType:r,index:n,initSegmentRange:u,url:c,rejected:!0}),o.logger("initSegmentRequest error",e)})),s}},{key:"handleInitData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new ProxyPromise$1,i=e instanceof ArrayBuffer;if(i){var a=0===t.length?e:e.slice(t[0],t[1]+1),o=null===r?null:e.slice(r[0],r[1]+1);n.resolve({initSegmentRes:a,sidxSegmentRes:o})}else;return n}},{key:"checkIfExistInList",value:function(e){for(var t=this._preloadManager._preloadDataList,r=0;r<t.length;r++)if(e===t[r].data.vid)return!0;return!1}},{key:"addPreloader",value:function(e,t){if(e.data){e.data.vtype||(e.data.vtype=VTYPES$2.DASH);var r=e.data.vid,n=this.checkIfExistInList(r);this.logger("[Preloader-Dash] addPreloader checkIfExistInList",r,n),t&&r===t||n||this.addDashPreloader(e)}}},{key:"addPreloaderList",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=0;r<e.length;r++)this.addPreloader(e[r],t)}},{key:"setUserSelectDefinition",value:function(e){this._preloadManager&&(this._preloadManager.userDefinition=e)}},{key:"getUserSelectDefinition",value:function(){return this._preloadManager.userDefinition||null}}],[{key:"BitRateAdapter",get:function(){return _BITRATE_SELECTOR$1},set:function(e){_BITRATE_SELECTOR$1=e}}]),i}(PreloaderBase$1);DashPreloader.encryptUtils=isSupport$2;var $$C=_export,uncurryThis$b=functionUncurryThis,$Date=Date,thisTimeValue=uncurryThis$b($Date.prototype.getTime);$$C({target:"Date",stat:!0},{now:function(){return thisTimeValue(new $Date)}});var $$B=_export,$some$1=arrayIteration.some,arrayMethodIsStrict$2=arrayMethodIsStrict$b,STRICT_METHOD$2=arrayMethodIsStrict$2("some");$$B({target:"Array",proto:!0,forced:!STRICT_METHOD$2},{some:function(e){return $some$1(this,e,arguments.length>1?arguments[1]:void 0)}});var DESCRIPTORS$a=descriptors,uncurryThis$a=functionUncurryThis,objectKeys$1=objectKeys$5,toIndexedObject$3=toIndexedObject$f,$propertyIsEnumerable$1=objectPropertyIsEnumerable.f,propertyIsEnumerable=uncurryThis$a($propertyIsEnumerable$1),push$1=uncurryThis$a([].push),createMethod=function(e){return function(t){for(var r,n=toIndexedObject$3(t),i=objectKeys$1(n),a=i.length,o=0,s=[];a>o;)r=i[o++],DESCRIPTORS$a&&!propertyIsEnumerable(n,r)||push$1(s,e?[r,n[r]]:n[r]);return s}},objectToArray={entries:createMethod(!0),values:createMethod(!1)},$$A=_export,$values=objectToArray.values;function _classCallCheck$9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$a(e,t,r){return t&&_defineProperties$a(e.prototype,t),r&&_defineProperties$a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$6(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$6(e,t)}function _getPrototypeOf$6(e){return(_getPrototypeOf$6=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$6(e,t){return(_setPrototypeOf$6=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$9(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$3(e,t,r){return(_construct$3=_isNativeReflectConstruct$9()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$6(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$3(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$3(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$3=function(e){if(null===e||!_isNativeFunction$3(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$3(e,arguments,_getPrototypeOf$6(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$6(r,e)},_wrapNativeSuper$3(e)}function _assertThisInitialized$6(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$6(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$6(e)}function _createSuper$9(e){var t=_isNativeReflectConstruct$9();return function(){var r,n=_getPrototypeOf$6(e);if(t){var i=_getPrototypeOf$6(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$6(this,r)}}$$A({target:"Object",stat:!0},{values:function(e){return $values(e)}});var toString$9=toString$O,normalizeStringArgument$4=function(e,t){return void 0===e?arguments.length<2?"":t:toString$9(e)},isObject$5=isObject$U,createNonEnumerableProperty$1=createNonEnumerableProperty$o,installErrorCause$1=function(e,t){isObject$5(t)&&"cause"in t&&createNonEnumerableProperty$1(e,"cause",t.cause)},uncurryThis$9=functionUncurryThis$1,$Error=Error,replace$3=uncurryThis$9("".replace),TEST=String($Error("zxcasd").stack),V8_OR_CHAKRA_STACK_ENTRY=/\n\s*at [^:]*:[^\n]*/,IS_V8_OR_CHAKRA_STACK=V8_OR_CHAKRA_STACK_ENTRY.test(TEST),errorStackClear=function(e,t){if(IS_V8_OR_CHAKRA_STACK&&"string"==typeof e&&!$Error.prepareStackTrace)for(;t--;)e=replace$3(e,V8_OR_CHAKRA_STACK_ENTRY,"");return e},fails$a=fails$1Q,createPropertyDescriptor$3=createPropertyDescriptor$k,errorStackInstallable=!fails$a((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",createPropertyDescriptor$3(1,7)),7!==e.stack)})),getBuiltIn$7=getBuiltIn$A,hasOwn$8=hasOwnProperty_1$1,createNonEnumerableProperty=createNonEnumerableProperty$o,isPrototypeOf$2=objectIsPrototypeOf$1,setPrototypeOf$1=objectSetPrototypeOf$1,copyConstructorProperties$1=copyConstructorProperties$6,proxyAccessor=proxyAccessor$4,inheritIfRequired$1=inheritIfRequired$b,normalizeStringArgument$3=normalizeStringArgument$4,installErrorCause=installErrorCause$1,clearErrorStack$2=errorStackClear,ERROR_STACK_INSTALLABLE=errorStackInstallable,DESCRIPTORS$9=descriptors$1,wrapErrorConstructorWithCause$1=function(e,t,r,n){var i="stackTraceLimit",a=n?2:1,o=e.split("."),s=o[o.length-1],l=getBuiltIn$7.apply(null,o);if(l){var u=l.prototype;if(hasOwn$8(u,"cause")&&delete u.cause,!r)return l;var c=getBuiltIn$7("Error"),d=t((function(e,t){var r=normalizeStringArgument$3(n?t:e,void 0),i=n?new l(e):new l;return void 0!==r&&createNonEnumerableProperty(i,"message",r),ERROR_STACK_INSTALLABLE&&createNonEnumerableProperty(i,"stack",clearErrorStack$2(i.stack,2)),this&&isPrototypeOf$2(u,this)&&inheritIfRequired$1(i,this,d),arguments.length>a&&installErrorCause(i,arguments[a]),i}));d.prototype=u,"Error"!==s?setPrototypeOf$1?setPrototypeOf$1(d,c):copyConstructorProperties$1(d,c,{name:!0}):DESCRIPTORS$9&&i in l&&(proxyAccessor(d,l,i),proxyAccessor(d,l,"prepareStackTrace")),copyConstructorProperties$1(d,l);try{u.name!==s&&createNonEnumerableProperty(u,"name",s),u.constructor=d}catch(error){}return d}},$$z=_export$1,global$6=global$1v,apply=functionApply$1,wrapErrorConstructorWithCause=wrapErrorConstructorWithCause$1,WEB_ASSEMBLY="WebAssembly",WebAssembly$1=global$6[WEB_ASSEMBLY],FORCED$4=7!==Error("e",{cause:7}).cause,exportGlobalErrorCauseWrapper=function(e,t){var r={};r[e]=wrapErrorConstructorWithCause(e,t,FORCED$4),$$z({global:!0,constructor:!0,arity:1,forced:FORCED$4},r)},exportWebAssemblyErrorCauseWrapper=function(e,t){if(WebAssembly$1&&WebAssembly$1[e]){var r={};r[e]=wrapErrorConstructorWithCause(WEB_ASSEMBLY+"."+e,t,FORCED$4),$$z({target:WEB_ASSEMBLY,stat:!0,constructor:!0,arity:1,forced:FORCED$4},r)}};exportGlobalErrorCauseWrapper("Error",(function(e){return function(t){return apply(e,this,arguments)}})),exportGlobalErrorCauseWrapper("EvalError",(function(e){return function(t){return apply(e,this,arguments)}})),exportGlobalErrorCauseWrapper("RangeError",(function(e){return function(t){return apply(e,this,arguments)}})),exportGlobalErrorCauseWrapper("ReferenceError",(function(e){return function(t){return apply(e,this,arguments)}})),exportGlobalErrorCauseWrapper("SyntaxError",(function(e){return function(t){return apply(e,this,arguments)}})),exportGlobalErrorCauseWrapper("TypeError",(function(e){return function(t){return apply(e,this,arguments)}})),exportGlobalErrorCauseWrapper("URIError",(function(e){return function(t){return apply(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper("CompileError",(function(e){return function(t){return apply(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper("LinkError",(function(e){return function(t){return apply(e,this,arguments)}})),exportWebAssemblyErrorCauseWrapper("RuntimeError",(function(e){return function(t){return apply(e,this,arguments)}}));var DESCRIPTORS$8=descriptors$1,fails$9=fails$1Q,anObject$2=anObject$L,create$1=objectCreate$2,normalizeStringArgument$2=normalizeStringArgument$4,nativeErrorToString=Error.prototype.toString,INCORRECT_TO_STRING$1=fails$9((function(){if(DESCRIPTORS$8){var e=create$1(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==nativeErrorToString.call(e))return!0}return"2: 1"!==nativeErrorToString.call({message:1,name:2})||"Error"!==nativeErrorToString.call({})})),errorToString$2=INCORRECT_TO_STRING$1?function(){var e=anObject$2(this),t=normalizeStringArgument$2(e.name,"Error"),r=normalizeStringArgument$2(e.message);return t?r?t+": "+r:t:r}:nativeErrorToString,defineBuiltIn$3=defineBuiltIn$D,errorToString$1=errorToString$2,ErrorPrototype$1=Error.prototype;ErrorPrototype$1.toString!==errorToString$1&&defineBuiltIn$3(ErrorPrototype$1,"toString",errorToString$1);var $$y=_export$1,toObject$2=toObject$D,lengthOfArrayLike$3=lengthOfArrayLike$K,setArrayLength$1=arraySetLength$1,doesNotExceedSafeInteger$1=doesNotExceedSafeInteger$9,fails$8=fails$1Q,INCORRECT_TO_LENGTH=fails$8((function(){return 4294967297!==[].push.call({length:4294967296},1)})),SILENT_ON_NON_WRITABLE_LENGTH$1=!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(error){return error instanceof TypeError}}();$$y({target:"Array",proto:!0,arity:1,forced:INCORRECT_TO_LENGTH||SILENT_ON_NON_WRITABLE_LENGTH$1},{push:function(e){var t=toObject$2(this),r=lengthOfArrayLike$3(t),n=arguments.length;doesNotExceedSafeInteger$1(r+n);for(var i=0;i<n;i++)t[r]=arguments[i],r++;return setArrayLength$1(t,r),r}});var CONTENT_TYPES={VIDEO:"video",AUDIO:"audio"},ERROR_TYPES$2={MSE_OP_FAIL:"MS_OP_FAIL",MSE_DESTROY:"MSE_DESTROY",QuotaExceededError:"QuotaExceededError"},MSEError=function(e){_inherits$6(r,e);var t=_createSuper$9(r);function r(e){var n,i=e.msg,a=e.context,o=e.name;return _classCallCheck$9(this,r),(n=t.call(this,i)).context=a,n.name=o,n}return _createClass$a(r)}(_wrapNativeSuper$3(Error)),MSE$1=function(){function t(e,r){_classCallCheck$9(this,t),this.mediaSource=new window.MediaSource(e),this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this._hasDestroyed=!1,this._sourceOpenPromise=new ProxyPromise$1,this._onSourceOpen=this._onSourceOpen.bind(this),this._onSourceBufferError=this._onSourceBufferError.bind(this),this._onSourceBufferUpdateEnd=this._onSourceBufferUpdateEnd.bind(this),this.mediaSource.addEventListener("sourceopen",this._onSourceOpen),this.opQueues={},this.sourceBuffers={},this.updateHanders={},this.errorHandlers={},this.logger=r||function(){},this._sourceOpenDonePromise=new ProxyPromise$1,this.mseFullFlags={}}return _createClass$a(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_defineProperty$a({},CONTENT_TYPES.VIDEO,{mimeType:"video/mp4",codec:'video/mp4; codecs="avc1.64001E, mp4a.40.5"'});this.contentTypes=t;var r=Object.keys(this.contentTypes);return this._sourceOpenPromise.then((function(){for(var t=0;t<r.length;t++)try{!function(){var n=r[t],i=e.contentTypes[n].codec,a=e.mediaSource.addSourceBuffer(i),o=function(){return e._onSourceBufferError(n)};a.addEventListener("error",o);var s=function(){return e._onSourceBufferUpdateEnd(n)};a.addEventListener("updateend",s),e.updateHanders={},e.sourceBuffers[n]=a,e.opQueues[n]=[],e.updateHanders[n]=s,e.errorHandlers[n]=o,e.mseFullFlags[n]=!1}()}catch(error){e._sourceOpenDonePromise.reject(error)}e.logger("[debug mse] mse init ready, readyState",e.mediaSource.readyState),e._sourceOpenDonePromise.resolve()})),this._sourceOpenDonePromise}},{key:"sourceOpenPromise",value:function(){return this._sourceOpenPromise}},{key:"_onSourceOpen",value:function(){this.mediaSource.removeEventListener("sourceopen",this._onSourceOpen),this._sourceOpenPromise.resolve()}},{key:"_onSourceBufferError",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0];this.logger("[debug mse] sourceBuffer error, contentType",e,"readyState",this.mediaSource.readyState,"context",t.context,"name",t.name),t.p.reject(new MSEError({msg:ERROR_TYPES$2.MSE_OP_FAIL,context:t.context,name:t.name}))}}},{key:"_onSourceBufferUpdateEnd",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0];t&&(t.p.resolve(t.context),this.pop(e))}}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration}},{key:"setDuration",value:function(e){var t=this;return this.mediaSource.duration>e?Promise.resolve():this.enqueueBlockOp((function(){t.ended()?t.logger("[debug mse] setDuration ended"):(t.logger("[debug mse] setDuration"),t.mediaSource.duration=e)}),"setDuration")}},{key:"appendBuffer",value:function(e,t,r){var n=this;return this.enqueueOp(e,(function(){return n._append(e,t,r)}),"appendBuffer",r)}},{key:"_append",value:function(e,t,r){this.logger("[real append], len = ",t.byteLength,"context",r),this.sourceBuffers[e].appendBuffer(t)}},{key:"enqueueOp",value:function(e,t,r,n){var i=this;if(this._hasDestroyed)return Promise.reject(new Error(ERROR_TYPES$2.MSE_DESTROY)).catch((function(){}));var a={handler:t,p:new ProxyPromise$1,name:r,context:n};return this._sourceOpenDonePromise.then((function(){if(i._hasDestroyed)return a.p.reject(new Error(ERROR_TYPES$2.MSE_DESTROY)).catch((function(){}));i.opQueues[e]||(i.opQueues[e]=[]),i.mseFullFlags[e]&&"removeBuffer"===a.name?(i.opQueues[e].splice(0,0,a),i.mseFullFlags[e]=!1,i.handleOp(e)):(i.opQueues[e].push(a),1===i.opQueues[e].length&&i.handleOp(e))})),a.p}},{key:"enqueueBlockOp",value:function(t,r){var n=this;if(this._hasDestroyed)return Promise.reject(new Error(ERROR_TYPES$2.MSE_DESTROY));var i=new ProxyPromise$1;return this._sourceOpenDonePromise.then((function(){if(n._hasDestroyed)return i.reject(new Error(ERROR_TYPES$2.MSE_DESTROY));for(var a=[],o=Object.keys(n.contentTypes),s=function(e){var t=o[e],i=new ProxyPromise$1,s={handler:function(){return i.resolve()},p:i,name:r};n.opQueues[t]||(n.opQueues[t]=[]),n.opQueues[t].push(s),a.push(i),1===n.opQueues[t].length&&s.handler()},l=0;l<o.length;l++)s(l);Promise.all(a).then((function(){try{t()}catch(e){console.log(e)}finally{for(var r=0;r<o.length;r++){var a=o[r];n.pop(a)}i.resolve()}})).catch((function(e){console.log("waiting cath",e)}))})),i}},{key:"isFull",get:function(){for(var e=!1,t=Object.keys(this.contentTypes),r=0;r<t.length;r++){var n=t[r];if(this.mseFullFlags[n]){e=!0;break}}return e}},{key:"handleOp",value:function(e){if(!this._hasDestroyed){var t=this.opQueues[e][0],r=this.mseFullFlags[e];if(t&&!r)try{t.handler()}catch(error){t.p.reject(new Error(error.name)),error.name===ERROR_TYPES$2.QuotaExceededError?this.mseFullFlags[e]=!0:this.pop(e)}}}},{key:"pop",value:function(e){this._hasDestroyed||(this.opQueues[e].shift(),this.handleOp(e))}},{key:"clearEnqueAndRemoveBuffer",value:function(e,t,r,n){r<=t?this._onSourceBufferUpdateEnd(e):(this.opQueues[e]=this.opQueues[e].slice(0,1),this.removeBuffer(e,t,r,n))}},{key:"removeBuffer",value:function(e,t,r,n){var i=this;return this.enqueueOp(e,(function(){return i._remove(e,t,r)}),"removeBuffer",n)}},{key:"_remove",value:function(e,t,r){r<=t?this._onSourceBufferUpdateEnd(e):this.sourceBuffers[e].remove(t,r)}},{key:"endOfStream",value:function(){var e=this;return this.enqueueBlockOp((function(){e.ended()||e._hasDestroyed||e.mediaSource.endOfStream()}),"endOfStream")}},{key:"ended",value:function(){return!this.mediaSource||"ended"===this.mediaSource.readyState}},{key:"isMediaSourceOpen",value:function(){return!!this.mediaSource&&"open"===this.mediaSource.readyState}},{key:"abort",value:function(e,t){var r=this;return this.isMediaSourceOpen()?this.enqueueOp(e,(function(){r.sourceBuffers[e].abort(),r._onSourceBufferUpdateEnd(e)}),"abort",t):Promise.resolve()}},{key:"reuse",value:function(e,t){for(var r=Object.keys(this.contentTypes),n=0;n<r.length;n++){var i=r[n];this.removeBuffer(i,e,t)}}},{key:"_forceAbort",value:function(){try{for(var e=Object.keys(this.contentTypes),t=0;t<e.length;t++){var r=e[t];this.sourceBuffers[r].abort()}}catch(error){console.log("forceAbort error")}}},{key:"destroy",value:function(){if(this.logger("[debug mse] destroy execute"),!this._hasDestroyed){this._forceAbort(),this._hasDestroyed=!0,window.URL.revokeObjectURL(this.url),this.mediaSource&&(this.mediaSource.removeEventListener("sourceclose",this._onMediaSourceClose),this.mediaSource.removeEventListener("sourceopen",this._onSourceOpen));for(var e=Object.keys(this.contentTypes),t=0;t<e.length;t++){var r=e[t],n=this.sourceBuffers[r];if(n){var i=this.errorHandlers[r];n.removeEventListener("error",i);var a=this.updateHanders[r];n.removeEventListener("updateend",a)}}this.opQueues={},this.sourceBuffers={}}}},{key:"buffered",value:function(e){return this.sourceBuffers[e]&&this.sourceBuffers[e].buffered}},{key:"sourceBuffer",value:function(e){return this.sourceBuffers[e]}},{key:"removeSourceBuffer",value:function(e){var t=this.sourceBuffer(e);if(t){this.mediaSource.removeSourceBuffer(t);var r=this.errorHandlers[e];t.removeEventListener("error",r);var n=this.updateHanders[e];t.removeEventListener("updateend",n),delete this.errorHandlers[e],delete this.sourceBuffers[e],delete this.updateHanders[e]}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this.enqueueOp(e,(function(){t<0&&(t+=.001),n.sourceBuffers[e].timestampOffset=t,n._onSourceBufferUpdateEnd(e)}),"setTimeoffset",r)}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),t}(),$$x=_export,uncurryThis$8=functionUncurryThis,toString$8=toString$w,charAt$1=uncurryThis$8("".charAt),charCodeAt=uncurryThis$8("".charCodeAt),exec$1=uncurryThis$8(/./.exec),numberToString=uncurryThis$8(1..toString),toUpperCase=uncurryThis$8("".toUpperCase),raw=/[\w*+\-./@]/,hex=function(e,t){for(var r=numberToString(e,16);r.length<t;)r="0"+r;return r};$$x({global:!0},{escape:function(e){for(var t,r,n=toString$8(e),i="",a=n.length,o=0;o<a;)t=charAt$1(n,o++),exec$1(raw,t)?i+=t:i+=(r=charCodeAt(t,0))<256?"%"+hex(r,2):"%u"+toUpperCase(hex(r,4));return i}});var EME$1=function(){function e(t){_classCallCheck$c(this,e),this.drm=t,this.KEYSYSTEM_TYPE="",this.keys={},this.drm.clearKeys?(this.KEYSYSTEM_TYPE="org.w3.clearkey",this.keys=this.drm.clearKeys):this.drm.widevine?(this.KEYSYSTEM_TYPE="com.widevine.alpha",this.keys=this.drm.widevine):this.drm.playready&&(this.KEYSYSTEM_TYPE="com.microsoft.playready",this.keys=this.drm.playready),this.options=[],this.ensurePromise=void 0,this.licenseStep=0,EventEmitter(this)}return _createClass$d(e,[{key:"bail",value:function(e){}},{key:"getLicenseRequestFromMessage",value:function(e){if("com.microsoft.playready"===this.KEYSYSTEM_TYPE){var t=null,r=new DOMParser,n=new Uint16Array(e),i=String.fromCharCode.apply(null,n),a=r.parseFromString(i,"application/xml");if(!a.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var o=a.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return o&&(t=window.atob(o)),t}return new Uint8Array(e)}},{key:"parseServerResponse",value:function(e){var t="http://schemas.xmlsoap.org/soap/envelope/";if(window.DOMParser){var r=this.uintToString(e),n=(new window.DOMParser).parseFromString(r,"text/xml"),i=n?n.getElementsByTagNameNS(t,"Envelope")[0]:null,a=i?i.getElementsByTagNameNS(t,"Body")[0]:null;if(a?a.getElementsByTagNameNS(t,"Fault")[0]:null)return null}return e}},{key:"uintToString",value:function(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}},{key:"licenseRequestReady",value:function(e){var t=this,r=new XMLHttpRequest;r.open("GET",this.keys.serverURL),r.onreadystatechange=function(){if(4===r.readyState){var n=e.message,i=r.response;"com.microsoft.playready"===t.KEYSYSTEM_TYPE&&(i=JSON.parse(r.response),i="".concat(i.licenseAcquisitionUrl,"?ExpressPlayToken=").concat(i.token));var a=new XMLHttpRequest;a.keySession=e.target,a.responseType="arraybuffer",a.withCredentials=!1,a.open("POST",String(i)),"com.microsoft.playready"===t.KEYSYSTEM_TYPE&&a.setRequestHeader("Content-type","text/xml"),a.onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return void t.emit(CDM_LICENSE_ERROR,{data:t.licenseStep});var e;t.emit(CDM_LICENSE_SUCCESS,{data:t.licenseStep}),t.licenseStep++,e="com.microsoft.playready"===t.KEYSYSTEM_TYPE?t.parseServerResponse(a.response):new Uint8Array(a.response),a.keySession.update(e).catch(console.error.bind(console,"update() failed"))}},a.send(t.getLicenseRequestFromMessage(n))}},r.send()}},{key:"UpdateSessionFunc",value:function(e){var t=this;return function(r){var n=[],i=[];Object.keys(e).forEach((function(t){var r=e[t],a=util$1.fromHex(t),o=util$1.fromHex(r),s={kty:"oct",kid:util$1.toBase64(a,!1),k:util$1.toBase64(o,!1)};n.push(s),i.push(s.kid)}));var a={keys:n},o=JSON.stringify(a);r.target.update(util$1.StringToArrayBuffer(o)).then((function(){}),t.bail(" MediaKeySession update failed"))}}},{key:"KeysChange",value:function(e){}},{key:"EnsureMediaKeysCreated",value:function(e,t){return this.ensurePromise||(this.ensurePromise=navigator.requestMediaKeySystemAccess(t,[{initDataTypes:["keyids","webm"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01e"'}]}]).then((function(e){return e.createMediaKeys()}),this.bail(" Failed to request key system access.")).then((function(t){return e.setMediaKeys(t)}),this.bail(" failed to create MediaKeys object"))),this.ensurePromise}},{key:"SetupEME",value:function(e,t){var r=this,n=this;e.sessions=[];util$1.on(this,"encrypted",(function(t){var i,a,o;"org.w3.clearkey"===r.KEYSYSTEM_TYPE?(i="keyids",a=JSON.stringify({kids:["0123456789abcdef0123456789abcdef"]}),o=new Uint8Array(util$1.toUTF8(a))):"com.widevine.alpha"===r.KEYSYSTEM_TYPE?(i="cenc",o=t&&new Uint8Array(t.initData)||new Uint8Array([0,0,0,67,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,35,8,1,18,16,51,51,51,51,51,51,51,51,51,51,51,51,0,0,0,0,26,10,105,110,116,101,114,116,114,117,115,116,34,1,42])):"com.microsoft.playready"===r.KEYSYSTEM_TYPE&&(i="cenc",o=t&&new Uint8Array(t.initData)||new Uint8Array([0,0,2,38,112,115,115,104,0,0,0,0,154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149,0,0,2,6,6,2,0,0,1,0,1,0,252,1,60,0,87,0,82,0,77,0,72,0,69,0,65,0,68,0,69,0,82,0,32,0,120,0,109,0,108,0,110,0,115,0,61,0,34,0,104,0,116,0,116,0,112,0,58,0,47,0,47,0,115,0,99,0,104,0,101,0,109,0,97,0,115,0,46,0,109,0,105,0,99,0,114,0,111,0,115,0,111,0,102,0,116,0,46,0,99,0,111,0,109,0,47,0,68,0,82,0,77,0,47,0,50,0,48,0,48,0,55,0,47,0,48,0,51,0,47,0,80,0,108,0,97,0,121,0,82,0,101,0,97,0,100,0,121,0,72,0,101,0,97,0,100,0,101,0,114,0,34,0,32,0,118,0,101,0,114,0,115,0,105,0,111,0,110,0,61,0,34,0,52,0,46,0,48,0,46,0,48,0,46,0,48,0,34,0,62,0,60,0,68,0,65,0,84,0,65,0,62,0,60,0,80,0,82,0,79,0,84,0,69,0,67,0,84,0,73,0,78,0,70,0,79,0,62,0,60,0,75,0,69,0,89,0,76,0,69,0,78,0,62,0,49,0,54,0,60,0,47,0,75,0,69,0,89,0,76,0,69,0,78,0,62,0,60,0,65,0,76,0,71,0,73,0,68,0,62,0,65,0,69,0,83,0,67,0,84,0,82,0,60,0,47,0,65,0,76,0,71,0,73,0,68,0,62,0,60,0,47,0,80,0,82,0,79,0,84,0,69,0,67,0,84,0,73,0,78,0,70,0,79,0,62,0,60,0,75,0,73,0,68,0,62,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,77,0,122,0,65,0,65,0,65,0,65,0,65,0,65,0,61,0,61,0,60,0,47,0,75,0,73,0,68,0,62,0,60,0,67,0,72,0,69,0,67,0,75,0,83,0,85,0,77,0,62,0,65,0,49,0,53,0,66,0,89,0,87,0,68,0,52,0,113,0,115,0,73,0,61,0,60,0,47,0,67,0,72,0,69,0,67,0,75,0,83,0,85,0,77,0,62,0,60,0,47,0,68,0,65,0,84,0,65,0,62,0,60,0,47,0,87,0,82,0,77,0,72,0,69,0,65,0,68,0,69,0,82,0,62,0])),n.EnsureMediaKeysCreated(e,n.KEYSYSTEM_TYPE).then((function(){var t=e.mediaKeys.createSession();return e.sessions.push(t),"org.w3.clearkey"===n.KEYSYSTEM_TYPE?t.addEventListener("message",n.UpdateSessionFunc(n.keys)):("com.widevine.alpha"===n.KEYSYSTEM_TYPE||"com.microsoft.playready"===n.KEYSYSTEM_TYPE)&&t.addEventListener("message",n.licenseRequestReady.bind(n)),t.addEventListener("keystatuseschange",n.KeysChange),t.generateRequest(i,o.buffer)}),n.bail(" failed to ensure MediaKeys on HTMLMediaElement")).then((function(){}),n.bail(" Failed to generate request."))}),"destroy")}},{key:"destroy",value:function(){allOff(this)}}]),e}(),DASH=function(){function t(e,r,n){_classCallCheck$c(this,t),EventEmitter(this),this._pluginInst=r,this.__dash__=n;var i=r.config,a=r.player,o=r._kernal;this.kernal=o,this.mse=void 0,this.config=i,this.player=a,this.url=e,this.inited=!1,this.loadingTasks=[],this.keyValue=void 0,this.dynamic_video=this.config.dashOpts.dynamic_video,this.useEME=this.config.useEME,this.intertrustServerURL=this.config.intertrustServerURL,this.taskErrorList=[],this.defaultDefinition=this.config.defaultDefinition,this.selectedIdx=0,this.getLicenseUrl=this.config.getLicenseUrl,this.egleIds={},this.first_segment_request={video:{request:!1,ext:{fromCache:!1}},audio:{request:!1,ext:{fromCache:!1}}},this.segment_request={video:[],audio:[]},this.loader=new Loader({openLog:LOGOPEN,onProcessMinLen:this.config.onProcessMinLen},this._pluginInst.preloadManager)}var r,n,i,a;return _createClass$d(t,[{key:"getData",value:(a=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var r,n,i,a,o,s,l,u,c,d,h,f=arguments;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>1&&void 0!==f[1]?f[1]:[],n=f.length>2?f[2]:void 0,i=f.length>3&&void 0!==f[3]?f[3]:{},a=f.length>4&&void 0!==f[4]&&f[4],o=f.length>5&&void 0!==f[5]?f[5]:null,e.next=7,this.loader.load(n,t,r,i,a,o?function(e,t,r,n){o(e,t,r,n,i)}:null);case 7:if(!((s=e.sent).res instanceof ArrayBuffer)){e.next=12;break}return l=s.res,u=s.headers,c=s.status,d=s.fromCache,h=s.cacheKey,d&&this.emitPreloadHit(h),e.abrupt("return",{res:l,headers:u,status:c,fromCache:d});case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"playWithKeyValue",value:function(e,t){var r,n=this;r=n.__dash__.awManager.openBox(t);var i=new ProxyPromise$1;return new Promise((function(e,t){var i=util$1.getCookieValue("volcvui");n.config.useUnionInfoDRM&&util$1.checkUnionInfoExpired(n.player.unionID,i,n.config.keyTokenExpiredDuration)?n.__dash__.awManager.transformWithUnionInfo(r,i).then((function(t){e(t)})):e(r)})).then((function(t){t||n.player.emit("DRM_ERROR",new Errors(Errors.PARSE,Errors.BOX_KEY_ERROR)),n.config.dashOpts.drm={clearKeys:_defineProperty$c({},e,t)},n.keyValue=t,(n.__dash__.dashVideoEncrypted||n.__dash__.dashAudioEncrypted)&&!1===n.useEME&&n.__dash__.crypto?isSupportRawCryptoCTR().then((function(e){debug$2.encrypt("importKeys useRaw",e),n.useRawCrypto=e,e?n.__dash__.crypto.importKeys(n.keyValue).then(i.resolve):i.resolve()})):(debug$2.log("no importKeys"),i.resolve())})),i}},{key:"_getCryptInfos",value:function(){var e="",t="";if(this.dynamic_video.dynamic_video_list&&this.dynamic_video.dynamic_video_list.length>0){for(var r=0;r<this.dynamic_video.dynamic_video_list.length;r++)if(this.dynamic_video.dynamic_video_list[r].kid){e=this.dynamic_video.dynamic_video_list[r].kid,t=this.dynamic_video.dynamic_video_list[r].spade_a;break}}else if(this.dynamic_video.dynamic_audio_list)for(var n=0;n<this.dynamic_video.dynamic_audio_list.length;n++)if(this.dynamic_video.dynamic_audio_list[n].kid){e=this.dynamic_video.dynamic_audio_list[n].kid,t=this.dynamic_video.dynamic_audio_list[n].spade_a;break}return{keyId:e,spade_a:t}}},{key:"init",value:function(e){if(!this._hasDestroyed){this._initStartMs=Date.now(),this.kernal.setNodeTime("initdash","newplayer_start");var t=this._getCryptInfos(),r=t.keyId,n=t.spade_a,i=this;return i.config.dashOpts&&i.config.dashOpts.drm&&!i.useEME&&!i.keyValue&&(i.keyValue=Object.values(i.config.dashOpts.drm.clearKeys)[0],debug$2.log("initDash kv")),new Promise((function(t,a){if(r)if(i.player.emit("drmTypeChange",1),i.intertrustServerURL){var o=window.navigator.userAgent.toLocaleLowerCase().indexOf("chrome")>-1?"widevine":"playready";i.config.dashOpts.drm=_defineProperty$c({},o,{serverURL:i.intertrustServerURL+r}),i.initDash(e,t,a)}else if(i.config.usePlaySpade)setTimeout((function(){i.playWithKeyValue(r,n).then((function(){debug$2.encrypt("playWithKeyValue resolve"),i.initDash(e,t,a)}))}),0);else if(i.config.keyToken&&i.config.playDomain){var s=i.config.playDomain,l=util$1.isBase64(i.config.keyToken)?window.atob(i.config.keyToken):i.config.keyToken;new XHR$1({type:"json",method:"GET",url:"//".concat(s,"?").concat(l,"&DrmType=").concat(i.config.useUnionInfoDRM?"webdevice":"22","&PlayAuthIds=").concat(r,"&ssl=true")}).then((function(o){var u=o.response;u&&u.Result&&u.Result.PlayAuthInfoList?(n=u.Result.PlayAuthInfoList[0].PlayAuthContent,i.playWithKeyValue(r,n).then((function(){debug$2.encrypt("playWithKeyValue resolve"),i.initDash(e,t,a)}))):(i.player.emit("DRM_ERROR",new Errors(Errors.PARSE,Errors.LIC_PARSE_ERROR,{url:i.getLicenseUrl,data:{host:s,keyToken:l}})),a({}))})).catch((function(e){void 0!==e.status&&i.player.emit("DRM_ERROR",new Errors(Errors.LIC_NETWORK,Errors.NETEORK_ERROR_CODES[e&&e.status?e.status:"timeout"],{url:i.getLicenseUrl,data:{host:s,keyToken:l}})),a(e)}))}else{var u={drm_type:"22",license_request:[{vid:i.config.vid||"",kids:[].concat(r)}]};new XHR$1({type:"json",method:"POST",url:i.getLicenseUrl,data:u}).then((function(o){var s=o.response;s&&s.play_licenses?(n=s.play_licenses[i.config.vid][r],i.playWithKeyValue(r,n).then((function(){debug$2.encrypt("playWithKeyValue resolve"),i.initDash(e,t,a)}))):(i.player.emit("DRM_ERROR",new Errors(Errors.PARSE,Errors.LIC_PARSE_ERROR,{url:i.getLicenseUrl,data:u})),a({error:"DRM_ERROR"}))})).catch((function(e){void 0!==e.status&&i.player.emit("DRM_ERROR",new Errors(Errors.LIC_NETWORK,Errors.NETEORK_ERROR_CODES[e&&e.status?e.status:"timeout"],{url:i.getLicenseUrl,data:u})),a(e)}))}else i.initDash(e,t,a)}))}}},{key:"_handleIncompleSegment",value:function(e,t){var r=this;e.incomplete=!0,r.__dash__&&(r.__dash__._minDuration=Math.min(t,r.__dash__._minDuration))}},{key:"initDash",value:function(e,t,r){var n,i,a,o=this;this._pluginInst.info({msg:"dash init",data:"dash init",startMs:this._initStartMs,profile:!0}),this.kernal.setNodeTime("initdashdone","initdash");var s=this;s.config.dashOpts&&s.config.dashOpts.drm&&s.useEME&&(s.eme=new EME$1(s.config.dashOpts.drm),s.eme.on(CDM_LICENSE_ERROR,(function(e){o.player&&o.player.emit("log",_objectSpread2$7({type:"oneevent",end_type:CDM_LICENSE_ERROR,ua:navigator.userAgent},e)),o.player.errorHandler(new Errors(Errors.LIC_NETWORK,Errors.CDM_LICENSE_ERROR,{line:1021,handle:"",msg:"CDM license reject"}))})),s.eme.on(CDM_LICENSE_SUCCESS,(function(e){o.player&&o.player.emit("log",_objectSpread2$7({type:"oneevent",end_type:CDM_LICENSE_SUCCESS,ua:navigator.userAgent},e))}))),this.kernal.setNodeTime("initmpd");var l=new MPD(e,s.config.dashOpts,s);s.mpd=l;var u=Date.now();util$1.once(l,"ready",(function(){if(!s._hasDestroyed){debug$2.log("mpd ready"),o.kernal.setNodeTime("initmpddone"),o._pluginInst.info({msg:"mpd ready",name:"mpd ready",startMs:u,profile:!0}),s.type=l.type,i=l.mediaList.video,a=l.mediaList.audio;var e=s.config?s.config.defaultDefinition:null,r=o._pluginInst.getPreloadStat(),c=!1;if(r.video){var d=Object.keys(r.video)[0],h=util$1.getDefinition(d);h&&(e=h,c=!0)}var f=o.player.config.userSelectDefinition&&o.config.focusUserDefinition;if(f&&(e!==o.player.config.userSelectDefinition&&c&&(c=!1),e=o.player.config.userSelectDefinition),o._pluginInst.bitRateAdapter&&!c&&!f){var p=o.player?o.player.config.userSelectDefinition:null,y=util$1.getBitrateItem(s.config.dashOpts.dynamic_video,o._pluginInst.bitRateAdapter,s.config.duration,p);debug$2.log("[xgplayer-encrypt] onReady",s.config.vid,"item",y),y&&(e=y.definition)}debug$2.log("[xgplayer-encrypt] onReady",s.config.vid,"video definition",e);var m=!1;e&&i.forEach((function(t,r){t.definition===e&&(o.config.defaultDefinition=e,i.selectedIdx=r,m=!0)})),m||(i.selectedIdx=0),s.eme&&s.useEME&&s.eme.SetupEME(s.player.video),debug$2.segment(i),debug$2.segment(a);var g=Date.now();o.kernal.setNodeTime("initmse_sbopen"),n=new MSE$1(s.config&&s.config.mediaType,LOGOPEN?console.log:void 0);var v=!!(i.length>0&&i[i.selectedIdx])&&s.config&&!s.config.dashOpts.audioOnly,b=!!(a.length>0&&a[a.selectedIdx]),_=l.mediaList.audio,E=l.mediaList.video,T={};b&&(T[CONTENT_TYPES.AUDIO]={mimeType:"audio/mp4",codec:'audio/mp4; codecs="'.concat(_[_.selectedIdx].codecs,'"')}),v&&(T[CONTENT_TYPES.VIDEO]={mimeType:"video/mp4",codec:'video/mp4; codecs="'.concat(E[E.selectedIdx].codecs,'"')}),n.init(T).then((function(){o.kernal.setNodeTime("initmse_sbopendone"),o._pluginInst.info({msg:"mse init success",name:"mseInit",startMs:g,profile:!0});var e=[];s.config&&!s.config.dashOpts.audioOnly&&i&&i.length>0&&i[i.selectedIdx]&&i[i.selectedIdx].initSegment&&e.push(s.__dash__._makeInitSegemntRequestWithRetry("video",i.selectedIdx,!0)),a[a.selectedIdx]&&a[a.selectedIdx].initSegment&&e.push(s.__dash__._makeInitSegemntRequestWithRetry("audio",a.selectedIdx,!0)),Promise.all(e).then((function(e){var t,r,n;t=e,r=-1,n=[],(s.config&&s.config.dashOpts.audioOnly?["audio"]:["video","audio"]).forEach((function(e){var i=l.mediaList[e];if(!(i.length<1)&&i[i.selectedIdx]&&i[i.selectedIdx].mimeType){r++;var a=t[r];if(!a.initSegmentRes)return debug$2.abr("initSegment null, task request error, stop"),void s.emit("error",new Errors(Errors.PARSE,Errors.SEG_PARSE_ERROR,{line:180,handle:"[DASH] addBuffer",msg:"wrapperData.initSegmentRes is null"},s.player));n.push(s.__dash__._appendInitSegment(e,a,i.selectedIdx))}})),Promise.all(n).then((function(){o.kernal.setNodeTime("metaready_initsegend"),s.inited=!0,(v&&(i[i.selectedIdx].encrypted||i[i.selectedIdx].kid)||b&&(a[a.selectedIdx].encrypted||a[a.selectedIdx].kid))&&s.eme&&s.eme.emit("encrypted"),"vod"===s.type&&(s.seek(0,0),s.emit("start_play"))})).catch((function(e){s.player.errorHandler(new Errors(Errors.MSE,Errors.MSE_APPEND_ERROR,{line:329,msg:"mse append error ".concat(e.message?e.message:e)}))}))})).catch((function(e){s&&s.player&&s.player.errorHandler(e),debug$2.log("appendInitPromise error",e,"player destroyed ? ",!(s&&s.player))}))})).catch((function(e){s&&s.player&&s.player.errorHandler(new Errors(Errors.MSE,Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED,{line:329,msg:"mse init fail"})),debug$2.log("mse init error",e,"player destroyed ? ",!(s&&s.player))})),s.mse=n,t(n)}})),l.init()}},{key:"seek",value:(i=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t,r){var n,i,a,o,s,l;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.next=3,this.mpd.seek(t,r);case 3:if(i=e.sent,a=n.mpd.mediaList.video,o=n.mpd.mediaList.audio,s=!!(a.length>0&&a[a.selectedIdx]),l=!!(o.length>0&&o[o.selectedIdx]),!(s&&l&&2*a[a.selectedIdx].mediaDuration<o[o.selectedIdx].mediaDuration)){e.next=11;break}return n.emit("error",new Errors(Errors.PARSE,Errors.DUR_PARSE_ERROR,{line:261,handle:"[DASH] seek",msg:"the video.mediaDuration not match audio.mediaDuration"},n.player)),e.abrupt("return");case 11:debug$2.log("seekResult: ",i),(n.config.dashOpts&&n.config.dashOpts.audioOnly?["audio"]:["video","audio"]).forEach((function(e){i[e]&&i[e].length>0&&i[e].every((function(t){return t.downloaded===SEGMENT_STATE.APPEND||t.downloaded===SEGMENT_STATE.GOING||(t.downloaded=SEGMENT_STATE.GOING,n.config.useProgressiveAppend?n.makeSegmentRequest(e,t,(function(r,i,a,o,s){var l=a.range||[t.start,t.end];debug$2.log("append ".concat(e," ").concat(l[0]," ").concat(l[1])),s.range=l,n.appendSegment(e,r,t,{},s,!1,i)})).catch((function(e){n.updateItemState(t),console.log("err1",e)})):n.makeSegmentRequest(e,t).then((function(r){var i=r.res,a=r.headers,o=r.extData;n.updateItemState(t,!0),debug$2.log("append ".concat(e," ").concat(t.start," ").concat(t.end)),n.appendSegment(e,i,t,a||{},o,!0,!0)})).catch((function(e){n.updateItemState(t),console.log("err2",e)}))),!0}))}));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"makeSegmentRequest",value:(n=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v=arguments;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>2&&void 0!==v[2]?v[2]:null,i=this,a=new ProxyPromise$1,void 0===r.range&&(r.range=[]),o=this.first_segment_request[t],(s=!o.request)&&(this.first_segment_request[t].request=!0),l=this.segment_request[t],"video"===t&&debug$2.network("http get video start: ".concat(r.start,", end: ").concat(r.end," ,range: ").concat(r.range)),i.player&&i.__dash__._checkUrlRange(r.url),u={limitSizeM:1/0,segment_resolution:"",isVideo:"video"===t,ratio:i.config.segmentRatio||7.5,vid:i.config.vid,mediaType:t,start:r.start,end:r.end,useUrlRange:i.config.useUrlRange},c=1/0,d=i.mpd.mediaList[t],h=d[d.selectedIdx],"video"===t){try{f=h.definition||i.__dash__.bandwidth2item[h.bandwidth].definition,c=SEGMENT_SIZE_CONFIG[f.toLowerCase()],u.segment_resolution=f.toLowerCase(),u.definition=u.segment_resolution}catch(error){c=1/0}u.limitSizeM=c}return u.bitrate=h.bandwidth||h.bitrate,u.idx=h.idx,s&&(o.task=util$1.nowTime()),e.next=20,this.getData(r.url,r.range,t,u,!1,n);case 20:return(p=e.sent)?(y=p.res,m=p.fromCache,g=y instanceof ArrayBuffer,s&&(o.taskfinish=util$1.nowTime(),o.ext.fromCache=m,o.ext.mediaType=t,o.ext.definition=u.definition,g?o.ext.byteLength=y.byteLength:o.ext.error=y),g||l.push({mediaType:t,definition:r.definition,start:r.start}),y instanceof ArrayBuffer?(a.resolve({res:y,headers:null,extData:{status:p.status,segment_resolution:u.segment_resolution}}),i.mseLog("task loadsucc",r,t)):206===p.status||200===p.status||(i.mseLog("task loaderror",r,t),n&&i.mse.abort("video"===t?CONTENT_TYPES.VIDEO:CONTENT_TYPES.AUDIO),i.updateItemState(r))):(console.log("response err"),a.reject(new Error("request error"))),e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"reportMonitorEvent",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=this,s=o.getReportData(r,n,i,a),l=i.eagleid;if(l){if(!this.egleIds||this.egleIds[l])return;this.egleIds[l]=1}o.player&&o.player.emit("log",{type:"oneevent",end_type:e,cdnUrl:t,ext:s})}},{key:"getReportData",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=util$1.transformHeaders(r,MONITOR_HEADERS$1),a=Object.assign({},{start:e||-1,end:t||-1},i,n);return a}},{key:"reportMenuEvent",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=this._pluginInst.player,o=this.getReportData(t,r,n,i);o.url=e,a.emit("menusegment",o)}},{key:"appendSegment",value:function(t,r,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=this;if(!this._hasDestroyed&&l.mpd&&r){var u,c=a.status,d=a.segment_resolution,h=l.mpd.mediaList[t],f=h.selectedIdx,p=0,y=-1,m=n.realUrl||n.url;if(o&&(r instanceof ArrayBuffer||r instanceof Uint8Array))try{y=r.byteLength;var g=new Uint8Array(r,4,4),v=String.fromCharCode.apply(null,g);if("moof"!==v&&"styp"!==v&&(debug$2.media("segment content error",n,i),p=1,l.reportMonitorEvent(MEDIA_CONTENT_ERR,m,n.range[0],n.range[1],i,{segment_size:r.byteLength,status:c,segment_resolution:d,box_type:v,step:p,segment_origin_size:y})),"ftyp"===v&&200===c&&2===n.range.length){p=2;var b=n.range[0];r=r.slice(b,n.range[1]+1)}}catch(e){l.reportMonitorEvent(MEDIA_CONTENT_ERR,m,n.range[0],n.range[1],i,{segment_size:r.byteLength,status:c,segment_resolution:d,step:p,box_type:"error",segment_origin_size:y}),debug$2.media("segment content catch",n,e)}l.reportMenuEvent(m,n.range[0],n.range[1],i,{segment_size:r.byteLength,status:c,segment_resolution:d}),l.keyValue&&(l.__dash__.dashVideoEncrypted||l.__dash__.dashAudioEncrypted)&&!1===l.useEME&&l.__dash__.crypto?(u=performance.now(),l.mseLog("decryptBody start",n,t),l.__dash__.crypto.decryptBody(r,this.keyValue,"video"===t,l.useRawCrypto).then((function(e){var r=e.data,i=e.id,a=e.headerId;if(r){var o=performance.now();if(l.encryptTotalAll||(l.encryptTotalAll=0),l.encryptTotalAll+=o-u,debug$2.encrypt("encryptTotalAll:".concat(l.encryptTotalAll)),l.mseLog("decryptBody succ",n,t),"video"===t&&(l.encryptTotal||(l.encryptTotal=0),l.encryptTotal+=o-u,debug$2.encrypt("encryptVideo:".concat(l.encryptTotal)),i<a))return l.updateItemState(n),void console.warn("decrytbody discard, id:".concat(i,", headerId:").concat(a,", index:").concat(f,",  url:").concat(n.url,", start:").concat(n.start));l.doAppendSegment(t,h,r,n,f,null,s)}else l.updateItemState(n)}))):l.doAppendSegment(t,h,r,n,f,a.range,s)}}},{key:"doAppendSegment",value:function(e,t,r,n,i,a,o){var s=this;if(!this._hasDestroyed){var l=this,u={start:n.start,end:n.end,index:i,bandwidth:t[t.selectedIdx].bandwidth,fps:t[t.selectedIdx].fps,mediaType:e,sequence:n.idx};e!==CONTENT_TYPES.VIDEO||-1===this.__dash__.curVideoInitSegmentIdx||i===this.__dash__.curVideoInitSegmentIdx?l.mse.appendBuffer(e,new Uint8Array(r),_objectSpread2$7({range:a},u)).then((function(){if(l.player){s.mseLog("appendBuffer success",n,e,a),o&&l.updateItemState(n,!0),"video"===e&&l.player.emit("addVideoBufferEnd",u);var t=l.mse,r=l.mpd;if(t&&u.start>=0&&o){var i=t.buffered(e);if(0===i.length)return;var c=i.end(i.length-1),d=r.mediaList[e][u.index].mediaSegments[u.sequence-1];d.incomplete&&(l._handleIncompleSegment(d,c),debug$2.log("extData",u))}}else debug$2.log("appendBuffer destroy return")})).catch((function(e){debug$2.log("err",e),"QuotaExceededError"!==e.message&&l.updateItemState(n,!1),"QuotaExceededError"===e.message&&l.__dash__&&l.__dash__.clearBuffer(),e&&e.message===ERROR_TYPES$2.MSE_OP_FAIL&&l.player&&l.player.emit(new Errors(Errors.MSE,Errors.MSE_PARSE_ERROR,{line:800,handle:"[DASH] appendInit",msg:e.message}))})):debug$2.log("init  segment")}}},{key:"abortLoadingTasks",value:(r=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(){return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loader.cancel();case 2:debug$2.log("preload abortLoadingTasks");case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"updateItemState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[];e.length>0?r=e:r.push(e),r.forEach((function(e){e.downloaded=t?SEGMENT_STATE.APPEND:SEGMENT_STATE.NO_START}))}},{key:"mseLog",value:function(e,t,r,n){debug$2.mse("type-".concat(r,"-start-").concat(t.start,"-end-").concat(t.end,"-").concat(e,",range:").concat(JSON.stringify(n||t.range)))}},{key:"emitPreloadHit",value:function(e){debug$2.preload("emit preloadhit",e),this.player&&this.player.emit("log",{type:"onetemp",action:"append",data:{preload_hit:e+"|"}})}},{key:"destroy",value:function(){this.loader.cancel(),this._hasDestroyed=!0}}]),t}(),encodedJs$5="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGUoZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiB0KGUsdCl7Zm9yKHZhciByPTA7cjx0Lmxlbmd0aDtyKyspe3ZhciBuPXRbcl07bi5lbnVtZXJhYmxlPW4uZW51bWVyYWJsZXx8ITEsbi5jb25maWd1cmFibGU9ITAsInZhbHVlImluIG4mJihuLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSxuLmtleSxuKX19ZnVuY3Rpb24gcihlLHIsbil7cmV0dXJuIHImJnQoZS5wcm90b3R5cGUsciksbiYmdChlLG4pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJwcm90b3R5cGUiLHt3cml0YWJsZTohMX0pLGV9ZnVuY3Rpb24gbihlLHQscil7cmV0dXJuIHQgaW4gZT9PYmplY3QuZGVmaW5lUHJvcGVydHkoZSx0LHt2YWx1ZTpyLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6ZVt0XT1yLGV9ZnVuY3Rpb24gaShlLHQpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0JiZudWxsIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO2UucHJvdG90eXBlPU9iamVjdC5jcmVhdGUodCYmdC5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTplLHdyaXRhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH19KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwicHJvdG90eXBlIix7d3JpdGFibGU6ITF9KSx0JiZvKGUsdCl9ZnVuY3Rpb24gYShlKXtyZXR1cm4oYT1PYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKTpmdW5jdGlvbihlKXtyZXR1cm4gZS5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZihlKX0pKGUpfWZ1bmN0aW9uIG8oZSx0KXtyZXR1cm4obz1PYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKTpmdW5jdGlvbihlLHQpe3JldHVybiBlLl9fcHJvdG9fXz10LGV9KShlLHQpfWZ1bmN0aW9uIHUoKXtpZigidW5kZWZpbmVkIj09dHlwZW9mIFJlZmxlY3R8fCFSZWZsZWN0LmNvbnN0cnVjdClyZXR1cm4hMTtpZihSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKXJldHVybiExO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBQcm94eSlyZXR1cm4hMDt0cnl7cmV0dXJuIEJvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLFtdLChmdW5jdGlvbigpe30pKSksITB9Y2F0Y2goZSl7cmV0dXJuITF9fWZ1bmN0aW9uIHMoZSx0LHIpe3JldHVybihzPXUoKT9SZWZsZWN0LmNvbnN0cnVjdC5iaW5kKCk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVtudWxsXTtuLnB1c2guYXBwbHkobix0KTt2YXIgaT1uZXcoRnVuY3Rpb24uYmluZC5hcHBseShlLG4pKTtyZXR1cm4gciYmbyhpLHIucHJvdG90eXBlKSxpfSkuYXBwbHkobnVsbCxhcmd1bWVudHMpfWZ1bmN0aW9uIGMoZSx0KXtpZih0JiYoIm9iamVjdCI9PXR5cGVvZiB0fHwiZnVuY3Rpb24iPT10eXBlb2YgdCkpcmV0dXJuIHQ7aWYodm9pZCAwIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpO3JldHVybiBmdW5jdGlvbihlKXtpZih2b2lkIDA9PT1lKXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIGV9KGUpfWZ1bmN0aW9uIGYoZSl7dmFyIHQ9dSgpO3JldHVybiBmdW5jdGlvbigpe3ZhciByLG49YShlKTtpZih0KXt2YXIgaT1hKHRoaXMpLmNvbnN0cnVjdG9yO3I9UmVmbGVjdC5jb25zdHJ1Y3Qobixhcmd1bWVudHMsaSl9ZWxzZSByPW4uYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiBjKHRoaXMscil9fWZ1bmN0aW9uIGwoZSx0KXtmb3IoOyFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KSYmbnVsbCE9PShlPWEoZSkpOyk7cmV0dXJuIGV9ZnVuY3Rpb24geSgpe3JldHVybiB5PSJ1bmRlZmluZWQiIT10eXBlb2YgUmVmbGVjdCYmUmVmbGVjdC5nZXQ/UmVmbGVjdC5nZXQuYmluZCgpOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1sKGUsdCk7aWYobil7dmFyIGk9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihuLHQpO3JldHVybiBpLmdldD9pLmdldC5jYWxsKGFyZ3VtZW50cy5sZW5ndGg8Mz9lOnIpOmkudmFsdWV9fSx5LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1mdW5jdGlvbiBoKGUpe3JldHVybiBmdW5jdGlvbihlKXtpZihBcnJheS5pc0FycmF5KGUpKXJldHVybiBwKGUpfShlKXx8ZnVuY3Rpb24oZSl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJm51bGwhPWVbU3ltYm9sLml0ZXJhdG9yXXx8bnVsbCE9ZVsiQEBpdGVyYXRvciJdKXJldHVybiBBcnJheS5mcm9tKGUpfShlKXx8ZnVuY3Rpb24oZSx0KXtpZighZSlyZXR1cm47aWYoInN0cmluZyI9PXR5cGVvZiBlKXJldHVybiBwKGUsdCk7dmFyIHI9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpLnNsaWNlKDgsLTEpOyJPYmplY3QiPT09ciYmZS5jb25zdHJ1Y3RvciYmKHI9ZS5jb25zdHJ1Y3Rvci5uYW1lKTtpZigiTWFwIj09PXJ8fCJTZXQiPT09cilyZXR1cm4gQXJyYXkuZnJvbShlKTtpZigiQXJndW1lbnRzIj09PXJ8fC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KHIpKXJldHVybiBwKGUsdCl9KGUpfHxmdW5jdGlvbigpe3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpfSgpfWZ1bmN0aW9uIHAoZSx0KXsobnVsbD09dHx8dD5lLmxlbmd0aCkmJih0PWUubGVuZ3RoKTtmb3IodmFyIHI9MCxuPW5ldyBBcnJheSh0KTtyPHQ7cisrKW5bcl09ZVtyXTtyZXR1cm4gbn1mb3IodmFyIHY9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7ZSh0aGlzLHQpfXJldHVybiByKHQsW3trZXk6Im1peEluIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmFzc2lnbih0aGlzLGUpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9bmV3IHRoaXMuY29uc3RydWN0b3I7cmV0dXJuIE9iamVjdC5hc3NpZ24oZSx0aGlzKSxlfX1dLFt7a2V5OiJjcmVhdGUiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgsdD1uZXcgQXJyYXkoZSkscj0wO3I8ZTtyKyspdFtyXT1hcmd1bWVudHNbcl07cmV0dXJuIHModGhpcyx0KX19XSksdH0oKSxkPWZ1bmN0aW9uKHQpe2kobyx0KTt2YXIgbj1mKG8pO2Z1bmN0aW9uIG8oKXt2YXIgdCxyPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTpbXSxpPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo0KnIubGVuZ3RoO2UodGhpcyxvKSx0PW4uY2FsbCh0aGlzKTt2YXIgYT1yO2lmKGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKGE9bmV3IFVpbnQ4QXJyYXkoYSkpLChhIGluc3RhbmNlb2YgSW50OEFycmF5fHxhIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fGEgaW5zdGFuY2VvZiBJbnQxNkFycmF5fHxhIGluc3RhbmNlb2YgVWludDE2QXJyYXl8fGEgaW5zdGFuY2VvZiBJbnQzMkFycmF5fHxhIGluc3RhbmNlb2YgVWludDMyQXJyYXl8fGEgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXl8fGEgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpJiYoYT1uZXcgVWludDhBcnJheShhLmJ1ZmZlcixhLmJ5dGVPZmZzZXQsYS5ieXRlTGVuZ3RoKSksYSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpe2Zvcih2YXIgdT1hLmJ5dGVMZW5ndGgscz1bXSxjPTA7Yzx1O2MrPTEpc1tjPj4+Ml18PWFbY108PDI0LWMlNCo4O3Qud29yZHM9cyx0LnNpZ0J5dGVzPXV9ZWxzZSB0LndvcmRzPXIsdC5zaWdCeXRlcz1pO3JldHVybiB0fXJldHVybiByKG8sW3trZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp3O3JldHVybiBlLnN0cmluZ2lmeSh0aGlzKX19LHtrZXk6ImNvbmNhdCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy53b3JkcyxyPWUud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9ZS5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKz0xKXt2YXIgbz1yW2E+Pj4yXT4+PjI0LWElNCo4JjI1NTt0W24rYT4+PjJdfD1vPDwyNC0obithKSU0Kjh9ZWxzZSBmb3IodmFyIHU9MDt1PGk7dSs9NCl0W24rdT4+PjJdPXJbdT4+PjJdO3JldHVybiB0aGlzLnNpZ0J5dGVzKz1pLHRoaXN9fSx7a2V5OiJjbGFtcCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLndvcmRzLHQ9dGhpcy5zaWdCeXRlcztlW3Q+Pj4yXSY9NDI5NDk2NzI5NTw8MzItdCU0KjgsZS5sZW5ndGg9TWF0aC5jZWlsKHQvNCl9fSx7a2V5OiJjbG9uZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT15KGEoby5wcm90b3R5cGUpLCJjbG9uZSIsdGhpcykuY2FsbCh0aGlzKTtyZXR1cm4gZS53b3Jkcz10aGlzLndvcmRzLnNsaWNlKDApLGV9fV0sW3trZXk6InJhbmRvbSIsdmFsdWU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LHI9W10sbj1mdW5jdGlvbihlKXt2YXIgdD1lLHI9OTg3NjU0MzIxLG49NDI5NDk2NzI5NTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT0oKHI9MzY5NjkqKDY1NTM1JnIpKyhyPj4xNikmbik8PDE2KSsodD0xOGUzKig2NTUzNSZ0KSsodD4+MTYpJm4pJm47cmV0dXJuIGUvPTQyOTQ5NjcyOTYsKGUrPS41KSooTWF0aC5yYW5kb20oKT4uNT8xOi0xKX19LGk9MDtpPGU7aSs9NCl7dmFyIGE9big0Mjk0OTY3Mjk2Kih0fHxNYXRoLnJhbmRvbSgpKSk7dD05ODc2NTQwNzEqYSgpLHIucHVzaCg0Mjk0OTY3Mjk2KmEoKXwwKX1yZXR1cm4gbmV3IG8ocixlKX19XSksb30odiksdz17c3RyaW5naWZ5OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLndvcmRzLHI9ZS5zaWdCeXRlcyxuPVtdLGk9MDtpPHI7aSs9MSl7dmFyIGE9dFtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKChhPj4+NCkudG9TdHJpbmcoMTYpKSxuLnB1c2goKDE1JmEpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPVtdLG49MDtuPHQ7bis9MilyW24+Pj4zXXw9cGFyc2VJbnQoZS5zdWJzdHIobiwyKSwxNik8PDI0LW4lOCo0O3JldHVybiBuZXcgZChyLHQvMil9fSxnPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lLmxlbmd0aCxyPVtdLG49MDtuPHQ7bis9MSlyW24+Pj4yXXw9KDI1NSZlLmNoYXJDb2RlQXQobikpPDwyNC1uJTQqODtyZXR1cm4gbmV3IGQocix0KX0sbT1mdW5jdGlvbihlKXtyZXR1cm4gZyh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoZSkpKX0sYj1mdW5jdGlvbih0KXtpKG8sdCk7dmFyIG49ZihvKTtmdW5jdGlvbiBvKCl7dmFyIHQ7cmV0dXJuIGUodGhpcyxvKSwodD1uLmNhbGwodGhpcykpLl9taW5CdWZmZXJTaXplPTAsdH1yZXR1cm4gcihvLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhPW5ldyBkLHRoaXMuX25EYXRhQnl0ZXM9MH19LHtrZXk6Il9hcHBlbmQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWU7InN0cmluZyI9PXR5cGVvZiB0JiYodD1tKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfX0se2tleToiX3Byb2Nlc3MiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0LHI9dGhpcy5fZGF0YSxuPXRoaXMuYmxvY2tTaXplLGk9ci53b3JkcyxhPXIuc2lnQnl0ZXMsbz1hLyg0Km4pLHU9KG89ZT9NYXRoLmNlaWwobyk6TWF0aC5tYXgoKDB8byktdGhpcy5fbWluQnVmZmVyU2l6ZSwwKSkqbixzPU1hdGgubWluKDQqdSxhKTtpZih1KXtmb3IodmFyIGM9MDtjPHU7Yys9bil0aGlzLl9kb1Byb2Nlc3NCbG9jayhpLGMpO3Q9aS5zcGxpY2UoMCx1KSxyLnNpZ0J5dGVzLT1zfXJldHVybiBuZXcgZCh0LHMpfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9eShhKG8ucHJvdG90eXBlKSwiY2xvbmUiLHRoaXMpLmNhbGwodGhpcyk7cmV0dXJuIGUuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLGV9fV0pLG99KHYpLGs9ZnVuY3Rpb24odCl7aShvLHQpO3ZhciBuPWYobyk7ZnVuY3Rpb24gbyh0KXt2YXIgcjtyZXR1cm4gZSh0aGlzLG8pLChyPW4uY2FsbCh0aGlzKSkuYmxvY2tTaXplPTE2LHIuY2ZnPU9iamVjdC5hc3NpZ24obmV3IHYsdCksci5yZXNldCgpLHJ9cmV0dXJuIHIobyxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7eShhKG8ucHJvdG90eXBlKSwicmVzZXQiLHRoaXMpLmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfX0se2tleToidXBkYXRlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fYXBwZW5kKGUpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlJiZ0aGlzLl9hcHBlbmQoZSksdGhpcy5fZG9GaW5hbGl6ZSgpfX1dLFt7a2V5OiJfY3JlYXRlSGVscGVyIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCxyKXtyZXR1cm4gbmV3IGUocikuZmluYWxpemUodCl9fX0se2tleToiX2NyZWF0ZUhtYWNIZWxwZXIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0LHIpe3JldHVybiBuZXcgXyhlLHIpLmZpbmFsaXplKHQpfX19XSksb30oYiksXz1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKHQscil7dmFyIGk7ZSh0aGlzLGEpLGk9bi5jYWxsKHRoaXMpO3ZhciBvPW5ldyB0O2kuX2hhc2hlcj1vO3ZhciB1PXI7InN0cmluZyI9PXR5cGVvZiB1JiYodT1tKHUpKTt2YXIgcz1vLmJsb2NrU2l6ZSxjPTQqczt1LnNpZ0J5dGVzPmMmJih1PW8uZmluYWxpemUocikpLHUuY2xhbXAoKTt2YXIgZj11LmNsb25lKCk7aS5fb0tleT1mO3ZhciBsPXUuY2xvbmUoKTtpLl9pS2V5PWw7Zm9yKHZhciB5PWYud29yZHMsaD1sLndvcmRzLHA9MDtwPHM7cCs9MSl5W3BdXj0xNTQ5NTU2ODI4LGhbcF1ePTkwOTUyMjQ4NjtyZXR1cm4gZi5zaWdCeXRlcz1jLGwuc2lnQnl0ZXM9YyxpLnJlc2V0KCksaX1yZXR1cm4gcihhLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLl9oYXNoZXI7ZS5yZXNldCgpLGUudXBkYXRlKHRoaXMuX2lLZXkpfX0se2tleToidXBkYXRlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZShlKSx0aGlzfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2hhc2hlcixyPXQuZmluYWxpemUoZSk7cmV0dXJuIHQucmVzZXQoKSx0LmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQocikpfX1dKSxhfSh2KSx4PXtzdHJpbmdpZnk6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS53b3JkcyxyPWUuc2lnQnl0ZXMsbj10aGlzLl9tYXA7ZS5jbGFtcCgpO2Zvcih2YXIgaT1bXSxhPTA7YTxyO2ErPTMpZm9yKHZhciBvPSh0W2E+Pj4yXT4+PjI0LWElNCo4JjI1NSk8PDE2fCh0W2ErMT4+PjJdPj4+MjQtKGErMSklNCo4JjI1NSk8PDh8dFthKzI+Pj4yXT4+PjI0LShhKzIpJTQqOCYyNTUsdT0wO3U8NCYmYSsuNzUqdTxyO3UrPTEpaS5wdXNoKG4uY2hhckF0KG8+Pj42KigzLXUpJjYzKSk7dmFyIHM9bi5jaGFyQXQoNjQpO2lmKHMpZm9yKDtpLmxlbmd0aCU0OylpLnB1c2gocyk7cmV0dXJuIGkuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKGUpe3ZhciB0PWUubGVuZ3RoLHI9dGhpcy5fbWFwLG49dGhpcy5fcmV2ZXJzZU1hcDtpZighbil7dGhpcy5fcmV2ZXJzZU1hcD1bXSxuPXRoaXMuX3JldmVyc2VNYXA7Zm9yKHZhciBpPTA7aTxyLmxlbmd0aDtpKz0xKW5bci5jaGFyQ29kZUF0KGkpXT1pfXZhciBhPXIuY2hhckF0KDY0KTtpZihhKXt2YXIgbz1lLmluZGV4T2YoYSk7LTEhPT1vJiYodD1vKX1yZXR1cm4gZnVuY3Rpb24oZSx0LHIpe2Zvcih2YXIgbj1bXSxpPTAsYT0wO2E8dDthKz0xKWlmKGElNCl7dmFyIG89cltlLmNoYXJDb2RlQXQoYS0xKV08PGElNCoyfHJbZS5jaGFyQ29kZUF0KGEpXT4+PjYtYSU0KjI7bltpPj4+Ml18PW88PDI0LWklNCo4LGkrPTF9cmV0dXJuIGQuY3JlYXRlKG4saSl9KGUsdCxuKX0sX21hcDoiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0ifSxBPVtdLHo9MDt6PDY0O3orPTEpQVt6XT00Mjk0OTY3Mjk2Kk1hdGguYWJzKE1hdGguc2luKHorMSkpfDA7dmFyIFM9ZnVuY3Rpb24oZSx0LHIsbixpLGEsbyl7dmFyIHU9ZSsodCZyfH50Jm4pK2krbztyZXR1cm4odTw8YXx1Pj4+MzItYSkrdH0sVT1mdW5jdGlvbihlLHQscixuLGksYSxvKXt2YXIgdT1lKyh0Jm58ciZ+bikraStvO3JldHVybih1PDxhfHU+Pj4zMi1hKSt0fSxDPWZ1bmN0aW9uKGUsdCxyLG4saSxhLG8pe3ZhciB1PWUrKHRecl5uKStpK287cmV0dXJuKHU8PGF8dT4+PjMyLWEpK3R9LEI9ZnVuY3Rpb24oZSx0LHIsbixpLGEsbyl7dmFyIHU9ZSsocl4odHx+bikpK2krbztyZXR1cm4odTw8YXx1Pj4+MzItYSkrdH0sTz1mdW5jdGlvbih0KXtpKG8sdCk7dmFyIG49ZihvKTtmdW5jdGlvbiBvKCl7cmV0dXJuIGUodGhpcyxvKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihvLFt7a2V5OiJfZG9SZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBkKFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX19LHtrZXk6Il9kb1Byb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9ZSxuPTA7bjwxNjtuKz0xKXt2YXIgaT10K24sYT1lW2ldO3JbaV09MTY3MTE5MzUmKGE8PDh8YT4+PjI0KXw0Mjc4MjU1MzYwJihhPDwyNHxhPj4+OCl9dmFyIG89dGhpcy5faGFzaC53b3Jkcyx1PXJbdCswXSxzPXJbdCsxXSxjPXJbdCsyXSxmPXJbdCszXSxsPXJbdCs0XSx5PXJbdCs1XSxoPXJbdCs2XSxwPXJbdCs3XSx2PXJbdCs4XSxkPXJbdCs5XSx3PXJbdCsxMF0sZz1yW3QrMTFdLG09clt0KzEyXSxiPXJbdCsxM10saz1yW3QrMTRdLF89clt0KzE1XSx4PW9bMF0sej1vWzFdLE89b1syXSxFPW9bM107eD1TKHgseixPLEUsdSw3LEFbMF0pLEU9UyhFLHgseixPLHMsMTIsQVsxXSksTz1TKE8sRSx4LHosYywxNyxBWzJdKSx6PVMoeixPLEUseCxmLDIyLEFbM10pLHg9Uyh4LHosTyxFLGwsNyxBWzRdKSxFPVMoRSx4LHosTyx5LDEyLEFbNV0pLE89UyhPLEUseCx6LGgsMTcsQVs2XSksej1TKHosTyxFLHgscCwyMixBWzddKSx4PVMoeCx6LE8sRSx2LDcsQVs4XSksRT1TKEUseCx6LE8sZCwxMixBWzldKSxPPVMoTyxFLHgseix3LDE3LEFbMTBdKSx6PVMoeixPLEUseCxnLDIyLEFbMTFdKSx4PVMoeCx6LE8sRSxtLDcsQVsxMl0pLEU9UyhFLHgseixPLGIsMTIsQVsxM10pLE89UyhPLEUseCx6LGssMTcsQVsxNF0pLHo9Uyh6LE8sRSx4LF8sMjIsQVsxNV0pLHg9VSh4LHosTyxFLHMsNSxBWzE2XSksRT1VKEUseCx6LE8saCw5LEFbMTddKSxPPVUoTyxFLHgseixnLDE0LEFbMThdKSx6PVUoeixPLEUseCx1LDIwLEFbMTldKSx4PVUoeCx6LE8sRSx5LDUsQVsyMF0pLEU9VShFLHgseixPLHcsOSxBWzIxXSksTz1VKE8sRSx4LHosXywxNCxBWzIyXSksej1VKHosTyxFLHgsbCwyMCxBWzIzXSkseD1VKHgseixPLEUsZCw1LEFbMjRdKSxFPVUoRSx4LHosTyxrLDksQVsyNV0pLE89VShPLEUseCx6LGYsMTQsQVsyNl0pLHo9VSh6LE8sRSx4LHYsMjAsQVsyN10pLHg9VSh4LHosTyxFLGIsNSxBWzI4XSksRT1VKEUseCx6LE8sYyw5LEFbMjldKSxPPVUoTyxFLHgseixwLDE0LEFbMzBdKSx6PVUoeixPLEUseCxtLDIwLEFbMzFdKSx4PUMoeCx6LE8sRSx5LDQsQVszMl0pLEU9QyhFLHgseixPLHYsMTEsQVszM10pLE89QyhPLEUseCx6LGcsMTYsQVszNF0pLHo9Qyh6LE8sRSx4LGssMjMsQVszNV0pLHg9Qyh4LHosTyxFLHMsNCxBWzM2XSksRT1DKEUseCx6LE8sbCwxMSxBWzM3XSksTz1DKE8sRSx4LHoscCwxNixBWzM4XSksej1DKHosTyxFLHgsdywyMyxBWzM5XSkseD1DKHgseixPLEUsYiw0LEFbNDBdKSxFPUMoRSx4LHosTyx1LDExLEFbNDFdKSxPPUMoTyxFLHgseixmLDE2LEFbNDJdKSx6PUMoeixPLEUseCxoLDIzLEFbNDNdKSx4PUMoeCx6LE8sRSxkLDQsQVs0NF0pLEU9QyhFLHgseixPLG0sMTEsQVs0NV0pLE89QyhPLEUseCx6LF8sMTYsQVs0Nl0pLHo9Qyh6LE8sRSx4LGMsMjMsQVs0N10pLHg9Qih4LHosTyxFLHUsNixBWzQ4XSksRT1CKEUseCx6LE8scCwxMCxBWzQ5XSksTz1CKE8sRSx4LHosaywxNSxBWzUwXSksej1CKHosTyxFLHgseSwyMSxBWzUxXSkseD1CKHgseixPLEUsbSw2LEFbNTJdKSxFPUIoRSx4LHosTyxmLDEwLEFbNTNdKSxPPUIoTyxFLHgseix3LDE1LEFbNTRdKSx6PUIoeixPLEUseCxzLDIxLEFbNTVdKSx4PUIoeCx6LE8sRSx2LDYsQVs1Nl0pLEU9QihFLHgseixPLF8sMTAsQVs1N10pLE89QihPLEUseCx6LGgsMTUsQVs1OF0pLHo9Qih6LE8sRSx4LGIsMjEsQVs1OV0pLHg9Qih4LHosTyxFLGwsNixBWzYwXSksRT1CKEUseCx6LE8sZywxMCxBWzYxXSksTz1CKE8sRSx4LHosYywxNSxBWzYyXSksej1CKHosTyxFLHgsZCwyMSxBWzYzXSksb1swXT1vWzBdK3h8MCxvWzFdPW9bMV0renwwLG9bMl09b1syXStPfDAsb1szXT1vWzNdK0V8MH19LHtrZXk6Il9kb0ZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMuX2RhdGEsdD1lLndvcmRzLHI9OCp0aGlzLl9uRGF0YUJ5dGVzLG49OCplLnNpZ0J5dGVzO3Rbbj4+PjVdfD0xMjg8PDI0LW4lMzI7dmFyIGk9TWF0aC5mbG9vcihyLzQyOTQ5NjcyOTYpLGE9cjt0WzE1KyhuKzY0Pj4+OTw8NCldPTE2NzExOTM1JihpPDw4fGk+Pj4yNCl8NDI3ODI1NTM2MCYoaTw8MjR8aT4+PjgpLHRbMTQrKG4rNjQ+Pj45PDw0KV09MTY3MTE5MzUmKGE8PDh8YT4+PjI0KXw0Mjc4MjU1MzYwJihhPDwyNHxhPj4+OCksZS5zaWdCeXRlcz00Kih0Lmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBvPXRoaXMuX2hhc2gsdT1vLndvcmRzLHM9MDtzPDQ7cys9MSl7dmFyIGM9dVtzXTt1W3NdPTE2NzExOTM1JihjPDw4fGM+Pj4yNCl8NDI3ODI1NTM2MCYoYzw8MjR8Yz4+PjgpfXJldHVybiBvfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9eShhKG8ucHJvdG90eXBlKSwiY2xvbmUiLHRoaXMpLmNhbGwodGhpcyk7cmV0dXJuIGUuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLGV9fV0pLG99KGspO2suX2NyZWF0ZUhlbHBlcihPKSxrLl9jcmVhdGVIbWFjSGVscGVyKE8pO3ZhciBFPWZ1bmN0aW9uKHQpe2koYSx0KTt2YXIgbj1mKGEpO2Z1bmN0aW9uIGEodCl7dmFyIHI7cmV0dXJuIGUodGhpcyxhKSwocj1uLmNhbGwodGhpcykpLmNmZz1PYmplY3QuYXNzaWduKG5ldyB2LHtrZXlTaXplOjQsaGFzaGVyOk8saXRlcmF0aW9uczoxfSx0KSxyfXJldHVybiByKGEsW3trZXk6ImNvbXB1dGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByLG49dGhpcy5jZmcsaT1uLmhhc2hlci5jcmVhdGUoKSxhPWQuY3JlYXRlKCksbz1hLndvcmRzLHU9bi5rZXlTaXplLHM9bi5pdGVyYXRpb25zO28ubGVuZ3RoPHU7KXtyJiZpLnVwZGF0ZShyKSxyPWkudXBkYXRlKGUpLmZpbmFsaXplKHQpLGkucmVzZXQoKTtmb3IodmFyIGM9MTtjPHM7Yys9MSlyPWkuZmluYWxpemUociksaS5yZXNldCgpO2EuY29uY2F0KHIpfXJldHVybiBhLnNpZ0J5dGVzPTQqdSxhfX1dKSxhfSh2KSxMPWZ1bmN0aW9uKHQpe2kobyx0KTt2YXIgbj1mKG8pO2Z1bmN0aW9uIG8odCxyLGkpe3ZhciBhO3JldHVybiBlKHRoaXMsbyksKGE9bi5jYWxsKHRoaXMpKS5jZmc9T2JqZWN0LmFzc2lnbihuZXcgdixpKSxhLl94Zm9ybU1vZGU9dCxhLl9rZXk9cixhLnJlc2V0KCksYX1yZXR1cm4gcihvLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt5KGEoby5wcm90b3R5cGUpLCJyZXNldCIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9fSx7a2V5OiJwcm9jZXNzIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fYXBwZW5kKGUpLHRoaXMuX3Byb2Nlc3MoKX19LHtrZXk6ImZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmdGhpcy5fYXBwZW5kKGUpLHRoaXMuX2RvRmluYWxpemUoKX19XSxbe2tleToiY3JlYXRlRW5jcnlwdG9yIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9FTkNfWEZPUk1fTU9ERSxlLHQpfX0se2tleToiY3JlYXRlRGVjcnlwdG9yIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSxlLHQpfX0se2tleToiX2NyZWF0ZUhlbHBlciIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9ZnVuY3Rpb24oZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlP0Y6SH07cmV0dXJue2VuY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmVuY3J5cHQoZSxyLG4saSl9LGRlY3J5cHQ6ZnVuY3Rpb24ocixuLGkpe3JldHVybiB0KG4pLmRlY3J5cHQoZSxyLG4saSl9fX19XSksb30oYik7TC5fRU5DX1hGT1JNX01PREU9MSxMLl9ERUNfWEZPUk1fTU9ERT0yLEwua2V5U2l6ZT00LEwuaXZTaXplPTQ7dmFyIEk9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSh0LHIpe3ZhciBpO3JldHVybiBlKHRoaXMsYSksKGk9bi5jYWxsKHRoaXMpKS5fY2lwaGVyPXQsaS5faXY9cixpfXJldHVybiByKGEsbnVsbCxbe2tleToiY3JlYXRlRW5jcnlwdG9yIix2YWx1ZTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUoZSx0KX19LHtrZXk6ImNyZWF0ZURlY3J5cHRvciIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5EZWNyeXB0b3IuY3JlYXRlKGUsdCl9fV0pLGF9KHYpO2Z1bmN0aW9uIFIoZSx0LHIpe3ZhciBuLGk9ZSxhPXRoaXMuX2l2O2E/KG49YSx0aGlzLl9pdj12b2lkIDApOm49dGhpcy5fcHJldkJsb2NrO2Zvcih2YXIgbz0wO288cjtvKz0xKWlbdCtvXV49bltvXX12YXIgRD1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIGUodGhpcyxhKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihhKX0oSSk7RC5FbmNyeXB0b3I9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiBlKHRoaXMsYSksbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIHIoYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixuPXIuYmxvY2tTaXplO1IuY2FsbCh0aGlzLGUsdCxuKSxyLmVuY3J5cHRCbG9jayhlLHQpLHRoaXMuX3ByZXZCbG9jaz1lLnNsaWNlKHQsdCtuKX19XSksYX0oRCksRC5EZWNyeXB0b3I9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiBlKHRoaXMsYSksbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIHIoYSxbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPXRoaXMuX2NpcGhlcixuPXIuYmxvY2tTaXplLGk9ZS5zbGljZSh0LHQrbik7ci5kZWNyeXB0QmxvY2soZSx0KSxSLmNhbGwodGhpcyxlLHQsbiksdGhpcy5fcHJldkJsb2NrPWl9fV0pLGF9KEQpO3ZhciBNPXtwYWQ6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9NCp0LG49ci1lLnNpZ0J5dGVzJXIsaT1uPDwyNHxuPDwxNnxuPDw4fG4sYT1bXSxvPTA7bzxuO28rPTQpYS5wdXNoKGkpO3ZhciB1PWQuY3JlYXRlKGEsbik7ZS5jb25jYXQodSl9LHVucGFkOmZ1bmN0aW9uKGUpe3ZhciB0PWUscj0yNTUmdC53b3Jkc1t0LnNpZ0J5dGVzLTE+Pj4yXTt0LnNpZ0J5dGVzLT1yfX0sVD1mdW5jdGlvbih0KXtpKG8sdCk7dmFyIG49ZihvKTtmdW5jdGlvbiBvKHQscixpKXt2YXIgYTtyZXR1cm4gZSh0aGlzLG8pLChhPW4uY2FsbCh0aGlzLHQscixPYmplY3QuYXNzaWduKHttb2RlOkQscGFkZGluZzpNfSxpKSkpLmJsb2NrU2l6ZT00LGF9cmV0dXJuIHIobyxbe2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU7eShhKG8ucHJvdG90eXBlKSwicmVzZXQiLHRoaXMpLmNhbGwodGhpcyk7dmFyIHQ9dGhpcy5jZmcscj10Lml2LG49dC5tb2RlO3RoaXMuX3hmb3JtTW9kZT09PXRoaXMuY29uc3RydWN0b3IuX0VOQ19YRk9STV9NT0RFP2U9bi5jcmVhdGVFbmNyeXB0b3I6KGU9bi5jcmVhdGVEZWNyeXB0b3IsdGhpcy5fbWluQnVmZmVyU2l6ZT0xKSx0aGlzLl9tb2RlPWUuY2FsbChuLHRoaXMsciYmci53b3JkcyksdGhpcy5fbW9kZS5fX2NyZWF0b3I9ZX19LHtrZXk6Il9kb1Byb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt0aGlzLl9tb2RlLnByb2Nlc3NCbG9jayhlLHQpfX0se2tleToiX2RvRmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGUsdD10aGlzLmNmZy5wYWRkaW5nO3JldHVybiB0aGlzLl94Zm9ybU1vZGU9PT10aGlzLmNvbnN0cnVjdG9yLl9FTkNfWEZPUk1fTU9ERT8odC5wYWQodGhpcy5fZGF0YSx0aGlzLmJsb2NrU2l6ZSksZT10aGlzLl9wcm9jZXNzKCEwKSk6KGU9dGhpcy5fcHJvY2VzcyghMCksdC51bnBhZChlKSksZX19XSksb30oTCksaj1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKHQpe3ZhciByO3JldHVybiBlKHRoaXMsYSksKHI9bi5jYWxsKHRoaXMpKS5taXhJbih0KSxyfXJldHVybiByKGEsW3trZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4oZXx8dGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKX19XSksYX0odiksVj17c3RyaW5naWZ5OmZ1bmN0aW9uKGUpe3ZhciB0PWUuY2lwaGVydGV4dCxyPWUuc2FsdDtyZXR1cm4ocj9kLmNyZWF0ZShbMTM5ODg5MzY4NCwxNzAxMDc2ODMxXSkuY29uY2F0KHIpLmNvbmNhdCh0KTp0KS50b1N0cmluZyh4KX0scGFyc2U6ZnVuY3Rpb24oZSl7dmFyIHQscj14LnBhcnNlKGUpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09PW5bMF0mJjE3MDEwNzY4MzE9PT1uWzFdJiYodD1kLmNyZWF0ZShuLnNsaWNlKDIsNCkpLG4uc3BsaWNlKDAsNCksci5zaWdCeXRlcy09MTYpLGouY3JlYXRlKHtjaXBoZXJ0ZXh0OnIsc2FsdDp0fSl9fSxIPWZ1bmN0aW9uKHQpe2koYSx0KTt2YXIgbj1mKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gZSh0aGlzLGEpLG4uYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiByKGEsbnVsbCxbe2tleToiZW5jcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGk9T2JqZWN0LmFzc2lnbihuZXcgdix0aGlzLmNmZyxuKSxhPWUuY3JlYXRlRW5jcnlwdG9yKHIsaSksbz1hLmZpbmFsaXplKHQpLHU9YS5jZmc7cmV0dXJuIGouY3JlYXRlKHtjaXBoZXJ0ZXh0Om8sa2V5OnIsaXY6dS5pdixhbGdvcml0aG06ZSxtb2RlOnUubW9kZSxwYWRkaW5nOnUucGFkZGluZyxibG9ja1NpemU6YS5ibG9ja1NpemUsZm9ybWF0dGVyOmkuZm9ybWF0fSl9fSx7a2V5OiJkZWNyeXB0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixuKXt2YXIgaT10LGE9T2JqZWN0LmFzc2lnbihuZXcgdix0aGlzLmNmZyxuKTtyZXR1cm4gaT10aGlzLl9wYXJzZShpLGEuZm9ybWF0KSxlLmNyZWF0ZURlY3J5cHRvcihyLGEpLmZpbmFsaXplKGkuY2lwaGVydGV4dCl9fSx7a2V5OiJfcGFyc2UiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlP3QucGFyc2UoZSx0aGlzKTplfX1dKSxhfSh2KTtILmNmZz1PYmplY3QuYXNzaWduKG5ldyB2LHtmb3JtYXQ6Vn0pO3ZhciBQPXtleGVjdXRlOmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBpPW47aXx8KGk9ZC5yYW5kb20oOCkpO3ZhciBhPUUuY3JlYXRlKHtrZXlTaXplOnQrcn0pLmNvbXB1dGUoZSxpKSxvPWQuY3JlYXRlKGEud29yZHMuc2xpY2UodCksNCpyKTtyZXR1cm4gYS5zaWdCeXRlcz00KnQsai5jcmVhdGUoe2tleTphLGl2Om8sc2FsdDppfSl9fSxGPWZ1bmN0aW9uKHQpe2koYSx0KTt2YXIgbj1mKGEpO2Z1bmN0aW9uIGEoKXtyZXR1cm4gZSh0aGlzLGEpLG4uYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiByKGEsbnVsbCxbe2tleToiZW5jcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGk9T2JqZWN0LmFzc2lnbihuZXcgdix0aGlzLmNmZyxuKSxhPWkua2RmLmV4ZWN1dGUocixlLmtleVNpemUsZS5pdlNpemUpO2kuaXY9YS5pdjt2YXIgbz1ILmVuY3J5cHQuY2FsbCh0aGlzLGUsdCxhLmtleSxpKTtyZXR1cm4gby5taXhJbihhKSxvfX0se2tleToiZGVjcnlwdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGk9dCxhPU9iamVjdC5hc3NpZ24obmV3IHYsdGhpcy5jZmcsbik7aT10aGlzLl9wYXJzZShpLGEuZm9ybWF0KTt2YXIgbz1hLmtkZi5leGVjdXRlKHIsZS5rZXlTaXplLGUuaXZTaXplLGkuc2FsdCk7cmV0dXJuIGEuaXY9by5pdixILmRlY3J5cHQuY2FsbCh0aGlzLGUsaSxvLmtleSxhKX19XSksYX0oSCk7Ri5jZmc9T2JqZWN0LmFzc2lnbihILmNmZyx7a2RmOlB9KTtmb3IodmFyIE49W10sVz1bXSxLPVtdLHE9W10sWD1bXSxaPVtdLEo9W10sJD1bXSxHPVtdLFE9W10sWT1bXSxlZT0wO2VlPDI1NjtlZSs9MSlZW2VlXT1lZTwxMjg/ZWU8PDE6ZWU8PDFeMjgzO2Zvcih2YXIgdGU9MCxyZT0wLG5lPTA7bmU8MjU2O25lKz0xKXt2YXIgaWU9cmVecmU8PDFecmU8PDJecmU8PDNecmU8PDQ7aWU9aWU+Pj44XjI1NSZpZV45OSxOW3RlXT1pZSxXW2llXT10ZTt2YXIgYWU9WVt0ZV0sb2U9WVthZV0sdWU9WVtvZV0sc2U9MjU3KllbaWVdXjE2ODQzMDA4KmllO0tbdGVdPXNlPDwyNHxzZT4+PjgscVt0ZV09c2U8PDE2fHNlPj4+MTYsWFt0ZV09c2U8PDh8c2U+Pj4yNCxaW3RlXT1zZSxzZT0xNjg0MzAwOSp1ZV42NTUzNypvZV4yNTcqYWVeMTY4NDMwMDgqdGUsSltpZV09c2U8PDI0fHNlPj4+OCwkW2llXT1zZTw8MTZ8c2U+Pj4xNixHW2llXT1zZTw8OHxzZT4+PjI0LFFbaWVdPXNlLHRlPyh0ZT1hZV5ZW1lbWVt1ZV5hZV1dXSxyZV49WVtZW3JlXV0pOnRlPXJlPTF9dmFyIGNlPVswLDEsMiw0LDgsMTYsMzIsNjQsMTI4LDI3LDU0XSxmZT1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIGUodGhpcyxhKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihhLFt7a2V5OiJfZG9SZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZTtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7dGhpcy5fa2V5UHJpb3JSZXNldD10aGlzLl9rZXk7dmFyIHQ9dGhpcy5fa2V5UHJpb3JSZXNldCxyPXQud29yZHMsbj10LnNpZ0J5dGVzLzQ7dGhpcy5fblJvdW5kcz1uKzY7dmFyIGk9NCoodGhpcy5fblJvdW5kcysxKTt0aGlzLl9rZXlTY2hlZHVsZT1bXTtmb3IodmFyIGE9dGhpcy5fa2V5U2NoZWR1bGUsbz0wO288aTtvKz0xKW88bj9hW29dPXJbb106KGU9YVtvLTFdLG8lbj9uPjYmJm8lbj09NCYmKGU9TltlPj4+MjRdPDwyNHxOW2U+Pj4xNiYyNTVdPDwxNnxOW2U+Pj44JjI1NV08PDh8TlsyNTUmZV0pOihlPU5bKGU9ZTw8OHxlPj4+MjQpPj4+MjRdPDwyNHxOW2U+Pj4xNiYyNTVdPDwxNnxOW2U+Pj44JjI1NV08PDh8TlsyNTUmZV0sZV49Y2Vbby9ufDBdPDwyNCksYVtvXT1hW28tbl1eZSk7dGhpcy5faW52S2V5U2NoZWR1bGU9W107Zm9yKHZhciB1PXRoaXMuX2ludktleVNjaGVkdWxlLHM9MDtzPGk7cys9MSl7dmFyIGM9aS1zO2U9cyU0P2FbY106YVtjLTRdLHVbc109czw0fHxjPD00P2U6SltOW2U+Pj4yNF1dXiRbTltlPj4+MTYmMjU1XV1eR1tOW2U+Pj44JjI1NV1dXlFbTlsyNTUmZV1dfX19fSx7a2V5OiJlbmNyeXB0QmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dGhpcy5fZG9DcnlwdEJsb2NrKGUsdCx0aGlzLl9rZXlTY2hlZHVsZSxLLHEsWCxaLE4pfX0se2tleToiZGVjcnlwdEJsb2NrIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPWUsbj1yW3QrMV07clt0KzFdPXJbdCszXSxyW3QrM109bix0aGlzLl9kb0NyeXB0QmxvY2socix0LHRoaXMuX2ludktleVNjaGVkdWxlLEosJCxHLFEsVyksbj1yW3QrMV0sclt0KzFdPXJbdCszXSxyW3QrM109bn19LHtrZXk6Il9kb0NyeXB0QmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLG4saSxhLG8sdSl7Zm9yKHZhciBzPWUsYz10aGlzLl9uUm91bmRzLGY9c1t0XV5yWzBdLGw9c1t0KzFdXnJbMV0seT1zW3QrMl1eclsyXSxoPXNbdCszXV5yWzNdLHA9NCx2PTE7djxjO3YrPTEpe3ZhciBkPW5bZj4+PjI0XV5pW2w+Pj4xNiYyNTVdXmFbeT4+PjgmMjU1XV5vWzI1NSZoXV5yW3BdO3ArPTE7dmFyIHc9bltsPj4+MjRdXmlbeT4+PjE2JjI1NV1eYVtoPj4+OCYyNTVdXm9bMjU1JmZdXnJbcF07cCs9MTt2YXIgZz1uW3k+Pj4yNF1eaVtoPj4+MTYmMjU1XV5hW2Y+Pj44JjI1NV1eb1syNTUmbF1ecltwXTtwKz0xO3ZhciBtPW5baD4+PjI0XV5pW2Y+Pj4xNiYyNTVdXmFbbD4+PjgmMjU1XV5vWzI1NSZ5XV5yW3BdO3ArPTEsZj1kLGw9dyx5PWcsaD1tfXZhciBiPSh1W2Y+Pj4yNF08PDI0fHVbbD4+PjE2JjI1NV08PDE2fHVbeT4+PjgmMjU1XTw8OHx1WzI1NSZoXSlecltwXTtwKz0xO3ZhciBrPSh1W2w+Pj4yNF08PDI0fHVbeT4+PjE2JjI1NV08PDE2fHVbaD4+PjgmMjU1XTw8OHx1WzI1NSZmXSlecltwXTtwKz0xO3ZhciBfPSh1W3k+Pj4yNF08PDI0fHVbaD4+PjE2JjI1NV08PDE2fHVbZj4+PjgmMjU1XTw8OHx1WzI1NSZsXSlecltwXTtwKz0xO3ZhciB4PSh1W2g+Pj4yNF08PDI0fHVbZj4+PjE2JjI1NV08PDE2fHVbbD4+PjgmMjU1XTw8OHx1WzI1NSZ5XSlecltwXTtwKz0xLHNbdF09YixzW3QrMV09ayxzW3QrMl09XyxzW3QrM109eH19XSksYX0oVCk7ZmUua2V5U2l6ZT04O3ZhciBsZT1ULl9jcmVhdGVIZWxwZXIoZmUpLHllPWZ1bmN0aW9uKGUpe3ZhciB0PXcucGFyc2UoZSk7cmV0dXJuIGouY3JlYXRlKHtjaXBoZXJ0ZXh0OnR9KX0saGU9ZnVuY3Rpb24odCl7aShhLHQpO3ZhciBuPWYoYSk7ZnVuY3Rpb24gYSgpe3JldHVybiBlKHRoaXMsYSksbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIHIoYSl9KEkpO2hlLkVuY3J5cHRvcj1mdW5jdGlvbih0KXtpKGEsdCk7dmFyIG49ZihhKTtmdW5jdGlvbiBhKCl7cmV0dXJuIGUodGhpcyxhKSxuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gcihhLFt7a2V5OiJwcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9ZSxuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplLGE9dGhpcy5faXYsbz10aGlzLl9jb3VudGVyO2EmJih0aGlzLl9jb3VudGVyPWEuc2xpY2UoMCksbz10aGlzLl9jb3VudGVyLHRoaXMuX2l2PXZvaWQgMCk7dmFyIHU9by5zbGljZSgwKTtuLmVuY3J5cHRCbG9jayh1LDApLG9baS0xXT1vW2ktMV0rMXwwO2Zvcih2YXIgcz0wO3M8aTtzKz0xKXJbdCtzXV49dVtzXX19XSksYX0oaGUpLGhlLkRlY3J5cHRvcj1oZS5FbmNyeXB0b3I7dmFyIHBlPXtwYWQ6ZnVuY3Rpb24oKXt9LHVucGFkOmZ1bmN0aW9uKCl7fX0sdmU9e0FycmF5QnVmZmVyVG9TdHJpbmc6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PSIiLHI9bmV3IFVpbnQ4QXJyYXkoZSksbj0wO248ci5sZW5ndGg7bisrKXQrPVN0cmluZy5mcm9tQ2hhckNvZGUocltuXSk7cmV0dXJuIHR9LFN0cmluZ1RvQXJyYXlCdWZmZXI6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW5ldyBBcnJheUJ1ZmZlcihlLmxlbmd0aCkscj1uZXcgVWludDhBcnJheSh0KSxuPTA7bjxlLmxlbmd0aDtuKyspcltuXT1lLmNoYXJDb2RlQXQobik7cmV0dXJuIHR9LEJhc2U2NFRvSGV4OmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdJiZhcmd1bWVudHNbMV0scj13aW5kb3cuYXRvYihlLnJlcGxhY2UoLy0vZywiKyIpLnJlcGxhY2UoL18vZywiLyIpKTtpZih0KXtmb3IodmFyIG49W10saT0wO2k8ci5sZW5ndGg7aSsrKW4ucHVzaChyLmNoYXJDb2RlQXQoaSkpO3JldHVybiBuZXcgVWludDhBcnJheShuKS5idWZmZXJ9Zm9yKHZhciBhPSIiLG89MDtvPHIubGVuZ3RoO28rKylhKz0oIjAiK3IuY2hhckNvZGVBdChvKS50b1N0cmluZygxNikpLnN1YnN0cigtMik7cmV0dXJuIGF9LEhleFRvQmFzZTY0OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixyPTA7cjxlLmxlbmd0aDtyKz0yKXQrPVN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQoZS5zdWJzdHIociwyKSwxNikpO3JldHVybiB3aW5kb3cuYnRvYSh0KS5yZXBsYWNlKC89L2csIiIpLnJlcGxhY2UoL1wrL2csIi0iKS5yZXBsYWNlKC9cLy9nLCJfIil9LGZpbmRCb3g6ZnVuY3Rpb24oZSx0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06W107aWYoZS50eXBlIT09dCl7aWYoZSYmZS5zdWJCb3gpe3ZhciBuPWUuc3ViQm94LmZpbHRlcigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudHlwZT09PXR9KSk7bi5sZW5ndGg/bi5mb3JFYWNoKChmdW5jdGlvbihlKXtyZXR1cm4gci5wdXNoKGUpfSkpOmUuc3ViQm94LmZvckVhY2goKGZ1bmN0aW9uKGUpe3JldHVybiB2ZS5maW5kQm94KGUsdCxyKX0pKX19ZWxzZSByLnB1c2goZSk7cmV0dXJuKHI9W10uY29uY2F0KHIpKS5sZW5ndGg+MT9yOnJbMF19LHBhZFN0YXJ0OmZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG49U3RyaW5nKHIpLGk9dD4+MCxhPU1hdGguY2VpbChpL24ubGVuZ3RoKSxvPVtdLHU9U3RyaW5nKGUpO2EtLTspby5wdXNoKG4pO3JldHVybiBvLmpvaW4oIiIpLnN1YnN0cmluZygwLGktdS5sZW5ndGgpK3V9LGR1cmF0aW9uQ29udmVydDpmdW5jdGlvbihlKXt2YXIgdD0wLHI9MCxuPTA7cmV0dXJuKGU9ZS5zbGljZShlLmluZGV4T2YoIlBUIikrMikpLmluZGV4T2YoIkgiKT4tMSYmZS5pbmRleE9mKCJNIik+LTEmJmUuaW5kZXhPZigiUyIpPi0xPyh0PXBhcnNlRmxvYXQoZS5zbGljZSgwLGUuaW5kZXhPZigiSCIpKSkscj1wYXJzZUZsb2F0KGUuc2xpY2UoZS5pbmRleE9mKCJIIikrMSxlLmluZGV4T2YoIk0iKSkpLG49cGFyc2VGbG9hdChlLnNsaWNlKGUuaW5kZXhPZigiTSIpKzEsZS5pbmRleE9mKCJTIikpKSk6ZS5pbmRleE9mKCJIIik+LTEmJmUuaW5kZXhPZigiTSIpPi0xJiZlLmluZGV4T2YoIlMiKTwwPyh0PXBhcnNlRmxvYXQoZS5zbGljZSgwLGUuaW5kZXhPZigiSCIpKSkscj1wYXJzZUZsb2F0KGUuc2xpY2UoZS5pbmRleE9mKCJIIikrMSxlLmluZGV4T2YoIk0iKSkpKTplLmluZGV4T2YoIkgiKTwwJiZlLmluZGV4T2YoIk0iKT4tMSYmZS5pbmRleE9mKCJTIik+LTE/KHI9cGFyc2VGbG9hdChlLnNsaWNlKDAsZS5pbmRleE9mKCJNIikpKSxuPXBhcnNlRmxvYXQoZS5zbGljZShlLmluZGV4T2YoIk0iKSsxLGUuaW5kZXhPZigiUyIpKSkpOmUuaW5kZXhPZigiSCIpPi0xJiZlLmluZGV4T2YoIk0iKTwwJiZlLmluZGV4T2YoIlMiKT4tMT8odD1wYXJzZUZsb2F0KGUuc2xpY2UoMCxlLmluZGV4T2YoIkgiKSkpLG49cGFyc2VGbG9hdChlLnNsaWNlKGUuaW5kZXhPZigiSCIpKzEsZS5pbmRleE9mKCJTIikpKSk6ZS5pbmRleE9mKCJIIik8MCYmZS5pbmRleE9mKCJNIik8MCYmZS5pbmRleE9mKCJTIik+LTE/bj1wYXJzZUZsb2F0KGUuc2xpY2UoMCxlLmluZGV4T2YoIlMiKSkpOmUuaW5kZXhPZigiSCIpPDAmJmUuaW5kZXhPZigiTSIpPi0xJiZlLmluZGV4T2YoIlMiKTwwJiYocj1wYXJzZUZsb2F0KGUuc2xpY2UoMCxlLmluZGV4T2YoIk0iKSkpKSwzNjAwKnQrNjAqcitufSxwcmVGaXhJbnRlcmdlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuKEFycmF5KHQpLmpvaW4oMCkrZSkuc2xpY2UoLXQpfSx0b0hleDpmdW5jdGlvbigpe2Zvcih2YXIgZT1bXSx0PWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkodCksbj0wO248dDtuKyspcltuXT1hcmd1bWVudHNbbl07cmV0dXJuIHIuZm9yRWFjaCgoZnVuY3Rpb24odCl7ZS5wdXNoKHZlLnBhZFN0YXJ0KE51bWJlcih0KS50b1N0cmluZygxNiksMiwwKSl9KSksZX0sc3VtOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPTAsdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQpLG49MDtuPHQ7bisrKXJbbl09YXJndW1lbnRzW25dO3JldHVybiByLmZvckVhY2goKGZ1bmN0aW9uKHQpe2UrPXR9KSksZX0sdG9VVEY4OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1lbmNvZGVVUklDb21wb25lbnQoZSkscj11bmVzY2FwZSh0KSxuPW5ldyBVaW50OEFycmF5KHIubGVuZ3RoKSxpPTA7aTxyLmxlbmd0aDsrK2kpbltpXT1yLmNoYXJDb2RlQXQoaSk7cmV0dXJuIG4uYnVmZmVyfSxmcm9tSGV4OmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1uZXcgVWludDhBcnJheShlLmxlbmd0aC8yKSxyPTA7cjxlLmxlbmd0aDtyKz0yKXRbci8yXT1wYXJzZUludChlLnN1YnN0cihyLDIpLDE2KTtyZXR1cm4gdH0sZnJvbUNoYXJDb2RlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0iIixyPTA7cjxlLmxlbmd0aDtyKz0xNmUzKXt2YXIgbj1lLnN1YmFycmF5KHIscisxNmUzKTt0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbil9cmV0dXJuIHR9LHRvQmFzZTY0OmZ1bmN0aW9uKGUsdCl7dmFyIHI9dmUuZnJvbUNoYXJDb2RlKGUpO3Q9dm9pZCAwPT09dHx8dDt2YXIgbj13aW5kb3cuYnRvYShyKS5yZXBsYWNlKC9cKy9nLCItIikucmVwbGFjZSgvXC8vZywiXyIpO3JldHVybiB0P246bi5yZXBsYWNlKC89KiQvLCIiKX0sc3RyMmhleDpmdW5jdGlvbihlKXtpZigiIj09PWUpcmV0dXJuIiI7Zm9yKHZhciB0PVtdLHI9MDtyPGUubGVuZ3RoO3IrKyl0LnB1c2goZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdH0sYnVmZmVyVG9TdHJpbmc6ZnVuY3Rpb24oZSl7cmV0dXJuKCIwIitOdW1iZXIoZSkudG9TdHJpbmcoMTYpKS5zbGljZSgtMikudG9VcHBlckNhc2UoKX0sc3RyaW5nVG9CdWZmZXI6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVtdLHI9MDtyPGUubGVuZ3RoO3IrPTIpdC5wdXNoKHBhcnNlSW50KGVbcl0rZVtyKzFdLDE2KSk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHQpfX07dmUudG9IZXg9ZnVuY3Rpb24oKXtmb3IodmFyIGU9W10sdD1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KHQpLG49MDtuPHQ7bisrKXJbbl09YXJndW1lbnRzW25dO3JldHVybiByLmZvckVhY2goKGZ1bmN0aW9uKHQpe2UucHVzaCh2ZS5wYWRTdGFydChOdW1iZXIodCkudG9TdHJpbmcoMTYpLDIsMCkpfSkpLGV9LHZlLmZvcm1hdElWPWZ1bmN0aW9uKGUpe3ZhciB0PSIiO3JldHVybiBlLmZvckVhY2goKGZ1bmN0aW9uKGUpe3QrPXZlLmJ1ZmZlclRvU3RyaW5nKGUpfSkpLHR9LHZlLnJvdW5kPWZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowO3JldHVybiBOdW1iZXIoZS50b0ZpeGVkKHQpKX0sdmUuaXNTb2dvdT1mdW5jdGlvbigpe3JldHVybiB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoIm1ldGFzciIpPi0xfSx2ZS5pc0VkZ2U9ZnVuY3Rpb24oKXt2YXIgZT13aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO3JldHVybiBlLmluZGV4T2YoImVkZ2UiKT4tMXx8ZS5pbmRleE9mKCJlZGcvIik+LTF9LHZlLm9mZkluRGVzdHJveT1mdW5jdGlvbihlLHQscixuKXtlLm9uY2UobiwoZnVuY3Rpb24gaSgpe2Uub2ZmKHQsciksZS5vZmYobixpKX0pKX0sdmUub249ZnVuY3Rpb24oZSx0LHIsbil7aWYobillLm9uKHQsciksdmUub2ZmSW5EZXN0cm95KGUsdCxyLG4pO2Vsc2V7ZS5vbih0LChmdW5jdGlvbiBuKGkpe3IoaSksZS5vZmYodCxuKX0pKX19LHZlLm9uY2U9ZnVuY3Rpb24oZSx0LHIsbil7aWYobillLm9uY2UodCxyKSx2ZS5vZmZJbkRlc3Ryb3koZSx0LHIsbik7ZWxzZXtlLm9uY2UodCwoZnVuY3Rpb24gbihpKXtyKGkpLGUub2ZmKHQsbil9KSl9fSx2ZS5wcm9taXNlUG9seWZpbGw9ZnVuY3Rpb24oKXtQcm9taXNlLnByb3RvdHlwZS5maW5hbGx5fHwoUHJvbWlzZS5wcm90b3R5cGUuZmluYWxseT17ZmluYWxseTpmdW5jdGlvbihlKXt2YXIgdD1mdW5jdGlvbih0KXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGUoKSkudGhlbih0KX07cmV0dXJuIHRoaXMudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIHQoKGZ1bmN0aW9uKCl7cmV0dXJuIGV9KSl9KSwoZnVuY3Rpb24oZSl7cmV0dXJuIHQoKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KGUpfSkpfSkpfX0uZmluYWxseSl9LHZlLnRyYW5zZm9ybUhlYWRlcnM9ZnVuY3Rpb24oZSx0KXt2YXIgcj1PYmplY3QuYXNzaWduKHt9LGUpO3JldHVybiBPYmplY3Qua2V5cyh0KS5mb3JFYWNoKChmdW5jdGlvbihuKXt2YXIgaT10W25dO2UmJmVbbl0mJihyW2ldPWVbbl0sZGVsZXRlIHJbbl0pfSkpLHJ9LHZlLmdlbmVyYXRlVW5pcXVlS2V5PWZ1bmN0aW9uKGUpe3ZhciB0PWUudmlkLHI9ZS5zdGFydCxuPWUuZW5kLGk9ZS5tZWRpYVR5cGUsYT1lLmRlZmluaXRpb24sbz1lLmNvZGVjVHlwZSx1PWUuZm9ybWF0LHM9ZS5iaXRyYXRlO3JldHVybiByPXJ8fDAsbj1ufHwwLG89b3x8ImgyNjQiLHU9dXx8ImRhc2giLHQmJmk/YT8iIi5jb25jYXQodCwiIyIpLmNvbmNhdChpLCIjIikuY29uY2F0KGEsIiMiKS5jb25jYXQociwiIyIpLmNvbmNhdChuLCIjIikuY29uY2F0KG8sIiMiKS5jb25jYXQodSwiIyIpLmNvbmNhdChzKToiIi5jb25jYXQodCwiIyIpLmNvbmNhdChpLCIjIikuY29uY2F0KHIsIiMiKS5jb25jYXQobiwiIyIpLmNvbmNhdChvLCIjIikuY29uY2F0KHUsIiMiKS5jb25jYXQocyk6bnVsbH0sdmUuZ2V0RGVmaW5pdGlvbj1mdW5jdGlvbihlKXtpZighZSlyZXR1cm4gbnVsbDt2YXIgdD1lLnNwbGl0KCIjIik7cmV0dXJuIHQubGVuZ3RoPjI/dFsyXTpudWxsfSx2ZS5leGNoYW5nZUxpc3RVcmw9ZnVuY3Rpb24oZSl7aWYoZSYmMCE9PWUubGVuZ3RoKWZvcih2YXIgdD0wO3Q8ZS5sZW5ndGg7dCsrKXZlLmV4Y2hhbmdlVXJsKGVbdF0pfSx2ZS5leGNoYW5nZVVybD1mdW5jdGlvbihlKXtpZihlJiZlLm1haW5fdXJsJiZlLmJhY2t1cF91cmxfMSl7dmFyIHQ9ZS5tYWluX3VybCxyPWUuYmFja3VwX3VybF8xLG49dC5zcGxpdCgiPyIpOzI9PT1uLmxlbmd0aCYmLTE9PT1yLmluZGV4T2YoIj8iKT8oZS5tYWluX3VybD1yKyI/IituWzFdLGUuYmFja3VwX3VybF8xPW5bMF0pOihlLm1haW5fdXJsPXIsZS5iYWNrdXBfdXJsXzE9dCl9fSx2ZS52YWxpZGF0ZUZyYWdtZW50PWZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpbXTtpZihlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe3RyeXt2YXIgcj1uZXcgVWludDhBcnJheShlLDQsNCksbj1TdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwscik7aWYoMj09PXQubGVuZ3RoKXt2YXIgaT10WzFdLXRbMF0rMTtpZighKGUuYnl0ZUxlbmd0aD09PWkpKXJldHVybn1pZigibW9vZiIhPT1uJiYic3R5cCIhPT1uJiYiZnR5cCIhPT1uKXJldHVybiExfWNhdGNoKGEpe3JldHVybiExfXJldHVybiEwfXJldHVybiExfSx2ZS52YWxpZGF0ZVVybFJhbmdlPWZ1bmN0aW9uKGUsdCl7dmFyIHI9ZXx8W107aWYoci5sZW5ndGg+MClmb3IodmFyIG49MDtuPHIubGVuZ3RoO24rKyl7dmFyIGk9cltuXTtpZigvKFswLTkuXC1BLVphLXpdKykvLnRlc3QoaSkmJnQuaW5kZXhPZihpKT4tMSlyZXR1cm4hMH1yZXR1cm4hMX0sdmUuaXNCYXNlNjQ9ZnVuY3Rpb24oZSl7cmV0dXJuL14oW0EtWmEtejAtOSsvXXs0fSkqKFtBLVphLXowLTkrL117NH18W0EtWmEtejAtOSsvXXszfT18W0EtWmEtejAtOSsvXXsyfT09KSQvLnRlc3QoZSl9O3ZhciBkZSx3ZSxnZSxtZSxiZT0oZGU9InZvZFRpbWVzdGFtcFNhbHQiLHdlPWZ1bmN0aW9uKGUpe3JldHVybiBlLnNwbGl0KCIiKS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiBlLmNoYXJDb2RlQXQoMCl9KSl9LGdlPWZ1bmN0aW9uKGUpe3JldHVybigiMCIrTnVtYmVyKGUpLnRvU3RyaW5nKDE2KSkuc3Vic3RyKC0yKX0sbWU9ZnVuY3Rpb24oZSl7cmV0dXJuIHdlKGRlKS5yZWR1Y2UoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGVedH0pLGUpfSxmdW5jdGlvbihlKXtyZXR1cm4gZS5zcGxpdCgiIikubWFwKHdlKS5tYXAobWUpLm1hcChnZSkuam9pbigiIil9KSxrZT1mdW5jdGlvbihlKXt2YXIgdD1mdW5jdGlvbih0KXtyZXR1cm4ocj1lLHIuc3BsaXQoIiIpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUuY2hhckNvZGVBdCgwKX0pKSkucmVkdWNlKChmdW5jdGlvbihlLHQpe3JldHVybiBlXnR9KSx0KTt2YXIgcn07cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiBlLm1hdGNoKC8uezEsMn0vZykubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gcGFyc2VJbnQoZSwxNil9KSkubWFwKHQpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZSl9KSkuam9pbigiIil9fSgidm9kVGltZXN0YW1wU2FsdCIpO3ZlLmdldFVuaW9uSW5mbz1mdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXToiIjtyZXR1cm4iIi5jb25jYXQoZSkuY29uY2F0KGJlKChuZXcgRGF0ZSkuZ2V0VGltZSgpLnRvU3RyaW5nKCkpKX0sdmUuY2hlY2tVbmlvbkluZm9FeHBpcmVkPWZ1bmN0aW9uKCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiIiLHQ9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOiIiLHI9YXJndW1lbnRzLmxlbmd0aD4yJiZ2b2lkIDAhPT1hcmd1bWVudHNbMl0/YXJndW1lbnRzWzJdOjMwO2lmKDA9PT10LmluZGV4T2YoZSkpe3ZhciBuPXBhcnNlSW50KGtlKHQuc2xpY2UoZS5sZW5ndGgpKSksaT0obmV3IERhdGUpLmdldFRpbWUoKS1uO2lmKGk+MCYmaTw9MWUzKnIpcmV0dXJuITB9cmV0dXJuITF9LHZlLmdldENvb2tpZVZhbHVlPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXToiIix0PWRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpLHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIG49dFtyXS50cmltKCkuc3BsaXQoIj0iKTtpZihuWzBdPT09ZSlyZXR1cm4gblsxXX1yZXR1cm4gbnVsbH0sdmUubm93VGltZT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gcGFyc2VJbnQocGVyZm9ybWFuY2Uubm93KCksMTApfWNhdGNoKGUpe3JldHVybihuZXcgRGF0ZSkuZ2V0VGltZSgpfX0sdmUuZ2V0Qml0cmF0ZUl0ZW09ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MyYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTpudWxsLGk9dCxhPXZlLmdldFNlbGVjdG9yTGlzdChlLHIpLG89aS5nZXRTdWl0YWJsZUJpdHJhdGU/aS5nZXRTdWl0YWJsZUJpdHJhdGUoYSxuKTppLmJpdFJhdGVBZGFwdGVyLnNlbGVjdChhKTtyZXR1cm4gb30sdmUuZ2V0U2VsZWN0b3JMaXN0PWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPWUuZHluYW1pY192aWRlb19saXN0LG49W10saT0wO2k8ci5sZW5ndGg7aSsrKXt2YXIgYT1yW2ldO24ucHVzaCh7Yml0cmF0ZTphLmJpdHJhdGUsZGVmaW5pdGlvbjphLmRlZmluaXRpb24sZHVyYXRpb246dH0pfXJldHVybiBufTt2YXIgX2UseGU9e307T2JqZWN0LmRlZmluZVByb3BlcnR5KHhlLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KSx4ZS5kZWZhdWx0PWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLHI9YXJndW1lbnRzLmxlbmd0aCxuPUFycmF5KHI+MT9yLTE6MCksaT0xO2k8cjtpKyspbltpLTFdPWFyZ3VtZW50c1tpXTt2YXIgYT0hMCxvPSExLHU9dm9pZCAwO3RyeXtmb3IodmFyIHMsYz1uW1N5bWJvbC5pdGVyYXRvcl0oKTshKGE9KHM9Yy5uZXh0KCkpLmRvbmUpO2E9ITApe3ZhciBmPXMudmFsdWU7dCs9Zi5sZW5ndGh9fWNhdGNoKG0pe289ITAsdT1tfWZpbmFsbHl7dHJ5eyFhJiZjLnJldHVybiYmYy5yZXR1cm4oKX1maW5hbGx5e2lmKG8pdGhyb3cgdX19dmFyIGw9bmV3IGUodCkseT0wLGg9ITAscD0hMSx2PXZvaWQgMDt0cnl7Zm9yKHZhciBkLHc9bltTeW1ib2wuaXRlcmF0b3JdKCk7IShoPShkPXcubmV4dCgpKS5kb25lKTtoPSEwKXt2YXIgZz1kLnZhbHVlO2wuc2V0KGcseSkseSs9Zy5sZW5ndGh9fWNhdGNoKG0pe3A9ITAsdj1tfWZpbmFsbHl7dHJ5eyFoJiZ3LnJldHVybiYmdy5yZXR1cm4oKX1maW5hbGx5e2lmKHApdGhyb3cgdn19cmV0dXJuIGx9O3ZhciBBZT0oKF9lPXhlKSYmX2UuX19lc01vZHVsZT9fZTp7ZGVmYXVsdDpfZX0pLmRlZmF1bHQsemU9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7ZSh0aGlzLHQpLHRoaXMuYnVmZmVyPW5ldyBVaW50OEFycmF5KDApfXJldHVybiByKHQsW3trZXk6IndyaXRlIix2YWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLHQ9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheSh0KSxuPTA7bjx0O24rKylyW25dPWFyZ3VtZW50c1tuXTtyLmZvckVhY2goKGZ1bmN0aW9uKHQpe3Q/ZS5idWZmZXI9QWUoVWludDhBcnJheSxlLmJ1ZmZlcix0KTpjb25zb2xlLmVycm9yKHQpfSkpfX1dLFt7a2V5OiJ3cml0ZVVpbnQxNiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlPj44JjI1NSwyNTUmZV0pfX0se2tleToid3JpdGVVaW50MzIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBuZXcgVWludDhBcnJheShbZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSl9fV0pLHR9KCksU2U9TWF0aC5wb3coMiwzMiktMTtmdW5jdGlvbiBVZShlKXtpZighQXJyYXkuaXNBcnJheShlKSl7Zm9yKHZhciB0PVtdLHI9IiIsbj0wO248ZS5sZW5ndGg7bisrKW4lMiYmKHI9ZVtuLTFdK2Vbbl0sdC5wdXNoKHBhcnNlSW50KHIsMTYpKSxyPSIiKTtyZXR1cm4gdH1yZXR1cm4gZS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiBwYXJzZUludChlLDE2KX0pKX12YXIgQ2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7ZSh0aGlzLHQpfXJldHVybiByKHQsbnVsbCxbe2tleToidHlwZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFtlLmNoYXJDb2RlQXQoMCksZS5jaGFyQ29kZUF0KDEpLGUuY2hhckNvZGVBdCgyKSxlLmNoYXJDb2RlQXQoMyldKX19LHtrZXk6InNpemUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB6ZS53cml0ZVVpbnQzMihlKX19LHtrZXk6ImV4dGVuc2lvbiIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoW2UsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0XSl9fSx7a2V5OiJhdWRpb1RyYWsiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPTgsaT10LnRraGQoe2lkOmUudHJhY2tJRHx8MixkdXJhdGlvbjplLmF1ZGlvRHVyYXRpb24sdGltZXNjYWxlOmUuYXVkaW9UaW1lU2NhbGUsd2lkdGg6MCxoZWlnaHQ6MCx0eXBlOiJhdWRpbyJ9KSxhPWUuY2hhbm5lbENvdW50LG89ZS5zYW1wbGVSYXRlO2UuZW5jYSYmKGE9ZS5lbmNhLmNoYW5uZWxDb3VudCxvPWUuZW5jYS5zYW1wbGVSYXRlKTt2YXIgdT10Lm1kaWEoe3R5cGU6ImF1ZGlvIix0aW1lc2NhbGU6ZS5hdWRpb1RpbWVTY2FsZSxkdXJhdGlvbjplLmF1ZGlvRHVyYXRpb24sY2hhbm5lbENvdW50OmEsc2FtcGxlUmF0ZTpvLGF1ZGlvQ29uZmlnOmUuYXVkaW9Db25maWcsZW5jYTplLmVuY2F9KTtyZXR1cm5baSx1XS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJ0cmFrIiksaSx1KSxyLmJ1ZmZlcn19LHtrZXk6InZpZGVvVHJhayIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQudGtoZCh7aWQ6ZS50cmFja0lEfHwxLGR1cmF0aW9uOmUudmlkZW9EdXJhdGlvbix0aW1lc2NhbGU6ZS52aWRlb1RpbWVTY2FsZSx3aWR0aDplLndpZHRoLGhlaWdodDplLmhlaWdodCx0eXBlOiJ2aWRlbyJ9KSxhPXQubWRpYSh7dHlwZToidmlkZW8iLHRpbWVzY2FsZTplLnZpZGVvVGltZVNjYWxlLGR1cmF0aW9uOmUudmlkZW9EdXJhdGlvbixWaWRlb1Zpc3VhbFNhbXBsZUVudHJ5OmUuVmlkZW9WaXN1YWxTYW1wbGVFbnRyeSxWaWRlb0NvZGVjQ29uZmlndXJhdGlvbkJveDplLlZpZGVvQ29kZWNDb25maWd1cmF0aW9uQm94LGVuY3Y6ZS5lbmN2fSk7cmV0dXJuW2ksYV0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhayIpLGksYSksci5idWZmZXJ9fSx7a2V5OiJidHJ0Iix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPW5ldyB6ZSxyPW5ldyBVaW50OEFycmF5KFswLDI4LDE1NiwxMjgsMCw0NSwxOTgsMTkyLDAsNDUsMTk4LDE5Ml0pO3JldHVybiBlLndyaXRlKHQuc2l6ZSg4K3IuYnl0ZUxlbmd0aCksdC50eXBlKCJidHJ0IiksciksZS5idWZmZXJ9fSx7a2V5OiJkaW5mIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPW5ldyB6ZTtyZXR1cm4gZS53cml0ZSh0LnNpemUoMzYpLHQudHlwZSgiZGluZiIpLHQuc2l6ZSgyOCksdC50eXBlKCJkcmVmIiksbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwxMiwxMTcsMTE0LDEwOCwzMiwwLDAsMCwxXSkpLGUuYnVmZmVyfX0se2tleToiZWR0cyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS5kdXJhdGlvbixpPWUubWVkaWFUaW1lO3JldHVybiByLndyaXRlKHQuc2l6ZSgzNiksdC50eXBlKCJlZHRzIikpLHIud3JpdGUodC5zaXplKDI4KSx0LnR5cGUoImVsc3QiKSksci53cml0ZShuZXcgVWludDhBcnJheShbMCwwLDAsMSxuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLGk+PjI0JjI1NSxpPj4xNiYyNTUsaT4+OCYyNTUsMjU1JmksMCwwLDAsMV0pKSxyLmJ1ZmZlcn19LHtrZXk6ImVuY2EiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPWUuZW5jYS5jaGFubmVsQ291bnQsaT1lLmVuY2Euc2FtcGxlUmF0ZSxhPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsbiwwLDE2LDAsMCwwLDAsaT4+OCYyNTUsMjU1JmksMCwwXSksbz10LmVzZHMoZS5hdWRpb0NvbmZpZyksdT10LnNpbmYoZS5lbmNhKTtyZXR1cm4gci53cml0ZSh0LnNpemUoMTYrYS5ieXRlTGVuZ3RoK28uYnl0ZUxlbmd0aCt1LmJ5dGVMZW5ndGgpLHQudHlwZSgiZW5jYSIpLGEsbyx0LnNpemUoOCt1LmJ5dGVMZW5ndGgpLHQudHlwZSgic2luZiIpLHUpLHIuYnVmZmVyfX0se2tleToiZW5jdiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS53aWR0aCxpPWUuaGVpZ2h0LGE9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLG4+PjgmMjU1LDI1NSZuLGk+PjgmMjU1LDI1NSZpLDAsNzIsMCwwLDAsNzIsMCwwLDAsMCwwLDAsMCwxLDE4LDEwMCw5NywxMDUsMTA4LDEyMSwxMDksMTExLDExNiwxMDUsMTExLDExMCw0NywxMDQsMTA4LDExNSw0NiwxMDYsMTE1LDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLG89bmV3IFVpbnQ4QXJyYXkoZS5WaWRlb0NvZGVjQ29uZmlndXJhdGlvbkJveCksdT10LmJ0cnQoKSxzPXQuc2luZihlLmVuY3YpLGM9dC5wYXNwKGUpO3JldHVybiByLndyaXRlKHQuc2l6ZSgxNithLmJ5dGVMZW5ndGgrby5ieXRlTGVuZ3RoK3UuYnl0ZUxlbmd0aCtjLmJ5dGVMZW5ndGgrcy5ieXRlTGVuZ3RoKSx0LnR5cGUoImVuY3YiKSxhLG8sdSx0LnNpemUoOCtzLmJ5dGVMZW5ndGgpLHQudHlwZSgic2luZiIpLHMsYyksci5idWZmZXJ9fSx7a2V5OiJlc2RzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTpbNDMsMTQ2LDgsMF0scj1lLmxlbmd0aCxuPW5ldyB6ZSxpPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDMsMjMrciwwLDEsMCw0LDE1K3IsNjQsMjEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDVdLmNvbmNhdChbcl0pLmNvbmNhdChlKS5jb25jYXQoWzYsMSwyXSkpO3JldHVybiBuLndyaXRlKHQuc2l6ZSg4K2kuYnl0ZUxlbmd0aCksdC50eXBlKCJlc2RzIiksaSksbi5idWZmZXJ9fSx7a2V5OiJmcm1hIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbZS5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDApLGUuZGF0YV9mb3JtYXQuY2hhckNvZGVBdCgxKSxlLmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMiksZS5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDMpXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoImZybWEiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6ImZ0eXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZTtyZXR1cm4gci53cml0ZSh0LnNpemUoZS5zaXplKSx0LnR5cGUoImZ0eXAiKSxuZXcgVWludDhBcnJheShlLmRhdGEpKSxyLmJ1ZmZlcn19LHtrZXk6ImhkbHIiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPVswLDAsMCwwLDAsMCwwLDAsMTE4LDEwNSwxMDAsMTAxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDg2LDEwNSwxMDAsMTAxLDExMSw3Miw5NywxMTAsMTAwLDEwOCwxMDEsMTE0LDBdO3JldHVybiJhdWRpbyI9PT1lJiYobi5zcGxpY2UuYXBwbHkobixbOCw0XS5jb25jYXQoWzExNSwxMTEsMTE3LDExMF0pKSxuLnNwbGljZS5hcHBseShuLFsyNCwxM10uY29uY2F0KFs4MywxMTEsMTE3LDExMCwxMDAsNzIsOTcsMTEwLDEwMCwxMDgsMTAxLDExNCwwXSkpKSxyLndyaXRlKHQuc2l6ZSg4K24ubGVuZ3RoKSx0LnR5cGUoImhkbHIiKSxuZXcgVWludDhBcnJheShuKSksci5idWZmZXJ9fSx7a2V5OiJtZGF0Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj04O3JldHVybiBlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5zaXplfSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgibWRhdCIpKSxlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZShlLmJ1ZmZlcil9KSksci5idWZmZXJ9fSx7a2V5OiJtZGhkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwyMTcsMjAsMzcsOTAsZT4+MjQmMjU1LGU+PjE2JjI1NSxlPj44JjI1NSwyNTUmZSwwLDAsMCwwLDIxLDE5OSwwLDBdKTtyZXR1cm4gci53cml0ZSh0LnNpemUoMTIrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoIm1kaGQiKSx0LmV4dGVuc2lvbigwLDApLG4pLHIuYnVmZmVyfX0se2tleToibWRpYSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQubWRoZChlLnRpbWVzY2FsZSksYT10LmhkbHIoZS50eXBlKSxvPXQubWluZihlKTtyZXR1cm5baSxhLG9dLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoIm1kaWEiKSxpLGEsbyksci5idWZmZXJ9fSx7a2V5OiJtZmhkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1udWxsO3JldHVybiAxPT09ZS5pZD8obj16ZS53cml0ZVVpbnQzMih0LnZpZGVvU2VxdWVuY2UpLHQudmlkZW9TZXF1ZW5jZSs9MSk6KG49emUud3JpdGVVaW50MzIodC5hdWRpb1NlcXVlbmNlKSx0LmF1ZGlvU2VxdWVuY2UrPTEpLHIud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoIm1maGQiKSx0LmV4dGVuc2lvbigwLDApLG4pLHIuYnVmZmVyfX0se2tleToibWluZiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPSJ2aWRlbyI9PT1lLnR5cGU/dC52bWhkKCk6dC5zbWhkKCksYT10LmRpbmYoKSxvPXQuc3RibChlKTtyZXR1cm5baSxhLG9dLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoIm1pbmYiKSxpLGEsbyksci5idWZmZXJ9fSx7a2V5OiJtb29mIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj04LGk9dC5tZmhkKGUpLGE9dC50cmFmKGUpO3JldHVybltpLGFdLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoIm1vb2YiKSxpLGEpLHIuYnVmZmVyfX0se2tleToibW9vdiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQubXZoZChlLmR1cmF0aW9uLGUudGltZVNjYWxlKSxhPXQubXZleChlLmR1cmF0aW9uLGUudGltZVNjYWxlKSxvPW51bGw7aWYobz1lLnZpZGVvQ29kZWM/dC52aWRlb1RyYWsoZSk6dC5hdWRpb1RyYWsoZSksZS5lbmN2KXtlLnBzc2h8fChlLnBzc2g9e2tpZDplLmtpZH0pO3ZhciB1PXQucHNzaChlLnBzc2gpO1tpLGEsbyx1XS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJtb292IiksaSxhLG8sdSl9ZWxzZVtpLGEsb10uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgibW9vdiIpLGksYSxvKTtyZXR1cm4gci5idWZmZXJ9fSx7a2V5OiJtcDRhIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLGUuY2hhbm5lbENvdW50LDAsMTYsMCwwLDAsMCxlLnNhbXBsZVJhdGU+PjgmMjU1LDI1NSZlLnNhbXBsZVJhdGUsMCwwXSksaT10LmVzZHMoZS5hdWRpb0NvbmZpZyk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoK2kuYnl0ZUxlbmd0aCksdC50eXBlKCJtcDRhIiksbixpKSxyLmJ1ZmZlcn19LHtrZXk6Im12ZXgiLHZhbHVlOmZ1bmN0aW9uKGUscil7dmFyIG49bmV3IHplLGk9emUud3JpdGVVaW50MzIoZSpyKTtyZXR1cm4gbi53cml0ZSh0LnNpemUoODgpLHQudHlwZSgibXZleCIpLHQuc2l6ZSgxNiksdC50eXBlKCJtZWhkIiksdC5leHRlbnNpb24oMCwwKSxpLHQudHJleDEoMSksdC50cmV4MigyKSksbi5idWZmZXJ9fSx7a2V5OiJtdmhkIix2YWx1ZTpmdW5jdGlvbihlLHIpe3ZhciBuPW5ldyB6ZTtlKj1yO3ZhciBpPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyLGU+PjI0JjI1NSxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmUsMCwxLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsM10pO3JldHVybiBuLndyaXRlKHQuc2l6ZSg4K2kubGVuZ3RoKSx0LnR5cGUoIm12aGQiKSxuZXcgVWludDhBcnJheShpKSksbi5idWZmZXJ9fSx7a2V5OiJwYXNwIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1lLnBpeGVsUmF0aW9bMF0saT1lLnBpeGVsUmF0aW9bMV0sYT1uZXcgVWludDhBcnJheShbbj4+MjQsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLGk+PjI0LGk+PjE2JjI1NSxpPj44JjI1NSwyNTUmaV0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K2EuYnl0ZUxlbmd0aCksdC50eXBlKCJwYXNwIiksYSksci5idWZmZXJ9fSx7a2V5OiJwc3NoIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMSwwLDAsMF0uY29uY2F0KFsxNiwxMTksMjM5LDIzNiwxOTIsMTc4LDc3LDIsMTcyLDIyNyw2MCwzMCw4MiwyMjYsMjUxLDc1XSxbMCwwLDAsMV0sVWUoZS5raWQpLFswLDAsMCwwXSkpO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K24uYnl0ZUxlbmd0aCksdC50eXBlKCJwc3NoIiksbiksci5idWZmZXJ9fSx7a2V5OiJzYWlvIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj0xMiplLnNhbXBsZXMubGVuZ3RoKzE0MTsyPT09ZS5pZCYmZS5pc0F1ZGlvRW5jcnlwdGlvbiYmKG49MTQ5KTt2YXIgaT1uZXcgVWludDhBcnJheShbMSwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsbj4+MjQmMjU1LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K2kuYnl0ZUxlbmd0aCksdC50eXBlKCJzYWlvIiksaSksci5idWZmZXJ9fSx7a2V5OiJzYWl6Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1lLnNhbXBsZXMubGVuZ3RoLGk9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMTYsbj4+MjQmMjU1LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbl0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K2kuYnl0ZUxlbmd0aCksdC50eXBlKCJzYWl6IiksaSksci5idWZmZXJ9fSx7a2V5OiJzYmdwIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMTE0LDExMSwxMDgsMTA4LDAsMCwwLDEsMCwwLDEsMjUsMCwwLDAsMV0pO3JldHVybiByLndyaXRlKHQuc2l6ZSgxMituLmJ5dGVMZW5ndGgpLHQudHlwZSgic2JncCIpLHQuZXh0ZW5zaW9uKDAsMCksbiksci5idWZmZXJ9fSx7a2V5OiJzY2hpIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbXSksaT10LnRlbmMoZSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoK2kuYnl0ZUxlbmd0aCksdC50eXBlKCJzY2hpIiksbixpKSxyLmJ1ZmZlcn19LHtrZXk6InNjaG0iLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDk5LDEwMSwxMTAsOTksMCwxLDAsMF0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K24uYnl0ZUxlbmd0aCksdC50eXBlKCJzY2htIiksbiksci5idWZmZXJ9fSx7a2V5OiJzZHRwIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemU7cmV0dXJuIHIud3JpdGUodC5zaXplKDEyK2Uuc2FtcGxlcy5sZW5ndGgpLHQudHlwZSgic2R0cCIpLHQuZXh0ZW5zaW9uKDAsMCkpLGUuc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbih0KXtyLndyaXRlKG5ldyBVaW50OEFycmF5KDE9PT1lLmlkP1t0LmtleT8zMjoxNl06WzE2XSkpfSkpLHIuYnVmZmVyfX0se2tleToic2VuYyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS5zYW1wbGVzLmxlbmd0aCxpPWUuc2FtcGxlT2Zmc2V0LGE9bitpLG89MT09PWUuaWQ/MTY6OCx1PTE9PT1lLmlkPzI6MCxzPVtdLGM9MDtyZXR1cm4gMT09PWUuaWQ/KHM9ZS52aWRlb1NlbmMuc2xpY2UoaSxhKSxjPWUudmlkZW9TZW5jTGVuZ3RoKTpzPWUuYXVkaW9TZW5jLnNsaWNlKGksYSksYz1jfHxvKm4sci53cml0ZSh0LnNpemUoMTYrYyksdC50eXBlKCJzZW5jIiksdC5leHRlbnNpb24oMCx1KSksci53cml0ZSh6ZS53cml0ZVVpbnQzMihuKSkscy5mb3JFYWNoKChmdW5jdGlvbihlKXtyLndyaXRlKHplLndyaXRlVWludDMyKGUuSW5pdGlhbGl6YXRpb25WZWN0b3JbMF0pKSxyLndyaXRlKHplLndyaXRlVWludDMyKGUuSW5pdGlhbGl6YXRpb25WZWN0b3JbMV0pKSxlLnN1YnNhbXBsZXMmJmUuc3Vic2FtcGxlcy5sZW5ndGgmJihyLndyaXRlKHplLndyaXRlVWludDE2KGUuc3Vic2FtcGxlcy5sZW5ndGgpKSxlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ci53cml0ZSh6ZS53cml0ZVVpbnQxNihlLkJ5dGVzT2ZDbGVhckRhdGEpKSxyLndyaXRlKHplLndyaXRlVWludDMyKGUuQnl0ZXNPZlByb3RlY3RlZERhdGEpKX0pKSl9KSksci5idWZmZXJ9fSx7a2V5OiJzaWR4Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj0xPT09ZS5pZD9lLnZpZGVvVGltZVNjYWxlOmUuYXVkaW9UaW1lU2NhbGUsaT1lLnNhbXBsZXNbMF0uZHVyYXRpb24sYT1pKmUuc2FtcGxlcy5sZW5ndGgsbz1lLnNhbXBsZU9mZnNldCppLHU9ODtlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dSs9ZS5zaXplfSkpO3ZhciBzPTA7aWYoMT09PWUuaWQpe3ZhciBjPTAsZj1lLnNhbXBsZXMubGVuZ3RoLGw9ZS5zYW1wbGVPZmZzZXQseT1mK2wsaD1lLnZpZGVvU2VuYy5zbGljZShsLHkpOzE9PT1lLmlkJiZoLmZvckVhY2goKGZ1bmN0aW9uKGUpe2MrPTgsZS5zdWJzYW1wbGVzJiZlLnN1YnNhbXBsZXMubGVuZ3RoJiYoYys9MixjKz02KmUuc3Vic2FtcGxlcy5sZW5ndGgpfSkpLGUudmlkZW9TZW5jTGVuZ3RoPWMscz11KzE0MSsxMiplLnNhbXBsZXMubGVuZ3RoK2MsZS5pc0F1ZGlvRW5jcnlwdGlvbiYmIWUuaXNWaWRlb0VuY3J5cHRpb24mJihzPXUrMTIqZS5zYW1wbGVzLmxlbmd0aCs4NCl9ZWxzZSBzPXUrMTA0KzQqZS5zYW1wbGVzLmxlbmd0aCxlLmlzQXVkaW9FbmNyeXB0aW9uJiYocz11KzE2OSsxMiplLnNhbXBsZXMubGVuZ3RoKTt2YXIgcD1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwyNTUmZS5pZCxuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLG8+PjI0JjI1NSxvPj4xNiYyNTUsbz4+OCYyNTUsMjU1Jm8sMCwwLDAsMCwwLDAsMCwxLDAscz4+MTYmMjU1LHM+PjgmMjU1LDI1NSZzLGE+PjI0JjI1NSxhPj4xNiYyNTUsYT4+OCYyNTUsMjU1JmEsMTQ0LDAsMCwwXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrcC5ieXRlTGVuZ3RoKSx0LnR5cGUoInNpZHgiKSxwKSxyLmJ1ZmZlcn19LHtrZXk6InNpbmYiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFtdKSxpPXQuZnJtYShlKSxhPXQuc2NobSgpLG89dC5zY2hpKGUpO3JldHVybiByLndyaXRlKG4saSxhLG8pLHIuYnVmZmVyfX0se2tleToic21oZCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemU7cmV0dXJuIGUud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoInNtaGQiKSxuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSkpLGUuYnVmZmVyfX0se2tleToic3RibCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49OCxpPXQuc3RzZChlKSxhPXQuc3R0cygpLG89dC5zdHNjKCksdT10LnN0c3ooKSxzPXQuc3RjbygpO3JldHVybltpLGEsbyx1LHNdLmZvckVhY2goKGZ1bmN0aW9uKGUpe24rPWUuYnl0ZUxlbmd0aH0pKSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoInN0YmwiKSxpLGEsbyx1LHMpLHIuYnVmZmVyfX0se2tleToic3RjbyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemUscj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSk7cmV0dXJuIGUud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoInN0Y28iKSxyKSxlLmJ1ZmZlcn19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9bmV3IHplLHI9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMF0pO3JldHVybiBlLndyaXRlKHQuc2l6ZSgxNiksdC50eXBlKCJzdHNjIiksciksZS5idWZmZXJ9fSx7a2V5OiJzdHNkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcixuPW5ldyB6ZTtyZXR1cm4gcj0iYXVkaW8iPT09ZS50eXBlP2UuZW5jYT90LmVuY2EoZSk6dC5tcDRhKGUpOmUuZW5jdj90LmVuY3YoZSk6ZS5WaWRlb1Zpc3VhbFNhbXBsZUVudHJ5LG4ud3JpdGUodC5zaXplKDE2K3IuYnl0ZUxlbmd0aCksdC50eXBlKCJzdHNkIiksdC5leHRlbnNpb24oMCwwKSxuZXcgVWludDhBcnJheShbMCwwLDAsMV0pLHIpLG4uYnVmZmVyfX0se2tleToic3RzeiIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemUscj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDBdKTtyZXR1cm4gZS53cml0ZSh0LnNpemUoMjApLHQudHlwZSgic3RzeiIpLHIpLGUuYnVmZmVyfX0se2tleToic3R0cyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemUscj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSk7cmV0dXJuIGUud3JpdGUodC5zaXplKDE2KSx0LnR5cGUoInN0dHMiKSxyKSxlLmJ1ZmZlcn19LHtrZXk6InN0eXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFsxMDksMTE1LDEwMCwxMDQsMCwwLDAsMCwxMDksMTE1LDEwMCwxMDQsMTA5LDExNSwxMDUsMTIwXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoInN0eXAiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6InRlbmMiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwyNTUmZS5kZWZhdWx0X0lzRW5jcnlwdGVkLDI1NSZlLmRlZmF1bHRfSVZfc2l6ZV0uY29uY2F0KFVlKGUuZGVmYXVsdF9LSUQpKSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoInRlbmMiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6InRmZHQiLHZhbHVlOmZ1bmN0aW9uKGUscil7dmFyIG49bmV3IHplLGk9TWF0aC5mbG9vcihyLyhTZSsxKSksYT1NYXRoLmZsb29yKHIlKFNlKzEpKTtyZXR1cm4gZS5pc1ZpZGVvRW5jcnlwdGlvbnx8ZS5pc0F1ZGlvRW5jcnlwdGlvbj9uLndyaXRlKHQuc2l6ZSgxNiksdC50eXBlKCJ0ZmR0IiksdC5leHRlbnNpb24oMCwwKSx6ZS53cml0ZVVpbnQzMihhKSk6bi53cml0ZSh0LnNpemUoMjApLHQudHlwZSgidGZkdCIpLHQuZXh0ZW5zaW9uKDEsMCksemUud3JpdGVVaW50MzIoaSksemUud3JpdGVVaW50MzIoYSkpLG4uYnVmZmVyfX0se2tleToidGZoZCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49MTYsaT1lLmZsYWdzO3JldHVybiAyJmkmJihpPWUuZmxhZ3MtMiksMSZpJiYobis9OCksOCZpJiYobis9NCksMTYmaSYmKG4rPTQpLDMyJmkmJihuKz00KSxyLndyaXRlKHQuc2l6ZShuKSx0LnR5cGUoInRmaGQiKSksci53cml0ZSh6ZS53cml0ZVVpbnQzMihpKSksci53cml0ZSh6ZS53cml0ZVVpbnQzMihlLnRyYWNrX2lkKSksMSZpJiZyLndyaXRlKHplLndyaXRlVWludDY0KGUuYmFzZV9kYXRhX29mZnNldCkpLDgmaSYmci53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmRlZmF1bHRfc2FtcGxlX2R1cmF0aW9uKSksMTYmaSYmci53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmRlZmF1bHRfc2FtcGxlX3NpemUpKSwzMiZpJiZyLndyaXRlKHplLndyaXRlVWludDMyKGUuZGVmYXVsdF9zYW1wbGVfZmxhZ3MpKSxyLmJ1ZmZlcn19LHtrZXk6InRraGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPWUuaWQsaT1lLmR1cmF0aW9uKmUudGltZVNjYWxlLGE9ZS53aWR0aCxvPWUuaGVpZ2h0LHU9ZS50eXBlLHM9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDMsMCwwLDAsMCwyMTcsMTcyLDIzNiw4NixuPj4yNCYyNTUsbj4+MTYmMjU1LG4+PjgmMjU1LDI1NSZuLDAsMCwwLDAsaT4+MjQmMjU1LGk+PjE2JjI1NSxpPj44JjI1NSwyNTUmaSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsInZpZGVvIj09PXU/MTowLCJhdWRpbyI9PT11PzE6MCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsYT4+OCYyNTUsMjU1JmEsMCwwLG8+PjgmMjU1LDI1NSZvLDAsMF0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K3MuYnl0ZUxlbmd0aCksdC50eXBlKCJ0a2hkIikscyksci5idWZmZXJ9fSx7a2V5OiJ0cmFmIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj04LGk9dC50ZmhkKGUuaWQpLGE9dC50ZmR0KGUsZS50aW1lKTtpZihlLmlzVmlkZW9FbmNyeXB0aW9ufHxlLmlzQXVkaW9FbmNyeXB0aW9uKWlmKGUuaXNWaWRlb0VuY3J5cHRpb24paWYoMT09PWUuaWQpe3ZhciBvPXQuc2FpeihlKSx1PXQuc2FpbyhlKSxzPXQudHJ1bjEoZSksYz10LnNlbmMoZSk7W2ksYSxvLHUscyxjXS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJ0cmFmIiksaSxhLG8sdSxzLGMpfWVsc2UgaWYoZS5pc0F1ZGlvRW5jcnlwdGlvbil7dmFyIGY9dC5zYmdwKGUpLGw9dC5zYWl6KGUpLHk9dC5zYWlvKGUpLGg9dC5zZW5jKGUpLHA9dC50cnVuMShlKTtbaSxhLGYsbCx5LGgscF0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSxmLGwseSxoLHApfWVsc2V7dmFyIHY9dC5zYmdwKGUpLGQ9dC50cnVuMShlKTtbaSxhLHYsZF0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSx2LGQpfWVsc2UgaWYoMT09PWUuaWQpe3ZhciB3PXQudHJ1bjEoZSk7W2ksYSx3XS5mb3JFYWNoKChmdW5jdGlvbihlKXtuKz1lLmJ5dGVMZW5ndGh9KSksci53cml0ZSh0LnNpemUobiksdC50eXBlKCJ0cmFmIiksaSxhLHcpfWVsc2V7dmFyIGc9dC5zYmdwKGUpLG09dC5zYWl6KGUpLGI9dC5zYWlvKGUpLGs9dC5zZW5jKGUpLF89dC50cnVuMShlKTtbaSxhLGcsbSxiLGssX10uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSxnLG0sYixrLF8pfWVsc2V7dmFyIHg9dC5zZHRwKGUpLEE9dC50cnVuKGUseC5ieXRlTGVuZ3RoKTtbaSxhLHgsQV0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5ieXRlTGVuZ3RofSkpLHIud3JpdGUodC5zaXplKG4pLHQudHlwZSgidHJhZiIpLGksYSx4LEEpfXJldHVybiByLmJ1ZmZlcn19LHtrZXk6InRyZXgiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLGU+PjI0LGU+PjE2JjI1NSxlPj44JjI1NSwyNTUmZSwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwxXSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrbi5ieXRlTGVuZ3RoKSx0LnR5cGUoInRyZXgiKSxuKSxyLmJ1ZmZlcn19LHtrZXk6InRyZXgxIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1uZXcgVWludDhBcnJheShbMCwwLDAsMCxlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmUsMCwwLDAsMSwwLDAsMiwwLDAsMCwwLDAsMCwxLDAsMF0pO3JldHVybiByLndyaXRlKHQuc2l6ZSg4K24uYnl0ZUxlbmd0aCksdC50eXBlKCJ0cmV4Iiksbiksci5idWZmZXJ9fSx7a2V5OiJ0cmV4MiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlLDAsMCwwLDEsMCwwLDQsMCwwLDAsMCwwLDIsMCwwLDBdKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCtuLmJ5dGVMZW5ndGgpLHQudHlwZSgidHJleCIpLG4pLHIuYnVmZmVyfX0se2tleToidHJ1biIsdmFsdWU6ZnVuY3Rpb24oZSxyKXt2YXIgbj1lLmlkLGk9MT09PW4/MTY6MTIsYT1uZXcgemUsbz16ZS53cml0ZVVpbnQzMihlLnNhbXBsZXMubGVuZ3RoKSx1PXplLndyaXRlVWludDMyKDk2K2kqZS5zYW1wbGVzLmxlbmd0aCtyKTtyZXR1cm4gYS53cml0ZSh0LnNpemUoMjAraSplLnNhbXBsZXMubGVuZ3RoKSx0LnR5cGUoInRydW4iKSx0LmV4dGVuc2lvbigwLGUuZmxhZ3MpLG8sdSksZS5zYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7YS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmR1cmF0aW9uKSksYS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLnNpemUpKSwxPT09bj8oYS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLmtleT8zMzU1NDQzMjoxNjg0Mjc1MikpLGEud3JpdGUoemUud3JpdGVVaW50MzIoZS5vZmZzZXQpKSk6YS53cml0ZSh6ZS53cml0ZVVpbnQzMigxNjc3NzIxNikpfSkpLGEuYnVmZmVyfX0se2tleToidHJ1bjEiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPWUuaWQsbj0xPT09cj8xMjo0LGk9bmV3IHplLGE9emUud3JpdGVVaW50MzIoZS5zYW1wbGVzLmxlbmd0aCksbz1udWxsO2lmKDE9PT1lLmlkKXt2YXIgdT0wOzE9PT1lLmlkJiYodT1lLnZpZGVvU2VuY0xlbmd0aCksbz16ZS53cml0ZVVpbnQzMigxMiplLnNhbXBsZXMubGVuZ3RoK3UrMTQ5KSwhZS5pc1ZpZGVvRW5jcnlwdGlvbiYmZS5pc0F1ZGlvRW5jcnlwdGlvbiYmKG89emUud3JpdGVVaW50MzIoZS5zYW1wbGVzLmxlbmd0aCpuKzkyKSl9ZWxzZXt2YXIgcz00KmUuc2FtcGxlcy5sZW5ndGgrMTIwO2UuaXNBdWRpb0VuY3J5cHRpb24mJihzPTEyKmUuc2FtcGxlcy5sZW5ndGgrMTc3KSxvPXplLndyaXRlVWludDMyKHMpfXJldHVybiBpLndyaXRlKHQuc2l6ZSgyMCtuKmUuc2FtcGxlcy5sZW5ndGgpLHQudHlwZSgidHJ1biIpLHQuZXh0ZW5zaW9uKDAsZS5mbGFncyksYSxvKSxlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7aS53cml0ZSh6ZS53cml0ZVVpbnQzMihlLnNpemUpKSwxPT09ciYmKGkud3JpdGUoemUud3JpdGVVaW50MzIoZS5rZXk/MzM1NTQ0MzI6NjU1MzYpKSxpLndyaXRlKHplLndyaXRlVWludDMyKGUub2Zmc2V0KSkpfSkpLGkuYnVmZmVyfX0se2tleToidm1oZCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT1uZXcgemU7cmV0dXJuIGUud3JpdGUodC5zaXplKDIwKSx0LnR5cGUoInZtaGQiKSxuZXcgVWludDhBcnJheShbMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDBdKSksZS5idWZmZXJ9fSx7a2V5OiJhdjAxIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgemUsbj1lLndpZHRoLGk9ZS5oZWlnaHQsYT10LmF2MUMoZSksbz1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsbj4+OCYyNTUsMjU1Jm4saT4+OCYyNTUsMjU1JmksMCw3MiwwLDAsMCw3MiwwLDAsMCwwLDAsMCwwLDEsMTgsMTAwLDk3LDEwNSwxMDgsMTIxLDEwOSwxMTEsMTE2LDEwNSwxMTEsMTEwLDQ3LDEwNCwxMDgsMTE1LDQ2LDEwNiwxMTUsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDI0LDE3LDE3XSksdT10LmJ0cnQoKSxzPXQucGFzcChlKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCtvLmJ5dGVMZW5ndGgrYS5ieXRlTGVuZ3RoK3UuYnl0ZUxlbmd0aCtzLmJ5dGVMZW5ndGgpLHQudHlwZSgiYXYwMSIpLG8sYSx1LHMpLHIuYnVmZmVyfX0se2tleToiYXYxQyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49bmV3IFVpbnQ4QXJyYXkoZS5hdjFDKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCtuLmJ5dGVMZW5ndGgpLHQudHlwZSgiYXYxQyIpLG4pLHIuYnVmZmVyfX0se2tleToiYXZjMSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IHplLG49ZS53aWR0aCxpPWUuaGVpZ2h0LGE9dC5hdmNDKGUpLG89bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLG4+PjgmMjU1LDI1NSZuLGk+PjgmMjU1LDI1NSZpLDAsNzIsMCwwLDAsNzIsMCwwLDAsMCwwLDAsMCwxLDE4LDEwMCw5NywxMDUsMTA4LDEyMSwxMDksMTExLDExNiwxMDUsMTExLDExMCw0NywxMDQsMTA4LDExNSw0NiwxMDYsMTE1LDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyNCwxNywxN10pLHU9dC5idHJ0KCkscz10LnBhc3AoZSk7cmV0dXJuIHIud3JpdGUodC5zaXplKDgrby5ieXRlTGVuZ3RoK2EuYnl0ZUxlbmd0aCt1LmJ5dGVMZW5ndGgrcy5ieXRlTGVuZ3RoKSx0LnR5cGUoImF2YzEiKSxvLGEsdSxzKSxyLmJ1ZmZlcn19LHtrZXk6ImF2Y0MiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyB6ZSxuPWUuc3BzLGk9ZS5wcHMsYT1uZXcgVWludDhBcnJheShbMSxuWzFdLG5bMl0sblszXSwyNTUsMjI1XS5jb25jYXQoW24ubGVuZ3RoPj4+OCYyNTUsMjU1Jm4ubGVuZ3RoXSkuY29uY2F0KG4pLmNvbmNhdCgxKS5jb25jYXQoW2kubGVuZ3RoPj4+OCYyNTUsMjU1JmkubGVuZ3RoXSkuY29uY2F0KGkpKTtyZXR1cm4gci53cml0ZSh0LnNpemUoOCthLmJ5dGVMZW5ndGgpLHQudHlwZSgiYXZjQyIpLGEpLHIuYnVmZmVyfX1dKSx0fSgpO0NlLnZpZGVvU2VxdWVuY2U9MSxDZS5hdWRpb1NlcXVlbmNlPTE7dmFyIEJlLE9lPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe3ZhciByLG47ZSh0aGlzLHQpO3ZhciBpPW5ldyBQcm9taXNlKChmdW5jdGlvbihlLHQpe3I9ZSxuPXR9KSk7cmV0dXJuIGkucmVzb2x2ZT1yLGkucmVqZWN0PW4saX1yZXR1cm4gcih0LFt7a2V5OiJyZXNvbHZlIix2YWx1ZTpmdW5jdGlvbihlKXt9fSx7a2V5OiJyZWplY3QiLHZhbHVlOmZ1bmN0aW9uKGUpe319XSksdH0oKTtmdW5jdGlvbiBFZSgpe3RyeXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIGxvY2FsU3RvcmFnZSYmInNldEl0ZW0iaW4gbG9jYWxTdG9yYWdlJiYhIWxvY2FsU3RvcmFnZS5zZXRJdGVtfWNhdGNoKGUpe3JldHVybiExfX1FZSYmZnVuY3Rpb24oKXt2YXIgZT0iX2xvY2Fsc3RvcmFnZV9zdXBwb3J0X3Rlc3QiO3RyeXtsb2NhbFN0b3JhZ2Uuc2V0SXRlbShlLCEwKSxsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShlKX1jYXRjaCh0KXtyZXR1cm4hMH19KCk7dmFyIExlPXIoKGZ1bmN0aW9uIHQocixuLGksYSxvLHUpe2UodGhpcyx0KSx0aGlzLnR5cGU9cix0aGlzLmNvZGVjcz1uLHRoaXMudmlzdWFsRW50cnlCb3g9aSx0aGlzLmNvbmZpZ3VyYXRpb25Cb3g9YSx0aGlzLnR5cGVzPW8sdGhpcy5sb2dDb2RlVHlwZT11fSkpLEllPSJhdmMiLFJlPSJhdjEiO24oQmU9e30sSWUsbmV3IExlKCJhdmMiLCJhdmMxLjY0MDAxRSIsImF2YzEiLCJhdmNDIixbImgyNjQiXSwiaDI2NCIpKSxuKEJlLFJlLG5ldyBMZSgiYXYxIiwiYXYwMS4wLjA4TS4wOCIsImF2MDEiLCJhdjFDIixbImF2MSJdLCJhdjEiKSk7dmFyIERlPXttc2U6ZnVuY3Rpb24oKXt9fSxNZT1zZWxmLmNyeXB0b3x8c2VsZi5tc0NyeXB0byxUZT12ZS5maW5kQm94LGplPWZ1bmN0aW9uKGUsdCxyKXt2YXIgbj1udWxsO2lmKGU9PT1JZSYmKG49VmUodCxyKSksZT09PVJlJiYobj1mdW5jdGlvbihlLHQpe3ZhciByPVBlKGUsdCksbj1yLndpZHRoLGk9ci5oZWlnaHQsYT1yLnBpeGVsUmF0aW8sbz1yLmF2MUNCb3gsdT1yLnZpZGVvQ29kZWMscz1DZS5hdjAxKHt3aWR0aDpuLGhlaWdodDppLHBpeGVsUmF0aW86YSxhdjFDOm8uZGF0YX0pLGM9Q2UuYXYxQyh7YXYxQzpvLmRhdGF9KTtyZXR1cm57VmlkZW9WaXN1YWxTYW1wbGVFbnRyeTpzLFZpZGVvQ29kZWNDb25maWd1cmF0aW9uQm94OmMsdmlkZW9Db2RlYzp1fX0odCxyKSksIW4pdGhyb3cgbmV3IEVycm9yKCIiLmNvbmNhdChlLCIgbm90IHN1cHBvcnQiKSk7cmV0dXJuIG59LFZlPWZ1bmN0aW9uKGUsdCl7dmFyIHI9SGUoZSx0KSxuPXIud2lkdGgsaT1yLmhlaWdodCxhPXIudmlkZW9Db2RlYyxvPXIuc3BzLHU9ci5wcHMscz1yLnBpeGVsUmF0aW87cmV0dXJue1ZpZGVvVmlzdWFsU2FtcGxlRW50cnk6Q2UuYXZjMSh7c3BzOm8scHBzOnUsd2lkdGg6bixoZWlnaHQ6aSxwaXhlbFJhdGlvOnN9KSxWaWRlb0NvZGVjQ29uZmlndXJhdGlvbkJveDpDZS5hdmNDKHtzcHM6byxwcHM6dX0pLHZpZGVvQ29kZWM6YX19LEhlPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbixpLGEsbyx1PVsxLDFdLHM9VGUodCwiYXZjQyIpOyJlbmN2Ij09PWUudHlwZSYmKHM9VGUoZSwiYXZjQyIpKTt2YXIgYz1UZSh0LCJ0a2hkIik7cmV0dXJuIHM/KGk9IiIuY29uY2F0KGUudHlwZSwiLiIpK3ZlLnRvSGV4KHMucHJvZmlsZSxzLnByb2ZpbGVDb21wYXRpYmlsaXR5LHMuQVZDTGV2ZWxJbmRpY2F0aW9uKS5qb2luKCIiKSxhPXMuc3BzLHU9W3Muc3BzSW5mby5wYXJfcmF0aW8ud2lkdGgscy5zcHNJbmZvLnBhcl9yYXRpby5oZWlnaHRdLHMuc3BzSW5mby5jb2RlY19zaXplJiYocj1zLnNwc0luZm8uY29kZWNfc2l6ZS53aWR0aCxuPXMuc3BzSW5mby5jb2RlY19zaXplLmhlaWdodCksbz1zLnBwcyYmcy5wcHMubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKCIweCIuY29uY2F0KGUpKX0pKSk6aT0iIi5jb25jYXQoZS50eXBlKSxjJiYhciYmKHI9Yy53aWR0aCxuPWMuaGVpZ2h0KSx7d2lkdGg6cixoZWlnaHQ6bix2aWRlb0NvZGVjOmksc3BzOmEscHBzOm8scGl4ZWxSYXRpbzp1fX07dmFyIFBlPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbixpLGE9WzEsMV0sbz1UZSh0LCJhdjFDIik7ImVuY3YiPT09ZS50eXBlJiYocj1lLndpZHRoLG49ZS5oZWlnaHQsbz1UZShlLCJhdjFDIikpO3ZhciB1PVRlKHQsInRraGQiKTtyZXR1cm4gbz8oaT0iIi5jb25jYXQoZS50eXBlLCIuIiksYT1bMSwxXSk6aT0iIi5jb25jYXQoZS50eXBlKSx1JiYhciYmKHI9dS53aWR0aCxuPXUuaGVpZ2h0KSx7d2lkdGg6cixoZWlnaHQ6bix2aWRlb0NvZGVjOmkscGl4ZWxSYXRpbzphLGF2MUNCb3g6b319LEZlPXtkZWNyeXB0SGVhZGVyOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPXRoaXMsbj1uZXcgemUsaT1udWxsLGE9bnVsbCxvPTA7bzxlLmJveGVzLmxlbmd0aDtvKyspe3ZhciB1PWUuYm94ZXNbb107aWYoImZ0eXAiPT09dS50eXBlKXthPXU7YnJlYWt9fXJldHVybiBlLmJveGVzLmZvckVhY2goKGZ1bmN0aW9uKGUpe2lmKCJtb292Ij09PWUudHlwZSl7dmFyIG89ZnVuY3Rpb24oZSx0KXt2YXIgcixuLGksYSxvLHUscyxjLGY9VGUoZSwibXZoZCIpLGw9VGUoZSwidHJhayIpLHk9VGUoZSwidWR0YSIpLGg9VGUobCwiaGRsciIpLHA9VGUobCwibWRoZCIpO2lmKGgmJnApe3ZhciB2PVRlKGwsInN0c2QiKSxkPVRlKGwsInRraGQiKSx3PXYuc3ViQm94WzBdLGc9e307aWYoInZpZGUiPT09aC5oYW5kbGVUeXBlJiYoaT1sLGE9cC50aW1lc2NhbGUsZz1qZSh0LHcsbCkpLCJzb3VuIj09PWguaGFuZGxlVHlwZSl7bj1sO3ZhciBtPVRlKGwsImVzZHMiKSxiPVRlKGwsIm1wNGEiKSxrPVRlKGwsNSk7bz1wLnRpbWVzY2FsZSxyPW0/IiIuY29uY2F0KHcudHlwZSwiLiIpK3ZlLnRvSGV4KG0uc3ViQm94WzBdLnN1YkJveFswXS50eXBlSUQpKyIuIi5jb25jYXQobS5zdWJCb3hbMF0uc3ViQm94WzBdLnN1YkJveFswXS50eXBlKToiIi5jb25jYXQody50eXBlKSxrJiZrLkVTY29kZSYmKGM9ay5FU2NvZGUubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gTnVtYmVyKCIweCIuY29uY2F0KGUpKX0pKSksYiYmKHU9Yi5jaGFubmVsQ291bnQscz1iLnNhbXBsZVJhdGUpO3ZhciBfPVRlKGwsImVuY2EiKTtfJiYodT1fLmNoYW5uZWxDb3VudCxzPV8uc2FtcGxlUmF0ZSl9dmFyIHg9dmUuZmluZEJveChsLCJzdHNjIiksQT12ZS5maW5kQm94KGwsInN0c3oiKSx6PXZlLmZpbmRCb3gobCwic3R0cyIpLFM9dmUuZmluZEJveChsLCJzdGNvIiksVT1mLmR1cmF0aW9uO2lmKDA9PT1VKXt2YXIgQz1UZShlLCJtZWhkIik7QyYmKFU9Qy5mcmFnbWVudF9kdXJhdGlvbil9cmV0dXJuIE9iamVjdC5hc3NpZ24oe2F1ZGlvQ29kZWM6cixhdWRpb1RyYWs6bix2aWRlb1RyYWs6aSxjcmVhdGVUaW1lOmYuY3JlYXRlVGltZSxtb2RpZnlUaW1lOmYubW9kaWZ5VGltZSxkdXJhdGlvbjpVL2YudGltZVNjYWxlLHRpbWVTY2FsZTpmLnRpbWVTY2FsZSx2aWRlb1RpbWVTY2FsZTphLGF1ZGlvVGltZVNjYWxlOm8scGl4ZWxSYXRpbzpbMSwxXSxjaGFubmVsQ291bnQ6dSxzYW1wbGVSYXRlOnMsYXVkaW9Db25maWc6YyxzdHNjOngsc3RzejpBLHN0dHM6eixzdGNvOlMsdWR0YTp5LHRyYWNrSUQ6ZCYmZC50cmFja0lEfSxnKX19KGUsdCk7aWYoby51ZHRhKXt2YXIgdT1UZShvLnVkdGEsIm1ldGEiKTtpPXUmJnUudmlkfW8udmlkZW9Db2RlYz9yLnZpZGVvTWV0YT1vOnIuYXVkaW9NZXRhPW8sbi53cml0ZShDZS5mdHlwKGEpKSxuLndyaXRlKENlLm1vb3YobykpfX0pKSx7YnVmZmVyOm4uYnVmZmVyLHZpZDppfX0sZGVjcnlwdEJvZHk6ZnVuY3Rpb24oZSx0LHIsbixpLGEpe3ZhciBvPW5ldyBPZTt0cnl7dmFyIHU9bmV3IHplLHM9bnVsbCxjPW51bGw7ZS5ib3hlcy5mb3JFYWNoKChmdW5jdGlvbihlKXtpZigic3R5cCI9PT1lLnR5cGV8fCJzaWR4Ij09PWUudHlwZSl1LndyaXRlKENlLnNpemUoZS5zaXplKSksdS53cml0ZShDZS50eXBlKGUudHlwZSkpLHUud3JpdGUobmV3IFVpbnQ4QXJyYXkoZS5kYXRhKSk7ZWxzZSBpZigibW9vZiI9PT1lLnR5cGUpe3M9VGUoZSwic2VuYyIpO3ZhciBmPVRlKGUsInNhaW8iKSxsPVRlKGUsInNhaXoiKSx5PVRlKGUsInRmaGQiKTtjPVRlKGUsInRydW4iKTt2YXIgaD0wO3MmJnMuc2FtcGxlcy5sZW5ndGg/KGg9cy5kYXRhLmJ5dGVMZW5ndGgrOCxmJiZmLmRhdGEmJihoPWgrZi5kYXRhLmJ5dGVMZW5ndGgrOCksbCYmbC5kYXRhJiYoaD1oK2wuZGF0YS5ieXRlTGVuZ3RoKzgpKTooeSYmMiZ5LmZsYWdzJiYoaD00KSxzPW51bGwpOyFmdW5jdGlvbiBlKHQpe3ZhciByPXQuc2l6ZSxuPXQudHlwZTtpZigic2FpbyIhPT1uJiYic2FpeiIhPT1uJiYic2VuYyIhPT1uKWlmKCJtb29mIiE9PW4mJiJ0cmFmIiE9PW58fChyLT1oKSwidGZoZCI9PT1uJiYyJnkuZmxhZ3MpdS53cml0ZShDZS50ZmhkKHkpKTtlbHNlIGlmKHUud3JpdGUoQ2Uuc2l6ZShyKSksdS53cml0ZShDZS50eXBlKG4pKSx0LnN1YkJveCYmdC5zdWJCb3gubGVuZ3RoKXQuc3ViQm94LmZvckVhY2goKGZ1bmN0aW9uKHQpe2UodCl9KSk7ZWxzZSBpZigidHJ1biI9PT1uKXt2YXIgaT1uZXcgRGF0YVZpZXcodC5kYXRhLDApO2kuc2V0SW50MzIoOCxpLmdldEludDMyKDgpLWgpLHUud3JpdGUobmV3IFVpbnQ4QXJyYXkoaS5idWZmZXIpKX1lbHNlIHUud3JpdGUobmV3IFVpbnQ4QXJyYXkodC5kYXRhKSl9KGUpfWVsc2UibWRhdCI9PT1lLnR5cGUmJih1LndyaXRlKENlLnNpemUoZS5zaXplKSksdS53cml0ZShDZS50eXBlKGUudHlwZSkpLHM/YT9GZS5kZWNyeXB0V2l0aFJhdyhzLGMsZSxyLG4saSkudGhlbigoZnVuY3Rpb24oZSl7ZT8odS53cml0ZShlKSxvLnJlc29sdmUodS5idWZmZXIpKTpvLnJlc29sdmUobnVsbCl9KSk6RmUuZGVjcnlwdFdpdGhDcnlwdG9Kc1dvcmQocyxjLGUsdCxyLG4pLnRoZW4oKGZ1bmN0aW9uKGUpe2U/KHUud3JpdGUoZSksby5yZXNvbHZlKHUuYnVmZmVyKSk6by5yZXNvbHZlKG51bGwpfSkpOih1LndyaXRlKG5ldyBVaW50OEFycmF5KGUuZGF0YSkpLG8ucmVzb2x2ZSh1LmJ1ZmZlcikpKX0pKX1jYXRjaChmKXtEZS5tc2UoIiVjIGRhc2hwbGF5ZXI6bXNlIGRlY3J5cHQgYm9keSBlcnJvciIsImNvbG9yOm9yYW5nZSIpLG8ucmVzb2x2ZShudWxsKX1yZXR1cm4gb30sZGVjcnlwdFdpdGhDcnlwdG9Kc1dvcmQ6ZnVuY3Rpb24oZSx0LHIsbixpLGEpe3ZhciBvPW5ldyBPZTt0cnl7dmFyIHU9bmV3IHplLHM9bmV3IFVpbnQ4QXJyYXkoci5kYXRhKTtlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSxyKXt2YXIgaT1lLkluaXRpYWxpemF0aW9uVmVjdG9yO2lmKGUuc3Vic2FtcGxlcyYmZS5zdWJzYW1wbGVzLmxlbmd0aCl7dmFyIGE9W10sbz1bXTtlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS5CeXRlc09mQ2xlYXJEYXRhK2UuQnl0ZXNPZlByb3RlY3RlZERhdGEscj1zLnNsaWNlKDAsdCk7YS5wdXNoKHIuc2xpY2UoMCxlLkJ5dGVzT2ZDbGVhckRhdGEpKSxvLnB1c2goci5zbGljZShlLkJ5dGVzT2ZDbGVhckRhdGEpKSxzPXMuc2xpY2UodCl9KSk7dmFyIGM9bmV3IHplO2Mud3JpdGUuYXBwbHkoYyxvKTt2YXIgZj1GZS5kZWNyeXB0V29yZEFycmF5KGMuYnVmZmVyLG4saSk7YS5mb3JFYWNoKChmdW5jdGlvbihlLHQpe3ZhciByPW9bdF0ubGVuZ3RoLG49Zi5zbGljZSgwLHIpO3Uud3JpdGUoZSksdS53cml0ZShuKSxmPWYuc2xpY2Uocil9KSl9ZWxzZXt2YXIgbD10LnNhbXBsZXNbcl07dS53cml0ZShGZS5kZWNyeXB0V29yZEFycmF5KHMuc2xpY2UoMCxsKSxuLGkpKSxzPXMuc2xpY2UobCl9fSkpO3ZhciBjPXUuYnVmZmVyO28ucmVzb2x2ZShjKX1jYXRjaChmKXtEZS5tc2UoIiVjIGRhc2hwbGF5ZXI6bXNlIGRlY3J5cHRXaXRoQ3J5cHRvSnNXb3JkIGVycm9yIiwiY29sb3I6b3JhbmdlIiksby5yZXNvbHZlKG51bGwpfXJldHVybiBvfSxkZWNyeXB0V2l0aFJhdzpmdW5jdGlvbihlLHQscixuLGksYSl7dmFyIG89bmV3IE9lLHU9bmV3IHplLHM9bmV3IFVpbnQ4QXJyYXkoci5kYXRhKSxjPVtdO3JldHVybiBlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSxyKXt2YXIgbj1lLkluaXRpYWxpemF0aW9uVmVjdG9yO2lmKGUuc3Vic2FtcGxlcyYmZS5zdWJzYW1wbGVzLmxlbmd0aCl7dmFyIGk9W10sYT1bXTtlLnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9ZS5CeXRlc09mQ2xlYXJEYXRhK2UuQnl0ZXNPZlByb3RlY3RlZERhdGEscj1zLnNsaWNlKDAsdCk7aS5wdXNoKHIuc2xpY2UoMCxlLkJ5dGVzT2ZDbGVhckRhdGEpKSxhLnB1c2goci5zbGljZShlLkJ5dGVzT2ZDbGVhckRhdGEpKSxzPXMuc2xpY2UodCl9KSksYy5wdXNoKHtpdjpuLGVuY29kZUJ1ZmZlcnM6aSxlbmNEYXRhOmF9KX1lbHNle3ZhciBvPXQuc2FtcGxlc1tyXTtjLnB1c2goe2l2Om4sZW5jRGF0YTpbcy5zbGljZSgwLG8pXX0pLHM9cy5zbGljZShvKX19KSksdGhpcy5kZWNyeXB0U2FtcGxlcyhjLHUsbyxhKSxvfSxkZWNyeXB0U2FtcGxlczpmdW5jdGlvbihlLHQscixuKXtpZihlLmxlbmd0aD4wKXt2YXIgaT1lLnNoaWZ0KCksYT1pLmVuY0RhdGEsbz1uZXcgemU7by53cml0ZS5hcHBseShvLGgoYSkpLEZlLmRlY3J5cHRTYW1wbGUoby5idWZmZXIsaS5pdixuKS50aGVuKChmdW5jdGlvbihvKXt2YXIgdT1pLmVuY29kZUJ1ZmZlcnM7aWYodSl7dmFyIHM9bmV3IFVpbnQ4QXJyYXkobyk7dS5mb3JFYWNoKChmdW5jdGlvbihlLHIpe3ZhciBuPWFbcl0ubGVuZ3RoLGk9cy5zbGljZSgwLG4pO3Qud3JpdGUoZSksdC53cml0ZShpKSxzPXMuc2xpY2Uobil9KSl9ZWxzZSB0LndyaXRlKG5ldyBVaW50OEFycmF5KG8pKTtGZS5kZWNyeXB0U2FtcGxlcyhlLHQscixuKX0pLChmdW5jdGlvbigpe3IucmVzb2x2ZShudWxsKSxEZS5tc2UoIiVjIGRhc2hwbGF5ZXI6bXNlIGRlY3J5cHRTYW1wbGVzIGVyciIsImNvbG9yOm9yYW5nZSIpfSkpfWVsc2Ugci5yZXNvbHZlKHQuYnVmZmVyKX0sZGVjcnlwdFNhbXBsZTpmdW5jdGlvbihlLHQscil7dmFyIG49bmV3IFVpbnQ4QXJyYXkodCk7cmV0dXJuIE1lLnN1YnRsZS5kZWNyeXB0KHtuYW1lOiJBRVMtQ1RSIixjb3VudGVyOm4uYnVmZmVyLGxlbmd0aDo2NH0scixlKX0sZGVjcnlwdDpmdW5jdGlvbihlLHQscil7dmFyIG49dy5wYXJzZSh0KSxpPXcucGFyc2UodmUuZm9ybWF0SVYocikpO3JldHVybiBsZS5kZWNyeXB0KHllKGUpLG4se2l2OmksbW9kZTpoZSxwYWRkaW5nOnBlfSkudG9TdHJpbmcoKX0sZGVjcnlwdFdvcmRBcnJheTpmdW5jdGlvbihlLHQscil7dmFyIG49dy5wYXJzZSh0KSxpPXcucGFyc2UodmUuZm9ybWF0SVYocikpLGE9ZC5jcmVhdGUobmV3IFVpbnQ4QXJyYXkoZSkpLG89bGUuZGVjcnlwdChqLmNyZWF0ZSh7Y2lwaGVydGV4dDphfSksbix7aXY6aSxtb2RlOmhlLHBhZGRpbmc6cGV9KTtyZXR1cm4gRmUud29yZEFycmF5VG9VaW50OEFycmF5KG8pfSx3b3JkQXJyYXlUb1VpbnQ4QXJyYXk6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUuc2lnQnl0ZXMscj1lLndvcmRzLG49bmV3IFVpbnQ4QXJyYXkodCksaT0wLGE9MDtpIT09dDspe3ZhciBvPXJbYSsrXTtpZihuW2krK109KDQyNzgxOTAwODAmbyk+Pj4yNCxpPT09dClicmVhaztpZihuW2krK109KDE2NzExNjgwJm8pPj4+MTYsaT09PXQpYnJlYWs7aWYobltpKytdPSg2NTI4MCZvKT4+PjgsaT09PXQpYnJlYWs7bltpKytdPTI1NSZvfXJldHVybiBufX07b25tZXNzYWdlPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7aWYoImRlY3J5cHRCb2R5Ij09PWUuZGF0YS5tZXRob2Qpe3ZhciByPWUuZGF0YS5hcmdzO0ZlLmRlY3J5cHRCb2R5KHIucGFyc2VkLHIua2V5VmFsdWUsci5pc1ZpZGVvLHIuaWQsci5hZXNrZXksci51c2VSYXcpLnRoZW4oKGZ1bmN0aW9uKHIpe3QucG9zdE1lc3NhZ2Uoe21ldGhvZDoiZGVjcnlwdEJvZHkiLGlkOmUuZGF0YS5pZCxhcmdzOntkYXRhOnJ9fSl9KSl9ZWxzZSBpZigiZGVjcnlwdEhlYWRlciI9PT1lLmRhdGEubWV0aG9kKXt2YXIgbj1GZS5kZWNyeXB0SGVhZGVyKGUuZGF0YS5hcmdzLnBhcnNlZCxlLmRhdGEuY29kZWNzVHlwZSk7dGhpcy5wb3N0TWVzc2FnZSh7bWV0aG9kOiJkZWNyeXB0SGVhZGVyIixpZDplLmRhdGEuaWQsYXJnczp7ZGF0YTpuLmJ1ZmZlcix2aWQ6bi52aWR9fSl9ZWxzZSJsb2ciPT09ZS5kYXRhLm1ldGhvZCYmZS5kYXRhLnZhbHVlJiZjb25zb2xlLmxvZyYmKERlLm1zZT1jb25zb2xlLmxvZyl9fSgpOwo=",blob$5="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs$5)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper$5(){var e=blob$5&&(window.URL||window.webkitURL).createObjectURL(blob$5);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+encodedJs$5,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var workerCount=3,Crypto$1=function(){function e(){_classCallCheck$c(this,e),EventEmitter(this),this.workerList=[],this.bodyId=0,this.isSwitchHeader=!1,this.workerIndex=0,this.init(),this.headerId=0,this.crypto=window.crypto||window.msCrypto,this.aeskey=null}return _createClass$d(e,[{key:"init",value:function(){for(var e=this,t=0;t<workerCount;t++){var r=new WorkerWrapper$5;r.onmessage=function(t){e.emit(t.data.method,t.data)},r.postMessage({method:"log",value:LOGOPEN}),this.workerList.push(r)}}},{key:"importKeys",value:function(e){var t=this,r=new ProxyPromise$1,n=util$1.fromHex(e);return this.crypto.subtle.importKey("raw",n.buffer,{name:"AES-CTR",length:e.length},!1,["decrypt"]).then((function(e){t.aeskey=e,r.resolve()})),r}},{key:"updateHeaderId",value:function(){var e=this.bodyId+1;this.headerId=e,this.bodyId=e}},{key:"destroy",value:function(){this.workerList.forEach((function(e){e.terminate()})),this.workerList=[]}},{key:"decryptHeader",value:function(e,t){var r=this;return this.updateHeaderId(),new Promise((function(n){var i=new Parse(e),a=Math.floor(1e3*Math.random());r.workerList[0]&&r.workerList[0].postMessage({method:"decryptHeader",id:a,codecsType:t,args:{buf:e,parsed:i}});r.on("decryptHeader",(function e(t){t.id===a&&(r.off("decryptHeader",e),n({data:t.args.data,vid:t.args.vid}))}))}))}},{key:"decryptBody",value:function(e,t,r,n){var i=this,a=new Parse(e),o=i.bodyId+1;return i.bodyId=o,new Promise((function(e){i.on("decryptBody",(function t(r){r.id===o&&(i.off("decryptBody",t),e({data:r.args.data,id:o,headerId:i.headerId}))})),i.workerList[i.workerIndex]&&i.workerList[i.workerIndex].postMessage({method:"decryptBody",id:o,args:{parsed:a,keyValue:t,isVideo:r,id:i.workerIndex,aeskey:i.aeskey,useRaw:n}}),i.workerIndex=i.workerIndex+1,i.workerIndex>=workerCount&&(i.workerIndex=0)}))}}]),e}();function aesDec(e,t){return"string"==typeof t&&(t=JSON.parse(t)),derive(e).then((function(e){return new Promise((function(r,n){window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(t.iv),tagLength:128},e,t.encrypted).then((function(e){return new TextDecoder("utf-8").decode(e)})).then(r).catch((function(e){"OperationError"===String(e)&&(e="Wrong Password."),n(e)}))})).catch((function(e){throw e}))}))}function derive(e){return window.crypto.subtle.importKey("raw",e,"AES-GCM",!0,["encrypt","decrypt"])}var aes4js={decrypt:aesDec},sparkMd5={exports:{}};!function(e,t){e.exports=function(e){var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(e,t){var r=e[0],n=e[1],i=e[2],a=e[3];n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[0]-680876936|0)<<7|r>>>25)+n|0)&n|~r&i)+t[1]-389564586|0)<<12|a>>>20)+r|0)&r|~a&n)+t[2]+606105819|0)<<17|i>>>15)+a|0)&a|~i&r)+t[3]-1044525330|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[4]-176418897|0)<<7|r>>>25)+n|0)&n|~r&i)+t[5]+1200080426|0)<<12|a>>>20)+r|0)&r|~a&n)+t[6]-1473231341|0)<<17|i>>>15)+a|0)&a|~i&r)+t[7]-45705983|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[8]+1770035416|0)<<7|r>>>25)+n|0)&n|~r&i)+t[9]-1958414417|0)<<12|a>>>20)+r|0)&r|~a&n)+t[10]-42063|0)<<17|i>>>15)+a|0)&a|~i&r)+t[11]-1990404162|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&i|~n&a)+t[12]+1804603682|0)<<7|r>>>25)+n|0)&n|~r&i)+t[13]-40341101|0)<<12|a>>>20)+r|0)&r|~a&n)+t[14]-1502002290|0)<<17|i>>>15)+a|0)&a|~i&r)+t[15]+1236535329|0)<<22|n>>>10)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[1]-165796510|0)<<5|r>>>27)+n|0)&i|n&~i)+t[6]-1069501632|0)<<9|a>>>23)+r|0)&n|r&~n)+t[11]+643717713|0)<<14|i>>>18)+a|0)&r|a&~r)+t[0]-373897302|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[5]-701558691|0)<<5|r>>>27)+n|0)&i|n&~i)+t[10]+38016083|0)<<9|a>>>23)+r|0)&n|r&~n)+t[15]-660478335|0)<<14|i>>>18)+a|0)&r|a&~r)+t[4]-405537848|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[9]+568446438|0)<<5|r>>>27)+n|0)&i|n&~i)+t[14]-1019803690|0)<<9|a>>>23)+r|0)&n|r&~n)+t[3]-187363961|0)<<14|i>>>18)+a|0)&r|a&~r)+t[8]+1163531501|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n&a|i&~a)+t[13]-1444681467|0)<<5|r>>>27)+n|0)&i|n&~i)+t[2]-51403784|0)<<9|a>>>23)+r|0)&n|r&~n)+t[7]+1735328473|0)<<14|i>>>18)+a|0)&r|a&~r)+t[12]-1926607734|0)<<20|n>>>12)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[5]-378558|0)<<4|r>>>28)+n|0)^n^i)+t[8]-2022574463|0)<<11|a>>>21)+r|0)^r^n)+t[11]+1839030562|0)<<16|i>>>16)+a|0)^a^r)+t[14]-35309556|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[1]-1530992060|0)<<4|r>>>28)+n|0)^n^i)+t[4]+1272893353|0)<<11|a>>>21)+r|0)^r^n)+t[7]-155497632|0)<<16|i>>>16)+a|0)^a^r)+t[10]-1094730640|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[13]+681279174|0)<<4|r>>>28)+n|0)^n^i)+t[0]-358537222|0)<<11|a>>>21)+r|0)^r^n)+t[3]-722521979|0)<<16|i>>>16)+a|0)^a^r)+t[6]+76029189|0)<<23|n>>>9)+i|0,n=((n+=((i=((i+=((a=((a+=((r=((r+=(n^i^a)+t[9]-640364487|0)<<4|r>>>28)+n|0)^n^i)+t[12]-421815835|0)<<11|a>>>21)+r|0)^r^n)+t[15]+530742520|0)<<16|i>>>16)+a|0)^a^r)+t[2]-995338651|0)<<23|n>>>9)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[0]-198630844|0)<<6|r>>>26)+n|0)|~i))+t[7]+1126891415|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[14]-1416354905|0)<<15|i>>>17)+a|0)|~r))+t[5]-57434055|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[12]+1700485571|0)<<6|r>>>26)+n|0)|~i))+t[3]-1894986606|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[10]-1051523|0)<<15|i>>>17)+a|0)|~r))+t[1]-2054922799|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[8]+1873313359|0)<<6|r>>>26)+n|0)|~i))+t[15]-30611744|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[6]-1560198380|0)<<15|i>>>17)+a|0)|~r))+t[13]+1309151649|0)<<21|n>>>11)+i|0,n=((n+=((a=((a+=(n^((r=((r+=(i^(n|~a))+t[4]-145523070|0)<<6|r>>>26)+n|0)|~i))+t[11]-1120210379|0)<<10|a>>>22)+r|0)^((i=((i+=(r^(a|~n))+t[2]+718787259|0)<<15|i>>>17)+a|0)|~r))+t[9]-343485551|0)<<21|n>>>11)+i|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=i+e[2]|0,e[3]=a+e[3]|0}function n(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return r}function i(e){var t,r=[];for(t=0;t<64;t+=4)r[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return r}function a(e){var t,i,a,o,s,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(c,n(e.substring(t-64,t)));for(i=(e=e.substring(t-64)).length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<i;t+=1)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(r(c,a),t=0;t<16;t+=1)a[t]=0;return o=(o=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(o[2],16),l=parseInt(o[1],16)||0,a[14]=s,a[15]=l,r(c,a),c}function o(e){var t,n,a,o,s,l,u=e.length,c=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=u;t+=64)r(c,i(e.subarray(t-64,t)));for(n=(e=t-64<u?e.subarray(t-64):new Uint8Array(0)).length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)a[t>>2]|=e[t]<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(r(c,a),t=0;t<16;t+=1)a[t]=0;return o=(o=8*u).toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(o[2],16),l=parseInt(o[1],16)||0,a[14]=s,a[15]=l,r(c,a),c}function s(e){var r,n="";for(r=0;r<4;r+=1)n+=t[e>>8*r+4&15]+t[e>>8*r&15];return n}function l(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var r,n=e.length,i=new ArrayBuffer(n),a=new Uint8Array(i);for(r=0;r<n;r+=1)a[r]=e.charCodeAt(r);return t?a:i}function d(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function h(e,t,r){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),r?n:n.buffer}function f(e){var t,r=[],n=e.length;for(t=0;t<n-1;t+=2)r.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,r)}function p(){this.reset()}return l(a("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(r,n){var i,a,o,s,l=this.byteLength,u=t(r,l),c=l;return n!==e&&(c=t(n,l)),u>c?new ArrayBuffer(0):(i=c-u,a=new ArrayBuffer(i),o=new Uint8Array(a),s=new Uint8Array(this,u,i),o.set(s),a)}}(),p.prototype.append=function(e){return this.appendBinary(u(e)),this},p.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,i=this._buff.length;for(t=64;t<=i;t+=64)r(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},p.prototype.end=function(e){var t,r,n=this._buff,i=n.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(a,i),r=l(this._hash),e&&(r=f(r)),this.reset(),r},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(e,t){var n,i,a,o=t;if(e[o>>2]|=128<<(o%4<<3),o>55)for(r(this._hash,e),o=0;o<16;o+=1)e[o]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),a=parseInt(n[1],16)||0,e[14]=i,e[15]=a,r(this._hash,e)},p.hash=function(e,t){return p.hashBinary(u(e),t)},p.hashBinary=function(e,t){var r=l(a(e));return t?f(r):r},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(e){var t,n=h(this._buff.buffer,e,!0),a=n.length;for(this._length+=e.byteLength,t=64;t<=a;t+=64)r(this._hash,i(n.subarray(t-64,t)));return this._buff=t-64<a?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(e){var t,r,n=this._buff,i=n.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=n[t]<<(t%4<<3);return this._finish(a,i),r=l(this._hash),e&&(r=f(r)),this.reset(),r},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var e=p.prototype.getState.call(this);return e.buff=d(e.buff),e},p.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),p.prototype.setState.call(this,e)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(e,t){var r=l(o(new Uint8Array(e)));return t?f(r):r},p}()}(sparkMd5);var SparkMD5=sparkMd5.exports,AwManager$1=function(){function e(){_classCallCheck$c(this,e)}return _createClass$d(e,[{key:"init",value:function(){var e=this;return new Promise((function(t){e.module={onRuntimeInitialized:function(){t()}},aw$1(e.module)}))}},{key:"openBox",value:function(e){var t=window.atob(e),r=util$1.str2hex(t),n=this.module._malloc(Number(r.length));this.module.HEAP8.set(r,n);var i=this.module._openBox(Number(n),r.length),a=this.module.UTF8ToString(i);return this.module._free(n),a}},{key:"transformWithUnionInfo",value:function(e,t){return new Promise((function(r,n){var i=util$1.StringToArrayBuffer(SparkMD5.hash(t)),a={encrypted:util$1.Base64ToHex(e,!0),iv:TRANSFORM_IV};aes4js.decrypt(i,a).then((function(e){r(e)}))}))}}]),e}(),$$w=_export,repeat$1=stringRepeat;$$w({target:"String",proto:!0},{repeat:repeat$1});var GapJump$1=function(){function e(t,r){_classCallCheck$c(this,e),this.player=t,this.mediaElem=t.video,this.config=r,this.timer=new IntervalTimer$1,this.prevReadyState=this.mediaElem.readyState,this.didFireLargeGap=!1,this.seekingEventReceived=!1,this.segmentAppended=!1,this.onWaitFunc=this._onWaiting.bind(this),this.onPlayFunc=this._onPlay.bind(this),this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),!1!==this.config.useGapJump&&this._start(),this.hasPlayed=!1}return _createClass$d(e,[{key:"_onWaiting",value:function(){this.onGapJump()}},{key:"_onPlay",value:function(){this.hasPlayed=!0}},{key:"_start",value:function(){var e=this;this.mediaElem.addEventListener("waiting",this.onWaitFunc),this.mediaElem.addEventListener("play",this.onPlayFunc),this.timer.repeat((function(){e.onGapJump()}),250)}},{key:"onSegmentAppend",value:function(){this.segmentAppended=!0,this.onGapJump()}},{key:"onSeeking",value:function(){this.seekingEventReceived=!0,this.segmentAppended=!1,this.didFireLargeGap=!1}},{key:"onGapJump",value:function(){if(this.mediaElem.readyState!==HTMLMediaElement.HAVE_NOTHING){if(this.mediaElem.seeking){if(!this.seekingEventReceived)return}else this.seekingEventReceived=!1;if(!this.mediaElem.paused||0===this.mediaElem.currentTime||!this.hasPlayed){this.mediaElem.readyState!==this.prevReadyState&&(this.didFireLargeGap=!1,this.prevReadyState=this.mediaElem.readyState);var t=this.mediaElem.buffered,r=this.config.smallGapLimit||.5,n=this.config.gapDetectionThreshold||.1,i=this.mediaElem.currentTime,a=this._getIndex(t,i,n);if(null!==a&&(0!==a||this.segmentAppended)){var o=t.start(a);if(!(o>this.mediaElem.duration)){var s=o-i,l=s<=r;s<e.BROWSER_GAP_TOLERANCE||l&&(this.mediaElem.currentTime=this.isSafari?o+.1:o,debug$2.gap("gapJump gapIndex",a,"isGapSamll",l,"jumpLargeGap",!1,"currentTime",this.mediaElem.currentTime),.08!==o&&this.player&&this.player.emit("log",{type:"oneevent",end_type:"gap",vid:this.config.vid,ext:{video_postion:Math.floor(1e3*o)}}))}}}}}},{key:"_getIndex",value:function(e,t,r){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var n=this._getBuffered(e),i=null,a=0;a<n.length;a++){if(n[a].start>t&&(0===a||n[a-1].end-t<=r)){i=a;break}}return i}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}},{key:"destroy",value:function(){this.mediaElem.removeEventListener("waiting",this.onWaitFunc),this.mediaElem.removeEventListener("play",this.onPlayFunc),this.timer.clear(),this.timer=null}}]),e}();GapJump$1.BROWSER_GAP_TOLERANCE=.001;var PRELOAD_NEXT$2=PRELOAD_NEXT$3,CHANGE_STATES$1=CHANGE_STATES$2,__DASH__=function(){function e(t){var r=this;_classCallCheck$c(this,e),_defineProperty$c(this,"startProgressTimer",(function(){r._pluginInst.info({msg:"startProgressTimer"});var e=r,t=r.player,n=r.config;if(t&&e&&e.isDashCanUse&&e.dash.mse){var i=0;e.dash.mse.progressTimer=new IntervalTimer$1,e.dash.mse.progressTimer.repeat((function(){e&&e.isDashCanUse&&e.dash.mse&&e.dash.mse.progressTimer&&(e.handleUrlExpire(),++i*(n.progressTimer||DEFAULT_PROGRESS_TIMER)/1e3>DEFAULT_CHECK_BUFFER_TIME&&(e.clearBuffer&&e.clearBuffer(),i=0),n.disableBufferBreakCheck||(t.currentTime-(e.lastCurrentTime||0)>.1||t.paused?1!==e.dashBufferBreak&&2!==e.dashBufferBreak||(debug$2.log(""),e.dashBufferBreak=0,clearTimeout(e.dashBufferBreakTimer),e.dashBufferBreakTimer=null):e.dashBufferBreak||(e.dashBufferBreak=1,debug$2.log("".concat(DASH_BUFFER_BREAK,"")),e.dashBufferBreakTimer=setTimeout((function(){1===e.dashBufferBreak&&(e.dashBufferBreak=2,debug$2.log(""),e.dash.emit("error",new Errors(Errors.BUFFERBREAK,Errors.BUFFERBREAK_ERROR,{line:1e3,handle:"[DASH] buffer break",msg:"buffer break"}))),e.dashBufferBreakTimer=null}),DASH_BUFFER_BREAK)),e.lastCurrentTime=t.currentTime),e.loadData(void 0),e.isEnded())}),n.progressTimer||DEFAULT_PROGRESS_TIMER)}})),_defineProperty$c(this,"_onAutoDescChange",(function(e){var t=e.definition,n=e.reset,i=e.fps,a=e.item;r.updateAutoDefiDesc(t,n,i,a)})),this._pluginInst=t.pluginInst;var n=this._pluginInst,i=n.player,a=n.config;this._minDuration=1/0,this.player=i,this.config=a,this.startTimestamp=(new Date).getTime(),this.lastDefiIdx=void 0,this.__isDashCanUse=!1,this.preloadBufferThreshold=this.config.preloadBufferThreshold||.5,this.abrInstance=null,this.definitions=[];var o=this.config.autoBitrateOpts||{};this.isPlayAutoDefi=ABR.getIsPlayAutoDefi(o),this.isOpenAutoDefi=!!o.isOpenAutoDefi,this.isCurrentAutoDefi=this.isOpenAutoDefi&&this.isPlayAutoDefi,this.bitrateMap={},this.curBitrate=0,this.defiIdMap={},this.definition2item={},this.bandwidth2item={},(this.preloadBufferThreshold<=0||this.preloadBufferThreshold>1)&&(this.preloadBufferThreshold=.5),this.curVideoInitSegmentIdx=-1,this.getPlayInfoTimestamp=this.startTimestamp/1e3,a.dashOpts.dynamic_video.dynamic_video_list&&a.dashOpts.dynamic_video.dynamic_video_list.length>0?this.urlExpireTimestamp=a.dashOpts.dynamic_video.dynamic_video_list[0].url_expire||0:a.dashOpts.dynamic_video.dynamic_audio_list&&a.dashOpts.dynamic_video.dynamic_audio_list.length>0&&(this.urlExpireTimestamp=a.dashOpts.dynamic_video.dynamic_audio_list[0].url_expire||0),this.gapJumpInst=new GapJump$1(i,a),util$1.on(i,"addVideoBufferEnd",(function(){r.gapJumpInst.onSegmentAppend()}),"dashDestroy")}var t,r,n;return _createClass$d(e,[{key:"initDash",value:function(e){var t=this;this.dash=e,this.bindPlayInterfaceEvent();var r=this.config;r.dashOpts.dynamic_video.dynamic_video_list.length>0&&(this.initAbr(),r.dashOpts.dynamic_video.dynamic_video_list.sort((function(e,t){return t.vheight-e.vheight})),r.dashOpts.dynamic_video.dynamic_video_list.forEach((function(e,n){e.definition===r.defaultDefinition&&(t.dash.selectedIdx=n)})),this.dashVideoEncrypted=r.dashOpts.dynamic_video.dynamic_video_list.some((function(e){return!!e.kid}))),r.dashOpts.dynamic_video.dynamic_audio_list.length>0&&(this.dashAudioEncrypted=r.dashOpts.dynamic_video.dynamic_audio_list.some((function(e){return!!e.kid})))}},{key:"isDashCanUse",get:function(){return this.__isDashCanUse},set:function(e){this.__isDashCanUse=e}},{key:"bindPlayInterfaceEvent",value:function(){var e=this._pluginInst,t=e.player,r=e.config;util$1.on(t,"DRM_ERROR",(function(){t.emit("playInterfaceInfo",r.dashOpts||{})}),"dashDestroy");util$1.on(t,"NO_MEDIALIST",(function(){t.emit("playInterfaceInfo",r.dashOpts||{})}),"dashDestroy")}},{key:"isEnded",value:function(){var e=this.dash,t=this.player,r=this.mse,n=this.config;if("vod"===e.type)if(t.ended)debug$2.log("player.ended === true"),"safari"===sniffer$1.browser&&(t.pause(),t.emit("ended"));else{var i=n.duration||t.duration||e.mpd.duration;if(t.duration&&(i=Math.min(i,t.duration)),e.mpd.duration&&(i=Math.min(i,e.mpd.duration)),i-this._minDuration<10&&(i=Math.min(i,this._minDuration)),i>0&&i-t.currentTime<DEFAULT_END){var a=this._findRangeForPlaybackTime(t.currentTime)||{start:0,end:0};debug$2.log("range",a,"current",t.currentTime,"duration",i);var o=Math.min(a.end,t.duration),s=t.currentTime-o>=0&&a.end>0,l=o-t.currentTime<DEFAULT_END&&a.end>0;(s||l)&&(debug$2.log("isEnded execute, isOver",s,"isClosed",l),r.endOfStream(),this.clearProgressTimer())}}}},{key:"dashDestroy",value:function(){var e=this.player,t=this.dash;for(var r in t&&t.mse&&t.mse.destroy(),t&&t.eme&&(t.eme.emit("destroy"),t.eme.destroy()),t&&e.errorHandler&&(t.abortLoadingTasks(),t.emit("destroy")),t&&t.mpd&&t.mpd.timer&&(clearTimeout(t.mpd.timer),t.mpd.timer=null),this.crypto&&this.crypto.destroy(),t&&t.destroy(),this.clearCheckCanplayTimer(),this.clearProgressTimer(),this.destroyAbr(),this.gapJumpInst&&this.gapJumpInst.destroy(),e&&(e.__dash__=null,this._pluginInst.unloadVideo(),"function"==typeof e.video.setMediaKeys&&e.video.setMediaKeys(null)),t)delete t[r];for(var n in this)delete this[n]}},{key:"bindComEvent",value:function(){var e=this;this._lastSeekTime=null;var t=this.player,r=this.config;util$1.on(t,"error",e.clearProgressTimer.bind(e),"dashDestroy"),util$1.on(t,"ended",e.clearProgressTimer.bind(e),"dashDestroy");util$1.on(t,"timeupdate",(function(){e.isDashCanUse&&r.dashOpts&&e.mse&&e.isEnded()}),"dashDestroy");var n=function(){var n=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function n(){var i,a,o,s,l;return _regeneratorRuntime$7().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(debug$2.log("dash onSeeking"),e.isDashCanUse&&r.dashOpts){n.next=3;break}return n.abrupt("return");case 3:if(!t.ended){n.next=7;break}return"function"==typeof t.replayFunc&&t.replayFunc(),n.abrupt("return");case 7:if(i=t.getBufferedRange(t.buffered)[1],!(a=0===i)||e.switching){n.next=14;break}return debug$2.log("dash cancel loading task"),n.next=13,e.dash.abortLoadingTasks();case 13:e.mse.abort(CONTENT_TYPES.VIDEO);case 14:e.mse.isFull?a?e.clearBufferByTime(0,t.duration):e.clearBuffer(!0):a||e.clearBufferByTime(i,t.duration),o=r.useDurationBackoff||!1,s=Date.now()/1e3,l=t.duration-t.currentTime<1,o&&l&&(!this._lastSeekTime||this._lastSeekTime<s-1)&&(this._lastSeekTime=s,t.currentTime=t.duration-1),e.gapJumpInst&&e.gapJumpInst.onSeeking();case 20:case"end":return n.stop()}}),n,this)})));return function(){return n.apply(this,arguments)}}();util$1.on(t,"seeking",n,"dashDestroy");util$1.on(t,"seeked",(function(){debug$2.log("dash onSeeked"),e.isEnded()}),"dashDestroy"),util$1.on(t,"dashDestroy",e.dashDestroy.bind(this))}},{key:"destroy",value:function(){this.player.emit("dashDestroy")}},{key:"getMetaData",value:function(){var e=this,t={};return["video","audio"].forEach((function(r){var n=e.dash.mpd.mediaList[r],i=n[n.selectedIdx];t[r]={bandwidth:i.bandwidth,mimeType:i.mimeType,codecs:i.codecs,definition:i.definition,width:i.width,height:i.height,mediaDuration:i.mediaDuration,timescale:i.timescale}})),t}},{key:"_findRangeForPlaybackTime",value:function(e){var t,r=this.player,n=this.config;if(n.useBuffered2){var i=n.maxHoleDuration;if(!(t=r.buffered2))return;for(var a=0;a<t.length;a++){var o=t.start(a),s=t.end(a);if(e+i>=o&&e<s)return{start:o,end:s}}}else{if(!(t=r.buffered))return;for(var l=0;l<t.length;l++)if(util$1.round(t.start(l))<=util$1.round(e)&&util$1.round(t.end(l))>=util$1.round(e))return{start:util$1.round(t.start(l)),end:util$1.round(t.end(l)),rawStart:t.start(l),rawEnd:t.end(l)}}}},{key:"loadData",value:function(e){var t=this,r=this.player,n=this.config;if(!t.switching&&t.dash){var i,a=n.maxBufferLength||n.preloadTime||DEFAULT_PRELOAD_TIME,o=t.dash.mpd.mediaList.video;if(o&&o.length>0&&o[o.selectedIdx]){var s=o[o.selectedIdx].bandwidth;s<6e6&&(a*=2),i=o[o.selectedIdx].definition||this.bandwidth2item[s].definition}if(n.dynamicPreloadTimeOpts&&i){var l=n.dynamicPreloadTimeOpts[i];l&&(a=l)}t.preloadTime!==a&&(t.preloadTime=a,debug$2.log("maxCacheTimeAudio change",a),r.emit(ABR_EVENTS.MAX_BUFFER_CHANGE,{videoCacheTime:a,audioCacheTime:a})),e||(e=r.currentTime);var u=this._findRangeForPlaybackTime(e),c=r.duration+100;if(u&&u.end&&!t.isCurrentInAbr()){var d=t.dash.mpd.mediaList;["video","audio"].forEach((function(t){if(d[t].length<1)return!0;for(var r=d[t][d[t].selectedIdx].mediaSegments,n=0;n<r.length;n++)if(!(r[n].end<=e||r[n].start>=u.end||r[n].downloaded)&&c>r[n].start){c=r[n].start;break}}))}var h=c<=r.duration?c:u&&Math.ceil(Math.max(u.end,u.rawEnd))||Math.floor(e),f=r.duration<n.minBufferLength,p=r.currentTime+(f?r.duration/3:n.minBufferLength);n.preloadTime&&(p=r.currentTime+n.preloadTime*n.preloadBufferThreshold);var y=!1;if(this._pluginInst.preloadManager){var m=this._pluginInst.preloadManager;y=m._preloadDataList.length>0||null!==m._currentPreloadInst}h>p&&y&&r.emit(PRELOAD_NEXT$2);var g=n.preloadCancelTime;h<e+g&&y&&r.emit("PRELOAD_CANCEL"),h>e+a||t.dash.seek(h,r.currentTime)}}},{key:"startCheckCanplayTimer",value:function(){var e=this,t=this.player,r=this.config;if(t&&e&&!r.disableCanplayCheck){e.checkCanplayTimer=new IntervalTimer$1,e.checkCanplayTimer.repeat((function(){t&&e&&e.isDashCanUse&&e.checkCanplayTimer&&t.errorHandler&&(t.enterIsHide?(debug$2.log(""),e.dashNoCanplay=0,e.clearCheckCanplayTimer()):e.dashNoCanplay||"visible"!==document.visibilityState||(e.dashNoCanplay=1,debug$2.log("".concat(DASH_NO_INITSEGMENT,"init")),e.dashNoCanplayTimer=setTimeout((function(){e.dashNoCanplayTimer=null,1===e.dashNoCanplay&&!1===t.enterIsHide&&(t.dashState!==START_PLAY?(e.dashNoCanplay=2,debug$2.log("init"),e.clearCheckCanplayTimer(),t.errorHandler(new Errors(Errors.CANPLAY,Errors.NO_CANPLAY_ERROR,{line:1021,handle:"[DASH] start play",msg:"start play no canplay"}))):r.disableDashNoCanplayCheck||(debug$2.log("".concat(DASH_NO_CANPLAY-DASH_NO_INITSEGMENT,"")),e.dashNoCanplayTimer=setTimeout((function(){e.dashNoCanplayTimer=null,1===e.dashNoCanplay&&!1===t.enterIsHide&&(e.dashNoCanplay=2,debug$2.log(""),e.clearCheckCanplayTimer(),t.errorHandler(new Errors(Errors.CANPLAY,Errors.NO_CANPLAY_ERROR,{line:1021,handle:"[DASH] start play",msg:"start play no canplay"})))}),DASH_NO_CANPLAY-DASH_NO_INITSEGMENT)))}),DASH_NO_INITSEGMENT)))}),r.progressTimer||DEFAULT_PROGRESS_TIMER)}}},{key:"clearCheckCanplayTimer",value:function(){var e=this;e&&(e&&e.checkCanplayTimer&&(e.checkCanplayTimer.clear(),e.checkCanplayTimer=null),e.dashNoCanplayTimer&&(clearTimeout(e.dashNoCanplayTimer),e.dashNoCanplayTimer=null,e.dashNoCanplay=void 0))}},{key:"handleUrlExpire",value:function(){this._pluginInst.handleUrlExpire(this)}},{key:"clearBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this,r=this.player;if(t.isDashCanUse&&t.mse){debug$2.log("clearBuffer");var n=r.currentTime,i=this._findClosetGop(n,!1);if(i&&t.clearBufferByTime(0,i),e){var a=this._findClosetGop(n,!0);t.clearBufferByTime(a,r.duration)}}}},{key:"_findClosetGop",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.dash.mpd.mediaList.video,i=n[n.selectedIdx].mediaSegments;if(t){for(var a=0,o=0;o<i.length;o++)if(i[o].start>e&&++a>r)return i[o].start}else for(var s=0,l=i.length-1;l>-1;l--)if(i[l].end<e&&++s>r)return i[l].end}},{key:"clearBufferByTime",value:function(e,t){var r=this;debug$2.log("clearBufferByTime start: ".concat(e," end: ").concat(t)),r.dash.mpd.mediaList.video.length>0&&r.mse.removeBuffer(CONTENT_TYPES.VIDEO,e,t).catch((function(){})),r.dash.mpd.mediaList.audio.length>0&&r.mse.removeBuffer(CONTENT_TYPES.AUDIO,e,t).catch((function(){})),r.dash.mpd.clearBuffer(e,t)}},{key:"clearProgressTimer",value:function(){var e=this;e&&(e.isDashCanUse&&e.dash.mse&&e.dash.mse.progressTimer&&(e.dash.mse.progressTimer.clear(),e.dash.mse.progressTimer=null),e.dashBufferBreakTimer&&(clearTimeout(e.dashBufferBreakTimer),e.dashBufferBreakTimer=null,e.dashBufferBreak=void 0))}},{key:"emitMenuResolutionChange",value:function(){var e=this.player;try{var t=this.dash.mpd.mediaList.video;if(t){var r=t[t.selectedIdx],n={width:r.width,height:r.height};e.emit("RESOLUTION_UPDATE",n)}else e.emit("RESOLUTION_UPDATE")}catch(error){e.emit("RESOLUTION_UPDATE")}}},{key:"updateDashType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=proxyLocalStorage$1.getItem(URL_DASH_TAG),n=DASH_TYPE;e=t||r===n.BACK?n.MAIN:n.BACK,proxyLocalStorage$1.setItem(URL_DASH_TAG,e)}},{key:"changeMainBackUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:CHANGE_STATES$1.INIT,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t&&this._pluginInst){var r=this._pluginInst.config,n=proxyLocalStorage$1.getItem(URL_DASH_TAG),i=!1,a=DASH_TYPE;if((e===CHANGE_STATES$1.INIT&&n===a.BACK||e===CHANGE_STATES$1.ERR)&&(i=!0),debug$2.log("curDashType",n,"changeState",e,"needChange",i),i){var o=r.dashOpts.dynamic_video.main_url,s=r.dashOpts.dynamic_video.backup_url_1;r.dashOpts.dynamic_video.main_url=s,r.dashOpts.dynamic_video.backup_url_1=o,util$1.exchangeListUrl(r.dashOpts.dynamic_video.dynamic_video_list),util$1.exchangeListUrl(r.dashOpts.dynamic_video.dynamic_audio_list)}var l=r.dashOpts.dynamic_video.main_url;return this._checkUrlRange(l),r}}},{key:"_checkUrlRange",value:function(e){var t=this._pluginInst.config,r=t.url_range_domains||[],n=util$1.validateUrlRange(r,e);t.useUrlRange=n}},{key:"updateAutoDefiDesc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this.player,a=this.config,o=a.autoBitrateOpts||{},s=o.autoDefiText||"auto";i.emit("ABR_AUTO_DESC_CHANGE",s,t?void 0:e,r,n),t||this._pluginInst.setCurrentDefitionInfos(" ".concat(e),n)}},{key:"_startLoadInitSegment",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new ProxyPromise$1,i=this,a=this.dash,o=this.config,s=a.mpd.mediaList.video,l=s.selectedIdx;return s.every((function(a,u){if(a.id===e){t.abrInstance&&t.abrInstance.updateBitrate(i.defiIdMap[e].bitrate),r&&(t.lastDefiIdx=e),l=u,i.selectedIdx=u,o.defaultDefinition=s[i.selectedIdx].definition,i.switching=!0;var c=s[l].wrapperData;return c?((i.dashVideoEncrypted||i.dashAudioEncrypted)&&!1===o.useEME&&i.crypto&&i.crypto.updateHeaderId(),n.resolve(c)):i._makeInitSegemntRequestWithRetry("video",l).then((function(e){n.resolve(e)})).catch((function(e){debug$2.log("_makeInitSegemntRequestWithRetry",e)})),!1}return!0})),n}},{key:"abrSwitchURL",value:function(e){var t=this;this._pluginInst.info({msg:"abr switch",data:e});var r=this.dash,n=this.player,i=this.config;e=e.split("/")[e.split("/").length-1],this._startLoadInitSegment(e).then(function(){var e=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(a){var o,s,l,u,c;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.mpd.mediaList.video,e.next=3,t._switch(a.newIdx);case 3:if(s=e.sent,l=n.getBufferedRange(i.useBuffered2?n.buffered2:n.buffered)[1],u=o[s].mediaSegments.find((function(e){return e.start-l>=0}))){e.next=8;break}return e.abrupt("return");case 8:c=0===l?n.currentTime:(u.start+u.end)/2,t._appendInitSegment("video",a,a.newIdx).then((function(){t.switching=!1,t.loadData(c,MPD_SEEK_TYPE.SEEK)})).catch((function(e){debug$2.log("appendInitSegment",e)}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){debug$2.log("startLoadInitSegemnt",e)}))}},{key:"_switch",value:(n=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var r,n,i,a;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.dash,n=r.mpd.mediaList.video,i=n.selectedIdx,n.selectedIdx=t,this.mse.abort(CONTENT_TYPES.VIDEO),e.next=7,r.abortLoadingTasks();case 7:return n[i].mediaSegments.every((function(e){return e.downloaded=SEGMENT_STATE.NO_START,!0})),(a=r.mpd.mediaList.audio)[a.selectedIdx]&&a[a.selectedIdx].mediaSegments&&a[a.selectedIdx].mediaSegments.forEach((function(e){e.downloaded===SEGMENT_STATE.GOING&&(e.downloaded=SEGMENT_STATE.NO_START)})),r.mpd.syncAV(),e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_handleInitData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.dash,a=new ProxyPromise$1,o=e instanceof ArrayBuffer;if(o){var s=0===t.length?e:e.slice(t[0],t[1]+1),l=null===r?null:e.slice(r[0],r[1]+1),u=i.mpd.videoCodecType;!1===i.useEME&&this.crypto?this.crypto.decryptHeader(s,u).then((function(t){var r=i.useEME?s:t.data;a.resolve({initSegmentRes:r,data:e,sidxSegmentRes:l,vid:t.vid,headers:n})})):a.resolve({initSegmentRes:s,data:e,sidxSegmentRes:l,vid:null,headers:n})}else;return a}},{key:"_appendInitSegment",value:function(e,t,r){var n=this,i=this.player,a=this.config.duration;this.dash.mpd.duration>0&&(a=this.dash.mpd.duration);var o=new ProxyPromise$1,s=this.dash.mpd.mediaList[e],l=t.initSegmentRes,u=t.sidxSegmentRes;return t.fromCache||(t.fromCache=!0,s[s.selectedIdx].wrapperData=t,u&&this.dash.mpd.getSidx(u,e,r,a)),this.mse.appendBuffer(e,l,{mediaType:e,index:r}).then((function(){if(n._pluginInst.info({msg:"appendInitSegment",data:{mediaType:e,index:r}}),s[s.selectedIdx].inited=!0,o.resolve(),"video"===e){n.curVideoInitSegmentIdx=r;var t=n._findClosetGop(i.currentTime,!0,0);n.dash.mpd.clearBuffer(t,i.duration,"video")}})).catch((function(e){e&&e.message===ERROR_TYPES$2.MSE_OP_FAIL&&i&&i.emit(new Errors(Errors.MSE,Errors.MSE_PARSE_ERROR,{line:800,handle:"[DASH] appendInit",msg:e.message}))})),o}},{key:"_makeInitSegemntRequest",value:(r=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(){var t,r,n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v=arguments;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=v.length>0&&void 0!==v[0]?v[0]:"video",r=v.length>1&&void 0!==v[1]?v[1]:0,n=this.dash,i=this.config,a=new ProxyPromise$1,o=n.mpd&&n.mpd.mediaList[t][r],s=[],l="",o){e.next=11;break}return a.reject({mediaType:t,index:r,initSegmentRange:s,url:l,rejected:!0}),debug$2.log("initSegmentRequest error"),e.abrupt("return",a);case 11:return s=(o.initSegmentRange||[]).concat(),(u="segment_base"===n.mpd.dashType)&&(s[1]=o.sidxRange[1]),l=o.initSegment,c="video"===t&&(o.definition||this.bandwidth2item[o.bandwidth].definition),this._checkUrlRange(l),d={mediaType:t,vid:i.vid,definition:"video"===t?c:void 0,useUrlRange:i.useUrlRange,timeout:-1,bitrate:o.bandwidth||o.bitrate,initSegment:!0},e.next=20,n.getData(l,s,t,d);case 20:return h=e.sent,f=h.res,p=h.headers,y=h.status,m=h.readyState,g=h.fromCache,f&&"error"!==f?this._handleInitData(f,o.initSegmentRange,u?o.sidxRange:null,p).then((function(e){e.newIdx=r,e.mediaType=t,e.initSegmentRange=s,e.cache=g,e.definition=d.definition,a.resolve(e)})):a.reject({mediaType:t,index:r,initSegmentRange:s,url:l,rejected:!0,reason:f,status:y,readyState:m}),e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_makeInitSegemntRequestWithRetry",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.handleUrlExpire();var i=new ProxyPromise$1;return n&&this._pluginInst._kernal.setNodeTime("init".concat(t,"_metastart")),this._makeInitSegemntRequest(t,r).then((function(a){e._pluginInst.info({msg:"initSegmentRequest succ"}),n&&e._pluginInst._kernal.setNodeTime("init".concat(t,"_metadone"),"init".concat(t,"_metastart"),{fromCache:a.cache,byteLength:a.data.byteLength,mediaType:t,index:r,definition:a.definition}),i.resolve(a)}),(function(e){i.reject(new Errors(Errors.NETWORK,Errors.INIT_SEGMENT_ERROR,{line:329,msg:"initsegment fail",mediaType:t,index:r,error:e.message?e.message:e}))})).catch((function(e){i.reject(new Errors(Errors.NETWORK,Errors.INIT_SEGMENT_ERROR,{msg:"initsegment fail",error:e.message,mediaType:t,index:r}))})),i}},{key:"updateAbrCacheData",value:function(e,t,r){var n=this.dash,i=this.config,a=i.autoBitrateOpts||{},o=n.mpd.mediaList.video,s=r.definition,l=i.definitionText&&i.definitionText[s]||s,u=o[e],c=r.bitrate;this.bitrateMap[c]={url:u.id,definition:s,definitionName:l},this.defiIdMap[u.id]={bitrate:c,definition:s},e===o.length-1&&this.isOpenAutoDefi&&this.definitions.push({name:a.autoDefiText||"auto",url:AUTO_FLAG,selected:t,definition:"",fps:void 0})}},{key:"destroyAbr",value:function(){var e=this,t=this.player;e.abrInstance&&(t&&t.off(ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange),e.abrInstance.destroy(),e.abrInstance=null)}},{key:"initAbr",value:(t=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(){var t,r,n,i;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,r=this.player,n=this.config,util$1.on(r,ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange,"dashDestroy"),this.bitrateMap={},this.defiIdMap={},i=LOGOPEN,t.abrInstance=new ABR(r,n,0,n.dashOpts.dynamic_video,5e3,{logger:debug$2.abr,openLog:i}),util$1.once(r,ABR_EVENTS.ABR_START_PROGRESS,this.startProgressTimer,"dashDestroy"),t.abrInstance.onAbrChange=function(e,n,i,a){var o=t.bitrateMap[e],s=t.bitrateMap[n],l=o.definition,u=s.definition;debug$2.abr("abr change prevD:",l,"curDef:"+u),l!==u&&(t.abrSwitchURL(s.url),r.emit("ABR_CHANGE",{prev:l,cur:u,prevName:o.definitionName,curName:s.definitionName,abrInfo:a}))},util$1.on(r,ABR_EVENTS.ABR_CHANGE,t.abrInstance.onAbrChange,"dashDestroy"),t.abrInstance.isCurrentInAbr=this.isCurrentAutoDefi;case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"isCurrentInAbr",value:function(){return!!this.abrInstance&&this.abrInstance.isCurrentInAbr}}]),e}(),CHANGE_STATES=CHANGE_STATES$2,DashKernal=function(){function e(t){var r=this;_classCallCheck$c(this,e),_defineProperty$c(this,"start",function(){var e=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var n,i,a,o,s,l;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r._checkHasDestroy("start")){e.next=2;break}return e.abrupt("return");case 2:if(r.setNodeTime("newplayer_start"),n=Date.now(),i=r.__dash__,a=r._pluginInst,o=a.player,s=a.config,o.dashState=PLAYER_START,o.emit("dashStateChange",PLAYER_START),t||(t=o.config.url="anytext"),l=new DASH(t,r._pluginInst,i),i){e.next=13;break}return r._info({msg:"__dash__ is null, dashOpts",startMs:n,name:"start __dash__"}),e.abrupt("return");case 13:if(i.initDash(l),!i.dashVideoEncrypted&&!i.dashAudioEncrypted){e.next=26;break}return debug$2.log(""),s.useEME=isEMESupported$1(),s.useEME||(i.crypto=new Crypto$1),s.intertrustServerURL&&(s.useEME=!0),l.useEME=s.useEME,i.awManager=new AwManager$1,e.next=23,i.awManager.init();case 23:r._info({msg:"encrypt video ready useEME ".concat(l.useEME)}),e.next=28;break;case 26:debug$2.log(""),r._info({msg:" no encrypt video ready"});case 28:return o.dashState=WASM_START,o.emit("dashStateChange",WASM_START),e.next=32,r._onWasmReady({url:t});case 32:r._info({msg:"info player start execute",startMs:n,name:"start",profile:!0});case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty$c(this,"_errorHandler",(function(e){if(!r._checkHasDestroy("errorHandler")){var t=r._pluginInst,n=t.player,i=t.config,a=e;if("string"==typeof e){if(n.video.error&&2===n.video.error.code)e=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES.timeout,{},n);else{var o=n.video.error&&n.video.error.code||0;e=new Errors(o>0?Errors.MEDIA:Errors.OTHER,o,{},n)}e.msg=a,n.video.error&&(e.msg+=";code"+n.video.error.code+"; details: "+n.video.error.message)}if(r._info({msg:"dashKernal error",data:e,add:!0}),("network"!==e.errorType||!i.disableNetworkError)&&e&&n.dashState!==ERROR_HANDLER){n.dashState=ERROR_HANDLER,e.vid=i.vid,e.url=n.src;var s=r.__dash__,l=s&&s.isCurrentAutoDefi;if(e.errd&&"object"===_typeof$8(e.errd)&&s&&s.dash&&(e.errd.url=s.dash.url,e.url=s.dash.url),e.url&&e.url.indexOf("blob:")>-1&&i.dashOpts&&i.dashOpts.dynamic_video&&(e.url=i.dashOpts.dynamic_video.main_url),e&&e.errorCode===Errors.NETWORK_DISCONNECT)n.emit("error",e);else{if(n.emit("DATA_REPORT",e),e&&e.errorCode===Errors.CDM_LICENSE_ERROR)return r._pluginInst.destroyKernal(),void n.emit("error",e);if(e&&e.errorCode===Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED)r._handleDegradeToMp4(e);else{if(e.segmentExpired||e.msg===TASK_REQUEST_EXPIRED)return s&&s.abrInstance&&"function"==typeof s.abrInstance._stop&&(s.abrInstance._stop(),debug$2.abr("error stop","expired",e.segmentExpired,e.ex)),void r._pluginInst.emitExpireEvent(e);if(!e.curReqVideoSegInfo&&s&&(e.curReqVideoSegInfo=JSON.parse(JSON.stringify(s.curReqVideoSegInfo||{}))),e.headers||(e.headers=e.curReqVideoSegInfo.headers||{}),!!i.useBackUrl&&!r._pluginInst._hasUsedBackUrl&&i.dashOpts&&i.dashOpts.dynamic_video&&s){debug$2.log("backup replay");var u=s.changeMainBackUrl(CHANGE_STATES.ERR,r._pluginInst._hasUsedBackUrl);return s.updateDashType(),l?u.autoBitrateOpts&&(u.autoBitrateOpts.isPlayAutoDefi=!0):(r.currentDefitionFromPlayer&&(u.defaultDefinition=r.currentDefitionFromPlayer.definition),u.autoBitrateOpts&&(u.autoBitrateOpts.isPlayAutoDefi=!1)),r._pluginInst._hasUsedBackUrl=!0,r._pluginInst.next(n.currentTime,"REPLAY",u,!0),void n.emit("playCatch","dash2dash_backup",e)}s&&s.updateDashType(!0),r._handleDegradeToMp4(e)}}}}})),this._pluginInst=t,this._initProfile(),this._proxyPlayer(),this._initialize()}var t,r;return _createClass$d(e,[{key:"_initProfile",value:function(){this.firstFrameTime={newplayer_initkernel:{now:util$1.nowTime(),cost:0,t:1},newplayer_start:{now:-1,cost:-1,t:2},initmpd:{now:-1,cost:-1,t:3},initmpddone:{now:-1,cost:-1,t:4},initmse_sbopen:{now:-1,cost:-1,t:5},initmse_sbopendone:{now:-1,cost:-1,t:6},initvideo_metastart:{now:-1,cost:-1,t:7,i:!0},initvideo_metadone:{now:-1,cost:-1,t:8,i:!0},initaudio_metastart:{now:-1,cost:-1,t:7,i:!0},initaudio_metadone:{now:-1,cost:-1,t:8,i:!0},metaready_initsegend:{now:-1,cost:-1,t:7},initvideo_segstart:{now:-1,cost:-1,t:8,i:!0},initvideo_segdone:{now:-1,cost:-1,t:9,i:!0},initaudio_segstart:{now:-1,cost:-1,t:8,i:!0},initaudio_segdone:{now:-1,cost:-1,t:9,i:!0},initdash:{now:-1,cost:-1,t:9,i:!0},initdashdone:{now:-1,cost:-1,t:9,i:!0}},this.firstFrameTimeTypeMap={};for(var e=Object.keys(this.firstFrameTime),t=0;t<e.length;t++){var r=this.firstFrameTime[e[t]];r.key=e[t],r.i||(this.firstFrameTimeTypeMap[r.t]=r)}}},{key:"setNodeTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this.firstFrameTime[e];if(n&&(n.now=util$1.nowTime(),r&&(n.extData=r),n.t>1)){var i=t?this.firstFrameTime[t]:this.firstFrameTimeTypeMap[n.t-1];n.cost=n.now-i.now}}},{key:"_proxyPlayer",value:function(){var e=this._pluginInst.player;this._originSwitchURL=e.switchURL,this._originErrorHandler=e.errorHandler,e.switchURL=this._switchURL.bind(this),e._startInit=this.start,e.dash=!0,e.errorHandler=this._errorHandler}},{key:"_info",value:function(e){this._pluginInst.info(e)}},{key:"_onWasmReady",value:(r=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var r,n,i,a,o,s,l,u,c,d,h,f,p,y,m=this;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,n=this._pluginInst,i=n.player,a=n.config,o=this.__dash__,s=o.dash,i.dashState=WASM_READY,i.emit("dashStateChange",WASM_READY),debug$2.log("wasm_ready"),this._info({msg:"wasm_ready"}),util$1.on(s,"error",this._errorHandler,"destroy"),o.bindComEvent(),e.prev=10,e.next=13,s.init(r);case 13:if(l=e.sent){e.next=17;break}return this._info({msg:"isDestroy ".concat(!i,", isMseNull ").concat(!l)}),e.abrupt("return");case 17:if(debug$2.time("initReady cost",(new Date).getTime()-o.startTimestamp),i.dashState=INIT_FINISHED,i.emit("dashStateChange",INIT_FINISHED),debug$2.log("dash init"),s.mpd.mediaList.video.length>0){for(a.defaultDefinition||(a.defaultDefinition=a.dashOpts.dynamic_video.dynamic_video_list[0].definition,o.lastDefiIdx=0),o.isOpenAutoDefi||(o.isCurrentAutoDefi=!1,o.abrInstance.isCurrentInAbr=!1),u=a.dashOpts.dynamic_video.dynamic_video_list,c=0;c<u.length;c++)d=u[c],o.bandwidth2item[d.bitrate]=d,o.definition2item[d.definition]=d;s.mpd.mediaList.video.sort((function(e,t){return t.height-e.height})),s.mpd.mediaList.video.forEach((function(e,t){var r=o.bandwidth2item[e.bandwidth],n=r.definition,l=!(n!==a.defaultDefinition||o.isOpenAutoDefi&&o.isPlayAutoDefi);o.definitions.push({name:a.definitionText&&a.definitionText[n]||n,url:e.id,selected:l,definition:r.definition,fps:r.fps}),e.frameRate=e.frameRate||r.fps||25;var u=r.bitrate;o.updateAbrCacheData(t,o.isPlayAutoDefi,r),n===a.defaultDefinition&&(i.emit("initialUrl",s.mpd.mediaList.video[t].baseURL),o.curBitrate=u,o.lastDefiIdx=t),l&&m._pluginInst.setCurrentDefitionInfos(r.definition,r)})),(h=o.definitions.some((function(e){return e.selected})))&&void 0!==o.lastDefiIdx||(h||(o.definitions[0].selected=!0,f=o.definitions[0].definition,this._pluginInst.setCurrentDefitionInfos(f,o.definition2item[f])),i.emit("initialUrl",s.mpd.mediaList.video[0].baseURL),o.curBitrate=a.dashOpts.dynamic_video.dynamic_video_list[0].bitrate,o.lastDefiIdx=0),i.emit("resourceReady",o.definitions,a.dashOpts.dynamic_video.dynamic_video_list),o.abrInstance.updateBitrate(o.curBitrate)}this._pluginInst.originStartInit.call(i,l.url),debug$2.time("start call cost",(new Date).getTime()-o.startTimestamp),i.dashState=CORE_START,i.emit("dashStateChange",CORE_START),o.startCheckCanplayTimer(),o.isDashCanUse=!0,o.mse=l,o.emitMenuResolutionChange(),"safari"===sniffer$1.browser&&(util$2.addClass(i.root,"canplay"),p=function(){util$2.removeClass(i.root,"xgplayer-is-enter")},util$1.once(i,"waiting",p)),y=function(){var e=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(){return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m._checkHasDestroy("onStartPlay")){e.next=2;break}return e.abrupt("return");case 2:if(i.emit("dash_start_play"),m._info({msg:"dash_start_play"}),i.dashState=START_PLAY,m._info({msg:"START_PLAY ready"}),i.emit("dashStateChange",START_PLAY),i.emit("playInterfaceInfo",a.dashOpts||{}),!o.abrInstance){e.next=12;break}return e.next=11,o.abrInstance.init(s.mpd.mediaList);case 11:o.abrInstance.execute();case 12:o.isCurrentAutoDefi||debug$2.time("onStartPlay cost not abr",(new Date).getTime()-o.startTimestamp),o.startProgressTimer(),debug$2.time("onStartPlay cost",(new Date).getTime()-o.startTimestamp);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),util$1.once(s,"start_play",y),this._info({msg:"START_PLAY dashready"}),i.emit("dashready"),e.next=40;break;case 37:e.prev=37,e.t0=e.catch(10),i.errorHandler(e.t0);case 40:case"end":return e.stop()}}),e,this,[[10,37]])}))),function(e){return r.apply(this,arguments)})},{key:"_initialize",value:function(){this.setNodeTime("newplayer_initkernel"),debug$2.log("dashKernal");var e=this._pluginInst,t=e.player,r=e.config;if(!r.dashOpts)return console.error("dashOpts in plugin config miss"),void this._info({msg:"dashOpts is null",startMs:Date.now(),name:"_initialize",add:!0});r.dashOpts.Data&&"TOP"===r.playInfoType&&this._playInfoInit(),r.dashOpts.dynamic_video&&(r.dashOpts.dynamic_video.dynamic_video_list=r.dashOpts.dynamic_video.dynamic_video_list||[],r.dashOpts.dynamic_video.dynamic_audio_list=r.dashOpts.dynamic_video.dynamic_audio_list||[],[r.dashOpts.dynamic_video.dynamic_video_list,r.dashOpts.dynamic_video.dynamic_audio_list].forEach((function(e){e.forEach((function(e){e.bitrate=parseInt(e.real_bitrate||e.bitrate)}))})));var n=CHANGE_STATES$2,i=new __DASH__({pluginInst:this._pluginInst});this.__dash__=i;var a=MSE$1.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"');a?i.changeMainBackUrl(n.INIT,this._hasUsedBackUrl):(this._info({msg:"isCodecSupported ".concat(a),add:!0}),t.errorHandler(new Errors(Errors.MSE,Errors.MSE_MEDIA_TYPES_NOT_SUPPORTED,{msg:"init"})))}},{key:"_switchURL",value:(t=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var r,n,i,a,o,s=this,l=arguments;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(l.length>1&&void 0!==l[1])||l[1],n=this.__dash__,i=this._pluginInst,a=i.config,o=i.player,(t=t.split("/")[t.split("/").length-1])!==AUTO_FLAG){e.next=10;break}return n.abrInstance.start(),n.isCurrentAutoDefi=!0,n.abrInstance.isCurrentInAbr=!0,setTimeout((function(){n.abrInstance._onTimeUpdate(null,!0)})),e.abrupt("return");case 10:n.isCurrentAutoDefi&&(n.updateAutoDefiDesc("",!0),n.isCurrentAutoDefi=!1,n.abrInstance.isCurrentInAbr=this.isCurrentAutoDefi),r&&n.abrInstance.stop(!0),n._startLoadInitSegment(t,!0).then(function(){var e=_asyncToGenerator$9(_regeneratorRuntime$7().mark((function e(t){var r,i,l,u,c,d,h,f,p,y;return _regeneratorRuntime$7().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s._checkHasDestroy("startLoadInit")){e.next=2;break}return e.abrupt("return");case 2:if(n.selectedIdx===t.newIdx){e.next=5;break}return debug$2.log("definitionSwitchTime cancel, current:",n.selectedIdx,"self",t.newIdx),e.abrupt("return");case 5:return r=n.dash,i=r.mpd.mediaList.video,e.next=9,n._switch(t.newIdx);case 9:l=e.sent,u=o.currentTime,c=null,c=i[l||0].mediaSegments.find((function(e){return e.start-u>6})),d=!1,c||(h=i[l||0].mediaSegments,c=h[h.length-1],d=!0),f=util$1.round(c.start+1),p=util$1.round(o.getBufferedRange(a.useBuffered2?o.buffered2:o.buffered)[1]),debug$2.log(" curTime: ".concat(u," start: ").concat(f," end: ").concat(p)),y=i[i.selectedIdx].definition,s._pluginInst.setCurrentDefitionInfos(y,n.definition2item[y]),n.isCurrentInAbr()||(debug$2.log("definitionSwitchTime emit, current",n.selectedIdx),o.emit("definitionSwitchTime",f<u?u+1:f)),p-f>0&&"safari"!==sniffer$1.browser&&!d&&(debug$2.log("removeBuffer: ".concat(f," ").concat(p)),n.mse.removeBuffer(CONTENT_TYPES.VIDEO,f,p).catch((function(){}))),n._appendInitSegment("video",t,t.newIdx).then((function(){n.switching=!1,n.loadData((c.start+c.end)/2,MPD_SEEK_TYPE.SEEK),n.emitMenuResolutionChange()}));case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_playInfoInit",value:function(){var e=this._pluginInst,t=e.config,r=e.playerConfig;t.vid=t.dashOpts.Data.VideoID||t.dashOpts.Data.Vid,r.vid=t.vid,transformTopModel(t)}},{key:"_handleDegradeToMp4",value:function(e){var t=this;if(!this._checkHasDestroy("_handleDegradeToMp4")){var r=this._pluginInst,n=r.player,i=r.config;if(i.mp4Opts&&!this._hasDegradeMp4){this._hasDegradeMp4=!0,n.dashState=ERROR_CATCHING;var a=i.startTime||n.currentTime||0;setTimeout((function(){t._checkHasDestroy("degrademp4")||(t._pluginInst._setStartTime("destroy",a,!0,!1),n.emit("playertypechange"),n.dashState=ERROR_CATCH_FINISHED,n.emit("playCatch","dash2mp4",e),i.defaultFormat="mp4",t._pluginInst.changeKernal(),n.once("canplay",(function(){var e=n.video.play();e&&e.catch((function(){}))})))}),0)}else n.dashState=ERROR_NO_MP4OPTS,n.emit("error",e)}}},{key:"abrInstance",get:function(){return this.__dash__.abrInstance}},{key:"destroy",value:function(){var e=this._pluginInst.player;this.__dash__&&(this.__dash__.destroy(),this.__dash__=null),e.errorHandler=this._originErrorHandler,e._startInit=this._pluginInst._originStartInit,e.switchURL=this._originSwitchURL,this._pluginInst=null}},{key:"_checkHasDestroy",value:function(e){return!this._pluginInst&&(this._info({msg:"dashKernal destroy ".concat(e),add:!0}),!0)}},{key:"executeReady",value:function(){if(!this._checkHasDestroy("executeReady")){var e=this._pluginInst.player;util$1.once(e,"dash_start_play",(function(){e.dashState=NEXT_FINISHED,e.emit("nextEnded")}))}}},{key:"getStat",value:function(){var e=this;if(!this._checkHasDestroy("getStat")){var t={type:"dash"};if(this.__dash__&&this.__dash__.dash){t.segments=this.__dash__.dash.segment_request;var r=this.__dash__.dash.first_segment_request;this._setSegmentCost("video",r),this._setSegmentCost("audio",r)}var n={},i={};return Object.keys(this.firstFrameTime).forEach((function(t){var r=e.firstFrameTime[t];n[t]=r.cost,i[t]={now:r.now,cost:r.cost,extData:r.extData}})),t.performance=n,t.firstFrameTime=i,t.preLoadData=this.getPreloadStat(),t}}},{key:"_setSegmentCost",value:function(e,t){var r=t[e],n=r.task,i=r.taskfinish,a=r.ext,o=r.fromCache,s=r.request,l=this.firstFrameTime["init".concat(e,"_segstart")],u=this.firstFrameTime["init".concat(e,"_segdone")],c=this.firstFrameTime.metaready_initsegend;l.now=s?n:-1,l.cost=s?n-c.now:-1,u.now=s?i:-1,u.cost=s?i-n:-1,u.extData=a,u.fromCache=o}},{key:"getPreloadStat",value:function(){for(var e=["initaudio_metadone","initvideo_metadone","initaudio_segdone","initvideo_segdone"],t={length:0,byteLength:0,load:[],preload:this._pluginInst.getPreloadStat()},r=0;r<e.length;r++){var n=this.firstFrameTime[e[r]].extData;n&&n.fromCache&&n.byteLength&&(t.length+=n.byteLength,t.byteLength+=n.byteLength,t.load.push(n))}return t}}]),e}(),Mp4Kernal=function(){function e(t){var r=this;_classCallCheck$c(this,e),_defineProperty$c(this,"_errorHandler",(function(e){var t=r._pluginInst.player,n=e;if("string"==typeof e){if(t.video.error&&2===t.video.error.code)e=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES.timeout,{},t);else{var i=t.video.error&&t.video.error.code||0;e=new Errors(Errors.MEDIA,i,{},t)}e.msg=n,t.video.error&&(e.msg+=";code"+t.video.error.code+"; details: "+t.video.error.message)}r._stat.error.push({err:e});var a=(new Date).getTime()/1e3>=r.urlExpireTimestamp&&r.urlExpireTimestamp>0;r._pluginInst.info({msg:"dash mp4 kernal error happend, url expired ".concat(a),err:e}),!a||!t.video.error||4!==t.video.error.code&&2!==t.video.error.code?t.emit("error",e):r._urlExpiredWhenInit||r._mp4CheckExpire()})),_defineProperty$c(this,"_updateMp4Auto",(function(){setTimeout((function(){r._updateMp4AutoDesc()}),0)})),this._url=null,this._pluginInst=t,this._urlExpiredWhenInit=!1,this._initialize(),this._stat={type:"mp4",error:[]}}return _createClass$d(e,[{key:"start",value:function(){var e=this._pluginInst,t=e.config,r=e.player;t.defaultFormat="mp4",this._pluginInst.originStartInit.call(r,this._url),r.errorHandler=this._errorHandler,this._pluginInst.info({msg:"dash mp4 kernal start"})}},{key:"executeReady",value:function(){var e=this._pluginInst.player;e.dashState=NEXT_FINISHED,e.emit("nextEnded")}},{key:"_initialize",value:function(){var e=this;this._handleMp4Definitions(),this._getMp4Opts();var t=this._pluginInst.player;t.dash=!1,setTimeout((function(){t.emit("resourceReady",e._mp4Definitions||[],[].concat(e._RawMp4Definitions)),e._updateMp4Auto()})),this.urlExpireTimestamp&&(this._urlExpiredWhenInit=(new Date).getTime()/1e3>=this.urlExpireTimestamp&&this.urlExpireTimestamp>0,this._mp4CheckExpire())}},{key:"_handleMp4Definitions",value:function(){var e=this,t=this._pluginInst,r=t.player,n=t.config;if(n.mp4Opts){this.mp4AutoItem=null;var i=[].concat(n.mp4Opts.mp4List||[]);i.every((function(e){return!!e.bitrate}))&&i.sort((function(e,t){return t.bitrate-e.bitrate}));var a=n.mp4Opts.isOpenAutoDefi,o=n.mp4Opts.isPlayAutoDefi,s=!1;if(a){var l={};i.forEach((function(e){l[(e.definition||"").toLowerCase()]=e}));for(var u=["720p","480p","360p"],c=null,d=0;d<u.length;d++){var h=l[u[d]];if(h){c=h;break}}if(c){this.mp4AutoItem=c;var f=n.mp4Opts.autoDefiText||"",p="".concat(f,"(").concat(c.definition,")");i.push({definition:f,url:AUTO_FLAG,name:p,url_expire:c.url_expire||0,selected:!!o}),s=o}}if(i.length>0){var y=i[0].url,m=i[0].url;i.forEach((function(e){e.definition===n.defaultDefinition&&(y=e.url,m=e.url)})),a&&o&&this.mp4AutoItem&&(y=this.mp4AutoItem.url,m=AUTO_FLAG),this._mp4Url=m,this._url=y}if(!s){for(var g=0;g<i.length;g++){var v=i[g];if(n.defaultDefinition===v.definition){v.selected=!0,s=!0;break}}s||(i[0].selected=!0)}this._mp4Definitions=i.map((function(t){n.defaultDefinition===t.definition&&(e._url=t.url,o||(t.selected=!0));var r=JSON.parse(JSON.stringify(t));return r.name=n.definitionText&&n.definitionText[t.definition]||t.definition,r.url_expire=t.url_expire||0,r})),this._backup_url=this._mp4Definitions[0].backup_url,this._RawMp4Definitions=i;for(var b=!1,_=0;_<i.length;_++){var E=i[_];E.codec_type&&E.vtype&&("h264"===E.codec_type&&"mp4"===E.vtype||(b=!0))}b&&r.emit("log",{type:"oneevent",end_type:MP4_SOURCE_ERR})}}},{key:"_getMp4Opts",value:function(){var e=this._pluginInst.player,t={url:this._mp4Url,realUrl:this._url,mp4Definitions:[].concat(this._mp4Definitions)};return this._getPlayInfoTimestamp=(new Date).getTime()/1e3,t.mp4Definitions&&t.mp4Definitions.length>0&&(this.urlExpireTimestamp=t.mp4Definitions[0].url_expire||0),this._proxyPlayer(),this._destroyMp4AutoHandler(),e.on("canplay",this._updateMp4Auto),this.urlExpireTimestamp&&(this.mp4CheckExpire=this._mp4CheckExpire.bind(this),e.on("timeupdate",this.mp4CheckExpire)),t}},{key:"_proxyPlayer",value:function(){var e=this._pluginInst.player;this._originSwitchURL=e.switchURL,this._originErrorHandler=e.errorHandler,e.switchURL=this._switchURLMp4.bind(this),e.config.url=this._url}},{key:"_switchURLMp4",value:function(e){var t=this,r=this._pluginInst.player,n=e.split("/")[e.split("/").length-1]===AUTO_FLAG,i=n?this.mp4AutoItem.url:e;r.curTime=r.currentTime;var a=r.paused;this._url=n?AUTO_FLAG:e,r.ended||(r.src=i,util$1.once(r,"canplay",(function(){if(r.currentTime=r.curTime,!a){var e=r.play();void 0!==e&&e&&e.catch((function(e){}))}}))),n?this._setCurrentDefitionInfos(" ".concat(this.mp4AutoItem.definition),this.mp4AutoItem):util$1.once(r,"definitionChange",(function(e){for(var r=e.to,n=null,i=t._pluginInst.cnofig,a=0;a<i.mp4Opts.mp4List.length;a++){var o=i.mp4Opts.mp4List[a];if(o.definition===r){n=o;break}}t._setCurrentDefitionInfos("".concat(r),n)}))}},{key:"_mp4CheckExpire",value:function(){this._pluginInst.handleUrlExpire(this,!0)}},{key:"_updateMp4AutoDesc",value:function(){var e=this._pluginInst.player,t=this._url!==AUTO_FLAG||void 0;this.mp4AutoItem&&(e.emit("MP4_AUTO_DESC_CHANGE",JSON.parse(JSON.stringify(this.mp4AutoItem)),!!t||void 0),t||this._setCurrentDefitionInfos(this.mp4AutoItem.definition,this.mp4AutoItem))}},{key:"_setCurrentDefitionInfos",value:function(e,t){this._pluginInst.setCurrentDefitionInfos(e,t)}},{key:"_destroyMp4AutoHandler",value:function(){var e=this._pluginInst.player;e.off("canplay",this._updateMp4Auto),e.off("timeupdate",this._mp4CheckExpire),e.off("error",this._errorSwitchFormat)}},{key:"destroy",value:function(){var e=this._pluginInst.player;e.errorHandler=this._originErrorHandler,this._destroyMp4AutoHandler(),this._pluginInst.unloadVideo(),e.switchURL=this._originSwitchURL}},{key:"getStat",value:function(){return this._stat}}]),e}(),PRELOAD_NEXT$1=PRELOAD_NEXT$3,MEDIA_TYPES=MEDIA_TYPES$2,STATS_EVENTS=STATS_EVENTS$2,KERNAL_TYPES={MP4:"mp4",DASH:"dash",VOID:"void"},version$3="3.0.45";function getterMap(e){return{playerVersion:{get:function(){return version$3},configurable:!0},downloadSpeed:{get:function(){return Loader.currentSpeed/8/1024},configurable:!0},historyAvspeed:{get:function(){return Loader.historyAvspeed/8/1024},configurable:!0},abrInstance:{get:function(){return e.abrInstance},configurable:!0},menuCodeType:{get:function(){return e.menuCodeType},configurable:!0},playerType:{get:function(){return e.playerType},configurable:!0},supportMenus:{get:function(){return e.supportMenus},configurable:!0},CDNUrl:{get:function(){return e.CDNUrl},configurable:!0},performance:{get:function(){var t=e.stat;return t&&t.performance},configurable:!0},stat:{get:function(){return e.stat},configurable:!0},preLoadData:{get:function(){var t=e.stat;return t&&t.preLoadData?t.preLoadData:{byteLength:0}},configurable:!0}}}var _playerPlayNext$1=null,DASHPlugin=function(e){_inherits$9(r,e);var t=_createSuper$c(r);function r(){var e;_classCallCheck$c(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$c(_assertThisInitialized$9(e=t.call.apply(t,[this].concat(i))),"_hasUsedBackUrl",!1),_defineProperty$c(_assertThisInitialized$9(e),"_pendingPreloaders",[]),e}return _createClass$d(r,[{key:"initDashPlayer",value:function(e){var t=this;this._checkVideoSwitch();var r=this.config;this._hasTriggerBufferThreshold=!1,this._setArgsFromConfig(),this.lastBuffer="0,0",this._menuCodeType=null,this._setConfigDashType(),util$1.promisePolyfill(),(window.location.href.indexOf("playerInstance=true")>-1||proxyLocalStorage$1.getItem("playerInstance"))&&(void 0===window.dashPlayerInstanceList&&(window.dashPlayerInstanceList=[]),window.dashPlayerInstanceList.push(e)),this.dashPreloader=new DashPreloader(e,r,debug$2.preload,this.bitRateAdapter),e.preloader=this.dashPreloader;this._pendingPreloaders.length>0&&(this.addPreloaderList(this._pendingPreloaders),this._pendingPreloaders=[]),this._startBufferCheck(),util$1.on(e,PRELOAD_NEXT$1,(function(){t.dashPreloader.preloadNext()}),"destroy"),this.changeKernal(!1),window.addEventListener("beforeunload",this.cacheSpeed)}},{key:"_checkVideoSwitch",value:function(){var e=this.player;if(!(e.video instanceof HTMLVideoElement)){var t=util$2.createDom("video","",this.getVideoConfig(this.playerConfig));this.removeVideo=e.video,t.muted=e.video.muted,t.volume=e.video.volume,e.video=t,e.attachVideoEvents(e.video);var r=this.removeVideo.parentNode;r&&r.removeChild(this.removeVideo),this.removeVideo=null}}},{key:"getVideoConfig",value:function(e){var t=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:2,mediaType:e.mediaType||"video"},e.videoConfig,e.videoAttributes);return e.loop&&(t.loop="loop"),t}},{key:"bitRateAdapter",get:function(){var e=this.player,t=this.config;return e&&e.plugins&&t.needAutoBitrate?e.plugins.bitrateselector:null}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NEXT",r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=this.player,a=this.config;this._pendingPreloaders=[],this._pausedWhenExpiredRestart=!1,"MEDIA_EXPIRED"===t&&i.paused&&(this._pausedWhenExpiredRestart=!0),i.dashState=NEXT_START;var o=!1;if(i.isSrcVoid||!a.dashOpts&&!a.mp4Opts||i.ended||"MEDIA_EXPIRED"===t||"REPLAY"===t||i.duration&&i.currentTime<i.duration-DEFAULT_END&&(i.emit("logger_next",t),o=!0),this._hasTriggerBufferThreshold=!1,i.emit("next",t),i.emit("playertypechange"),r)for(var s in r)a[s]=r[s];this._setArgsFromConfig(),o&&this._setConfigDashType(),i.config.startTime=e,i.config.startTimeCache=e,i.config.DASHPlugin=r;var l=i.config.autoplay;this._pausedWhenExpiredRestart&&l&&(i.config.autoplay=!1,i.once("canplay",(function(){setTimeout((function(){i.config.autoplay=l,i.pause()}))}))),this._syncParameters(),this.changeKernal(!0,!0),!n&&!i.config.autoplay||this._pausedWhenExpiredRestart||i.once("canplay",(function(){if(i.video){var e=i.video.play();e&&e.catch((function(){}))}})),this._pausedWhenExpiredRestart&&(this._pausedWhenExpiredRestart=!1)}},{key:"_replay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.next(e,"REPLAY")}},{key:"startPlayHandler",value:function(e,t,r){var n=this.config;if(n.dashOpts||n.mp4Opts){var i="NEXT"===t||"REPLAY"===t;this._setStartTime(r,e,i,!0)}}},{key:"beforePlayerInit",value:function(){if(!this._hasExecuteBeforeInit){var e=this.player;BasePlugin.defineGetterOrSetter(e,getterMap(this)),this._hasExecuteBeforeInit=!0,e.isReady=!0}}},{key:"afterCreate",value:function(){var e=this;this.steps=[];var t=this.player;this._syncParameters(),t.config.nullUrlStart=!0,r.unionID&&(t.unionID=r.unionID,r.unionID=void 0),this._proxyPlayer(),this.initDashPlayer(t),this.on("xglog",(function(r){"firstFrame"===r.eventType&&debug$2.log("[xgplayer-encrypt]>>>>firstFrame ",e.playerConfig.vid,r.fvt,"stat",t.stat)}))}},{key:"info",value:function(e){var t=this.player;STATS_EVENTS&&t.emit(STATS_EVENTS.STATS_INFO,e),e.add&&this.steps.push(e)}},{key:"resetStat",value:function(){var e=this.player;STATS_EVENTS&&e.emit(STATS_EVENTS.STATS_RESET)}},{key:"_syncParameters",value:function(){var e=this.config,t=this.playerConfig,r=e.vid||t.vid;e.vid=t.vid=r,t.autoBitrateOpts=e.autoBitrateOpts}},{key:"_proxyPlayer",value:function(){var e=this,t=this.player;this._originStartInit=t._startInit,t.getPreloadInfos=this.getPreloadInfos.bind(this),t.useHooks("replay",(function(t){e._replay()})),"function"==typeof this.player.playNext&&(_playerPlayNext$1=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)}}},{key:"playNext",value:function(){for(var e=this.player,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r[0],a=r[1],o=r[2],s=r[3];e.setConfig(i),this.next(a,o,i.DASHPlugin,s)}},{key:"_setKernalType",value:function(){var e=this.config;e.dashOpts||e.mp4Opts?e.dashOpts&&e.mp4Opts?this._kernalType=e.defaultFormat:e.dashOpts?this._kernalType=KERNAL_TYPES.DASH:this._kernalType=KERNAL_TYPES.MP4:this._kernalType=KERNAL_TYPES.VOID}},{key:"changeKernal",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._setKernalType();var r=this.player;this.destroyKernal();var n=this._kernalType;n===KERNAL_TYPES.VOID?(r.isSrcVoid=!0,r.emit("playOptsVoid"),t&&r.emit("nextEnded")):(r.isSrcVoid=!1,this._setStartTime("destroy",r.config.startTime,!0,!1),n===KERNAL_TYPES.MP4?this._kernal=new Mp4Kernal(this):n===KERNAL_TYPES.DASH&&(this._kernal=new DashKernal(this))),e&&this._kernal&&(this._kernal.start(),t&&this._kernal.executeReady())}},{key:"destroyKernal",value:function(){this._kernal&&(this._kernal.destroy(),this._kernal=null)}},{key:"originStartInit",get:function(){return this._originStartInit}},{key:"_setArgsFromConfig",value:function(){var e=this.config;this._bufferThreshold=e.bufferThreshold}},{key:"setCurrentDefitionInfos",value:function(e,t){var r=t?t.fps:void 0;this._currentDefinition={definiton:e,fps:r,item:t}}},{key:"handleUrlExpire",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.config,i=this.player,a=i.paused,o=(new Date).getTime()/1e3>=e.urlExpireTimestamp&&e.urlExpireTimestamp>0;if(o&&(r||!a)&&n.getServerTime)i.serverTimeDiffPromise=i.serverTimeDiffPromise||n.getServerTime().catch((function(){return 0})),i.serverTimeDiffPromise.then((function(r){if(r&&(i.serverTimeDiff=(new Date).getTime()/1e3-r),(new Date).getTime()/1e3>=e.urlExpireTimestamp+i.serverTimeDiff){e.urlExpireTimestamp=MAX_TIMESTAMP;var n=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES[403]);t.emitExpireEvent(n)}}));else if(o){var s=new Errors(Errors.NETWORK,Errors.NETEORK_ERROR_CODES[403]);this.emitExpireEvent(s)}}},{key:"emitExpireEvent",value:function(e){var t=this.player,r=(new Date).getTime()/1e3;this.emitExpireTimestamp?r-this.emitExpireTimestamp>MIN_EXPIRE_INTERVAL&&(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),this.info({msg:"MEDIA_EXPIRED"})):(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e),this.info({msg:"MEDIA_EXPIRED"}))}},{key:"_getCurDashType",value:function(){var e=proxyLocalStorage$1.getItem(URL_DASH_TAG),t=DASH_TYPE;return e===t.BACK?e:t.MAIN}},{key:"_setCurDashType",value:function(){this._initDashType=this._getCurDashType()}},{key:"_setConfigDashType",value:function(){this._setCurDashType();var e=this.playerConfig.vodLogOpts;e&&(e.currentDashType=this._initDashType)}},{key:"addDashPreloader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dashPreloader?(this._setPreloaderLoadMode(!1),this.dashPreloader.addPreloader(e,this.config.vid||this.player.config.vid)):(console&&console.warn("dashPreloader has destroyed"),this._pendingPreloaders.push(e))}},{key:"addPreloader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addDashPreloader(e)}},{key:"_setPreloaderLoadMode",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.dashPreloader&&(this.dashPreloader.preloadManager.autoPreload=e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.dashPreloader?(this._setPreloaderLoadMode(!1),this.dashPreloader.addPreloaderList(e,this.config.vid||this.player.config.vid)):(console&&console.warn("dashPreloader has destroyed"),this._pendingPreloaders=this._pendingPreloaders.concat(e))}},{key:"addPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.addDashPreloaderList(e)}},{key:"setCodeInfo",value:function(e){var t=this.playerConfig.vodLogOpts,r=CodecsConfigMap[e],n=CodecsConfigMap[CodecsTypes.AVC],i=n.logCodeType,a=n.codecs;r&&(i=r.logCodeType,a=r.codecs),t&&(t.codec_type=i),this.menuCodeType=a}},{key:"cacheSpeed",value:function(){try{var e=Loader.historyAvspeed;e>0&&e!==1/0&&proxyLocalStorage$1.setItem(SPPED_CACHE$1,e)}catch(error){}window.removeEventListener("beforeunload",this.cacheSpeed)}},{key:"unloadVideo",value:function(){var e=this.player;try{e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(error){}}},{key:"destroy",value:function(){var e=this.player;clearInterval(this._bufferCheckTimer),this.cacheSpeed(),this.destroyKernal(),this.bitRateAdapter&&this.bitRateAdapter.destroy();var t=getterMap(this);Object.keys(t).forEach((function(t){delete e[t]})),this.player.playNext=_playerPlayNext$1,this.player.removeHooks("replay")}},{key:"_processPreloadProgress",value:function(e,t){for(var r=this.config,n=["video"],i=0;i<n.length;i++){var a=n[i],o=this.preloadManager.preloadCacheProgress({vid:r.vid,format:"dash",mediaType:a,prelaodType:e.preloadType,bitrate:e.bitrate,set_duration:e.pduration,set_size:e.size,media_type:"video"===a?MEDIA_TYPES.VIDEO:MEDIA_TYPES.AUDIO});o&&t.push(o)}}},{key:"getPreloadInfos",value:function(){var e=this.config;if(this.preloadManager&&this.preloadManager.preloadCacheProgress){var t=this.preloadManager.cachedDatas[e.vid],r=[];if(this._processPreloadProgress(t||{},r),r.length>0){var n={item_num:r.length,items:r},i={preloadInfo:n};return t&&(i.abr=1),debug$2.preload("updatePreloadCacheInfo",n),i}}return null}},{key:"getPreloadStat",value:function(){var e=this.playerConfig.vid||this.config.vid;if(this.preloadManager&&this.preloadManager._preloadCacheProgress){var t={},r=this.preloadManager.getProgressCacheKey(e,"dash","video"),n=this.preloadManager.getProgressCacheKey(e,"dash","audio");return t.video=this.preloadManager._preloadCacheProgress[r],t.audio=this.preloadManager._preloadCacheProgress[n],t}return{}}},{key:"_onBufferReachThreshold",value:function(){var e=this.player;if(e.video){for(var t=e.video.buffered,r=0,n=0,i=0;i<t.length&&(r=t.start(i),n=t.end(i),!(r<=e.video.currentTime&&e.video.currentTime<=n));i++);n-e.video.currentTime>=this._bufferThreshold&&!this._hasTriggerBufferThreshold&&(this._hasTriggerBufferThreshold=!0,e.emit("BUFFER_THRESHOLD",n-e.video.currentTime))}}},{key:"_startBufferCheck",value:function(){var e=this,t=this.player;this._bufferCheckTimer=setInterval((function(){if(t.video){for(var r=[],n=0,i=t.video.buffered.length;n<i;n++)r.push([t.video.buffered.start(n),t.video.buffered.end(n)]);r.toString()!==e.lastBuffer&&(e.lastBuffer=r.toString(),e._onBufferReachThreshold())}}),200)}},{key:"_setStartTime",value:function(e,t,r,n){var i=this,a=this.player,o=this.playerConfig,s=this.config;if(t>0||n){var l=!1,u=function(){l||(l=!0,a.currentTime=t,o.startTime=0,r&&t>0&&a.emit("setStartTime"),"mp4"===s.defaultFormat&&i.setCodeInfo(CodecsTypes.AVC))};util$1.once(a,"canplay",u,e),util$1.once(a,"playing",u,e)}}},{key:"preloadManager",get:function(){return this.dashPreloader?this.dashPreloader.preloadManager:null}},{key:"CDNUrl",get:function(){var e=this.config;if(e.dashOpts&&e.dashOpts.dynamic_video){var t=document.createElement("a");return t.href=e.dashOpts.dynamic_video.main_url,t.host}return null}},{key:"playerType",get:function(){return this.config.defaultFormat}},{key:"supportMenus",get:function(){var e="dash"===this.config.defaultFormat;return{speed:e,cdn:e,resolution:e}}},{key:"currentDefitionFromPlayer",get:function(){return this._currentDefinition}},{key:"abrInstance",get:function(){return this._kernal&&this._kernal.abrInstance?this._kernal.abrInstance:null}},{key:"menuCodeType",get:function(){return this._menuCodeType},set:function(e){var t=this.player;this._menuCodeType=e,t.emit("codecsupdate",e)}},{key:"stat",get:function(){var e=this.player;if(this._kernal&&!e.isSrcVoid){var t=this._kernal.getStat();return t.steps=this.steps,this.steps=[],e.video&&e.video.error&&(t.media={readyState:e.video.readyState,error:e.video.error.code,errorMsg:e.video.error.message}),t}return null}}],[{key:"registerPreloader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.vtype=VTYPES$2.DASH,DashPreloader.BitRateAdapter=t,new DashPreloader(null,e,console.log)}},{key:"pluginName",get:function(){return"DASHPlugin"}},{key:"defaultConfig",get:function(){return{bufferThreshold:10,defaultFormat:"dash",useEME:null,getLicenseUrl:"",intertrustServerURL:null,defaultDefinition:null,cdnHost:null,cdnBucket:null,useGapJump:!0,mediaType:void 0,useDurationBackoff:!1,useBuffered2:!1,maxHoleDuration:.5,preloadTime:void 0,maxBufferLength:void 0,minBufferLength:10,dynamicPreloadTimeOpts:null,preloadCancelTime:5,progressTimer:1e3,disableCanplayCheck:!0,disableDashNoCanplayCheck:!0,disableBufferBreakCheck:!0,definitionText:null,useUnionInfoDRM:!1,keyTokenExpiredDuration:null,keyToken:null,playDomain:null,defaultSampleDurationCheck:!1,segmentRatio:7.5,preloadBufferThreshold:.5,MaxAppendTimeout:50,vtype:VTYPES$2.DASH,focusUserDefinition:!1,useProgressiveAppend:!1,onProcessMinLen:5120}}},{key:"isEMESupported",value:function(){return isEMESupported$1()}},{key:"encryptUtils",get:function(){return isSupport$2}},{key:"DashPreloader",get:function(){return DashPreloader}},{key:"updateUnionInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return t?t.unionID=e:r.unionID=e,document.cookie="volcvui=".concat(util$1.getUnionInfo(e)),util$1.getCookieValue("volcvui")}}]),r}(BasePlugin),_assign=function(){return(_assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]])}return r}function __values(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}var Hook$1=function(){function e(){this._hooks={},this._cache=[],this._hooksCache={}}return e.prototype.on=function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))},e.prototype.once=function(e,t){var r=this;e&&t&&"function"==typeof t&&this.on(e,(function n(i){t(i),r.off(e,n)}))},e.prototype.off=function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var r=this._hooks[e].indexOf(t);-1!==r&&this._hooks[e].splice(r,1)}else this._hooks[e]=[]},e.prototype.emit=function(e,t,r){if(r){if(!e)return;-1!==this._cache.indexOf(r)?this._emit(e,t):(this._hooksCache.hasOwnProperty(r)||(this._hooksCache[r]={}),this._hooksCache[r].hasOwnProperty(e)||(this._hooksCache[r][e]=[]),this._hooksCache[r][e].push(t))}else this._emit(e,t)},e.prototype._emit=function(e,t){e&&this._hooks[e]&&this._hooks[e].length&&__spread(this._hooks[e]).forEach((function(e){try{e(t)}catch(r){}}))},e.prototype.set=function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)},e}(),isObject$4=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},isNumber$2=function(e){return"number"==typeof e&&!isNaN(e)},isString$1=function(e){return"string"==typeof e},isArray$1=function(e){return Array.isArray(e)},getIndex$1=(lastEventId=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return lastEventId+=1}),lastEventId,decrypto$1=function(e,t,r){if("string"==typeof e&&"number"==typeof t&&"number"==typeof r){var n,i=[];r=r<=25?r:r%25;var a=String.fromCharCode(r+97);n=e.split(a);for(var o=0;o<n.length;o++){var s=parseInt(n[o],r);s=1*s^t;var l=String.fromCharCode(s);i.push(l)}return i.join("")}},decodeUrl$1=function(e){return decrypto$1(e,64,25)},beforePageUnload$1=function(e){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)},getIframeUrl=function(){try{return JSON.parse(atob(window.name))||void 0}catch(e){return}},loadScript=function(e,t,r){var n=document.createElement("script");n.src=e,n.onerror=function(){r(e)},n.onload=function(){t()},document.getElementsByTagName("head")[0].appendChild(n)},isSupVisChange=function(){var e=0;return["hidden","msHidden","webkitHidden"].forEach((function(t){void 0!==document[t]&&(e=1)})),e},selfAdjust=function(e,t){void 0===e&&(e=function(){}),void 0===t&&(t=1e3);var r,n=Date.now()+t;return r=window.setTimeout((function i(){var a=Date.now()-n;e(),n+=t,r=window.setTimeout(i,Math.max(0,t-a))}),t),function(){window.clearTimeout(r)}},stringify=function(e,t,r){if(void 0===t&&(t=""),void 0===r&&(r={}),e===t)return t;var n=e;"/"===(n=n.split("#")[0].split("?")[0])[e.length-1]&&(n=n.substr(0,e.length-1)),n="/"!==t[0]?n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?)(\/[.\w-]+)*\/?$/,"$1"+t):n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?(\/[.\w-]+)*?)(\/[.\w-]+)?\/?$/,"$1/"+t);var i=Object.keys(r).map((function(e){return e+"="+r[e]})).join("&");return i.length>0?n+"?"+i:n},parseURL$1=function(e){var t=document.createElement("a");return t.href=e,t},parseUrlQuery$1=function(e){var t={};try{var r=parseURL$1(e).search;(r=r.slice(1)).split("&").forEach((function(e){var r,n,i=e.split("=");i.length&&(r=i[0],n=i[1]);try{t[r]=decodeURIComponent(void 0===n?"":n)}catch(a){t[r]=n}}))}catch(n){}return t},hashCode$1=function(e){for(var t=0,r=0,n=(e+="").length,i=0;i<n;i++)((t=31*t+e.charCodeAt(r++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t};function createCommonjsModule$1(e,t){return e(t={exports:{}},t.exports),t.exports}var js_cookie=createCommonjsModule$1((function(e,t){var r;r=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function i(){}function a(t,r,a){if("undefined"!=typeof document){"number"==typeof(a=e({path:"/"},i.defaults,a)).expires&&(a.expires=new Date(1*new Date+864e5*a.expires)),a.expires=a.expires?a.expires.toUTCString():"";try{var o=JSON.stringify(r);/^[\{\[]/.test(o)&&(r=o)}catch(u){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var l in a)a[l]&&(s+="; "+l,!0!==a[l]&&(s+="="+a[l].split(";")[0]));return document.cookie=t+"="+r+s}}function o(e,r){if("undefined"!=typeof document){for(var i={},a=document.cookie?document.cookie.split("; "):[],o=0;o<a.length;o++){var s=a[o].split("="),l=s.slice(1).join("=");r||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var u=t(s[0]);if(l=(n.read||n)(l,u)||t(l),r)try{l=JSON.parse(l)}catch(c){}if(i[u]=l,e===u)break}catch(c){}}return e?i[e]:i}}return i.set=a,i.get=function(e){return o(e,!1)},i.getJSON=function(e){return o(e,!0)},i.remove=function(t,r){a(t,"",e(r,{expires:-1}))},i.defaults={},i.withConverter=r,i}((function(){}))},e.exports=r()})),_getCookie$1=function(e,t){try{return js_cookie.get(e,{domain:t||document.domain})}catch(r){return""}},_setCookie$1=function(e,t,r,n){try{var i=n||document.domain,a=+new Date+(r||6048e5);js_cookie.set(e,t,{expires:new Date(a),path:"/",domain:i})}catch(o){}},Memory$1=function(){function e(){this.cache={}}return e.prototype.setItem=function(e,t){this.cache[e]=t},e.prototype.getItem=function(e){return this.cache[e]},e.prototype.removeItem=function(e){this.cache[e]=void 0},e.prototype.getCookie=function(e,t){return _getCookie$1(e,t)},e.prototype.setCookie=function(e,t,r,n){_setCookie$1(e,t,r,n)},e}();function isSupportLS$1(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}function isSupportSession$1(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}var local$1={getItem:function(e){try{var t=localStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(n){}return r||{}}catch(n){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,r)}catch(n){}},removeItem:function(e){try{localStorage.removeItem(e)}catch(t){}},getCookie:function(e,t){return _getCookie$1(e,t)},setCookie:function(e,t,r,n){_setCookie$1(e,t,r,n)},isSupportLS:isSupportLS$1()},session$1={getItem:function(e){try{var t=sessionStorage.getItem(e),r=t;try{t&&"string"==typeof t&&(r=JSON.parse(t))}catch(n){}return r||{}}catch(n){}return{}},setItem:function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);sessionStorage.setItem(e,r)}catch(n){}},removeItem:function(e){try{sessionStorage.removeItem(e)}catch(t){}},getCookie:function(e,t){return _getCookie$1(e,t)},setCookie:function(e,t,r,n){_setCookie$1(e,t,r,n)},isSupportSession:isSupportSession$1()},Storage$1=function(){function e(e,t){this._storage=t&&"session"===t?session$1:!e&&local$1.isSupportLS?local$1:new Memory$1}return e.prototype.getItem=function(e){return this._storage.getItem(e)},e.prototype.setItem=function(e,t){this._storage.setItem(e,t)},e.prototype.getCookie=function(e,t){return this._storage.getCookie(e,t)},e.prototype.setCookie=function(e,t,r,n){this._storage.setCookie(e,t,r,n)},e.prototype.removeItem=function(e){this._storage.removeItem(e)},e}(),UTM$1=function(e,t,r,n){var i=new Storage$1(!1),a=new Storage$1(!1,"session"),o=e?"_tea_utm_cache_"+e:"_tea_utm_cache",s=e?"_$utm_from_url_"+e:"_$utm_from_url",l={},u=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],c={ad_id:Number(t.ad_id)||void 0,campaign_id:Number(t.campaign_id)||void 0,creative_id:Number(t.creative_id)||void 0,utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_term:t.utm_term,utm_content:t.utm_content,tr_shareuser:t.tr_shareuser,tr_admaster:t.tr_admaster,tr_param1:t.tr_param1,tr_param2:t.tr_param2,tr_param3:t.tr_param3,tr_param4:t.tr_param4};try{var d=!1;for(var h in c)c[h]&&(-1!==u.indexOf(h)?(l.hasOwnProperty("tracer_data")||(l.tracer_data={}),l.tracer_data[h]=c[h]):l[h]=c[h],d=!0);if(d)a.setItem(s,"1"),i.setCookie(o,JSON.stringify(l),n,r);else{var f=i.getCookie(o,r);f&&(l=JSON.parse(f))}a.getItem(s)&&(l.hasOwnProperty("tracer_data")||(l.tracer_data={}),l.tracer_data.$utm_from_url=1)}catch(p){return c}return l},Client$1=function(){function e(e,t,r){this.appid=e,this.domain=t,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=r}return e.prototype.init=function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,n=r?parseURL$1(r).hostname:"",i=parseUrlQuery$1(window.location.href),a=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=UTM$1(this.appid,i,this.domain,this.cookie_expire);var o=this.browser(),s=this.os();return{browser:o.browser,browser_version:o.browser_version,platform:a,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:n,utm:this.utm,latest_data:this.last(r,n)}},e.prototype.last=function(e,t){var r="",n="",i="",a=location.hostname,o=!1;if(e&&t&&a!==t){r=e,n=t,o=!0;var s=parseUrlQuery$1(e);s.keyword&&(i=s.keyword)}return{$latest_referrer:r,$latest_referrer_host:n,$latest_search_keyword:i,isLast:o}},e.prototype.browser=function(){var e,t,r="",n=""+parseFloat(this.appVersion),i=this.userAgent;return-1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(r="Microsoft Edge",-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),n=i.substring(e+5)):(e=i.indexOf("Edg"),n=i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",n=i.substring(e+5)):-1!==(e=i.indexOf("Lark"))?(r="Lark",n=i.substring(e+5,e+11)):-1!==(e=i.indexOf("MetaSr"))?(r="sougoubrowser",n=i.substring(e+7,e+10)):-1!==i.indexOf("MQQBrowser")||-1!==i.indexOf("QQBrowser")?(r="qqbrowser",-1!==i.indexOf("MQQBrowser")?(e=i.indexOf("MQQBrowser"),n=i.substring(e+11,e+15)):-1!==i.indexOf("QQBrowser")&&(e=i.indexOf("QQBrowser"),n=i.substring(e+10,e+17))):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("360"))?(r="360browser",n=i.substring(i.indexOf("Chrome")+7)):-1!==i.indexOf("baidubrowser")||-1!==i.indexOf("BIDUBrowser")?(-1!==i.indexOf("baidubrowser")?(e=i.indexOf("baidubrowser"),n=i.substring(e+13,e+16)):-1!==i.indexOf("BIDUBrowser")&&(e=i.indexOf("BIDUBrowser"),n=i.substring(e+12,e+15)),r="baidubrowser"):-1!==(e=i.indexOf("xiaomi"))?-1!==i.indexOf("openlanguagexiaomi")?(r="openlanguage xiaomi",n=i.substring(e+7,e+13)):(r="xiaomi",n=i.substring(e-7,e-1)):-1!==(e=i.indexOf("TTWebView"))?(r="TTWebView",n=i.substring(e+10,e+23)):(-1!==(e=i.indexOf("Chrome"))||-1!==(e=i.indexOf("Chrome")))&&(r="Chrome",n=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("QQ"))?(r="qqbrowser",n=i.substring(e+10,e+16)):-1!==(e=i.indexOf("Safari"))&&(r="Safari",n=i.substring(e+7),-1!==(e=i.indexOf("Version"))&&(n=i.substring(e+8))):-1!==(e=i.indexOf("Firefox"))?(r="Firefox",n=i.substring(e+8)):-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("QQ"))&&(r="qqbrowser",n=i.substring(e+3,e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:r,browser_version:n}},e.prototype.os=function(){for(var e="",t="",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<r.length;n++){var i=r[n];if(i.r.test(this.userAgent)){"Mac OS X"===(e=i.s)&&this.isNewIpad()&&(e="iOS");break}}var a,o,s=function(e,t){var r=e.exec(t);return r&&r[1]?r[1]:""},l=function(e,t){var r=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+e+")","i").exec(t);return r?r.slice(1)[0]:""};switch(/Windows/.test(e)&&(t=s(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":t=l("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":(o=s(/Android ([\.\_\d]+)/,a=this.userAgent))||(o=s(/Android\/([\.\_\d]+)/,a)),t=o,e="android";break;case"iOS":t=this.isNewIpad()?l("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?t[1]+"."+t[2]+"."+(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}},e.prototype.getDeviceModel=function(e){var t="";try{if("android"===e)navigator.userAgent.split(";").forEach((function(e){e.indexOf("Build/")>-1&&(t=e.slice(0,e.indexOf("Build/")))}));else if("ios"===e||"mac"===e||"windows"===e)if(this.isNewIpad())t="iPad";else{var r=navigator.userAgent.replace("Mozilla/5.0 (",""),n=r.indexOf(";");t=r.slice(0,n)}}catch(i){return t.trim()}return t.trim()},e.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},e}(),LOG$1;LOG$1={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"};var AB_DOMAINS$1={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},LOG_URL$1=LOG$1,SDK_VERSION$1="5.0.29",SDK_USE_TYPE$1="npm",SDK_TYPE$1=SDK_USE_TYPE$1,VISUAL_EDITOR_RANGERS="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-editor-rangers.js",VISUAL_AB_CORE="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-core.js",VISUAL_AB_LOADER="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-loader.js",HOT_PIC_URL="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/heatmap-core",VISUAL_URL_INSPECTOR="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector",Types$1,DebuggerMesssge$1$1,e;e=Types$1||(Types$1={}),e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",function(e){e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready"}(DebuggerMesssge$1$1||(DebuggerMesssge$1$1={}));var Types$1$1=Types$1,undef$1=void 0,date$1=new Date,timeZoneMin$1=date$1.getTimezoneOffset(),timezone$1=parseInt(""+-timeZoneMin$1/60,10),tz_offset$1=60*timeZoneMin$1,WEBID_URL$1="/webid",TOB_URL$1="/tobid",REPORT_URL$1="/list",COOKIE_EXPIRE$1=6048e5,ConfigManager$1=function(){function e(e,t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t,this.collect=e;var r=new Client$1(t.app_id,t.cookie_domain||"",t.cookie_expire||COOKIE_EXPIRE$1).init(),n="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new Storage$1(!1,"session"),this.localStorage=new Storage$1(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var i=this.localStorage.getItem(n);i&&"1"===i?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(n,"1")),this.envInfo={user:{user_unique_id:undef$1,user_type:undef$1,user_id:undef$1,user_is_auth:undef$1,user_is_login:undef$1,device_id:undef$1,web_id:undef$1,ip_addr_id:undef$1,user_unique_id_type:undef$1},header:{app_id:undef$1,app_name:undef$1,app_install_id:undef$1,install_id:undef$1,app_package:undef$1,app_channel:undef$1,app_version:undef$1,os_name:r.os_name,os_version:r.os_version,device_model:r.device_model,ab_client:undef$1,traffic_type:undef$1,client_ip:undef$1,device_brand:undef$1,os_api:undef$1,access:undef$1,language:r.language,region:undef$1,app_language:undef$1,app_region:undef$1,ab_version:undef$1,creative_id:r.utm.creative_id,ad_id:r.utm.ad_id,campaign_id:r.utm.campaign_id,log_type:undef$1,rnd:undef$1,platform:r.platform,sdk_version:SDK_VERSION$1,sdk_lib:"js",province:undef$1,city:undef$1,timezone:timezone$1,tz_offset:tz_offset$1,tz_name:undef$1,sim_region:undef$1,carrier:undef$1,resolution:r.screen_width+"x"+r.screen_height,browser:r.browser,browser_version:r.browser_version,referrer:r.referrer,referrer_host:r.referrer_host,width:r.screen_width,height:r.screen_height,screen_width:r.screen_width,screen_height:r.screen_height,utm_term:r.utm.utm_term,utm_content:r.utm.utm_content,utm_source:r.utm.utm_source,utm_medium:r.utm.utm_medium,utm_campaign:r.utm.utm_campaign,tracer_data:JSON.stringify(r.utm.tracer_data),custom:{},wechat_unionid:undef$1,wechat_openid:undef$1}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return e.prototype.initDomain=function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=decodeUrl$1(LOG_URL$1[t])}},e.prototype.setDomain=function(e){this.domain=e},e.prototype.getDomain=function(){return this.domain},e.prototype.setAbVersion=function(e){this.ab_version=e},e.prototype.getAbVersion=function(){return this.ab_version},e.prototype.setAbData=function(e){this.ab_data=e},e.prototype.getAbData=function(){return this.ab_data||{}},e.prototype.getUrl=function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||REPORT_URL$1;break;case"webid":t=WEBID_URL$1;break;case"tobid":t=TOB_URL$1}var r="";return this.initConfig.caller&&(r="?sdk_version="+SDK_VERSION$1+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+t+r},e.prototype.set=function(e){var t=this;Object.keys(e).forEach((function(r){if(void 0!==e[r]&&null!==e[r]||t.delete(r),"evtParams"===r)t.evtParams=_assign({},t.evtParams||{},e.evtParams||{});else if("_staging_flag"===r)t.evtParams=_assign({},t.evtParams||{},{_staging_flag:e._staging_flag});else if("reportErrorCallback"===r&&"function"==typeof e[r])t.reportErrorCallback=e[r];else{var n="",i="";if(r.indexOf(".")>-1){var a=r.split(".");n=a[0],i=a[1]}n?"user"===n||"header"===n?t.envInfo[n][i]=e[r]:t.envInfo.header.custom[i]=e[r]:t.envInfo.user.hasOwnProperty(r)?["user_type","ip_addr_id"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?Number(e[r]):e[r]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?String(e[r]):e[r]:["user_is_auth","user_is_login"].indexOf(r)>-1?t.envInfo.user[r]=Boolean(e[r]):"device_id"===r&&(t.envInfo.user[r]=e[r]):t.envInfo.header.hasOwnProperty(r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r]}}))},e.prototype.get=function(e){try{return e?"evtParams"===e?this.evtParams:"reportErrorCallback"===e?this[e]:this.envInfo.user.hasOwnProperty(e)?this.envInfo.user[e]:this.envInfo.header.hasOwnProperty(e)?this.envInfo.header[e]:JSON.parse(JSON.stringify(this.envInfo[e])):JSON.parse(JSON.stringify(this.envInfo))}catch(t){console.log("get config stringify error "),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:t.message})}},e.prototype.setStore=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey)||{};if(t&&Object.keys(e).length){var r=Object.assign(e,t);this.storage.setItem(this.configKey,r)}}catch(n){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:n.message})}},e.prototype.getStore=function(){try{if(!this.configPersist)return null;var e=this.storage.getItem(this.configKey);return e&&Object.keys(e).length?e:null}catch(t){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:t.message}),null}},e.prototype.delete=function(e){try{if(!this.configPersist)return;var t=this.storage.getItem(this.configKey);t&&t.hasOwnProperty(e)&&(delete t[e],this.storage.setItem(this.configKey,t))}catch(r){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:r.message})}},e}(),Logger$6=function(){function e(e,t){this.isLog=t||!1,this.name=e||""}return e.prototype.info=function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: "+this.name+"] "+e)},e.prototype.warn=function(e){this.isLog&&console.warn("[instance: "+this.name+"] "+e)},e.prototype.error=function(e){this.isLog&&console.error("[instance: "+this.name+"] "+e)},e.prototype.throw=function(e){throw this.error(this.name),new Error(e)},e}(),AppBridge$1=function(){function e(e,t){this.collect=e,this.native=t}var t=e.prototype;return t.bridgeInject=function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}},t.bridgeReady=function(){var e=this;return new Promise((function(t,r){try{e.bridgeInject()?AppLogBridge.hasStarted((function(e){console.log("AppLogBridge is started? : "+e),e?t(!0):r(!1)})):r(!1)}catch(n){console.log("AppLogBridge, error:"+JSON.stringify(n.stack)),r(!1)}}))},t.setNativeAppId=function(e){try{AppLogBridge.setNativeAppId(JSON.stringify(e)),console.log("change bridge appid, event report with appid: "+e)}catch(t){console.error("setNativeAppId error")}},t.setConfig=function(e){var t=this;try{Object.keys(e).forEach((function(r){"user_unique_id"===r?t.setUserUniqueId(e[r]):e[r]?t.addHeaderInfo(r,e[r]):t.removeHeaderInfo(r)}))}catch(r){console.error("setConfig error")}},t.setUserUniqueId=function(e){try{AppLogBridge.setUserUniqueId(e)}catch(t){console.error("setUserUniqueId error")}},t.addHeaderInfo=function(e,t){try{AppLogBridge.addHeaderInfo(e,t)}catch(r){console.error("addHeaderInfo error")}},t.setHeaderInfo=function(e){try{AppLogBridge.setHeaderInfo(JSON.stringify(e))}catch(t){console.error("setHeaderInfo error")}},t.removeHeaderInfo=function(e){try{AppLogBridge.removeHeaderInfo(e)}catch(t){console.error("removeHeaderInfo error")}},t.reportPv=function(e){this.onEventV3("predefine_pageview",e)},t.onEventV3=function(e,t){try{AppLogBridge.onEventV3(e,t),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge",time:Date.now(),data:[{events:[{event:e,params:t}]}],code:200,status:"success"})}catch(r){console.error("onEventV3 error")}},t.profileSet=function(e){try{AppLogBridge.profileSet(e)}catch(t){console.error("profileSet error")}},t.profileSetOnce=function(e){try{AppLogBridge.profileSetOnce(e)}catch(t){console.error("profileSetOnce error")}},t.profileIncrement=function(e){try{AppLogBridge.profileIncrement(e)}catch(t){console.error("profileIncrement error")}},t.profileUnset=function(e){try{AppLogBridge.profileUnset(e)}catch(t){console.error("profileUnset error")}},t.profileAppend=function(e){try{AppLogBridge.profileAppend(e)}catch(t){console.error("profileAppend error")}},e}(),ERROR$2={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function fetch$1$1(e,t,r,n,i,a,o,s,l){try{var u=new XMLHttpRequest,c=s||"POST";u.open(c,""+e,!0),u.setRequestHeader("Content-Type","application/json; charset=utf-8"),o&&u.setRequestHeader("X-MCS-AppKey",""+o),n&&(u.withCredentials=!0),u.onload=function(){if(i){var e=null;if(u.responseText){try{e=JSON.parse(u.responseText)}catch(r){e={}}i(e,t)}}},r&&(u.timeout=r,u.ontimeout=function(){a&&a(t,ERROR$2.TIMEOUT)}),u.onerror=function(){u.abort(),a&&a(t,ERROR$2.XHR_ON)},l?u.send(t):u.send(JSON.stringify(t))}catch(d){}}var GIF_URL$1="/gif",ERROR$1$1={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},isSupportBeacon$1=function(){return!(!window.navigator||!window.navigator.sendBeacon)},encodePayload$1=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(t+="&"+r+"="+encodeURIComponent(JSON.stringify(e[r])));return"&"===t[0]?t.slice(1):t},sendByImg$1=function(e,t,r,n){try{var i,a=e.match(/\/v\d\//);i=a?a[0]:-1!==e.indexOf("/v1/")?"/v1/":"/v2/";var o=e.split(i)[0];if(!o)return void n(e,t,ERROR$1$1.NO_URL);t.forEach((function(i){var a=encodePayload$1(i),s=new Image(1,1);s.onload=function(){s=null,r&&r()},s.onerror=function(){s=null,n&&n(e,t,ERROR$1$1.IMG_ON)},s.src=""+o+GIF_URL$1+"?"+a}))}catch(s){n&&n(e,t,ERROR$1$1.IMG_CATCH,s.message)}},request$2=function(e,t,r,n,i,a,o,s){var l=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===l.indexOf("MSIE 8.0")&&-1===l.indexOf("MSIE 9.0")){if(o)return isSupportBeacon$1()?void(window.navigator.sendBeacon(e,JSON.stringify(t))?i():a(e,t,ERROR$1$1.BEACON_FALSE)):void sendByImg$1(e,t,i,a)}else sendByImg$1(e,t,i,a);fetch$1$1(e,t,r,n,i,a,"","",s)},EventCheck$1=function(){function e(e,t){this.collector=e,this.config=t,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return e.prototype.checkVerify=function(e){var t=this;if(!e||!e.length)return!1;var r=e[0];if(!r)return!1;var n=r.events,i=r.header;if(!n||!n.length)return!1;var a=!0;return n.forEach((function(e){t.checkEventName(e.event)||(a=!1,e.checkEvent=" $ or __"),t.checkEventParams(e.params)||(a=!1,e.checkParams=" $ or __")})),this.checkEventParams(i)||(a=!1),a},e.prototype.checkEventName=function(e){return!!e&&this.calculate(e,"event")},e.prototype.checkEventParams=function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),!Object.keys(t).length)return!0;for(var r in t)return!(!this.calculate(r,"params")||"string"==typeof t[r]&&t[r].length>1024&&(console.warn("params: "+r+" can not over 1024 byte, please check;"),1));return!0},e.prototype.calculate=function(e,t){return-1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||(this.regStr.test(e)?!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn(("event"===t?"event":"params")+" name: "+e+" can not start with $ or __, pleace check;"),!1):(console.warn(("event"===t?"event":"params")+" name: "+e+" is illegal, can not start with $ or __, pleace check;"),!1))},e}(),Event$3=function(){function e(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new EventCheck$1(e,t),this.cacheStorgae=new Storage$1(!0),this.localStorage=new Storage$1(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(Types$1$1.Ready,(function(){r.reportAll(!1)})),this.collect.on(Types$1$1.ConfigDomain,(function(){r.reportUrl=r.configManager.getUrl("event")})),this.collect.on(Types$1$1.Event,(function(e){r.event(e)})),this.collect.on(Types$1$1.BeconEvent,(function(e){r.beconEvent(e)})),this.collect.on(Types$1$1.CleanEvents,(function(){r.reportAll(!1)})),this.linster()},e.prototype.linster=function(){var e=this;window.addEventListener("unload",(function(){e.reportAll(!0)}),!1),beforePageUnload$1((function(){e.reportAll(!0)})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.reportAll(!0)}),!1)},e.prototype.reportAll=function(e){this.report(e),this.reportBecon()},e.prototype.event=function(e){var t=this;try{var r=__spread(e,this.cacheStorgae.getItem(this.eventKey)||[]);if(this.cacheStorgae.setItem(this.eventKey,r),this.reportTimeout&&clearTimeout(this.reportTimeout),r.length>=this.maxReport)this.report(!1);else{var n=this.reportTime;this.reportTimeout=setTimeout((function(){t.report(!1),t.reportTimeout=null}),n)}}catch(i){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:i.message})}},e.prototype.beconEvent=function(e){var t=__spread(e,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,t),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},e.prototype.reportBecon=function(){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}},e.prototype.report=function(e){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}},e.prototype.sliceEvent=function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var n;n=e.slice(r,r+this.eventLimit);var i=this.split(this.merge(n));this.send(i,t)}else i=this.split(this.merge(e)),this.send(i,t)},e.prototype.merge=function(e,t){var r=this,n=this.configManager.get(),i=n.header,a=n.user;i.custom=JSON.stringify(i.custom);var o=this.configManager.get("evtParams"),s=this.configManager.get("user_unique_id_type"),l=e.map((function(e){try{Object.keys(o).length&&!t&&(e.params=_assign({},o,e.params)),s&&(e.params.$user_unique_id_type=s);var n=r.localStorage.getItem(r.abKey);return n&&n.uuid&&n.uuid===a.user_unique_id&&r.configManager.getAbVersion()&&(e.ab_sdk_version=r.configManager.getAbVersion()),e.session_id=r.collect.sessionManager.getSessionId(),e.params=JSON.stringify(e.params),e}catch(i){return r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:i.message}),e}})),u=JSON.parse(JSON.stringify({events:l,user:a,header:i}));u.local_time=Math.floor(Date.now()/1e3),u.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0;var c=[];return c.push(u),c},e.prototype.split=function(e){return e.map((function(e){var t=[];return t.push(e),t}))},e.prototype.send=function(e,t){var r=this;e.length&&e.forEach((function(e){try{var n=JSON.parse(JSON.stringify(e));r.config.filter&&((n=r.config.filter(n))||console.warn("filter must return data !!")),r.collect.eventFilter&&n&&((n=r.collect.eventFilter(n))||console.warn("filterEvent api must return data !!"));var i=n||e;if(r.eventCheck.checkVerify(i),!i.length)return;r.collect.emit(Types$1$1.SubmitBefore,i),r.collect.emit(Types$1$1.SubmitVerify,i),request$2(r.reportUrl,i,r.timeout,r.enable_ttwebid,(function(e,t){e&&0!==e.e?(r.collect.emit(Types$1$1.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:i,code:e.e,failType:"",status:"fail"})):(r.collect.emit(Types$1$1.SubmitScuess,{eventData:t,res:e}),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:i,code:200,status:"success"}))}),(function(e,t){r.configManager.get("reportErrorCallback")(e,t),r.collect.emit(Types$1$1.SubmitError,{type:"f_net",eventData:e,errorCode:t}),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:i,code:t,failType:"",status:"fail"})}),t,!1),r.collect.emit(Types$1$1.SubmitAfter,i)}catch(a){console.warn("something error, "+JSON.stringify(a.stack)),r.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:a.message})}}))},e}(),b$1=function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},localWebId$1=function(){return b$1().replace(/-/g,"").slice(0,19)},Token$1=function(){function e(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new Storage$1(!1),this.tokenKey="__tea_cache_tokens_"+t.app_id,this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(Types$1$1.ConfigUuid,(function(e){r.setUuid(e)})),this.collect.on(Types$1$1.ConfigWebId,(function(e){r.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()},e.prototype.checkStorage=function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(Types$1$1.CustomWebId,(function(){e.tokenReady=!0,e.collect.emit(Types$1$1.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},e.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:localWebId$1(),user_unique_id:this.configManager.get("user_unique_id")||localWebId$1()}):this.remoteWebid()},e.prototype.checkEnv=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=parseUrlQuery$1(window.location.href);return!(!t||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))}return!1},e.prototype.remoteWebid=function(){var e=this,t=this.configManager.getUrl("webid"),r={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK WEBID",logType:"fetch",level:"info",time:Date.now(),data:r}),fetch$1$1(t,r,3e3,!1,(function(t){t&&0===t.e?e.complete({web_id:e.configManager.get("web_id")||t.web_id,user_unique_id:e.configManager.get("user_unique_id")||t.web_id}):(e.collect.emit(Types$1$1.TokenError),console.warn("[]appid: "+e.config.app_id+" webid error, init error~")),e.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"WEBID",logType:"fetch",level:"info",time:Date.now(),data:t})}),(function(){e.collect.emit(Types$1$1.TokenError),e.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"WEBID",logType:"fetch",level:"error",time:Date.now(),data:null}),console.warn("[]appid: "+e.config.app_id+", get webid error, init error~")}))},e.prototype.complete=function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types$1$1.TokenComplete)},e.prototype.completeTtWid=function(e){var t=e.user_unique_id||"",r=this.configManager.get("user_unique_id");(r||t)&&this.configManager.set({user_unique_id:r||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types$1$1.TokenComplete)},e.prototype.setUuid=function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),r=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===r&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(Types$1$1.TokenChange,"uuid"),this.collect.emit(Types$1$1.SessionReset)}else this.clearUuid()},e.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(Types$1$1.TokenReset))},e.prototype.setWebId=function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),r=this.configManager.get("user_unique_id");r&&r!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(Types$1$1.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(Types$1$1.TokenChange,"webid")),this.setStorage(this.cacheToken)}},e.prototype.setStorage=function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete e.web_id,this.storage.setItem(this.tokenKey,e))):this.storage.setItem(this.tokenKey,e),this.cacheToken=e},e.prototype.getReady=function(){return this.tokenReady},e.prototype.getTobId=function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise((function(r){fetch$1$1(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},3e4,e.enable_ttwebid,(function(e){e&&0===e.e?r(e.tobid):r("")}),(function(){r("")}))}))},e}(),sessionId$1=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},Session$1=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.storage=new Storage$1(!1,"session"),this.sessionKey="__tea_session_id_"+t.app_id,this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(Types$1$1.SessionReset,(function(){r.resetSessionId()})),this.collect.on(Types$1$1.SessionResetTime,(function(){r.updateSessionIdTime()})))},e.prototype.updateSessionIdTime=function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:sessionId$1(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}},e.prototype.setSessionId=function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:sessionId$1(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime)},e.prototype.getSessionId=function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""},e.prototype.resetExpTime=function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))},e.prototype.resetSessionId=function(){var e={sessionId:sessionId$1(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)},e.prototype.checkEXp=function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:sessionId$1(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e))},e}(),AutoBase$1=function(e){var t=e.app_id,r=e.channel,n=e.onTokenReady,i=LOG_URL$1[r]+"/webid",a=new Storage$1(!1),o="__tea_cache_tokens_"+t,s=a.getItem(o);s&&s.web_id?n(s.web_id):request$2(i,{app_key:"",app_id:t,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,(function(e){if(e&&0===e.e){n(e.web_id);var t={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()};a.setItem(o,t)}else n("")}),(function(){n("")}),!0)},Debugger$1=function(){function e(e,t){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.collect=e,this.config=t,this.app_id=t.app_id,this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}return e.prototype.loadScript=function(e){try{var t=document.createElement("script");t.src=e,t.onerror=function(){console.log("load DevTool render fail")},t.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(t)}catch(r){console.log("devTool load fail, "+r.message)}},e.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook();var e=parseUrlQuery$1(window.location.href);if(!e.open_devtool_web||parseInt(e.app_id)!==this.app_id)return;this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(t){console.log("debug fail, "+t.message)}},e.prototype.loadDevTool=function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.js")},e.prototype.loadBaseInfo=function(){var e=this;this.info=[{title:"",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"":this.collect.configManager.getDomain(),"SDK":SDK_VERSION$1,"SDK":SDK_TYPE$1}},{title:"",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"SSID"}},{title:"",type:2,infoName:{"":this.collect.configManager.get("browser"),"":this.collect.configManager.get("browser_version"),"":this.collect.configManager.get("platform"),"":this.collect.configManager.get("device_model"),"":this.collect.configManager.get("os_name"),"":this.collect.configManager.get("os_version"),"":this.collect.configManager.get("os_version"),"":this.collect.configManager.get("referrer"),"":""}},{title:"",type:3,infoName:{"":!!this.config.autotrack,"":!!this.config.enable_stay_duration}},{title:"A/B",type:4,infoName:{"A/B":!!this.config.enable_ab_test}},{title:"",type:3,infoName:{"":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(Types$1$1.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName[""]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B"]=e.config.ab_channel_domain||decodeUrl$1(AB_DOMAINS$1[e.config.channel]),e.info[4].infoName[""]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName[""]=!!e.collect.bridgeReport)}))},e.prototype.loadHook=function(){var e=this;this.collect.on(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,(function(t){switch(t.type){case DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK:var r={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(r.desc={content:JSON.stringify(t.data)}),e.updateLog(r),t.secType&&"AB"===t.secType?(e.info[4].infoName["VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName[""]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],i=n.events;if(!i.length)return;i.forEach((function(r){r.checkShow=!0,r.searchShow=!0,r.success=t.status,r.type=-1!==e.filterEvent.indexOf(r.event)?"sdk":"cus",r.type=e.collect.bridgeReport?"bridge":r.type,r.info="","fail"===t.status&&(r.info={message:"code: "+t.code+" msg: "+t.failType})})),e.updateEvent(n)}return}}))},e.prototype.addLintener=function(){var e=this;window.addEventListener("message",(function(t){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()}))}))},e.prototype.sendData=function(e,t){try{var r={type:e,payload:t};(window.opener||window.parent).postMessage(r,this.devToolOrigin)}catch(n){}},e.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},e.prototype.updateLog=function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)},e.prototype.updateEvent=function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)},e.prototype.loadDebuggerModule=function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t);var r=document.createElement("div");r.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog</div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(r),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))},e}(),sdk_type="base";sdk_type="full";var Collector$2=function(){function e(e){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=e,this.hook=new Hook$1,this.remotePlugin=new Map,this.Types=Types$1$1,this.adapters.fetch=fetch$1$1,this.adapters.storage=Storage$1}return e.usePlugin=function(t,r,n){if(r){for(var i=!1,a=0,o=e.plugins.length;a<o;a++)if(e.plugins[a].name===r){e.plugins[a].plugin=t,e.plugins[a].options=n||{},i=!0;break}i||e.plugins.push({name:r,plugin:t,options:n})}else e.plugins.push({plugin:t})},e.prototype.usePlugin=function(e,t,r){e&&("full"===sdk_type&&this.remotePlugin.get(e)?console.info("your sdk version has "+e+" already ~"):t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))},e.prototype.init=function(t){var r=this;this.inited?console.warn("[instance: "+this.name+"], every instance's api: init,  can be call only one time!"):t&&isObject$4(t)?t.app_id&&isNumber$2(t.app_id)?!t.app_key||isString$1(t.app_key)?(t.channel_domain||-1!==["cn","sg","va"].indexOf(t.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),t.channel="cn"),this.logger=new Logger$6(this.name,t.log),this.appBridge=new AppBridge$1(this,t.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new ConfigManager$1(this,t),this.debugger=new Debugger$1(this,t),this.initConfig=t,this.emit(Types$1$1.Init),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK INIT",data:t,level:"info",time:Date.now()}),t.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:t.app_id}),this.eventManager=new Event$3,this.tokenManager=new Token$1,this.sessionManager=new Session$1,Promise.all([new Promise((function(e){r.once(Types$1$1.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){r.once(Types$1$1.Start,(function(){e(!0)}))}))]).then((function(){try{e.plugins.reduce((function(e,t){var n=t.plugin,i=t.options,a=Object.assign(r.initConfig,i),o=new n;return o.apply(r,a),e.push(o),e}),r.pluginInstances)}catch(n){console.log("load plugin error, "+n.message),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:n.message})}r.sdkReady=!0,r.emit(Types$1$1.Ready),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),level:"info",data:r.configManager.get("user")}),r.logger.info("appid: "+t.app_id+", userInfo:"+JSON.stringify(r.configManager.get("user"))),r.logger.info("appid: "+t.app_id+", sdk is ready, version is "+SDK_VERSION$1+", you can report now !!!"),t.disable_auto_pv&&(r.disableAutoPageView=!0);try{(t.enable_ab_test||t.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(n){r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:n.message})}r.pageView(),r.on(Types$1$1.TokenChange,(function(e){"webid"===e&&r.pageView(),r.logger.info("appid: "+t.app_id+" token change, new userInfo:"+JSON.stringify(r.configManager.get("user"))),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),secType:"USER",level:"info",data:r.configManager.get("user")})})),r.on(Types$1$1.TokenReset,(function(){r.logger.info("appid: "+t.app_id+" token reset, new userInfo:"+JSON.stringify(r.configManager.get("user"))),r.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),secType:"USER",level:"info",data:r.configManager.get("user")})})),r.on(Types$1$1.RouteChange,(function(e){e.init||t.disable_route_report||r.pageView()}));try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(n){}})),this.tokenManager.apply(this,t),this.eventManager.apply(this,t),this.sessionManager.apply(this,t)),this.inited=!0):console.warn("app_key param is error, must be string, please check!"):console.warn("app_id param is error, must be number, please check!"):console.warn("init params error,please check")},e.prototype.config=function(e){if(this.inited)if(e&&isObject$4(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var t=_assign({},e);if(this.initConfig&&this.initConfig.configPersist){var r=this.configManager.getStore();r&&(t=Object.assign(r,e)),this.configManager.setStore(e)}t.web_id,t.user_unique_id;var n=__rest(t,["web_id","user_unique_id"]);t.hasOwnProperty("web_id")&&this.emit(Types$1$1.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(Types$1$1.ConfigUuid,t.user_unique_id),this.configManager.set(n),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK CONFIG",level:"info",time:Date.now(),data:t})}else console.warn("config params is error, please check");else console.warn("config must be use after function init")},e.prototype.setDomain=function(e){this.configManager&&this.configManager.setDomain(e),this.emit(Types$1$1.ConfigDomain)},e.prototype.getConfig=function(e){return this.configManager.get(e)},e.prototype.send=function(){this.start()},e.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(Types$1$1.Start),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK START",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(Types$1$1.Ready)))},e.prototype.event=function(e,t){var r=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var n=[];Array.isArray(e)?e.forEach((function(e){n.push(r.processEvent(e[0],e[1]||{}))})):n.push(this.processEvent(e,t)),this.bridgeReport?n.forEach((function(e){var t=e.event,n=e.params;r.appBridge.onEventV3(t,JSON.stringify(n))})):n.length&&(this.emit(Types$1$1.Event,n),this.emit(Types$1$1.SessionResetTime))}catch(i){console.warn("something error, please check"),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:i.message})}},e.prototype.beconEvent=function(e,t){if(!this.initConfig||!this.initConfig.disable_track_event)if(Array.isArray(e))console.warn("beconEvent not support batch report, please check");else{var r=[];r.push(this.processEvent(e,t||{})),r.length&&(this.emit(Types$1$1.BeconEvent,r),this.emit(Types$1$1.SessionResetTime))}},e.prototype.processEvent=function(e,t){void 0===t&&(t={});try{var r=e;/^event\./.test(e)&&(r=e.slice(6));var n=t;"object"!=_typeof$b(n)&&(n={}),n.profile?delete n.profile:n.event_index=getIndex$1();var i=void 0;return n.local_ms?(i=n.local_ms,delete n.local_ms):i=+new Date,{event:r,params:n,local_time_ms:i,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(a){return this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:a.message}),{event:e,params:t}}},e.prototype.filterEvent=function(e){this.eventFilter=e},e.prototype.on=function(e,t){this.hook.on(e,t)},e.prototype.once=function(e,t){this.hook.once(e,t)},e.prototype.off=function(e,t){this.hook.off(e,t)},e.prototype.emit=function(e,t,r){this.hook.emit(e,t,r)},e.prototype.set=function(e){this.hook.set(e)},e.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},e.prototype.predefinePageView=function(e){void 0===e&&(e={});var t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+this.configManager.is_first_time},r=_assign({},t,e);this.event("predefine_pageview",r)},e.prototype.clearEventCache=function(){this.emit(Types$1$1.CleanEvents)},e.prototype.setWebIDviaUnionID=function(e){if(e){var t=hashCode$1(e);this.config({web_id:""+t,wechat_unionid:e}),this.emit(Types$1$1.CustomWebId)}},e.prototype.setWebId=function(e){this.config({web_id:""+e})},e.prototype.setWebIDviaOpenID=function(e){if(e){var t=hashCode$1(e);this.config({web_id:""+t,wechat_openid:e}),this.emit(Types$1$1.CustomWebId)}},e.prototype.setNativeAppId=function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)},e.prototype.resetStayDuration=function(e,t,r){this.emit(Types$1$1.ResetStay,{url_path:e,title:t,url:r},Types$1$1.Stay)},e.prototype.resetStayParams=function(e,t,r){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),this.emit(Types$1$1.SetStay,{url_path:e,title:t,url:r},Types$1$1.Stay)},e.prototype.getToken=function(e,t){var r=this,n=!1,i=function(t){if(!n){n=!0;var i=r.configManager.get().user;return t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(_assign({},i))}},a=function(){r.tokenManager.getTobId().then((function(e){i(e)}))};this.sdkReady?a():(t&&setTimeout((function(){i()}),t),this.on(Types$1$1.Ready,(function(){a()})))},e.prototype.profileSet=function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(Types$1$1.ProfileSet,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileSet",level:"info",time:Date.now(),data:e})},e.prototype.profileSetOnce=function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(Types$1$1.ProfileSetOnce,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileSetOnce",level:"info",time:Date.now(),data:e})},e.prototype.profileIncrement=function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(Types$1$1.ProfileIncrement,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileIncrement",level:"info",time:Date.now(),data:e})},e.prototype.profileUnset=function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(Types$1$1.ProfileUnset,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileUnset",level:"info",time:Date.now(),data:e})},e.prototype.profileAppend=function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(Types$1$1.ProfileAppend,e,Types$1$1.Profile),this.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileAppend",level:"info",time:Date.now(),data:e})},e.prototype.setExternalAbVersion=function(e){this.emit(Types$1$1.AbExternalVersion,"string"==typeof e&&e?(""+e).trim():null,Types$1$1.Ab)},e.prototype.getVar=function(e,t,r){this.emit(Types$1$1.AbVar,{name:e,defaultValue:t,callback:r},Types$1$1.Ab)},e.prototype.getABconfig=function(e,t){this.emit(Types$1$1.AbConfig,{params:e,callback:t},Types$1$1.Ab)},e.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},e.prototype.onAbSdkVersionChange=function(e){var t=this;return this.emit(Types$1$1.AbVersionChangeOn,e,Types$1$1.Ab),function(){t.emit(Types$1$1.AbVersionChangeOff,e,Types$1$1.Ab)}},e.prototype.offAbSdkVersionChange=function(e){this.emit(Types$1$1.AbVersionChangeOff,e,Types$1$1.Ab)},e.prototype.openOverlayer=function(){this.emit(Types$1$1.AbOpenLayer,"",Types$1$1.Ab)},e.prototype.closeOverlayer=function(){this.emit(Types$1$1.AbCloseLayer,"",Types$1$1.Ab)},e.prototype.getAllVars=function(e){this.emit(Types$1$1.AbAllVars,e,Types$1$1.Ab)},e.prototype.autoInitializationRangers=function(e){AutoBase$1(e)},e.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(Types$1$1.TokenComplete))},e.plugins=[],e}(),STYLE_ID="__rangers_ab_style__";function openOverlayer(){if(!document.getElementById(STYLE_ID)){var e="body { opacity: 0 !important; }",t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.id=STYLE_ID,r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)}}function closeOverlayer(){var e=document.getElementById(STYLE_ID);e&&e.parentElement.removeChild(e)}var msgQueueMap={},allowdOrigins=[],addAllowdOrigin=function(e){e.length&&e.forEach((function(e){allowdOrigins.push(e)}))};function dispatchMsg(e,t,r,n){var i=e&&e.source||window.opener||window.parent,a=e&&e.origin||n||"*",o={type:t,payload:r};i.postMessage(JSON.stringify(o),a)}function receiveMsg(e,t){msgQueueMap[e]=msgQueueMap[e]||[],msgQueueMap[e].push(t)}function processMsg(e){if(allowdOrigins.some((function(e){return"*"===e}))||allowdOrigins.some((function(t){return e.origin.indexOf(t)>-1}))){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(i){t=void 0}if(!t)return;var r=t.type,n=t.payload;msgQueueMap[r]&&msgQueueMap[r].forEach((function(t){"function"==typeof t&&t(e,n)}))}}function init$1(e,t){var r=_assign({},e);delete r.filter,(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:r,version:t},"*"),window.addEventListener("message",processMsg,!1)}var VISUAL_URL="",isLoaded=!1;function loadEditorScript(e){var t=e.event,r=e.editorUrl;e.collectInstance,e.fromSession,isLoaded||(isLoaded=!0,loadScript(r,(function(){dispatchMsg(t,"abEditorScriptloadSuccess")}),(function(){t&&dispatchMsg(t,"abEditorScriptloadError"),isLoaded=!1})))}function readyToLoadEditor(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},addAllowdOrigin(["*"]);var r,n="";init$1(t,SDK_VERSION$1);var i="";try{var a=window.performance.getEntriesByType("resource");if(a&&a.length&&(a.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(i=e.name)})),i||document.currentScript&&(i=document.currentScript.src),i&&(r=i.split("/"))&&r.length)){n="https:/";for(var o=2;o<r.length&&o!==r.length-1;o++)n=n+"/"+r[o];n+="/visual-ab-core"}}catch(s){}receiveMsg("tea:openVisualABEditor",(function(r){var i=r.data;if("string"==typeof r.data)try{i=JSON.parse(r.data)}catch(s){i=void 0}if(i){var a=i.lang;if(i.appId!==t.app_id)return dispatchMsg(r,"appIdError"),void console.error("abtest appid is not belong the page appid please check");var o=i.version;VISUAL_URL=o&&n?n+(o?"."+o:".1.0.1")+".js?query="+Date.now():VISUAL_AB_CORE+"?query="+Date.now(),window.TEAVisualEditor.lang=a,window.TEAVisualEditor.__ab_domin=t.channel_domain||"",loadEditorScript({event:r,editorUrl:VISUAL_URL,collectInstance:e})}}))}var loadMuiltlink=function(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=t.app_id,receiveMsg("tea:openTesterEventInspector",(function(t){var r=t.data;if("string"==typeof t.data)try{r=JSON.parse(t.data)}catch(o){r=void 0}if(r){var n=r.referrer,i=r.lang,a=r.appId;window.TEAVisualEditor.__editor_ajax_domain=n||"",window.TEAVisualEditor.__ab_appId=a||"",window.TEAVisualEditor.lang=i||"",loadEditorScript({event:t,editorUrl:VISUAL_URL_INSPECTOR+".js?query="+Date.now(),collectInstance:e})}}))},loadVisual=function(e){window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=e,loadScript(VISUAL_AB_LOADER+"?query="+Date.now(),(function(){console.log("load visual render success")}),(function(){console.log("load visual render fail")}))},CallbackType;!function(e){e[e.Var=0]="Var",e[e.All=1]="All"}(CallbackType||(CallbackType={}));var STORAGE_EXPRIRE=2592e6,API="/service/2/abtest_config/",Ab=function(){function e(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,this.config.enable_ab_test){var n=t.enable_multilink,i=t.ab_channel_domain,a=t.enable_ab_visual,o=i||decodeUrl$1(AB_DOMAINS$1[t.channel||"cn"]),s=e.adapters,l=s.storage,u=s.fetch;this.cacheStorgae=new l(!1),this.fetch=u,this.enable_multilink=n,this.enable_ab_visual=a,this.abKey="__tea_sdk_ab_version_"+t.app_id,this.fetchUrl=""+o+API,this.reportUrl=""+e.configManager.getUrl("event"),this.exposureLimit=t.exposure_limit||20,this.ab_batch_time=t.ab_batch_time||500;var c=this.collect.Types;this.types=c,this.collect.on(c.TokenChange,(function(e){"uuid"===e&&r.readyStatus&&(r.clearCache(),r.fetchAB())})),this.collect.on(c.AbVar,(function(e){var t=e.name,n=e.defaultValue,i=e.callback;r.getVar(t,n,i)})),this.collect.on(c.AbAllVars,(function(e){r.getAllVars(e)})),this.collect.on(c.AbConfig,(function(e){var t=e.params,n=e.callback;r.getABconfig(t,n)})),this.collect.on(c.AbExternalVersion,(function(e){r.setExternalAbVersion(e)})),this.collect.on(c.AbOpenLayer,(function(){r.openOverlayer()})),this.collect.on(c.AbCloseLayer,(function(){r.closeOverlayer()})),this.collect.on(c.AbVersionChangeOn,(function(e){r.changeListener.set(e,e)})),this.collect.on(c.AbVersionChangeOff,(function(e){r.changeListener.get(e)&&r.changeListener.delete(e)})),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(c.AbReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(!Object.keys(r).length)return;var n=function(e){r[e].length&&r[e].forEach((function(r){t.collect.hook.emit(e,r)}))};for(var i in r)n(i)}},e.prototype.loadMode=function(){var e=getIframeUrl(),t="";if(e){var r=e.scenario,n=e.href;r?(this.editMode=!0,t=r):!n||-1===n.indexOf("datatester")&&-1===n.indexOf("visual-editor")||(this.editMode=!0,t="visual-editor")}this.enable_ab_visual&&(readyToLoadEditor(this.collect,this.config),"visual-editor"===t)?this.collect.destoryInstace():this.enable_multilink&&loadMuiltlink(this.collect,this.config)},e.prototype.checkLocal=function(){var e=this.getABCache(),t=e.ab_version,r=e.ab_ext_version,n=e.ab_version_multilink,i=e.data,a=this.checkFromUrl();a?this.mulilinkVersions.push(a):this.mulilinkVersions=n||[],this.extVersions=r||[],this.versions=t||[],this.data=i;var o=this.versions.concat(this.extVersions);this.enable_multilink&&(o=o.concat(this.mulilinkVersions)),this.configVersions(o.join(","))},e.prototype.checkFromUrl=function(){var e=parseUrlQuery$1(window.location.href);return e&&e.vid?e.vid:""},e.prototype.updateVersions=function(){var e=this.extVersions.length?this.versions.concat(this.extVersions):this.versions,t=e.concat(this.mulilinkVersions);this.configVersions(t.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach((function(t){"function"==typeof t&&t(e)}))},e.prototype.configVersions=function(e){this.collect.configManager.setAbVersion(e)},e.prototype.getVar=function(e,t,r){if(!e)throw new Error("variable must not be empty");if(void 0===t)throw new Error("variable no default value");if("function"!=typeof r)throw new Error("callback must be a function");var n={name:e,defaultValue:t,callback:r,type:CallbackType.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(n,e):this.callbacks.push(n)},e.prototype.getRealVar=function(e,t){var r=e.name,n=e.defaultValue,i=e.callback,a=this.data;if(a){if(isObject$4(a[r])){var o=a[r].vid;return"$ab_url"===t?this.mulilinkVersions.includes(o)||this.mulilinkVersions.push(o):this.versions.includes(o)||this.versions.push(o),this.updateVersions(),this.fechEvent(o,t,n),i(a[r].val),void this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK "+r,level:"info",time:Date.now(),data:a[r]})}this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK getVar",level:"info",time:Date.now(),data:n}),i(n)}else i(n)},e.prototype.getAllVars=function(e){if("function"!=typeof e)throw new Error("callback must be a function");var t={callback:e,type:CallbackType.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(t):this.callbacks.push(t)},e.prototype.getRealAllVars=function(e){(0,e.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK getAllVars",level:"info",time:Date.now(),data:this.data})},e.prototype.fechEvent=function(e,t,r){try{if(this.config.disable_track_event)return;if(!e)return;var n=this.collect.configManager.get(),i=n.header,a=n.user,o=this.getABCache();if(o&&o.uuid&&o.uuid!==a.user_unique_id)return;var s={event:"abtest_exposure",ab_sdk_version:""+e,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===t?r:window.location.href}),local_time_ms:Date.now()};i.custom=JSON.stringify(i.custom);var l={events:[s],user:a,header:i};"$ab_url"===t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([l])):this.reportExposure(l)}catch(u){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:u.message})}},e.prototype.reportExposure=function(e){var t=this;this.exposureCache.push(e),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report():this.reportTimeout=setTimeout((function(){t.report(),clearTimeout(t.reportTimeout)}),this.ab_batch_time)},e.prototype.report=function(){var e=this;this.fetch(this.reportUrl,this.exposureCache,2e4),this.exposureCache.forEach((function(t){e.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:[t],code:200,status:"success"})})),this.exposureCache=[]},e.prototype.setExternalAbVersion=function(e){this.extVersions=[e],this.updateVersions()},e.prototype.getABconfig=function(e,t){var r=Object.keys(e);r&&r.length&&this.collect.configManager.set(e),this.fetchAB(t)},e.prototype.getABCache=function(e){var t={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return t=this.cacheStorgae.getItem(this.abKey)||t,Date.now()-t.timestamp>=STORAGE_EXPRIRE?(this.cacheStorgae.removeItem(this.abKey),null):e?t[e]:t},e.prototype.updateABCache=function(){var e=this.getABCache();e.ab_version_multilink=this.mulilinkVersions,e.ab_ext_version=this.extVersions,e.ab_version=this.versions,e.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,e)},e.prototype.setAbCache=function(e){var t=this.getABCache();t.data=this.data,t.uuid=e,t.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,t),this.collect.configManager.setAbData(this.data)},e.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[]},e.prototype.openOverlayer=function(e){var t=this;if(openOverlayer(),e)var r=setTimeout((function(){t.closeOverlayer(),clearTimeout(r)}),e)},e.prototype.closeOverlayer=function(){closeOverlayer()},e.prototype.fetchComplete=function(e,t){var r=this;if(e&&"[object Object]"==Object.prototype.toString.call(e)){this.data=e,this.setAbCache(t);var n=[];Object.keys(e).forEach((function(t){var r=e[t].vid;r&&n.push(r)})),this.versions=this.versions.filter((function(e){return n.includes(e)}));var i=e.$ab_url,a=e.$ab_modification;if(a&&a.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,(function(){loadVisual(a.val)}))}else if(i&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter((function(e){return n.includes(e)}));var o=i.val,s=i.vid;o&&s&&this.getVar("$ab_url",o,(function(){r.editMode||o!==window.location.href&&setTimeout((function(){if(!r.collect.destroyInstance){var e=""+o;e=-1===e.indexOf("http")?"https://"+e:e,parseURL$1(e).host!==location.host&&(e=e+"&vid="+s),window.history.replaceState("","",e),window.location.href=e}}),100)}))}this.updateVersions()}this.callbacks.forEach((function(e){return r[e.type===CallbackType.Var?"getRealVar":"getRealAllVars"](e,"")})),this.callbacks=[]},e.prototype.fetchAB=function(e){var t=this,r=window.location.href,n=this.collect.configManager.get(),i={header:_assign({aid:this.config.app_id},n.user||{},n.header||{},{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:r})};this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK AB",level:"info",logType:"fetch",time:Date.now(),data:i}),this.fetch(this.fetchUrl,i,this.config.ab_timeout||3e3,!1,(function(r){t.fetchStatus="complete",t.refreshFetchStatus="complete";var i=r.data;"success"===r.message?(t.fetchComplete(i,n.user.user_unique_id),e&&e(i)):(t.fetchComplete(null,n.user.user_unique_id),e&&e(null)),t.collect.emit(t.types.AbComplete,i),t.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB",level:"info",logType:"fetch",time:Date.now(),data:i})}),(function(){t.fetchStatus="complete",t.refreshFetchStatus,t.fetchComplete(null,n.user.user_unique_id),e&&e(null),t.collect.emit(t.types.AbComplete,null),t.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB",level:"error",logType:"fetch",time:Date.now()})}))},e.prototype.filterUrl=function(e){try{var t="";-1!==e.indexOf("&multilink=true")?t="&multilink=true[\0-]*":-1!==e.indexOf("?multilink=true")&&(t="\\?multilink=true[\0-]*");var r=new RegExp(t,"g");e=e.replace(r,"")}catch(n){}return e},e}(),Et=function(){function e(){}return e.prototype.apply=function(e,t){var r=this,n=e.adapters.fetch;if(t.event_verify_url)if("string"==typeof t.event_verify_url){if(this.url=t.event_verify_url+"/v1/list_test",this.url){var i=e.Types;e.on(i.SubmitBefore,(function(e){n(r.url,e,3e4)}))}}else console.log("please use correct et_test url")},e}(),Alive=function(){function e(e,t){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=e,this.config=t,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,isObject$4(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration))}return e.prototype.setParams=function(e,t,r){this.set_path=e,this.set_url=r,this.set_title=t},e.prototype.enable=function(e,t,r){this.url_path=e,this.url=r,this.title=t,this.disableCallback=this.enablePageAlive()},e.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},e.prototype.sendEvent=function(e,t){void 0===t&&(t=!1);var r=t?this.aliveDTime:Date.now()-this.sessionStartTime;r<0||r>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,_assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:r,is_support_visibility_change:isSupVisChange(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:e},this.options.params)),this.sessionStartTime=Date.now())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.setUpTimer=function(){var e=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval((function(){Date.now()-e.sessionStartTime>e.aliveDTime&&e.sendEvent(!1,!0)}),1e3)},e.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},e.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},e.prototype.enablePageAlive=function(){var e=this;this.timerHandler=this.setUpTimer();var t=this.visibilitychange.bind(this),r=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),beforePageUnload$1(r),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",r),window.removeEventListener("pagehide",r)}},e}(),Close=function(){function e(e,t){var r=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?r.activeEndTime=Date.now():"visible"===document.visibilityState&&(r.activeEndTime&&(r.totalTime+=r.activeEndTime-r.activeStartTime,r.activeTimes+=1),r.activeEndTime=void 0,r.activeStartTime=Date.now())},this.beforeunload=function(){if(r.totalTime+=(r.activeEndTime||Date.now())-r.activeStartTime,r.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:r.totalTime,page_title:document.title||location.pathname}))}catch(e){}r.sendEventPageClose()},this.collect=e,this.config=t,this.maxDuration=t.maxDuration||864e5,this.pageStartTime=Date.now(),isObject$4(t.enable_stay_duration)&&(this.options=Object.assign(this.options,t.enable_stay_duration)),this.resetData()}return e.prototype.setParams=function(e,t,r){this.set_path=e,this.set_url=r,this.set_title=t},e.prototype.enable=function(e,t,r){this.url_path=e,this.url=r,this.title=t,this.disableCallback=this.enablePageClose()},e.prototype.disable=function(){this.disableCallback()},e.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0},e.prototype.sendEventPageClose=function(){var e=Date.now()-this.pageStartTime;this.totalTime<0||e<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,_assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:e,is_support_visibility_change:isSupVisChange()},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},e.prototype.getParams=function(e){switch(e){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},e.prototype.enablePageClose=function(){var e=this,t=this.visibilitychange.bind(this),r=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",t),beforePageUnload$1(r),function(){e.beforeunload(),document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",r),window.removeEventListener("pagehide",r)}},e}(),Stay=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new Alive(e,t),this.pageClose=new Close(e,t);var n=this.collect.Types;this.collect.on(n.ResetStay,(function(e){var t=e.url_path,n=e.title,i=e.url;r.resetStayDuration(t,n,i)})),this.collect.on(n.RouteChange,(function(e){e.init||t.disable_route_report||r.resetStayDuration()})),this.collect.on(n.SetStay,(function(e){var t=e.url_path,n=e.title,i=e.url;r.setStayParmas(t,n,i)})),this.enable(this.url_path,this.title,this.url),this.ready(n.Stay),this.collect.emit(n.StayReady)}},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(!Object.keys(r).length)return;var n=function(e){r[e].length&&r[e].forEach((function(r){t.collect.hook.emit(e,r)}))};for(var i in r)n(i)}},e.prototype.enable=function(e,t,r){this.pageAlive.enable(e,t,r),this.pageClose.enable(e,t,r)},e.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},e.prototype.setStayParmas=function(e,t,r){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),this.pageAlive.setParams(e,t,r),this.pageClose.setParams(e,t,r),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK  resetStayParams",level:"info",time:Date.now(),data:{url_path:e,title:t,url:r}})},e.prototype.reset=function(e,t,r){this.disable(),this.enable(e,t,r)},e.prototype.resetStayDuration=function(e,t,r){this.reset(e,t,r),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"SDK  resetStayDuration",level:"info",time:Date.now(),data:{url_path:e,title:t,url:r}})},e}(),Profile=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;this.collect=e,this.config=t,this.duration=6e4,this.reportUrl=e.configManager.getDomain()+"/profile/list";var n=e.Types,i=e.adapters.fetch;this.eventCheck=new EventCheck$1(e,t),this.fetch=i,this.cache={},this.collect.on(n.ProfileSet,(function(e){r.setProfile(e)})),this.collect.on(n.ProfileSetOnce,(function(e){r.setOnceProfile(e)})),this.collect.on(n.ProfileUnset,(function(e){r.unsetProfile(e)})),this.collect.on(n.ProfileIncrement,(function(e){r.incrementProfile(e)})),this.collect.on(n.ProfileAppend,(function(e){r.appendProfile(e)})),this.collect.on(n.ProfileClear,(function(){r.cache={}})),this.ready(n.Profile)},e.prototype.ready=function(e){var t=this;if(this.collect.set(e),this.collect.hook._hooksCache.hasOwnProperty(e)){var r=this.collect.hook._hooksCache[e];if(!Object.keys(r).length)return;var n=function(e){r[e].length&&r[e].forEach((function(r){t.collect.hook.emit(e,r)}))};for(var i in r)n(i)}},e.prototype.report=function(e,t){void 0===t&&(t={});try{if(this.config.disable_track_event)return;var r=[];r.push(this.collect.processEvent(e,t));var n=this.collect.eventManager.merge(r);this.fetch(this.reportUrl,n),this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:n,code:200,status:"success"})}catch(i){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:i.message})}},e.prototype.setProfile=function(e){var t=this.formatParams(e);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set",_assign({},t,{profile:!0})))},e.prototype.setOnceProfile=function(e){var t=this.formatParams(e,!0);t&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set_once",_assign({},t,{profile:!0})))},e.prototype.incrementProfile=function(e){e?this.report("__profile_increment",_assign({},e,{profile:!0})):console.warn("please check the params, must be object!!!")},e.prototype.unsetProfile=function(e){if(e){var t={};t[e]="1",this.report("__profile_unset",_assign({},t,{profile:!0}))}else console.warn("please check the key, must be string!!!")},e.prototype.appendProfile=function(e){if(e){var t={};for(var r in e)"string"==typeof e[r]||"Array"===Object.prototype.toString.call(e[r]).slice(8,-1)?t[r]=e[r]:console.warn("please check the value of param: "+r+", must be string or array !!!");Object.keys(t).length&&this.report("__profile_append",_assign({},t,{profile:!0}))}else console.warn("please check the params, must be object!!!")},e.prototype.pushCache=function(e){var t=this;Object.keys(e).forEach((function(r){t.cache[r]={val:t.clone(e[r]),timestamp:Date.now()}}))},e.prototype.formatParams=function(e,t){var r=this;void 0===t&&(t=!1);try{if(!e||"[object Object]"!==Object.prototype.toString.call(e))return void console.warn("please check the params type, must be object !!!");var n={};for(var i in e)"string"==typeof e[i]||"number"==typeof e[i]||"Array"===Object.prototype.toString.call(e[i]).slice(8,-1)?n[i]=e[i]:console.warn("please check the value of params:"+i+", must be string,number,Array !!!");var a=Object.keys(n);if(!a.length)return;if(!this.eventCheck.checkEventParams(n))return;var o=Date.now();return a.filter((function(n){var i=r.cache[n];return t?!i:!(i&&r.compare(i.val,e[n])&&o-i.timestamp<r.duration)})).reduce((function(e,t){return e[t]=n[t],e}),{})}catch(s){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:s.message}),console.log("error")}},e.prototype.compare=function(e,t){try{return JSON.stringify(e)===JSON.stringify(t)}catch(r){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:r.message}),!1}},e.prototype.clone=function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:t.message}),e}},e.prototype.unReady=function(){console.warn("sdk is not ready, please use this api after start")},e}(),HeartBeat=function(){function e(){var e=this;this.setInterval=function(){e.clearIntervalFunc=selfAdjust((function(){e.isSessionhasEvent&&e.endCurrentSession()}),e.sessionInterval)},this.clearInterval=function(){e.clearIntervalFunc&&e.clearIntervalFunc()}}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,!t.disable_heartbeat){this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval();var n=this.collect.Types;this.collect.on(n.SessionReset,(function(){r.process()}))}},e.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},e.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var e=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-e>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},e}(),Monitor=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,!this.config.channel_domain){var n=e.adapters.fetch;if(this.fetch=n,!t.disable_track_event&&!t.disable_sdk_monitor){this.url=e.configManager.getUrl("event");var i=this.collect.Types;this.collect.on(i.Ready,(function(){r.sdkOnload()})),this.collect.on(i.SubmitError,(function(e){var t=e.type,n=e.eventData,i=e.errorCode;"f_data"===t&&r.sdkError(n,i)}))}}},e.prototype.sdkOnload=function(){var e=this;try{var t=this.collect.configManager.get(),r=t.header,n=t.user,i=r.app_id,a=r.app_name,o=r.sdk_version,s=n.web_id,l={events:[{event:"onload",params:JSON.stringify({app_id:i,app_name:a||"",sdk_version:o,sdk_type:SDK_TYPE$1,sdk_config:this.config,sdk_desc:"TOC"}),local_time_ms:Date.now()}],user:{user_unique_id:s},header:{}};setTimeout((function(){e.fetch(e.url,[l],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(u){}},e.prototype.sdkError=function(e,t){var r=this;try{var n=e[0],i=n.user,a=n.header,o=[];e.forEach((function(e){e.events.forEach((function(e){o.push(e)}))}));var s={events:o.map((function(e){return{event:"on_error",params:JSON.stringify({error_code:t,app_id:a.app_id,app_name:a.app_name||"",error_event:e.event,sdk_version:a.sdk_version,local_time_ms:e.local_time_ms,tea_event_index:Date.now(),params:e.params,header:JSON.stringify(a),user:JSON.stringify(i)}),local_time_ms:Date.now()}})),user:{user_unique_id:i.user_unique_id},header:{}};setTimeout((function(){r.fetch(r.url,[s],3e4,!1,(function(){}),(function(){}),"566f58151b0ed37e")}),16)}catch(l){}},e}();function isNeedElement(e,t){if(void 0===t&&(t="list"),!e)return!1;if(t&&"list"===t){if(["LI","TR","DL"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaIdx"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-idx"))return!0}else{if(["A","BUTTON"].includes(e.nodeName))return!0;if(e.dataset&&e.dataset.hasOwnProperty("teaContainer"))return!0;if(e.hasAttribute&&e.hasAttribute("data-tea-container"))return!0;if(e.hasAttribute&&hasAttributes(e,"ss"))return!0}return!1}var isAttrFilter=function(e,t){return!!hasAttributes(e,t)};function getContainer(e){for(var t=e;t&&!isNeedElement(t,"container");){if("HTML"===t.nodeName||"BODY"===t.nodeName)return e;t=t.parentElement}return t||e}function getNodeText(e){var t="";return 3===e.nodeType?t=e.textContent.trim():e.dataset&&e.dataset.hasOwnProperty("teaTitle")||e.hasAttribute("ata-tea-title")?t=e.getAttribute("data-tea-title"):e.hasAttribute("title")?t=e.getAttribute("title"):"INPUT"===e.nodeName&&["button","submit"].includes(e.getAttribute("type"))?t=e.getAttribute("value"):"IMG"===e.nodeName&&e.getAttribute("alt")&&(t=e.getAttribute("alt")),t.slice(0,200)}function getText(e){var t=getContainer(e),r=[];return function e(t){var n=getNodeText(t);if(n&&-1===r.indexOf(n)&&r.push(n),t.childNodes.length>0)for(var i=t.childNodes,a=0;a<i.length;a++)8!==i[a].nodeType&&e(i[a])}(t),r}function getTextSingle(e){var t=getContainer(e),r="";return function e(t){var n=getNodeText(t);if(n&&(r+=n),t.childNodes.length>0)for(var i=t.childNodes,a=0;a<i.length;a++)3===i[a].nodeType&&e(i[a])}(t),r}function ignore(e){for(var t=e;t&&t.parentNode;){if(t.hasAttribute("data-tea-ignore"))return!0;if("HTML"===t.nodeName||"body"===t.nodeName)return!1;t=t.parentNode}return!1}var hasAttribute=function(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0},hasAttributes=function(e,t){if("string"==typeof t)return hasAttribute(e,t);if(isArray$1(t)){for(var r=!1,n=0;n<t.length;n++)if(hasAttribute(e,t[n])){r=!0;break}return r}},getAttributes=function(e,t){var r={};if("string"==typeof t)hasAttribute(e,t)&&(r.attrs=e.getAttribute(t));else if(isArray$1(t))for(var n=0;n<t.length;n++)hasAttribute(e,t[n])&&(r[t[n]]=e.getAttribute(t[n]));return r},elementLevel=function(e){if(e.children.length){var t=e.children;return![].slice.call(t).some((function(e){return e.children.length>0}))}return!0},isSVG=function(e){if("svg"===e.tagName.toLowerCase())return!0;for(var t=e.parentElement,r=!1;t;)"svg"===t.tagName.toLowerCase()?(t=null,r=!0):t=t.parentElement;return r};function isTrack(e,t){if(1!==e.nodeType)return!1;if(!t.svg&&isSVG(e))return!1;if(["HTML","BODY"].includes(e.tagName.toUpperCase()))return!1;var r=e;return!("none"===r.style.display||!isNeedElement(r,"container")&&!elementLevel(r))}var Listener=function(){function e(e,t,r){var n=this;this.clickEvent=function(e){isTrack(e.target,n.options)&&n.eventHandel({eventType:"dom",eventName:"click"},e)},this.changeEvent=function(e){n.eventHandel({eventType:"dom",eventName:"change"},e)},this.submitEvent=function(e){n.eventHandel({eventType:"dom",eventName:"submit"},e)},this.getPageViewEvent=function(e,t){t&&"pushState"===t&&n.eventHandel({eventType:"dom",eventName:"beat"},_assign({beat_type:0},e)),n.eventHandel({eventType:"dom",eventName:"page_view"},e)},this.getPageLoadEvent=function(e){n.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:e})},this.config=r.getConfig().eventConfig,this.collect=t,this.options=e,this.beatTime=e.beat,this.statistics=!1}return e.prototype.init=function(e){this.eventHandel=e;var t=this.config.mode;this.addListener(t)},e.prototype.addListener=function(e){var t=this;if("proxy-capturing"===e&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",(function(e){var r=e.config,n=e.name;t.getPageViewEvent(r,n)})),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",(function(){t.beatEvent(t.beatTime)}));var r=0,n=null;window.addEventListener("scroll",(function(){clearTimeout(n),n=setTimeout(i,500),r=document.documentElement.scrollTop||document.body.scrollTop}));var i=function(){(document.documentElement.scrollTop||document.body.scrollTop)==r&&t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(o){}try{var a=window.performance&&window.performance.getEntriesByType("paint");a&&a.length?(new PerformanceObserver((function(e){var r=e.getEntries(),n=r[r.length-1],i=n.renderTime||n.loadTime;t.statistics||(t.getPageLoadEvent(i),t.statistics=!0)})).observe({entryTypes:["largest-contentful-paint"]}),setTimeout((function(){t.statistics||(t.getPageLoadEvent(a[0].startTime||0),t.statistics=!0)}),2e3)):this.getPageLoadEvent(0)}catch(o){this.getPageLoadEvent(0)}}},e.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},e.prototype.beatEvent=function(e){var t=this;try{var r;this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(r=setInterval((function(){t.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})}),e)),beforePageUnload$1((function(){t.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),t.beatTime&&clearInterval(r)}))}catch(n){}},e}(),defaultConfig$1={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},Config=function(){function e(e,t){this.config=e,this.config.eventConfig=Object.assign(this.config.eventConfig,t)}return e.prototype.getConfig=function(){return this.config},e.prototype.setConfig=function(e){return this.config=e},e}();function getPositionData(e){if(e){var t=e.getBoundingClientRect(),r=t.width,n=t.height;return{left:t.left,top:t.top,element_width:r,element_height:n}}}function getEventData(e,t){void 0===e&&(e={}),void 0===t&&(t={});var r=e.clientX,n=e.clientY,i=t.left,a=t.top,o=r-i>=0?r-i:0,s=n-a>=0?n-a:0;return{touch_x:Math.floor(o),touch_y:Math.floor(s)}}function getXpath(e){for(var t=[];null!==e.parentElement;)t.push(e),e=e.parentElement;var r=[],n=[];return t.forEach((function(e){var t=getXpathIndex(e),i=t.str,a=t.index;r.unshift(i),n.unshift(a)})),{element_path:"/"+r.join("/"),positions:n}}function getXpathIndex(e){if(null===e)return{str:"",index:0};var t=0,r=e.parentElement;if(r)for(var n=r.children,i=0;i<n.length&&n[i]!==e;i++)n[i].nodeName===e.nodeName&&t++;return{str:[e.nodeName.toLowerCase(),isNeedElement(e,"list")?"[]":""].join(""),index:t}}function getElementData(e,t,r,n){var i={},a=getPositionData(t),o=getEventData(e,a),s=a.element_width,l=a.element_height,u=o.touch_x,c=o.touch_y,d=getXpath(t),h=d.element_path,f=d.positions,p=getText(t),y=window.performance.timing.navigationStart,m=Date.now()-y,g=f.map((function(e){return""+e})),v=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(v=window.TEAVisualEditor.getOriginXpath({xpath:h,positions:g})),i.element_path=v&&v.xpath||h,i.positions=v&&v.positions||g,n&&!n.text&&(i.texts=p,i.element_title=getTextSingle(t)),i.element_id=t.getAttribute("id")||"",i.element_class_name=t.getAttribute("class")||"",i.element_type=t.nodeType,i.element_width=Math.floor(s),i.element_height=Math.floor(l),i.touch_x=u,i.touch_y=c,i.page_manual_key="",i.elememt_manual_key="",i.since_page_start_ms=m,i.page_start_ms=y,i.page_path=location.pathname,i.page_host=location.host,r.track_attr&&isAttrFilter(t,r.track_attr)){var b=getAttributes(t,r.track_attr);for(var _ in b)i[_]=b[_]}var E=getContainer(t);return"A"===E.tagName&&(i.href=E.getAttribute("href")),"IMG"===t.tagName&&(i.src=t.getAttribute("src")),i}var getEventData$1=function(e,t,r,n,i){return _assign({event:e},getElementData(t,r,n,i),{is_html:1,page_key:window.location.href,page_title:document.title})},getExtraEventData=function(e,t){try{if("bav2b_change"===e)return t.hasAttribute("data-tea-track")?{value:t.value}:{}}catch(r){return{}}},EventHandle=function(){function e(e,t){this.ignore={text:!1},this.initConfig=e,this.options=t,this.eventName=t&&"tea"===t.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},t&&!1===t.text&&(this.ignore.text=!0),t&&t.exposure&&t.exposure.eventName&&(this.eventName.exposure=t.exposure.eventName)}return e.prototype.handleEvent=function(e,t){try{if(ignore(e.target))return null;var r="bav2b_click";switch(t){case"click":return r=this.eventName.click,getEventData$1(r,e,e.target,this.options,this.ignore);case"exposure":return r=this.eventName.exposure,getEventData$1(r,e,e.target,this.options,this.ignore);case"change":return _assign({},getEventData$1(r="bav2b_change",e,e.target,this.options),getExtraEventData(r,e.target));case"submit":return getEventData$1(r="bav2b_submit",e,e.target,this.options)}}catch(n){return console.error(n),null}},e.prototype.handleViewEvent=function(e){e.event=this.eventName.page,e.page_title=document.title,e.page_total_width=window.innerWidth,e.page_total_height=window.innerHeight;try{var t=window.sessionStorage.getItem("_tea_cache_duration");if(t){var r=JSON.parse(t);e.refer_page_duration_ms=r?r.duration:""}e.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,e.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,e.page_start_ms=window.performance.timing.navigationStart}catch(n){console.log("page event error "+JSON.stringify(n))}return e},e.prototype.handleStatisticsEvent=function(e){var t={};t.event=this.eventName.static,t.is_html=1,t.page_key=location.href,t.refer_page_key=document.referrer||"",t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"",t.refer_page_manual_key="";try{var r=e.lcp,n=window.performance.timing,i=n.loadEventEnd-n.navigationStart;t.page_init_cost_ms=parseInt(r||(i>0?i:0)),t.page_start_ms=n.navigationStart}catch(a){console.log("page_statistics event error "+JSON.stringify(a))}return t},e.prototype.handleBeadtEvent=function(e){e.event=this.eventName.beat,e.page_key=window.location.href,e.is_html=1,e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{e.page_viewport_width=window.innerWidth,e.page_viewport_height=window.innerHeight,e.page_total_width=document.documentElement.scrollWidth,e.page_total_height=document.documentElement.scrollHeight,e.scroll_width=document.documentElement.scrollLeft+window.innerWidth,e.scroll_height=document.documentElement.scrollTop+window.innerHeight,e.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,e.page_start_ms=window.performance.timing.navigationStart}catch(t){console.log("beat event error "+JSON.stringify(t))}return e},e}(),Request=function(){function e(e){this.collect=e,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}return e.prototype.send=function(e,t){var r=e.eventSend,n=t.event;delete t.event,r&&"becon"===r?this.collect.beconEvent(n,t):this.collect.event(n,t)},e.prototype.get=function(e,t){var r=Object.assign({headers:{"content-type":"application/json"},method:"GET"},t);fetch(e,r)},e.prototype.post=function(e,t){var r=Object.assign({headers:{"content-type":"application/json"},method:"POST"},t);fetch(e,r)},e}(),COOKIE_KEY="_TEA_VE_OPEN",COOKIE_KEY_HOST="_TEA_VE_APIHOST",COOKIE_LANG="lang",COOKIE_EDIT_VERISON="_VISUAL_EDITOR_V",COOKIE_EDIT_URL="_VISUAL_EDITOR_U";function checkSession(){return"1"===js_cookie.get(COOKIE_KEY)}function checkSessionHost(){var e=js_cookie.get(COOKIE_KEY_HOST);try{e=JSON.parse(e)}catch(t){}return e}function checkEditUrl(){return js_cookie.get(COOKIE_EDIT_URL)}function setSession(){try{var e=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||js_cookie.get(COOKIE_LANG),t=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||js_cookie.get(COOKIE_KEY_HOST),r=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||js_cookie.get(COOKIE_EDIT_VERISON),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||js_cookie.get(COOKIE_EDIT_URL),i=+new Date,a=new Date(i+18e5);js_cookie.set(COOKIE_KEY,"1",{expires:a}),js_cookie.set(COOKIE_KEY_HOST,t,{expires:a}),js_cookie.set(COOKIE_EDIT_URL,n,{expires:a}),js_cookie.set(COOKIE_LANG,e,{expires:a}),js_cookie.set(COOKIE_EDIT_VERISON,r||"",{expires:a})}catch(o){console.log("set cookie err")}}var isLoaded$1=!1;function loadEditorScript$1(e){var t=e.event,r=e.editorUrl,n=e.autoTrackInstance;isLoaded$1||(isLoaded$1=!0,loadScript(r,(function(){dispatchMsg(t,"editorScriptloadSuccess"),n.destroy()}),(function(){t&&dispatchMsg(t,"editorScriptloadError"),isLoaded$1=!1})))}function readyToLoadEditor$1(e,t){window.TEAVisualEditor=window.TEAVisualEditor||{};var r="",n=VISUAL_EDITOR_RANGERS+"?query="+Date.now();window.TEAVisualEditor.appId=t.app_id;var i=t.channel_domain,a="";if(addAllowdOrigin(["*"]),i){var o,s="";try{var l=window.performance.getEntriesByType("resource");if(l&&l.length&&(l.forEach((function(e){"script"===e.initiatorType&&e.name&&-1!==e.name.indexOf("collect")&&(s=e.name)})),s&&(o=s.split("/"))&&o.length)){a="https:/";for(var u=2;u<o.length&&u!==o.length-1;u++)a=a+"/"+o[u];if(a&&a.indexOf("/5.0")){var c=a.split("/5.0");a=c[0]||a}}}catch(f){}}if(init$1(t,SDK_VERSION$1),checkSession()){var d=checkSessionHost(),h="";d&&(window.TEAVisualEditor.__editor_ajax_domain=d,h=checkEditUrl()),loadEditorScript$1({event:null,editorUrl:h||n,autoTrackInstance:e}),setSession()}else try{receiveMsg("tea:openVisualEditor",(function(t){var o=t.data;if("string"==typeof t.data)try{o=JSON.parse(t.data)}catch(f){o=void 0}if(o){var s=o.referrer,l=o.lang;if(s&&(window.TEAVisualEditor.__editor_ajax_domain=s),r=n,i){var u=o.version;r=a?a+(u?"/visual-editor-rangers-v"+u:"/visual-editor-rangers-v1.0.0")+".js":n,window.TEAVisualEditor.__editor_verison=u}window.TEAVisualEditor.__editor_url=r,window.TEAVisualEditor.lang=l,loadEditorScript$1({event:t,editorUrl:r,autoTrackInstance:e}),setSession()}})),window.TEAVisualEditor.openAutotrackEditor=function(){loadEditorScript$1({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:e})}}catch(f){console.log("receive message error")}try{receiveMsg("tea:openHeatMapCore",(function(r){var n=HOT_PIC_URL,i=r.data.app_id;i&&i!==t.app_id||loadEditorScript$1({event:r,editorUrl:n+".js?query="+Date.now(),autoTrackInstance:e})}))}catch(f){console.log("openHeatMapCore error")}}var Observer=function(){function e(e){this._instance=null,this._intersection=e,this.init()}return e.prototype.init=function(){var e=this;this._instance=new MutationObserver((function(t){t.forEach((function(t){"attributes"===t.type&&e.attributeChangeObserve(t),"childList"===t.type&&e.modifyNodeObserve(t)}))})),this._instance.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})},e.prototype.attributeChangeObserve=function(e){e.target.hasAttribute("data-exposure")?this.exposureAdd(e,"mutation"):this.exposureRemove(e)},e.prototype.modifyNodeObserve=function(e){var t=this;Array.prototype.forEach.call(e.addedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureAdd(e,"intersect"),t.mapChild(e,t.exposureAdd)})),Array.prototype.forEach.call(e.removedNodes,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t.exposureRemove(e),t.mapChild(e,t.exposureRemove)}))},e.prototype.mapChild=function(e,t){var r=this;1===e.nodeType&&e.children.length&&Array.prototype.forEach.call(e.children,(function(e){1===e.nodeType&&e.hasAttribute("data-exposure")&&t(e),r.mapChild(e,t)}))},e.prototype.exposureAdd=function(e,t){this._intersection.exposureAdd(e,t)},e.prototype.exposureRemove=function(e){this._intersection.exposureRemove(e)},e._exposure_observer=null,e}(),Intersection=function(){function e(t,r){this.count=1,this.instance=this.buildObserver(),this.observeMap=e._observer_map,t.autotrack.exposure.ratio?this.Ratio=t.autotrack.exposure.ratio:0===t.autotrack.exposure.ratio?this.Ratio=0:this.Ratio=.5,this.EventHandle=r}return e.prototype.buildObserver=function(){var t=this;if(!e._observer_instance)return IntersectionObserver&&(e._observer_instance=new IntersectionObserver((function(e){e.forEach((function(e){t.observeMap.get(e.target._observeId)&&t.exposureEvent(e)}))}),{threshold:[.01,.25,.5,.75,1]})),e._observer_instance},e.prototype.exposureAdd=function(e,t){var r=e;"mutation"===t&&(r=e.target);var n=r._observeId;if(n||this.observeMap.has(n)){if(!1===r.visible){var i=r.getBoundingClientRect(),a=i.top,o=i.left,s=i.right,l=i.bottom;a>=0&&l<=window.innerHeight&&o>=0&&s<=window.innerWidth&&(r.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e))}}else r._observeId=this.count,r.visible=!1,this.observeMap.set(this.count,r),this.observe(r),this.count++},e.prototype.exposureRemove=function(e){this.observeMap.has(e._observeId)&&(this.observeMap.delete(e._observeId),this.unobserve(e))},e.prototype.exposureEvent=function(e){if(e.intersectionRatio>=this.Ratio&&e.isIntersecting){if("0"===e.target.style.opacity||"hidden"===e.target.style.visibility)return;if(!0===e.target.visible)return;e.target.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},e)}else e.target.visible=!1},e.prototype.observe=function(e){this.instance.observe(e)},e.prototype.unobserve=function(e){this.instance.unobserve(e)},e._observer_instance=null,e._observer_map=new Map,e}(),Exposure=function(){function e(e,t){e.autotrack&&e.autotrack.exposure&&(this._intersection=new Intersection(e,t),this._observer=new Observer(this._intersection),this.initObserver())}return e.prototype.initObserver=function(){var e=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),(function(t){e._intersection.exposureAdd(t,"intersect")}))},e}(),defaultOpt={hashTag:!1,impr:!1},AutoTrack=function(){function e(){}return e.prototype.apply=function(e,t){if(this.autoTrackStart=!1,this.collect=e,this.config=t,t.autotrack){var r=e.Types;t.autotrack&&t.autotrack.collect_url&&!t.autotrack.collect_url()||(this.ready(r.Autotrack),this.collect.emit(r.AutotrackReady))}},e.prototype.ready=function(e){this.collect.set(e);var t=this.config.autotrack;t="object"==_typeof$b(t)?t:{},t=Object.assign(defaultOpt,t),this.destroyed=!1,this.options=t,this.Config=new Config(defaultConfig$1,this.options),this.Exposure=new Exposure(this.config,this.handle.bind(this)),this.Listener=new Listener(t,this.collect,this.Config),this.EventHandle=new EventHandle(this.config,t),this.Request=new Request(this.collect),this.autoTrackStart=!0,this.init(),readyToLoadEditor$1(this,this.config)},e.prototype.init=function(){this.Listener.init(this.handle.bind(this))},e.prototype.handle=function(e,t){"dom"===e.eventType&&this.handleDom(e,t)},e.prototype.handleDom=function(e,t){try{var r=e.eventName;if("click"===r||"exposure"===r||"change"===r||"submit"===r){var n=this.EventHandle.handleEvent(t,r);null!==n&&this.Request.send({eventType:"custom",eventName:"report_"+r+"_event",extra:{methods:"GET"}},n)}else if("page_view"===r||"page_statistics"===r){var i;i="page_view"===r?this.EventHandle.handleViewEvent(t):this.EventHandle.handleStatisticsEvent(t),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},i)}else if("beat"===r){var a=this.EventHandle.handleBeadtEvent(t),o=e.eventSend;this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:o},a)}}catch(s){console.log("handel dom event error "+JSON.stringify(s))}},e.prototype.destroy=function(){if(!this.autoTrackStart)return console.warn("engine is undefined, make sure you have called autoTrack.start()");this.autoTrackStart=!1,this.Listener.removeListener()},e}(),State$1;!function(e){e.Net="net",e.FailNet="f_net",e.FailData="f_data"}(State$1||(State$1={}));var EventList={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Tracer=function(){function e(){}return e.prototype.apply=function(e,t){var r=this;if(this.ready=t.app_id&&t.enable_tracer&&!t.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=e,this.appid=t.app_id,this.reportUrl=e.configManager.getUrl("event");var n=this.collect.Types,i=e.adapters.fetch;this.fetch=i,this.collect.on(n.Event,(function(){r.addCount("log")})),this.collect.on(n.SubmitError,(function(e){var t=e.type,n=e.eventDate,i=e.errorCode,a=e.response;r.addErrorCount(n,t,i,a)})),this.listener(),this.collect.emit(n.TracerReady)}},e.prototype.addCount=function(e,t,r){void 0===t&&(t="net"),void 0===r&&(r=1);try{this.tracerCache||(this.tracerCache=new Map);var n=void 0;if(this.tracerCache.has(e))(i=this.tracerCache.get(e)).has(t)?(n=i.get(t).params.count,n++,i.set(t,this.processTracer(n,e,t))):(n=r,i.set(t,this.processTracer(r,e,t)));else{var i=new Map;n=r,i.set(t,this.processTracer(r,e,t)),this.tracerCache.set(e,i)}"net"===t&&n>=this.limit[e]&&this.report(!1)}catch(a){console.log(a)}},e.prototype.addErrorCount=function(e,t,r,n){var i=this;try{if(e&&e.length){var a=e[0].events;a&&a.length&&("f_data"===t?(n&&n.hasOwnProperty("sc")?this.addCount("log",t,a.length-n.sc):this.addCount("log",t,a.length),this.errorCode[t]=r):a.forEach((function(e){var n="log";for(var a in EventList)if(-1!==EventList[a].indexOf(e.event)){n=a;break}i.addCount(n,t,1),i.errorCode[t]=r})))}}catch(o){}},e.prototype.report=function(e){if(this.tracerCache){var t=[];this.tracerCache.forEach((function(e){console.log(e),e.forEach((function(e){t.push(e)}))})),t&&t.length&&this.sendTracer(t,e)}},e.prototype.sendTracer=function(e,t){try{var r=this.collect.eventManager.merge(e);t&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(r)):this.fetch(this.reportUrl,r),this.tracerCache=null}catch(n){}},e.prototype.processTracer=function(e,t,r){var n={count:e,state:r,key:t,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:SDK_VERSION$1};"f_net"!==r&&"f_data"!==r||(n.errorCode=this.errorCode[r]);var i=this.collect.processEvent("applog_trace",n);if(i&&i.event)return delete i.is_bav,i},e.prototype.listener=function(){var e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.leavePage()})),beforePageUnload$1((function(){e.leavePage()}))},e.prototype.leavePage=function(){this.report(!0)},e}(),dayjs_min=createCommonjsModule$1((function(e,t){e.exports=function(){var e="millisecond",t="second",r="minute",n="hour",i="day",a="week",o="month",s="quarter",l="year",u="date",c="Invalid Date",d=/^(\d{4})[-\/]?(\d{1,2})?[-\/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},y={s:p,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),n=Math.floor(r/60),i=r%60;return(t<=0?"+":"-")+p(n,2,"0")+":"+p(i,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),i=t.clone().add(n,o),a=r-i<0,s=t.clone().add(n+(a?-1:1),o);return+(-(n+(r-i)/(a?i-s:s-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(c){return{M:o,y:l,w:a,d:i,D:u,h:n,m:r,s:t,ms:e,Q:s}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},m="en",g={};g[m]=f;var v=function(e){return e instanceof T},b=function(e,t,r){var n;if(!e)return m;if("string"==typeof e)g[e]&&(n=e),t&&(g[e]=t,n=e);else{var i=e.name;g[i]=e,n=i}return!r&&n&&(m=n),n||!r&&m},_=function(e,t){if(v(e))return e.clone();var r="object"==_typeof$b(t)?t:{};return r.date=e,r.args=arguments,new T(r)},E=y;E.l=b,E.i=v,E.w=function(e,t){return _(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var T=function(){function f(e){this.$L=b(e.locale,null,!0),this.parse(e)}var p=f.prototype;return p.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(E.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(d);if(n){var i=n[2]-1||0,a=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},p.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},p.$utils=function(){return E},p.isValid=function(){return!(this.$d.toString()===c)},p.isSame=function(e,t){var r=_(e);return this.startOf(t)<=r&&r<=this.endOf(t)},p.isAfter=function(e,t){return _(e)<this.startOf(t)},p.isBefore=function(e,t){return this.endOf(t)<_(e)},p.$g=function(e,t,r){return E.u(e)?this[t]:this.set(r,e)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(e,s){var c=this,d=!!E.u(s)||s,h=E.p(e),f=function(e,t){var r=E.w(c.$u?Date.UTC(c.$y,t,e):new Date(c.$y,t,e),c);return d?r:r.endOf(i)},p=function(e,t){return E.w(c.toDate()[e].apply(c.toDate("s"),(d?[0,0,0,0]:[23,59,59,999]).slice(t)),c)},y=this.$W,m=this.$M,g=this.$D,v="set"+(this.$u?"UTC":"");switch(h){case l:return d?f(1,0):f(31,11);case o:return d?f(1,m):f(0,m+1);case a:var b=this.$locale().weekStart||0,_=(y<b?y+7:y)-b;return f(d?g-_:g+(6-_),m);case i:case u:return p(v+"Hours",0);case n:return p(v+"Minutes",1);case r:return p(v+"Seconds",2);case t:return p(v+"Milliseconds",3);default:return this.clone()}},p.endOf=function(e){return this.startOf(e,!1)},p.$set=function(a,s){var c,d=E.p(a),h="set"+(this.$u?"UTC":""),f=(c={},c[i]=h+"Date",c[u]=h+"Date",c[o]=h+"Month",c[l]=h+"FullYear",c[n]=h+"Hours",c[r]=h+"Minutes",c[t]=h+"Seconds",c[e]=h+"Milliseconds",c)[d],p=d===i?this.$D+(s-this.$W):s;if(d===o||d===l){var y=this.clone().set(u,1);y.$d[f](p),y.init(),this.$d=y.set(u,Math.min(this.$D,y.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},p.set=function(e,t){return this.clone().$set(e,t)},p.get=function(e){return this[E.p(e)]()},p.add=function(e,s){var u,c=this;e=Number(e);var d=E.p(s),h=function(t){var r=_(c);return E.w(r.date(r.date()+Math.round(t*e)),c)};if(d===o)return this.set(o,this.$M+e);if(d===l)return this.set(l,this.$y+e);if(d===i)return h(1);if(d===a)return h(7);var f=(u={},u[r]=6e4,u[n]=36e5,u[t]=1e3,u)[d]||1,p=this.$d.getTime()+e*f;return E.w(p,this)},p.subtract=function(e,t){return this.add(-1*e,t)},p.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||c;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=E.z(this),a=this.$H,o=this.$m,s=this.$M,l=r.weekdays,u=r.months,d=function(e,r,i,a){return e&&(e[r]||e(t,n))||i[r].substr(0,a)},f=function(e){return E.s(a%12||12,e,"0")},p=r.meridiem||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n},y={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:E.s(s+1,2,"0"),MMM:d(r.monthsShort,s,u,3),MMMM:d(u,s),D:this.$D,DD:E.s(this.$D,2,"0"),d:String(this.$W),dd:d(r.weekdaysMin,this.$W,l,2),ddd:d(r.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(a),HH:E.s(a,2,"0"),h:f(1),hh:f(2),a:p(a,o,!0),A:p(a,o,!1),m:String(o),mm:E.s(o,2,"0"),s:String(this.$s),ss:E.s(this.$s,2,"0"),SSS:E.s(this.$ms,3,"0"),Z:i};return n.replace(h,(function(e,t){return t||y[e]||i.replace(":","")}))},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(e,u,c){var d,h=E.p(u),f=_(e),p=6e4*(f.utcOffset()-this.utcOffset()),y=this-f,m=E.m(this,f);return m=(d={},d[l]=m/12,d[o]=m,d[s]=m/3,d[a]=(y-p)/6048e5,d[i]=(y-p)/864e5,d[n]=y/36e5,d[r]=y/6e4,d[t]=y/1e3,d)[h]||y,c?m:E.a(m)},p.daysInMonth=function(){return this.endOf(o).$D},p.$locale=function(){return g[this.$L]},p.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=b(e,t,!0);return n&&(r.$L=n),r},p.clone=function(){return E.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},f}(),S=T.prototype;return _.prototype=S,[["$ms",e],["$s",t],["$m",r],["$H",n],["$W",i],["$M",o],["$y",l],["$D",u]].forEach((function(e){S[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),_.extend=function(e,t){return e.$i||(e(t,T,_),e.$i=!0),_},_.locale=b,_.isDayjs=v,_.unix=function(e){return _(1e3*e)},_.en=g[m],_.Ls=g,_.p={},_}()})),duration=createCommonjsModule$1((function(e,t){var r,n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v;e.exports=(o=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,u=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,c={years:s=31536e6,months:l=2592e6,days:a=864e5,hours:i=36e5,minutes:6e4,seconds:1e3,milliseconds:1,weeks:6048e5},d=function(e){return e instanceof v},h=function(e,t,r){return new v(e,r,t.$l)},f=function(e){return n.p(e)+"s"},p=function(e){return e<0},y=function(e){return p(e)?Math.ceil(e):Math.floor(e)},m=function(e){return Math.abs(e)},g=function(e,t){return e?p(e)?{negative:!0,format:""+m(e)+t}:{negative:!1,format:""+e+t}:{negative:!1,format:""}},v=function(){function e(e,t,r){var n=this;if(this.$d={},this.$l=r,void 0===e&&(this.$ms=0,this.parseFromMilliseconds()),t)return h(e*c[f(t)],this);if("number"==typeof e)return this.$ms=e,this.parseFromMilliseconds(),this;if("object"==_typeof$b(e))return Object.keys(e).forEach((function(t){n.$d[f(t)]=e[t]})),this.calMilliseconds(),this;if("string"==typeof e){var i=e.match(u);if(i){var a=i.slice(2).map((function(e){return Number(e)}));return this.$d.years=a[0],this.$d.months=a[1],this.$d.weeks=a[2],this.$d.days=a[3],this.$d.hours=a[4],this.$d.minutes=a[5],this.$d.seconds=a[6],this.calMilliseconds(),this}}return this}var t=e.prototype;return t.calMilliseconds=function(){var e=this;this.$ms=Object.keys(this.$d).reduce((function(t,r){return t+(e.$d[r]||0)*c[r]}),0)},t.parseFromMilliseconds=function(){var e=this.$ms;this.$d.years=y(e/s),e%=s,this.$d.months=y(e/l),e%=l,this.$d.days=y(e/a),e%=a,this.$d.hours=y(e/i),e%=i,this.$d.minutes=y(e/6e4),e%=6e4,this.$d.seconds=y(e/1e3),e%=1e3,this.$d.milliseconds=e},t.toISOString=function(){var e=g(this.$d.years,"Y"),t=g(this.$d.months,"M"),r=+this.$d.days||0;this.$d.weeks&&(r+=7*this.$d.weeks);var n=g(r,"D"),i=g(this.$d.hours,"H"),a=g(this.$d.minutes,"M"),o=this.$d.seconds||0;this.$d.milliseconds&&(o+=this.$d.milliseconds/1e3);var s=g(o,"S"),l=e.negative||t.negative||n.negative||i.negative||a.negative||s.negative,u=i.format||a.format||s.format?"T":"",c=(l?"-":"")+"P"+e.format+t.format+n.format+u+i.format+a.format+s.format;return"P"===c||"-P"===c?"P0D":c},t.toJSON=function(){return this.toISOString()},t.format=function(e){var t=e||"YYYY-MM-DDTHH:mm:ss",r={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return t.replace(o,(function(e,t){return t||String(r[e])}))},t.as=function(e){return this.$ms/c[f(e)]},t.get=function(e){var t=this.$ms,r=f(e);return"milliseconds"===r?t%=1e3:t="weeks"===r?y(t/c[r]):this.$d[r],0===t?0:t},t.add=function(e,t,r){var n;return n=t?e*c[f(t)]:d(e)?e.$ms:h(e,this).$ms,h(this.$ms+n*(r?-1:1),this)},t.subtract=function(e,t){return this.add(e,t,!0)},t.locale=function(e){var t=this.clone();return t.$l=e,t},t.clone=function(){return h(this.$ms,this)},t.humanize=function(e){return r().add(this.$ms,"ms").locale(this.$l).fromNow(!e)},t.milliseconds=function(){return this.get("milliseconds")},t.asMilliseconds=function(){return this.as("milliseconds")},t.seconds=function(){return this.get("seconds")},t.asSeconds=function(){return this.as("seconds")},t.minutes=function(){return this.get("minutes")},t.asMinutes=function(){return this.as("minutes")},t.hours=function(){return this.get("hours")},t.asHours=function(){return this.as("hours")},t.days=function(){return this.get("days")},t.asDays=function(){return this.as("days")},t.weeks=function(){return this.get("weeks")},t.asWeeks=function(){return this.as("weeks")},t.months=function(){return this.get("months")},t.asMonths=function(){return this.as("months")},t.years=function(){return this.get("years")},t.asYears=function(){return this.as("years")},e}(),function(e,t,i){r=i,n=i().$utils(),i.duration=function(e,t){var r=i.locale();return h(e,{$l:r},t)},i.isDuration=d;var a=t.prototype.add,o=t.prototype.subtract;t.prototype.add=function(e,t){return d(e)&&(e=e.asMilliseconds()),a.bind(this)(e,t)},t.prototype.subtract=function(e,t){return d(e)&&(e=e.asMilliseconds()),o.bind(this)(e,t)}})}));dayjs_min.extend(duration);var ignoreList=["__cep_sdk_onboard","__cep_trigger_sdk","_be_active"],moreOP=["and","or","not"],CepRule=function(){function CepRule(){this.support=!0,this.currentPlan=1,this.shouldSendEvent=!1,this.staing=!1,this.test=!1,this.cepReady=!1,this.eventCache=[]}return CepRule.prototype.apply=function(e,t){var r=this;if(this.collect=e,this.config=t,this.config.cep){var n=e.adapters,i=n.fetch,a=n.storage,o=e.Types;this.types=o,this.storage=new a(!1),this.fetch=i,this.configManager=e.configManager,this.url=t.cep_url?""+t.cep_url:e.configManager.getDomain()+"/service/2/cep_settings/",this.reportUrl=e.configManager.getUrl("event"),this.key="__tea_cep_plan_"+t.app_id,this.quotasKey="__tea_cep_plan_quotas_"+t.app_id,this.isWait=!1,this.eventCache=[],this.test=e.configManager.staging,this.collect.on(o.SubmitAfter,(function(e){r.matchEvent(e)})),this.init()}},CepRule.prototype.init=function(){var e=this,t=!0,r=0,n=0,i=0,a=!1,o=this.storage.getItem(this.key)||{};if(o&&Object.keys(o).length&&(a=!0,r=o.last_update_time,n=o.fetch_interval,i=o.config_version||0,t=Date.now()-r>1e3*n),t){var s=this.configManager.get(),l=s.header,u=s.user;this.fetch(this.url,{header:l,user:u,local_time:Date.now(),config_version:i},1e4,!1,(function(t){t&&0===t.code?(o.fetch_interval=t.fetch_interval,o.data=t.data,o.last_update_time=Date.now(),o.config_version=t.config_version,e.clearQuotas(),e.initState(t.data),e.storage.setItem(e.key,o),t.data.forEach((function(t){e.event("__cep_sdk_onboard",t.plan_id)}))):304!==t.code&&400!==t.code||!a?console.log("code: "+t.code+", request errorplease try leater"):(console.log("code: "+t.code+", use old rules~"),o.last_update_time=Date.now(),e.storage.setItem(e.key,o),e.initState(o.data))}),(function(){a?(e.planData=o.data,e.initState(o.data)):(e.support=!1,console.log("request errorplease try leater"))}))}else o.last_update_time=Date.now(),this.storage.setItem(this.key,o),console.log("rule still work, use cache"),this.initState(o.data)},CepRule.prototype.initState=function(e){var t=this;e&&e.length&&(this.stateArray=new Map,this.waitArray=new Map,this.planData=e,e.forEach((function(e){var r=new Map;if(e.pattern&&e.pattern.events){var n=1===e.pattern.events.length;e.pattern.events.forEach((function(e){r.set(e.id,{id:e.id,isMatch:!1,event:null,after:e.after||null,connection:e.connection||null,window:e.window||null,matchTime:0,initTime:Date.now(),singleRule:n})})),t.stateArray.set(e.plan_id,{patternState:r,singleRule:n,pattern:{aid:e.aid,biz_id:e.biz_id,end_time:e.end_time,start_time:e.start_time,web_sdk_version:e.web_sdk_version,stage:e.stage},quotas:e.quotas})}})),this.cepReady=!0,this.dealCache(),this.collect.emit(this.types.CepReady))},CepRule.prototype.check=function(e){var t=Date.now();return Date.now()>1e3*e.end_time?(console.log("event rules:"+e.plan_id+" is over"),!1):t<1e3*e.start_time||t>1e3*e.end_time?(console.log("rule:"+e.plan_id+" time error"),!1):(this.staing="testing"===e.staing,!(SDK_VERSION$1<e.web_sdk_version&&(this.support=!1,console.log("you sdk version is oldplease update to "+e.web_sdk_version+" at least"),1)))},CepRule.prototype.dealCache=function(){var e=this;if(this.eventCache.length){var t=1;this.eventCache.forEach((function(r){e.matchEvent(r),t++})),t===this.eventCache.length&&(this.eventCache=[])}},CepRule.prototype.matchEvent=function(e){if(this.support&&(!this.staing||this.test)&&e&&e.length)try{if(!this.cepReady)return void this.eventCache.push(e);var t=e[0],r=t.header,n=t.user,i=t.events;i.length&&i.reverse();for(var a=0;a<i.length;a++){var o=i[a].event;if(-1!==ignoreList.indexOf(o))return!1;this.matchRule(r,n,i[a])}}catch(s){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:s.message}),void console.log(s.message)}},CepRule.prototype.matchRule=function(e,t,r){try{for(var n=0;n<this.planData.length;n++){var i=this.planData[n],a=i.plan_id;if(this.check(i)&&this.checkQuotas(a)&&i.pattern&&i.pattern.events)for(var o=i.pattern.events,s=0;s<o.length;s++)if(this.rule(e,t,r,o[s].condition)){var l=this.stateArray.get(a).patternState,u=l.get(o[s].id);if(this.stateArray.get(a).singleRule){this.changeStatus(a,o[s].id,r),this.publish([r],a,o[s].id);break}if(!u.isMatch){u.after&&l.get(u.after).isMatch?this.changeStatus(a,o[s].id,r):u.after||this.changeStatus(a,o[s].id,r);break}}}this.statusCheck()}catch(c){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:c.message}),void console.log(c.message)}},CepRule.prototype.changeStatus=function(e,t,r){var n=this.stateArray.get(e),i=n.patternState.get(t);i.isMatch=!0,i.event=r,i.matchTime=r.local_time_ms||Date.now(),n.patternState.set(t,i),this.stateArray.set(e,n)},CepRule.prototype.statusCheck=function(){var e,t,r,n;try{for(var i=__values(this.stateArray),a=i.next();!a.done;a=i.next()){var o=__read(a.value,2),s=o[0],l=o[1],u=l.patternState;if(l.isSingle)break;try{for(var c=__values(u),d=c.next();!d.done;d=c.next()){var h=__read(d.value,2),f=h[0],p=h[1];if(p.after&&(!p.after||u.get(p.after).isMatch)){if("NOT_FOLLOWED_BY"===p.connection){p.isMatch?this.reset(s,f):Date.now()-u.get(p.after).matchTime>p.window?this.publish([u.get(p.after).event,p.event],s,f):this.startWait(s,f,p);break}p.isMatch?p.matchTime-u.get(p.after).matchTime<=p.window?this.publish([u.get(p.after).event,p.event],s,f):this.reset(s,f):Date.now()-u.get(p.after).matchTime>p.window?this.reset(s,f):this.startWait(s,f,p);break}}}catch(y){r={error:y}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}}catch(m){e={error:m}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},CepRule.prototype.startWait=function(e,t,r){var n=this;try{this.waitArray.get(e)||this.waitArray.set(e,new Map);var i=this.waitArray.get(e);if(!i.get(t)){var a=setTimeout((function(){var i=n.stateArray.get(e).patternState,a=i.get(t);if("NOT_FOLLOWED_BY"===a.connection)!a.isMatch&&i.get(a.after).isMatch||a.matchTime-i.get(a.after).matchTime>r.window?((o=n.waitArray.get(e).get(t)).triggerWait=!0,n.waitArray.set(e,n.waitArray.get(e).set(t,o)),n.publish([i.get(a.after).event],e,t)):n.reset(e,t);else if("FOLLOWED_BY"===a.connection){var o;a.isMatch&&i.get(a.after).isMatch?((o=n.waitArray.get(e).get(t)).triggerWait=!0,n.waitArray.set(e,n.waitArray.get(e).set(t,o)),n.publish([i.get(a.after).event],e,t)):n.reset(e,t)}}),r.window);i.set(t,{waitFn:a,triggerWait:!1}),this.waitArray.set(e,i)}}catch(o){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:o.message}),console.log(o.message,o.stack)}},CepRule.prototype.rule=function(e,t,r,n){var i=this;try{var a=r.event,o=r.params;if(o=JSON.parse(o),-1!==moreOP.indexOf(n.op)){if(n.conditions&&n.conditions.length){var s=n.conditions,l=0,u=new Map;u.set(l,{op:n.op,result:void 0,resultList:[],resultKey:[],resultLength:s.length}),function r(n,s){for(var c=0;c<n.length;c++)if(l++,-1!==moreOP.indexOf(n[c].op)&&n[c].hasOwnProperty("conditions"))u.set(l,{op:n[c].op,result:void 0,fatherKey:s,resultList:[],resultKey:[],resultLength:n[c].conditions.length}),r(n[c].conditions,l);else{var d=i.scope(n[c].key),h=d.scope,f=d.key,p=d.key2,y=h?"header"===h?p?JSON.parse(e[p])[f]:e[f]:"user"===h?t[f]:o[f]:a,m=i.calculate(n[c].op,y,n[c].value);u.set(l,{op:n[c].op,result:m,fatherKey:s})}}(s,l);for(var c=u.get(0);void 0===c.result||c.resultList.length<c.resultLength;)u.forEach((function(e,t){if(void 0!==e.result&&void 0!==e.fatherKey){var r=u.get(e.fatherKey);r.resultList.length<r.resultLength&&-1===r.resultKey.indexOf(t)&&(r.resultKey.push(t),r.resultList.push(e.result),u.set(e.fatherKey,r))}})),u.forEach((function(e){e.resultList&&e.resultList.length===e.resultLength&&("and"===e.op&&(e.result=-1===e.resultList.indexOf(!1)),"or"===e.op&&(e.result=-1!==e.resultList.indexOf(!0)))}));return u.get(0).result}return!1}var d=this.scope(n.key),h=d.scope,f=d.key,p=d.key2,y=h?"header"===h?p?JSON.parse(e[p])[f]:e[f]:"user"===h?t[f]:o[f]:a;return this.calculate(n.op,y,n.value)}catch(m){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:m.message}),console.log(m.message),!1}},CepRule.prototype.publish=function(e,t,r){try{var n=this.configManager.get().user,i={biz_id:this.stateArray.get(t).pattern.biz_id,plan_id:t,uid:n.user_id||"",did:n.device_id||"",uuid:n.user_unique_id,events:e,extra:{url:window.location.href}};this.collect.emit("__cep_match",i),(window.opener||window.parent).postMessage({type:"__cep_match",data:i},"*"),this.event("__cep_trigger_sdk",t),this.addQuotas(t),this.reset(t,r),console.log(this.stateArray)}catch(a){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:a.message}),void console.log(a.message)}},CepRule.prototype.addQuotas=function(e){var t=this.stateArray.get(e).quotas;if(t&&t.length){var r=this.storage.getItem(this.quotasKey)||{};r[e]||(r[e]={value:0,lastTime:Date.now()});var n=r[e].value;0===n&&(r[e].lastTime=Date.now()),r[e].value=n+1,this.storage.setItem(this.quotasKey,r)}},CepRule.prototype.checkQuotas=function(e){var t=this.stateArray.get(e).quotas,r=this.storage.getItem(this.quotasKey)||{};if(r[e]||(r[e]={value:0,lastTime:Date.now()}),t&&t.length){var n=t[0].granularity,i=t[0].value;if("per_keyid"!==t[0].type)return!0;var a=this.release(n);return"all"===a?!(r[e].value>=i&&(console.log("plan:"+e+" limit"),1)):Date.now()-r[e].lastTime>=a?(r[e].value=0,r[e].lastTime=Date.now(),this.storage.setItem(this.quotasKey,r),!0):!(r[e].value>=i&&(console.log("plan:"+e+" limit"),1))}return!0},CepRule.prototype.clearQuotas=function(){this.storage.setItem(this.quotasKey,null)},CepRule.prototype.release=function(e){if("all"===e)return e;var t=dayjs_min.duration(e);return t?t.asMilliseconds():"all"},CepRule.prototype.reset=function(e,t){var r=this.stateArray.get(e);if(r.singleRule){var n=r.patternState.get(t);n.isMatch=!1,n.event=null,n.matchTime=0,n.initTime=Date.now(),r.patternState.set(t,n)}else r.patternState.forEach((function(e){e.isMatch=!1,e.event=null,e.matchTime=0,e.initTime=Date.now()}));this.stateArray.set(e,r);var i=this.waitArray.get(e);i&&i.get(t)&&(clearTimeout(i.get(t).waitFn),i.delete(t))},CepRule.prototype.event=function(e,t){try{var r={event:e,params:JSON.stringify({plan_id:t||"",biz_id:this.stateArray.get(t).pattern.biz_id}),local_time_ms:Date.now()},n=this.configManager.get(),i=n.header,a=n.user;i.custom=JSON.stringify(i.custom);var o={events:[r],user:a,header:i};this.fetch(this.reportUrl,[o])}catch(s){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:s.message}),void console.log(s.message)}},CepRule.prototype.scope=function(e){var t="",r="";if(e.indexOf(".")>-1){var n=e.split(".");t=n[0],e=n[1],"header"===t&&"custom"===e&&(e=n[2],r=n[1])}return{scope:t,key:e,key2:r}},CepRule.prototype.calculate=function(op,paramA,paramB){try{if("="===op)return paramA===paramB;if(-1!==["=","<",">",">=","<=","!="].indexOf(op))return eval(""+paramA+op+paramB);if(-1!==["in","contains"].indexOf(op))return-1!==paramB.indexOf(paramA);if(-1!==["is not null","is null"].indexOf(op))return"is null"===op?null==paramA:null!=paramA;if(-1!==["startswith","endswith"].indexOf(op)){if("startswith"===op)return 0===paramA.indexOf(paramB);var start=paramA.length-paramB.length,str=paramA.substr(start,paramB.length);return str===paramB}}catch(e){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message}),console.log(e.message),!1}},CepRule}(),pluginExtendList={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},visual:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/visual.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/visual.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},getLogPluginSpace=function(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null},pluginObject=getLogPluginSpace(),PluginExtend=function(){function e(){}return e.prototype.apply=function(e,t){this._plugin={},this.config=t,this.collect=e,this.channel=t.channel||"cn",this.loadExtend()},e.prototype.loadExtend=function(){var e=this;try{this.collect.remotePlugin.forEach((function(t,r){if("sdk"===t)if(pluginExtendList.hasOwnProperty(r)){var n=pluginExtendList[r].object,i=""+pluginExtendList[r].src[e.channel];e.exist(r,n,i)}else console.warn("your "+r+" is not existplease check plugin name");else"object"==_typeof$b(t)&&(t.src?e.exist(r,t.call,t.src):e.process(r,t.instance,"INSTANCE"))}))}catch(t){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:t.message}),console.log("load extend error")}},e.prototype.exist=function(e,t,r){var n=this;pluginObject[t]?(this.process(e,pluginObject[t]),console.log(""+e+"~")):this.loadPlugin(e,r,(function(){n.process(e,pluginObject[t]),console.log(" %c %s %s %s","color: yellow; background-color: black;","","load plugin:"+e+" success","-")}),(function(){console.log(" %c %s %s %s","color: red; background-color: yellow;","","load plugin:"+e+" error","-")}))},e.prototype.process=function(e,t,r){try{if(r){var n=new t;n.apply&&n.apply(this.collect,this.config),console.log("excude "+e+" success")}else t&&t(this.collect,this.config)}catch(i){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:i.message}),console.log("excude "+e+" error, message:"+i.message)}},e.prototype.loadPlugin=function(e,t,r,n){var i=this;try{var a=document.createElement("script");a.src=t,this._plugin[e]||(this._plugin[e]=[]),this._plugin[e].push(r),a.onerror=function(){n(t)},a.onload=function(){i._plugin[e].forEach((function(e){e()}))},document.getElementsByTagName("head")[0].appendChild(a)}catch(o){this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:o.message})}},e}(),Verify=function(){function e(){this.verifyReady=!1,this.waitTime=5e3,this.cleanStatus=!1}return e.prototype.apply=function(e,t){var r=this;this.collector=e,this.config=t;var n=e.adapters.storage;this.cacheStorgae=new n(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",(function(e){e&&e.length&&r.eventStore(e[0])})),this.checkCache()},e.prototype.checkCache=function(){var e=this;this.verifyCookieKey="__applog_verify_set_"+this.config.app_id,this.cacheStorgae.getCookie(this.verifyCookieKey);var t=this.cacheStorgae.getItem(this.verifyCookieKey);this.sign=t&&t.sign||"",this.origin=t&&t.origin||"*";var r=setTimeout((function(){e.cleanVerify(),clearTimeout(r),e.collector.off("submit-verify")}),this.waitTime);window.addEventListener("message",(function(t){t&&t.data&&"simulator:verify"===t.data.type&&(clearTimeout(r),e.receMessage(t))}),!0)},e.prototype.receMessage=function(e){if(!this.cleanStatus){var t=e.data;this.verifyReady=!0,this.sign=t.sign,this.origin=e.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:t.sign,origin:e.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,t.sign,e.origin)}},e.prototype.eventStore=function(e){this.cleanStatus||(this.verifyReady?this.postVerify(e,this.sign,this.origin):this.eventStorage.push(e))},e.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[]},e.prototype.postVerify=function(e,t,r){try{var n=[];isArray$1(e)?e.forEach((function(e){n.push(e)})):n.push(e);var i={type:"simulator:verify:event",sign:t,pageUrl:window.location.href,events:n};(window.opener||window.parent).postMessage(i,r)}catch(a){console.log("web verify post message error ~")}},e}(),RuotePage=function(){function e(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return e.prototype.apply=function(e,t){if(t.spa||t.autotrack){var r=e.Types;this.collect=e,this.config=t,this.appid=t.app_id,this.allowHash=t.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),e.emit(r.RouteReady)}},e.prototype.setKey=function(){var e=this.collect.adapters.storage;this.storage=new e(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:location.href,refer_title:document.title||location.pathname,refer_manual_key:""},this.config.autotrack&&"object"==_typeof$b(this.config.autotrack)&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},e.prototype.hack=function(){var e=this,t=window.history.pushState;history.pushState=function(r){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];"function"==typeof history.onpushstate&&history.onpushstate({state:r});var a=t.call.apply(t,__spread([history,r],n)),o=e.getPopStateChangeEventData();return e.lastLocation=stringify(location.href,n[1]),e.sendPv(o,"pushState"),a};var r=history.replaceState;history.replaceState=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];"function"==typeof history.onreplacestate&&history.onreplacestate({state:t});var a=r.call.apply(r,__spread([history,t],n)),o=e.getPopStateChangeEventData();return e.lastLocation=stringify(location.href,n[1]),e.sendPv(o),a}},e.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},e.prototype.init=function(){var e=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:e,init:!0})},e.prototype.listener=function(){var e=this,t=null;window.addEventListener("hashchange",(function(r){if(e.lastLocation!==window.location.href&&(clearTimeout(t),e.allowHash)){e.lastLocation=window.location.href;var n=e.getPopStateChangeEventData();e.sendPv(n)}})),window.addEventListener("popstate",(function(r){e.lastLocation!==window.location.href&&(t=setTimeout((function(){e.lastLocation=window.location.href;var t=e.getPopStateChangeEventData();e.sendPv(t)}),10))}))},e.prototype.getPopStateChangeEventData=function(){var e=this.pageConfig();return e.is_back=0,e},e.prototype.pageConfig=function(){try{var e,t,r=this.storage.getItem(this.cache_key)||{};e=document.referrer?document.referrer:r&&r.refer_key||"";var n=this.storage.getItem("__tea_cache_first_"+this.appid);return t=!n||1!=n,{is_html:1,url:location.href,referrer:e,page_key:location.href,refer_page_key:e,page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:r&&r.refer_manual_key||"",refer_page_title:r&&r.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+t}}catch(i){return this.collect.emit(DebuggerMesssge$1$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:i.message}),{}}},e.prototype.sendPv=function(e,t){this.collect.emit("route-change",{config:e,init:!1})},e}();Collector$2.usePlugin(PluginExtend,"extend"),Collector$2.usePlugin(Ab,"ab"),Collector$2.usePlugin(Stay,"stay"),Collector$2.usePlugin(AutoTrack,"autotrack"),Collector$2.usePlugin(Verify,"verify"),Collector$2.usePlugin(Et,"et"),Collector$2.usePlugin(Profile,"profile"),Collector$2.usePlugin(CepRule,"cep"),Collector$2.usePlugin(HeartBeat,"heartbeat"),Collector$2.usePlugin(Monitor,"monitor"),Collector$2.usePlugin(RuotePage,"route"),Collector$2.usePlugin(Tracer,"tracer"),new Collector$2("default");var Collector$1$1=Collector$2,es_symbol={},wellKnownSymbolWrapped={},wellKnownSymbol$2=wellKnownSymbol$V;wellKnownSymbolWrapped.f=wellKnownSymbol$2;var global$5=global$1v,path$1=global$5,path=path$1,hasOwn$7=hasOwnProperty_1$1,wrappedWellKnownSymbolModule$1=wellKnownSymbolWrapped,defineProperty$4=objectDefineProperty$1.f,wellKnownSymbolDefine=function(e){var t=path.Symbol||(path.Symbol={});hasOwn$7(t,e)||defineProperty$4(t,e,{value:wrappedWellKnownSymbolModule$1.f(e)})},call$1=functionCall$1,getBuiltIn$6=getBuiltIn$A,wellKnownSymbol$1=wellKnownSymbol$V,defineBuiltIn$2=defineBuiltIn$D,symbolDefineToPrimitive=function(){var e=getBuiltIn$6("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=wellKnownSymbol$1("toPrimitive");t&&!t[n]&&defineBuiltIn$2(t,n,(function(e){return call$1(r,this)}),{arity:1})},$$v=_export$1,global$4=global$1v,call=functionCall$1,uncurryThis$7=functionUncurryThis$1,DESCRIPTORS$7=descriptors$1,NATIVE_SYMBOL$3=symbolConstructorDetection$1,fails$7=fails$1Q,hasOwn$6=hasOwnProperty_1$1,isPrototypeOf$1=objectIsPrototypeOf$1,anObject$1=anObject$L,toIndexedObject$2=toIndexedObject$q,toPropertyKey=toPropertyKey$b,$toString=toString$O,createPropertyDescriptor$2=createPropertyDescriptor$k,nativeObjectCreate=objectCreate$2,objectKeys=objectKeys$8,getOwnPropertyNamesModule=objectGetOwnPropertyNames$1,getOwnPropertyNamesExternal=objectGetOwnPropertyNamesExternal,getOwnPropertySymbolsModule$1=objectGetOwnPropertySymbols$1,getOwnPropertyDescriptorModule$1=objectGetOwnPropertyDescriptor$1,definePropertyModule=objectDefineProperty$1,definePropertiesModule=objectDefineProperties$1,propertyIsEnumerableModule=objectPropertyIsEnumerable$1,defineBuiltIn$1=defineBuiltIn$D,shared$2=shared$c.exports,sharedKey=sharedKey$8,hiddenKeys=hiddenKeys$b,uid=uid$9,wellKnownSymbol=wellKnownSymbol$V,wrappedWellKnownSymbolModule=wellKnownSymbolWrapped,defineWellKnownSymbol$3=wellKnownSymbolDefine,defineSymbolToPrimitive=symbolDefineToPrimitive,setToStringTag$4=setToStringTag$k,InternalStateModule$1=internalState$1,$forEach=arrayIteration$1.forEach,HIDDEN=sharedKey("hidden"),SYMBOL="Symbol",PROTOTYPE="prototype",setInternalState$1=InternalStateModule$1.set,getInternalState$1=InternalStateModule$1.getterFor(SYMBOL),ObjectPrototype=Object[PROTOTYPE],$Symbol=global$4.Symbol,SymbolPrototype$1=$Symbol&&$Symbol[PROTOTYPE],TypeError$1=global$4.TypeError,QObject=global$4.QObject,nativeGetOwnPropertyDescriptor$1=getOwnPropertyDescriptorModule$1.f,nativeDefineProperty=definePropertyModule.f,nativeGetOwnPropertyNames=getOwnPropertyNamesExternal.f,nativePropertyIsEnumerable=propertyIsEnumerableModule.f,push=uncurryThis$7([].push),AllSymbols=shared$2("symbols"),ObjectPrototypeSymbols=shared$2("op-symbols"),WellKnownSymbolsStore=shared$2("wks"),USE_SETTER=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild,setSymbolDescriptor=DESCRIPTORS$7&&fails$7((function(){return 7!=nativeObjectCreate(nativeDefineProperty({},"a",{get:function(){return nativeDefineProperty(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=nativeGetOwnPropertyDescriptor$1(ObjectPrototype,t);n&&delete ObjectPrototype[t],nativeDefineProperty(e,t,r),n&&e!==ObjectPrototype&&nativeDefineProperty(ObjectPrototype,t,n)}:nativeDefineProperty,wrap=function(e,t){var r=AllSymbols[e]=nativeObjectCreate(SymbolPrototype$1);return setInternalState$1(r,{type:SYMBOL,tag:e,description:t}),DESCRIPTORS$7||(r.description=t),r},$defineProperty=function(e,t,r){e===ObjectPrototype&&$defineProperty(ObjectPrototypeSymbols,t,r),anObject$1(e);var n=toPropertyKey(t);return anObject$1(r),hasOwn$6(AllSymbols,n)?(r.enumerable?(hasOwn$6(e,HIDDEN)&&e[HIDDEN][n]&&(e[HIDDEN][n]=!1),r=nativeObjectCreate(r,{enumerable:createPropertyDescriptor$2(0,!1)})):(hasOwn$6(e,HIDDEN)||nativeDefineProperty(e,HIDDEN,createPropertyDescriptor$2(1,{})),e[HIDDEN][n]=!0),setSymbolDescriptor(e,n,r)):nativeDefineProperty(e,n,r)},$defineProperties=function(e,t){anObject$1(e);var r=toIndexedObject$2(t),n=objectKeys(r).concat($getOwnPropertySymbols(r));return $forEach(n,(function(t){DESCRIPTORS$7&&!call($propertyIsEnumerable,r,t)||$defineProperty(e,t,r[t])})),e},$create=function(e,t){return void 0===t?nativeObjectCreate(e):$defineProperties(nativeObjectCreate(e),t)},$propertyIsEnumerable=function(e){var t=toPropertyKey(e),r=call(nativePropertyIsEnumerable,this,t);return!(this===ObjectPrototype&&hasOwn$6(AllSymbols,t)&&!hasOwn$6(ObjectPrototypeSymbols,t))&&(!(r||!hasOwn$6(this,t)||!hasOwn$6(AllSymbols,t)||hasOwn$6(this,HIDDEN)&&this[HIDDEN][t])||r)},$getOwnPropertyDescriptor=function(e,t){var r=toIndexedObject$2(e),n=toPropertyKey(t);if(r!==ObjectPrototype||!hasOwn$6(AllSymbols,n)||hasOwn$6(ObjectPrototypeSymbols,n)){var i=nativeGetOwnPropertyDescriptor$1(r,n);return!i||!hasOwn$6(AllSymbols,n)||hasOwn$6(r,HIDDEN)&&r[HIDDEN][n]||(i.enumerable=!0),i}},$getOwnPropertyNames=function(e){var t=nativeGetOwnPropertyNames(toIndexedObject$2(e)),r=[];return $forEach(t,(function(e){hasOwn$6(AllSymbols,e)||hasOwn$6(hiddenKeys,e)||push(r,e)})),r},$getOwnPropertySymbols=function(e){var t=e===ObjectPrototype,r=nativeGetOwnPropertyNames(t?ObjectPrototypeSymbols:toIndexedObject$2(e)),n=[];return $forEach(r,(function(e){!hasOwn$6(AllSymbols,e)||t&&!hasOwn$6(ObjectPrototype,e)||push(n,AllSymbols[e])})),n};NATIVE_SYMBOL$3||($Symbol=function(){if(isPrototypeOf$1(SymbolPrototype$1,this))throw TypeError$1("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?$toString(arguments[0]):void 0,t=uid(e),r=function e(r){this===ObjectPrototype&&call(e,ObjectPrototypeSymbols,r),hasOwn$6(this,HIDDEN)&&hasOwn$6(this[HIDDEN],t)&&(this[HIDDEN][t]=!1),setSymbolDescriptor(this,t,createPropertyDescriptor$2(1,r))};return DESCRIPTORS$7&&USE_SETTER&&setSymbolDescriptor(ObjectPrototype,t,{configurable:!0,set:r}),wrap(t,e)},SymbolPrototype$1=$Symbol[PROTOTYPE],defineBuiltIn$1(SymbolPrototype$1,"toString",(function(){return getInternalState$1(this).tag})),defineBuiltIn$1($Symbol,"withoutSetter",(function(e){return wrap(uid(e),e)})),propertyIsEnumerableModule.f=$propertyIsEnumerable,definePropertyModule.f=$defineProperty,definePropertiesModule.f=$defineProperties,getOwnPropertyDescriptorModule$1.f=$getOwnPropertyDescriptor,getOwnPropertyNamesModule.f=getOwnPropertyNamesExternal.f=$getOwnPropertyNames,getOwnPropertySymbolsModule$1.f=$getOwnPropertySymbols,wrappedWellKnownSymbolModule.f=function(e){return wrap(wellKnownSymbol(e),e)},DESCRIPTORS$7&&(nativeDefineProperty(SymbolPrototype$1,"description",{configurable:!0,get:function(){return getInternalState$1(this).description}}),defineBuiltIn$1(ObjectPrototype,"propertyIsEnumerable",$propertyIsEnumerable,{unsafe:!0}))),$$v({global:!0,constructor:!0,wrap:!0,forced:!NATIVE_SYMBOL$3,sham:!NATIVE_SYMBOL$3},{Symbol:$Symbol}),$forEach(objectKeys(WellKnownSymbolsStore),(function(e){defineWellKnownSymbol$3(e)})),$$v({target:SYMBOL,stat:!0,forced:!NATIVE_SYMBOL$3},{useSetter:function(){USE_SETTER=!0},useSimple:function(){USE_SETTER=!1}}),$$v({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$3,sham:!DESCRIPTORS$7},{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor}),$$v({target:"Object",stat:!0,forced:!NATIVE_SYMBOL$3},{getOwnPropertyNames:$getOwnPropertyNames}),defineSymbolToPrimitive(),setToStringTag$4($Symbol,SYMBOL),hiddenKeys[HIDDEN]=!0;var NATIVE_SYMBOL$2=symbolConstructorDetection$1,symbolRegistryDetection=NATIVE_SYMBOL$2&&!!Symbol.for&&!!Symbol.keyFor,$$u=_export$1,getBuiltIn$5=getBuiltIn$A,hasOwn$5=hasOwnProperty_1$1,toString$7=toString$O,shared$1=shared$c.exports,NATIVE_SYMBOL_REGISTRY$1=symbolRegistryDetection,StringToSymbolRegistry=shared$1("string-to-symbol-registry"),SymbolToStringRegistry$1=shared$1("symbol-to-string-registry");$$u({target:"Symbol",stat:!0,forced:!NATIVE_SYMBOL_REGISTRY$1},{for:function(e){var t=toString$7(e);if(hasOwn$5(StringToSymbolRegistry,t))return StringToSymbolRegistry[t];var r=getBuiltIn$5("Symbol")(t);return StringToSymbolRegistry[t]=r,SymbolToStringRegistry$1[r]=t,r}});var $$t=_export$1,hasOwn$4=hasOwnProperty_1$1,isSymbol=isSymbol$c,tryToString=tryToString$e,shared=shared$c.exports,NATIVE_SYMBOL_REGISTRY=symbolRegistryDetection,SymbolToStringRegistry=shared("symbol-to-string-registry");$$t({target:"Symbol",stat:!0,forced:!NATIVE_SYMBOL_REGISTRY},{keyFor:function(e){if(!isSymbol(e))throw TypeError(tryToString(e)+" is not a symbol");if(hasOwn$4(SymbolToStringRegistry,e))return SymbolToStringRegistry[e]}});var $$s=_export$1,NATIVE_SYMBOL$1=symbolConstructorDetection$1,fails$6=fails$1Q,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols$1,toObject$1=toObject$D,FORCED$3=!NATIVE_SYMBOL$1||fails$6((function(){getOwnPropertySymbolsModule.f(1)}));$$s({target:"Object",stat:!0,forced:FORCED$3},{getOwnPropertySymbols:function(e){var t=getOwnPropertySymbolsModule.f;return t?t(toObject$1(e)):[]}});var es_object_getOwnPropertyDescriptor={},$$r=_export$1,fails$5=fails$1Q,toIndexedObject$1=toIndexedObject$q,nativeGetOwnPropertyDescriptor=objectGetOwnPropertyDescriptor$1.f,DESCRIPTORS$6=descriptors$1,FAILS_ON_PRIMITIVES$1=fails$5((function(){nativeGetOwnPropertyDescriptor(1)})),FORCED$2=!DESCRIPTORS$6||FAILS_ON_PRIMITIVES$1;$$r({target:"Object",stat:!0,forced:FORCED$2,sham:!DESCRIPTORS$6},{getOwnPropertyDescriptor:function(e,t){return nativeGetOwnPropertyDescriptor(toIndexedObject$1(e),t)}});var es_object_getOwnPropertyDescriptors={},$$q=_export$1,DESCRIPTORS$5=descriptors$1,ownKeys$a=ownKeys$j,toIndexedObject=toIndexedObject$q,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor$1,createProperty=createProperty$c;$$q({target:"Object",stat:!0,sham:!DESCRIPTORS$5},{getOwnPropertyDescriptors:function(e){for(var t,r,n=toIndexedObject(e),i=getOwnPropertyDescriptorModule.f,a=ownKeys$a(n),o={},s=0;a.length>s;)void 0!==(r=i(n,t=a[s++]))&&createProperty(o,t,r);return o}});var es_object_defineProperties={},$$p=_export$1,DESCRIPTORS$4=descriptors$1,defineProperties=objectDefineProperties$1.f;$$p({target:"Object",stat:!0,forced:Object.defineProperties!==defineProperties,sham:!DESCRIPTORS$4},{defineProperties:defineProperties});var es_object_defineProperty={},$$o=_export$1,DESCRIPTORS$3=descriptors$1,defineProperty$3=objectDefineProperty$1.f;function _defineProperty$9(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}$$o({target:"Object",stat:!0,forced:Object.defineProperty!==defineProperty$3,sham:!DESCRIPTORS$3},{defineProperty:defineProperty$3});var $$n=_export$1,$some=arrayIteration$1.some,arrayMethodIsStrict$1=arrayMethodIsStrict$g,STRICT_METHOD$1=arrayMethodIsStrict$1("some");$$n({target:"Array",proto:!0,forced:!STRICT_METHOD$1},{some:function(e){return $some(this,e,arguments.length>1?arguments[1]:void 0)}});var DEBUG$1="undefined"!=typeof window&&window.location.href.indexOf("loggerdebug")>-1;function computeWatchDur(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=0,r=0;r<e.length;r++)isNaN(Number(e[r].end))||isNaN(Number(e[r].begin))||e[r].begin<0||e[r].end<0||e[r].end<e[r].begin||(t+=e[r].end-e[r].begin);return t=parseInt(1e3*t,10)}function getHostFromUrl(e){if(null==e||""===e||"string"!=typeof e)return"";var t=e.split("/"),r="";return t.length>3&&t[2]&&(r=t[2]),r}function generateSessionId(t){var r=(new Date).getTime();try{t=parseInt(t)}catch(e){t=0}return r+=t,window.performance&&"function"==typeof window.performance.now&&(r+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"===e?t:3&t|8).toString(16)}))}function isType(e){return function(t){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")}}function getResponseHeaders(e){var t={};if(e instanceof window.XMLHttpRequest)try{e.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var r=e.split(": "),n=r.shift(),i=r.join(": ");t[n]=i}))}catch(error){}return t}function log$2(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];DEBUG$1&&(t=console).log.apply(t,["[logger]",e].concat(n))}function nowTime$2(){try{return Math.round(window.performance.now())}catch(error){return(new Date).getTime()}}function curTimestamp(){return(new Date).getTime()}function formatData(e,t){var r={ext:e.ext||{},data:{}};return Object.keys(e).map((function(n){t[n]?r.data[t[n]]=e[n]:"ext"!==n&&(r.ext[n]=e[n])})),r}function getXhr(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,i){try{t||i(new Error("url is undefined"));var a=0,o=0,s={},l=new window.XMLHttpRequest;l.open("get",t),l.onreadystatechange=function(){2===l.readyState&&(s.headers=getResponseHeaders(l),s.connectTime=nowTime$2()-o,s.status=l.status,s.statusText=l.statusText,a=nowTime$2()),1===l.readyState&&(o=nowTime$2())},l.onload=function(){n(s)},l.onprogress=function(e){var t,r=nowTime$2()-a;r<5&&(r=nowTime$2()-o),t=parseInt(e.loaded/1e3/(r/1e3),10),s.speed=t,s.costTime=r},l.onerror=function(e){i(e)},l.ontimeout=function(){s.status||(s.status=-2),n(s)},l.onabort=function(){n(s)},l.responseType="arraybuffer",l.timeout=r.timeout||1e4,l.setRequestHeader("Range","bytes=".concat(r.range||"0-1048576")),l.send()}catch(e){i(e)}}))}function checkVideoSrcIsEmpty(e){return!e||window.location.href.indexOf(e)>-1}var KEYMAP={x_response_sinfo:"x-response-sinfo",x_response_cache:"x-response-cache",x_response_cinfo:"x-response-cinfo"};function transformHeader(e){if(!e)return{};var t={};return Object.keys(KEYMAP).map((function(r){if(e[r]||"string"!=typeof KEYMAP[r]){if(!e[r]&&KEYMAP[r]instanceof Array){var n=KEYMAP[r].filter((function(t){return void 0!==e[t]}));n.length>0?t[r]=e[n[0]]:t[r]=""}}else t[r]=e[KEYMAP[r]]||""})),t}function appendData(e,t){return e&&("string"==typeof t||"number"==typeof t)?e+""+t:t}function typeOf(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function parseTempData(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return Object.keys(t).map((function(n){e[n]="append"===r?appendData(e[n],t[n]):t[n]})),e}function hasClass$1(t,r){if(!t||!r)return!1;try{return Array.prototype.some.call(t.classList,(function(e){return e===r}))}catch(e){var n=t.className&&"object"===_typeof$7(t.className)?t.getAttribute("class"):t.className;return n&&!!n.match(new RegExp("(\\s|^)"+r+"(\\s|$)"))}}function formatDefinition(e){return"String"===typeOf(e)?e.replace("P","p"):e?"Number"===typeOf(e)?"".concat(e):void 0:""}function toJsonString(t){try{return JSON.stringify(t)}catch(e){return""}}var ENTRIES=[],MAX_COUNT=30;function findPerformanceInfo(t){var r={};try{var n=function(){t=t.replace(/^http:|^https:/,"");for(var e=ENTRIES||[],n=function(n){if(e[n].name.replace(/^http:|^https:/,"")===t)return["domainLookupEnd","domainLookupStart","startTime","requestStart","responseEnd","responseStart","connectStart","connectEnd","fetchStart"].map((function(t){r[t]=Math.round(e[n][t])})),r.url=e[n].name,r.duration=Math.round(e[n].duration),r.domainDuration=r.domainLookupEnd-r.domainLookupStart,r.connectDuration=r.connectEnd-r.connectStart,"break"},i=e.length-1;i>=0;i--){if("break"===n(i))break}return{v:r}}();if("object"===_typeof$7(n))return n.v}catch(e){return r}}function addPerformaceObserver(){try{new window.PerformanceObserver((function(e,t){var r=e.getEntriesByType("resource");ENTRIES.length>MAX_COUNT&&ENTRIES.splice(0,ENTRIES.length-MAX_COUNT);for(var n=0;n<r.length;n++)ENTRIES.push(r[n])})).observe({entryTypes:["resource"]})}catch(e){console.warn("PerformanceObserver not support",e)}}"undefined"!=typeof window&&addPerformaceObserver();var isSupport$1=_isLocalStorageUsable$1();function probeSupport$1(){try{return"undefined"!=typeof localStorage&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch(e){return!1}}function checkIfLocalStorageThrows$1(){var t="_localstorage_support_test";try{return window.localStorage.setItem(t,!0),window.localStorage.removeItem(t),!1}catch(e){return!0}}function _isLocalStorageUsable$1(){return probeSupport$1()&&!checkIfLocalStorageThrows$1()}var Strorage=isSupport$1?window.localStorage:{},LOGKEY="__xgplayerlogkey",LOCAL_LOG={set:function(e){try{var t=this.get();t.push(e),Strorage.setItem(LOGKEY,JSON.stringify(t))}catch(error){}},get:function(){try{var e=Strorage.getItem(LOGKEY);return e=e?JSON.parse(e):[]}catch(error){return[]}},remove:function(){try{Strorage.removeItem(LOGKEY)}catch(error){}},clear:function(){try{Strorage.clear()}catch(error){}}},es_symbol_description={},$$m=_export$1,DESCRIPTORS$2=descriptors$1,global$3=global$1v,uncurryThis$6=functionUncurryThis$1,hasOwn$3=hasOwnProperty_1$1,isCallable=isCallable$Z,isPrototypeOf=objectIsPrototypeOf$1,toString$6=toString$O,defineProperty$2=objectDefineProperty$1.f,copyConstructorProperties=copyConstructorProperties$6,NativeSymbol=global$3.Symbol,SymbolPrototype=NativeSymbol&&NativeSymbol.prototype;if(DESCRIPTORS$2&&isCallable(NativeSymbol)&&(!("description"in SymbolPrototype)||void 0!==NativeSymbol().description)){var EmptyStringDescriptionStore={},SymbolWrapper=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:toString$6(arguments[0]),t=isPrototypeOf(SymbolPrototype,this)?new NativeSymbol(e):void 0===e?NativeSymbol():NativeSymbol(e);return""===e&&(EmptyStringDescriptionStore[t]=!0),t};copyConstructorProperties(SymbolWrapper,NativeSymbol),SymbolWrapper.prototype=SymbolPrototype,SymbolPrototype.constructor=SymbolWrapper;var NATIVE_SYMBOL="Symbol(test)"==String(NativeSymbol("test")),thisSymbolValue=uncurryThis$6(SymbolPrototype.valueOf),symbolDescriptiveString=uncurryThis$6(SymbolPrototype.toString),regexp=/^Symbol\((.*)\)[^)]+$/,replace$2=uncurryThis$6("".replace),stringSlice$2=uncurryThis$6("".slice);defineProperty$2(SymbolPrototype,"description",{configurable:!0,get:function(){var e=thisSymbolValue(this);if(hasOwn$3(EmptyStringDescriptionStore,e))return"";var t=symbolDescriptiveString(e),r=NATIVE_SYMBOL?stringSlice$2(t,7,-1):replace$2(t,regexp,"$1");return""===r?void 0:r}}),$$m({global:!0,constructor:!0,forced:!0},{Symbol:SymbolWrapper})}var RegMap=[{key:"QQBrowser",reg:/(qqbrowser)\/([\d.]+)/},{key:"QIHU360EE",reg:/qihu 360ee/},{key:"QIHU360SE",reg:/qihu 360se/},{key:"2345Explorer",reg:/(2345explorer)\/([\d.]+)/},{key:"Sogou",reg:/(metasr)/},{key:"Wexin",reg:/(micromessenger)\/([\d.]+)/},{key:"Openlanguage",reg:/(openlanguage)\/([\d.]+)/},{key:"NewsArticle",reg:/(newsarticle)\/([\d.]+)/},{key:"VideoArticle",reg:/(videoarticle)\/([\d.]+)/},{key:"Hotsoon",reg:/(live_stream)_([\d.]+)/},{key:"Aweme",reg:/(aweme)_([\d.]+)/},{key:"Lark",reg:/(lark)\/([\d.]+)/},{key:"PlayStation",reg:/(playstation)/},{key:"BingPreview",reg:/(bingpreview)\/([\d.]+)/},{key:"Baiduspider",reg:/(baiduspider-render)\/([\d.]+)/},{key:"YandexBot",reg:/(yandexbot)\/([\d.]+)/},{key:"Chrome",reg:/(chrome)\/([\d.]+)/},{key:"Safari",reg:/(version)\/([\d.]+)\s*(safari)/}],IERegMap=[{key:"Trident",reg:/(rv:)([\d.]+)/},{key:"Trident",reg:/(msie)\s*([\d.]+)/}];function isSupportMP4(){var e=document.createElement("video"),t={isSupport:!1,mime:""};return"function"==typeof e.canPlayType?(["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"].map((function(r){"probably"===e.canPlayType('video/mp4; codecs="'.concat(r,'"'))&&(t.isSupport=!0,t.mime+="||".concat(r))})),t):(e=null,t)}var SPIDER_UA=["Baiduspider","YandexBot"];function checkIsSpider(e,t){var r=!1;return SPIDER_UA.map((function(t){t===e&&(r=!0)})),/(\+http|; http|\(http):\/\/([\w.]+\/?)\S*/.test(t)&&(r=!0),r}function detect(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e=e.toLocaleLowerCase();var t=/(iphone)/.test(e)||/(ipad)/.test(e),r=/(android)/.test(e),n=/(windows phone)/.test(e),i=t||r||n,a={isIOS:t,isAndroid:r,isMobile:i,isPC:!i,isPad:/(ipad)/.test(e)},o=isSupportMP4();a.isSupportMP4=o.isSupport,a.mime=o.mime;var s="",l=0,u=[],c=RegMap;/trident/.test(e)&&(c=IERegMap);for(var d=0;d<c.length;d++)if(u=c[d].reg.exec(e)){s=c[d].key,l=u.length>2?u[2]:"";break}if(s)a["is".concat(s)]=!0,a.name=s,a.appVersion=l;else{var h=checkIs360();h&&(a.name="360EE")}if(a.name&&"Trident"!==a.name){var f=/(trident)/.exec(e);f&&(a.name=a.name?"".concat(a.name,"_Trident"):"Trident")}return a.isSpider=checkIsSpider(a.name),a}function checkIs360(){var e=navigator.mimeTypes;if(e){for(var t=0;t<e.length;t++){if(e[t].type&&e[t].type.indexOf("360")>-1)return!0;if(e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1)return!0;if(e[t].description&&e[t].description.indexOf("360")>-1)return!0}return!1}}var Browser$1="undefined"!=typeof navigator&&detect(navigator.userAgent),defaultConfig={range:"0-1048576",timer:6e4,timeout:15e3},SpeedCheckTask=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck$b(this,e),Object.keys(defaultConfig).map((function(e){void 0!==t[e]&&null!==t[e]||(t[e]=defaultConfig[e])})),this.options=t,this._headers={},this.intervalId=null,this.ishangUp=!1,this._data={contentLength:0,statusText:"",status:-1,speed:0,costTime:0,connectTime:0,contentType:""},this.url=[]}return _createClass$c(e,[{key:"setData",value:function(e,t){var r=this;if(Object.keys(e).map((function(t){"headers"!==t&&(r._data[t]=e[t])})),e.headers&&Object.keys(e.headers).length>0){this._headers=transformHeader(e.headers),e.headers["content-type"]&&(this._data.contentType=e.headers["content-type"]);var n=(e.headers["content-range"]||"").split("/");n&&n.length>1&&(this._data.contentLength=parseInt(n[1]))}}},{key:"contentLength",get:function(){return this._data.length||0}},{key:"trigger",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"start",n=this.options;this.url=e,!this.url||"start"!==r&&(this.ishangUp||this.intervalId)?log$2("task>>cant`t trigger url",this.ishangUp,this.intervalId):(log$2("task>>trigger url ",e),this.ishangUp=!0,this.intervalId&&this.clear(),this.intervalId=setTimeout((function(){t.clear()}),"start"===r?500:n.timer),getXhr(this.url,{range:"start"===r?"0-1024":n.range,timeout:n.timeout}).then((function(e){log$2("getXhr>>check result ",e),t.setData(e||{}),t.ishangUp=!1})).catch((function(e){log$2("getXhr>>error ",e),t.ishangUp=!1,t._data.status=-1})))}},{key:"url",get:function(){return this.options.url},set:function(e){e&&(this.options.url=e)}},{key:"serverIp",get:function(){return this._headers.x_response_sinfo||""}},{key:"headers",get:function(){return this._headers||{}}},{key:"status",get:function(){return this._data.status||-1}},{key:"speed",get:function(){return this._data.speed}},{key:"clear",value:function(){clearTimeout(this.intervalId),this.intervalId=null}}]),e}(),version$2="0.11.11";function ownKeys$9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$9(Object(r),!0).forEach((function(t){_defineProperty$9(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$9(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}log$2("logger version is ".concat(version$2));var isObject$3=isType("Object"),REPORT_EVENTS={ONE_PLAY:"videoplayer_oneplay",ONE_OPERA:"videoplayer_oneopera",ONE_ERROR:"videoplayer_oneerror",ONE_EVENT:"videoplayer_oneevent",ONE_TEMP:"videoplayer_onetemp"},ERROR_TYPES$1={data:1e3,runtime:1002,parse:1004,network:1003,no_error_handler:9997,custom_error:9998,other:9999,notSupport:1005},ERROR_CODES$1={1:-499991,2:-499992,3:-499993,4:-499994,5:-499995},PLAYBACK_STATE={STOP:0,PLAYING:1,PAUSE:2,ERROR:3,LOADING:4},LOAD_STATES={UNKNOWN:0,PLAYABLE:1,STALLED:2,ERROR:3},ENDED_TYPE={ERROR:1,NEXT:2,ENDED:3,UNLOAD:4,DESTROY:5,PLAY_CATCH:6},LOGTYPES={RETRY:"error_retry",ONEERROR:"oneerror",ONEEVENT:"oneevent",ONETEMP:"onetemp"},CACHE_FILE_TYPE={NO_CACHE:0,CACHED:1},TEA_ID=1300,LS_KEY="__tea_cache_tokens_".concat(TEA_ID),DEFAULT_INTERVAL=-1,MAX_TIME=432e5,MAX_COST=36e5,COMMON_KEYS=["vtype","tag","subtag","codec_type","device_type"],MIN_WAITIONG=200,MAX_STALL_TIME=6e4,AB_SDK_VERSION="",Collector$1=null,XGPlayerAppLogger=function(){function t(r,n){var i=this;if(_classCallCheck$b(this,t),_defineProperty$9(this,"initializeUrlLog",(function(e){var t=e||"";"String"!==typeOf(t)&&(t=""),i.urlLog={initial_url:t,initial_host:getHostFromUrl(t),initial_ip:""}})),_defineProperty$9(this,"onMediaFormatError",(function(e){i.onOneEvent({end_type:(e.error_type||"")+"Error"})})),_defineProperty$9(this,"onDrmTypeChange",(function(e){i.addIfExist("drm_type",{drm_type:e},i._options)})),_defineProperty$9(this,"onReplayBtnClick",(function(){i.resetLoggerParams()})),_defineProperty$9(this,"onBeforeDefinitionChange",(function(){i.resLogs.ldst=nowTime$2(),i._endType="switch"})),_defineProperty$9(this,"onDefinitionChange",(function(e){var t=e.from,r=e.to;i.changeResolution(t,r,i.resLogs.ldst,"switch"),log$2("onDefinitionChange from:".concat(t,", to:").concat(r))})),_defineProperty$9(this,"onDefiChangeSuccess",(function(){log$2("onDefinitionChangeSuccess"),i.updateVideoSize(),i.triggerTask("start")})),_defineProperty$9(this,"onAbrChange",(function(e){var t=e.prev,r=e.cur,n=e.abrInfo;if(i.player.abrInstance){var a=i.player.abrInstance.eventInfo;log$2("abrChange",a),a.last_definition=t,a.now_definition=r,i.abrInfo.abr_event_info.video_switch.push(a),i.changeResolution(t,r,nowTime$2(),"abr_switch",n)}})),_defineProperty$9(this,"onAbrPrestallEnd",(function(e){i.abrInfo.abr_user_info.cancel_abr=e?1:0})),_defineProperty$9(this,"onTimeUpdate",(function(){var e=i.playlogs,t=i.resLogs,r=i.player;if(i.errorLog.try_err_c=0,e.vt||1!==i.startStep||(e.vt=curTimestamp(),log$2("onTimeUpdate: first frame inited","currentTime11:".concat(r.currentTime," vt-pt:").concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt," vt-rt:").concat(e.vt-e.rt)),i.startStep=2),!t.initial_resolution){var n=r.currentDefitionFromPlayer&&r.currentDefitionFromPlayer.definition?r.currentDefitionFromPlayer.definition:r.config.defaultDefinition||r.video.videoHeight+"p"||"";n=formatDefinition(n),t.initial_resolution=n}t.final_resolution||(t.final_resolution=t.initial_resolution);var a=e.played.length;a<1?e.played.push({begin:r.currentTime,end:-1}):e.played[a-1].end=r.currentTime;var o=t.played.length;o<1?t.played.push({begin:r.currentTime,end:-1}):t.played[o-1].end=r.currentTime,i.lastVideoTime=r.currentTime||0,i.updateCurBuffer()})),_defineProperty$9(this,"onCanplay",(function(){log$2("onCanplay","this.startStep:".concat(i.startStep," ").concat(curTimestamp())),i.setVt()})),_defineProperty$9(this,"onLoadeddata",(function(){log$2("onLoadeddata","this.startStep:".concat(i.startStep," ").concat(curTimestamp())),i.setVt(),i.updateVideoSize()})),_defineProperty$9(this,"onLoadStart",(function(){var e=checkVideoSrcIsEmpty(i.player.currentSrc);i.triggerTask("start"),log$2("onLoadStart","this.startStep:".concat(i.startStep," ").concat(curTimestamp()," isSrcEmpty:").concat(e," player.src:").concat(i.player.src)),0!==i.startStep||e||"visible"!==document.visibilityState||i.setPt()})),_defineProperty$9(this,"onDashStateChange",(function(e){log$2("onDashStateChange","this.startStep:".concat(i.startStep," ").concat(nowTime$2()," state:").concat(e));var t=i.playlogs;if(i.startStep<2)switch(e){case"player_start":t.dash_pst=nowTime$2();break;case"wasm_start":t.dash_wst=nowTime$2();break;case"wasm_ready":t.dash_wrt=nowTime$2();break;case"init_finished":t.dash_ift=nowTime$2();break;case"core_start":t.dash_cst=nowTime$2();break;case"start_play":t.dash_spt=nowTime$2()}})),_defineProperty$9(this,"onMp4StateChange",(function(e){var t=e.state;(i.exInfo.states.length>10||"player_start"===t)&&(i.exInfo.states=[]),i.exInfo.states.push(e)})),_defineProperty$9(this,"onBufferedChange",(function(){var e=i.player.video&&i.player.video.buffered;if(e){var t=e.length;t>0&&e.end(t-1)+1>i.player.duration&&(i.bft=curTimestamp())}})),_defineProperty$9(this,"onPlayerInited",(function(){log$2("player init"),i._playerCreatedTime=curTimestamp(),i.playlogs.rt=curTimestamp()})),_defineProperty$9(this,"onNotAutoPlay",(function(){log$2("onNotAutoPlay","autoplay:".concat(i.isAutoplay)),0===i.isAutoplay?i.isAutoplay=2:1===i.isAutoplay&&(i.isAutoplay=3)})),_defineProperty$9(this,"onDashError",(function(e){e=e||{};var t=i.errorLog;t.last_errors.push(e.errorCode),t.accu_errc++,i.onOneError({errorType:e.errorTypeCode,code:e.errorCode,url:e.url||"",headers:e.headers||{}},0)})),_defineProperty$9(this,"onPlayerError",(function(e){e=e||{};var t=i.errorLog,r=i.player,n=i.line_app_id;if(log$2("onPlayerError","this.player.type:".concat(i.player.type," this.player.replayRunning:").concat(i.player.replayRunning," isSupportMP4:").concat(Browser$1.isSupportMP4," isPC:").concat(Browser$1.isPC)),log$2("onPlayerError",e),i.load_state=LOAD_STATES.ERROR,i._endType="error",i.suspendWaitingStatus("onPlayerError"),"dash"!==r.type||!r.replayRunning){if(e.url||(e.url=i.player.currentSrc),(1768===n||9999===n)&&Browser$1.isPC&&!Browser$1.isSupportMP4||Browser$1.isSpider)return t.errc=ERROR_CODES$1[5],t.errt=ERROR_TYPES$1.notSupport,i.onOneError({errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{}},0),void(i._isOnePlayReport=!0);t.errt=e.errorTypeCode||(e.errorType&&ERROR_TYPES$1[e.errorType]?ERROR_TYPES$1[e.errorType]:9999),e.errorCode?t.errc=e.errorCode>0&&ERROR_CODES$1[e.errorCode]?ERROR_CODES$1[e.errorCode]:e.errorCode:e.code&&(t.errc=e.code>0&&ERROR_CODES$1[e.code]?ERROR_CODES$1[e.code]:e.code),t.last_errors.push(t.errc),0===t.fir_errc&&(t.fir_errc=t.errc),i.onOnePlay(ENDED_TYPE.ERROR),i.onOneTemp(ENDED_TYPE.ERROR),i.sendDegradeLog("playCatch_end",i.playlogs.degrade),i.onOneError({errorType:t.errt,code:t.errc,url:e.url,headers:e.headers||{}}),i.sendEventsQueue()}})),_defineProperty$9(this,"onPlayInterfaceInfo",(function(e){log$2("onPlayInterfaceInfo",e);var t=i.errorLog,r=i.apiLog,n=i.playlogs;if(e&&Object.keys(e).map((function(t){"code"===t?r.vsc=e[t]:"message"===t?r.vsc_message=e.message||"success":r[t]=e[t]})),n.at=e.timestamep||(new Date).getTime(),(!e.error||-9988!==e.error.errc)&&(r.vsc=e.code||10,r.vsc_message=e.message||"success",e.error)){var a=e.error;t.errt=1e3,t.errc=a.errc||-9998,t.last_errors.push(a.errc||-9998),0===t.fir_errc&&(t.fir_errc=a.errc||-9998),t.accu_errc++,1===t.accu_errc&&(t.fir_errt=nowTime$2()),i.onOneError({errorType:1e3,code:a.errc||-9998,url:"",headers:{}})}})),_defineProperty$9(this,"onProgressEvent",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=i.netLog;if(e.speed){var r=e.speed>1e6?Math.floor(e.speed/1e3):e.speed;t.downloadSpeed=r,t.totalSpeed+=r,t.rqCount++}"oversize"!==e.type&&t.requestCount++,e.connectTime&&(t.connectCost=e.connectTime);var n=t.rqCount<7?100:e.costTime>=5e3?20:10;if(!("success"===e.type&&parseInt(100*Math.random(),10)<=n)){var a=findPerformanceInfo(e.cdnUrl),o=e.xhr||{},s=e.type?"progress_".concat(e.type):"progress",l=e.headers;l||(l=getResponseHeaders(o));var u=_objectSpread$3(_objectSpread$3({},l=transformHeader(l)),{},{download_speed:t.downloadSpeed,connect_cost:t.connectCost,c_dur:a.connectDuration||0,d_dur:a.domainDuration||0,r_dur:a.duration||0,rqtt:(new Date).getTime(),x_cache:l.x_response_cache||"",server_ip:l.x_response_sinfo});e.status?t.status=e.status:o&&o instanceof window.XMLHttpRequest&&(t.status=o.status||0),u.status=t.status;var c=e.cdnUrl||e.url;"error"===e.type&&i.merror.cdn.push(_objectSpread$3(_objectSpread$3({costTime:e.costTime,cur_play_pos:e.pos,cdn_url:c,cdn_host:getHostFromUrl(c)},u),l)),i.onOneEvent({costTime:e.costTime,vid:e.vid,end_type:s,cur_play_pos:e.pos,cdn_url:c,cdn_host:getHostFromUrl(c)},u,"error"===e.type?0:2)}})),_defineProperty$9(this,"onNext",(function(e){if(log$2("onNext:startStep:",i.startStep),i.startStep>0){if(i._reportInvalidVV(ENDED_TYPE.NEXT))return;i.onOnePlay(ENDED_TYPE.NEXT),i.onOneTemp(ENDED_TYPE.NEXT),i.sendEventsQueue()}i.vtype=null,i.playlogs.lc=0,i.resetLoggerParams()})),_defineProperty$9(this,"onNextEnded",(function(){var e=i.player,t=i.resLogs,r=formatDefinition(e.config.defaultDefinition||"");t.initial_resolution=r,t.final_resolution=r})),_defineProperty$9(this,"onXgLogWaiting",(function(e){var t=i.playlogs,r=i.resLogs,n=i.stall;if(i._options.checkByInnerLog&&0===e.type){log$2("onXgLogWaiting",e);var a=e.endType,o=e.costTime,s=e.start,l={download_speed:i.mp4Speed,avg_speed:i.mp4RealSpeed,mse_op:i.mp4MseOpLength,mp4_load_range:i.mp4LoadSegmentTimeRange,bitrate:i.curBitrate};if("waitingStart"===e.eventType)return i.onOneEvent({costTime:o,end_type:"waitstart"},l,2),void i.appendStallInfo("start",s);if("waitingEnd"===e.eventType){var u=nowTime$2();log$2("onXgLogWaiting>>".concat(a,"|costTime:").concat(o,"  vt:").concat(t.vt)),i.appendStallInfo("end",u,a),t.bc++,i.checkInBuffer(i.player.currentTime)?(t.de_bu_acu_t+=o,t.dbc++):(t.nbc++,t.n_bu_acu_t+=o),r.bc++,t.bu_acu_t+=o,r.bu_acu_t+=o,n.stall_end=u,n.stall_last_interval=n.stall_end-n.stall_start,n.stall_acc_time+=n.stall_last_interval,1===n.sc&&(n.first_buf_endt=u),i.onOneEvent({costTime:o,end_type:"waitend"},l,2)}}})),_defineProperty$9(this,"onSeeking",(function(){if(!checkVideoSrcIsEmpty(i.player.src)){var e=i.resLogs,t=i.playlogs,r=i.player,n=i.seekLog;log$2("onSeeking","currentTime:".concat(r.currentTime)),0===i.startStep&&i.setPt(),i.suspendWaitingStatus("seek"),i.isSeeking&&i.suspendSeekStatus("seek",!1),i.isSeeking=!0,t.played.push({begin:i.player.currentTime,end:-1}),e.played.push({begin:i.player.currentTime,end:-1}),n.lastSeekStartTime=nowTime$2(),n.seekBefore=i.lastVideoTime.toString(),n.intervalId=setTimeout((function(){i.isSeeking&&i.suspendSeekStatus("seekTimeout",!0)}),MAX_STALL_TIME)}})),_defineProperty$9(this,"onSeeked",(function(){checkVideoSrcIsEmpty(i.player.src)||i.isSeeking&&i.suspendSeekStatus("seeked",!0)})),_defineProperty$9(this,"onPlaying",(function(){i.suspendWaitingStatus("play"),i.load_state=LOAD_STATES.PLAYABLE;var e=nowTime$2();i.pauseLog.isPausing&&(i.pauseLog.isPausing=!1,i.pauseLog.pause_acu_t+=e-i.pauseLog.pause_start)})),_defineProperty$9(this,"onPlayCatch",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0};if(log$2("onPlayCatch",e,t),e){var r=i.errorLog,n=i.playlogs,a=i.merror;a.playCatch.push(_objectSpread$3({errc:t.errorCode,errt:t.errorType},t.headers)),i.setBr("playcatch"),r.accu_errc++,r.try_err_c++,r.fir_errc=t.errorCode,t.errorCode&&r.last_errors.push(t.errorCode),i.suspendWaitingStatus("playcatch"),i.sendDegradeLog("playCatch",n.degrade,{cdn_url:t.url}),"mp42dash"===e?i.vtype="DASH_2":"dash2mp4"===e?i.vtype="MP4_2":"dash1mp4"===e&&(i.vtype="MP4_1"),n.degrade=e,i.onOneError({errorType:t.errorTypeCode,code:t.errorCode,url:t.url||"",status:t.httpCode||t.status,headers:t.headers||{},vid:t.vid||i.vid,preload_hit:t.preloadHit||0,preload_cached:t.preloadCached||0,endState:ENDED_TYPE.PLAY_CATCH,costTime:t.costTime,message:t.errorMessage},0)}})),_defineProperty$9(this,"onMediaExpied",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:"",errorTypeCode:0,errorCode:0,url:"",headers:{},status:0},t=i.errorLog,r=i.playlogs;log$2("onMediaExpied",e),i.suspendWaitingStatus("expied"),i.setBr("expied"),t.accu_errc++,t.try_err_c++,t.last_errors.push(e.errorCode),r.at=(new Date).getTime(),i.merror.expied.push(_objectSpread$3({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status},transformHeader(e.headers||{}))),i.onOneError({errorType:e.errorTypeCode||e.errorType,code:e.errorCode,url:e.url||"",status:e.status,headers:e.headers||{}},0)})),_defineProperty$9(this,"onLog",(function(e){log$2("onLog",e);var t=e.type;if(delete e.type,t)switch(t){case LOGTYPES.RETRY:break;case LOGTYPES.ONETEMP:i._templog||(i._templog={}),i._templog=parseTempData(i._templog,e.data,e.action),i._templog.preload_hit&&(i._cacheFile=CACHE_FILE_TYPE.CACHED);break;case LOGTYPES.ONEERROR:var r=i.errorLog;r.accu_errc++,r.try_err_c++,i.setBr("mp4error"),r.last_errors.push(e.code),i.onOneError(e,0);break;case LOGTYPES.ONEEVENT:var n=formatData(e,{costTime:"costTime",vid:"vid",end_type:"end_type",pos:"cur_play_pos",cdnUrl:"cdn_url"});n.ext&&["start","end"].map((function(e){n.ext[e]&&(n.ext["ext_".concat(e)]=n.ext[e],delete n.ext[e])})),i.onOneEvent(n.data,n.ext,2)}})),_defineProperty$9(this,"onPlay",(function(){log$2("onPlay","this.startStep :".concat(i.startStep," this.isEnded:").concat(i.isEnded)),i.isEnded&&(i.resetLoggerParams(),i.setPt())})),_defineProperty$9(this,"onPause",(function(){log$2("onPause");var e=i.pauseLog;e.isPausing=!0,e.pause_start=nowTime$2()})),_defineProperty$9(this,"onWaiting",(function(){var e=i.stall;i._options.checkByInnerLog||(log$2("onWaiting>","isSeeking:".concat(i.isSeeking," startStep:").concat(i.startStep," intervalId:").concat(e.intervalId)),i.isSeeking||0===i.playlogs.vt||i.inWaitingStart>0||(e.intervalId&&(window.clearTimeout(e.intervalId),e.intervalId=null),i.inWaitingStart=nowTime$2(),e.intervalId=window.setTimeout((function(){var e=i.stall;log$2("stall.intervalId>>".concat(e.intervalId," cost: ").concat(nowTime$2()-i.inWaitingStart)),i._endType="wait",i.load_state=LOAD_STATES.STALLED,i.vtype.indexOf("MP4")>-1&&i.player.currentTime>10&&i.task&&(i.triggerTask("waiting",i.initial_url),i.requestCount++),e.stall_start=i.inWaitingStart,1===e.sc&&(e.first_buf_startt=i.inWaitingStart),window.clearTimeout(e.intervalId),e.intervalId=null,i.startWaitingStatus(i.inWaitingStart,nowTime$2()-i.inWaitingStart),e.intervalId=setTimeout((function(){i.inWaitingStart>0&&i.suspendWaitingStatus("waitTimeout")}),MAX_STALL_TIME)}),MIN_WAITIONG)))})),_defineProperty$9(this,"onEnded",(function(){if(i.initial_url){log$2("onEnded","watchDur:".concat(i.watchDur," vt:").concat(i.vt," pt:").concat(i.pt)),i.isEnded=!0;var e=i.resLogs.df;i.changeResolution(e,e,nowTime$2(),"leave_switch"),i.onOnePlay(ENDED_TYPE.ENDED),i.sendDegradeLog("playCatch_end",i.playlogs.degrade),i.onOneTemp(ENDED_TYPE.ENDED),i.sendEventsQueue(),i.playlogs.lc++}})),_defineProperty$9(this,"onUnload",(function(){0!==i.startStep&&i.initial_url&&(i.onOneTemp(ENDED_TYPE.UNLOAD),i.sendDegradeLog("playCatch_end",i.playlogs.degrade),i._reportInvalidVV(ENDED_TYPE.UNLOAD)||(i._options.disableLocalCache?i.onOnePlay(ENDED_TYPE.UNLOAD,!1):i.onOnePlay(ENDED_TYPE.UNLOAD,!0)))})),_defineProperty$9(this,"onVisibilitychange",(function(){var e=i.playlogs.vt;"visible"===document.visibilityState&&(e||i.setPt())})),_defineProperty$9(this,"onDestroy",(function(){log$2("onDestroy:this.startStep:".concat(i.startStep," initial_url:").concat(i.initial_url," ").concat(!!i.initial_url)),console.log(">>>onDestroy",i.startStep>0&&!!i.initial_url),i.onOnePlay(ENDED_TYPE.DESTROY),i.startStep>0&&i.initial_url&&(i.onOneTemp(ENDED_TYPE.DESTROY),i.sendDegradeLog("playCatch_end",i.playlogs.degrade));var e=i.resLogs.df;i.changeResolution(e,e,nowTime$2(),"leave_switch"),i.sendEventsQueue(),Browser$1.isPC?window.removeEventListener("beforeunload",i.onUnload):(Browser$1.isMobile||Browser$1.isPad)&&window.removeEventListener("pagehide",i.onUnload),document.removeEventListener("visibilitychange",i.onVisibilitychange),i.listeners.forEach((function(e){i.player.off(e.evt,e.handler)})),i.clearTimers(),i.player.off("destroy",i.onDestroy),i.task&&i.task.clear()})),_defineProperty$9(this,"onOnePlay",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(log$2("onOnePlay _isOnePlayReport:".concat(i._isOnePlayReport," isLeave: ").concat(t," endState:").concat(e)),!i._isOnePlayReport){var r=i.errorLog,n=i.playlogs,a=i.abrInfo,o=i.resLogs,s=i.player,l=i.apiLog,u=i.pauseLog,c=i.stall,d=i.netLog,h=i.watchDur;i._isOnePlayReport=!0;var f=curTimestamp(),p=0,y=0,m=s.video&&s.video.buffered;if(m){for(var g=m.length,v=0,b=0;b<g;b++)v+=m.end(b)-m.start(b);p=y=1e3*v}var _=i.mp4FFInfo;Object.keys(_).map((function(e){i.exInfo[e]=_[e]})),i.setPerformance(),i.setStat();var E=_objectSpread$3(_objectSpread$3(_objectSpread$3({local_time:(new Date).getTime(),log_type:"video_playq",plugin_exception:0,player_create_exception:"",v:i.vid,initial_url:i.initial_url,initial_host:i.initial_host,initial_ip:i.curHeaders.x_response_sinfo||0,initial_type:i.initial_type},i.curHeaders),{},{initial_resolution:o.initial_resolution,final_resolution:o.final_resolution,pt:i.pt,prepare_start_time:n.nt,prepare_end_time:n.rt||curTimestamp(),vt:i.vt,lt:i.lt,lpt:i.lpt,fvt:i.fvt,nvt:i.nvt,bft:i.bft,sc:i.seekLog.sc,sat:i.seekLog.sat,bc:i.bc,dbc:n.dbc||0,nbc:n.nbc||0,video_net_s:i.videoNetworkState,status:i.curStatus,first_buf_startt:c.first_buf_startt,first_buf_endt:c.first_buf_endt,lc:n.lc,bu_acu_t:i.bu_acu_t>MAX_TIME?0:i.bu_acu_t,de_bu_acu_t:n.de_bu_acu_t||0,n_bu_acu_t:n.n_bu_acu_t||0,pause_acu_t:u.pause_acu_t,cur_play_pos:i.cur_play_pos,load_state:i.load_state,play_speed:i.playbackRate,playback_state:i.playback_state,end_state:e,watch_dur:h>MAX_TIME?0:h,switch_resolution_c:i.switchResolutionCount,is_start_play_automatically:i.isAutoplay,start_time:i.start_time,finish:i.finish,errt:r.errt,errc:r.errc,vsc:l.vsc,vsc_message:l.vsc_message,api_str:l.api_str,auth:l.auth||l.logid,width:i.videoWidth,height:i.videoHeight,vd:i.vd,video_length:parseInt(p,10),audio_length:parseInt(y,10),df:i.resolution,lf:o.lf,play_c:0,player_created_t:i.player_created_t,fir_errt:r.fir_errt,fir_errc:r.fir_errc,lv_method:0,ldst:o.ldst,ldet:o.ldet,is_disable_short_seek:0,mute:i.mute,volume:i.volume,download_speed:i.mp4RealSpeed?i.mp4RealSpeed:i.task&&i.task.speed?i.task.speed:d.downloadSpeed,avg_speed:i.mp4Speed?i.mp4Speed:d.rqCount>0?parseInt(d.totalSpeed/d.rqCount,10):0,bitrate:i.curBitrate,preload_state:i.preloadState,preload_hit:i.preLoadData.hit,preload_cached:i.preLoadData.duration||i.preLoadData.byteLength,mdl_req_num:d.requestCount,watingcost:i.watingCost,br:n.br,fbrt:n.fbrt,try_err_c:r.try_err_c,accu_errc:r.accu_errc,dash_pst:i.dash_pst,dash_wst:i.dash_wst,dash_wrt:i.dash_wrt,dash_ift:i.dash_ift,dash_cst:i.dash_cst,dash_spt:i.dash_spt,dash_break:2===s.dashBufferBreak?1:0,merror:toJsonString(i.merror),ex:toJsonString(i.exInfo),bufs:toJsonString(i.buffers.allBuffer),vs:o.vs,vds:o.vds,vps:o.vps},i.buffers.curBuffer),{},{degrade:n.degrade,cache_file:i._cacheFile});if(0!==i.vt&&(E.et=f),s&&s.config&&s.config.codecType&&(E.codec_type=s.config.codecType),s&&s.dashState&&(E.dash_state=s.dashState),["drm_type","dynamic_type","enable_bash"].forEach((function(e){i.addIfExist(e,i._options,E)})),s.abrInstance){var T=s.abrInstance;if(a.abr_general_info=T.generalInfo,a.abr_event_info.video_exit={local_time_ms:(new Date).getTime(),buffer_length:T.bufferLength,internet_speed:T.downloadSpeed,now_bitrate:T.nowBitrate,play_speed:i.player.playbackRate},T.getAbrPlayInfo&&(a.abr_play_info=T.getAbrPlayInfo()),T.getAbrVVStats){var S=T.getAbrVVStats();Object.keys(S).forEach((function(e){E[e]=S[e]}))}}a.abr_init_opts=i.player.config.autoBitrateOpts||{},E.abr_info=toJsonString(i.abrInfo),t?i.reportLog(REPORT_EVENTS.ONE_PLAY,E,t):i.reportLog(REPORT_EVENTS.ONE_PLAY,E)}})),_defineProperty$9(this,"onOneEvent",(function(e){var t=e.costTime,r=e.vid,n=e.end_type,a=e.cur_play_pos,o=e.cdn_url,s=e.cdn_host,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0,c=i.buffers.curBuffer,d=_objectSpread$3({local_time:(new Date).getTime(),v:r||i.vid,cost_time:t,end_type:n||i.end_type,cdn_url:o||i.url,cdn_host:s||"",initial_type:i.initial_type,resolution:i.resolution,play_speed:i.playbackRate,first_frame_interval:nowTime$2()-i.pt,last_switch_interval:i.getLastInterval("lastSwitchStartTime",i.resLogs,!1),last_seek_interval:i.updateSeekPt(!1),last_event_interval:i.getLastInterval("lastEventTime"),cur_play_pos:a||i.cur_play_pos,video_ready_s:i.videoReadyState,video_seeking:i.videoSeeking,video_paused:i.videoPaused,bufs:toJsonString(i.buffers.allBuffer),retry_count:i.retry_count,at:i.playlogs.at,stay_seconds:parseInt(((new Date).getTime()-i.playlogs.at)/1e3,10),preload_state:i.preloadState,preload_hit:i.preLoadData.hit,preload_cached:i.preLoadData.duration||i.preLoadData.byteLength},c);if("waitstart"===n&&"function"==typeof i._options.getPageFPS){var h=i._options.getPageFPS();d.cur_fps=h.curFPS||0,d.avg_fps=h.avgFPS||0}var f=i.player;f&&f.dashState&&(d.dash_state=i.player.dashState),f&&f.config&&f.config.codecType&&(d.codec_type=f.config.codecType),Object.keys(l).forEach((function(e){d[e]=l[e]})),i.addIfExist("drm_type",i._options,d),i.reportLog(REPORT_EVENTS.ONE_EVENT,d,u)})),_defineProperty$9(this,"onOneTemp",(function(){if(log$2("onOneTemp>>",!i._templog),i._templog){var e=i.player,t=i.playlogs,r=i.pauseLog,n=i.errorLog,a=i.resLogs,o=i.watchDur,s=_objectSpread$3(_objectSpread$3(_objectSpread$3({local_time:(new Date).getTime()},i._templog),{},{v:i.vid,initial_type:i.initial_type,pt:i.pt,vt:i.vt,lt:i.lt,fvt:i.fvt,bc:i.bc,bu_acu_t:i.bu_acu_t>MAX_TIME?0:i.bu_acu_t,pause_acu_t:r.pause_acu_t,cur_play_pos:i.cur_play_pos,watch_dur:o>MAX_TIME?0:o,finish:i.finish,errt:n.errt,errc:n.errc,vd:i.vd,df:i.resolution,lf:a.lf,br:t.br,fbrt:t.fbrt,try_err_c:n.try_err_c,accu_errc:n.accu_errc,dash_break:2===e.dashBufferBreak?1:0,bufs:toJsonString(i.buffers.allBuffer),vs:a.vs,vds:a.vds,vps:a.vps},i.buffers.curBuffer),{},{degrade:t.degrade});0!==i.vt&&(s.et=curTimestamp()),["drm_type","dynamic_type","enable_bash"].forEach((function(e){i.addIfExist(e,i._options,s)})),e&&e.config&&e.config.codecType&&(s.codec_type=e.config.codecType),i.reportLog(REPORT_EVENTS.ONE_TEMP,s,0),i._templog=null}})),this.player=r,void 0===this.player||null===this.player)throw new Error("player is ".concat(this.player));if(n&&n.line_app_id){(n.isTask||void 0===n.isTask)&&(this.task=new SpeedCheckTask),this.eventQueue=[],this._instanceCreateTime=(new Date).getTime(),n.codec_type=n.codec_type||"h264",this._options=n,!this._options.maxQueueCount&&(this._options.maxQueueCount=5),this.line_app_id=parseInt(n.line_app_id,10)||0,this.line_user_id=(n.line_user_id||"").toString(),this.version=version$2,this.sdk_version=version$2,this.playerCoreVersion=n.playerCoreVersion||"",this.playerVersion=n.playerVersion||n.sdk_version,this.closeSeekLog=n.closeSeekLog||!1,this.start_time=1e3*(n.start_time||0),this.isFullAB=n.isFullAB||!1,this._initial_resolution="",this.__vtype=null,this.__dt="",this.isLowMp4=!1,this.resetLoggerParams();try{this.initializeTracker(),this.sendLocalLog(),this.bindEvt(),log$2("logger constructor:"+this.player.video)}catch(e){console.log(e)}}else console.warn("player.config.vodLogOpts.line_app_id is necessary for plugin xgVodLogger")}return _createClass$c(t,[{key:"resetLoggerParams",value:function(){log$2("resetLoggerParams");var e=this.playlogs?this.playlogs.lc:0;this.playlogs={nt:curTimestamp(),vt:0,rt:this.isEnded?curTimestamp():0,at:0,pt:0,bu_acu_t:0,bc:0,br:0,fbrt:"",dbc:0,de_bu_acu_t:0,nbc:0,n_bu_acu_t:0,played:[{begin:0,end:-1}],dash_pst:0,dash_wst:0,dash_wrt:0,dash_ift:0,dash_cst:0,dash_spt:0,interruptCount:0,degrade:"none",lc:e},this.degradeLog={bu_acu_t:0,bc:0,watch_dur:0,hasSendEnd:!1},this.buffers={allBuffer:[],curBuffer:{buf_diff:0,buf_s_pos:0,buf_e_pos:0,buf_include:0}},this.netLog={downloadSpeed:0,requestCount:0,connectCost:0,totalSpeed:0,rqCount:0,status:0},this.merror={cdn:[],player:[],playCatch:[],expied:[]},this.exInfo={buffer:{},stall:[],states:[]},this._templog=null,this._isOnePlayReport=!1,this.startStep=0,this.bft=0,this.initializeLogDatas(),this.initializeUrlLog()}},{key:"initializeLogDatas",value:function(){this.startStep=0,this.inWaitingStart=0,this.lastVideoTime=0,this._endType="",this._retryCount=0,this.lastOperaTime=DEFAULT_INTERVAL,this.lastEventTime=DEFAULT_INTERVAL,this.seekLog={intervalId:0,lastSeekStartTime:nowTime$2(),seekBefore:0,sat:0,sc:0},this.resLogs={lastSwitchStartTime:DEFAULT_INTERVAL,switch_count:0,abr_switch_count:0,initial_resolution:"",final_resolution:"",ldst:0,ldet:0,df:"",lf:"",played:[],bc:0,bu_acu_t:0,sc:0,sat:0,buf:0,lbuf:0,lplayed:0,vs:0,vds:0,vps:0,vis:0,bitrate:0},this.apiLog={code:0,message:"",logid:"",api:"",auth:"",error:{}},this.errorLog={accu_errc:0,try_err_c:0,errt:0,errc:0,fir_errt:0,fir_errc:Browser$1.isSupportMP4?0:1005,last_errors:[]},this.pauseLog={pause_acu_t:0,isPausing:!1,pause_start:0},this.stall={intervalId:0,stall_count:0,first_buf_startt:0,first_buf_endt:0,stall_start:0,stall_end:0,stall_last_interval:0,stall_acc_time:0},this._playerCreatedTime=0,this.load_state=LOAD_STATES.UNKNOWN,this.lv_method=6,this.isSeeking=!1,this.isEnded=!1,this.startStep=0,this.isAutoplay=this.player.config&&this.player.config.autoplay?1:0,this.abrInfo={abr_general_info:{},abr_event_info:{video_switch:[],video_stall:[],video_exit:{}},abr_play_info:{start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[]}},abr_user_info:{cancel_abr:0},abr_init_opts:this.player.config.autoBitrateOpts||{}},this._cacheFile=CACHE_FILE_TYPE.NO_CACHE}},{key:"initSessionId",value:function(){var e="0";try{e=window.localStorage.getItem(LS_KEY).web_id||"0"}catch(error){e="0"}this._sessionId=generateSessionId(e),log$2("sessionId ".concat(this._sessionId))}},{key:"initializeTracker",value:function(){var e=this._options;if(window.__xgplayer_vod_log__)this.tracker=window.__xgplayer_vod_log__;else{this.tracker=window.__xgplayer_vod_log__=new Collector$1("tracker");var t=e.channel||"cn",r={app_id:"cn"===(t="va"===t||"sg"===t?t:"cn")?TEA_ID:1300===TEA_ID?323254:TEA_ID,channel:t,log:!1,disable_sdk_monitor:!0};e.channelDomain&&(r.channel_domain=e.channelDomain),r.enable_ab_test=!!e.enableAbTest,this.tracker.init(r)}this.initSessionId();var n=navigator?navigator.hardwareConcurrency:0,i=navigator?navigator.deviceMemory:0;this.commonParams={play_type:0,source_type:"vid",sdk_version:this.sdk_version,pc:this.playerCoreVersion,pv:this.playerVersion,line_app_id:this.line_app_id,line_user_id:this.line_user_id,app_version:e.appVersion||"",platform:Browser$1.isPad?"pad":Browser$1.isMobile?"mobile":"pc",cpu_core:Number(n)||0,memory_size:Number(i)||0},log$2("commonParams ",this.commonParams);var a={evtParams:this.commonParams,disable_auto_pv:!0};log$2("Browser.name ",Browser$1.name),!Browser$1.name||Browser$1.isChrome||Browser$1.isSafari||(a.browser=Browser$1.name,Browser$1.appVersion&&(a.browser_version=Browser$1.appVersion)),this.line_user_id&&(a.user_unique_id=this.line_user_id,a.web_id=this.line_user_id),e.referrer&&(a.referrer=e.referrer,a.referrer_host=getHostFromUrl(e.referrer)),this.tracker.config(a),this.tracker.start()}},{key:"resetDefiInfo",value:function(){var e=this.resLogs;e.played=[],e.bc=0,e.bu_acu_t=0,e.sc=0,e.sat=0}},{key:"sendLocalLog",value:function(){var e=this,t=LOCAL_LOG.get();LOCAL_LOG.remove(),t.map((function(t){Object.keys(t).map((function(r){if(log$2("sendLocalLog",r,t[r]),e.player){e.player.emit("abLog",r,t[r]);var n=e._options.sendLocalCallback;n&&"function"==typeof n&&n(r,t[r])}e._track(r,t[r])}))}))}},{key:"_track",value:function(e,t){"function"==typeof this.tracker?this.tracker(e,t):this.tracker.event(e,t)}},{key:"bindEvt",value:function(){var e=this;this.listeners=[{evt:"play",handler:this.onPlay},{evt:"playing",handler:this.onPlaying},{evt:"pause",handler:this.onPause},{evt:"waiting",handler:this.onWaiting},{evt:"playInterfaceInfo",handler:this.onPlayInterfaceInfo},{evt:"DRM_ERROR",handler:this.onDashError},{evt:"ended",handler:this.onEnded},{evt:"loadeddata",handler:this.onLoadeddata},{evt:"loadstart",handler:this.onLoadStart},{evt:"canplay",handler:this.onCanplay},{evt:"dashStateChange",handler:this.onDashStateChange},{evt:"mp4StateChange",handler:this.onMp4StateChange},{evt:"autoplay was prevented",handler:this.onNotAutoPlay},{evt:"autoplay_was_prevented",handler:this.onNotAutoPlay},{evt:"seeking",handler:this.onSeeking},{evt:"seeked",handler:this.onSeeked},{evt:"complete",handler:this.onPlayerInited},{evt:"timeupdate",handler:this.onTimeUpdate},{evt:"bufferedChange",handler:this.onBufferedChange},{evt:"beforeDefinitionChange",handler:this.onBeforeDefinitionChange},{evt:"definitionChange",handler:this.onDefinitionChange},{evt:"definitionChangeSuccess",handler:this.onDefiChangeSuccess},{evt:"drmTypeChange",handler:this.onDrmTypeChange},{evt:"replayBtnClick",handler:this.onReplayBtnClick},{evt:"initialUrl",handler:this.initializeUrlLog},{evt:"ABR_CHANGE",handler:this.onAbrChange},{evt:"playCatch",handler:this.onPlayCatch},{evt:"MEDIA_EXPIRED",handler:this.onMediaExpied},{evt:"log",handler:this.onLog},{evt:"ABR_PRESTALL_END",handler:this.onAbrPrestallEnd},{evt:"progress_event",handler:this.onProgressEvent},{evt:"logger_next",handler:this.onNext},{evt:"playnext",handler:this.onNext},{evt:"nextEnded",handler:this.onNextEnded},{evt:"media_format_error",handler:this.onMediaFormatError},{evt:"xglog",handler:this.onXgLogWaiting}];var t=this.player.config.errorKey;log$2(">>>errorKey",t);var r={evt:"error",handler:this.onPlayerError};t&&(r.evt=t),this.listeners.push(r),this.listeners.forEach((function(t){e.player.on(t.evt,t.handler)})),this.bindUnload()}},{key:"addIfExist",value:function(e,t,r){if(isObject$3(t)){var n=t[e];!(null==n)&&(r[e]=n)}}},{key:"changeResolution",value:function(e,t,r,n,i){var a=this.resLogs;e=formatDefinition(e),t=formatDefinition(t),a.ldet=nowTime$2(),a.df=t,a.lf=e,a.final_resolution=t,a.switch_count++;var o=a.ldet-r,s={bc:a.bc,bu_acu_t:a.bu_acu_t,sc:a.sc,sat:a.sat,watch_dur:computeWatchDur(a.played)};i&&(s.abrInfo=i),this.updateVds(),this.resetDefiInfo(),this._options.closeResolutionLog||this.onOneOperator({costTime:o,operaType:n,stateBefore:e,stateAfter:t},s,0)}},{key:"getLastInterval",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t[e],i=nowTime$2(),a=n===DEFAULT_INTERVAL?DEFAULT_INTERVAL:i-n;return r&&(t[e]=i),a}},{key:"updateSeekPt",value:function(e){return this.getLastInterval("lastSeekStartTime",this.seekLog,e)}},{key:"_reportInvalidVV",value:function(e){return!!this._isInvaidVV()&&(this.onOneError({endState:e,errorType:9998,code:-1,url:this.player.currentSrc,headers:{}},0),this._isOnePlayReport=!0,!0)}},{key:"_isInvaidVV",value:function(){return 0===this.vt&&-1===this.curStatus}},{key:"bindUnload",value:function(){Browser$1.isPC?window.addEventListener("beforeunload",this.onUnload):(Browser$1.isMobile||Browser$1.isPad)&&window.addEventListener("pagehide",this.onUnload),document.addEventListener("visibilitychange",this.onVisibilitychange),this.player.once("destroy",this.onDestroy)}},{key:"clearTimers",value:function(){var e=this.seekLog,t=this.stall;e.intervalId&&window.clearTimeout(e.intervalId),t.intervalId&&window.clearTimeout(t.intervalId)}},{key:"sendDegradeLog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"playCatch",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};log$2("sendDegradeLog",e,t,r);var n=this.degradeLog;if(!(n.hasSendEnd||"playCatch_end"===e&&"none"===t)){"playCatch_end"===e&&(n.hasSendEnd=!0);var i=this.bu_acu_t-n.bu_acu_t;this.onOneEvent({costTime:this.vd,vid:this.vid,end_type:e,cur_play_pos:this.player.currentTime,cdn_url:r.url},_objectSpread$3({degrade:t,vt:this.vt,pt:this.pt,fvt:this.fvt,bc:this.bc-n.bc,bu_acu_t:i>MAX_TIME?0:i,watch_dur:this.watchDur-n.watch_dur},r),0)}}},{key:"setPerformance",value:function(){var e=this,t=this.player.performance||{};Object.keys(t).map((function(r){e.exInfo[r]=t[r]}))}},{key:"setStat",value:function(){var e=this,t=this.player.stat||{};t.performance&&delete t.performance,Object.keys(t).map((function(r){e.exInfo[r]=t[r]}))}},{key:"onOneOperator",value:function(e){var t=e.costTime,r=e.operaType,n=e.stateBefore,i=e.stateAfter,a=e.endType,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=this.getLastInterval("lastOperaTime"),u={local_time:(new Date).getTime(),v:this.vid,opera_type:r,state_before:n,state_after:i,cost_time:t,end_type:a||this.end_type,cdn_url:this.url,resolution:this.resolution,last_interval:l,bufs:toJsonString(this.buffers.allBuffer),cur_play_pos:this.cur_play_pos,retry_count:this.retry_count},c=this.player;c&&c.dashState&&(u.dash_state=this.player.dashState),Object.keys(o).forEach((function(e){u[e]=o[e]})),c&&c.config&&c.config.codecType&&(u.codec_type=c.config.codecType),this.addIfExist("drm_type",this._options,u),this.reportLog(REPORT_EVENTS.ONE_OPERA,u,s)}},{key:"onOneError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{errorType:0,code:0,url:"",headers:{},costTime:0,vid:"",message:"",preload_hit:0,preload_cached:0},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;log$2("onOneError",e);var r=this.errorLog,n=this.apiLog,i=this.resLogs,a=this.player,o=this.playlogs,s=transformHeader(e.headers||{});this.setPerformance(),this.setStat();var l=_objectSpread$3(_objectSpread$3(_objectSpread$3({v:e.vid||this.vid,video_pos:this.cur_play_pos,local_time:(new Date).getTime(),cost_time:e&&e.costTime?e.costTime:0,errt:e.errorType,errc:e.code,es:this.es,cdn_url:e.url||this.url,bufs:toJsonString(this.buffers.allBuffer),resolution:i.final_resolution,last_errors:r.last_errors.join(";"),vsc:n.vsc,vsc_message:e.message||n.vsc_message,server_ip:s.x_response_sinfo||0,initial_url:this.initial_url,initial_host:this.initial_host},s),{},{cur_play_pos:this.cur_play_pos},this.buffers.curBuffer),{},{degrade:o.degrade,end_state:e.endState||ENDED_TYPE.ERROR,preload_hit:e.preload_hit,preload_cached:e.preload_cached,ex:toJsonString(this.exInfo),video_ready_s:this.videoReadyState});a&&a.dashState&&(l.dash_state=a.dashState),a&&a.config&&a.config.codecType&&(l.codec_type=a.config.codecType),this.addIfExist("drm_type",this._options,l),this.reportLog(REPORT_EVENTS.ONE_ERROR,l,t)}},{key:"reportLog",value:function(e,r,n){var i=this,a=this._options,o=this.player.ABTestTag;!r.player_sessionid&&(r.player_sessionid=this.sessionId),!r.web_url&&(r.web_url=window.location.href),r.user_agent=navigator.userAgent,r.dynamic_type=this.dynamicType;var s="Array"===typeOf(a.absdkVersion)?a.absdkVersion.join(","):a.absdkVersion;r.absdkVersion=s||t.AB_SDK_VERSION,null!=o&&(r.abtest_tag=o);var l=this._options;if(r.codec_type&&(l.codec_type=r.codec_type),isObject$3(l)&&(COMMON_KEYS.forEach((function(e){i.addIfExist(e,l,r)})),r.vtype=this.vtype),1===n){var u={};return u[e]=r,void LOCAL_LOG.set(u)}2!==n?(this.player&&this.player.emit("abLog",e,r),this._track(e,r)):this.addEventsQueue(e,r)}},{key:"addEventsQueue",value:function(e,t){this.eventQueue.push({event:e,params:t}),this.eventQueue.length>=this._options.maxQueueCount&&this.sendEventsQueue()}},{key:"sendEventsQueue",value:function(){for(;this.eventQueue.length>0;){var e=this.eventQueue.pop();this._track(e.event,e.params)}}},{key:"startWaitingStatus",value:function(e,t){this.onOneEvent({costTime:t,end_type:"waitstart"},{},2),this.appendStallInfo("start",e)}},{key:"triggerTask",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0;log$2("triggerTask>>",e);var r=checkVideoSrcIsEmpty(t=t||this.player.src);!r&&this.vtype.indexOf("MP4")>-1&&this.task&&this.task.trigger(t,e)}},{key:"appendStallInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start",t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=this.exInfo.stall;if("start"===e){n.length>6&&n.splice(0,n.length-6);var i=this.buffers.curBuffer;n.push({start:t,end:-1,endType:"waitstart",cost:0,cur:this.cur_play_pos,buf_s:i.buf_s_pos,buf_e:i.buf_e_pos,buf_i:i.buf_include})}else if("end"===e){var a=n.length-1;if(a<0)return;n[a].end<0&&(n[a].end=t,n[a].endType=r,n[a].cost=t-n[a].start)}log$2("appendStallInfo",n)}},{key:"suspendWaitingStatus",value:function(e){var t=nowTime$2(),r=this.playlogs,n=this.resLogs,i=this.stall,a=this.inWaitingStart;if(!(a<=0||this.isSeeking||r.vt<=0)){if(log$2("suspendWaitingStatus>>".concat(e,"|costTime:").concat(t-a," isSeeking:").concat(this.isSeeking," vt:").concat(r.vt)),this.appendStallInfo("end",t,e),t-a>MIN_WAITIONG){var o=t-this.inWaitingStart;if(r.bc++,this.checkInBuffer(this.player.currentTime)?(r.de_bu_acu_t+=o,r.dbc++):(r.nbc++,r.n_bu_acu_t+=o),n.bc++,r.bu_acu_t+=o,n.bu_acu_t+=o,i.stall_end=t,i.stall_last_interval=i.stall_end-i.stall_start,i.stall_acc_time+=i.stall_last_interval,1===i.sc&&(i.first_buf_endt=t),this.player.abrInstance&&!this.isSeeking&&this.playlogs.vt){var s=this.player.abrInstance;this.abrInfo.abr_event_info.video_stall.push({local_time_ms:(new Date).getTime(),stall_duration:parseFloat((o/1e3).toFixed(2)),buffer_length:s.bufferLength,internet_speed:s.downloadSpeed,now_bitrate:s.nowBitrate,play_speed:this.player.playbackRate,is_abr:s.isCurrentInAbr?1:0})}this.onOneEvent({costTime:o,end_type:e||"wait"},{},2)}this._endType="",this.load_state=LOAD_STATES.PLAYABLE,this.inWaitingStart=0,window.clearTimeout(i.intervalId),i.intervalId=null}}},{key:"suspendSeekStatus",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isSeeking){var r=this.seekLog,n=this.resLogs,i=this.player,a=nowTime$2()-r.lastSeekStartTime;log$2("suspendSeekStatus>>","".concat(e," currentTime:").concat(i.currentTime," costTime:").concat(a," sat:").concat(r.sat," resLogs.sat:").concat(n.sat)),r.intervalId&&window.clearTimeout(r.intervalId),r.intervalId=null,this.isSeeking=!1;var o=this._endType="seek",s=r.seekBefore,l=(i.currentTime||0).toString();r.sc++,r.sat+=a>MAX_COST?0:a,n.sc++,n.sat+=a>MAX_COST?0:a,this.updateSeekPt(!0),!this.closeSeekLog&&t&&this.onOneOperator({costTime:a,operaType:o,stateBefore:s,stateAfter:l,endType:e})}}},{key:"setPt",value:function(){var e=this.playlogs;this.startStep=1,!e.pt&&this.player.currentTime&&(this.isSeeking=!0),e.pt||(e.pt=curTimestamp(),log$2("setPt","init pt :".concat(e.pt,", document.visibilityState:").concat(document.visibilityState)))}},{key:"setVt",value:function(){var e=this.playlogs;1===this.startStep&&(e.vt||(e.vt=curTimestamp(),log$2("setVt: first frame inited","vt-pt:".concat(e.vt-e.pt," vt-nt:").concat(e.vt-e.nt))),this.startStep=2)}},{key:"setBr",value:function(e){var t=this.playlogs;t.vt>0&&(0===t.br&&(t.fbrt=e||""),t.br++)}},{key:"url",get:function(){var e=this.player;return e&&e.config?e.config.url:""}},{key:"vid",get:function(){var e=this.player;return e&&e.config?e.config.vid:""}},{key:"bc",get:function(){return this.playlogs.bc}},{key:"bu_acu_t",get:function(){return this.playlogs.bu_acu_t}},{key:"pt",get:function(){return this.playlogs.pt||curTimestamp()}},{key:"vt",get:function(){var e=this.playlogs,t=e.vt;return e.pt>0?t:0}},{key:"fvt",get:function(){var e=this.playlogs,t=e.vt,r=e.pt;return t>0&&r>0?parseInt(t-r,10):0}},{key:"nvt",get:function(){var e=this.playlogs,t=e.vt,r=e.nt;return t>0&&r>0?parseInt(t-r,10):0}},{key:"dash_pst",get:function(){return this.playlogs.dash_pst}},{key:"dash_wst",get:function(){return this.playlogs.dash_wst}},{key:"dash_wrt",get:function(){return this.playlogs.dash_wrt}},{key:"dash_ift",get:function(){return this.playlogs.dash_ift}},{key:"dash_cst",get:function(){return this.playlogs.dash_cst}},{key:"dash_spt",get:function(){return this.playlogs.dash_spt}},{key:"vd",get:function(){var e=this.player;return e.duration&&"number"==typeof e.duration&&e.duration>0?parseInt(1e3*e.duration,10):e.config.duration&&"number"==typeof e.config.duration?parseInt(1e3*e.config.duration,10):0}},{key:"cur_play_pos",get:function(){return parseInt(1e3*this.player.currentTime,10)}},{key:"volume",get:function(){return this.player.volume}},{key:"buffer_time",get:function(){var t=0;try{var r=this.player.getBufferedRange();t=r[1]-r[0]}catch(e){t=0}return t}},{key:"player_created_t",get:function(){return this._playerCreatedTime}},{key:"playbackRate",get:function(){return this.player.playbackRate}},{key:"mute",get:function(){return this.player.muted?0:1}},{key:"videoWidth",get:function(){var e=this.player;return e&&e.video?e.video.videoWidth:0}},{key:"videoHeight",get:function(){var e=this.player;return e&&e.video?e.video.videoHeight:0}},{key:"preload",get:function(){var e=this.player;return!(!e||!e.video)&&e.video.preload}},{key:"initial_url",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_url?this.urlLog.initial_url:checkVideoSrcIsEmpty(e)?"":e}},{key:"initial_host",get:function(){var e=this.player.currentSrc;return e.indexOf("blob:")>-1&&this.urlLog.initial_host?this.urlLog.initial_host:getHostFromUrl(checkVideoSrcIsEmpty(e)?"":e)}},{key:"curHeaders",get:function(){var e=this.player,t=this.task;return e&&e.__dash__&&e.__dash__.curReqVideoSegInfo?transformHeader(e.__dash__.curReqVideoSegInfo.headers||{}):t?t.headers:{}}},{key:"curStatus",get:function(){var e=this.task,t=this.vtype,r=this.netLog;return t.indexOf("MP4")>-1?e?e.status:0:r.status}},{key:"play_type",get:function(){return 0}},{key:"resolution",get:function(){var e=this.player.curDefinition;return e?e.definition+"":this.resLogs.df}},{key:"sessionId",get:function(){return this._sessionId}},{key:"finish",get:function(){return this.isEnded?1:0}},{key:"end_type",get:function(){return this._endType}},{key:"mp4Speed",get:function(){if(!this.player||!this.player.plugins)return 0;var e=this.player.plugins.mp4encryptplayer;return e?e.speed:0}},{key:"mp4RealSpeed",get:function(){if(!this.player||!this.player.plugins)return 0;var e=this.player.plugins.mp4encryptplayer;return e?e.realTimeSpeed:0}},{key:"mp4MseOpLength",get:function(){if(!this.player||!this.player.plugins)return-1;var e=this.player.plugins.mp4encryptplayer;return e?e.opQueueLen||0:-1}},{key:"mp4LoadSegmentTimeRange",get:function(){if(!this.player||!this.player.plugins)return"";var e=this.player.plugins.mp4encryptplayer;return e?e.loadSegmentTimeRange.join(","):""}},{key:"mp4FFInfo",get:function(){if(!this.player||!this.player.plugins)return{};var e=this.player.plugins.mp4encryptplayer;return e&&e.firstFrameTime||{}}},{key:"preLoadData",get:function(){if(!this.player||!this.player.plugins)return[];var e=this.player.plugins.mp4encryptplayer;if(e&&e.preLoadData)return{hit:1,duration:e.preLoadData.duration,length:e.preLoadData.byteLength};var t=this.player.stat||{};if(t.preLoadData){var r=t.preLoadData.length;return{hit:r>0,length:r}}return{hit:0,duration:0,length:0}}},{key:"preloadState",get:function(){if(!this.player||!this.player.plugins)return 0;if(void 0!==this.player.preloadState)return this.player.preloadState||0;var e=this.player.plugins.mp4encryptplayer;return e&&e.preloadState?e.preloadState:0}},{key:"curBitrate",get:function(){var e=this.player,t=e.config,r=e.curDefinition;return r&&r.bitrate?r.bitrate:t.defaultBitrate?t.defaultBitrate:0}},{key:"videoReadyState",get:function(){var e=this.player;return e&&e.video?e.video.readyState:-1}},{key:"videoSeeking",get:function(){var e=this.player;return e&&e.video&&e.video.seeking?1:0}},{key:"videoPaused",get:function(){var e=this.player;return e&&e.video&&e.video.paused?1:0}},{key:"retry_count",get:function(){return this._retryCount}},{key:"switchResolutionCount",get:function(){return this.resLogs.switch_count}},{key:"isError",get:function(){return hasClass$1(this.player.root,"xgpplayer-is-error")}},{key:"isPlaying",get:function(){return hasClass$1(this.player.root,"xgplayer-playing")}},{key:"isStop",get:function(){return hasClass$1(this.player.root,"xgplayer-ended")||hasClass$1(this.player.root,"xgplayer-nostart")}},{key:"isPause",get:function(){return hasClass$1(this.player.root,"xgplayer-pause")}},{key:"isLoading",get:function(){return hasClass$1(this.player.root,"xgplayer-isloading")}},{key:"es",get:function(){return this.isPlaying?"playing":"beforePlay"}},{key:"lt",get:function(){var e=0;return 0===this.vt&&(log$2("lt init",this.playlogs.lt),e=curTimestamp()),e}},{key:"lpt",get:function(){return this.lt?this.lt-this.pt:0}},{key:"playback_state",get:function(){return this.isError?PLAYBACK_STATE.ERROR:this.isStop?PLAYBACK_STATE.STOP:this.isPause?PLAYBACK_STATE.PAUSE:this.isLoading?PLAYBACK_STATE.LOADING:PLAYBACK_STATE.PLAYING}},{key:"is_start_play_automatically",get:function(){return this.isAutoplay+""}},{key:"watchDur",get:function(){var e=this.player,t=this.playlogs;return e.cumulateTime?e.cumulateTime:computeWatchDur(t.played)}},{key:"vtype",get:function(){return this.__vtype?this.__vtype:this.player.dash?"DASH":"DASH"===this._options.vtype?"MP4":this._options.vtype||"MP4"},set:function(e){this.__vtype=e}},{key:"watingCost",get:function(){if(this.inWaitingStart>0){var e=nowTime$2()-this.inWaitingStart;return e>MAX_COST?0:e}return 0}},{key:"videoNetworkState",get:function(){var e=this.player;return e&&e.video?e.video.networkState:-1}},{key:"eagleid",get:function(){var e=this.player;return e&&e.__dash__&&e.__dash__.curReqVideoSegInfo?(e.__dash__.curReqVideoSegInfo.headers||{}).eagleid:""}},{key:"initial_type",get:function(){var e=this.player.config||{};return e&&e.vodLogOpts&&void 0!==e.vodLogOpts.currentDashType?parseInt(e.vodLogOpts.currentDashType,10):-1}},{key:"dynamicType",get:function(){var e=this.player;return this.__dt?this.__dt:e&&e.__dash__&&e.__dash__.dash&&e.__dash__.dash.mpd?(this.__dt=e.__dash__.dash.mpd.dashType,this.__dt):""}},{key:"updateCurBuffer",value:function(){var e=this.player,t=e.buffered,r=e.currentTime,n={buf_s_pos:0,buf_e_pos:0,buf_include:0},i=[];if(!t||t.length<1)return n;for(var a=-1,o=-1,s=t.length-1;s>-1;s--){var l=parseInt(1e3*t.start(s),10),u=parseInt(1e3*t.end(s),10);i.push({start:l,end:u}),r>l&&r<u?(n.buf_include=1,n.buf_s_pos=l,n.buf_e_pos=u):r<l&&(a<0||l-r<a)?(a=l-r,o=s):r>u&&(a<0||r-u<a)&&(a=r-u,o=s)}1!==n.buf_include&&o>-1&&(n.buf_s_pos=parseInt(1e3*t.start(o),10),n.buf_e_pos=parseInt(1e3*t.end(o),10)),n.buf_diff=parseInt(1e3*t.end(t.length-1)-1e3*r),this.buffers.allBuffer=i,this.buffers.curBuffer=n}},{key:"checkInBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.player.buffered;if(!r)return!1;e=parseInt(1e3*e,10);for(var n=0;n<r.length;n++){var i=parseInt(1e3*r.start(n),10)+t,a=parseInt(1e3*r.end(n),10)+t;if(e>i&&e<a)return!0}return!1}},{key:"updateVideoSize",value:function(){var e=this._options,t=this.player,r=this.resLogs,n=0,i=0;if(t.__dash__&&t.__dash__.dash&&t.__dash__.dash.mpd.mediaList){var a=t.__dash__.dash.mpd.mediaList.video,o=a[a.selectedIdx];log$2("updateVideoSizevideoItem",o),i=o?o.bitrate||o.bandwidth:0,n=o?o.size:0}else{var s=this.player.curDefinition;s?(i=s.bitrate||t.config.bitrate||0,n=parseInt(s.bitrate*t.duration/8,10)):(n=e.videoSize||t.config.videoSize||0,i=e.bitrate||t.config.bitrate||0)}log$2("updateVideoSize","bitrate:".concat(i,", vs:").concat(n)),n&&(r.vs=n,r.vis=parseInt(n/t.duration,10),r.bitrate=i||r.vis)}},{key:"updateVds",value:function(){var e=this.resLogs,t=this.playlogs,r=this.player;if(0!==e.vis){for(var n=parseInt(computeWatchDur(t.played)/1e3,10),i=r.buffered,a=0,o=0;o<i.length;o++)a+=parseInt(i.end(o)-i.start(o),10);log$2("updateVds","pdur:".concat(n," bdur:").concat(a," \n         lbuf:").concat(e.lbuf," lplayed:").concat(e.lplayed," bitrate: ").concat(e.bitrate," vis:").concat(e.vis," vs:").concat(e.vs)),e.vps+=parseInt((n-e.lplayed)*e.vis,10),e.vds+=parseInt((a-e.lbuf)*e.vis,10),e.lplayed=n,e.lbuf=a}else log$2("updateVds","vis:".concat(e.vis))}}],[{key:"TEA_ID",get:function(){return TEA_ID},set:function(e){LS_KEY="__tea_cache_tokens_".concat(TEA_ID=e)}},{key:"AB_SDK_VERSION",get:function(){return AB_SDK_VERSION},set:function(e){AB_SDK_VERSION="Array"===typeOf(e)?e.join(","):e}},{key:"Collector",set:function(e){Collector$1=e}}]),t}();XGPlayerAppLogger.TEA_ID=1300,XGPlayerAppLogger.Collector=Collector$1$1;var xgVodLogger=function(e){if(e&&e.player){var t=e.player.config.vodLogOpts||{};e.player.vodLogger=new XGPlayerAppLogger(e.player,t),e.player.plugins.xgVodLogger=e.player.vodLogger}else this.vodLogger=new XGPlayerAppLogger(this,this.config.vodLogOpts||{})};xgVodLogger.pluginName="__xgVodLogger",xgVodLogger.playerConfig={},xgVodLogger.Collector=Collector$1$1,xgVodLogger.setABSdkVersion=function(e){XGPlayerAppLogger.AB_SDK_VERSION=e};var index_min$1={exports:{}},es_string_repeat={},$$l=_export$1,repeat=stringRepeat$1;$$l({target:"String",proto:!0},{repeat:repeat});var es_typedArray_int8Array={},createTypedArrayConstructor$6=typedArrayConstructor$1.exports;createTypedArrayConstructor$6("Int8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var es_typedArray_uint8ClampedArray={},createTypedArrayConstructor$5=typedArrayConstructor$1.exports;createTypedArrayConstructor$5("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}),!0);var es_typedArray_int16Array={},createTypedArrayConstructor$4=typedArrayConstructor$1.exports;createTypedArrayConstructor$4("Int16",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var es_typedArray_uint16Array={},createTypedArrayConstructor$3=typedArrayConstructor$1.exports;createTypedArrayConstructor$3("Uint16",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var es_typedArray_uint32Array={},createTypedArrayConstructor$2=typedArrayConstructor$1.exports;createTypedArrayConstructor$2("Uint32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var es_typedArray_float32Array={},createTypedArrayConstructor$1=typedArrayConstructor$1.exports;createTypedArrayConstructor$1("Float32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var es_typedArray_float64Array={},createTypedArrayConstructor=typedArrayConstructor$1.exports;createTypedArrayConstructor("Float64",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var es_array_reduce={},$$k=_export$1,$reduce=arrayReduce$1.left,arrayMethodIsStrict=arrayMethodIsStrict$g,CHROME_VERSION=engineV8Version$1,IS_NODE$1=engineIsNode$1,STRICT_METHOD=arrayMethodIsStrict("reduce"),CHROME_BUG=!IS_NODE$1&&CHROME_VERSION>79&&CHROME_VERSION<83;$$k({target:"Array",proto:!0,forced:!STRICT_METHOD||CHROME_BUG},{reduce:function(e){var t=arguments.length;return $reduce(this,e,t,t>1?arguments[1]:void 0)}});var require$$58=getAugmentedNamespace(es),es_symbol_iterator={},defineWellKnownSymbol$2=wellKnownSymbolDefine;defineWellKnownSymbol$2("iterator");var es_symbol_asyncIterator={},defineWellKnownSymbol$1=wellKnownSymbolDefine;defineWellKnownSymbol$1("asyncIterator");var es_symbol_toStringTag={},getBuiltIn$4=getBuiltIn$A,defineWellKnownSymbol=wellKnownSymbolDefine,setToStringTag$3=setToStringTag$k;defineWellKnownSymbol("toStringTag"),setToStringTag$3(getBuiltIn$4("Symbol"),"Symbol");var es_json_toStringTag={},global$2=global$1v,setToStringTag$2=setToStringTag$k;setToStringTag$2(global$2.JSON,"JSON",!0);var es_math_toStringTag={},setToStringTag$1=setToStringTag$k;setToStringTag$1(Math,"Math",!0);var es_object_setPrototypeOf={},$$j=_export$1,setPrototypeOf=objectSetPrototypeOf$1;$$j({target:"Object",stat:!0},{setPrototypeOf:setPrototypeOf});var es_array_reverse={},$$i=_export$1,uncurryThis$5=functionUncurryThis$1,isArray=isArray$d,nativeReverse=uncurryThis$5([].reverse),test=[1,2];$$i({target:"Array",proto:!0,forced:String(test)===String(test.reverse())},{reverse:function(){return isArray(this)&&(this.length=this.length),nativeReverse(this)}}),function(e,t){e.exports=function(e,t,r,n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b,_,E,T,S,$,A,w,k,I,C,P,x,R,O,L,D,M,N,G,V,U,Z,B,F,j,W,X,H,K,Y,z,J,Q,q,ee,te,re,ne,ie){function ae(){ae=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function oe(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void r(u)}s.done?t(l):Promise.resolve(l).then(n,i)}function se(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){oe(a,n,i,o,s,"next",e)}function s(e){oe(a,n,i,o,s,"throw",e)}o(void 0)}))}}function le(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=void 0,"symbol"==_typeof$b(i=function(e,t){if("object"!=_typeof$b(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_typeof$b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n.key,"string"))?i:String(i)),n)}var i}function ue(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ce(e,t)}function ce(e,t){return(ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function de(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function he(e,t,r){return(he=de()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&ce(i,r.prototype),i}).apply(null,arguments)}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var pe,ye,me,ge,ve;!function(e,t,r){function n(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var i,a=0,o=[],s=[],l=parseInt(e.slice(0,8),16),u=parseInt(e.slice(8,16),16);if(1213091658!==l||1077891651!==u)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(i=0;i<4;++i)a+=(3&parseInt(e.slice(24+2*i,26+2*i),16))<<2*i;var c=parseInt(e.slice(32,40),16),d=2*parseInt(e.slice(48,56),16);for(i=56;i<d+56;i+=2)o.push(parseInt(e.slice(i,i+2),16));var h=d+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,i=0;i<f;++i){var p=n(e,h);h+=2*p[0];for(var y="",m=0;m<p[1];++m){var g=n(e,h);y+=String.fromCharCode(a^g[1]),h+=2*g[0]}s.push(y)}t.p=null,function e(t,r,n,i,a){var l,u,c,d,h,f=-1,p=[],y=[0,null],m=null,g=[r];for(u=Math.min(r.length,n),c=0;c<u;++c)g.push(r[c]);g.p=i;for(var v=[];;)try{var b=o[t++];if(b<40)if(b<21)if(b<11)b<5?b<3?p[++f]=null:3===b?(l=o[t++],p[++f]=l<<24>>24):(l=(o[t]<<8)+o[t+1],t+=2,p[++f]=l<<16>>16):b<7?5===b?(l=((l=((l=o[t++])<<8)+o[t++])<<8)+o[t++],p[++f]=(l<<8)+o[t++]):(l=(o[t]<<8)+o[t+1],t+=2,p[++f]=+s[l]):7===b?(l=(o[t]<<8)+o[t+1],t+=2,p[++f]=s[l]):p[++f]=void 0;else if(b<17)b<13?11===b?p[++f]=a:(l=(o[t]<<8)+o[t+1],t+=2,f=f-l+1,u=p.slice(f,f+l),p[f]=u):13===b?p[++f]={}:(l=(o[t]<<8)+o[t+1],t+=2,u=s[l],c=p[f--],p[f][u]=c);else if(b<19)if(17===b){for(u=o[t++],c=o[t++],d=g;u>0;--u)d=d.p;p[++f]=d[c]}else l=(o[t]<<8)+o[t+1],t+=2,u=s[l],p[f]=p[f][u];else if(19===b)u=p[f--],p[f]=p[f][u];else{for(u=o[t++],c=o[t++],d=g;u>0;--u)d=d.p;d[c]=p[f--]}else if(b<28)if(b<24)if(b<22)l=(o[t]<<8)+o[t+1],t+=2,u=s[l],c=p[f--],d=p[f--],c[u]=d;else if(22===b)u=p[f--],c=p[f--],d=p[f--],c[u]=d;else{for(u=o[t++],c=o[t++],d=g,d=g;u>0;--u)d=d.p;p[++f]=d,p[++f]=c}else b<26?24===b?(u=p[f--],p[f]+=u):(u=p[f--],p[f]-=u):26===b?(u=p[f--],p[f]*=u):(u=p[f--],p[f]/=u);else b<35?b<33?28===b?(u=p[f--],p[f]%=u):p[f]=-p[f]:33===b?(u=p[f--],c=p[f--],p[++f]=c[u]++):(u=p[f--],c=p[f--],p[++f]=c[u]--):b<38?35===b?(u=p[f--],p[f]=p[f]==u):(u=p[f--],p[f]=p[f]===u):38===b?(u=p[f--],p[f]=p[f]!==u):(u=p[f--],p[f]=p[f]<u);else if(b<56)b<47?b<43?b<41?(u=p[f--],p[f]=p[f]<=u):41===b?(u=p[f--],p[f]=p[f]>u):(u=p[f--],p[f]=p[f]>=u):b<45?43===b?(u=p[f--],p[f]=p[f]<<u):(u=p[f--],p[f]=p[f]>>u):45===b?(u=p[f--],p[f]=p[f]>>>u):(u=p[f--],p[f]=p[f]&u):b<51?b<49?47===b?(u=p[f--],p[f]=p[f]|u):p[f]=~p[f]:49===b?(u=p[f--],p[f]=p[f]^u):p[f]=!p[f]:b<53?51===b?(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?--f:t+=l):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?t+=l:--f):53===b?(u=p[f--],(c=p[f--])[u]=p[f]):(u=p[f--],p[f]=p[f]instanceof u);else if(b<66)if(b<61)b<59?p[f]=56===b?void 0:_typeof$b(p[f]):59===b?(l=o[t++],u=p[f--],(c=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[u,l,g],c._u=e,p[++f]=c):(l=o[t++],u=p[f--],(d=[c=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)}]).p=g,c._v=[u,l,d],c._u=e,p[++f]=c);else if(b<64)61===b?(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=v[v.length-1])[1]=t+l):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=v[v.length-1])&&!u[1]?(u[0]=3,u.push(t)):v.push([1,0,t]),t+=l);else{if(64===b)throw u=p[f--];if(c=(u=v.pop())[0],d=y[0],1===c)t=u[1];else if(0===c)if(0===d)t=u[1];else{if(1!==d)throw y[1];if(!m)return y[1];t=m[1],a=m[2],g=m[3],v=m[4],p[++f]=y[1],y=[0,null],m=m[0]}else t=u[2],u[0]=0,v.push(u)}else if(b<71)if(b<68)if(66===b){for(u=p[f--],c=null;d=v.pop();)if(2===d[0]||3===d[0]){c=d;break}if(c)y=[1,u],t=c[2],c[0]=0,v.push(c);else{if(!m)return u;t=m[1],a=m[2],g=m[3],v=m[4],p[++f]=u,y=[0,null],m=m[0]}}else f-=l=o[t++],c=p.slice(f+1,f+l+1),u=p[f--],d=p[f--],u._u===e?(u=u._v,m=[m,t,a,g,v],t=u[0],null==d&&(d=function(){return this}()),a=d,(g=[c].concat(c)).length=Math.min(u[1],l)+1,g.p=u[2],v=[]):p[++f]=u.apply(d,c);else if(68===b){for(l=o[t++],d=[void 0],h=l;h>0;--h)d[h]=p[f--];c=p[f--],u=Function.bind.apply(c,d),p[++f]=new u}else t+=2+(l=(l=(o[t]<<8)+o[t+1])<<16>>16);else b<73?71===b?(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=p[f--])||(t+=l)):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,u=p[f--],p[f]===u&&(--f,t+=l)):73===b?--f:(u=p[f],p[++f]=u)}catch(_){for(y=[0,null];(l=v.pop())&&!l[0];);if(!l){e:for(;m;){for(u=m[4];l=u.pop();)if(l[0])break e;m=m[0]}if(!m)throw _;t=m[1],a=m[2],g=m[3],v=m[4],m=m[0]}1===(u=l[0])?(t=l[2],l[0]=0,v.push(l),p[++f]=_):2===u?(t=l[2],l[0]=0,v.push(l),y=[3,_]):(t=l[3],l[0]=2,v.push(l),p[++f]=_)}}(c,[],0,t,r)}("484e4f4a403f524300142f02a4ee9e59000047985b5c4a2100004d891100010700002a3300071100010700012847001a1100014a120002030043010700004a12000203004301194500341100010700032a3300071100010700042847001d1100014a120002030043010700034a1200020300430119030a184500030400ff421100010300134a12000243001100010301134a1200024300311100010302134a1200024300310700004a12000203004301191400031100021100031903011914000411030011000444011400051103001100034401140006110003170007354911000703002947004e11000111000211000319030219134a120002430011000111000211000319030119134a12000243003111000111000211000719134a1200024300311100061100031100071916170007224945ffa903001700073549110007110004274700191100011100070301181311000511000716170007214945ffdd0d1100050e00051100040e00061100060e00071100030e0008420300140002030017000235490300110001264700171100011100010301192e1700013549170002214945ffe0110002421100014a120002430002110203110002430118110003181400041103014a1200090400ff1100042e43014203551400040400fa1400050300140006030017000635491100061100022747008511000603021c03012347002a110004110001110006134a1200024300311700033549110001110006134a120002430017000435450027110005110001110006134a1200024300311700033549110001110006134a12000243001700053549021102041103014a1200091100034301110006031543031100011100063549170006214945ff71110001421100011400030211010211000311000243021400041100041200051400051100041200061400061100041200081400070211010511000511000643021700053549110005030013170008350700002a3300071100080700012847001a1100084a120002030043010700004a12000203004301194500341100080700032a3300071100080700042847001d1100084a120002030043010700034a1200020300430119030a184500030400ff170007354911000611000719030119140009110200110009030118440114000a110200110007030118440114000b07000a11000a1100093549030011000b1100073549030014000c030017000c354911000c1100092747001911000511000c0301181311000a11000c1617000c214945ffdd030017000c354911000c1100072747001e1100051100061100071911000c181311000b11000c1617000c214945ffd811000a4a12000b07000a43014205000003f93b0014000105000003fb3c0011000115000d11000112000e140002050000043f3c01110002150010050000044d3c0011000215001211000142084211000012000c14000111040011000144011400020300140003110003110001274700161100001100031311000211000316170003214945ffe00211041e0b1100024302421104024a12000f0b1100014302420b12001144001400011104024a12000f1100010b4302491100014205000004cd3b021400020211021d11000211000143024905000006203c0111000215001c11000212000e140003050000073b3c0111000315001f05000007563c01110003150021050000083c3c0011000315002005000008893c0011000315001211000242110001030038254700060c00001400011100020300382547000c030411000112000c1a1400021101014a1200130b43013400010b1400031100011400041100041103033733000c11030411000444011700043549110004110305373400071100041103063734000711000411030737340007110004110308373400071100041103093734000711000411030a3734000711000411030b3734000711000411030c3733001b110304110004120014110004120015110004120016440317000435491100041103043747006f1100041200161400050c000014000603001400071100071100052747003811000611000703022d1311000411000713031811000703041c03081a192b2f11000611000703022d3549110007030118170007354945ffbe1100061100030700173549110005110003070018354945001611000111000307001735491100021100030700183549110003420c0000140002050000069d3c011400030300140005110005110001274700520211000306001a11000434000911040d4a12001c43001a4301140006053ade67b70211000643001a17000435491100024a12001d06001a0211000643001a03002f430149110005030418170005354945ffa4110202110002110001440242110001140002053ade68b114000306001914000405000006b93b00420500009069050000ffff1101032e1a11010303102c181101042e1701033549044650050000ffff1101022e1a11010203102c181101042e170102354911010303102b110102181101042e14000111000106001a1b170001354911000106001b18170001354911000111070d4a12001c430006001b29470005030145000303011d1a42110001030038254700061103081400011100014a12001e0b4301420b1200171400021100011200171400030b1200181400041100011200181400050b4a12002043004911000403041c47007003001400061100061100052747005e11000311000603022d13031811000603041c03081a192d0400ff2e1400071100021100041100061803022d1311000703181100041100061803041c03081a192b2f1100021100041100061803022d3549110006030118170006354945ff9845003503001400081100081100052747002611000311000803022d131100021100041100081803022d16110008030418170008354945ffd00b120018110005180b07001835490b420b1200171400010b12001814000211000111000203022d13060019032011000203041c03081a192b2e11000111000203022d354911040d4a12002211000203041b430111000107000c3549084211020112000e1200124a1200130b43011400010b1200174a120023030043011100010700173549110001421100011200171400021100011200181400030c000014000403001400051100051100032747005c11000211000503022d13031811000503041c03081a192d0400ff2e1400061100044a12001d11000603042d4a12001f031043014301491100044a12001d030f1100062e4a12001f03104301430149110005030118170005354945ff9a1100044a12000b07000a43014211000112000c1400020c000014000303001400041100041100022747004711000311000403032d130211030e1100014a1200241100040302430203104302031811000403081c03041a192b2f11000311000403032d3549110004030218170004354945ffaf11020711000311000203021b4402421100011200171400021100011200181400030c000014000403001400051100051100032747004211000211000503022d13031811000503041c03081a192d0400ff2e1400061100044a12001d1103014a1200091100064301430149110005030118170005354945ffb41100044a12000b07000a43014211000112000c1400020c000014000303001400041100041100022747004111000311000403022d130400ff1100014a12000211000443012e031811000403041c03081a192b2f11000311000403022d3549110004030118170004354945ffb51102071100031100024402423e000d140002110311070026440140413d001a0211030f021103101102094a12001e110001430143014301424108421102094a1200250211031202110313110001430143014301420500000b393b001400020211021d11000211000143024911000212000e1400030500000b5a3c0011000315002a0500000b6f3c0111000315002c0500000bb23c011100031500320500000c8f3c00110003150012110002421101014a1200130b43013400010b1700013549030011000107002735491100014211030744000b070028354903000b0700293549084211000114000207002b1100023a2333001011030a4a120025110002430117000235490b1200284a1200211100024301490b120029110002120018180b070029354908420b1200281400030b12002d14000411000312001714000511000312001814000611000603041100041a1b14000711000147000f11040d4a120022110007430145001611040d4a12002e03001100072f0b12002719030043021400071100071100041a14000811040d4a12002f03041100081a1100064302140009110008470051030014000a11000a1100082747001d0b4a12003011000511000a43024911000a1100041817000a354945ffd91100054a12003103001100084302170002354911000312001811000919110003070018354911030711000211000944024211020112000e1200124a1200130b43011400010b1200284a12001243001100010700283549110001420500000d1d3b011400020211021d1100021100014302490500000d613c011100021500350500000d7b3c0111000215003611000212000e1400030500000d983c0011000315002a0500000db33c011100031500380500000dc83c01110003150034110002421101014a1200130b43013400010b1700023549031011000207002d35491103024a12000f1102064400110001430211000207003335491100024a12002a430049110002420500000d693b024211010111000244014a1200341100014301420500000d833b024211040d11010111000244024a12003411000143014211020112000e12002a4a1200130b4301490b4a12003743004908420b4a12002c1100014301490b4a1200324300490b4211000133000a0b4a12002c1100014301490b4a1200394300420500000e2c3b021400020211021d11000211000143024911000212000e1400030500000f513c0011000315002a0500000f723c011100031500380500000f823c01110003150034110002421101014a1200130b43013400010b140003110001440014000411000411000315003a11000214000507002b1100053a2333001011020a4a1200251100054301170005354911000412002d14000603041100061a140007110005120018110007293300101100044a120034110002430117000535491100054a1200204300491100054a120012430014000811000811000315003b1100054a120012430014000911000911000315003c11000812001714000a11000912001714000b030014000c11000c1100062747003811000a11000c13055c5c5c5c3111000a11000c354911000b11000c1305363636363111000b11000c354911000c03011817000c354945ffbe110007110008070018354911000711000907001835491100034a12002a430049110003420b12003a1400011100014a12002a4300491100014a1200380b12003c43014908420b12003a4a1200381100014301490b420b12003a1400021100024a12003411000143011400031100024a12002a4300491100024a1200340b12003b4a12001243004a12002111000343014301420c0000140004030014000503001400061100061100022747008611000603041c47006f1100031100014a12000211000603011943011311000603041c03021a2b1100031100014a120002110006430113030611000603041c03021a192d2f14000711000411000503022d13110007031811000503041c03081a192b2f11000411000503022d35491100050301181700053549110006030118170006354945ff701102074a12000d1100041100054302421100011200171400021100011200181400030b12003d1400041100014a1200204300490c00001400050300140006110006110003274700c711000211000603022d13031811000603041c03081a192d0400ff2e03102b11000211000603011803022d13031811000603011803041c03081a192d0400ff2e03082b2f11000211000603021803022d13031811000603021803041c03081a192d0400ff2e2f140007030014000811000803042733000f11000606003e1100081a18110003274700311100054a12001d1100044a12003f11000703060303110008191a2d033f2e4301430149110008030118170008354945ffb4110006030318170006354945ff2f1100044a12003f0340430114000911000947001c11000512000c03041c4700101100054a12001d11000943014945ffe41100054a12000b07000a43014211000112000c1400020b12003d1400030b120040140004110004324700450c00000b07004035490b1200401700043549030014000511000511000312000c274700211100051100041100034a120002110005430116110005030118170005354945ffd21100034a12003f034043011400061100064700211100014a120041110006430114000703011d1100072633000711000717000235490211020e1100011100021100044303421100011100021100032e110002301100042e2f1811000518110007181400081100081100062b1100080320110006192d2f11000218421100011100021100042e110003110004302e2f1811000518110007181400081100081100062b1100080320110006192d2f110002184211000111000211000331110004311811000518110007181400081100081100062b1100080320110006192d2f1100021842110001110003110002110004302f311811000518110007181400081100081100062b1100080320110006192d2f1100021842050000137a3b001400020211021d11000211000143024911000212000e140003050000138c3c0011000315003705000013aa3c021100031500300500001ddc3c001100031500390500001f323c00110003150012110002421101014a1200450b11000043023400010b42110307056745230106004606004705103254760c000444010b1500480842110001140003030014000411000403102747004e11000211000418140005110001110005131400060500ff00ff11000603082b11000603182d2f2e06004911000603182b11000603082d2f2e2f11000311000516110004030118170004354945ffa90b12004812001714000711000311000203001813140008110003110002030118131400091100031100020302181314000a1100031100020303181314000b1100031100020304181314000c1100031100020305181314000d1100031100020306181314000e1100031100020307181314000f1100031100020308181314001011000311000203091813140011110003110002030a1813140012110003110002030b1813140013110003110002030c1813140014110003110002030d1813140015110003110002030e1813140016110003110002030f181314001711000703001314001811000703011314001911000703021314001a11000703031314001b0211031211001811001911001a11001b1100080307110310030013430717001835490211031211001b11001811001911001a110009030c110310030113430717001b35490211031211001a11001b11001811001911000a0311110310030213430717001a35490211031211001911001a11001b11001811000b0316110310030313430717001935490211031211001811001911001a11001b11000c0307110310030413430717001835490211031211001b11001811001911001a11000d030c110310030513430717001b35490211031211001a11001b11001811001911000e0311110310030613430717001a35490211031211001911001a11001b11001811000f0316110310030713430717001935490211031211001811001911001a11001b1100100307110310030813430717001835490211031211001b11001811001911001a110011030c110310030913430717001b35490211031211001a11001b1100181100191100120311110310030a13430717001a35490211031211001911001a11001b1100181100130316110310030b13430717001935490211031211001811001911001a11001b1100140307110310030c13430717001835490211031211001b11001811001911001a110015030c110310030d13430717001b35490211031211001a11001b1100181100191100160311110310030e13430717001a35490211031211001911001a11001b1100181100170316110310030f13430717001935490211031311001811001911001a11001b1100090305110310031013430717001835490211031311001b11001811001911001a11000e0309110310031113430717001b35490211031311001a11001b110018110019110013030e110310031213430717001a35490211031311001911001a11001b1100181100080314110310031313430717001935490211031311001811001911001a11001b11000d0305110310031413430717001835490211031311001b11001811001911001a1100120309110310031513430717001b35490211031311001a11001b110018110019110017030e110310031613430717001a35490211031311001911001a11001b11001811000c0314110310031713430717001935490211031311001811001911001a11001b1100110305110310031813430717001835490211031311001b11001811001911001a1100160309110310031913430717001b35490211031311001a11001b11001811001911000b030e110310031a13430717001a35490211031311001911001a11001b1100181100100314110310031b13430717001935490211031311001811001911001a11001b1100150305110310031c13430717001835490211031311001b11001811001911001a11000a0309110310031d13430717001b35490211031311001a11001b11001811001911000f030e110310031e13430717001a35490211031311001911001a11001b1100181100140314110310031f13430717001935490211031411001811001911001a11001b11000d0304110310032013430717001835490211031411001b11001811001911001a110010030b110310032113430717001b35490211031411001a11001b1100181100191100130310110310032213430717001a35490211031411001911001a11001b1100181100160317110310032313430717001935490211031411001811001911001a11001b1100090304110310032413430717001835490211031411001b11001811001911001a11000c030b110310032513430717001b35490211031411001a11001b11001811001911000f0310110310032613430717001a35490211031411001911001a11001b1100181100120317110310032713430717001935490211031411001811001911001a11001b1100150304110310032813430717001835490211031411001b11001811001911001a110008030b110310032913430717001b35490211031411001a11001b11001811001911000b0310110310032a13430717001a35490211031411001911001a11001b11001811000e0317110310032b13430717001935490211031411001811001911001a11001b1100110304110310032c13430717001835490211031411001b11001811001911001a110014030b110310032d13430717001b35490211031411001a11001b1100181100191100170310110310032e13430717001a35490211031411001911001a11001b11001811000a0317110310032f13430717001935490211031511001811001911001a11001b1100080306110310033013430717001835490211031511001b11001811001911001a11000f030a110310033113430717001b35490211031511001a11001b110018110019110016030f110310033213430717001a35490211031511001911001a11001b11001811000d0315110310033313430717001935490211031511001811001911001a11001b1100140306110310033413430717001835490211031511001b11001811001911001a11000b030a110310033513430717001b35490211031511001a11001b110018110019110012030f110310033613430717001a35490211031511001911001a11001b1100181100090315110310033713430717001935490211031511001811001911001a11001b1100100306110310033813430717001835490211031511001b11001811001911001a110017030a110310033913430717001b35490211031511001a11001b11001811001911000e030f110310033a13430717001a35490211031511001911001a11001b1100181100150315110310033b13430717001935490211031511001811001911001a11001b11000c0306110310033c13430717001835490211031511001b11001811001911001a110013030a110310033d13430717001b35490211031511001a11001b11001811001911000a030f110310033e13430717001a35490211031511001911001a11001b1100181100110315110310033f13430717001935491100070300131100181803002f110007030035491100070301131100191803002f1100070301354911000703021311001a1803002f1100070302354911000703031311001b1803002f1100070303354908420b12002814000111000112001714000203080b1200291a14000303081100011200181a14000411000211000403052d13040080031811000403201c192b2f11000211000403052d354911040d4a12004a11000306001a1b43011400051100031400060500ff00ff11000503082b11000503182d2f2e06004911000503182b11000503082d2f2e2f110002030f11000403401803092d03042b1835490500ff00ff11000603082b11000603182d2f2e06004911000603182b11000603082d2f2e2f110002030e11000403401803092d03042b183549030411000212000c0301181a11000107001835490b4a1200324300490b12004814000711000712001714000803001400091100090304274700441100081100091314000a0500ff00ff11000a03082b11000a03182d2f2e06004911000a03182b11000a03082d2f2e2f11000811000916110009030118170009354945ffb31100074211020112000e1200124a1200130b43011400010b1200484a12001243001100010700483549110001420500001f8c3b011400020211021d11000211000143024911000212000e1400030500001fcd3c0211000315004e110002421101014a1200130b43013400010b17000235491103024a12000f11020644000d03040e004b1102160e004c03010e004d11000143031100020700333549110002420b12003314000411000412004c4a12000d43001400051103074a12000d430014000611000612001714000711000412004b14000811000412004d14000911000712000c1100082747007f11000333000c1100054a1200381100034301491100054a12003811000143014a120034110002430117000335491100054a12002a430049030114000a11000a110009274700291100054a120034110003430117000335491100054a12002a43004911000a03011817000a354945ffcd1100064a12002111000343014945ff7403041100081a110006070018354911000642050000211a3b031400020211021d110002110001430249050000216a3c02110002150052050000217c3c02110002150054050000218e3c0111000215003511000212000e14000305000021fb3c0011000315002a05000022163c0111000315005705000022293c01110003150034110002421101014a1200130b43013400010b17000435491103024a12000f11020644001100034302110004070033354911000111000407004f354911000211000407005035491100044a12002a430049110004420b4a12000d0b1200511100011100024303420b4a12000d0b12005311000111000243034205000021ae3c011400020d05000021c33c030e005505000021df3c030e00564207002b1100013a23470006110522450003110520420211020211000243014a1200551102011100011100021100034304420211020211000243014a12005611020111000111000211000343044211020112000e12002a4a1200130b4301490b4a12003743004908420b4a12002c1100014301490b4a12003243004211000133000a0b4a12002c1100014301490b4a12003943004205000022773b021400020211021d11000211000143024905000022a43c0211000215005205000022b53c02110002150054110002421101014a1200130b43013400010b1700033549110001110003070059354911000211000307005a3549110003420b12005b4a12000d1100011100024302420b12005c4a12000d1100011100024302421100011400040b12005a14000611000647001311000617000535490300380b07005a354500080b12005d170005354903001400071100071100032747002d11000411000211000718131100051100071331110004110002110007183549110007030118170007354945ffc90842050000234e3b001400020211021d110002110001430249110002421101014a1200450b11000043023400010b4205000023913b001400020211021d11000211000143024911000212000e14000305000023a33c0211000315005f110002421101014a1200450b11000043023400010b420b12005914000311000312002d14000411031a4a1200130b1100011100021100044304491100034a12005e1100011100024302491100014a1200231100021100021100041843020b07005d3549084205000024233b001400020211021d11000211000143024911000212000e14000305000024353c0211000315005f110002421101014a1200450b11000043023400010b420b12005914000311000312002d1400041100014a1200231100021100021100041843021400051100034a12006011000111000243024911031a4a1200130b1100011100021100044304491100050b07005d3549084203041100021a1400031100031100011200181100031c1914000411000403182b11000403102b2f11000403082b2f1100042f1400050c000014000603001400071100071100042747001b1100064a12001d110005430149110007030418170007354945ffdb1102074a12000d11000611000443021400081100014a12002111000843014908421100011400020400ff11000212001711000212001803011903022d132e1400031100021200181100031911000207001835490842050000258f3b031400020211021d11000211000143024911000212000e14000305000025cf3c0011000315002a05000026553c0211000315003005000026683c00110003150039110002421101014a1200130b1100011100021103024a12000f0d11021b0e006311021c0e0064110003430243043400010b1700043549030411000407002d35491100044211020112000e12002a4a1200130b4301490b1200331400021100021200651400031100021200631400040b12004f0b1200111200512547000d11000412005217000135450012110004120054170001354903010b07002735491100014a1200131100040b11000333000611000312001743030b07006635491100010b120066070067354908420b1200664a12005f11000111000243024908420b1200331200641400020b12004f0b120011120051254700231100024a1200610b1200280b12002d4302490b4a12003203003243011700013545001b0b4a120032030032430117000135491100024a1200621100014301491100014205000026f53b011400020211021d11000211000143024911000212000e14000305000027193c0111000315001f110002421101014a1200130b43013400010b17000235491100024a120010110001430149110002421100013400040b1200684a12001e0b43014211000112006914000311000112006a14000411000447002b1102074a12000d0553616c740565645f5f0c000243014a12002111000443014a120021110003430145000311000317000235491100024a12001f11020f43014211020f4a12002511000143011400031100031200171400040553616c741100040300132533000c0565645f5f110004030113253300391102074a12000d1100044a120023030203044302430117000235491100044a12003103000304430249110003120018031019110003070018354911021e4a12000d0d1100030e00691100020e006a430142050000284c3b001400020211021d110002110001430249050000285e3c0411000215005505000028ea3c0411000215005605000029373c0211000215006e110002421101014a1200450b11000043023400010b421104024a12000f11030644000b12003311000443031400051100014a12005211000311000543021400061100064a120034110002430114000711000612003314000811031e4a12000d0d1100070e00691100030e006b1100081200650e00651100010e006c1100081200630e00631100081200640e006411000612002d0e002d11000512006d0e00684301421100021400051104024a12000f11030644000b12003311000443031400060b4a12006e11000511000612006d43021400051100014a12005411000311000643024a12003411000512006943014207002b1100013a234700101100024a1200251100010b43024500031100014211000414000511000534000f1102074a12001c0308430117000535491102174a12000d0d110002110003180e004b43014a12004e11000111000543021400061102074a12000d1100061200174a120023110002430103041100031a430214000703041100021a110006070018354911021e4a12000d0d1100060e006b1100070e00651100050e006a4301420500002a163b001400020211021d1100021100014302490500002a283c041100021500550500002a9a3c04110002150056110002421101014a1200450b11000043023400010b421104024a12000f11030644000b12003311000443031400051100051200704a12006f11000311000112004b11000112005843031400061100061200651100051500651103201200554a1200130b11000111000211000612006b11000543051400071100074a120010110006430149110007421100021400051104024a12000f11030644000b12003311000443031400060b4a12006e11000511000612006d43021400051100061200704a12006f11000311000112004b11000112005811000512006a43041400071100071200651100061500651103201200564a1200130b11000111000511000712006b1100064305420500002b703b001400020211021d11000211000143024911000212000e1400030500002b823c001100031500370500002dcd3c0211000315005e0500002df03c021100031500600500002e7b3c08110003150075110002421101014a1200450b11000043023400010b420b1200713300090b1200720b1200502547000208420b1200500b1500720b12007214000211000212001714000311000212001803041b1400041100040306180b15007103040b1200710301181a1400050c00000b1500730b1200731400060300140007110007110005274701211100071100042747001111000311000713110006110007354500f71100061100070301191317000135491100071100041c47005a11000403062933000a1100071100041c03042333004111032311000103182d1303182b11032311000103102d0400ff2e1303102b2f11032311000103082d0400ff2e1303082b2f1103230400ff1100012e132f1700013545006d11000103082b11000103182d2f170001354911032311000103182d1303182b11032311000103102d0400ff2e1303102b2f11032311000103082d0400ff2e1303082b2f1103230400ff1100012e132f17000135491100011103371100071100041b03002f1303182b3117000135491100061100071100041913110001311100061100073549110007030118170007354945fed50c00000b1500740b12007414000803001400091100091100052747009e1100051100091914000a11000903041c47000a11000611000a1345000a11000611000a03041913170001354911000903042734000611000a03042847000611000145004411032911032311000103182d131311032a11032311000103102d0400ff2e13133111032b11032311000103082d0400ff2e13133111032c1103230400ff1100012e1313311100081100093549110009030118170009354945ff5808420b4a1200751100011100020b12007311032511032611032711032811032343084908421100011400031100031100020301181314000411000311000203031813110003110002030118354911000411000311000203031835490b4a1200751100031100020b12007411032911032a11032b11032c110324430849110003110002030118131700043549110003110002030318131100031100020301183549110004110003110002030318354908421100011400090b12007114000a110009110002131100030300133114000b110009110002030118131100030301133114000c110009110002030218131100030302133114000d110009110002030318131100030303133114000e030414000f030114001011001011000a2747015611000411000b03182d1311000511000c03102d0400ff2e133111000611000d03082d0400ff2e13311100070400ff11000e2e133111000311000f133114001111000f03011817000f354911000411000c03182d1311000511000d03102d0400ff2e133111000611000e03082d0400ff2e13311100070400ff11000b2e133111000311000f133114001211000f03011817000f354911000411000d03182d1311000511000e03102d0400ff2e133111000611000b03082d0400ff2e13311100070400ff11000c2e133111000311000f133114001311000f03011817000f354911000411000e03182d1311000511000b03102d0400ff2e133111000611000c03082d0400ff2e13311100070400ff11000d2e133111000311000f133114001411000f03011817000f354911001117000b354911001217000c354911001317000d354911001417000e3549110010030118170010354945fea011000811000b03182d1303182b11000811000c03102d0400ff2e1303102b2f11000811000d03082d0400ff2e1303082b2f1100080400ff11000e2e132f11000311000f133114001511000f03011817000f354911000811000c03182d1303182b11000811000d03102d0400ff2e1303102b2f11000811000e03082d0400ff2e1303082b2f1100080400ff11000b2e132f11000311000f133114001611000f03011817000f354911000811000d03182d1303182b11000811000e03102d0400ff2e1303102b2f11000811000b03082d0400ff2e1303082b2f1100080400ff11000c2e132f11000311000f133114001711000f03011817000f354911000811000e03182d1303182b11000811000b03102d0400ff2e1303102b2f11000811000c03082d0400ff2e1303082b2f1100080400ff11000d2e132f11000311000f133114001811000f03011817000f35491100151100091100023549110016110009110002030118354911001711000911000203021835491100181100091100020303183549084211010a4a120025110002430114000411010a4a120025110003430114000511010f4a120025110001430114000611010f4a12001e11000643011400071101394a1200561100071100040d1100050e006543034a12001f11010a43014207002b1100013a234700591100014a1200760700774301140002030211000212000c2547003c1100020300131400031100034a120078031043011400040d1100040e00651100041100034a120078030003104302180e006b1100020301130e007942024202420300321400021102004a12007a11000143014700191100014a12007b050000331b3b0211000243021400024500650211021507007c0211020111013a43014a12007d11021507007e07007f440207008043024a12007d11021507008107007f44020700824302180700831843011400030700841100013a233300151100034a12008511013b4a12001311000143014301140002110002421100013300090211032111000243014211020311000112000c44011400021102041100024401140003030014000411000411000112000c2747001b1100014a120002110004430111000311000416170004214945ffd8110002421102034a120086110001430133000a11000112001417000135491102011200094a12004502110204110001440143024211020412000e1200234700121100014a120023110002110003430245001d11020411020012000e1200234a120013110001110002110003430344014205000034053b0214000111000112000e14000205000034193c02110002150056110001421100010b07008735491100020b070088354908420b1200874a1200560d0700890e008a0b1200880e006511000211000143034211000112001614000211000233001711021611000112001444014a12008b11000203011943011400031100034700150211013e11000103001100021100031943034500031100014205000034d83b0014000111000112000e140002050000358d3c0111000215009405000035ec3c0011000215009205000038473c011100021500980500003b333c011100021500990500003b5b3c031100021500561100014203000301030203040308031003200340040080031b03360c000b0b07008c354911030a040100440111030a040100440111030a040100440111030a04010044010c00040b07008d354911030a040100440111030a040100440111030a040100440111030a04010044010c00040b07008e354911030a04010044010b07008f354911030a04010044010b070090354911030a030044010b07006b354903000b070091354903000b07004b35490b4a12009243004908421104034a120086110001430133000a1100011200141700013549110416110001440114000211040a03044401140003030014000411000403042747001e1100024a12009303041100041a430111000311000416170004214945ffd9110003420b12008f1400010b1200901400020b12008d1400031100030300131400041100030301131400051100030302131400061100030303131400070b12008e14000811000803001314000911000803011314000a11000803021314000b11000803031314000c11040a040100440114000d030014000e030014000f0300140010030017001035491100100401002747002c1100100400802747000911001003012b45000a11001003012b04011b3111000d11001016170010214945ffca030017001035491100100401002747018d11000f11000f03012b3111000f03022b3111000f03032b3111000f03042b3114001111001103082d0400ff1100112e31036331170011354911001111000111000e354911000e110002110011354911000d11000e1314001211000d1100121314001311000d1100131314001404010111000d110011131a05010101001100111a3114001511001503182b11001503082d2f11000411000e354911001503102b11001503102d2f11000511000e354911001503082b11001503182d2f11000611000e354911001511000711000e354905010101011100141a05000100011100131a310401011100121a31050101010011000e1a31170015354911001503182b11001503082d2f110009110011354911001503102b11001503102d2f11000a110011354911001503082b11001503182d2f11000b110011354911001511000c110011354911000e47003211001211000d11000d11000d110014110012311313133117000e354911000f11000d11000d11000f13133117000f3545000a030117000f3517000e3549170010214945fe6908420b4a1200941100014301140002030032140003030014000411000411000212000c2733000311000347001d110002110004130b12006b11000413251700033549170004214945ffd011000347000208421100020b15006b11000212000c0b07004b3514000503041100052633000603061100052633000603081100052647000d1104110700951100051844014003041100050306180301181a0b0700913514000611040a11000644010b0700963514000911040a11000644010b0700973514000a0b12008f14000b0b12008c14000c0b12008e14000d11000d03001314000e11000d03011314000f11000d03021314001011000d0303131400110300170007354911000711000627470122110007110005274700151100021100071311000911000735170012354500fa11001217001335491100071100051c03002347007011001303082b11001303182d2f170013354911000b11001303182d1303182b11000b11001303102d0400ff2e1303102b2f11000b11001303082d0400ff2e1303082b2f11000b0400ff1100132e132f170013354911001311000c1100071100051b03002f1303182b311700133545005711000503062933000a1100071100051c03042333004111000b11001303182d1303182b11000b11001303102d0400ff2e1303102b2f11000b11001303082d0400ff2e1303082b2f11000b0400ff1100132e132f170013354911000911000711000519131100133103002d170012351100091100073549170007214945fed403001700083549110008110006274700ac11000611000819170007354903031100082e47000a1100091100071345000a11000911000703041913170013354911000803042734000611000703042847000611001345004411000e11000b11001303182d131311000f11000b11001303102d0400ff2e13133111001011000b11001303082d0400ff2e13133111001111000b0400ff1100132e13133111000a110008354911000a1100081303002d11000a1100083549170008214945ff4a084211000103182b050000ff001100012e03082b2f0500ff00001100012e03082c2f11000103182d2f420b12004b0306181400040b1200971400050b1200901400060b12008e14000711000703001314000811000703011314000911000703021314000a11000703031314000b0b4a120094110003430114000c11000c03001314000d11000c03011314000e11000c03021314000f11000c030313140010110409110001440114001111040911001112000c44011400120b12009914002111000211001112000c274703a10211002111001111000213430117001b35490211002111001111000203011813430117001c35490211002111001111000203021813430117001d35490211002111001111000203031813430117001e354911001b11000503001331170017354911001e11000503011331170018354911001d11000503021331170019354911001c1100050303133117001a3549030417001f3549030117002035491100201100042747014011000811001703182d1311000911001803102c0400ff2e133111000a11001903082c0400ff2e133111000b0400ff11001a2e133111000511001f1331170013354911000811001803182d1311000911001903102c0400ff2e133111000a11001a03082c0400ff2e133111000b0400ff1100172e133111000511001f0301181331170014354911000811001903182d1311000911001a03102c0400ff2e133111000a11001703082c0400ff2e133111000b0400ff1100182e133111000511001f0302181331170015354911000811001a03182d1311000911001703102c0400ff2e133111000a11001803082c0400ff2e133111000b0400ff1100192e133111000511001f0303181331170016354911001317001735491100141700183549110015170019354911001617001a354911001f03041817001f3549170020214945feb611000611001703182d1303182b11000611001803102c0400ff2e1303102b3111000611001903082c0400ff2e1303082b311100060400ff11001a2e133111000511001f1331170013354911000611001803182d1303182b11000611001903102c0400ff2e1303102b3111000611001a03082c0400ff2e1303082b311100060400ff1100172e133111000511001f0301181331170014354911000611001903182d1303182b11000611001a03102c0400ff2e1303102b3111000611001703082c0400ff2e1303082b311100060400ff1100182e133111000511001f0302181331170015354911000611001a03182d1303182b11000611001703102c0400ff2e1303102b3111000611001803082c0400ff2e1303082b311100060400ff1100192e133111000511001f030318133117001635490211002111001311000d31430111001211000235490211002111001611000e31430111001211000203011835490211002111001511000f314301110012110002030218354902110021110014110010314301110012110002030318354911001b17000d354911001c17000e354911001d17000f354911001e1700103549110002030418170002354945fc52110012120014420500003fc83b0114000111000112000e1400020500003fd13c01110002150098110001421100010b15008708420b1200874a12009a07009b1100010d0700890e008a0301320700550700560c000243054211020411000112000c11000212000c1844011400031100034a12009c1100014301491100034a12009c11000211000112000c4302491100034205000040cd3b0214000111000112000e14000205000041c03c001100021500aa05000041c83c001100021500ab05000042093c0011000215002a050000422e3c011100021500ad0205000042d83b00430011000215005605000043d73c031100021500b30205000044af3b0043001100021500b605000045f93c041100021500bc050000461f3c011100021500ba050000466e3c011100021500b811000142110002030038254700040d45000311000214000311000312009d140004110004030038254700060300324500031100041400050300320b07009e3549020b0700873549020b07009f3549020b0700a03549020b0700a13549020b0700a235491100010b0700a335491100050b07009d354911000547002f3e0004140007413d00251103171200a41400061100063300141100061200873400061100061200a50b0700873549410700a61100011200a73a2347002f0301321100011200a7263400040b1200873400181103184a1200a80700a94301490300320b1200a30700a73545000d0b120087320b1200a30700a7354908420b1200a31200a7420b1200a2140001110001324700090b4a12002a4300384211040411000144011400020b4a12002a4300490b12009d47000c02110340110002430145000311000242020b0700a23549020b0700a13549020b0700a035490b12009f330006020b07009f354908420211033d11000143011400021104150700ac07007f44024a120085110002430147002f021104191100024a1200230302430143011400040211033c0211042211000411000412000c430243011400034500540211042311000243011400051100054700240211033c0211042011000512007911000512006b1100051200654303430114000345001e1104034a12008611000143014700091100011200144500031100011400031100034205000043c93b031400020211031c0211031b43004a1200ae05000043023c0343014301140001110002420211051b43004a1200af050000431a3c011101000b43034203014700a81100011200b01100010700b13503004800140304480062030548007f0700b24800794945007f0b1200a31200a73247000b03041100011500b04500690b4a1200b311070411020144011102021102034303490b4a1200ab43001402041100014a1200b40700b5110204470009110204120014450001024302421100014a1200b40700b50b4a1200b6110704110201440111020211020343034302421100014a1200b743004245ff5308421101014a1200450b1100004302420b4a1200ad11000243011400040b1200a11400050b1200a21400060b1200a01400070b4a1200b80700b94301491100073300170211034411000711000143021700013549020b0700a035490b4a1200ba110001430114000811000812000c32470002024211000533000711000517000335490b12009f14000911000934000e11034144000b07009f3517000935491100094a12009811000443014911000614000a1100094a120056110008120014030011000343030b0700a235490211033e11000803101d43021200140b0700a1354911000a340001024205000045eb3b031400020211031c0211031b43004a1200ae05000044d93c0343014301140001110002420b1400040211051b43004a1200af05000044f53c011101000b43034203014700ad1100011200b01100010700b135030048000f03024800890700b2480083494500890b1200871702053549110642110205440117020635490b4a1200ad110202430117020735491100014a1200b40700b51102053300150211072111020512009a1102051200560c000243014700231102064a12009811020743014a1200bb05000045a93b0105000045c43b01430245000c11071a05000045da3b0244014302421100014a1200b743004245ff4e084211073f11030511030344024a1200561103011200141100014302421103044a1200bc110001110301110307110303430442021100021108110700bd440143014908421101014a1200450b1100004302420300320b1200a30700a735490300320b07009e35490b4a1200b311000211000311000443034211000114000211000112000c11000112000c03101c1914000311000311000112000c263300240211033e1100010300110003430317000235490211033e11000111000343020b0700a03549110002420b12009e3300080301320b07009e3549084205000046a73b0114000111000112000e1400020205000046b53b0043001100021500561100014211024511000144010b1500be0842050000478a3b031400020211031c0211031b43004a1200ae05000046df3c0343014301140001110002420211051b43004a1200af05000046f73c011101000b430342030147008c1100011200b01100010700b13503004800190302480030030548004e030648005e0700b24800584945005e03021100011500b00b1200be4a1200561102011102021102034303421100011200bf14020411020447000b03051100011500b04500281107110700c04401401100014a1200b40700b511070411020444014302421100014a1200b743004245ff6f08421101014a1200450b11000043024205000002633b0214012205000022c63b0314001a05000031c23b03140120050000321e3b0114012305000032843b01140121050000332b3b0114003c05000033753b0114003d05000033a53b0314003e05000034383b011400400500003ff53b0214004405000000003c0114000105000000633c02140002050000015e3c01140003050000018e3c0314000405000001b93c021400050205000003bb3b0043001400060205000004683b0111000643011400070d05000008b43c010e001e05000009443c010e00251400080d05000009b83c010e001e0500000a2e3c010e00251400090d0500000a993c010e001e0500000ac83c010e002514000a020500000ae13b01110006430114000b020500000cb83b0111000b430114000c020500000de13b01110006430114000d0500000fbf3c0314000e0d050000106f3c010e001e05000011ab3c010e00250700420e003d14000f0c0000140010030014001111001103402747003406001a11010d4a12004311010d4a120044110011030118430143011a03002f11001011001116110011030118170011354945ffc305000012533c0714001205000012893c0714001305000012bf3c0714001405000012f03c071400150205000013223b0111000c4301140016020500001f5b3b0111000643011400170205000020a83b0111000b43011400180301110018070051354903021100180700533549030411001807004b3549030411001807005835490205000022423b0111000643011400190205000023333b01110019430114001b0205000023603b0111001b430111001b07005b35490205000023f23b0111001b430111001b07005c35490d050000248a3c020e006105000025103c010e006214001c0205000025443b01110018430114001d0205000026c43b01110006430114001e0d050000272b3c010e001e05000027833c010e002514001f02050000280a3b0111000643011400201101024a12000f11000644000d11001f0e006d43021100201500330d05000029563c040e006f1400210205000029e13b0111002043011400221101024a12000f1100201200330d1100210e007043021100221500330c00001400230c00001400240c00001400250c00001400260c00001400270c00001400280c00001400290c000014002a0c000014002b0c000014002c0c000014002d030014002e11002e0401002747003211002e0400802747000911002e03012b45000a11002e03012b04011b3111002d11002e1611002e03011817002e354945ffc4030014002f030014003003001400311100310401002747019711003011003003012b3111003003022b3111003003032b3111003003042b3114003211003203082d0400ff1100322e31036331170032354911003211002311002f354911002f110024110032354911002d11002f1314003311002d1100331314003411002d1100341314003504010111002d110032131a05010101001100321a3114003611003603182b11003603082d2f11002511002f354911003603102b11003603102d2f11002611002f354911003603082b11003603182d2f11002711002f354911003611002811002f354905010101011100351a05000100011100341a310401011100331a31050101010011002f1a31170036354911003603182b11003603082d2f110029110032354911003603102b11003603102d2f11002a110032354911003603082b11003603182d2f11002b110032354911003611002c110032354911002f47003211003311002d11002d11002d110035110033311313133117002f354911003011002d11002d1100301313311700303545000e0301170030354911003017002f3549110031030118170031354945fe5f03000301030203040308031003200340040080031b03360c000b140037020500002b183b0111001d4301140038030811003815004b11001d4a120035110038430114003911010212000e12001f14003a11011412000e12001f14003b0205000033e13b00430014003f0205000034803b004300140041020500003fa43b004300140042031014004302050000402e3b0043001400450205000046803b00430014011f084200c1015801510a0b00091a2b070c0d291c010901120a0b07061e0d1a1c230d110a0b07061e0d1a1c240d060d0b07061e0d1a1c250d1c00070c09050d1c00070c240d060c0e1a07052b00091a2b070c0d00040207010606040d060f1c00060b1a0d091c0d09181a071c071c11180d06091b1b010f060505011021060b0b07061b1c1a1d0b1c071a050b0407060d040b090404060a1d0e0e0d1a0a0a111c0d270e0e1b0d1c0a0a111c0d240d060f1c00051f071a0c1b081b010f2a111c0d1b0a5c5a515c515e5f5a515d0a5c5a515c515e5f5a515e0358465d061a09060c070504181d1b00091b1c1a01060f010e11081c073b1c1a01060f050b04090518060b07060b091c040b0d0104051b04010b0d061b1d0a1b1c1a0518091a1b0d142509040e071a050d0c483d3c2e4550480c091c090e370501062a1d0e0e0d1a3b01120d05370c091c090b37062c091c092a111c0d1b051a0d1b0d1c061b1c1a01060f07370918180d060c090a04070b033b01120d03050910030501060f370c07381a070b0d1b1b2a04070b03061b1804010b0d0837181a070b0d1b1b030b0e0f080e0106090401120d0d370b1a0d091c0d200d04180d1a11370b1a0d091c0d2005090b200d04180d1a08370c073a0d1b0d1c061d180c091c0d0b370c072e0106090401120d073700091b000d1a053707230d11053701230d1104370509180458465f5d060b00091a291c0b371a0d1e0d1a1b0d2509180701060c0d10270e41292a2b2c2d2e2f202122232425262738393a3b3c3d3e3f303132090a0b0c0d0e0f000102030405060718191a1b1c1d1e1f10111258595a5b5c5d5e5f505143475503090a1b031b01060509181804110a5c585a5b5a5b5b5c595f0a5a5d5e5a5b505b59585a053700091b000a5c5a5f505a5d5d5b5e58050e0407071a07030d113b01120d0600091b000d1a0a011c0d1a091c0107061b070b0705181d1c0d0a37100e071a0525070c0d0437030d110f372d262b37302e273a253725272c2d0f0b1a0d091c0d2d060b1a11181c071a0f372c2d2b37302e273a253725272c2d0f0b1a0d091c0d2c0d0b1a11181c071a070d060b1a11181c070c0d0b1a11181c07181a070b0d1b1b06011e3b01120d07370b0118000d1a0337011e092d060b1a11181c071a092c0d0b1a11181c071a0a37181a0d1e2a04070b030c0d060b1a11181c2a04070b030c181a070b0d1b1b2a04070b030c0c0d0b1a11181c2a04070b030318090c051d0618090c0405070c0d0718090c0c01060f02011e053705070c0d0937370b1a0d091c071a090e071a05091c1c0d1a0a0b0118000d1a1c0d101c041b09041c03030d110909040f071a011c0005060e071a05091c063718091a1b0d070d100d0b1d1c0d03030c0e0837063a071d060c1b0e37030d11381a01071a3a0d1b0d1c0c37030d113b0b000d0c1d040d0f3701061e230d113b0b000d0c1d040d0d370c072b1a11181c2a04070b03051b1804011c0152091b1d0a1b1c1a01060f070d060b2c091c0907011b291a1a0911061a0d0c1d0b0d0136071a0d1804090b0d143346424357364c13154041143334353447343435010f03344c4e2f1c073b1c1a01060f14400e1d060b1c01070641464257405755343434404114480e071a484643574057553434343541054c59464257014c080e1d060b1c010706041c0d1b1c06011b3e010d1f061b1d0a1c040d05090d1b213e07292d3b452b2a2b040609050d080f0d1c3d01061c50041a0b0706061b1d0a2501100901061e3b1d0a250110041b2a07100701061e3b2a071006031b3a071f1b090106011c3c090a040d090f0d1c3d01061c5b5a181d01061c50291a1a09113c073d01061c5b5a291a1a0911371521061e0904010c48090d1b48030d11481b01120d550b030d113b0b000d0c1d040d0e01061e230d113b0b000d0c1d040d090d101809060c230d1116060d1c1f071a033c0720071b1c271a0c0d1a3b1f091809010518071a1c230d11031a091f031b0d1c121a0d05071e0d38232b3b5f38090c0c01060f0a04070f2d06090a040d0c111b070e1c1f091a0d2c0d0b1a11181c0d1a0d1a0d050901060c0d1a2c091c09090b1d1a1a0d061c213e0d0b1d1a1a0d061c3a0d1b1d041c060b07060e010f060b1a11181c070c1f0d0a03011c3b1d0a1c040d070a0707040d0906110d06090a040d3b070e1c1f091a0d292d3b0304070f4a2c1d0d481c07481c000d481b011c1d091c010706481c00091c480d061e480c07064f1c481b1d1818071a1c480b1a11181c0744480e0904040a090b03481c0748021b480c0d0b1a11181c06011b3b11060b050e041d1b000336594511181a011e091c0d230d112c0d0b1a11181c0405091a03041f1a091804060d101c04181a0d1e030d060c0f1b070e1c1f091a0d2c0d0b1a11181c06090a1a1d181c061a0d1c1d1a06101f0d0a2b1a11181c072c0d0b1a11181c041b1c07180704070f27060b0d0e223b48292d3b480c0d0b1a11181c0d0f0d1c3e0904010c2b001d0603041c000d061007063f0d0a2b1a11181c072d1a1a071a171f0d0a0b1a11181c07480b000d0b03480e0901041d1a0d0a370c0d0b1a11181c0d1a041b0d061c0f0c0d0b1a11181c480e0901041d1a0d",{0:Array,1:String,2:Object,3:ArrayBuffer,4:Uint8Array,5:Int8Array,6:Uint8ClampedArray,7:Int16Array,8:Uint16Array,9:Int32Array,10:Uint32Array,11:Float32Array,12:Float64Array,13:Math,14:parseInt,15:decodeURIComponent,get 16(){return escape},17:Error,get 18(){return unescape},19:encodeURIComponent,20:Function,21:RegExp,22:DataView,get 23(){return self},get 24(){return console},get 25(){return atob},26:Promise,get 27(){return ae},get 28(){return se},get 29(){return ue},get 30(){return he},get 31(){return pe},set 31(e){pe=e},get 32(){return ye},set 32(e){ye=e},get 33(){return me},set 33(e){me=e},get 34(){return ge},set 34(e){ge=e},get 35(){return ve},set 35(e){ve=e}},globalThis);var be,_e,Ee,Te,Se,$e={exports:{}};be=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,_e=/^(?=([^\/?#]*))\1([^]*)$/,Ee=/(?:\/|^)\.(?=\/)/g,Te=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,$e.exports=Se={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=Se.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=Se.normalizePath(n.path),Se.buildURLFromParts(n)}var i=Se.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=Se.normalizePath(i.path),Se.buildURLFromParts(i)):t;var a=Se.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var o=_e.exec(a.path);a.netLoc=o[1],a.path=o[2]}a.netLoc&&!a.path&&(a.path="/");var s={scheme:a.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(s.netLoc=a.netLoc,"/"!==i.path[0]))if(i.path){var l=a.path,u=l.substring(0,l.lastIndexOf("/")+1)+i.path;s.path=Se.normalizePath(u)}else s.path=a.path,i.params||(s.params=a.params,i.query||(s.query=a.query));return null===s.path&&(s.path=r.alwaysNormalize?Se.normalizePath(i.path):i.path),Se.buildURLFromParts(s)},parseURL:function(e){var t=be.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(Ee,"");e.length!==(e=e.replace(Te,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};var Ae=$e.exports;function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){Le(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ie(){Ie=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function Ce(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void r(u)}s.done?t(l):Promise.resolve(l).then(n,i)}function Pe(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){Ce(a,n,i,o,s,"next",e)}function s(e){Ce(a,n,i,o,s,"throw",e)}o(void 0)}))}}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Oe(e,t,r){return t&&Re(e.prototype,t),r&&Re(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Le(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function De(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ne(e,t)}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ne(e,t){return(Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e,t){if(t&&("object"==_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ge(e)}function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Me(e);if(t){var i=Me(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ve(this,r)}}function Ze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(e,t)||Fe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(e){return function(e){if(Array.isArray(e))return je(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Fe(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fe(e,t){if(e){if("string"==typeof e)return je(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?je(e,t):void 0}}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function We(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?We(Object(r),!0).forEach((function(t){et(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):We(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function He(){He=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==_typeof$b(Symbol.iterator)?function(e){return _typeof$b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$b(e)})(e)}function Ye(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void r(u)}s.done?t(l):Promise.resolve(l).then(n,i)}function ze(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){Ye(a,n,i,o,s,"next",e)}function s(e){Ye(a,n,i,o,s,"throw",e)}o(void 0)}))}}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function qe(e,t,r){return t&&Qe(e.prototype,t),r&&Qe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nt(e,t)}function rt(e){return(rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nt(e,t){return(nt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function it(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function at(e,t,r){return(at=it()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&nt(i,r.prototype),i}).apply(null,arguments)}function ot(e){var t="function"==typeof Map?new Map:void 0;return ot=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return at(e,arguments,rt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),nt(n,e)},ot(e)}function st(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e,t){if(t&&("object"==_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return lt(e)}function ct(e){var t=it();return function(){var r,n=rt(e);if(t){var i=rt(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ut(this,r)}}function dt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=rt(e)););return e}function ht(){return ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=dt(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},ht.apply(this,arguments)}function ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function pt(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ft(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ft(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function yt(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}function mt(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}var gt,vt=function(){function e(){Je(this,e)}return qe(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(t){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var a=r.length;if(a&&t){var o=r[a-1],s=o[1];if(e.start(n)-s<=t){var l=e.end(n);l>s&&(o[1]=l)}else r.push([e.start(n),e.end(n)])}else r.push([e.start(n),e.end(n)])}return r}},{key:"length",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=e.buffers(t,n),h=0,f=d.length;h<f;h++){var p=d[h];if(r+n>=p[0]&&r<p[1])i=p[0],a=p[1],o=h;else{if(r+n<p[0]){s=p[0],l=p[1];break}r+n>p[1]&&(u=p[0],c=p[1])}}return{start:i,end:a,index:o,buffers:d,nextStart:s,nextEnd:l,prevStart:u,prevEnd:c,currentTime:r,behind:r-i,remaining:a?a-r:0,length:e.length&&e.length(d)}}}]),e}(),bt="manifest",_t="network",Et="network_timeout",Tt="demux",St="remux",$t="media",At="other",wt={FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION"},kt=(et(gt={},bt,{HLS:1100}),et(gt,_t,2100),et(gt,Et,2101),et(gt,Tt,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),et(gt,St,{FMP4:4100,MP4:4200}),et(gt,$t,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203}),et(gt,At,8e3),gt),It=function(e){tt(r,e);var t=ct(r);function r(e,n,i,a,o){var s;return Je(this,r),(s=t.call(this,o||(null==i?void 0:i.message))).errorType=e===Et?_t:e,s.originError=i,s.ext=a,s.errorCode=kt[e][n]||kt[e],s.errorMessage=s.message,s.errorCode||(s.errorType=At,s.errorCode=kt[s.errorType]),s}return qe(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=At),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!=e&&e.isTimeout?Et:_t,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(ot(Error)),Ct="undefined"!=typeof window,Pt=function(){function e(t){Je(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return qe(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix,mt()].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix,mt()].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix,mt()].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix,mt()].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();et(Pt,"disabled",!0);var xt=function(){try{return Ct?window.MediaSource:null}catch(e){}}(),Rt="appendBuffer",Ot="removeBuffer",Lt=function(){function e(t,r){var n=this;Je(this,e),et(this,"media",null),et(this,"mediaSource",null),et(this,"_openPromise",yt()),et(this,"_queue",Object.create(null)),et(this,"_sourceBuffer",Object.create(null)),et(this,"_mseFullFlag",{}),et(this,"_st",0),et(this,"_opst",0),et(this,"_logger",null),et(this,"_config",null),et(this,"_url",null),et(this,"_onSBUpdateEnd",(function(e){var t=n._queue[e];if(t){var r=t.shift();if(r){var i=mt()-n._opst;n._logger.debug("UpdateEnd",r.opName,i,r.context),r.promise.resolve({name:r.opName,context:r.context,costtime:i}),n._startQueue(e)}}})),et(this,"_onSBUpdateError",(function(e,t){var r=n._queue[e];if(r){var i=r[0];i&&(n._logger.error("UpdateError",e,i.opName,i.context),i.promise.reject(new It($t,wt.MSE_APPEND_BUFFER,t)))}})),this._config=Object.assign(e.getDefaultConfig(),r),t&&this.bindMedia(t),this._logger=new Pt("MSE"),this._config.openLog&&Pt.enable()}var t,r,n;return qe(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[e.VIDEO]}},{key:"updateDuration",value:function(e){var t=this;return this.mediaSource&&this.mediaSource.duration>e?Promise.resolve():this._enqueueBlockingOp((function(){t.isEnded?t._logger.debug("[debug mse] setDuration ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("[debug mse] setDuration"))}),"updateDuration")}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",(function r(){var n=mt()-e._st;e._logger.debug("MSE OPEN",n),t.removeEventListener("sourceopen",r),e._openPromise.resolve({costtime:n})})),this._openPromise=yt()}return this._openPromise}},{key:"bindMedia",value:(n=ze(He().mark((function e(t){var r,n,i=this;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(t&&xt){e.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=t,r=this.mediaSource=new xt,this._st=mt(),n=function e(){var n=mt()-i._st;i._logger.debug("MSE OPEN"),r.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),i._openPromise.resolve({costtime:n})},r.addEventListener("sourceopen",n),this._url=URL.createObjectURL(r),t.src=this._url,e.abrupt("return",this._openPromise);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unbindMedia",value:(r=ze(He().mark((function e(){var t,r,n,i=this;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach((function(e){var t=i._queue[e];t&&t.forEach((function(e){return e.promise.resolve}))})),r=!!this.media&&this.media.readyState>=1,n="open"===t.readyState,r&&n)try{t.endOfStream()}catch(a){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(i._sourceBuffer[e])}catch(a){}}))}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(a){}this.media=null}this.mediaSource=null,this._openPromise=yt(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(n){throw new It($t,wt.MSE_ADD_SB,n)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this._sourceBuffer[e];return this.mediaSource&&r&&r.mimeType!==t&&"function"==typeof r.changeType?this._enqueueOp((function(){r.changeType(t)})):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,r){var n=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var i;n.mediaSource&&(n._logger.debug("MSE APPEND START",r),n._opst=mt(),null===(i=n._sourceBuffer[e])||void 0===i||i.appendBuffer(t))}),Rt,r):Promise.resolve()}},{key:"remove",value:function(e,t,r,n){var i=this,a=!1;return this._mseFullFlag[e]&&(a=!0),this._enqueueOp(e,(function(){if(i.mediaSource){var a=i._sourceBuffer[e];t>=r||!a?i._onSBUpdateEnd(e):(i._opst=mt(),i._logger.debug("MSE REMOVE START",e,t,r,n),a.remove(t,r))}}),Ot,n,a)}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach((function(i){r=n._enqueueOp(i,(function(){if(n.mediaSource){var r=n._sourceBuffer[i];n._logger.debug("MSE clearBuffer START",i,e,t),r.remove(e,t)}}))})),r}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(r){e=t._enqueueOp(r,(function(){if(t.mediaSource){var e=t._sourceBuffer[r];t._logger.debug("MSE clearAllBuffer START",r),e.remove(0,vt.end(vt.get(e)))}}))})),e}},{key:"clearOpQueues",value:function(e){var t;this._logger.debug("MSE clearOpQueue START");var r=this._queue[e];if(r&&r[e]&&!(r.length<5)){var n=[];r.forEach((function(e){e.context&&e.context.isinit&&n.push(e)})),this._queue[e]=r.slice(0,2),n.length>0&&(t=this._queue[e]).push.apply(t,n)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var r=t.mediaSource;r&&"open"===r.readyState&&(t._logger.debug("MSE endOfStream START"),e?r.endOfStream(e):r.endOfStream())}),"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||null==r||!r.setLiveSeekableRange||"open"!==r.readyState||r.setLiveSeekableRange(e,t)}},{key:"buffered",value:function(e){return vt.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return vt.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return vt.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,r,n,i){var a=this;if(!this.mediaSource)return Promise.resolve();var o=this._queue[e]=this._queue[e]||[],s={exec:t,promise:yt(),opName:r,context:n};return i?(o.splice(0,0,s),this._mseFullFlag[e]=!1,this._startQueue(e)):o.push(s),this.isOpened?1===o.length&&this._startQueue(e):this._openPromise.then((function(){1===o.length&&a._startQueue(e)})),s.promise}},{key:"_enqueueBlockingOp",value:(t=ze(He().mark((function e(t,r){var n,i,a=this;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((n=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return i=[],n.forEach((function(e){var t=a._queue[e],n=yt();i.push(n),t.push({exec:function(){return n.resolve()},promise:n,opName:r}),1===t.length&&a._startQueue(e)})),e.abrupt("return",Promise.all(i).then((function(){try{return t()}finally{n.forEach((function(e){var t=a._queue[e],r=a._sourceBuffer[e];null==t||t.shift(),r&&r.updating||a._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r&&!this._mseFullFlag[e])try{r.exec()}catch(n){n&&n.message&&n.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,this._logger.error("[MSE error],  context,",r.context," ,name,",r.opName,",err,SourceBuffer is full"),r.promise.reject(new It($t,wt.MSE_FULL,n))):(this._logger.error(n),r.promise.reject(new It($t,wt.MSE_OTHER,n)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this._enqueueOp(e,(function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)}),"setTimeoffset",r)}},{key:"abort",value:function(e,t){var r=this;return this.isOpened?this._enqueueOp(e,(function(){r._sourceBuffer[e].abort(),r._onSBUpdateEnd(e)}),"abort",t):Promise.resolve()}}],[{key:"getDefaultConfig",value:function(){return{openLog:!1}}},{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!xt)return!1;try{return xt.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}}}]),e}();et(Lt,"VIDEO","video"),et(Lt,"AUDIO","audio");var Dt="fetch",Mt="xhr",Nt="arraybuffer",Gt="text",Vt="json",Ut=function(e){tt(r,e);var t=ct(r);function r(e,n,i,a){var o;return Je(this,r),et(lt(o=t.call(this,a)),"retryCount",0),et(lt(o),"isTimeout",!1),et(lt(o),"loaderType",Dt),et(lt(o),"startTime",0),et(lt(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return qe(r)}(ot(Error)),Zt=Object.prototype.toString;function Bt(e){if("[object Object]"!==Zt.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function Ft(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function jt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Wt(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){var r,n;return r=t,"[object Date]"===Zt.call(r)?t=t.toISOString():null!==(n=t)&&"object"===Ke(n)&&(t=JSON.stringify(t)),"".concat(jt(e),"=").concat(jt(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function Xt(e,t,r,n,i,a,o,s,l,u,c){return i=null!=i?parseFloat(i):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0),{data:e,done:t,option:{range:l,vid:u,index:s,contentLength:n,age:i,startTime:a,firstByteTime:o,endTime:Date.now(),priOptions:c},response:r}}function Ht(e,t){return Math.round(8*e*1e3/t/1024)}var Kt={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},Yt={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,a||e,o),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,o=new Array(a);i<a;i++)o[i]=n[i].fn;return o},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,a,o){var s=r?r+e:e;if(!this._events[s])return!1;var l,u,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,a),!0;case 6:return c.fn.call(c.context,t,n,i,a,o),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},s.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||o(this,a);else{for(var l=0,u=[],c=s.length;l<c;l++)(s[l].fn!==t||i&&!s[l].once||n&&s[l].context!==n)&&u.push(s[l]);u.length?this._events[a]=1===u.length?u[0]:u:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(Yt);var zt=Yt.exports,Jt=2097152,Qt=function(e){tt(n,e);var t,r=ct(n);function n(){var e;return Je(this,n),et(lt(e=r.call(this)),"_abortController",null),et(lt(e),"_timeoutTimer",null),et(lt(e),"_reader",null),et(lt(e),"_response",null),et(lt(e),"_aborted",!1),et(lt(e),"_index",-1),et(lt(e),"_range",null),et(lt(e),"_receivedLength",0),et(lt(e),"_running",!1),et(lt(e),"_logger",null),et(lt(e),"_vid",""),et(lt(e),"_onProcessMinLen",0),et(lt(e),"_onCancel",null),et(lt(e),"_priOptions",null),e}return qe(n,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.vid,a=e.timeout,o=e.responseType,s=e.onProgress,l=e.index,u=e.onTimeout,c=e.onCancel,d=e.range,h=e.transformResponse,f=e.request,p=e.params,y=e.logger,m=e.method,g=e.headers,v=e.body,b=e.mode,_=e.credentials,E=e.cache,T=e.redirect,S=e.referrer,$=e.referrerPolicy,A=e.onProcessMinLen,w=e.priOptions;this._logger=y,this._aborted=!1,this._onProcessMinLen=A,this._onCancel=c,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=l,this._range=d||[0,0],this._vid=i||n,this._priOptions=w||{};var k={method:m,headers:g,body:v,mode:b,credentials:_,cache:E,redirect:T,referrer:S,referrerPolicy:$,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},I=!1;clearTimeout(this._timeoutTimer),n=Wt(n,p);var C=Ft(d);C&&((g=f?f.headers:k.headers=k.headers||new Headers)instanceof Headers?g.append("Range",C):g.Range=C),a&&(this._timeoutTimer=setTimeout((function(){if(I=!0,r.cancel(),u){var e=new Ut(n,k,null,"timeout");e.isTimeout=!0,u(e,r._index)}}),a));var P=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",d),new Promise((function(e,t){var i;fetch(f||n,f?void 0:k).then((i=ze(He().mark((function i(a){var u,c,f,p;return He().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=a,!r._aborted&&r._running){i.next=4;break}return i.abrupt("return");case 4:if(h&&(a=h(a,n)||a),a.ok){i.next=7;break}throw new Ut(n,k,a,"bad network response");case 7:if(u=Date.now(),o!==Gt){i.next=15;break}return i.next=11,a.text();case 11:c=i.sent,r._running=!1,i.next=37;break;case 15:if(o!==Vt){i.next=22;break}return i.next=18,a.json();case 18:c=i.sent,r._running=!1,i.next=37;break;case 22:if(!s){i.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(a,s,P,u),i.abrupt("return");case 29:return i.next=31,a.arrayBuffer();case 31:c=i.sent,c=new Uint8Array(c),r._running=!1,f=Date.now()-P,p=Ht(c.byteLength,f),r.emit(Kt.REAL_TIME_SPEED,{speed:p});case 37:r._logger.debug("[fetch load end], index,",l,",range,",d),e(Xt(c,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),P,u,l,d,r._vid,r._priOptions));case 39:case"end":return i.stop()}}),i)}))),function(e){return i.apply(this,arguments)})).catch((function(e){clearTimeout(r._timeoutTimer),r._running=!1,r._aborted&&!I||((e=e instanceof Ut?e:new Ut(n,k,null,JSON.stringify(e))).startTime=P,e.endTime=Date.now(),e.isTimeout=I,t(e))}))}))}},{key:"cancel",value:(t=ze(He().mark((function e(){return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(t){}this._abortController=null}this._onCancel&&this._onCancel(this._index);case 16:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,n){var i=this;if(!e.body||!e.body.getReader)return this._running=!1,void this.reject(Ut(e.url,"",e,"onProgress of bad response.body.getReader"));this._onProcessMinLen>0&&(this._cache=new Uint8Array(Jt),this._writeIdx=0);var a,o,s,l,u=this._reader=e.body.getReader(),c=(l=ze(He().mark((function l(){var d,h,f,p,y,m;return He().wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return o=Date.now(),l.prev=1,l.next=4,u.read();case 4:a=l.sent,s=Date.now(),l.next=13;break;case 8:return l.prev=8,l.t0=l.catch(1),s=Date.now(),i._aborted||(i._running=!1,i.reject(l.t0)),l.abrupt("return");case 13:if(d=i._range[0]+i._receivedLength,!i._aborted){l.next=18;break}return i._running=!1,t(void 0,!1,{range:[d,d],vid:i._vid,index:i._index,startTime:o,endTime:s,priOptions:i._priOptions},e),l.abrupt("return");case 18:h=a.value?a.value.byteLength:0,i._receivedLength+=h,i._logger.debug("fetchLoader,onProgress call,task,",i._range,", start,",d,", end,",i._range[0]+i._receivedLength,", done,",a.done),i._onProcessMinLen>0?i._writeIdx+h>=i._onProcessMinLen||a.done?((f=new Uint8Array(i._writeIdx+h)).set(i._cache.slice(0,i._writeIdx),0),h>0&&f.set(a.value,i._writeIdx),i._writeIdx=0,i._logger.debug("fetchLoader,onProgress enough,done,",a.done,",len,",f.byteLength,", writeIdx,",i._writeIdx)):h>0&&i._writeIdx+h<Jt?(i._cache.set(a.value,i._writeIdx),i._writeIdx+=h,i._logger.debug("fetchLoader,onProgress cache,len,",h,", writeIdx,",i._writeIdx)):h>0&&(p=new Uint8Array(i._writeIdx+h+2048),i._logger.debug("fetchLoader,onProgress extra start,size,",i._writeIdx+h+2048,", datalen,",h,", writeIdx,",i._writeIdx),p.set(i._cache.slice(0,i._writeIdx),0),h>0&&p.set(a.value,i._writeIdx),i._writeIdx+=h,delete i._cache,i._cache=p,i._logger.debug("fetchLoader,onProgress extra end,len,",h,", writeIdx,",i._writeIdx)):f=a.value,(f&&f.byteLength>0||a.done)&&t(f,a.done,{range:[i._range[0]+i._receivedLength-(f?f.byteLength:0),i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:o,endTime:s,priOptions:i._priOptions},e),y=Date.now()-r,m=Ht(i._receivedLength,y),i.emit(Kt.REAL_TIME_SPEED,{speed:m}),a.done?(i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",a.done),i.resolve(Xt(a,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),o,n,i._index,i._range,i._vid,i._priOptions))):c();case 27:case"end":return l.stop()}}),l,null,[[1,8]])}))),function(){return l.apply(this,arguments)});c()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),n}(zt),qt=function(e){tt(r,e);var t=ct(r);function r(){var e;return Je(this,r),et(lt(e=t.call(this)),"_xhr",null),et(lt(e),"_aborted",!1),et(lt(e),"_timeoutTimer",null),et(lt(e),"_range",null),et(lt(e),"_receivedLength",0),et(lt(e),"_url",null),et(lt(e),"_onProgress",null),et(lt(e),"_index",-1),et(lt(e),"_headers",null),et(lt(e),"_currentChunkSizeKB",384),et(lt(e),"_timeout",null),et(lt(e),"_xhr",null),et(lt(e),"_withCredentials",null),et(lt(e),"_startTime",-1),et(lt(e),"_loadCompleteResolve",null),et(lt(e),"_loadCompleteReject",null),et(lt(e),"_runing",!1),et(lt(e),"_logger",!1),et(lt(e),"_vid",""),et(lt(e),"_responseType",void 0),et(lt(e),"_credentials",void 0),et(lt(e),"_method",void 0),et(lt(e),"_transformResponse",void 0),et(lt(e),"_firstRtt",void 0),et(lt(e),"_subRangeStartTime",void 0),et(lt(e),"_onCancel",null),et(lt(e),"_priOptions",null),e}return qe(r,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range||[0,0],this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._credentials=e.credentials,this._priOptions=e.priOptions||{},this._logger.debug("xhrLoader task, range",this._range),this._url=Wt(e.url,e.params);var r=Date.now();return new Promise((function(e,r){t._loadCompleteResolve=e,t._loadCompleteReject=r,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof Ut?e:new Ut(t._url,t._request)).startTime=r,e.endTime=Date.now(),e}))}},{key:"_startLoad",value:function(){var e=null;if(this._range&&this._range.length>1)if(this._onProgress){this._subRangeStartTime=Date.now(),this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,r=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-r&&(n=r+t),e=[r,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var t=this;try{this._startTime=Date.now();var r=this._xhr=new XMLHttpRequest;r.open(this._method||"GET",this._url,!0),r.responseType=this._responseType,this._timeout&&(r.timeout=this._timeout),r.withCredentials=this._credentials,r.onload=this._onLoad.bind(this),r.onreadystatechange=this._onReadyStatechange.bind(this),r.onerror=function(e){t._running=!1;var r=new Ut(t._url,t._request,{status:0},"onerror");t._loadCompleteReject(r)},r.ontimeout=function(e){t.cancel();var r=new Ut(t._url,t._request,{status:408},"timeout");t._onTimeout&&(r.isTimeout=!0,t._onTimeout(r,t._index)),t._loadCompleteReject(r)};var n=Ft(e),i=null;n&&((i=this._headers||{}).Range=n),i&&Object.keys(i).forEach((function(e){r.setRequestHeader(e,i[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),r.send()}catch(a){this._loadCompleteReject(a)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t=e.target.status;if(t<200||t>299)return this._loadCompleteReject(new Ut(this._url,null,Xe(Xe({},e.target.response),{},{status:t}),"bad response,status:"+t));var r,n=null,i=!1;if(this._responseType===Nt){var a=new Uint8Array(e.target.response);if(r=this._range[0]+this._receivedLength,a&&a.byteLength>0){this._receivedLength+=a.byteLength;var o=Date.now()-this._subRangeStartTime,s=Ht(this._receivedLength,o);this.emit(Kt.REAL_TIME_SPEED,{speed:s})}n=a,i=!(this._range.length>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",r,"end ",this._range[0]+this._receivedLength,",dataLen,",a?a.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",i)}else i=!0,n=e.target.response;var l={ok:t>=200&&t<300,status:t,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(l=this._transformResponse(l,this._url)||l),this._onProgress&&this._onProgress(n,i,{index:this._index,vid:this._vid,range:[r,this._range[0]+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},l),i?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Xt(this._onProgress?null:n,i,l,l.headers["content-length"],l.headers.age,this._startTime,-1,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,ht(rt(r.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel(this._index),this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r={},n=pt(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),r}(zt),er=["retry","retryDelay","onRetryError","transformError"],tr=function(){function e(t,r){Je(this,e),this.promise=yt(),this.alive=!!r.onProgress,!r.logger&&(r.logger=new Pt("Loader")),this._loaderType=t,this._loader=t===Dt?new Qt:new qt,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._logger=r.logger}var t;return qe(e,[{key:"exec",value:function(){var e,t=this,r=this._config,n=r.retry,i=r.retryDelay,a=r.onRetryError,o=r.transformError,s=st(r,er),l=(e=ze(He().mark((function e(){var r,u;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t._loader.load(s);case 3:r=e.sent,t.promise.resolve(r),e.next=28;break;case 7:if(e.prev=7,e.t0=e.catch(0),t._loader.running=!1,t._logger.debug("[task request catch err]",e.t0),!t._canceled){e.next=13;break}return e.abrupt("return");case 13:if(!(e.t0.response&&e.t0.response.status>=400&&e.t0.response.status<=599)){e.next=16;break}return t.promise.reject(e.t0),e.abrupt("return");case 16:if(e.t0.loaderType=t._loaderType,e.t0.retryCount=t._retryCount,u=e.t0,o&&(u=o(u)||u),a&&t._retryCount>0&&a(u,t._retryCount,n),t._retryCount++,!(t._retryCount<=n)){e.next=27;break}return clearTimeout(t._retryTimer),t._logger.debug("[task request setTimeout],retry",t._retryCount,",retry range,",s.range),t._retryTimer=setTimeout(l,i),e.abrupt("return");case 27:t.promise.reject(u);case 28:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){return e.apply(this,arguments)});return l(),this.promise}},{key:"cancel",value:(t=ze(He().mark((function e(){return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),e}();function rr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((t=t.filter(Boolean)).length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function nr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var ir=function(e){tt(n,e);var t,r=ct(n);function n(e){var t;return Je(this,n),et(lt(t=r.call(this,e)),"type",Dt),et(lt(t),"_queue",[]),et(lt(t),"_alive",[]),et(lt(t),"_currentTask",null),et(lt(t),"_config",void 0),t._config=Xe({loaderType:Dt,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:Gt,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e),t._config.loaderType!==Mt&&Qt.isSupported()||(t.type=Mt),t.log=e.logger,t}return qe(n,[{key:"isFetch",value:function(){return this.type===Dt}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?r=e:r.url=e||r.url||this._config.url,(r=Object.assign({},this._config,r)).params&&(r.params=Object.assign({},r.params)),r.headers&&Bt(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&Bt(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var n=new tr(this.type,r);return n.loader.on(Kt.REAL_TIME_SPEED,(function(e){t.emit(Kt.REAL_TIME_SPEED,e)})),this._queue.push(n),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),n.promise}},{key:"cancel",value:(t=ze(He().mark((function e(){var t;return He().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,nr();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(e){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return Qt.isSupported()}}]),n}(zt),ar=function(){function e(){Je(this,e),et(this,"_prevCurrentTime",0)}return qe(e,[{key:"do",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e){var i=e.currentTime,a=0;if(this._prevCurrentTime===i){var o=vt.info(vt.get(e),i);if(!o.buffers.length)return;r&&o.nextStart||o.nextStart&&o.nextStart-i<t?a=o.nextStart+.1:o.end&&o.end-i>n&&!e.seeking&&(a=i+.1)}this._prevCurrentTime=i,a&&i!==a&&(e.currentTime=a)}}}]),e}(),or=function(){function e(t){var r=this;Je(this,e),et(this,"_seiSet",new Set),this.emitter=t,t.on(Kt.SEI,(function(e){e&&r._seiSet.add(e)}))}return qe(e,[{key:"throw",value:function(e){var t=this;if(null!=e&&this._seiSet.size){var r=e-.2,n=e+.2,i=[];this._seiSet.forEach((function(e){e.time>=r&&e.time<=n&&i.push(e)})),i.forEach((function(e){t._seiSet.delete(e),t.emitter.emit(Kt.SEI_IN_TIME,e)}))}}},{key:"reset",value:function(){this._seiSet.clear()}}]),e}(),sr=function(){function e(){Je(this,e),et(this,"_chunkSpeeds",[]),et(this,"_speeds",[])}return qe(e,[{key:"addRecord",value:function(e,t){e&&t&&(this._speeds.push(8e3*e/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(e,t){e&&t&&(this._chunkSpeeds.push(8e3*e/t),this._chunkSpeeds=this._chunkSpeeds.slice(-100))}},{key:"getAvgSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds.reduce((function(e,t){return e+t}))/this._speeds.length:this._chunkSpeeds.reduce((function(e,t){return e+t}))/this._chunkSpeeds.length:0}},{key:"getLatestSpeed",value:function(){return this._chunkSpeeds.length||this._speeds.length?this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeeds[this._chunkSpeeds.length-1]:0}},{key:"reset",value:function(){this._chunkSpeeds=[],this._speeds=[]}}]),e}();function lr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ur(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cr(e,t,r){return t&&ur(e.prototype,t),r&&ur(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function dr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hr(e){return(hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fr(e,t){return(fr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function pr(e,t){if(t&&("object"==_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function yr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=hr(e);if(t){var i=hr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return pr(this,r)}}function mr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(e,t)||vr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gr(e){return function(e){if(Array.isArray(e))return br(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||vr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vr(e,t){if(e){if("string"==typeof e)return br(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?br(e,t):void 0}}function br(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var _r="video",Er="audio",Tr="metadata",Sr="avc",$r="hevc",Ar="aac",wr="g7110a",kr="g7110m",Ir="LARGE_AV_SHIFT",Cr="LARGE_VIDEO_GAP",Pr="LARGE_VIDEO_GAP_BETWEEN_CHUNK",xr="LARGE_AUDIO_GAP",Rr="AUDIO_FILLED",Or="AUDIO_DROPPED",Lr=function(){function e(){lr(this,e),dr(this,"id",1),dr(this,"type",_r),dr(this,"codecType",Sr),dr(this,"pid",-1),dr(this,"hvcC",void 0),dr(this,"codec",""),dr(this,"timescale",0),dr(this,"formatTimescale",0),dr(this,"sequenceNumber",0),dr(this,"baseMediaDecodeTime",0),dr(this,"baseDts",0),dr(this,"duration",0),dr(this,"warnings",[]),dr(this,"samples",[]),dr(this,"pps",[]),dr(this,"sps",[]),dr(this,"vps",[]),dr(this,"fpsNum",0),dr(this,"fpsDen",0),dr(this,"sarRatio",[]),dr(this,"width",0),dr(this,"height",0),dr(this,"nalUnitSize",4),dr(this,"present",!1),dr(this,"isVideoEncryption",!1),dr(this,"isAudioEncryption",!1),dr(this,"kid",null),dr(this,"pssh",null),dr(this,"ext",void 0)}return cr(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),Dr=function(){function e(){lr(this,e),dr(this,"id",2),dr(this,"type",Er),dr(this,"codecType",Ar),dr(this,"pid",-1),dr(this,"codec",""),dr(this,"sequenceNumber",0),dr(this,"sampleDuration",0),dr(this,"timescale",0),dr(this,"formatTimescale",0),dr(this,"baseMediaDecodeTime",0),dr(this,"duration",0),dr(this,"warnings",[]),dr(this,"samples",[]),dr(this,"baseDts",0),dr(this,"sampleSize",16),dr(this,"sampleRate",0),dr(this,"channelCount",0),dr(this,"objectType",0),dr(this,"sampleRateIndex",0),dr(this,"config",[]),dr(this,"present",!1),dr(this,"isVideoEncryption",!1),dr(this,"isAudioEncryption",!1),dr(this,"kid",null),dr(this,"ext",void 0)}return cr(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===Ar)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),Mr=function(){function e(t,r,n){lr(this,e),dr(this,"flag",{}),dr(this,"keyframe",!1),dr(this,"gopId",0),dr(this,"duration",0),dr(this,"size",0),dr(this,"units",[]),dr(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return cr(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),Nr=cr((function e(t,r,n,i){lr(this,e),dr(this,"duration",1024),dr(this,"flag",{dependsOn:2,isNonSyncSample:0}),dr(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,this.sampleOffset=i,n&&(this.duration=n)})),Gr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fr(e,t)}(r,e);var t=yr(r);function r(){return lr(this,r),t.apply(this,arguments)}return cr(r)}(cr((function e(t,r){lr(this,e),dr(this,"time",0),this.data=t,this.originPts=this.pts=r}))),Vr=function(){function e(){lr(this,e),dr(this,"id",3),dr(this,"type",Tr),dr(this,"timescale",0),dr(this,"flvScriptSamples",[]),dr(this,"seiSamples",[])}return cr(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),Ur=function(){function e(t){lr(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return cr(e,[{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();dr(Ur,"disabled",!0);var Zr="undefined"!=typeof window,Br=Zr&&navigator.userAgent.toLocaleLowerCase(),Fr=Zr&&/^((?!chrome|android).)*safari/.test(Br),jr=Zr&&Br.includes("firefox"),Wr=Zr&&Br.includes("android"),Xr=function(){function e(){lr(this,e)}return cr(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,l=e.FREQ[s];if(!l)throw new Error("Invalid sampling index: ".concat(s));for(var u,c,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,y=f.codec,m=0,g=e.getFrameDuration(l);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(c=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;u=2*(1&~t[i+1]),o.push({pts:r+m*g,data:t.subarray(i+7+u,i+c)}),m++,i+=c}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:l,objectType:d,channelCount:h,codec:y,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(!a)throw new Error("Invalid sampling index: ".concat(n));var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}},{key:"getFrameDuration",value:function(e){return 1024*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4)/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return jr?e>=6?(n=5,i=e-3):(n=2,i=e):Wr?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();function Hr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}dr(Xr,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var Kr=Math.pow(2,32);function Yr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function Jr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return zr(e,t)*Kr+zr(e,t+4)}function Qr(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}function qr(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))}var en=function(){function e(){lr(this,e)}return cr(e,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!==e[r]&&void 0!==e[r]&&1!==e[r];)r++;if((n=2+ ++r)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseAvcC",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],a=0;a+t<n;)if(r=zr(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseSEI",value:function(e){for(var t=e.length,r=1,n=0,i=0,a="";255===e[r];)n+=255,r++;for(n+=e[r++];255===e[r];)i+=255,r++;if(i+=e[r++],5===n&&t>r+16)for(var o=0;o<16;o++)a+=e[r].toString(16),r++;return{payload:e.subarray(r),type:n,size:i,uuid:a}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),tn=function(){function e(t){if(lr(this,e),dr(this,"_bytesAvailable",void 0),dr(this,"_bitsAvailable",0),dr(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return cr(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}}]),e}(),rn=function(){function e(){lr(this,e)}return cr(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,l=31&t[5],u=0;u<l;u++)if(n=t[s]<<8|t[s+1],s+=2,n){var c=t.subarray(s,s+n);s+=n,a.push(c),r||(r=e.parseSPS(en.removeEPB(c)))}var d,h=t[s];s++;for(var f=0;f<h;f++)d=t[s]<<8|t[s+1],s+=2,d&&(o.push(t.subarray(s,s+d)),s+=d);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new tn(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,l=0;l<s;l++)t.readBool()&&(l<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var u=t.readUEG();if(0===u)t.readUEG();else if(1===u){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var c=t.readUEG(),d=0;d<c;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var y,m,g,v,b,_=0,E=0,T=0,S=0;if(t.readBool()&&(_=t.readUEG(),E=t.readUEG(),T=t.readUEG(),S=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var $=t.readBits(32),A=t.readBits(32);m=t.readBool(),b=(g=A)/(v=2*$)}}return{codec:Qr(e.subarray(1,4)),profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(h+1)-2*(_+E)),height:(2-p)*(f+1)*16-(p?2:4)*(T+S),sarRatio:y,fpsNum:g,fpsDen:v,fps:b,fixedFrame:m}}}]),e}(),nn=function(){function e(){lr(this,e)}return cr(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){r=r||{};for(var n,i,a,o,s,l=1+(3&t[21]),u=[],c=[],d=[],h=23,f=t[22],p=0;p<f;p++){a=63&t[h],o=t[h+1]<<8|t[h+2],h+=3;for(var y=0;y<o;y++)if(s=t[h]<<8|t[h+1],h+=2,s){switch(a){case 32:var m=t.subarray(h,h+s);n||(n=e.parseVPS(en.removeEPB(m),r)),d.push(m);break;case 33:var g=t.subarray(h,h+s);i||(i=e.parseSPS(en.removeEPB(g),r)),u.push(g);break;case 34:c.push(t.subarray(h,h+s))}h+=s}}return{hvcC:r,sps:i,spsArr:u,ppsArr:c,vpsArr:d,nalUnitSize:l}}}},{key:"parseVPS",value:function(t,r){r=r||{};var n=new tn(t);n.readUByte(),n.readUByte(),n.readBits(12);var i=n.readBits(3);return r.numTemporalLayers=Math.max(r.numTemporalLayers||0,i+1),n.readBits(17),e._parseProfileTierLevel(n,i,r),r}},{key:"parseSPS",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r=r||{};var n=new tn(t);n.readUByte(),n.readUByte(),n.readBits(4);var i=n.readBits(3);r.numTemporalLayers=Math.max(i+1,r.numTemporalLayers||0),r.temporalIdNested=n.readBits(1),e._parseProfileTierLevel(n,i,r),n.readUEG();var a=r.chromaFormatIdc=n.readUEG(),o=420;a<=3&&(o=[0,420,422,444][a]);var s=0;3===a&&(s=n.readBits(1));var l,u,c,d,h=n.readUEG(),f=n.readUEG(),p=n.readBits(1);return 1===p&&(l=n.readUEG(),u=n.readUEG(),c=n.readUEG(),d=n.readUEG()),r.bitDepthLumaMinus8=n.readUEG(),r.bitDepthChromaMinus8=n.readUEG(),1===p&&(h-=(1!==a&&2!==a||0!==s?1:2)*(u+l),f-=(1===a&&0===s?2:1)*(d+c)),{codec:"hev1.1.6.L93.B0",width:h,height:f,chromaFormat:o,hvcC:r}}},{key:"_parseProfileTierLevel",value:function(e,t,r){var n=r.generalTierFlag||0;r.generalProfileSpace=e.readBits(2),r.generalTierFlag=Math.max(e.readBits(1),n),r.generalProfileIdc=Math.max(e.readBits(5),r.generalProfileIdc||0),r.generalProfileCompatibilityFlags=e.readBits(32),r.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var i=e.readBits(8);n<r.generalTierFlag?r.generalLevelIdc=i:r.generalLevelIdc=Math.max(i,r.generalLevelIdc||0);for(var a=[],o=[],s=0;s<t;s++)a[s]=e.readBits(1),o[s]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var l=0;l<t;l++)0!==a[l]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==o[l]&&e.readBits(8)}}]),e}(),an=9e4,on=45e4,sn=9e4,ln=function(){function e(t,r,n){lr(this,e),this.videoTrack=t,this.audioTrack=r,this.metadataTrack=n,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0}return cr(e,[{key:"fix",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=Math.round(9e4*t);var i=this.videoTrack,a=this.audioTrack,o=i.samples,s=a.samples;if(o.length||s.length){var l=o[0],u=s[0],c=0;if(o.length&&s.length&&(c=l.dts-u.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),r&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t),!n){this._videoNextDts=c>0?t+c:t,this._audioNextPts=c>0?t:t-c;var d=l?l.dts-this._baseDts-this._videoNextDts:0,h=u?u.pts-this._baseDts-this._audioNextPts:0;Math.abs(d||h)>sn&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._fixVideo(i),this.metadataTrack.exist()){var f=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach((function(t){t.pts=t.originPts-e._baseDts,t.time=Math.max(0,t.pts)/f}))}i.samples.length&&(i.baseMediaDecodeTime=i.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/9e4)}}},{key:"_fixVideo",value:function(e){var t=this,r=e.samples;if(r.length){if(r.forEach((function(e){e.dts-=t._baseDts,e.pts-=t._baseDts})),void 0===this._videoNextDts){var n=r[0];this._videoNextDts=n.dts}var i,a,o=r.length,s=0,l=r[0],u=r[1],c=this._videoNextDts-l.dts;if(Math.abs(c)>45e3&&(l.dts+=c,l.pts+=c,e.warnings.push({type:Pr,nextDts:this._videoNextDts,firstSampleDts:l.dts,nextSampleDts:null===(i=r[1])||void 0===i?void 0:i.dts,sampleDuration:c}),u&&Math.abs(u.dts-l.dts)>sn&&(this._videoTimestampBreak=!0,r.forEach((function(e,t){0!==t&&(e.dts+=c,e.pts+=c)})))),e.fpsNum&&e.fpsDen)a=e.timescale*(e.fpsDen/e.fpsNum);else{var d=e.samples[0],h=e.samples[o-1];a=1===o?9e3:Math.floor((h.dts-d.dts)/(o-1))}for(var f=0;f<o;f++){var p=r[f].dts,y=r[f+1];if((s=f<o-1?y.dts-p:r[f-1]?Math.min(p-r[f-1].dts,a):a)>sn||s<0){this._videoTimestampBreak=!0,s=this._audioTimestampBreak?a:Math.max(s,2700);var m=this._audioNextPts||0;y&&y.dts>m&&(s=a),e.warnings.push({type:Cr,time:p/e.timescale,dts:p,originDts:r[f].originDts,nextDts:this._videoNextDts,sampleDuration:s,refSampleDuration:a})}r[f].duration=s,this._videoNextDts+=s}}}},{key:"_fixAudio",value:function(e){var t=this,r=e.samples;r.length&&(r.forEach((function(e){e.pts-=t._baseDts,e.dts=e.pts})),this._doFixAudioInternal(e,r,9e4))}},{key:"_calculateBaseDts",value:function(e,t){var r=e.samples,n=t.samples;if(!r.length&&!n.length)return!1;var i=1/0,a=1/0;r.length&&(e.baseDts=i=r[0].pts),n.length&&(t.baseDts=a=n[0].dts),this._baseDts=Math.min(i,a);var o=a-i;return Number.isFinite(o)&&Math.abs(o)>45e3&&t.warnings.push({type:Ir,videoBaseDts:a,audioBasePts:i,baseDts:this._baseDts,delta:o}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){if(!this._calculateBaseDts(this.audioTrack,this.videoTrack))return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(e,t,r){e.sampleDuration||(e.sampleDuration=Xr.getFrameDuration(e.timescale,r));var n=e.sampleDuration;if(void 0===this._audioNextPts){var i=t[0];this._audioNextPts=i.pts}for(var a=0;a<t.length;a++){var o=this._audioNextPts,s=t[a],l=s.pts-o;if(!this._audioTimestampBreak&&l>=3*n&&l<=an&&!Fr){var u=Xr.getSilentFrame(e.codec,e.channelCount)||t[0].data.subarray(),c=Math.floor(l/n);Math.abs(s.pts-this._lastAudioExceptionGapDot)>on&&(this._lastAudioExceptionGapDot=s.pts),e.warnings.push({type:Rr,pts:s.pts,originPts:s.originPts,count:c,nextPts:o,refSampleDuration:n});for(var d=0;d<c;d++){var h=new Nr(Math.floor(o),u);h.originPts=Math.floor(this._baseDts+o),t.splice(a,0,h),this._audioNextPts+=n,a++}a--}else l<=-3*n&&l>=-9e4?(Math.abs(s.pts-this._lastAudioExceptionOverlapDot)>on&&(this._lastAudioExceptionOverlapDot=s.pts,e.warnings.push({type:Or,pts:s.pts,originPts:s.originPts,nextPts:o,refSampleDuration:n})),t.splice(a,1),a--):(Math.abs(l)>=an&&(this._audioTimestampBreak=!0,Math.abs(s.pts-this._lastAudioExceptionLargeGapDot)>on&&(this._lastAudioExceptionLargeGapDot=s.pts,e.warnings.push({type:xr,time:s.pts/1e3,pts:s.pts,originPts:s.originPts,nextPts:o,sampleDuration:l,refSampleDuration:n}))),s.dts=s.pts=o,this._audioNextPts+=n)}}}]),e}(),un=new Ur("TsDemuxer"),cn=function(){function e(t,r,n){lr(this,e),dr(this,"_pmtId",-1),dr(this,"_remainingPacketData",null),dr(this,"_videoPesData",[]),dr(this,"_audioPesData",[]),dr(this,"_gopId",0),this.videoTrack=t||new Lr,this.audioTrack=r||new Dr,this.metadataTrack=n||new Vr,this._fixer=new ln(this.videoTrack,this.audioTrack,this.metadataTrack)}return cr(e,[{key:"demux",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.audioTrack,i=this.videoTrack,a=this.metadataTrack;t&&(this._pmtId=-1,i.reset(),n.reset(),a.reset()),!r||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(i.samples=[],n.samples=[],a.seiSamples=[],i.warnings=[],n.warnings=[],this._remainingPacketData&&(e=Hr(this._remainingPacketData,e),this._remainingPacketData=null));var o=e.length,s=o%188;s&&(this._remainingPacketData=e.subarray(o-s),o-=s);for(var l=i.pid,u=n.pid,c=0;c<o;c+=188){if(71!==e[c])throw new Error("TS packet did not start with 0x47");var d=!!(64&e[c+1]),h=((31&e[c+1])<<8)+e[c+2],f=void 0;if((48&e[c+3])>>4>1){if((f=c+5+e[c+4])===c+188)continue}else f=c+4;switch(h){case 0:d&&(f+=e[f]+1),this._pmtId=(31&e[f+10])<<8|e[f+11];break;case this._pmtId:d&&(f+=e[f]+1);var p=f+3+((15&e[f+1])<<8|e[f+2])-4;for(f+=12+((15&e[f+10])<<8|e[f+11]);f<p;){var y=(31&e[f+1])<<8|e[f+2];switch(e[f]){case 15:n.pid=u=y;break;case 27:if(-1!==l)break;i.codecType=Sr,i.pid=l=y;break;case 36:if(-1!==l)break;i.codecType=$r,i.pid=l=y;break;default:un.warn("Unsupported stream. type: ".concat(e[f],", pid: ").concat(y))}f+=5+((15&e[f+3])<<8|e[f+4])}break;case l:d&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(e.subarray(f,c+188));break;case u:d&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(e.subarray(f,c+188));break;case 17:case 8191:break;default:un.warn("Unknown pid: ".concat(h))}}return this._parseVideoData(),this._parseAudioData(),n.formatTimescale=i.formatTimescale=i.timescale=a.timescale=9e4,n.timescale=n.sampleRate||0,{videoTrack:i,audioTrack:n,metadataTrack:a}}},{key:"fix",value:function(e,t,r){return this._fixer.fix(e,t,r),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(e,t,r,n){return this.demux(e,t,r),this.fix(n,t,r)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var t=e._parsePES(Hr.apply(void 0,gr(this._videoPesData)));if(t){var r=en.parseAnnexB(t.data);r?this._createVideoSample(r,t.pts,t.dts):un.warn("Cannot parse avc units",t),this._videoPesData=[]}else un.warn("Cannot parse video pes",this._videoPesData)}}},{key:"_createVideoSample",value:function(e,t,r){var n=this;if(e.length){var i=this.videoTrack,a=i.codecType===$r,o=new Mr(t,r);e.forEach((function(e){var s=a?e[0]>>>1&63:31&e[0];switch(s){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!a&&5!==s||a&&5===s)break;o.setToKeyframe(),n._gopId++;break;case 6:case 39:case 40:if(!a&&6!==s||a&&6===s)break;return void n.metadataTrack.seiSamples.push(new Gr(en.parseSEI(en.removeEPB(e)),t));case 32:if(!a)break;if(!i.vps.length){var l=nn.parseVPS(en.removeEPB(e),i.hvcC);i.hvcC=i.hvcC||l,i.vps=[e]}break;case 7:case 33:if(!a&&7!==s||a&&7===s)break;if(!i.sps.length){var u=en.removeEPB(e),c=a?nn.parseSPS(u,i.hvcC):rn.parseSPS(u);i.sps=[e],i.hvcC=i.hvcC||c.hvcC,i.codec=c.codec,i.width=c.width,i.height=c.height,i.sarRatio=c.sarRatio,i.fpsNum=c.fpsNum,i.fpsDen=c.fpsDen}break;case 8:case 34:if(!a&&8!==s||a&&8===s)break;i.pps.length||(i.pps=[e]);break;case 9:case 35:if(!a&&9!==s||a&&9===s)break;o.gopId=n._gopId,o.units.length&&(n._pushVideoSample(i,o),o=n.prevAvcSample=new Mr(t,r))}o.units.push(e)})),o.gopId=this._gopId,this._pushVideoSample(i,o)}}},{key:"_pushVideoSample",value:function(e,t){if(t.units.length)if(null===t.pts||void 0===t.pts){un.warn("Video sample no pts",t);var r=e.samples[e.samples.length-1];r?(t.pts=r.pts,t.dts=r.dts):un.warn("Drop video sample",t)}else e.samples.push(t)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var t=e._parsePES(Hr.apply(void 0,gr(this._audioPesData)));t?(this._parseAacData(t),this._audioPesData=[]):un.warn("Cannot parse audio pes",this._audioPesData)}}},{key:"_parseAacData",value:function(e){var t=this.audioTrack,r=e.pts;if(null==r){if(un.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;r=t.samples[t.samples.length-1].pts+Xr.getFrameDuration(t.sampleRate)}var n,i=Xr.parseADTS(e.data,r);i?(t.codec=i.codec,t.channelCount=i.channelCount,t.sampleRate=i.sampleRate,t.objectType=i.objectType,t.sampleRateIndex=i.samplingFrequencyIndex,t.config=i.config,(n=t.samples).push.apply(n,gr(i.frames.map((function(e){return new Nr(e.pts,e.data)})))),i.skip&&un.warn("Skip aac adts ".concat(i.skip," bits")),i.remaining&&un.warn("Remaining aac adts ".concat(i.remaining," bits"))):un.warn("Cannot parse aac adts",e)}}],[{key:"probe",value:function(e){return!!e.length&&71===e[0]&&71===e[188]&&71===e[376]}},{key:"_parsePES",value:function(e){var t=e[8];if(!(null==t||e.length<t+9)&&1==(e[0]<<16|e[1]<<8|e[2])){var r=(e[4]<<8)+e[5];if(!(r&&r>e.length-6)){var n,i,a=e[7];return 192&a&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&a?n-(i=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(n=i):i=n),{data:e.subarray(9+t),pts:n,dts:i}}}}}]),e}(),dn=function(){function e(){lr(this,e)}return cr(e,null,[{key:"findBox",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(!t)return i;for(var a=0,o="",s=0;t.length>7;){if(a=zr(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),s=8,1===a?(a=Jr(t,8),s+=8):a||(a=t.length),!r[0]||o===r[0]){var l=t.subarray(0,a);if(!(r.length<2))return e.findBox(l.subarray(s),r.slice(1),n+s);i.push({start:n,size:a,headerSize:s,type:o,data:l})}n+=a,t=t.subarray(a)}return i}},{key:"tfhd",value:function(e){return yn(e,!0,(function(e,t){e.trackId=zr(t);var r=4,n=1&e.flags,i=2&e.flags,a=8&e.flags,o=16&e.flags,s=32&e.flags;n&&(r+=4,e.baseDataOffset=zr(t,r),r+=4),i&&(e.sampleDescriptionIndex=zr(t,r),r+=4),a&&(e.defaultSampleDuration=zr(t,r),r+=4),o&&(e.defaultSampleSize=zr(t,r),r+=4),s&&(e.defaultSampleFlags=zr(t,r))}))}},{key:"sidx",value:function(e){return yn(e,!0,(function(e,t){var r=0;e.reference_ID=zr(t,r),r+=4,e.timescale=zr(t,r),r+=4,0===e.version?(e.earliest_presentation_time=zr(t,r),r+=4,e.first_offset=zr(t,r),r+=4):(e.earliest_presentation_time=Jr(t,r),r+=8,e.first_offset=Jr(t,r),r+=8),r+=2,e.references=[];var n=Yr(t,r);r+=2;for(var i=0;i<n;i++){var a={};e.references.push(a);var o=zr(t,r);r+=4,a.reference_type=o>>31&1,a.referenced_size=2147483647&o,a.subsegment_duration=zr(t,r),o=zr(t,r+=4),r+=4,a.starts_with_SAP=o>>31&1,a.SAP_type=o>>28&7,a.SAP_delta_time=268435455&o}}))}},{key:"moov",value:function(t){return yn(t,!1,(function(t,r,n){t.mvhd=e.mvhd(e.findBox(r,["mvhd"],n)[0]),t.trak=e.findBox(r,["trak"],n).map((function(t){return e.trak(t)})),t.pssh=e.pssh(e.findBox(r,["pssh"],n)[0])}))}},{key:"mvhd",value:function(e){return yn(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=zr(t,16),e.duration=Jr(t,20),r+=28):(e.timescale=zr(t,8),e.duration=zr(t,12),r+=16),e.nextTrackId=zr(t,r+76)}))}},{key:"trak",value:function(t){return yn(t,!1,(function(t,r,n){t.tkhd=e.tkhd(e.findBox(r,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(r,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return yn(e,!0,(function(e,t){var r=0;1===e.version?(e.trackId=zr(t,16),e.duration=Jr(t,24),r+=32):(e.trackId=zr(t,8),e.duration=zr(t,16),r+=20),e.width=zr(t,r+52),e.height=zr(t,r+56)}))}},{key:"mdia",value:function(t){return yn(t,!1,(function(t,r,n){t.mdhd=e.mdhd(e.findBox(r,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(r,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(r,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return yn(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=zr(t,16),e.duration=Jr(t,20),r+=28):(e.timescale=zr(t,8),e.duration=zr(t,12),r+=16);var n=Yr(t,r);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return yn(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return yn(t,!1,(function(t,r,n){t.vmhd=e.vmhd(e.findBox(r,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(r,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(r,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return yn(e,!0,(function(e,t){e.graphicsmode=Yr(t),e.opcolor=[Yr(t,2),Yr(t,4),Yr(t,6)]}))}},{key:"smhd",value:function(e){return yn(e,!0,(function(e,t){e.balance=Yr(t)}))}},{key:"stbl",value:function(t){return yn(t,!1,(function(t,r,n){t.stsd=e.stsd(e.findBox(r,["stsd"],n)[0]),t.stts=e.stts(e.findBox(r,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(r,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(r,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(r,["stsz"],n)[0]),t.stco=e.stco(e.findBox(r,["stco"],n)[0]),t.stco||(t.co64=e.co64(e.findBox(r,["co64"],n)[0]),t.stco=t.co64),t.stss=e.stss(e.findBox(r,["stss"],n)[0]),t.senc=e.senc(e.findBox(r,["senc"],n)[0])}))}},{key:"senc",value:function(e){return yn(e,!0,(function(e,t){var r=0,n=zr(t,r);r+=4,e.samples=[];for(var i=0;i<n;i++){var a={};if(a.InitializationVector=[t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5],t[r+6],t[r+7]],r+=8,2&e.flags){a.subsamples=[];var o=Yr(t,r);r+=2;for(var s=0;s<o;s++){var l={};l.BytesOfClearData=Yr(t,r),r+=2,l.BytesOfProtectedData=zr(t,r),r+=4,a.subsamples.push(l)}}e.samples.push(a)}}))}},{key:"pssh",value:function(e){return yn(e,!0,(function(e,t){for(var r=[],n=[],i=0,a=0;a<16;a++)n.push(vn(t[i+a]));if(i+=16,e.version>0){var o=zr(t,i);i+=4;for(var s=0;s<(""+o).length;s++)for(var l=0;l<16;l++){var u=t[i];i+=1,r.push(vn(u))}}var c=zr(t,i);e.data_size=c,i+=4,e.kid=r,e.system_id=n,e.buffer=t}))}},{key:"stsd",value:function(t){return yn(t,!0,(function(t,r,n){t.entryCount=zr(r),t.entries=e.findBox(r.subarray(4),[],n+4).map((function(t){switch(t.type){case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t);case"enca":return yn(t,!1,(function(t,r,n){t.channelCount=Yr(r,16),t.samplesize=Yr(r,18),t.sampleRate=zr(r,24)/65536,r=r.subarray(28),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.esds=e.esds(e.findBox(r,["esds"],n)[0])}));case"encv":return yn(t,!1,(function(t,r,n){t.width=Yr(r,24),t.height=Yr(r,26),t.horizresolution=zr(r,28),t.vertresolution=zr(r,32),r=r.subarray(78),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.avcC=e.avcC(e.findBox(r,["avcC"],n)[0]),t.hvcC=e.hvcC(e.findBox(r,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(r,["pasp"],n)[0])}))}})).filter(Boolean)}))}},{key:"tenc",value:function(e){return yn(e,!1,(function(e,t){var r=6;e.default_IsEncrypted=t[r],r+=1,e.default_IV_size=t[r],r+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(vn(t[r])),r+=1}))}},{key:"schi",value:function(t){return yn(t,!1,(function(t,r,n){t.tenc=e.tenc(e.findBox(r,["tenc"],n)[0])}))}},{key:"sinf",value:function(t){return yn(t,!1,(function(t,r,n){t.schi=e.schi(e.findBox(r,["schi"],n)[0]),t.frma=e.frma(e.findBox(r,["frma"],n)[0])}))}},{key:"frma",value:function(e){return yn(e,!1,(function(e,t){e.data_format="";for(var r=0;r<4;r++)e.data_format+=String.fromCharCode(t[r])}))}},{key:"avc1",value:function(t){return yn(t,!1,(function(t,r,n){var i=fn(t,r),a=r.subarray(i);n+=i,t.avcC=e.avcC(e.findBox(a,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return yn(e,!1,(function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=Qr([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var r=6,n=0;n<e.spsLength;n++){var i=Yr(t,r);r+=2,e.sps.push(t.subarray(r,r+i)),r+=i}e.ppsLength=t[r],r+=1,e.pps=[];for(var a=0;a<e.ppsLength;a++){var o=Yr(t,r);r+=2,e.pps.push(t.subarray(r,r+=o)),r+=o}}))}},{key:"hvc1",value:function(t){return yn(t,!1,(function(t,r,n){var i=fn(t,r),a=r.subarray(i);n+=i,t.hvcC=e.hvcC(e.findBox(a,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return yn(e,!1,(function(t,r){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=r[0];var n=r[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=zr(r,2),t.generalConstraintIndicatorFlags=r.subarray(6,12),t.generalLevelIdc=r[12],t.avgFrameRate=Yr(r,19),t.numOfArrays=r[22],t.vps=[],t.sps=[],t.pps=[];for(var i=23,a=0,o=0,s=0,l=0;l<t.numOfArrays;l++){a=63&r[i],o=Yr(r,i+1),i+=3;for(var u,c=[],d=0;d<o;d++)s=Yr(r,i),i+=2,c.push(r.subarray(i,i+s)),i+=s;if(32===a)(u=t.vps).push.apply(u,c);else if(33===a){var h;(h=t.sps).push.apply(h,c)}else if(34===a){var f;(f=t.pps).push.apply(f,c)}}}))}},{key:"pasp",value:function(e){return yn(e,!1,(function(e,t){e.hSpacing=zr(t),e.vSpacing=zr(t,4)}))}},{key:"mp4a",value:function(t){return yn(t,!1,(function(t,r,n){var i=pn(t,r);t.esds=e.esds(e.findBox(r.subarray(i),["esds"],n+i)[0])}))}},{key:"esds",value:function(e){return yn(e,!0,(function(e,t){e.codec="mp4a.";for(var r=0,n=0,i=0,a=0;t.length;){for(a=t[r=0],n=t[r+1],r+=2;128&n;)i=(127&n)<<7,n=t[r],r+=1;if(i+=127&n,3===a)t=t.subarray(r+3);else{if(4!==a){if(5===a){var o=e.config=t.subarray(r,r+i),s=(248&o[0])>>3;return 31===s&&o.length>=2&&(s=32+((7&o[0])<<3)+((224&o[1])>>5)),e.objectType=s,e.codec+=s.toString(16),void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}return void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}e.codec+=(t[r].toString(16)+".").padStart(3,"0"),t=t.subarray(r+13)}}}))}},{key:"alaw",value:function(e){return yn(e,!1,(function(e,t){pn(e,t)}))}},{key:"stts",value:function(e){return yn(e,!0,(function(e,t){for(var r=zr(t),n=[],i=4,a=0;a<r;a++)n.push({count:zr(t,i),delta:zr(t,i+4)}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"ctts",value:function(e){return yn(e,!0,(function(e,t){var r=zr(t),n=[],i=4;if(1===e.version)for(var a=0;a<r;a++)n.push({count:zr(t,i),offset:zr(t,i+4)}),i+=8;else for(var o=0;o<r;o++)n.push({count:zr(t,i),offset:-(1+~zr(t,i+4))}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stsc",value:function(e){return yn(e,!0,(function(e,t){for(var r=zr(t),n=[],i=4,a=0;a<r;a++)n.push({firstChunk:zr(t,i),samplesPerChunk:zr(t,i+4),sampleDescriptionIndex:zr(t,i+8)}),i+=12;e.entryCount=r,e.entries=n}))}},{key:"stsz",value:function(e){return yn(e,!0,(function(e,t){var r=zr(t),n=zr(t,4),i=[];if(!r)for(var a=8,o=0;o<n;o++)i.push(zr(t,a)),a+=4;e.sampleSize=r,e.sampleCount=n,e.entrySizes=i}))}},{key:"stco",value:function(e){return yn(e,!0,(function(e,t){for(var r=zr(t),n=[],i=4,a=0;a<r;a++)n.push(zr(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"co64",value:function(e){return yn(e,!0,(function(e,t){for(var r=zr(t),n=[],i=4,a=0;a<r;a++)n.push(Jr(t,i)),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stss",value:function(e){return yn(e,!0,(function(e,t){for(var r=zr(t),n=[],i=4,a=0;a<r;a++)n.push(zr(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"moof",value:function(t){return yn(t,!1,(function(t,r,n){t.mfhd=e.mfhd(e.findBox(r,["mfhd"],n)[0]),t.traf=e.findBox(r,["traf"],n).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return yn(e,!0,(function(e,t){e.sequenceNumber=zr(t)}))}},{key:"traf",value:function(t){return yn(t,!1,(function(t,r,n){t.tfhd=e.tfhd(e.findBox(r,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(r,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(r,["trun"],n)[0])}))}},{key:"trun",value:function(e){return yn(e,!0,(function(e,t){var r=e.version,n=e.flags,i=t.length,a=e.sampleCount=zr(t),o=4;if(i>o&&1&n&&(e.dataOffset=-(1+~zr(t,o)),o+=4),i>o&&4&n&&(e.firstSampleFlags=zr(t,o),o+=4),e.samples=[],i>o)for(var s,l=0;l<a;l++)s={},256&n&&(s.duration=zr(t,o),o+=4),512&n&&(s.size=zr(t,o),o+=4),1024&n&&(s.flags=zr(t,o),o+=4),2048&n&&(s.cts=r?-(1+~zr(t,o+4)):zr(t,o),o+=4),e.samples.push(s)}))}},{key:"tfdt",value:function(e){return yn(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=Jr(t):e.baseMediaDecodeTime=zr(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,r){var n,i,a=e.trak;if(a&&a.length){var o=a.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),s=a.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(o&&t){var l,u,c,d,h,f,p,y=t;null!=(null===(l=o.tkhd)||void 0===l?void 0:l.trackId)&&(y.id=o.tkhd.trackId),y.tkhdDuration=o.tkhd.duration,y.mvhdDurtion=e.mvhd.duration,y.mvhdTimecale=e.mvhd.timescale,y.timescale=y.formatTimescale=o.mdia.mdhd.timescale,y.duration=o.mdia.mdhd.duration||y.mvhdDurtion/y.mvhdTimecale*y.timescale;var m,g,v,b,_,E,T,S,$=o.mdia.minf.stbl.stsd.entries[0];if(y.width=$.width,y.height=$.height,$.pasp&&(y.sarRatio=[$.pasp.hSpacing,$.pasp.vSpacing]),$.hvcC)y.codecType=$r,y.codec=$.hvcC.codec,y.vps=$.hvcC.vps,y.sps=$.hvcC.sps,y.pps=$.hvcC.pps,y.hvcC=$.hvcC.data;else{if(!$.avcC)throw new Error("unknown video stsd entry");y.codec=$.avcC.codec,y.sps=$.avcC.sps,y.pps=$.avcC.pps}y.present=!0,y.ext={},y.ext.stss=null===(u=o.mdia)||void 0===u||null===(c=u.minf)||void 0===c||null===(d=c.stbl)||void 0===d?void 0:d.stss,y.ext.ctts=null===(h=o.mdia)||void 0===h||null===(f=h.minf)||void 0===f||null===(p=f.stbl)||void 0===p?void 0:p.ctts,$&&"encv"===$.type&&(y.isVideoEncryption=!0,$.default_KID=null===(m=$.sinf)||void 0===m||null===(g=m.schi)||void 0===g?void 0:g.tenc.default_KID,$.default_IsEncrypted=null===(v=$.sinf)||void 0===v||null===(b=v.schi)||void 0===b?void 0:b.tenc.default_IsEncrypted,$.default_IV_size=null===(_=$.sinf)||void 0===_||null===(E=_.schi)||void 0===E?void 0:E.tenc.default_IV_size,y.videoSenc=o.mdia.minf.stbl.senc&&o.mdia.minf.stbl.senc.samples,$.data_format=null===(T=$.sinf)||void 0===T||null===(S=T.frma)||void 0===S?void 0:S.data_format,y.useEME=e.useEME,y.kidValue=e.kidValue,y.pssh=e.pssh,y.encv=$)}if(s&&r){var A,w,k,I,C,P,x,R,O,L=r;null!=(null===(A=s.tkhd)||void 0===A?void 0:A.trackId)&&(L.id=s.tkhd.trackId),L.tkhdDuration=s.tkhd.duration,L.mvhdDurtion=e.mvhd.duration,L.mvhdTimecale=e.mvhd.timescale,L.timescale=L.formatTimescale=s.mdia.mdhd.timescale,L.duration=s.mdia.mdhd.duration||L.mvhdDurtion/L.mvhdTimecale*L.timescale;var D,M,N,G,V,U,Z,B,F=s.mdia.minf.stbl.stsd.entries[0];switch(L.sampleSize=F.sampleSize,L.sampleRate=F.sampleRate,L.channelCount=F.channelCount,L.present=!0,F.type){case"alaw":L.codecType=L.codec=wr,L.sampleRate=8e3;break;case"ulaw":L.codecType=L.codec=kr,L.sampleRate=8e3;break;default:L.sampleDuration=Xr.getFrameDuration(L.sampleRate,L.timescale),L.sampleRateIndex=Xr.getRateIndexByRate(L.sampleRate),L.objectType=(null===(n=F.esds)||void 0===n?void 0:n.objectType)||2,F.esds&&(L.config=Array.from(F.esds.config)),L.codec=(null===(i=F.esds)||void 0===i?void 0:i.codec)||"mp4a.40.2"}L.sampleDuration=Xr.getFrameDuration(L.sampleRate,L.timescale),L.objectType=(null===(w=F.esds)||void 0===w?void 0:w.objectType)||2,F.esds&&(F.esds.config?L.config=Array.from(F.esds.config):console.warn("esds config is null")),L.codec=(null===(k=F.esds)||void 0===k?void 0:k.codec)||"mp4a.40.2",L.sampleRateIndex=Xr.getRateIndexByRate(L.sampleRate),L.ext={},L.ext.stss=null===(I=s.mdia)||void 0===I||null===(C=I.minf)||void 0===C||null===(P=C.stbl)||void 0===P?void 0:P.stss,L.ext.ctts=null===(x=s.mdia)||void 0===x||null===(R=x.minf)||void 0===R||null===(O=R.stbl)||void 0===O?void 0:O.ctts,L.present=!0,F&&"enca"===F.type&&(L.isAudioEncryption=!0,F.data_format=null===(D=F.sinf)||void 0===D||null===(M=D.frma)||void 0===M?void 0:M.data_format,F.default_KID=null===(N=F.sinf)||void 0===N||null===(G=N.schi)||void 0===G?void 0:G.tenc.default_KID,F.default_IsEncrypted=null===(V=F.sinf)||void 0===V||null===(U=V.schi)||void 0===U?void 0:U.tenc.default_IsEncrypted,F.default_IV_size=null===(Z=F.sinf)||void 0===Z||null===(B=Z.schi)||void 0===B?void 0:B.tenc.default_IV_size,L.audioSenc=s.mdia.minf.stbl.senc&&s.mdia.minf.stbl.senc.samples,L.useEME=e.useEME,L.kidValue=e.kidValue,L.enca=F)}if(r&&(r.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!r&&r.isAudioEncryption),null!=t&&t.encv||null!=r&&r.enca){var j,W,X=null==t||null===(j=t.encv)||void 0===j?void 0:j.default_KID,H=null==r||null===(W=r.enca)||void 0===W?void 0:W.default_KID,K=X||H?(X||H).join(""):null;t&&(t.kid=K),r&&(r.kid=K)}return t&&(t.flags=3841),r&&(r.flags=1793),{videoTrack:t,audioTrack:r}}}},{key:"evaluateDefaultDuration",value:function(e,t,r){var n,i=null==t||null===(n=t.samples)||void 0===n?void 0:n.length;return i?1024*i/t.timescale*e.timescale/r:1024}},{key:"moofToSamples",value:function(t,r,n){var i={};return t.mfhd&&(r&&(r.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var a=t.tfhd,o=t.tfdt,s=t.trun;if(a&&s){o&&(r&&r.id===a.trackId&&(r.baseMediaDecodeTime=o.baseMediaDecodeTime),n&&n.id===a.trackId&&(n.baseMediaDecodeTime=o.baseMediaDecodeTime));var l=a.defaultSampleSize||0,u=a.defaultSampleDuration||e.evaluateDefaultDuration(r,n,s.samples.length||s.sampleCount),c=s.dataOffset||0,d=0,h=-1;if(!s.samples.length&&s.sampleCount){i[a.trackId]=[];for(var f=0;f<s.sampleCount;f++)i[a.trackId].push({offset:c,dts:d,duration:u,size:l}),d+=u,c+=l}else i[a.trackId]=s.samples.map((function(e,t){return(e={offset:c,dts:d,pts:d+(e.cts||0),duration:e.duration||u,size:e.size||l,gopId:h,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(h++,e.gopId=h),d+=e.duration,c+=e.size,e}))}})),i}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var r=t.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),n=t.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(r||n){var i,a;if(r){var o,s,l=null===(o=r.mdia)||void 0===o||null===(s=o.minf)||void 0===s?void 0:s.stbl;if(!l)return;var u=l.stts,c=l.stsc,d=l.stsz,h=l.stco,f=l.stss,p=l.ctts;if(!(u&&c&&d&&h&&f))return;i=hn(u,c,d,h,p,f)}if(n){var y,m,g,v=null===(y=n.mdia)||void 0===y||null===(m=y.minf)||void 0===m?void 0:m.stbl;if(!v)return;var b=null===(g=n.mdia.mdhd)||void 0===g?void 0:g.timescale,_=v.stts,E=v.stsc,T=v.stsz,S=v.stco;if(!(b&&_&&E&&T&&S))return;a=hn(_,E,T,S)}return{videoSamples:i,audioSamples:a}}}}}]),e}();function hn(e,t,r,n,i,a){var o,s,l,u=[],c=null==i?void 0:i.entries,d=t.entries,h=n.entries,f=r.entrySizes,p=null==a?void 0:a.entries;p&&(o={},p.forEach((function(e){o[e-1]=!0}))),c&&(s=[],c.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)s.push(r)})));var y=-1,m=0,g=0,v=0,b=0,_=0,E=d[0].samplesPerChunk,T=d[1]?d[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,i=0;i<t;i++)l={dts:m,duration:n,size:f[g]||r.sampleSize,offset:h[v]+_,index:g},p&&(l.keyframe=o[g],l.keyframe&&y++,l.gopId=y),s&&g<s.length&&(l.pts=l.dts+s[g]),u.push(l),m+=n,++g<E?_+=l.size:(v++,_=0,v>=T&&(b++,T=d[b+1]?d[b+1].firstChunk-1:1/0),E+=d[b].samplesPerChunk)})),u}function fn(e,t){return e.dataReferenceIndex=Yr(t,6),e.width=Yr(t,24),e.height=Yr(t,26),e.horizresolution=zr(t,28),e.vertresolution=zr(t,32),e.frameCount=Yr(t,40),e.depth=Yr(t,74),78}function pn(e,t){return e.dataReferenceIndex=Yr(t,6),e.channelCount=Yr(t,16),e.sampleSize=Yr(t,18),e.sampleRate=zr(t,24)/65536,28}function yn(e,t,r){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}(e.data,e.headerSize+1),n.headerSize+=4),r(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var mn,gn=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},vn=function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(gn(Number(t).toString(16),2,0))})),e[0]},bn=function(){function e(t,r,n){lr(this,e),this.videoTrack=t||new Lr,this.audioTrack=r||new Dr,this.metadataTrack=n||new Vr}return cr(e,[{key:"demux",value:function(e,t){var r=this.videoTrack,n=this.audioTrack,i=r.exist(),a=n.exist();if(r.samples=[],n.samples=[],t){if(!a){var o=dn.findBox(t,["moov"])[0];if(!o)throw new Error("cannot found moov box");dn.moovToTrack(dn.moov(o),null,n)}var s=dn.findBox(t,["moof"])[0];if(s){var l=dn.moofToSamples(dn.moof(s),null,n)[n.id],u=n.baseMediaDecodeTime;if(l){var c=s.start;l.map((function(e){e.offset+=c;var r=t.subarray(e.offset,e.offset+e.size);n.samples.push(new Nr(e.dts+u,r,e.duration))}))}}}if(e){if(!i&&!a){var d=dn.findBox(e,["moov"])[0];if(!d)throw new Error("cannot found moov box");dn.moovToTrack(dn.moov(d),r,n)}var h=dn.findBox(e,["moof"])[0];if(h){var f,p=dn.moofToSamples(dn.moof(h),r,n),y=r.baseMediaDecodeTime,m=n.baseMediaDecodeTime,g=h.start;Object.keys(p).forEach((function(t){r.id==t?p[t].map((function(t){t.offset+=g;var n=new Mr((t.pts||t.dts)+y,t.dts+y);n.duration=t.duration,n.gopId=t.gopId,t.keyframe&&n.setToKeyframe();for(var i=e.subarray(t.offset,t.offset+t.size),a=0,o=i.length-1;a<o;)f=zr(i,a),a+=4,n.units.push(i.subarray(a,a+f)),a+=f;r.samples.push(n)})):n.id==t&&p[t].map((function(t){t.offset+=g;var r=e.subarray(t.offset,t.offset+t.size);n.samples.push(new Nr(t.dts+m,r,t.duration))}))}))}}return{videoTrack:r,audioTrack:n,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(e){return dn.probe(e)}}]),e}(),_n={};Object.defineProperty(_n,"__esModule",{value:!0}),_n.default=function(e){for(var t=0,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a=!0,o=!1,s=void 0;try{for(var l,u=n[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)t+=l.value.length}catch(v){o=!0,s=v}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}var c=new e(t),d=0,h=!0,f=!1,p=void 0;try{for(var y,m=n[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var g=y.value;c.set(g,d),d+=g.length}}catch(v){f=!0,p=v}finally{try{!h&&m.return&&m.return()}finally{if(f)throw p}}return c};var En=((mn=_n)&&mn.__esModule?mn:{default:mn}).default,Tn=function(){function e(){lr(this,e),this.buffer=new Uint8Array(0)}return cr(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){t?e.buffer=En(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),Sn=Math.pow(2,32)-1,$n=function(){function e(){lr(this,e)}return cr(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===_r&&e.codecType===$r}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return Hr(e.ftyp(t),e.moov(t))}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],qr(t.kid),[0,0,0,0]));return e.box(e.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(gr(t.map((function(t){return e.trak(t)}))),[r]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(gr(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===_r?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){var r=[];return t&&t.ext&&t.ext.stss&&r.push(e.stss(t.ext.stss.entries)),e.box(e.types.stbl,e.stsd(t),e.STTS,r[0],e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){var r;return r="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):e.avc1hev1(t),e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r)}},{key:"enca",value:function(t){var r=t.enca.channelCount,n=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,i,a,o)}},{key:"encv",value:function(t){var r,n,i=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],o=t.width,s=t.height,l=t.sarRatio[0],u=t.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((r=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(n,gr(i)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(r,gr(a))),h=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u]);return e.box(e.types.encv,c,e.box(e.types.avcC,d),e.box(e.types.btrt,h),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var r=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,r,n)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(qr(t.default_KID)));return e.box(e.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,r,e.box(e.types.frma,n),e.box(e.types.schm,i),a)}},{key:"avc1hev1",value:function(t){var r=t.codecType===$r,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n,i,a=[],o=[];return t.sps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,gr(e))})),t.pps.forEach((function(e){i=e.byteLength,o.push(i>>>8&255),o.push(255&i),o.push.apply(o,gr(e))})),e.box(e.types.avcC,new Uint8Array((r=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(r,o)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,l=r.generalConstraintIndicatorFlags,u=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,l[0],l[1],l[2],l[3],l[4],l[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,u];var c=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,gr(e))};i.length&&(n.push(160,0,i.length),i.forEach(c)),a.length&&(n.push(161,0,a.length),a.forEach(c)),o.length&&(n.push(162,0,o.length),o.forEach(c))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=mr(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(gr(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(t){return e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(gr(t.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){var r=e.tfhd(t.id),n=e.tfdt(t,t.baseMediaDecodeTime);if(t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(1===t.id){var i=e.saiz(t),a=e.saio(t),o=e.trun1(t),s=e.senc(t);return e.box(e.types.traf,r,n,i,a,o,s)}if(t.isAudioEncryption){var l=e.sbgp(),u=e.saiz(t),c=e.saio(t),d=e.senc(t),h=e.trun1(t);return e.box(e.types.traf,r,n,l,u,c,d,h)}var f=e.sbgp(),p=e.trun1(t);return e.box(e.types.traf,r,n,f,p)}if(1===t.id){var y=e.trun1(t);return e.box(e.types.traf,r,n,y)}var m=e.sbgp(),g=e.saiz(t),v=e.saio(t),b=e.senc(t),_=e.trun1(t);return e.box(e.types.traf,r,n,m,g,v,b,_)}var E=e.sdtp(t);return e.box(e.types.traf,r,n,E,e.trun(t.samples,E.byteLength+76))}},{key:"sdtp",value:function(t){var r=new Tn;return t.samples.forEach((function(e){r.write(new Uint8Array(1===t.id?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Tn,n=Tn.writeUint32(t.samples.length),i=null;if(1===t.id){var a=t.videoSencLength;i=Tn.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Tn.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),i=Tn.writeUint32(o)}return t.samples.forEach((function(e){r.write(Tn.writeUint32(e.duration)),r.write(Tn.writeUint32(e.size)),r.write(Tn.writeUint32(e.keyframe?33554432:65536)),1===t.id&&r.write(Tn.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(t){var r=new Tn,n=t.samples.length,i=1===t.id?16:8,a=1===t.id?2:0,o=[],s=0;return 1===t.id?(o=t.videoSenc,s=t.videoSencLength):o=t.audioSenc,s=s||i*n,r.write(Tn.writeUint32(16+s),e.types.senc,this.extension(0,a)),r.write(Tn.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(Tn.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){r.write(Tn.writeUint16(e.BytesOfClearData)),r.write(Tn.writeUint32(e.BytesOfProtectedData))})))})),r.buffer}},{key:"saio",value:function(t){var r=12*t.samples.length+141;2===t.id&&t.isAudioEncryption&&(r=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var r=t.samples.length,n=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,r){var n=Math.floor(r/(Sn+1)),i=Math.floor(r%(Sn+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],l=s.duration,u=s.size,c=s.flag,d=void 0===c?{}:c,h=s.cts,f=void 0===h?0:h;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,d.isLeading<<2|(null===d.dependsOn||void 0===d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null===d.isNonSyncSample||void 0===d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(gr(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===_r?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,Hr(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,Hr(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,Hr(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,Hr(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,Hr(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,Hr(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,n=t.samples[0].duration,i=n*t.samples.length,a=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var s=0;if(1===t.id){var l,u=0;t.videoSenc&&(l=t.videoSenc),1===t.id&&l.forEach((function(e){u+=8,e.subsamples&&e.subsamples.length&&(u+=2,u+=6*e.subsamples.length)})),t.videoSencLength=u,s=o+141+16*t.samples.length+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(s=o+16*t.samples.length+84)}else s=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(s=o+169+12*t.samples.length+8*t.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,255&t.id,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,c)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();dr($n,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),dr($n,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),dr($n,"FTYPAVC1",$n.box($n.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),dr($n,"FTYPHEV1",$n.box($n.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),dr($n,"DINF",$n.box($n.types.dinf,$n.box($n.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),dr($n,"VMHD",$n.box($n.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),dr($n,"SMHD",$n.box($n.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),dr($n,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),dr($n,"STTS",$n.box($n.types.stts,$n.StblTable)),dr($n,"STSC",$n.box($n.types.stsc,$n.StblTable)),dr($n,"STSZ",$n.box($n.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),dr($n,"STCO",$n.box($n.types.stco,$n.StblTable));var An=function(){function e(t,r){lr(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=r}return cr(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();dr(An,"disabled",!0);var wn=function(){function e(t,r,n){lr(this,e),this.videoTrack=t,this.audioTrack=r;var i=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=i&&Number(i[1])<50,this.log=new An("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return cr(e,[{key:"remux",value:function(){var e,t,r,n,i,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.videoTrack,l=this.audioTrack,u=s.exist(),c=l.exist(),d=[];return a&&(o&&o.initMerge?(u&&d.push(this.videoTrack),c&&d.push(this.audioTrack),r=$n.initSegment(d)):(u&&(e=$n.initSegment([this.videoTrack])),c&&(t=$n.initSegment([this.audioTrack])))),u&&s.hasSample()&&(n=this._remuxVideo()),c&&l.hasSample()&&(i=this._remuxAudio()),s.samples=[],l.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var l=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,l+=4+e.byteLength})),s.size=l,u=o,n=s},s=0,l=t.length,u=0;s<l;s++)o(s,0,u,n);var c=$n.mdat(i);return e.isVideoEncryption||e.isAudioEncryption?Hr($n.styp(),$n.sidx(e),$n.moof([e]),c):Hr($n.moof([e]),c)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,r){return t.set(r.data,e),e+r.size}),0);var r=$n.mdat(t);return e.isVideoEncryption||e.isAudioEncryption?Hr($n.styp(),$n.sidx(e),$n.moof([e]),r):Hr($n.moof([e]),r)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),kn=ke(ke({},Kt),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",DEMUXED_TRACK:"demuxedtrack"});function In(e,t,r){return Math.min(Math.max(e,t),r)}var Cn=function(){function e(t,r){xe(this,e),Le(this,"live",void 0),Le(this,"id",0),Le(this,"bitrate",0),Le(this,"width",0),Le(this,"height",0),Le(this,"name",""),Le(this,"url",""),Le(this,"audioCodec",""),Le(this,"videoCodec",""),Le(this,"textCodec",""),Le(this,"startCC",0),Le(this,"endCC",0),Le(this,"startSN",0),Le(this,"endSN",-1),Le(this,"totalDuration",0),Le(this,"targetDuration",0),Le(this,"snDiff",null),Le(this,"segments",[]),Le(this,"audioStreams",[]),Le(this,"currentAudioStream",null),this.update(t,r)}return Oe(e,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var e;return this.targetDuration||(null===(e=this.segments[0])||void 0===e?void 0:e.duration)||0}},{key:"liveEdge",get:function(){return this.endTime}},{key:"endTime",get:function(){var e;return(null===(e=this.lastSegment)||void 0===e?void 0:e.end)||0}},{key:"clearOldSegment",value:function(e,t){return this.currentAudioStream&&this._clearSegments(this.currentAudioStream,e,t),this._clearSegments(this,e,t)}},{key:"getAudioSegment",value:function(e){if(e&&this.currentAudioStream){var t=e.sn-this.snDiff;return this.currentAudioStream.segments.find((function(e){return e.sn===t}))}}},{key:"update",value:function(e,t){this.url=e.url,Array.isArray(e.segments)?(null!==this.live&&void 0!==this.live||(this.live=e.live),this._updateSegments(e,this),this.startCC=e.startCC,this.endCC=e.endCC,this.startSN=e.startSN,this.endSN=e.endSN||-1,this.totalDuration=e.totalDuration,this.targetDuration=e.targetDuration,this.live=e.live,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),(null===this.snDiff||void 0===this.snDiff)&&e.segments.length&&t.segments.length&&(this.snDiff=e.segments[0].sn-t.segments[0].sn))):(this.id=e.id,this.bitrate=e.bitrate,this.width=e.width,this.height=e.height,this.name=e.name,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.textCodec=e.textCodec,this.audioStreams=e.audioStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find((function(e){return e.default}))||this.audioStreams[0]))}},{key:"_clearSegments",value:function(e,t){for(var r=0,n=this.segments,i=0,a=n.length;i<a;i++)if(n[i].end>=e){r=i;break}return r>t&&(r=t),r&&(this.segments=this.segments.slice(r),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(r))),t-r}},{key:"_updateSegments",value:function(e,t){var r=t.segments;if(this.live){var n=r[r.length-1],i=(null==n?void 0:n.sn)||-1;if(i<e.endSN&&e.segments.length){var a=e.segments.findIndex((function(e){return e.sn===i})),o=a<0?e.segments:e.segments.slice(a+1);if(r.length&&o.length){var s=n.end;o.forEach((function(e){e.start=s,s=e.end}));var l=(null==n?void 0:n.cc)||-1;l>o[0].cc&&o.forEach((function(e){return e.cc+=l}))}t.segments=r.concat(o)}}else t.segments=e.segments}}]),e}(),Pn=function(){function e(t){xe(this,e),Le(this,"streams",[]),Le(this,"currentStream",null),Le(this,"dvrWindow",0),Le(this,"_segmentPointer",-1),this.hls=t}return Oe(e,[{key:"lastSegment",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.lastSegment}},{key:"currentSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer]}},{key:"nextSegment",get:function(){var e;return null===(e=this.currentSegments)||void 0===e?void 0:e[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.segments}},{key:"liveEdge",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.liveEdge}},{key:"seekRange",get:function(){var e=this.currentSegments;if(e&&e.length)return[e[0].start,e[e.length-1].end]}},{key:"isEmpty",get:function(){var e;return!(null!==(e=this.currentSegments)&&void 0!==e&&e.length)}},{key:"isLive",get:function(){var e;return null===(e=this.currentStream)||void 0===e?void 0:e.live}},{key:"getAudioSegment",value:function(e){var t;return null===(t=this.currentStream)||void 0===t?void 0:t.getAudioSegment(e)}},{key:"moveSegmentPointer",value:function(e){var t;null==e&&(e=this._segmentPointer+1),this._segmentPointer=In(e,-1,null===(t=this.currentSegments)||void 0===t?void 0:t.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(e){var t;return null===(t=this.currentSegments)||void 0===t?void 0:t[e]}},{key:"setNextSegmentByIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._segmentPointer=e-1}},{key:"findSegmentIndexByTime",value:function(e){var t=this.currentSegments;if(t){for(var r,n=0,i=t.length;n<i;n++)if(e>=(r=t[n]).start&&e<r.end)return n;var a=t[t.length-1];if(Math.abs(e-a.end)<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(e,t){var r=this;if(e){if(e.isMaster)this.streams.length=e.streams.length,e.streams.filter((function(e){return e.url})).forEach((function(e,t){r.streams[t]?r.streams[t].update(e):r.streams[t]=new Cn(e)})),this.currentStream=this.streams[0];else if(Array.isArray(e.segments)){var n=this.currentStream;n?n.update(e,t):(this.reset(),this.currentStream=this.streams[0]=new Cn(e,t))}this.currentStream&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce((function(e,t){return e+t.duration}),0))}}},{key:"clearOldSegment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=this.currentStream;if(this.dvrWindow&&t){var r=t.endTime-this.dvrWindow;r<=0||t.segments.length<=e||(this._segmentPointer=t.clearOldSegment(r,this._segmentPointer))}}}]),e}(),xn=function(){function e(){xe(this,e);var t=window.crypto||window.msCrypto;this.subtle=t&&(t.subtle||t.webkitSubtle),this.externalDecryptor=null}var t,r;return Oe(e,[{key:"decrypt",value:function(e,t){if(e||t){var r=[];return e&&(r[0]=this._decryptSegment(e)),t&&(r[1]=this._decryptSegment(t)),Promise.all(r)}}},{key:"_decryptSegment",value:(r=Pe(Ie().mark((function e(t){var r;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.data,!t.key){e.next=5;break}return e.next=4,this._decryptData(t.data,t.key,t.keyIv);case 4:r=e.sent;case 5:if(t.map){e.next=7;break}return e.abrupt("return",r);case 7:return e.abrupt("return",rr(t.map,r));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_decryptData",value:(t=Pe(Ie().mark((function e(t,r,n){var i;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.externalDecryptor){e.next=6;break}return e.next=3,this.externalDecryptor.decrypt(t,r,n);case 3:return e.abrupt("return",e.sent);case 6:if(this.subtle){e.next=8;break}throw new Error("crypto is not defined");case 8:return e.next=10,this.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return i=e.sent,e.t0=Uint8Array,e.next=14,this.subtle.decrypt({name:"AES-CBC",iv:n},i,t);case 14:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 16:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})}]),e}(),Rn=new Pt("Transmuxer"),On=function(){function e(t,r,n){xe(this,e),Le(this,"_initSegmentId",""),this.hls=t,this._demuxer=r?new bn:new cn,this._isMP4=r,n&&(this._remuxer=new wn(this._demuxer.videoTrack,this._demuxer.audioTrack))}return Oe(e,[{key:"transmux",value:function(e,t,r,n,i,a){var o=this._demuxer;try{this._isMP4?o.demux(e,t):o.demuxAndFix(rr(e,t),r,n,i)}catch(v){throw new It(Tt,wt.HLS,v)}var s=o.videoTrack,l=o.audioTrack,u=o.metadataTrack,c="".concat(s.codec,"/").concat(s.width,"/").concat(s.height,"/").concat(l.codec,"/").concat(l.config);if(c!==this._initSegmentId&&(this._initSegmentId=c,a=!0),this._fireEvents(s,l,u,r||a),this.hls.emit(kn.DEMUXED_TRACK,s),!this._remuxer)return[s,l];try{var d=this._remuxer.remux(a),h=d.videoInitSegment,f=d.videoSegment,p=d.audioInitSegment,y=d.audioSegment,m=rr(h,f),g=rr(p,y);return[m?{codec:s.codec,data:m}:void 0,g?{codec:l.codec,data:g}:void 0]}catch(v){throw new It(St,wt.FMP4,v)}}},{key:"_fireEvents",value:function(e,t,r,n){var i=this;Rn.debug(e.samples,t.samples),n&&(e.exist()&&this.hls.emit(kn.METADATA_PARSED,{type:"video",track:e,meta:{codec:e.codec,timescale:e.timescale,width:e.width,height:e.height,sarRatio:e.sarRatio,baseDts:e.baseDts}}),t.exist()&&this.hls.emit(kn.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),Rn.debug("discontinuity",e,t)),e.warnings.forEach((function(e){var t;switch(e.type){case Ir:t=kn.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case Cr:t=kn.LARGE_VIDEO_DTS_GAP_DETECT;break;case Pr:t=kn.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT}t&&i.hls.emit(kn.STREAM_EXCEPTION,ke(ke({},e),{},{type:t})),Rn.warn("video exception",e)})),t.warnings.forEach((function(e){var t;switch(e.type){case xr:t=kn.LARGE_AUDIO_DTS_GAP_DETECT;break;case Rr:t=kn.AUDIO_GAP_DETECT;break;case Or:t=kn.AUDIO_OVERLAP_DETECT}t&&i.hls.emit(kn.STREAM_EXCEPTION,ke(ke({},e),{},{type:t})),Rn.warn("audio exception",e)})),e.samples.forEach((function(e){e.keyframe&&i.hls.emit(kn.KEYFRAME,{pts:e.pts})})),r.seiSamples.forEach((function(e){i.hls.emit(kn.SEI,ke(ke({},e),{},{originPts:e.originPts/90,sei:{code:e.data.type,content:e.data.payload,dts:e.pts}}))}))}}]),e}(),Ln=new Pt("BufferService"),Dn=function(){function e(t){if(xe(this,e),Le(this,"_decryptor",new xn),Le(this,"_transmuxer",null),Le(this,"_mse",null),Le(this,"_softVideo",null),Le(this,"_sourceCreated",!1),Le(this,"_needInitSegment",!0),Le(this,"_directAppend",!1),this.hls=t,t.config.softDecode)this._softVideo=t.media;else{this._mse=new Lt;var r=this._mse.bindMedia(t.media);r&&r.then&&r.then((function(){t&&t.emit("sourceAttached")}))}t.config.decryptor&&(this._decryptor.externalDecryptor=t.config.decryptor)}var t,r,n,i,a,o,s,l;return Oe(e,[{key:"baseDts",get:function(){var e,t,r;return null===(e=this._transmuxer)||void 0===e||null===(t=e._demuxer)||void 0===t||null===(r=t._fixer)||void 0===r?void 0:r._baseDts}},{key:"updateDuration",value:(l=Pe(Ie().mark((function e(t){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ln.debug("update duration",t),!this._mse){e.next=9;break}if(this._mse.isOpened){e.next=5;break}return e.next=5,this._mse.open();case 5:return e.next=7,this._mse.updateDuration(t);case 7:e.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"createSource",value:function(e,t,r,n){if(!this._sourceCreated){var i=e||t;if(i){if(cn.probe(i))this._transmuxer||(this._transmuxer=new On(this.hls,!1,!this._softVideo));else{if(!dn.probe(i))throw new It(At,null,null,null,"unsupported stream");if(this._softVideo)this._transmuxer||(this._transmuxer=new On(this.hls,!0));else{this._directAppend=!0;var a=!1;e&&!r&&dn.findBox(e,["moov","trak"]).forEach((function(e){var t=dn.findBox(e.data,["trak","mdia","minf","stbl","stsd"])[0];if(t){var i=dn.stsd(t).entries[0];if(i)if(i.hvcC)r=i.hvcC.codec||"hev1.1.6.L93.B0";else if(i.avcC)r=i.avcC.codec;else if(i.sampleRate||i.esds){var o;n=(null===(o=i.esds)||void 0===o?void 0:o.codec)||"mp4a.40.2",a=!0}}})),t&&!n&&dn.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach((function(e){var t=dn.stsd(e).entries[0];t&&t.esds&&(n=t.esds.codec)})),e&&!r&&(r="avc1.42e01e"),t&&!n&&(n="mp4a.40.2"),a&&(r+=", ".concat(n),n=""),this._createMseSource(r,n)}}this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:(s=Pe(Ie().mark((function e(t,r,n,i,a){var o,s,l,u,c,d;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.length||null!=r&&r.length){e.next=2;break}return e.abrupt("return");case 2:if(!this._directAppend){e.next=7;break}return o=[],t&&o.push(this._mse.append(Lt.VIDEO,t)),r&&o.push(this._mse.append(Lt.AUDIO,r)),e.abrupt("return",Promise.all(o));case 7:if(s=this._transmuxer.transmux(t,r,n,i,a,this._needInitSegment||n),l=Ze(s,2),u=l[0],c=l[1],u&&!c&&this.hls.emit(kn.NO_AUDIO_TRACK),!this._softVideo){e.next=13;break}this._softVideo.appendBuffer(u,c),e.next=21;break;case 13:if(!this._mse){e.next=21;break}return this._sourceCreated||this._createMseSource(null==u?void 0:u.codec,null==c?void 0:c.codec),this._needInitSegment=!1,d=this._mse,o=[],u&&o.push(d.append(Lt.VIDEO,u.data)),c&&o.push(d.append(Lt.AUDIO,c.data)),e.abrupt("return",Promise.all(o));case 21:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return s.apply(this,arguments)})},{key:"evictBuffer",value:(o=Pe(Ie().mark((function e(t){var r,n,i,a=this;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.hls.media,this._mse&&r&&t&&!(t<0)){e.next=3;break}return e.abrupt("return");case 3:if(n=r.currentTime,!((i=n-t)<=0)){e.next=7;break}return e.abrupt("return");case 7:if(!(vt.start(vt.get(r))+1>=i)){e.next=10;break}return e.abrupt("return");case 10:return e.abrupt("return",this._mse.clearBuffer(0,i).then((function(){return a.hls.emit(Kt.REMOVE_BUFFER,{removeEnd:i})})));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"clearAllBuffer",value:(a=Pe(Ie().mark((function e(){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=2;break}return e.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"decryptBuffer",value:function(e,t){return this._decryptor.decrypt(e,t)}},{key:"reset",value:(i=Pe(Ie().mark((function e(){var t,r=arguments;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],!this._mse||t){e.next=6;break}return e.next=4,this._mse.unbindMedia();case 4:return e.next=6,this._mse.bindMedia(this.hls.media);case 6:this._transmuxer=null,this._sourceCreated=!1,this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"endOfStream",value:(n=Pe(Ie().mark((function e(){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=5;break}if(!this._sourceCreated){e.next=5;break}return e.next=4,this._mse.endOfStream();case 4:this.hls.emit(Kt.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setLiveSeekableRange",value:(r=Pe(Ie().mark((function e(t,r){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._mse&&this._mse.setLiveSeekableRange(t,r);case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"destroy",value:(t=Pe(Ie().mark((function e(){var t;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._mse,this._mse=null,this._softVideo=null,!t){e.next=6;break}return e.next=6,t.unbindMedia();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_createMseSource",value:function(e,t){Ln.debug("create mse source, videoCodec=".concat(e,", audioCodec=").concat(t));var r=this._mse;r&&(e&&(r.createSource(Lt.VIDEO,"video/mp4;codecs=".concat(e)),this._sourceCreated=!0),t&&(r.createSource(Lt.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0),this.hls.emit(Kt.SOURCEBUFFER_CREATED))}}]),e}(),Mn=Oe((function e(){xe(this,e),Le(this,"version",0),Le(this,"streams",[]),Le(this,"isMaster",!0)})),Nn=Oe((function e(){xe(this,e),Le(this,"id",0),Le(this,"url",""),Le(this,"default",!1),Le(this,"group",""),Le(this,"name",""),Le(this,"lang",""),Le(this,"channels",0),Le(this,"segments",[])})),Gn=Oe((function e(){xe(this,e),Le(this,"id",0),Le(this,"bitrate",0),Le(this,"width",0),Le(this,"height",0),Le(this,"name",""),Le(this,"url",""),Le(this,"audioCodec",""),Le(this,"videoCodec",""),Le(this,"textCodec",""),Le(this,"audioGroup",""),Le(this,"audioStreams",[])})),Vn=Oe((function e(){xe(this,e),Le(this,"version",0),Le(this,"url",""),Le(this,"type",""),Le(this,"startCC",0),Le(this,"endCC",0),Le(this,"startSN",0),Le(this,"endSN",0),Le(this,"totalDuration",0),Le(this,"targetDuration",0),Le(this,"live",!0),Le(this,"segments",[])})),Un=function(){function e(){xe(this,e),Le(this,"sn",0),Le(this,"cc",0),Le(this,"url",""),Le(this,"title",""),Le(this,"start",0),Le(this,"duration",0),Le(this,"key",null),Le(this,"byteRange",null),Le(this,"isInitSegment",!1),Le(this,"initSegment",null),Le(this,"isLast",!1)}return Oe(e,[{key:"end",get:function(){return this.start+this.duration}},{key:"setByteRange",value:function(e,t){this.byteRange=[0];var r=e.split("@");1===r.length&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(r[1]),this.byteRange[1]=this.byteRange[0]+parseInt(r[0])-1}}]),e}(),Zn=function(){function e(t){xe(this,e),Le(this,"method",""),Le(this,"url",""),Le(this,"iv",null),Le(this,"keyFormat",""),Le(this,"keyFormatVersions",""),t instanceof e&&(this.method=t.method,this.url=t.url,this.keyFormat=t.keyFormat,this.keyFormatVersions=t.keyFormatVersions,t.iv&&(this.iv=new Uint8Array(t.iv)))}return Oe(e,[{key:"clone",value:function(t){var r=new e(this);return null!=t&&r.setIVFromSN(t),r}},{key:"setIVFromSN",value:function(e){if(!this.iv&&"AES-128"===this.method&&"number"==typeof e&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=e>>8*(15-t)&255}}}]),e}(),Bn=/^#(EXT[^:]*)(?::(.*))?$/,Fn=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,jn=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,Wn=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function Xn(e){return e.split(/[\r\n]/).map((function(e){return e.trim()})).filter(Boolean)}function Hn(e){var t=e.match(Bn);if(t&&t[1])return[t[1].replace("EXT-X-",""),t[2]]}function Kn(e){for(var t={},r=Fn.exec(e);r;)t[r[1]]=r[2]||r[3],r=Fn.exec(e);return t}function Yn(e,t){if(!t||!e||jn.test(e))return e;var r=Wn.exec(t);return r?"/"===e[0]?r[1]+e:r[1]+r[2]+e:e}var zn={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Jn(e,t){var r=zn[e];if(r&&t&&t.length)for(var n=0;n<r.length;n++)for(var i=0;i<t.length;i++)if(r[n].test(t[i]))return t[i]}function Qn(e,t){for(var r,n=new Mn,i=0,a=[];r=e[i++];){var o=Hn(r);if(o){var s=Ze(o,2),l=s[0],u=s[1];if("VERSION"===l)n.version=parseInt(u);else if("MEDIA"===l&&u){var c=Kn(u);if("AUDIO"===c.TYPE&&c.URI){var d=new Nn;d.url=Yn(c.URI,t),d.default="YES"===c.DEFAULT,d.group=c["GROUP-ID"],d.name=c.NAME,d.lang=c.LANGUAGE,c.CHANNELS&&(d.channels=Number(c.CHANNELS.split("/")[0]),Number.isNaN(d.channels)&&(d.channels=0)),a.push(d)}}else if("STREAM-INF"===l&&u){var h=new Gn,f=Kn(u);if(h.bitrate=parseInt(f["AVERAGE-BANDWIDTH"]||f.BANDWIDTH),h.name=f.NAME,h.url=Yn(e[i++],t),f.RESOLUTION){var p=Ze(f.RESOLUTION.split("x"),2),y=p[0],m=p[1];h.width=parseInt(y),h.height=parseInt(m)}if(f.CODECS){var g=f.CODECS.split(/[ ,]+/).filter(Boolean);h.videoCodec=Jn("video",g),h.audioCodec=Jn("audio",g),h.textCodec=Jn("text",g)}h.audioGroup=f.AUDIO,n.streams.push(h)}}}return n.streams.forEach((function(e,t){e.id=t})),a.length&&(a.forEach((function(e,t){e.id=t})),n.streams.forEach((function(e){e.audioGroup&&(e.audioStreams=a.filter((function(t){return t.group===e.audioGroup})))}))),n}function qn(e,t){var r=new Vn;r.url=t;for(var n,i=new Un,a=null,o=null,s=0,l=0,u=0,c=0;n=e[c++];)if("#"===n[0]){var d=Hn(n);if(d){var h=Ze(d,2),f=h[0],p=h[1];switch(f){case"VERSION":r.version=parseInt(p);break;case"PLAYLIST-TYPE":r.type=null==p?void 0:p.toUpperCase();break;case"TARGETDURATION":r.targetDuration=parseFloat(p);break;case"ENDLIST":var y=r.segments[r.segments.length-1];y&&(y.isLast=!0),r.live=!1;break;case"MEDIA-SEQUENCE":l=r.startSN=parseInt(p);break;case"DISCONTINUITY-SEQUENCE":u=r.startCC=parseInt(p);break;case"DISCONTINUITY":u++;break;case"BYTERANGE":i.setByteRange(p,r.segments[r.segments.length-1]);break;case"EXTINF":var m=Ze(p.split(","),2),g=m[0],v=m[1];i.start=s,i.duration=parseFloat(g),s+=i.duration,i.title=v;break;case"KEY":var b=Kn(p);if("NONE"===b.METHOD){o=null;break}if("AES-128"!==b.METHOD)throw new Error("encrypt ".concat(b.METHOD,"/").concat(b.KEYFORMAT," is not supported"));if((o=new Zn).method=b.METHOD,o.url=/^blob:/.test(b.URI)?b.URI:Yn(b.URI,t),o.keyFormat=b.KEYFORMAT||"identity",o.keyFormatVersions=b.KEYFORMATVERSIONS,b.IV){var _=b.IV.slice(2);_=(1&_.length?"0":"")+_,o.iv=new Uint8Array(_.length/2);for(var E=0,T=_.length/2;E<T;E++)o.iv[E]=parseInt(_.slice(2*E,2*E+2),16)}break;case"MAP":var S=Kn(p);i.url=Yn(S.URI,t),S.BYTERANGE&&i.setByteRange(S.BYTERANGE),i.isInitSegment=!0,i.sn=0,o&&(i.key=o.clone(0)),a=i,i=new Un}}}else i.sn=l,i.cc=u,i.url=Yn(n,t),o&&(i.key=o.clone(l)),a&&(i.initSegment=a),r.segments.push(i),i=new Un,l++;var $=r.segments[r.segments.length-1];return $&&(r.endSN=$.sn),r.totalDuration=s,r.endCC=u,r}var ei=function(){function e(){xe(this,e)}return Oe(e,null,[{key:"parse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0;if(!t.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var n=Xn(t);return e.isMediaPlaylist(t)?qn(n,r):Qn(n,r)}},{key:"isMediaPlaylist",value:function(e){return e.includes("#EXTINF:")||e.includes("#EXT-X-TARGETDURATION:")}}]),e}(),ti=function(){function e(t){var r=this;xe(this,e),Le(this,"_onLoaderRetry",(function(e,t){r.hls.emit(kn.LOAD_RETRY,{error:It.network(e),retryTime:t})})),this.hls=t,this._timer=null;var n=this.hls.config,i=n.retryCount,a=n.retryDelay,o=n.loadTimeout,s=n.fetchOptions;this._loader=new ir(ke(ke({},s),{},{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._audioLoader=new ir(ke(ke({},s),{},{responseType:"text",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry}))}var t;return Oe(e,[{key:"load",value:(t=Pe(Ie().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this._loader.load(t)],r&&n.push(this._audioLoader.load(r)),e.prev=2,e.next=5,Promise.all(n);case 5:if(o=e.sent,s=Ze(o,2),l=s[0],u=s[1],l){e.next=11;break}return e.abrupt("return",[]);case 11:i=l.data,a=null==u?void 0:u.data,e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(2),It.network(e.t0);case 18:c=this.hls.config.onPreM3U8Parse,e.prev=19,c&&(i=c(i)||i,a&&(a=c(a,!0)||a)),d=ei.parse(i,t),a&&(h=ei.parse(a,r)),e.next=28;break;case 25:throw e.prev=25,e.t1=e.catch(19),new It(bt,wt.HLS);case 28:return d&&(d.isMaster?this.hls.emit(kn.HLS_MANIFEST_LOADED,{playlist:d}):this.hls.emit(kn.HLS_LEVEL_LOADED,{playlist:d})),e.abrupt("return",[d,h]);case 30:case"end":return e.stop()}}),e,this,[[2,15],[19,25]])}))),function(e,r){return t.apply(this,arguments)})},{key:"poll",value:function(e,t,r,n,i){var a=this;clearTimeout(this._timer),i=i||3e3;var o,s=(o=Pe(Ie().mark((function o(){var l;return Ie().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return clearTimeout(a._timer),o.prev=1,o.next=4,a.load(e,t);case 4:if((l=o.sent)[0]){o.next=7;break}return o.abrupt("return");case 7:r(l[0],l[1]),o.next=13;break;case 10:o.prev=10,o.t0=o.catch(1),n(o.t0);case 13:a._timer=setTimeout(s,i);case 14:case"end":return o.stop()}}),o,null,[[1,10]])}))),function(){return o.apply(this,arguments)});this._timer=setTimeout(s,i)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),e}(),ri=function(){function e(t){var r=this;xe(this,e),Le(this,"_emitOnLoaded",(function(e,t){var n=e.data,i=e.response,a=e.option||{},o=a.firstByteTime,s=a.startTime,l=a.endTime,u=a.contentLength,c=l-s;r._bandwidthService.addRecord(u||n.byteLength,c),r.hls.emit(Kt.SPEED,{time:c,byteLength:u,url:t}),r.hls.emit(Kt.LOAD_COMPLETE,{url:t,elapsed:c||0}),r.hls.emit(Kt.TTFB,{url:t,responseUrl:i.url,elapsed:o-s}),r.hls.emit(Kt.LOAD_RESPONSE_HEADERS,{headers:i.headers})})),Le(this,"_onLoaderRetry",(function(e,t){r.hls.emit(Kt.LOAD_RETRY,{error:It.network(e),retryTime:t})})),this.hls=t,this._bandwidthService=new sr,this._mapCache={},this._keyCache={};var n=this.hls.config,i=n.retryCount,a=n.retryDelay,o=n.loadTimeout,s=n.fetchOptions;this._segmentLoader=new ir(ke(ke({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new ir(ke(ke({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry})),this._keyLoader=new ir(ke(ke({},s),{},{responseType:"arraybuffer",retry:i,retryDelay:a,timeout:o,onRetryError:this._onLoaderRetry}))}var t,r;return Oe(e,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,i=[];return e&&(i[0]=this.loadVideoSegment(e,r)),t&&(i[1]=this.loadAudioSegment(t,n)),Promise.all(i)}},{key:"loadVideoSegment",value:function(e,t){return this._loadSegment(this._segmentLoader,e,t)}},{key:"loadAudioSegment",value:function(e,t){return this._loadSegment(this._audioSegmentLoader,e,t)}},{key:"_loadSegment",value:(r=Pe(Ie().mark((function e(t,r,n){var i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b=this;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=[],this.hls.emit(Kt.LOAD_START,{url:r.url}),c[0]=t.load(r.url),n&&r.initSegment&&(h=r.initSegment.url,(a=this._mapCache[h])||(this.hls.emit(Kt.LOAD_START,{url:h}),c[1]=t.load(h).then((function(e){e&&(Object.keys(b._mapCache)>30&&(b._mapCache={}),a=b._mapCache[h]=e.data,b._emitOnLoaded(e,h))}))),(f=null===(d=r.initSegment.key)||void 0===d?void 0:d.url)&&(u=r.initSegment.key.iv,(l=this._keyCache[f])||(this.hls.emit(Kt.LOAD_START,{url:f}),c[2]=this._keyLoader.load(f).then((function(e){e&&(l=b._keyCache[f]=e.data,b._emitOnLoaded(e,f))}))))),(p=null===(i=r.key)||void 0===i?void 0:i.url)&&(s=r.key.iv,(o=this._keyCache[p])||(this.hls.emit(Kt.LOAD_START,{url:p}),c[3]=this._keyLoader.load(p).then((function(e){e&&(o=b._keyCache[p]=e.data,b._emitOnLoaded(e,p))})))),e.next=8,Promise.all(c);case 8:if(y=e.sent,m=Ze(y,1),g=m[0]){e.next=13;break}return e.abrupt("return");case 13:return v=g.data,this._emitOnLoaded(g,r.url),e.abrupt("return",{data:v,map:a,key:o,mapKey:l,keyIv:s,mapKeyIv:u});case 16:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"reset",value:function(){this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:(t=Pe(Ie().mark((function e(){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ni=new Pt("hls"),ii=function(e){De(h,e);var t,r,n,i,a,o,s,l,u,c,d=Ue(h);function h(e){var t,r,n,i;return xe(this,h),Le(Ge(t=d.call(this)),"version",h.version),Le(Ge(t),"media",null),Le(Ge(t),"config",null),Le(Ge(t),"_manifestLoader",null),Le(Ge(t),"_segmentLoader",null),Le(Ge(t),"_playlist",null),Le(Ge(t),"_bufferService",null),Le(Ge(t),"_gapService",null),Le(Ge(t),"_seiService",null),Le(Ge(t),"_prevSegSn",null),Le(Ge(t),"_prevSegCc",null),Le(Ge(t),"_tickTimer",null),Le(Ge(t),"_tickInterval",500),Le(Ge(t),"_segmentProcessing",!1),Le(Ge(t),"_reloadOnPlay",!1),Le(Ge(t),"_loadM3U8",(i=Pe(Ie().mark((function e(r){var n,i,a,o;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t._manifestLoader.load(r);case 3:i=e.sent,a=Ze(i,1),n=a[0],e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),t._emitError(It.create(e.t0));case 11:if(n){e.next=13;break}return e.abrupt("return");case 13:if(t._playlist.upsertPlaylist(n),!n.isMaster){e.next=17;break}return e.next=17,t._refreshM3U8();case 17:if(t.emit(kn.STREAM_PARSED),!t.isLive){e.next=23;break}t._bufferService.setLiveSeekableRange(0,4294967295),n.isMaster||t._pollM3U8(r),e.next=27;break;case 23:return e.next=25,t._bufferService.updateDuration(t._playlist.currentStream.totalDuration);case 25:(o=t.config.startTime)&&(t.media.currentTime=o,t._playlist.setNextSegmentByIndex(t._playlist.findSegmentIndexByTime(o)||0));case 27:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(e){return i.apply(this,arguments)})),Le(Ge(t),"_loadSegment",Pe(Ie().mark((function e(){var r,n;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._segmentProcessing&&t.media){e.next=2;break}return e.abrupt("return");case 2:if(r=t.media.currentTime,n=t._playlist.currentSegment,t._playlist.nextSegment&&!(n&&!t.isLive&&n.end-r>=t.config.preloadTime)){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",t._loadSegmentDirect());case 8:case"end":return e.stop()}}),e)})))),Le(Ge(t),"_onPlay",Pe(Ie().mark((function e(){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(t._disconnectTimer),!t._reloadOnPlay){e.next=6;break}t._reloadOnPlay=!1,t.replay(!0),e.next=9;break;case 6:return e.next=8,t._loadSegment();case 8:t._startTick();case 9:case"end":return e.stop()}}),e)})))),Le(Ge(t),"_onPause",(function(){if(t.isLive){if(!t._reloadOnPlay){var e=t.config.disconnectTime;if(null==e&&(e=t._playlist.dvrWindow),!Number.isFinite(e))return;clearTimeout(t._disconnectTimer),t._disconnectTimer=setTimeout((function(){t._reloadOnPlay=!0,t._clear()}),e||0)}}else t._stopTick()})),Le(Ge(t),"_onSeeking",Pe(Ie().mark((function e(){var r,n,i,a,o,s,l;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.media){e.next=2;break}return e.abrupt("return");case 2:if(r=t.media.currentTime,!(n=t._playlist.seekRange)){e.next=9;break}if(i=In(r,n[0]+.1,n[1]-.1),!(Math.abs(r-i)>=.1)){e.next=9;break}return t.media.currentTime=i,e.abrupt("return");case 9:if(!(a=t._playlist.currentSegment)){e.next=14;break}if(!((o=vt.info(vt.get(t.media),r,.1)).end&&o.end>=a.end)){e.next=14;break}return e.abrupt("return");case 14:if(s=t._playlist.findSegmentIndexByTime(r),l=t._playlist.getSegmentByIndex(s),null!=s&&l&&(!t._segmentProcessing||l!==t._playlist.nextSegment)){e.next=18;break}return e.abrupt("return");case 18:return ni.debug("seek to",r,l),t._playlist.setNextSegmentByIndex(s),t._stopTick(),e.next=23,t._segmentLoader.cancel();case 23:return e.next=25,t._loadSegmentDirect();case 25:t._startTick();case 26:case"end":return e.stop()}}),e)})))),Le(Ge(t),"_onTimeupdate",(function(){if(t.media){var e=t.config;if(e.isLive&&e.maxLatency&&e.targetLatency&&t.media){var r=t._playlist.liveEdge;if(!r)return;var n=r-t.media.currentTime;n>=e.maxLatency&&(ni.debug("latency jump",n),t.media.currentTime=r-e.targetLatency)}t._seiService.throw(t.media.currentTime)}})),Le(Ge(t),"_tick",(function(){if(t.media){t._startTick();var e=t.media;vt.end(vt.get(e))<.1||!e.readyState||(!(r=e)||r.paused||r.ended||0===r.playbackRate||0===r.readyState?e.readyState<2&&t._gapService&&t._gapService.do(e,t.config.maxJumpDistance,t.isLive):(t._loadSegment(),t._gapService&&t._gapService.do(e,t.config.maxJumpDistance,t.isLive)))}var r})),t.config=(n=(null==(r=e)?void 0:r.media)||document.createElement("video"),e=ke(ke({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,loadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,targetLatency:(null==r?void 0:r.preloadTime)||10,maxLatency:null!=r&&r.preloadTime?2*r.preloadTime:20},r),{},{media:n})),t.media=t.config.media,t._manifestLoader=new ti(Ge(t)),t._segmentLoader=new ri(Ge(t)),t._playlist=new Pn(Ge(t)),t._bufferService=new Dn(Ge(t)),t._seiService=new or(Ge(t)),e.softDecode||(t._gapService=new ar),t.media.addEventListener("play",t._onPlay),t.media.addEventListener("pause",t._onPause),t.media.addEventListener("seeking",t._onSeeking),t.media.addEventListener("timeupdate",t._onTimeupdate),t}return Oe(h,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"baseDts",get:function(){var e;return null===(e=this._bufferService)||void 0===e?void 0:e.baseDts}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1;return vt.info(vt.get(this.media),null===(e=this.media)||void 0===e?void 0:e.currentTime,t)}},{key:"playbackQuality",value:function(){return function(e){if(!e)return{};if("function"==typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();return{droppedVideoFrames:t.droppedVideoFrames||t.corruptedVideoFrames,totalVideoFrames:t.totalVideoFrames,creationTime:t.creationTime}}return{droppedVideoFrames:e.webkitDroppedFrameCount,totalVideoFrames:e.webkitDecodedFrameCount,creationTime:performance.now()}}(this.media)}},{key:"load",value:(c=Pe(Ie().mark((function e(t){var r,n=arguments;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]&&n[1],t&&(this.config.url=t),t=this.config.url,e.next=5,this._reset(r);case 5:if(t&&(t=t.trim()),t){e.next=8;break}throw this._emitError(new It(At,wt.OPTION,null,null,"m3u8 url is missing"));case 8:return e.next=10,this._loadM3U8(t);case 10:return e.next=12,this._loadSegment();case 12:this._startTick();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"replay",value:(u=Pe(Ie().mark((function e(t){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.startTime=0,!this.config.softDecode){e.next=5;break}this.load(),e.next=7;break;case 5:return e.next=7,this.load();case 7:return this._reloadOnPlay=!1,e.abrupt("return",this.media.play(!t));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"switchURL",value:(l=Pe(Ie().mark((function e(t){var r,n,i=arguments;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:0,this.config.startTime=r,this.config.url=t,e.prev=3,!this.config.softDecode){e.next=8;break}e.t0=this.load(t),e.next=11;break;case 8:return e.next=10,this.load(t);case 10:e.t0=e.sent;case 11:n=e.t0,e.next=18;break;case 14:throw e.prev=14,e.t1=e.catch(3),this.emit(kn.SWITCH_URL_FAILED,e.t1),e.t1;case 18:return this._reloadOnPlay=!1,n&&this.emit(kn.SWITCH_URL_SUCCESS,{url:t}),e.abrupt("return",this.media.play(!0));case 21:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(e){return l.apply(this,arguments)})},{key:"switchStream",value:(s=Pe(Ie().mark((function e(t){var r,n,i,a,o,s=arguments;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(s.length>1&&void 0!==s[1])||s[1],n=this.currentStream,i=this.streams,n&&n.id!==t&&i&&!(i.length<2)){e.next=5;break}return e.abrupt("return");case 5:if(a=i.find((function(e){return e.id===t}))){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,this._clear();case 11:if(!r){e.next=14;break}return e.next=14,this._bufferService.clearAllBuffer();case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(8),this._emitError(It.create(e.t0));case 19:if(n.currentAudioStream&&a.audioStreams.length>2&&(o=n.currentAudioStream.id,a.currentAudioStream=a.audioStreams.find((function(e){return e.id===o}))||a.currentAudioStream),this._playlist.currentStream=a,e.prev=21,!this.isLive&&a.segments.length){e.next=25;break}return e.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=29,this._loadSegmentDirect();case 29:e.next=35;break;case 31:throw e.prev=31,e.t1=e.catch(21),this._playlist.currentStream=n,e.t1;case 35:return this._startTick(),e.abrupt("return",a);case 37:case"end":return e.stop()}}),e,this,[[8,16],[21,31]])}))),function(e){return s.apply(this,arguments)})},{key:"switchAudioStream",value:(o=Pe(Ie().mark((function e(t){var r,n,i,a,o=arguments;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>1&&void 0!==o[1])||o[1],n=this.currentStream){e.next=4;break}return e.abrupt("return");case 4:if((i=n.currentAudioStream)&&i.id!==t&&!(n.audioStreams.length<2)){e.next=7;break}return e.abrupt("return");case 7:if(a=n.audioStreams.find((function(e){return e.id===t}))){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,this._clear();case 13:if(!r){e.next=16;break}return e.next=16,this._bufferService.clearAllBuffer();case 16:e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(10),this._emitError(It.create(e.t0));case 21:if(n.currentAudioStream=a,e.prev=22,!this.isLive&&a.segments.length){e.next=26;break}return e.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,e.next=30,this._loadSegmentDirect();case 30:e.next=36;break;case 32:throw e.prev=32,e.t1=e.catch(22),n.currentAudioStream=i,e.t1;case 36:return this._startTick(),e.abrupt("return",a);case 38:case"end":return e.stop()}}),e,this,[[10,18],[22,32]])}))),function(e){return o.apply(this,arguments)})},{key:"destroy",value:(a=Pe(Ie().mark((function e(){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.media){e.next=2;break}return e.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),e.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null;case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_refreshM3U8",value:function(){var e,t=this,r=this._playlist.currentStream;if(!r||!r.url)throw this._emitError(It.create(null,null,new Error("m3u8 url is not defined")));var n=r.url,i=null===(e=r.currentAudioStream)||void 0===e?void 0:e.url;return this._manifestLoader.load(n,i).then((function(e){var r=Ze(e,2),a=r[0],o=r[1];a&&(t._playlist.upsertPlaylist(a,o),t.isLive&&t._pollM3U8(n,i))})).catch((function(e){throw t._emitError(It.create(e))}))}},{key:"_pollM3U8",value:function(e,t){var r,n=this,i=this._playlist.isEmpty;this._manifestLoader.poll(e,t,(function(e,t){n._playlist.upsertPlaylist(e,t),e&&i&&!n._playlist.isEmpty&&n._loadSegment(),i&&(i=n._playlist.isEmpty)}),(function(e){n._emitError(It.create(e))}),1e3*((null===(r=this._playlist.lastSegment)||void 0===r?void 0:r.duration)||0))}},{key:"_loadSegmentDirect",value:(i=Pe(Ie().mark((function e(){var t,r,n;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._playlist.nextSegment){e.next=3;break}return e.abrupt("return");case 3:return r=!1,n=null,e.prev=5,this._segmentProcessing=!0,e.next=9,this._reqAndBufferSegment(t,this._playlist.getAudioSegment(t));case 9:r=e.sent,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),n=e.t0;case 15:return e.prev=15,this._segmentProcessing=!1,e.finish(15);case 18:if(!n){e.next=20;break}return e.abrupt("return",this._emitError(It.create(n)));case 20:return r&&(this._playlist.moveSegmentPointer(),t.isLast?this._end():this._loadSegment()),e.abrupt("return",r);case 22:case"end":return e.stop()}}),e,this,[[5,12,15,18]])}))),function(){return i.apply(this,arguments)})},{key:"_reqAndBufferSegment",value:(n=Pe(Ie().mark((function e(t,r){var n,i,a,o,s,l,u,c;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t?t.cc:r.cc,a=this._prevSegCc!==i,e.next=4,this._segmentLoader.load(t,r,a);case 4:if((o=e.sent)[0]){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,(n=this._bufferService).decryptBuffer.apply(n,Be(o));case 9:if(s=e.sent){e.next=12;break}return e.abrupt("return");case 12:return l=t?t.sn:r.sn,u=t?t.start:r.start,c=this._playlist.currentStream,this._bufferService.createSource(s[0],s[1],null==c?void 0:c.videoCodec,null==c?void 0:c.audioCodec),e.next=18,this._bufferService.appendBuffer(s[0],s[1],a,this._prevSegSn===l-1,u);case 18:return e.next=20,this._bufferService.evictBuffer(this.config.bufferBehind);case 20:return this._prevSegCc=i,this._prevSegSn=l,e.abrupt("return",!0);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_clear",value:(r=Pe(Ie().mark((function e(){return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),e.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_reset",value:(t=Pe(Ie().mark((function e(){var t,r=arguments;return Ie().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._playlist.reset(),this._segmentLoader.reset(),this._seiService.reset(),e.next=9,this._clear();case 9:return e.abrupt("return",this._bufferService.reset(t));case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream()}},{key:"_stopTick",value:function(){clearTimeout(this._tickTimer)}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ni.table(e),ni.error(e),ni.error(null===(t=this.media)||void 0===t?void 0:t.error),this.emit(kn.ERROR,e),r&&this._end(),this._seiService.reset(),e}}],[{key:"isSupported",value:function(){return Lt.isSupported()||!!WebAssembly}},{key:"enableLogger",value:function(){Pt.enable(),Ur.enable()}},{key:"disableLogger",value:function(){Pt.disable(),Ur.disable()}}]),h}(zt);Le(ii,"version","3.0.0-next.23");try{localStorage.getItem("xgd")?ii.enableLogger():ii.disableLogger()}catch(Si){}var ai=function(){function e(t,r){var n=this;xe(this,e),Le(this,"_opts",null),Le(this,"_plugin",null),Le(this,"_onLowDecode",(function(){var e,t,r,i,a=n._opts,o=a.media,s=a.innerDegrade;null===(e=n._plugin)||void 0===e||null===(t=e.player)||void 0===t||t.emit("lowdecode",o.degradeInfo),null===(r=n._plugin)||void 0===r||null===(i=r.player)||void 0===i||i.emit("core_event",ke(ke({},o.degradeInfo),{},{eventName:kn.LOWDECODE})),1===s&&n._degrade(o.src)})),Le(this,"_degrade",(function(e){var t=n._plugin.player,r=t.video;if(!r||"MVideo"===r.TAG){var i=t.video.degradeVideo;t.video=i,r.degrade(e),e&&(t.config.url=e);var a=t.root.firstChild;"MVideo"===a.TAG&&t.root.replaceChild(i,a);var o=n._plugin.constructor.pluginName.toLowerCase();t.unRegisterPlugin(o),t.once("canplay",(function(){t.play()}))}})),Le(this,"forceDegradeToVideo",(function(e){1===n._opts.innerDegrade&&n._degrade(e)})),this._opts=t,this._plugin=r,this._init()}return Oe(e,[{key:"_init",value:function(){var e=this._opts,t=e.media,r=e.preloadTime,n=e.innerDegrade,i=e.isLive;t&&(i||!t.setPlayMode?(n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),this._bindEvents()):t.setPlayMode("VOD"))}},{key:"_bindEvents",value:function(){this._opts.media.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var e,t;null===(e=this._opts)||void 0===e||null===(t=e.media)||void 0===t||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),e}(),oi=function(){function e(){xe(this,e),Le(this,"encodeType",""),Le(this,"audioCodec",""),Le(this,"videoCodec",""),Le(this,"domain",""),Le(this,"fps",0),Le(this,"bitrate",0),Le(this,"width",0),Le(this,"height",0),Le(this,"samplerate",0),Le(this,"channelCount",0),Le(this,"gop",0),Le(this,"_bitsAccumulateSize",0),Le(this,"_bitsAccumulateDuration",0)}return Oe(e,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(e){this.encodeType=e}},{key:"setVideoMeta",value:function(e){this.width=e.width,this.height=e.height,this.videoCodec=e.codec,this.encodeType=e.codecType,e.fpsNum&&e.fpsDen&&(this.fps=e.fpsNum/e.fpsDen)}},{key:"setAudioMeta",value:function(e){this.audioCodec=e.codec,this.samplerate=e.sampleRate,this.channelCount=e.channelCount}},{key:"setDomain",value:function(e){this.domain=e.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(e){var t=this;if(!this.fps||this.fps>=100){var r=e[0];null!=r&&r.duration&&(this.fps=Math.round(9e4/r.duration))}e.forEach((function(e){1===e.gopId&&t.gop++,t._bitsAccumulateDuration+=e.duration/90,t._bitsAccumulateSize+=e.units.reduce((function(e,t){return e+t.length}),0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=8*t._bitsAccumulateSize,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)}))}}]),e}(),si=function(){function e(t){xe(this,e),Le(this,"_plugin",void 0),Le(this,"_samples",[]),Le(this,"_bitrateCalcDuration",0),Le(this,"_stats",new oi),this._plugin=t,this._bindEvents()}return Oe(e,[{key:"getStats",value:function(){var e,t,r,n,i,a,o=(null===(e=this._plugin.player)||void 0===e?void 0:e.video)||{},s=o.currentTime,l=void 0===s?0:s,u=o.decodeFps,c=void 0===u?0:u;return ke(ke({},this._stats.getStats()),{},{downloadSpeed:null===(t=this._plugin.core)||void 0===t||null===(r=t.speedInfo)||void 0===r?void 0:r.call(t).speed,avgSpeed:null===(n=this._plugin.core)||void 0===n||null===(i=n.speedInfo)||void 0===i?void 0:i.call(n).avgSpeed,currentTime:l,bufferEnd:(null===(a=this._plugin.player)||void 0===a?void 0:a.getBufferedRange()[1])-l,decodeFps:c})}},{key:"_bindEvents",value:function(){var e,t=this;this._onceLoadStart(),null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function(e){e.eventName===Kt.METADATA_PARSED&&("video"===e.type?t._stats.setVideoMeta(e.track):t._stats.setAudioMeta(e.track)),e.eventName===Kt.TTFB&&t._stats.setDomain(e.responseUrl)}))}},{key:"_onceLoadStart",value:function(){var e,t=this;null===(e=this._plugin.player)||void 0===e||e.on("core_event",(function e(r){r.eventName===Kt.LOAD_START&&(t._plugin.player.off("core_event",e),t._plugin.core.on(kn.DEMUXED_TRACK,(function(e){return t._stats.updateBitrate(e.samples)})))}))}}]),e}(),li=function(e){De(r,e);var t=Ue(r);function r(){var e;xe(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return Le(Ge(e=t.call.apply(t,[this].concat(i))),"hls",null),Le(Ge(e),"pluginExtension",null),Le(Ge(e),"_stats",new si(Ge(e))),Le(Ge(e),"getStats",(function(){return e._stats.getStats()})),Le(Ge(e),"destroy",(function(){var t;e.hls&&(e.hls.destroy(),e.hls=null),null===(t=e.pluginExtension)||void 0===t||t.destroy(),e.pluginExtension=null})),Le(Ge(e),"_onSwitchURL",(function(t){var r=Ge(e),n=r.player,i=r.hls;if(i){var a=n.currentTime;n.config.url=t,i.switchURL(t,a).catch((function(e){}))}})),Le(Ge(e),"_onDefinitionChange",(function(t){var r=t.to;e.hls&&e.hls.switchURL(r).catch((function(e){}))})),e}return Oe(r,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return null===(e=this.hls)||void 0===e?void 0:e.version}},{key:"softDecode",get:function(){var e,t,r=null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType;return!!r&&"video"!==r}},{key:"beforePlayerInit",value:function(){var e,t=this,r=new Promise((function(t,r){e=t})),n=this.player.config;this.hls&&this.hls.destroy(),this.player.switchURL=this._onSwitchURL;var i,a=n.hls||{};return a.innerDegrade=a.innerDegrade||n.innerDegrade,null!==a.disconnectTime&&void 0!==a.disconnectTime||(a.disconnectTime=0),this.hls=new ii(ke({softDecode:this.softDecode,isLive:n.isLive,media:this.player.video,startTime:n.startTime,url:n.url},a)),this.softDecode?e(!0):(ie.BasePlugin.defineGetterOrSetter(this.player,{url:{get:function(){var e,r;return null===(e=t.hls)||void 0===e||null===(r=e.media)||void 0===r?void 0:r.src},configurable:!0}}),this.hls.on("sourceAttached",(function(){e(!0)}))),this.softDecode&&(this.pluginExtension=new ai(ke({isLive:n.isLive,media:this.player.video},a),this),this.player.forceDegradeToVideo=function(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return null===(e=t.pluginExtension)||void 0===e?void 0:e.forceDegradeToVideo.apply(e,n)}),n.isLive&&(null===(i=this.player)||void 0===i||i.useHooks("replay",(function(){var e;return null===(e=t.hls)||void 0===e?void 0:e.replay()}))),this.on(ie.Events.URL_CHANGE,this._onSwitchURL),this.on(ie.Events.DESTROY,this.destroy),this._transError(),this._transCoreEvent(Kt.TTFB),this._transCoreEvent(Kt.LOAD_START),this._transCoreEvent(Kt.LOAD_RESPONSE_HEADERS),this._transCoreEvent(Kt.LOAD_COMPLETE),this._transCoreEvent(Kt.LOAD_RETRY),this._transCoreEvent(Kt.SOURCEBUFFER_CREATED),this._transCoreEvent(Kt.REMOVE_BUFFER),this._transCoreEvent(Kt.BUFFEREOS),this._transCoreEvent(Kt.KEYFRAME),this._transCoreEvent(Kt.METADATA_PARSED),this._transCoreEvent(Kt.SEI),this._transCoreEvent(Kt.SEI_IN_TIME),this._transCoreEvent(Kt.SPEED),this._transCoreEvent(Kt.HLS_MANIFEST_LOADED),this._transCoreEvent(kn.STREAM_PARSED),this._transCoreEvent(kn.NO_AUDIO_TRACK),this._transCoreEvent(Kt.HLS_LEVEL_LOADED),this._transCoreEvent(Kt.STREAM_EXCEPTION),this._transCoreEvent(Kt.SWITCH_URL_SUCCESS),this._transCoreEvent(Kt.SWITCH_URL_FAILED),n.url&&this.hls.load(n.url,!0).catch((function(e){})),r}},{key:"_transError",value:function(){var e=this;this.hls.on(kn.ERROR,(function(t){e.player&&e.player.emit(ie.Events.ERROR,new ie.Errors(e.player,t))}))}},{key:"_transCoreEvent",value:function(e){var t=this;this.hls.on(e,(function(r){t.player&&t.player.emit("core_event",ke(ke({},r),{},{eventName:e}))}))}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e){return ii.isSupported(e)}}]),r}(ie.BasePlugin);Le(li,"Hls",ii),Le(li,"EVENT",kn);var ui,ci={KDS:0,DRM:1},di={getBrowserVersion:function(){var e=navigator.userAgent;if(e.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(e.indexOf("Firefox")>-1)return"Firefox "+e.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Edge")>-1)return"Edge "+e.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("rv:11")>-1)return"IE 11";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1){if(e.indexOf("Opera")>-1)return"Opera "+e.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("OPR")>-1)return"Opera "+e.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0]}else{if(e.indexOf("Chrome")>-1)return"Chrome "+e.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Safari")>-1)return"Safari "+e.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];if(!(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1))return"Unknown";if(e.indexOf("MSIE")>-1)return"IE "+e.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];if(e.indexOf("Trident")>-1){var t=e.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+(parseInt(t)+4)}}},parseUrl:function(e){var t=e.split("?")[1],r={};return t&&t.split("&").forEach((function(e){e=e.split("="),r[e[0]]=decodeURIComponent(e[1])})),r},isBase64:function(e){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(e)},isRelativeURL:function(e){return!/^(?:[a-z]+:)?\/\//.test(e)},getAbsoluteURL:function(e){var t=new Image;return t.src=e,t.src},checkMediaSourceSupport:function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported},offInDestroy:function(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))},on:function(e,t,r,n){n?(e.on(t,r),di.offInDestroy(e,t,r,n)):e.on(t,(function n(i){r(i),e.off(t,n)}))},once:function(e,t,r,n){n?(e.once(t,r),di.offInDestroy(e,t,r,n)):e.once(t,(function n(i){r(i),e.off(t,n)}))},isMobile:function(){var e=!1;return navigator.userAgent.toLocaleLowerCase().indexOf("ipad")>-1?(navigator.userAgent.toLocaleLowerCase().indexOf("mobile")>-1&&"MacIntel"!==navigator.platform&&"Win32"!==navigator.platform||!di.checkMediaSourceSupport())&&(e=!0):navigator.userAgent.toLocaleLowerCase().indexOf("mobile")>-1&&"MacIntel"!==navigator.platform&&"Win32"!==navigator.platform&&!di.checkMediaSourceSupport()&&(e=!0),e}},hi=function(e){var t=e.url,r=e.method,n=void 0===r?"GET":r,i=e.type,a=e.timeout,o=void 0===a?1e4:a,s=e.body,l=e.xhrSetup,u=e.cache,c=void 0===u||u;return new Promise((function(e,r){var a=new window.XMLHttpRequest,u=n.toUpperCase();if("GET"!==u&&"POST"!==u)throw new Error("XHR "+u+" is not allowed");if(i&&(a.responseType=i),o&&(a.timeout=o),a.onload=function(){200===a.status||206===a.status?e(a):r(a)},a.onerror=function(){r(a)},a.ontimeout=function(){r(a)},a.onabort=function(){r(a)},"GET"===u&&!c){var d=/\?/gi.test(t)?"&":"?";t+=d+"_="+(new Date).getTime()}if(a.open(u,""+t,!0),l)try{l(a,t)}catch(h){console.error("xhr setup failure: "+(h.stack||h.message))}switch(u){case"POST":"text"===i&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(s);break;case"GET":a.send()}}))};function fi(e,t){return pi.apply(this,arguments)}function pi(){return(pi=se(ae().mark((function e(t,r){var n,i,a,o,s,l,u;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.config,i={},e.next=4,new hi({url:t,xhrSetup:function(e){n.netAllowCredentials&&(e.withCredentials=!0)}});case 4:return a=e.sent,(o=a.responseText).match(/#EXT-X-KEY:(\w+=\w+)+/)&&(s=o.match(/,URI="([^"]+)"/)[1],(l=di.parseUrl(s))&&l.ak&&("TOP"===n.getKeyType?(u=di.isBase64(n.keyToken)?window.atob(n.keyToken):n.keyToken,s="//"+(n.playDomain||"")+"?"+u+"&Source=jarvis&Ak="+l.ak):s=(n.keyDomain||"")+"/kds/api/v3/keys?source=jarvis&ak="+l.ak+"&token="+(n.keyToken||"")),i.keyUrl=s,i.responseText=o),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e,t,r){function n(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var i,a=0,o=[],s=[],l=parseInt(e.slice(0,8),16),u=parseInt(e.slice(8,16),16);if(1213091658!==l||1077891651!==u)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(i=0;i<4;++i)a+=(3&parseInt(e.slice(24+2*i,26+2*i),16))<<2*i;var c=parseInt(e.slice(32,40),16),d=2*parseInt(e.slice(48,56),16);for(i=56;i<d+56;i+=2)o.push(parseInt(e.slice(i,i+2),16));var h=d+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,i=0;i<f;++i){var p=n(e,h);h+=2*p[0];for(var y="",m=0;m<p[1];++m){var g=n(e,h);y+=String.fromCharCode(a^g[1]),h+=2*g[0]}s.push(y)}t.p=null,function e(t,r,n,i,a){var l,u,c,d,h,f=-1,p=[],y=[0,null],m=null,g=[r];for(u=Math.min(r.length,n),c=0;c<u;++c)g.push(r[c]);g.p=i;for(var v=[];;)try{var b=o[t++];if(b<37)if(b<13)b<5?b<3?p[++f]=1!==b&&null:3===b?(l=o[t++],p[++f]=l<<24>>24):(l=(o[t]<<8)+o[t+1],t+=2,p[++f]=l<<16>>16):b<8?5===b?(l=((l=((l=o[t++])<<8)+o[t++])<<8)+o[t++],p[++f]=(l<<8)+o[t++]):(l=(o[t]<<8)+o[t+1],t+=2,p[++f]=s[l]):b<11?p[++f]=void 0:11===b?p[++f]=a:(l=(o[t]<<8)+o[t+1],t+=2,f=f-l+1,u=p.slice(f,f+l),p[f]=u);else if(b<20)if(b<17)13===b?p[++f]={}:(l=(o[t]<<8)+o[t+1],t+=2,u=s[l],c=p[f--],p[f][u]=c);else if(b<18){for(u=o[t++],c=o[t++],d=g;u>0;--u)d=d.p;p[++f]=d[c]}else 18===b?(l=(o[t]<<8)+o[t+1],t+=2,u=s[l],p[f]=p[f][u]):(u=p[f--],p[f]=p[f][u]);else if(b<23)if(20===b){for(u=o[t++],c=o[t++],d=g;u>0;--u)d=d.p;d[c]=p[f--]}else l=(o[t]<<8)+o[t+1],t+=2,u=s[l],c=p[f--],d=p[f--],c[u]=d;else if(b<24){for(u=o[t++],c=o[t++],d=g,d=g;u>0;--u)d=d.p;p[++f]=d,p[++f]=c}else 24===b?(u=p[f--],p[f]+=u):(u=p[f--],p[f]=p[f]==u);else if(b<64)b<56?b<50?37===b?(u=p[f--],p[f]=p[f]===u):(u=p[f--],p[f]=p[f]!==u):b<52?p[f]=!p[f]:52===b?(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?t+=l:--f):(u=p[f--],(c=p[f--])[u]=p[f]):b<60?56===b?p[f]=void 0:(l=o[t++],u=p[f--],(c=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[u,l,g],c._u=e,p[++f]=c):b<61?(l=o[t++],u=p[f--],(d=[c=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)}]).p=g,c._v=[u,l,d],c._u=e,p[++f]=c):61===b?(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=v[v.length-1])[1]=t+l):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=v[v.length-1])&&!u[1]?(u[0]=3,u.push(t)):v.push([1,0,t]),t+=l);else if(b<69)if(b<66){if(64===b)throw u=p[f--];if(c=(u=v.pop())[0],d=y[0],1===c)t=u[1];else if(0===c)if(0===d)t=u[1];else{if(1!==d)throw y[1];if(!m)return y[1];t=m[1],a=m[2],g=m[3],v=m[4],p[++f]=y[1],y=[0,null],m=m[0]}else t=u[2],u[0]=0,v.push(u)}else if(b<67){for(u=p[f--],c=null;d=v.pop();)if(2===d[0]||3===d[0]){c=d;break}if(c)y=[1,u],t=c[2],c[0]=0,v.push(c);else{if(!m)return u;t=m[1],a=m[2],g=m[3],v=m[4],p[++f]=u,y=[0,null],m=m[0]}}else if(67===b)f-=l=o[t++],c=p.slice(f+1,f+l+1),u=p[f--],d=p[f--],u._u===e?(u=u._v,m=[m,t,a,g,v],t=u[0],null==d&&(d=function(){return this}()),a=d,(g=[c].concat(c)).length=Math.min(u[1],l)+1,g.p=u[2],v=[]):p[++f]=u.apply(d,c);else{for(l=o[t++],d=[void 0],h=l;h>0;--h)d[h]=p[f--];c=p[f--],u=Function.bind.apply(c,d),p[++f]=new u}else b<72?69===b?t+=2+(l=(l=(o[t]<<8)+o[t+1])<<16>>16):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=p[f--])||(t+=l)):b<73?(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,u=p[f--],p[f]===u&&(--f,t+=l)):73===b?--f:(u=p[f],p[++f]=u)}catch(_){for(y=[0,null];(l=v.pop())&&!l[0];);if(!l){e:for(;m;){for(u=m[4];l=u.pop();)if(l[0])break e;m=m[0]}if(!m)throw _;t=m[1],a=m[2],g=m[3],v=m[4],m=m[0]}1===(u=l[0])?(t=l[2],l[0]=0,v.push(l),p[++f]=_):2===u?(t=l[2],l[0]=0,v.push(l),y=[3,_]):(t=l[3],l[0]=2,v.push(l),p[++f]=_)}}(c,[],0,t,r)}("484e4f4a403f52430000310bd5e57f3d00000723d8a79448000007811101034a1200010b110000430242021102070211020643004a12000205000000383c02430143011401031101034a1200010b1100004302420211040643004a120003050000005a3c01110100020301030e0c00020c0001430442030147014811000112000411000107000535030048002d03064800aa03094800b9030b4800c9030c4800cd030e4800d303114800fb031248010607000648010049450106110202030038254700040d14020203011100011500051102021200074700121106004a120008110202120007430145000108140204110501070009263247000b03091100011500044500bb030611000115000411060c0d1102010e000a11020212000b34000307000c0e000b010e000d1102040e000e11020212000f0e000f440142110001120010140203030c110001150004450070030b11000115000411060105000001a93b024401421100011200101402030311110001150004450047030e1100011500051100014a07001713030143011100011500181106034a1200190700191100011200184302491100014a12001a07001b1102034302421100014a12001c43004245feb30842110702440014000311030212000b47000c11030212000b1100031500111100034a12001211030212000f3400030700131103014302491100034a12001411030443014905000001fb3b0011000315001608421101031200150400c82534000a1101031200150400ce2547000d0211010111010343014945000d0211010211010312001543014908421101054a1200010b110000430242021102070211020643004a12000205000002693c02430143011401051101054a1200010b1100004302420211040643004a120003050000028b3c0111010002030603100c00020c000143044203014701b8110001120004110001070005350300480028030448008c030d480131030e48013d03104801430313480170031448017b0700064801754945017b11020112001d14020311020212000a170204354911020212001e170205354911020212001f17020635490304110001150004021105021102040d0700200e000f0700210e000b0d0700220e00230d1102050e00241102060c00010e00250c00010e00260e0007430242110001120010140208110208120027140209030611000115000511020912002817020a35022347000603003845000611020a1200290300253247000b030d1100011500044500cb11020912002a1102051314020b11020b1102061314020c11020347002a1106044a12002b11020c430114020d0211060a11020d11020d12002c430214020e11020e14020745001111060d12002d07002e1811020c18140207030e11000115000445006807002f1106004a12000811020943011840031311000115000445004c03101100011500051100014a07001713030643011100011500181106051100011200181200303400061100011200184401401100014a12001a07001b1102074302421100014a12001c43004245fe4308421101074a1200010b110000430242021102070211020643004a12000205000004823c02430143011401071101074a1200010b1100004302420211040643004a12000305000004993c01110100430242030147014b1100011200041100010700053503004800140304480040030748012207000648011c49450122110201120031170203354911020112001d170204354911020212000a1402050304110001150004021105021102054301421100011200101402073e003114000211060b4a120032110207120033430147000911020712003345000f1106044a1200341102071200334301140206413d00971106004a12003511020712003343011402081102031200360700372547000f11020812003812003914020645006811020447005011020812003a14020902110609110209430117020a354911020a12003b17020b354911020a12003c17020c354911020a12003d17020d35490211060811020b11020c11020d430314020e11020e1402061106044a12003411020812003a4301140206411100014a12001a07001b1102064302421100014a12001c43004245feb008421101084a1200010b110000430242021102070211020643004a12000205000006233c02430143011401081101084a1200010b1100004302420211040643004a120003050000063a3c0111010043024203014700e2110001120004110001070005350300480023030348005f03054800780307480091030848009f03094800aa0700064800a4494500aa11020212003e11000115001811000112001811060d12002d25470005030345001711000112001811060d12003f25470005030545000203071100011500044500690211050411020111020243021402031100014a12001a07004003084302420211050611020111020243021402031100014a12001a07004003084302421106034a12001907004111020212003e4302491100014a12001a07001b1102034302421100014a12001c43004245ff19084205000000003b02140002050000000e3b0014000305000002313b02140004050000023f3b00140005050000044a3b0214000605000004583b0014000705000005eb3b0214010e05000005f93b0014000811010b4a1200004300140001084200421112100137071a02061007231007061c1a1b05140505190c041814071e0402071405041b100d01040507100303101b110705140c191a1411090601071c1b121c130c053c305544440300071904010c05100401100d01051614161d1004171a110c061810011d1a110406101b010c071006051a1b0610210c0510041a05101b031210010406101b1106060114010006061a1b191a141105161401161d020145051007071a07061417070005010607100100071b0406011a050c1c063b14011c0310381a111003031c11031e1c1104051a0601041f061a1b024747081107182a010c051003231c11043e1c11060f191c16101b06102a0710040010060108071006051a1b061009171406102a0710060504161a11100d0519140c2a191c16101b0610060414011a170619101b12011d03312738015818191c16101b061055071006051a1b0610551007071a074f55071810060614121006161a1b131c12081c063714061043410c071006051a1b061021100d010417011a140505140706100a1210013e100c210c051003213a2506271006001901092610160710013e100c041114011407101b1631140114031e100c021c0306060c06011018033e312605170710141e1102071a1b12551e100c55060c060110184f",{0:JSON,1:Promise,get 2(){return XMLHttpRequest},get 3(){return console},get 4(){return window},5:Error,get 6(){return ae},get 7(){return se},get 8(){return ye},get 9(){return ve},get 10(){return ge},get 11(){return di},get 12(){return hi},get 13(){return ci},get 14(){return ui},set 14(e){ui=e}},globalThis);var yi=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$b(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t,r){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,r){var n=r(12)("wks"),i=r(13),a=r(0).Symbol,o="function"==typeof a;(e.exports=function(e){return n[e]||(n[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=n},function(e,t,r){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,r){var n=r(4);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"==_typeof$b(Symbol.iterator)?function(e){return _typeof$b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$b(e)};e.exports=function(e){return"object"===(void 0===e?"undefined":n(e))?null!==e:"function"==typeof e}},function(e,t,r){var n=r(6);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){e.exports=!r(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,r){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,r){var n=r(3),i=r(26),a=r(27),o=Object.defineProperty;t.f=r(7)?Object.defineProperty:function(e,t,r){if(n(e),t=a(t,!0),n(r),i)try{return o(e,t,r)}catch(s){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!1},function(e,t,r){var n=r(8),i=r(1)("toStringTag"),a="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Object(e),i))?r:a?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){var n=r(2),i=r(0),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(10)?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,r){var n=r(9),i=r(28);e.exports=r(7)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,r){var n=r(4),i=r(0).document,a=n(i)&&n(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){var n=r(0),i=r(14),a=r(18),o=r(13)("src"),s=r(29),l=(""+s).split("toString");r(2).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var u="function"==typeof r;u&&(a(r,"name")||i(r,"name",t)),e[t]!==r&&(u&&(a(r,o)||i(r,o,e[t]?""+e[t]:l.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[o]||s.call(this)}))},function(e,t,r){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,r){e.exports={}},function(e,t,r){var n,i,a,o=r(5),s=r(38),l=r(39),u=r(16),c=r(0),d=c.process,h=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,y=c.Dispatch,m=0,g={},v=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){v.call(e.data)};h&&f||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return g[++m]=function(){s("function"==typeof e?e:Function(e),t)},n(m),m},f=function(e){delete g[e]},"process"==r(8)(d)?n=function(e){d.nextTick(o(v,e,1))}:y&&y.now?n=function(e){y.now(o(v,e,1))}:p?(a=(i=new p).port2,i.port1.onmessage=b,n=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(e){c.postMessage(e+"","*")},c.addEventListener("message",b,!1)):n="onreadystatechange"in u("script")?function(e){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),v.call(e)}}:function(e){setTimeout(o(v,e,1),0)}),e.exports={set:h,clear:f}},function(e,t,r){var n=r(6);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){e.exports=r(23)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(24);var n,i=(n=r(48))&&n.__esModule?n:{default:n};t.default={url:i.default},e.exports=t.default},function(e,t,r){var n,i,a,o,s=r(10),l=r(0),u=r(5),c=r(11),d=r(25),h=r(4),f=r(6),p=r(30),y=r(31),m=r(37),g=r(20).set,v=r(40)(),b=r(21),_=r(41),E=r(42),T=r(43),S=l.TypeError,$=l.process,A=$&&$.versions,w=A&&A.v8||"",k=l.Promise,I="process"==c($),C=function(){},P=i=b.f,x=!!function(){try{var e=k.resolve(1),t=(e.constructor={})[r(1)("species")]=function(e){e(C,C)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t&&0!==w.indexOf("6.6")&&-1===E.indexOf("Chrome/66")}catch(n){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var r=e._c;v((function(){for(var n=e._v,i=1==e._s,a=0,o=function(t){var r,a,o,s=i?t.ok:t.fail,l=t.resolve,u=t.reject,c=t.domain;try{s?(i||(2==e._h&&M(e),e._h=1),!0===s?r=n:(c&&c.enter(),r=s(n),c&&(c.exit(),o=!0)),r===t.promise?u(S("Promise-chain cycle")):(a=R(r))?a.call(r,l,u):l(r)):u(n)}catch(d){c&&!o&&c.exit(),u(d)}};r.length>a;)o(r[a++]);e._c=[],e._n=!1,t&&!e._h&&L(e)}))}},L=function(e){g.call(l,(function(){var t,r,n,i=e._v,a=D(e);if(a&&(t=_((function(){I?$.emit("unhandledRejection",i,e):(r=l.onunhandledrejection)?r({promise:e,reason:i}):(n=l.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=I||D(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){g.call(l,(function(){var t;I?$.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})}))},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},G=function e(t){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw S("Promise can't be resolved itself");(r=R(t))?v((function(){var i={_w:n,_d:!1};try{r.call(t,u(e,i,1),u(N,i,1))}catch(a){N.call(i,a)}})):(n._v=t,n._s=1,O(n,!1))}catch(i){N.call({_w:n,_d:!1},i)}}};x||(k=function(e){p(this,k,"Promise","_h"),f(e),n.call(this);try{e(u(G,this,1),u(N,this,1))}catch(t){N.call(this,t)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(44)(k.prototype,{then:function(e,t){var r=P(m(this,k));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=I?$.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&O(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=u(G,e,1),this.reject=u(N,e,1)},b.f=P=function(e){return e===k||e===o?new a(e):i(e)}),d(d.G+d.W+d.F*!x,{Promise:k}),r(45)(k,"Promise"),r(46)("Promise"),o=r(2).Promise,d(d.S+d.F*!x,"Promise",{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!x),"Promise",{resolve:function(e){return T(s&&this===o?k:this,e)}}),d(d.S+d.F*!(x&&r(47)((function(e){k.all(e).catch(C)}))),"Promise",{all:function(e){var t=this,r=P(t),n=r.resolve,i=r.reject,a=_((function(){var r=[],a=0,o=1;y(e,!1,(function(e){var s=a++,l=!1;r.push(void 0),o++,t.resolve(e).then((function(e){l||(l=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=P(t),n=r.reject,i=_((function(){y(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t,r){var n=r(0),i=r(2),a=r(14),o=r(17),s=r(5),l=function e(t,r,l){var u,c,d,h,f=t&e.F,p=t&e.G,y=t&e.P,m=t&e.B,g=p?n:t&e.S?n[r]||(n[r]={}):(n[r]||{}).prototype,v=p?i:i[r]||(i[r]={}),b=v.prototype||(v.prototype={});for(u in p&&(l=r),l)d=((c=!f&&g&&void 0!==g[u])?g:l)[u],h=m&&c?s(d,n):y&&"function"==typeof d?s(Function.call,d):d,g&&o(g,u,d,t&e.U),v[u]!=d&&a(v,u,h),y&&b[u]!=d&&(b[u]=d)};n.core=i,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,r){e.exports=!r(7)&&!r(15)((function(){return 7!=Object.defineProperty(r(16)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(4);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){e.exports=r(12)("native-function-to-string",Function.toString)},function(e,t,r){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(5),i=r(32),a=r(33),o=r(3),s=r(34),l=r(36),u={},c={},d=e.exports=function(e,t,r,d,h){var f,p,y,m,g=h?function(){return e}:l(e),v=n(r,d,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(a(g)){for(f=s(e.length);f>b;b++)if((m=t?v(o(p=e[b])[0],p[1]):v(e[b]))===u||m===c)return m}else for(y=g.call(e);!(p=y.next()).done;)if((m=i(y,v,p.value,t))===u||m===c)return m};d.BREAK=u,d.RETURN=c},function(e,t,r){var n=r(3);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(o){var a=e.return;throw void 0!==a&&n(a.call(e)),o}}},function(e,t,r){var n=r(19),i=r(1)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[i]===e)}},function(e,t,r){var n=r(35),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,r){var n=r(11),i=r(1)("iterator"),a=r(19);e.exports=r(2).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[n(e)]}},function(e,t,r){var n=r(3),i=r(6),a=r(1)("species");e.exports=function(e,t){var r,o=n(e).constructor;return void 0===o||null==(r=n(o)[a])?t:i(r)}},function(e,t,r){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(0).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(0),i=r(20).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,l="process"==r(8)(o);e.exports=function(){var e,t,r,u=function(){var n,i;for(l&&(n=o.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(a){throw e?r():t=void 0,a}}t=void 0,n&&n.enter()};if(l)r=function(){o.nextTick(u)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var c=s.resolve(void 0);r=function(){c.then(u)}}else r=function(){i.call(n,u)};else{var d=!0,h=document.createTextNode("");new a(u).observe(h,{characterData:!0}),r=function(){h.data=d=!d}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},function(e,t,r){var n=r(0).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(3),i=r(4),a=r(21);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(17);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){var n=r(9).f,i=r(18),a=r(1)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){var n=r(0),i=r(9),a=r(7),o=r(1)("species");e.exports=function(e){var t=n[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1)("iterator"),i=!1;try{var a=[7][n]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(o){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:r=!0}},a[n]=function(){return o},e(a)}catch(s){}return r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==_typeof$b(Symbol.iterator)?function(e){return _typeof$b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$b(e)};t.default=function(e,t,r){if(e&&t){var i=void 0;try{i=(0,a.getUri)(e,t,r)}catch(s){return Promise.reject(s.message)}return new o.default({type:"json",method:"GET",url:i}).then((function(e){return e&&e.response?"string"==typeof e.response?JSON.parse(e.response).Result:"object"===n(e.response)?e.response.Result:e.response:e}))}return Promise.reject("vid, host and token can't be empty")};var i,a=r(49),o=(i=r(51))&&i.__esModule?i:{default:i};e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getUri=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{e=JSON.parse((0,n.decode)(e))}catch(s){throw new Error("base64 decode error: "+s.message)}var i=[];for(var a in r)i.push(a+"="+r[a]);var o=(/^http/.test(t)?t:"//"+t)+"?"+e.GetPlayInfoToken+"&ssl=true";return i.length>0&&(o+="&"+i.join("&")),o};var n=r(50)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.decode=function(e){var t,r,n,i,a,o,s,l=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];for(o=e.length,a=0,s="";a<o;){do{t=l[255&e.charCodeAt(a++)]}while(a<o&&-1===t);if(-1===t)break;do{r=l[255&e.charCodeAt(a++)]}while(a<o&&-1===r);if(-1===r)break;s+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(a++)))return s;n=l[n]}while(a<o&&-1===n);if(-1===n)break;s+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(i=255&e.charCodeAt(a++)))return s;i=l[i]}while(a<o&&-1===i);if(-1===i)break;s+=String.fromCharCode((3&n)<<6|i)}return s}},function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,i=t.method,a=void 0===i?"GET":i,o=(t.type,t.data),s=void 0===o?{}:o,l=t.headers,u=void 0===l?{}:l;return n(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,i=a.toUpperCase(),o=[];for(var l in s)o.push(l+"="+s[l]);if("GET"!==i)throw new Error("xhr "+i+" is not supported");for(var c in n.open(i,""+r,!0),n.responseType="",u)n.setRequestHeader(c,""+u[c]);n.send(),n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)},n.ontimeout=function(){t(n)}}))},e.exports=t.default}]);function mi(e,t){return gi.apply(this,arguments)}function gi(){return(gi=se(ae().mark((function e(t,r){return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){yi.url(t,r).then((function(t){var r=[],n=(null==t?void 0:t.Data)||t;n&&n.PlayInfoList&&n.PlayInfoList.length>0?(r=n.PlayInfoList,e({videoList:r,vid:n.VideoID,rawData:t})):(console.error("HAS NO VIDEO INFORMATION CORRECTLY, PLEASE CHECK THE TOKEN."),e({videoList:[],rawData:t}))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vi(e){if(e.sort((function(e,t){return t.Bitrate-e.Bitrate})),e[0].Bitrate){var t=0;e.every((function(r,n){return e[0].Bitrate===r.Bitrate&&(t=n,!0)})),t>0&&e.splice(t)}return e}function bi(e,t,r){if(r||(r=[]),e.sort((function(e,t){return t.Bitrate-e.Bitrate})),e[0].Bitrate){var n=0;e.every((function(t,r){return e[0].Bitrate===t.Bitrate&&(n=r,!0)})),n>0&&e.splice(n)}e.map((function(e){var t,n,i={name:e.Definition||"",definition:e.Definition,url:e.MainPlayUrl||e.src,backupUrl:e.BackupPlayUrl,bitrate:e.Bitrate,size:e.size,kid:e.PlayAuthID},a=function(e){for(var t=0;t<r.length;t++)if(e.Definition.toLocaleLowerCase()===r[t].definition.toLocaleLowerCase())return t;return-1}(e);return a>=0?(t=i,(n=r[a])||(n=t),Object.keys(t).map((function(e){n[e]=t[e]}))):r.push(i),{name:e.Definition||"",text:e.Definition,definition:e.Definition,url:e.MainPlayUrl||e.src,backupUrl:e.BackupPlayUrl,bitrate:e.Bitrate,size:e.size,selected:!1}}));var i=-1;if(t)for(var a=0;a<e.length;a++)e[a].Definition.toLocaleLowerCase()===t.toLocaleLowerCase()&&(i=a);return i<0&&(i=0),r[i]&&(r[i].selected=!0),{index:i,list:r}}var _i=function(){function e(){this.timeID=null,this.func=null}var t=e.prototype;return t.repeat=function(e,t){var r=this;null===this.func&&(this.func=e),this.func===e&&(this.timeID=setTimeout((function(){e(),r.repeat(e,t)}),t))},t.clear=function(){clearTimeout(this.timeID)},e}();function Ei(e,t,r){function n(e,t){var r=parseInt(e.slice(t,t+2),16);return r>>>7==0?[1,r]:r>>>6==2?(r=(63&r)<<8,[2,r+=parseInt(e.slice(t+2,t+4),16)]):(r=(63&r)<<16,[3,r+=parseInt(e.slice(t+2,t+6),16)])}var i,a=0,o=[],s=[],l=parseInt(e.slice(0,8),16),u=parseInt(e.slice(8,16),16);if(1213091658!==l||1077891651!==u)throw new Error("mhe");if(0!==parseInt(e.slice(16,18),16))throw new Error("ve");for(i=0;i<4;++i)a+=(3&parseInt(e.slice(24+2*i,26+2*i),16))<<2*i;var c=parseInt(e.slice(32,40),16),d=2*parseInt(e.slice(48,56),16);for(i=56;i<d+56;i+=2)o.push(parseInt(e.slice(i,i+2),16));var h=d+56,f=parseInt(e.slice(h,h+4),16);for(h+=4,i=0;i<f;++i){var p=n(e,h);h+=2*p[0];for(var y="",m=0;m<p[1];++m){var g=n(e,h);y+=String.fromCharCode(a^g[1]),h+=2*g[0]}s.push(y)}return t.p=null,function e(t,r,n,i,a){var l,u,c,d,h,f=-1,p=[],y=[0,null],m=null,g=[r];for(u=Math.min(r.length,n),c=0;c<u;++c)g.push(r[c]);g.p=i;for(var v=[];;)try{var b=o[t++];if(b<41)if(b<14)b<8?b<5?(l=o[t++],p[++f]=l<<24>>24):5===b?(l=((l=((l=o[t++])<<8)+o[t++])<<8)+o[t++],p[++f]=(l<<8)+o[t++]):(l=(o[t]<<8)+o[t+1],t+=2,p[++f]=s[l]):b<12?p[++f]=8===b?void 0:a:12===b?(l=(o[t]<<8)+o[t+1],t+=2,f=f-l+1,u=p.slice(f,f+l),p[f]=u):p[++f]={};else if(b<19)if(b<17)l=(o[t]<<8)+o[t+1],t+=2,u=s[l],c=p[f--],p[f][u]=c;else if(17===b){for(u=o[t++],c=o[t++],d=g;u>0;--u)d=d.p;p[++f]=d[c]}else l=(o[t]<<8)+o[t+1],t+=2,u=s[l],p[f]=p[f][u];else if(b<24)if(19===b)u=p[f--],p[f]=p[f][u];else{for(u=o[t++],c=o[t++],d=g;u>0;--u)d=d.p;d[c]=p[f--]}else 24===b?(u=p[f--],p[f]+=u):(u=p[f--],p[f]=p[f]!==u);else if(b<66)if(b<59)b<51?(u=p[f--],p[f]=p[f]>u):51===b?(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?--f:t+=l):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,p[f]?t+=l:--f);else if(b<62)59===b?(l=o[t++],u=p[f--],(c=function e(){var t=e._v;return(0,e._u)(t[0],arguments,t[1],t[2],this)})._v=[u,l,g],c._u=e,p[++f]=c):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=v[v.length-1])[1]=t+l);else if(62===b)l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=v[v.length-1])&&!u[1]?(u[0]=3,u.push(t)):v.push([1,0,t]),t+=l;else if(c=(u=v.pop())[0],d=y[0],1===c)t=u[1];else if(0===c)if(0===d)t=u[1];else{if(1!==d)throw y[1];if(!m)return y[1];t=m[1],a=m[2],g=m[3],v=m[4],p[++f]=y[1],y=[0,null],m=m[0]}else t=u[2],u[0]=0,v.push(u);else if(b<69)if(b<67){for(u=p[f--],c=null;d=v.pop();)if(2===d[0]||3===d[0]){c=d;break}if(c)y=[1,u],t=c[2],c[0]=0,v.push(c);else{if(!m)return u;t=m[1],a=m[2],g=m[3],v=m[4],p[++f]=u,y=[0,null],m=m[0]}}else if(67===b)f-=l=o[t++],c=p.slice(f+1,f+l+1),u=p[f--],d=p[f--],u._u===e?(u=u._v,m=[m,t,a,g,v],t=u[0],null==d&&(d=function(){return this}()),a=d,(g=[c].concat(c)).length=Math.min(u[1],l)+1,g.p=u[2],v=[]):p[++f]=u.apply(d,c);else{for(l=o[t++],d=[void 0],h=l;h>0;--h)d[h]=p[f--];c=p[f--],u=Function.bind.apply(c,d),p[++f]=new u}else b<73?69===b?t+=2+(l=(l=(o[t]<<8)+o[t+1])<<16>>16):(l=(l=(o[t]<<8)+o[t+1])<<16>>16,t+=2,(u=p[f--])||(t+=l)):73===b?--f:(u=p[f],p[++f]=u)}catch(_){for(y=[0,null];(l=v.pop())&&!l[0];);if(!l){e:for(;m;){for(u=m[4];l=u.pop();)if(l[0])break e;m=m[0]}if(!m)throw _;t=m[1],a=m[2],g=m[3],v=m[4],m=m[0]}1===(u=l[0])?(t=l[2],l[0]=0,v.push(l),p[++f]=_):2===u?(t=l[2],l[0]=0,v.push(l),y=[3,_]):(t=l[3],l[0]=2,v.push(l),p[++f]=_)}}(c,[],0,t,r)}var Ti=function(e){function t(){for(var t,r,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=e.call.apply(e,[this].concat(i))||this)._onSwitchURL=(r=se(ae().mark((function e(r){var n,i,a,o;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=fe(t),i=n.player,a=i.currentTime,o=i.paused,i.config.url=r,t._addLoading(),e.next=7,t._start(r,a);case 7:return e.abrupt("return",new Promise((function(e){var r=function(){t._removeLoading(),o?i.once("playing",(function(){i.pause(),e()})):e()};ie.Sniffer.os.isAndroid?i.once("timeupdate",(function(){r()})):i.once("canplay",(function(){r()}))})));case 8:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)}),t}ue(t,e);var r,n,i,a,o,s,l,u,c=t.prototype;return c.beforePlayerInit=function(){var t=this,r=this.config,n=this.player,i=n.config,a=di.isMobile();this.onTimeupdate=this.onTimeupdate.bind(this),this.__startInit=null,this.__playNext=null,this.isNativeMode=!0,this._errReqCount=0,this.getUrlTime=(new Date).getTime()/1e3,this.hlsOpts=r.hlsOpts||{},r.hlsLoadAsync=!1,i.hls||(i.hls={}),i.hls.fetchOptions||(i.hls.fetchOptions={}),a||void 0!==r.useHls&&!r.useHls||(this.isNativeMode=!1,this.register()),n.playNext=this.playNext.bind(this),this.isNativeMode||i.hls.decryptor||(i.hls.decryptor=new pe({enableSoftwareAES:this.hlsOpts.enableSoftwareAES})),r.netAllowCredentials&&(i.hls.fetchOptions.credentials="include"),r.checkHlsOffline&&di.on(this,"timeupdate",this.onTimeupdate,"destroy"),this.hlsTimer=new _i,this.hlsTimer.repeat((function(){t.onRepeat()}),r.checkExpireInterval),this._proxyPlayerStartInit(),this._checkNativeCode()?(i.url&&(r.url=i.url,i.url=""),e.prototype.beforePlayerInit.call(this)):this.player.switchURL=this._onSwitchURL},c.destroy=function(){e.prototype.destroy.call(this),this.hlsTimer&&(this.hlsTimer.clear(),this.hlsTimer=null),this.player._startInit=this.__startInit,this.player.playNext=this.__playNext,this._playOriginalUrl=null},c.log=function(){var e;this.player.logInfo&&(e=this.player).logInfo.apply(e,arguments)},c._addLoading=function(){ie.Util.addClass(this.player.root,"xgplayer-is-enter")},c._removeLoading=function(){ie.Util.removeClass(this.player.root,"xgplayer-is-enter")},c._checkNativeCode=function(){var e=this.player,t=self.MediaSource||self.WebKitMediaSource,r=self.SourceBuffer,n=!1;if(t&&r){var i=[];r&&(i.push(r),i.push(r.prototype.appendBuffer)),t&&(i.push(t),i.push(t.prototype.addSourceBuffer)),me(i)?n=!0:e.emit("error",{msg:"MediaSource or SourceBuffer hijack",errorCode:-9995})}return n},c._proxyPlayerStartInit=function(){var e=this;this.__startInit=this.player._startInit,this.__playNext=this.player.playNext,this.player._startInit=function(){e._start()}},c._start=(r=se(ae().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h,f;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=null),void 0===r&&(r=null),n=this.player,e.prev=3,t){e.next=12;break}return e.next=7,this._getRawManifest();case 7:if((i=e.sent).url){e.next=10;break}throw new Error("no service url");case 10:t=i.url,this._rawManifestInfo=i;case 12:if(a={},!this._rawManifestInfo){e.next=26;break}if(o=this._rawManifestInfo,s=o.url,l=o.vid,u=o.videoList,!Array.isArray(u)){e.next=26;break}c=0;case 17:if(!(c<u.length)){e.next=26;break}if((d=u[c]).url!==s){e.next=23;break}return a.vid=l,a.kid=d.kid,e.abrupt("break",26);case 23:c++,e.next=17;break;case 26:return this._playOriginalUrl=n.config.url=t,e.next=29,this._getTransformManifestUrl(t,a);case 29:h=e.sent,n.config.url=h.url,e.next=36;break;case 33:return e.prev=33,e.t0=e.catch(3),e.abrupt("return",n.emit("error",{msg:e.t0.message,errorCode:-9996,errorStack:e.t0.stack}));case 36:this.isNativeMode||(f=this.player.config.url,r?this.hls.switchURL(f,r):this.hls.load(f)),this.__startInit.call(this.player,this.player.config.url);case 38:case"end":return e.stop()}}),e,this,[[3,33]])}))),function(e,t){return r.apply(this,arguments)}),c._getRawManifest=(n=se(ae().mark((function e(){var t,r,n,i,a,o,s,l,u=this;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,r=this.playerConfig,n=t.vid,i=t.playAuthToken,a=t.playDomain,o=t.testUrl,s=t.testUrlExpire,l={url:t.url||r.url,playAuthToken:i,vid:n,playDomain:a,testUrl:o,testUrlExpire:s},e.abrupt("return",new Promise((function(e,t){l.url&&(/\.(mp3|m4a)/.test(l.url)||/(mp3|m4a)/.test(l.type))||l.url?(u.emit("can_start"),e({url:l.url})):(i||l.vid)&&u._playByToken(i,a,e,t)})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),c._playByToken=(i=se(ae().mark((function e(t,r,n,i){var a,o,s,l,u,c,d,h,f,p,y,m,g;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.player,o=this.config,e.next=3,mi(t,r);case 3:s=e.sent,l=s.vid,u=s.videoList,c=s.rawData,this.emit("get_play_info",c),u&&u.length>0&&(u[0].MainPlayUrl||u[0].src)?(vi(u),this.getUrlTime=(new Date).getTime()/1e3,d=a.config.definition||{},h=d.defaultDefinition||a.config.defaultDefinition,u[0].Format,u[0].UrlExpire&&(this.urlExpireTimestamp=o.testUrlExpire||u[0].UrlExpire),f=bi(u,h,d.list),p=f.list[f.index],y=p.url,a.curDefinition=p,a.emit("resourceReady",f.list),u[0]&&u[0].type&&/(mp3|m4a|mp4)/.test(u[0].type),this.emit("can_start"),n({url:y,vid:l,videoList:f.list})):(m=(c||{ResponseMetadata:{Error:{CodeN:0,Message:""},RequestId:""}}).ResponseMetadata,this.emit("playInterfaceInfo",{code:m.Error.CodeN,message:m.Error.Message,logid:m.RequestId}),g={msg:"HAS NO VIDEO INFORMATION CORRECTLY, PLEASE CHECK THE TOKEN.",errorCode:-9998},this.emit("error",g),i(g));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return i.apply(this,arguments)}),c._getTransformManifestUrl=(a=se(ae().mark((function e(t,r){var n;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),e.next=3,this._loadSource(t,r);case 3:if("string"!=typeof(n=e.sent)){e.next=8;break}return e.abrupt("return",{url:n});case 8:return e.abrupt("return",new Promise((function(e){var t=new FileReader;t.onload=function(){e({url:t.result})},t.readAsDataURL(n)})));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)}),c.playNext=function(e){var t=this,r=this.player,n=r.paused;r.pause(),r.hasStart=!1,r._startInit=this.__startInit,r.playNext=this.__playNext,["url","vid","kid","playAuthToken","keyToken"].forEach((function(e){t.config[e]=void 0})),this.playerConfig.url=void 0,Object.keys(e).map((function(r){r.toLocaleLowerCase()===t.pluginName.toLocaleLowerCase()?"Object"===ie.Util.typeOf(e[r])&&Object.keys(e[r]).map((function(n){t.config[n]=e[r][n]})):t.playerConfig[r]=e[r]})),this._errReqCount=0,this.getUrlTime=(new Date).getTime()/1e3,this.playerConfig.autoplay="boolean"==typeof e.autoplay?e.autoplay:!n,this._start()},c._processRetData=function(e,t,r,n){if(e.sort((function(e,t){return t.Bitrate-e.Bitrate})),e[0].Bitrate){var i=0;e.every((function(t,r){return e[0].Bitrate===t.Bitrate&&(i=r,!0)})),i>0&&e.splice(i)}},c.onTimeupdate=function(){this.hls&&this.player.video&&!this.player.video.videoHeight?(this.hls.hlsOfflineCount=void 0===this.hls.hlsOfflineCount?1:this.hls.hlsOfflineCount+1,this.hls.hlsOfflineCount>3&&(this.pause(),this.emit("error",{msg:"OFFLINE",errorCode:-9997}),this.onError())):this.hls&&(this.hls.hlsOfflineCount=0)},c.onRepeat=function(){var e=this,t=this.config,r=this.player;t.expireDetectType.indexOf("getUrlTime")>-1&&this.getUrlTime&&r.duration&&(new Date).getTime()/1e3>this.getUrlTime+3300+r.duration&&(this.getUrlTime=0,this.emitExpireEvent()),t.expireDetectType.indexOf("xhrStatus")>-1&&this._playOriginalUrl&&Math.random()<1/7.5&&new hi({url:this._playOriginalUrl,xhrSetup:function(e,r){t.netAllowCredentials&&(e.withCredentials=!0)}}).catch((function(t){t&&void 0!==t.status&&(e.hls.hlsExpireCount=void 0===e.hls.hlsExpireCount?1:e.hls.hlsExpireCount+1,e.hls.hlsExpireCount>3&&(e.hls.hlsExpireCount=0,e.emitExpireEvent()))})),t.expireDetectType.indexOf("urlExpire")>-1&&this.urlExpireTimestamp&&(new Date).getTime()/1e3>=this.urlExpireTimestamp&&(this.urlExpireTimestamp=5e9,this.emitExpireEvent())},c.emitExpireEvent=function(){var e=this.player,t=(new Date).getTime()/1e3;e.emitExpireTimestamp?t-e.emitExpireTimestamp>300&&(e.emitExpireTimestamp=t,e.emit("MEDIA_EXPIRED")):(e.emitExpireTimestamp=t,e.emit("MEDIA_EXPIRED"))},c._updateM3U8=function e(t,r,n){return Ei("484e4f4a403f524300382e0f735e3e1900000045ad753e400000022311020b07001c44014a12001d11000443014700131100021100031807001e18110004184245001c1100021100031807001e181102064a12001f1101071100044302184208420b1200001400010b1200011200020700032633000a11010a1101011200042647000f1101024a12000511010943011401093e004014000c11010212000634000611010212000734000611010212000814000311000344001400021100024a1200091101094301491100024a12000a4300140002413d00161101031101090c00010d07000b0e000c4402140002411101044a12000d11000243011400041101084a12000e11010b07000f4401070010110004180700111843021401081101054a12001211000112000112001343014700151101054a12001411000112000112001343014500091100011200011200131400051100054a12001511010b070016440143013400030c000014000611000547001f11000612001703012947000d110006030113070018184500030700194500030700191400071101084a12000e11010b07001a07001b440205000000003b0443021401083e004014000d11010212000634000611010212000734000611010212000814000911000944001400081100084a1200091101084301491100084a12000a4300140008413d00161101031101080c00010d0700200e000c4402140008411101054a120021430014000a11000a470007110008424500131101044a12000d110008430114000b11000b4208420022061b070a120e19060804050d020c0a0c0e1f200e123f121b0e033f243b032f3926040a1f04090b29070409291e02070f0e19113c0e0920021f29070409291e02070f0e190e26041129070409291e02070f0e19060a1b1b0e050f070c0e1f29070409091f0e131f44031f0607041f121b0e0f08190e0a1f0e2409010e081f3e392707190e1b070a080e0e473e39225649433035493640424906473e3922564901490d0218390e070a1f021d0e3e3927031e19070e0c0e1f2a091804071e1f0e3e392705060a1f0803204343031f1f1b17031f1f1b18425154374437444540423744371c403745371c4006070e050c1f030144003a43482e333f22252d514243370f40374554370f41424354514743545130353719173705364142435451371917370542414243454143544a484242010c1443031f1f1b17031f1f1b18425437515437443744041f0e181f02476110091e02070f2a091804071e1f0e3e3927150a1b1b0702080a1f020405441346061b0e0c3e392708021826040902070e",{get 0(){return e},get 1(){return ci},get 2(){return window},get 3(){return Blob},get 4(){return URL},get 5(){return di},get 6(){return Ae},7:arguments,8:t,9:r,10:n,11:RegExp},this)},c._loadSource=(o=se(ae().mark((function e(t,r){var n,i,a,o,s,l,u,c;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),n=this.player,i=this.config,e.next=4,fi(t,this);case 4:if((o=e.sent)&&o.keyUrl){e.next=7;break}return e.abrupt("return",n.config.url);case 7:if(s=o.keyUrl,l=o.responseText,!i.keyValue){e.next=12;break}a=this._updateM3U8(l,i.keyValue),e.next=27;break;case 12:if(!i.getLicenseUrl||!(r.vid&&r.kid||i.vid&&i.kid)){e.next=19;break}return e.next=15,ui(this,{system:ci.DRM,url:i.getLicenseUrl,vid:r.vid||i.vid,kid:r.kid||i.kid});case 15:u=e.sent,a=this._updateM3U8(l,u,ci.DRM),e.next=27;break;case 19:if(!i.keyToken||!("TOP"===i.getKeyType?i.playDomain:i.keyDomain)){e.next=26;break}return e.next=22,ui(this,{system:ci.KDS,url:s});case 22:c=e.sent,a=this._updateM3U8(l,c,ci.KDS),e.next=27;break;case 26:throw new Error("There is no available ways for encrypt hls to generate manifest url");case 27:return e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ei("484e4f4a403f524300222c1440b2f1880000000034493c160000000e1101004a1200000b1101014302420001057968687461",{get 0(){return o},1:arguments,2:e,3:t},this)}),c.register=function(){var e=this.player;e.once("playing",(function(){var t=!1,r=e.video.querySelector("track");r&&("hidden"===r.track.mode&&(t=!0),r.track.mode="hidden",e.video.removeChild(r)),e.config.textTrack&&e.config.textTrack.length>0&&e.config.textTrack.some((function(r){if(r.src&&r.label&&r.default){var n=document.createElement("track");return n.src=r.src,n.kind=r.kind,n.label=r.label,n.srclang=r.srclang,n.default=!0,e.video.appendChild(n),t&&(n.track.mode="hidden"),!0}}))}))},s=t,u=[{key:"pluginName",get:function(){return"EncryptHlsPlugin"}},{key:"defaultConfig",get:function(){return{expireDetectType:[],hlsOpts:{},checkExpireInterval:400,type:"",playAuthToken:"",vid:"",checkHlsOffline:!1,getLicenseUrl:""}}},{key:"version",get:function(){return"4.0.3"}}],(l=[{key:"versionNum",get:function(){return this.version&&this.version[0]&&parseInt(this.version[0])}}])&&le(s.prototype,l),u&&le(s,u),Object.defineProperty(s,"prototype",{writable:!1}),t}(li);return Ti.isSupported=function(e){e=e||navigator.userAgent.toLocaleLowerCase();var t=/(iphone)/.test(e)||/(ipad)/.test(e),r=/(android)/.test(e),n=/(windows phone)/.test(e),i=!(t||r||n),a=/(quark)/.test(e);return i||r?!(!window.MediaSource||!window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')):!!t&&!a&&!(e.indexOf("iphone os 11_4")>-1||e.indexOf("iphone os 11_2")>-1)},Ti}(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,require$$58)}(index_min$1);var EncryptHlsPlugin=getDefaultExportFromCjs(index_min$1.exports),_ERR_CODE$1;function ownKeys$8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$5(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$8(Object(r),!0).forEach((function(t){_defineProperty$8(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$8(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$5(){_regeneratorRuntime$5=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(w){s=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var i,a,o,s,l=t&&t.prototype instanceof d?t:d,h=Object.create(l.prototype),f=new S(n||[]);return h._invoke=(i=e,a=r,o=f,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return{value:void 0,done:!0}}for(o.method=e,o.arg=t;;){var r=o.delegate;if(r){var n=_(r,o);if(n){if(n===c)continue;return n}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===s)throw s="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);s="executing";var l=u(i,a,o);if("normal"===l.type){if(s=o.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(s="completed",o.method="throw",o.arg=l.arg)}}),h}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(w){return{type:"throw",arg:w}}}e.wrap=l;var c={};function d(){}function h(){}function f(){}var p={};s(p,i,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y($([])));m&&m!==t&&r.call(m,i)&&(p=m);var g=f.prototype=d.prototype=Object.create(p);function v(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(i,a,o,s){var l=u(e[i],e,a);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,c;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function $(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=f,s(g,"constructor",f),s(f,"constructor",h),h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},v(b.prototype),s(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new b(l(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(g),s(g,o,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=$,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:$(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},e}function _typeof$5(e){return(_typeof$5="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$7(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$7(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$7(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$7(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$8(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$9(e,t,r){return t&&_defineProperties$9(e.prototype,t),r&&_defineProperties$9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$8(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$5(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$5(e,t)}function _getPrototypeOf$5(e){return(_getPrototypeOf$5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$5(e,t){return(_setPrototypeOf$5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$8(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$2(e,t,r){return(_construct$2=_isNativeReflectConstruct$8()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$5(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$2(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$2(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$2=function(e){if(null===e||!_isNativeFunction$2(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$2(e,arguments,_getPrototypeOf$5(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$5(r,e)},_wrapNativeSuper$2(e)}function _objectWithoutPropertiesLoose$2(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$2(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$2(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$5(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$5(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$5(e)}function _createSuper$8(e){var t=_isNativeReflectConstruct$8();return function(){var r,n=_getPrototypeOf$5(e);if(t){var i=_getPrototypeOf$5(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$5(this,r)}}function _unsupportedIterableToArray$6(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$6(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$6(e,t):void 0}}function _arrayLikeToArray$6(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper$1(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$6(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function createPublicPromise$2(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}var ERR$1={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",OPTION:"OPTION"}},ERR_CODE$1=(_ERR_CODE$1={},_defineProperty$8(_ERR_CODE$1,ERR$1.MANIFEST,{HLS:1100}),_defineProperty$8(_ERR_CODE$1,ERR$1.NETWORK,2100),_defineProperty$8(_ERR_CODE$1,ERR$1.NETWORK_TIMEOUT,2101),_defineProperty$8(_ERR_CODE$1,ERR$1.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),_defineProperty$8(_ERR_CODE$1,ERR$1.REMUX,{FMP4:4100,MP4:4200}),_defineProperty$8(_ERR_CODE$1,ERR$1.MEDIA,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202}),_defineProperty$8(_ERR_CODE$1,ERR$1.OTHER,8e3),_ERR_CODE$1),StreamingError$1=function(e){_inherits$5(r,e);var t=_createSuper$8(r);function r(e,n,i,a,o){var s;return _classCallCheck$8(this,r),(s=t.call(this,o||(null==i?void 0:i.message))).errorType=e===ERR$1.NETWORK_TIMEOUT?ERR$1.NETWORK:e,s.originError=i,s.ext=a,s.errorCode=ERR_CODE$1[e][n]||ERR_CODE$1[e],s.errorMessage=s.message,s.errorCode||(s.errorType=ERR$1.OTHER,s.errorCode=ERR_CODE$1[s.errorType]),s}return _createClass$9(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=ERR$1.OTHER),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!=e&&e.isTimeout?ERR$1.NETWORK_TIMEOUT:ERR$1.NETWORK,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(_wrapNativeSuper$2(Error)),LoaderType$1={FETCH:"fetch",XHR:"xhr"},ResponseType$1={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},NetError$1=function(e){_inherits$5(r,e);var t=_createSuper$8(r);function r(e,n,i,a){var o;return _classCallCheck$8(this,r),_defineProperty$8(_assertThisInitialized$5(o=t.call(this,a)),"retryCount",0),_defineProperty$8(_assertThisInitialized$5(o),"isTimeout",!1),_defineProperty$8(_assertThisInitialized$5(o),"loaderType",LoaderType$1.FETCH),_defineProperty$8(_assertThisInitialized$5(o),"startTime",0),_defineProperty$8(_assertThisInitialized$5(o),"endTime",0),o.url=e,o.request=n,o.response=i,o}return _createClass$9(r)}(_wrapNativeSuper$2(Error)),toString$5=Object.prototype.toString;function isObject$2(e){return null!==e&&"object"===_typeof$5(e)}function isPlainObject$1(e){if("[object Object]"!==toString$5.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate$1(e){return"[object Date]"===toString$5.call(e)}function getRangeValue$1(e){if(e&&null!=e[0]&&(0!==e[0]||null!=e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode$1(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams$1(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate$1(t)?t=t.toISOString():isObject$2(t)&&(t=JSON.stringify(t)),"".concat(encode$1(e),"=").concat(encode$1(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse$1(e,t,r,n,i,a){return n=null!=n?parseFloat(n):null,r=parseInt(r||"0",10),isNaN(r)&&(r=0),{data:e,response:t,contentLength:r,age:n,startTime:i,firstByteTime:a,endTime:Date.now()}}var FetchLoader$1=function(){function e(){_classCallCheck$8(this,e),_defineProperty$8(this,"_abortController",null),_defineProperty$8(this,"_timeoutTimer",null),_defineProperty$8(this,"_reader",null),_defineProperty$8(this,"_response",null),_defineProperty$8(this,"_aborted",!1)}var t;return _createClass$9(e,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.timeout,a=e.responseType,o=e.onProgress,s=e.onTimeout,l=e.range,u=e.transformResponse,c=e.request,d=e.params,h=e.method,f=e.headers,p=e.body,y=e.mode,m=e.credentials,g=e.cache,v=e.redirect,b=e.referrer,_=e.referrerPolicy;this._aborted=!1,this._abortController="undefined"!=typeof AbortController&&new AbortController;var E={method:h,headers:f,body:p,mode:y,credentials:m,cache:g,redirect:v,referrer:b,referrerPolicy:_,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},T=!1;clearTimeout(this._timeoutTimer),n=setUrlParams$1(n,d);var S=getRangeValue$1(l);S&&((f=c?c.headers:E.headers=E.headers||new Headers)instanceof Headers?f.append("Range",S):f.Range=S),i&&(this._timeoutTimer=setTimeout((function(){if(T=!0,r.cancel(),s){var e=new NetError$1(n,E);e.isTimeout=!0,s(e)}}),i));var $=Date.now();return fetch(c||n,c?void 0:E).then(function(){var e=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(t){var i,s;return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=t,!r._aborted){e.next=4;break}return e.abrupt("return");case 4:if(u&&(t=u(t,n)||t),t.ok){e.next=7;break}throw new NetError$1(n,E,t,"bad network response");case 7:if(i=Date.now(),a!==ResponseType$1.TEXT){e.next=14;break}return e.next=11,t.text();case 11:s=e.sent,e.next=28;break;case 14:if(a!==ResponseType$1.JSON){e.next=20;break}return e.next=17,t.json();case 17:s=e.sent,e.next=28;break;case 20:if(!o){e.next=24;break}r._loadChunk(t,o),e.next=28;break;case 24:return e.next=26,t.arrayBuffer();case 26:s=e.sent,s=new Uint8Array(s);case 28:return e.abrupt("return",createResponse$1(s,t,t.headers.get("Content-Length"),t.headers.get("age"),$,i));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){if(clearTimeout(r._timeoutTimer),!r._aborted||T)throw(e=e instanceof NetError$1?e:new NetError$1(n,E)).startTime=$,e.endTime=Date.now(),e.isTimeout=T,e}))}},{key:"cancel",value:(t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,!this._response){e.next=13;break}if(e.prev=4,!this._reader){e.next=8;break}return e.next=8,this._reader.cancel();case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:this._response=this._reader=null;case 13:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}case 14:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t){var r,n,i,a=this,o=this._reader=e.body.getReader(),s=function(){var l=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function l(){return _regeneratorRuntime$5().wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return n=Date.now(),l.prev=1,l.next=4,o.read();case 4:r=l.sent,i=Date.now(),l.next=13;break;case 8:return l.prev=8,l.t0=l.catch(1),i=Date.now(),t(void 0,!0,{startTime:n,endTime:i},e),l.abrupt("return");case 13:if(!a._aborted){l.next=16;break}return t(void 0,!0,{startTime:n,endTime:i},e),l.abrupt("return");case 16:t(r.value,r.done,{startTime:n,endTime:i},e),r.done||s();case 18:case"end":return l.stop()}}),l,null,[[1,8]])})));return function(){return l.apply(this,arguments)}}();s()}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),e}();function getConfig$2(e){return _objectSpread2$5({loaderType:LoaderType$1.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType$1.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0},e)}var XhrLoader$1=function(){function e(){_classCallCheck$8(this,e),_defineProperty$8(this,"_xhr",null),_defineProperty$8(this,"_aborted",!1),_defineProperty$8(this,"_timeoutTimer",null)}return _createClass$9(e,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer);var r=e.url,n=e.params,i=e.timeout,a=e.responseType,o=e.onTimeout,s=e.transformResponse,l=e.onProgress,u=e.method,c=e.credentials,d=e.body,h=e.headers,f=e.range,p=e.request,y=!1;r=setUrlParams$1(r,n);var m=Date.now();return new Promise((function(e,n){var g=t._xhr=new XMLHttpRequest;g.open(u||"GET",r,!0),g.responseType=a,g.withCredentials="include"===c||"same-origin"===c;var v=getRangeValue$1(f);v&&((h=h||{}).Range=v),h&&Object.keys(h).forEach((function(e){g.setRequestHeader(e,h[e])})),i&&(t._timeoutTimer=setTimeout((function(){if(y=!0,t.cancel(),o){var e=new NetError$1(r,p);e.isTimeout=!0,o(e)}}),i)),g.onerror=function(e){return n(e)},g.onreadystatechange=function(){if(g.readyState>=2){clearTimeout(t._timeoutTimer);var i=Date.now();if(4===g.readyState){if(g.onreadystatechange=null,t._aborted)return;var a=g.status,o={ok:a>=200&&a<300,status:a,statusText:g.statusText,url:g.responseURL,headers:t._getHeaders(g),body:g.response};if(s&&(o=s(o,r)||o),!o.ok)return n(new NetError$1(r,p,o,"bad network response"));var u=g.responseType===ResponseType$1.ARRAY_BUFFER,c=u?new Uint8Array(g.response):g.response;l&&l(u?c:void 0,!0,{startTime:m,endTime:Date.now()},o),e(createResponse$1(c,o,o.headers["content-length"],o.headers.age,m,i))}}},g.send(d)})).catch((function(e){if(clearTimeout(t._timeoutTimer),!t._aborted||y)throw(e=e instanceof NetError$1?e:new NetError$1(r,p)).startTime=m,e.endTime=Date.now(),e.isTimeout=y,e}))}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._xhr?this._xhr.cancel():void 0}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper$1(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),e}(),_excluded$3=["retry","retryDelay","onRetryError","transformError"],Task$1=function(){function e(t,r){_classCallCheck$8(this,e),this.promise=createPublicPromise$2(),this.alive=!!r.onProgress,this._loaderType=t,this._loader=t===LoaderType$1.FETCH?new FetchLoader$1:new XhrLoader$1,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1}var t;return _createClass$9(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties$2(t,_excluded$3),s=function(){var t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function t(){var l,u;return _regeneratorRuntime$5().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:l=t.sent,e.promise.resolve(l),t.next=22;break;case 7:if(t.prev=7,t.t0=t.catch(0),!e._canceled){t.next=11;break}return t.abrupt("return");case 11:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,u=t.t0,a&&(u=a(u)||u),i&&e._retryCount>0&&i(u,e._retryCount,r),e._retryCount++,!(e._retryCount<=r)){t.next=21;break}return clearTimeout(e._retryTimer),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 21:e.promise.reject(u);case 22:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,e.abrupt("return",this._loader.cancel());case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function sleep$1(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var NetLoader$1=function(){function e(t){_classCallCheck$8(this,e),_defineProperty$8(this,"type",LoaderType$1.FETCH),_defineProperty$8(this,"_queue",[]),_defineProperty$8(this,"_alive",[]),_defineProperty$8(this,"_currentTask",null),this._config=getConfig$2(t),this._config.loaderType!==LoaderType$1.XHR&&FetchLoader$1.isSupported()||(this.type=LoaderType$1.XHR)}var t;return _createClass$9(e,[{key:"isFetch",value:function(){return this.type===LoaderType$1.FETCH}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?t=e:t.url=e||t.url||this._config.url,(t=Object.assign({},this._config,t)).params&&(t.params=Object.assign({},t.params)),t.headers&&isPlainObject$1(t.headers)&&(t.headers=Object.assign({},t.headers)),t.body&&isPlainObject$1(t.body)&&(t.body=Object.assign({},t.body)),t.transformRequest&&(t=t.transformRequest(t)||t);var r=new Task$1(this.type,t);return this._queue.push(r),1===this._queue.length&&this._processTask(),r.promise}},{key:"cancel",value:(t=_asyncToGenerator$7(_regeneratorRuntime$5().mark((function e(){var t;return _regeneratorRuntime$5().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,sleep$1();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader$1.isSupported()}}]),e}(),EVENT$1={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT"},Logger$5=function(){function e(t){_classCallCheck$8(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$9(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function asyncGeneratorStep$6(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$6(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$6(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$6(a,n,i,o,s,"throw",e)}o(void 0)}))}}_defineProperty$8(Logger$5,"disabled",!0);var regeneratorRuntime$1={exports:{}},_typeof$4={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(_typeof$4),function(e){var t=_typeof$4.exports.default;function r(){e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(x){d=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),s=new I(n||[]);return o(a,"_invoke",{value:$(e,r,s)}),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(x){return{type:"throw",arg:x}}}n.wrap=h;var p={};function y(){}function m(){}function g(){}var v={};d(v,l,(function(){return this}));var b=Object.getPrototypeOf,_=b&&b(b(C([])));_&&_!==i&&a.call(_,l)&&(v=_);var E=g.prototype=y.prototype=Object.create(v);function T(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,r){function n(i,o,s,l){var u=f(e[i],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==t(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(e){n("next",e,s,l)}),(function(e){n("throw",e,s,l)})):r.resolve(d).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,l)}))}l(u.arg)}var i;o(this,"_invoke",{value:function(e,t){function a(){return new r((function(r,i){n(e,t,r,i)}))}return i=i?i.then(a,a):a()}})}function $(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=A(o,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=f(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function A(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=f(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(e){if(e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(a.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:P}}function P(){return{value:void 0,done:!0}}return m.prototype=g,o(E,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:m,configurable:!0}),m.displayName=d(g,c,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,c,"GeneratorFunction")),e.prototype=Object.create(E),e},n.awrap=function(e){return{__await:e}},T(S.prototype),d(S.prototype,u,(function(){return this})),n.AsyncIterator=S,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new S(h(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(E),d(E,c,"Generator"),d(E,l,(function(){return this})),d(E,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},n.values=C,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(regeneratorRuntime$1);var runtime=regeneratorRuntime$1.exports(),regenerator=runtime;try{regeneratorRuntime=runtime}catch(accidentalStrictMode){"object"===("undefined"==typeof globalThis?"undefined":_typeof$b(globalThis))?globalThis.regeneratorRuntime=runtime:Function("r","regeneratorRuntime = r")(runtime)}var lib={},parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach((function(e){grammar$1[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var i=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:i&&!r[e.name]&&(r[e.name]={});var a=e.push?{}:i?r[e.name]:r;!function(e,r,n,i){if(i&&!n)r[i]=t(e[1]);else for(var a=0;a<n.length;a+=1)null!=e[a+1]&&(r[n[a]]=t(e[a+1]))}(n.match(e.reg),a,e.names,e.name),e.push&&r[e.push].push(a)},n=grammar$2.exports,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},a=[],o=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),o=a[a.length-1]);for(var s=0;s<(n[t]||[]).length;s+=1){var l=n[t][s];if(l.reg.test(i))return r(l,o,i)}})),t.media=a,t};var a=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],n=e.split(" ").map(t),i=0;i<n.length;i+=3)r.push({component:n[i],ip:n[i+1],port:n[i+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(parser$1);var grammar=grammar$2.exports,formatRegExp=/%[sdv%]/g,format=function(e){var t=1,r=arguments,n=r.length;return e.replace(formatRegExp,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},makeLine=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return format.apply(null,n)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||defaultOuterOrder,n=t.innerOrder||defaultInnerOrder,i=[];return r.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(makeLine(t,r,e))}))}))})),e.media.forEach((function(e){i.push(makeLine("m",grammar.m[0],e)),n.forEach((function(t){grammar[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(makeLine(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(makeLine(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"},parser=parser$1,writer=writer$1;function ownKeys$7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$7(Object(r),!0).forEach((function(t){_defineProperty$9(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$7(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function getOption(e){return _objectSpread$2({retryCount:0,retryDelay:1e3,loadTimeout:5e3,stallInterval:300},e)}function _getStatByType(e,t,r){var n;return t.forEach((function(t){t.type!==e||r&&t.kind!==r||(n=t)})),n}function _getStats(e){var t;return e.forEach((function(r){"stream"===r.type&&(t=r.trackIds.map((function(t){var r=e.get(t),n=_getStatByType("inbound-rtp",e,r.kind),i=e.get(null==n?void 0:n.codecId);return{type:r.kind,track:r,inboundRtp:n,codec:i,transport:_getStatByType("transport",e),localCandidate:_getStatByType("local-candidate",e),remoteCandidate:_getStatByType("remote-candidate",e)}})))})),t}function getStats(e){return new Promise((function(t){var r;null===(r=e.getStats(null,(function(e){t(_getStats(e))})))||void 0===r||r.then((function(e){t(_getStats(e))}))})).catch((function(e){}))}function ownKeys$6(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$6(Object(r),!0).forEach((function(t){_defineProperty$9(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$6(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper$7(e){var t=_isNativeReflectConstruct$7();return function(){var r,n=_getPrototypeOf$7(e);if(t){var i=_getPrototypeOf$7(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$7(this,r)}}function _isNativeReflectConstruct$7(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}lib.write=writer,lib.parse=parser.parse,lib.parseParams=parser.parseParams,lib.parseFmtpConfig=parser.parseFmtpConfig,lib.parsePayloads=parser.parsePayloads,lib.parseRemoteCandidates=parser.parseRemoteCandidates,lib.parseImageAttributes=parser.parseImageAttributes,lib.parseSimulcastStreamList=parser.parseSimulcastStreamList;var logger$1=new Logger$5("rts"),Rts=function(e){_inherits$7(n,e);var t,r=_createSuper$7(n);function n(e){var t;return _classCallCheck$b(this,n),_defineProperty$9(_assertThisInitialized$7(t=r.call(this)),"_url",""),_defineProperty$9(_assertThisInitialized$7(t),"_pc",null),_defineProperty$9(_assertThisInitialized$7(t),"_audioTransceicer",null),_defineProperty$9(_assertThisInitialized$7(t),"_videoTransceicer",null),_defineProperty$9(_assertThisInitialized$7(t),"_mediaStream",null),_defineProperty$9(_assertThisInitialized$7(t),"_media",null),_defineProperty$9(_assertThisInitialized$7(t),"_opts",null),_defineProperty$9(_assertThisInitialized$7(t),"_loader",null),_defineProperty$9(_assertThisInitialized$7(t),"_retry",0),_defineProperty$9(_assertThisInitialized$7(t),"_startPlayed",!1),_defineProperty$9(_assertThisInitialized$7(t),"_lastTimeupdateTs",0),_defineProperty$9(_assertThisInitialized$7(t),"_onTrack",(function(e){logger$1.log("addTrack: ",e.track),t["_".concat(e.track.kind)]=e.track,t._mediaStream||(t._mediaStream=new MediaStream,t._media.srcObject=t._mediaStream),t._mediaStream.addTrack(e.track)})),_defineProperty$9(_assertThisInitialized$7(t),"_mockWaitingByTimeupdate",(function(){var e;if("connected"===(null===(e=t._pc)||void 0===e?void 0:e.connectionState)){t._lastTimeupdateTs||getStats(t._pc).then((function(e){logger$1.log("tracks stats:",e),e.forEach((function(e){return t.emit(EVENT$1.METADATA_PARSED,e)}))})).catch((function(){}));var r=performance.now();t._lastTimeupdateTs||(t._lastTimeupdateTs=r),r-t._lastTimeupdateTs>t._opts.stallInterval&&t.emit("waiting"),t._lastTimeupdateTs=r}})),_defineProperty$9(_assertThisInitialized$7(t),"_onLoaderRetry",(function(e,r){t.emit(EVENT$1.LOAD_RETRY,{error:StreamingError$1.network(e),retryTime:r})})),t._opts=getOption(e),t._media=t._opts.media,t._loader=new NetLoader$1(_objectSpread$1(_objectSpread$1({},e.fetchOptions),{},{responseType:"json",method:"POST",retry:t._opts.retryCount,retryDelay:t._opts.retryDelay,timeout:t._opts.loadTimeout,onRetryError:t._onLoaderRetry})),t._retry=t._opts.retryCount,t._bindMediaEvent(),t}return _createClass$c(n,[{key:"pc",get:function(){return this._pc}},{key:"getStats",value:function(){return getStats(this._pc)}},{key:"load",value:function(e){this._disconnect(),this._lastTimeupdateTs=0,this._url=e,this._pc=new RTCPeerConnection,this._bindRTCEvents(),this._connect(e)}},{key:"switchURL",value:function(e){this._startPlayed=!0,this.load(e||this._url)}},{key:"_bindRTCEvents",value:function(){var e=this,t=this._pc;t.addEventListener("track",this._onTrack),t.addEventListener("connectionstatechange",(function(){if(logger$1.log("onconnectionstatechange:",t.connectionState),"disconnected"!==t.connectionState&&"failed"!==t.connectionState||e.emit("waiting"),"failed"===t.connectionState){if(0===e._retry)return void e._emitError(StreamingError$1.network(new Error("rtc connect failed")));e._retry--,e.load(e._url)}"connected"===t.connectionState&&e._startPlayed&&e._media.play()}))}},{key:"_bindMediaEvent",value:function(){this._media.addEventListener("timeupdate",this._mockWaitingByTimeupdate)}},{key:"_connect",value:(t=_asyncToGenerator$6(regenerator.mark((function e(){var t,r,n,i,a,o,s,l,u,c;return regenerator.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._pc,r=/Gecko/.test(navigator.userAgent)&&/Firefox/.test(navigator.userAgent),!t.addTransceiver){e.next=10;break}return this._audioTransceicer=t.addTransceiver("audio",{direction:"recvonly"}),this._videoTransceicer=t.addTransceiver("video",{direction:"recvonly"}),e.next=7,t.createOffer();case 7:n=e.sent,e.next=13;break;case 10:return e.next=12,t.createOffer({iceRestart:!0,offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 12:n=e.sent;case 13:return logger$1.log("local offer"),logger$1.log(n.sdp),(i=lib.parse(n.sdp)).media.filter((function(e){return"audio"===e.type})).forEach((function(e){var t;if(r){var n=null===(t=e.rtp.filter((function(e){return"opus"===e.codec}))[0])||void 0===t?void 0:t.payload;n&&e.fmtp.forEach((function(e){e.payload===n&&(e.config="minptime=10;useinbandfec=1")}))}})),n.sdp=lib.write(i),logger$1.log("local offer modified:\n",n.sdp),e.next=21,t.setLocalDescription(n);case 21:return e.prev=21,o=/_session_id=([^&$]+)/.exec(this._url),s=o?o[1]:"sessionId",e.next=26,this._loader.load(this._url,{body:JSON.stringify({sessionId:s,version:"1.0-html",localSdp:n})});case 26:if(l=e.sent,200===(null==(u=null==l?void 0:l.data)?void 0:u.code)){e.next=30;break}throw new Error("code: ".concat(null==u?void 0:u.code,", message:").concat(null==u?void 0:u.message));case 30:return logger$1.log("answer:"),logger$1.log(null===(a=u.remoteSdp)||void 0===a?void 0:a.sdp),(c=lib.parse(u.remoteSdp.sdp)).media.forEach((function(e){e.fingerprint.hash=e.fingerprint.hash.toUpperCase()})),u.remoteSdp.sdp=lib.write(c),logger$1.log("answer modified:\n",u.remoteSdp.sdp),e.next=38,this._pc.setRemoteDescription(u.remoteSdp);case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(21),this._emitError(StreamingError$1.create(ERR$1.NETWORK,null,e.t0));case 43:case"end":return e.stop()}}),e,this,[[21,40]])}))),function(){return t.apply(this,arguments)})},{key:"_disconnect",value:function(){var e;null===(e=this._pc)||void 0===e||e.close(),this._pc=null,this._audioTransceicer=null,this._videoTransceicer=null,this._mediaStream=null}},{key:"_emitError",value:function(e){this.emit(EVENT$1.ERROR,e)}},{key:"destroy",value:function(){var e;this._disconnect(),null===(e=this._media)||void 0===e||e.removeEventListener("timeupdate",this._mockWaitingByTimeupdate),this._media&&(this._media.srcObject=null),this._loader=null,this._media=null}}],[{key:"enableLogger",value:function(){Logger$5.enable()}},{key:"disableLogger",value:function(){Logger$5.disable()}}]),n}(EventEmitter$1);try{localStorage.getItem("xgd")?Rts.enableLogger():Rts.disableLogger()}catch(error){}function ownKeys$5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$5(Object(r),!0).forEach((function(t){_defineProperty$9(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$5(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper$6(e){var t=_isNativeReflectConstruct$6();return function(){var r,n=_getPrototypeOf$7(e);if(t){var i=_getPrototypeOf$7(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$7(this,r)}}function _isNativeReflectConstruct$6(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var RtsPlugin$1=function(t){_inherits$7(n,t);var r=_createSuper$6(n);function n(){var e;_classCallCheck$b(this,n);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return _defineProperty$9(_assertThisInitialized$7(e=r.call.apply(r,[this].concat(i))),"_rts",null),_defineProperty$9(_assertThisInitialized$7(e),"_rtsOpts",null),_defineProperty$9(_assertThisInitialized$7(e),"_init",(function(){var t;null===(t=e._rts)||void 0===t||t.destroy();var r=e.player.config,n=r.rts||{};e._rtsOpts=n,e._rts=new Rts(_objectSpread({media:e.player.video},n)),e._rts.load(r.url)})),_defineProperty$9(_assertThisInitialized$7(e),"_onSwitchURL",(function(t){e._rts&&(e.player.config.url=t,e._rts.switchURL(t))})),_defineProperty$9(_assertThisInitialized$7(e),"_onDefinitionChange",(function(t){var r=t.to;e._rts&&e._rts.switchURL(r)})),e}return _createClass$c(n,[{key:"pc",get:function(){var e;return null===(e=this._rts)||void 0===e?void 0:e.pc}},{key:"core",get:function(){return this._rts}},{key:"beforePlayerInit",value:function(){var t,r,n=this;this._init(),this.player.switchURL=this._onSwitchURL,null===(t=this.player)||void 0===t||t.useHooks("replay",(function(){var e;return null===(e=n._rts)||void 0===e?void 0:e.switchURL()})),null===(r=this.player)||void 0===r||r.useHooks("play",(function(){var e;return null===(e=n._rts)||void 0===e?void 0:e.switchURL()})),this.on(URL_CHANGE,this._onSwitchURL),this.on(DEFINITION_CHANGE,this._onDefinitionChange),this.on(DESTROY,this.destroy),this._transEvent(),this._transCoreEvent(EVENT$1.METADATA_PARSED);try{BasePlugin.defineGetterOrSetter(this.player,{__url:{get:function(){try{return URL.createObjectURL(new MediaSource)}catch(e){var t,r;null!==(t=n.player)&&void 0!==t&&null!==(r=t.video)&&void 0!==r&&r.srcObject||(n.player.video.srcObject=new MediaStream)}}}})}catch(e){}}},{key:"_transEvent",value:function(){var e=this;this._rts.on(EVENT$1.ERROR,(function(t){if(e.player){var r=e._rtsOpts,n=r.backupConstruct,i=r.backupURL;if(i){var a=e.player;a.emit("core_event",_objectSpread(_objectSpread({},{url:a.config.url,code:t.errorCode,message:t.errorMessage}),{},{eventName:"core.degrade"})),a.emit("degrade",{url:a.config.url,code:t.errorCode,message:t.errorMessage}),a.unRegisterPlugin("rts"),e._rts=null,a.rts=null,a.config.url=i,n?a.registerPlugin(n).beforePlayerInit():a.video.src=i}else e.player.emit(ERROR$3,new Errors$1(e.player,t))}})),this._rts.on("waiting",(function(){var t;null===(t=e.player)||void 0===t||t.emit("waiting")}))}},{key:"_transCoreEvent",value:function(e){var t=this;this._rts.on(e,(function(r){t.player&&t.player.emit("core_event",_objectSpread(_objectSpread({},r),{},{eventName:e}))}))}},{key:"destroy",value:function(){var e;null===(e=this._rts)||void 0===e||e.destroy()}}],[{key:"pluginName",get:function(){return"rts"}}]),n}(BasePlugin),RtsPlugin=RtsPlugin$1,playerMap={flv:FlvPlugin,hls:HlsPlugin},RtmPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"beforeCreate",value:function(e){var t=(e.player.config.rtm||{}).backupStreamType;e.player.config.rts=assign$8({},e.player.config.rtm,{backupConstruct:playerMap[t]})}},{key:"afterCreate",value:function(){var e=this.player;e.on("degrade",(function(){e.unRegisterPlugin("rtm")}))}}],[{key:"pluginName",get:function(){return"rtm"}}]),r}(RtsPlugin),SDKEvents=function(e){return e.PLAYER_CREATED_FINISH="player_create_finish",e.PLAYER_REBUILD="player_rebuild",e.NOT_SUPPORT_HARDWARE_DECODER="not_support_hardware_decoder",e.NOT_SUPPORT_SOFT_DECODER="not_support_soft_decoder",e.TOKEN_EXPIRED="playAuthToken_expired",e}(SDKEvents||{}),PluginEvents=function(e){return e.DANMU_CHANGE="danmu_change",e.TIME_SHIFT_CHANGE="time_shift_change",e.AI_SUBTITLE_LANG_CHANGE="ai_subtitle_lang_change",e.AI_SUBTITLE_MATCH="ai_subtitle_match",e.CANCEL_UNMUTE="cancel_unmute",e.REFRESH_CLICK="refresh_click",e.PLAY_BACKUP_CHANGE="play_backup_change",e.PLAY_BACKUP_CHANGE_FINISH="play_backup_change_finish",e.PLAY_ERROR_BUTTON_CLICK="play_error_button_click",e.PlAY_URL_CHANGE="play_url_change",e.SHOW_PLAY_ERROR="show_play_error",e.PLAYER_EXTEND_BUTTON="player_extend_button",e.LONG_WAITING="long_waiting",e.OFTEN_WAITING="often_waiting",e.DEFINITION_DEMOTE="definition_demote",e.LARKWINDOW_CHANGE="larkWindow_change",e.PANEL_MODE_CHANGE="panel_mode_change",e.INNER_DEFINITION_CHANGE="inner_definition_change",e.LINE_CHANGE="line_change",e.GET_PLAY_URL_ERR="get_play_url_err",e.MEDIA_EXPIRED="MEDIA_EXPIRED",e.MIRROR_CHANGE="mirror_change",e}(PluginEvents||{}),Event$2=Object.freeze(Object.defineProperty({__proto__:null,SDKEvents:SDKEvents,PluginEvents:PluginEvents},Symbol.toStringTag,{value:"Module"})),CONTROL_ICON_INDEX={sdkDefinitionPlugin:3,DanmuPlugin:3,sdkMultilinePlugin:4,mirrorPlugin:5,Subtitle:6},MultilinePlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).playerData=null,n.playerData=n.playerConfig.playerData,n}return _createClass$k(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.playerData,r=t.getLineList(),n=t.current.lineId;Array.isArray(r)&&r.length>0&&(e.config.list=r.map((function(t){return t.text=e.player.i18n[t.lineTextKey]||t.lineTextKey,t}))),e.config.defaultLine=n}},{key:"afterCreate",value:function(){_get$4(_getPrototypeOf$g(r.prototype),"afterCreate",this).call(this),this.config.list.length<2&&this.hide()}},{key:"afterPlayerInit",value:function(){}},{key:"renderItemList",value:function(){var e=this,t=this.config,n=t.list,i=t.defaultLine,a=0,o=n.map((function(t,r){var n,o={lineId:t.lineId||"",showText:e.i18n[t.lineTextKey]||t.lineTextKey,isCurrent:!1,selected:!1};return util$2.isUndefined(t.lineId)||(null===(n=t.lineId)||void 0===n?void 0:n.toString())!==(null==i?void 0:i.toString())||(o.isCurrent=!0,o.selected=!0,a=r),o}));_get$4(_getPrototypeOf$g(r.prototype),"renderItemList",this).call(this,o,a)}},{key:"onItemClick",value:function(e,t){this.player.emit(PluginEvents.LINE_CHANGE,{from:this.playerData.current.lineId,to:t.to.lineId}),this.playerData.current.lineId=t.to.lineId,this.player.emit(SDKEvents.PLAYER_REBUILD)}}],[{key:"pluginName",get:function(){return"sdkMultilinePlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.sdkMultilinePlugin,list:[],defaultLine:0,className:"xgplayer-multiline",hidePortrait:!1,isShowIcon:!0}}}]),r}(OptionsIcon),DefinitionPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).playerData=null,n.playerData=n.playerConfig.playerData,n.dataMonitoring(),n}return _createClass$k(r,[{key:"registerLanguageTexts",value:function(){return{switching:{jp:"",en:"Switching to",zh:"","zh-hk":""}}}},{key:"beforeCreate",value:function(e){var t=this,r=e.player.config.playerData,n=r.current,i=n.lineId,a=n.definition,o=r.getDefinitionListByLineId(i);Array.isArray(o)&&o.length>0&&(e.config.list=o.map((function(r){return r.text||(r.text=t.getShowText(e.player.i18n,r)),r}))),e.config.defaultDefinition=a}},{key:"dataMonitoring",value:function(){var e=this;MyProxy$1.subscribeProperty(this.playerData.current,"definition",(function(t,r){if(t!==r&&e.player){var n=e.config.list,i=(void 0===n?[]:n).find((function(e){return e.definition===r}));i&&i.url&&(e.player.changeDefinition(_objectSpread2$c(_objectSpread2$c({},i),{},{definition:r,url:i.url})),e.player.emit(PluginEvents.INNER_DEFINITION_CHANGE,{from:t,to:r,url:i.url}),e.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:i.url,from:PluginEvents.INNER_DEFINITION_CHANGE}),e.renderItemList(r),setTimeout((function(){e.player.paused&&e.player.play()}),1e3))}}))}},{key:"showToast",value:function(e){var t,r=null===(t=this.player)||void 0===t?void 0:t.getPlugin("sdkToastPlugin");if(r){var n=e.showText;r.add("".concat(this.langText.switching).concat(n,"..."),2e3,!0)}}},{key:"afterCreate",value:function(){_get$4(_getPrototypeOf$g(r.prototype),"afterCreate",this).call(this),this.config.list.length<2&&this.hide()}},{key:"afterPlayerInit",value:function(){}},{key:"getShowText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return e[t.definitionTextKey]||t.definitionTextKey||t.definition}},{key:"renderItemList",value:function(e){var t=this,n=this.config,i=n.list,a=n.defaultDefinition,o=0,s=i.map((function(r,n){var i={url:r.url,definition:r.definition||"",showText:t.getShowText(t.i18n,r),isCurrent:!1,selected:!1},s="string"==typeof e?r.definition===e:r.definition===a;return!util$2.isUndefined(r.definition)&&s&&(i.isCurrent=!0,i.selected=!0,o=n),i}));_get$4(_getPrototypeOf$g(r.prototype),"renderItemList",this).call(this,s,o)}},{key:"onItemClick",value:function(e,t){this.showToast(t.to),this.playerData.current.definition=t.to.definition}}],[{key:"pluginName",get:function(){return"sdkDefinitionPlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.sdkDefinitionPlugin,list:[],defaultDefinition:"",hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0}}}]),r}(OptionsIcon),UnmutePlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).state={isSupportAutoplay:!0,showUnmuteBt:!1},n}return _createClass$k(r,[{key:"beforePlayerInit",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"afterCreate",value:function(){(this.player.autoplay||this.player.config.autoplayMuted)&&this.initEvents()}},{key:"registerLanguageTexts",value:function(){return{unmute:{jp:"",en:"Click to unmute",zh:"","zh-hk":""}}}},{key:"updateLang",value:function(){this.renderUnmuteBt()}},{key:"initEvents",value:function(){this.player.once("autoplay_was_prevented",this.handleAutoplayPrevented.bind(this)),this.player.once("autoplay_started",this.handleAutoplayStart.bind(this)),this.player.once("volumechange",this.handleVolumechange.bind(this))}},{key:"handleAutoplayPrevented",value:function(){console.log(""),this.state.isSupportAutoplay=!1,this.player.muted=!1}},{key:"handleAutoplayStart",value:function(){this.state.isSupportAutoplay?(this.state.showUnmuteBt=!0,this.renderUnmuteBt()):this.player.muted=!1}},{key:"handleVolumechange",value:function(){this.state.showUnmuteBt=!1,this.renderUnmuteBt(),this.player.paused&&this.player.play()}},{key:"renderUnmuteBt",value:function(){var e=this.root;if(e&&(e.innerHTML="",this.state.showUnmuteBt)){var t=this.langText.unmute,r=util$2.createDom("div",t,void 0,"xgplayer-unmute-bt");e.appendChild(r),this.bind(".xgplayer-unmute-bt","click",this.cancelUnmute.bind(this))}}},{key:"cancelUnmute",value:function(){this.player.muted=!1,this.state.showUnmuteBt=!1,this.renderUnmuteBt(),this.player.emit(PluginEvents.CANCEL_UNMUTE)}},{key:"destroy",value:function(){this.player.off("autoplay_was_prevented",this.handleAutoplayPrevented.bind(this)),this.player.off("autoplay_started",this.handleAutoplayStart.bind(this)),this.player.off("volumechange",this.handleVolumechange.bind(this))}},{key:"render",value:function(){return'<div class="xgplayer-unmute"></div>'}}],[{key:"pluginName",get:function(){return"sdkUnmutePlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.ROOT}}}]),r}(Plugin);function refreshSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10 2.488a7.48 7.48 0 00-4.154 1.253.908.908 0 101.005 1.512 5.695 5.695 0 018.844 4.746h-.908a.33.33 0 00-.264.528l1.816 2.422a.33.33 0 00.529 0l1.815-2.422A.33.33 0 0018.42 10h-.908A7.511 7.511 0 0010 2.49zM2.489 10a7.511 7.511 0 0011.665 6.26.908.908 0 00-1.005-1.513A5.695 5.695 0 014.305 10h.908a.33.33 0 00.264-.528L3.66 7.05a.33.33 0 00-.528 0L1.317 9.47a.33.33 0 00.264.53h.908z" fill="#fff"/></svg>',"image/svg+xml").firstChild}var POSITIONS$9=Plugin.POSITIONS,RefreshPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.refresh),this.initEvents()}},{key:"registerIcons",value:function(){return{refresh:{icon:refreshSVG$1,class:"xgplayer-refresh-svg"}}}},{key:"registerLanguageTexts",value:function(){return{refresh:{jp:"",en:"Refresh",zh:"","zh-hk":""}}}},{key:"initEvents",value:function(){this.handleRefresh=debounce$3(this.handleRefresh.bind(this),200);var e="mobile"===sniffer$1.device?"touchend":"click";this.bind(e,this.handleRefresh),this.show()}},{key:"handleRefresh",value:function(e){var t=this.player;t&&(e.preventDefault(),e.stopPropagation(),t.addClass("xgplayer-is-enter"),t.pause(),t.emit(PluginEvents.REFRESH_CLICK),setTimeout((function(){t&&t.retry(),t.once("canplay",(function(){t.removeClass("xgplayer-is-enter")}))})))}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.handleRefresh)}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-refresh">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="refresh">'.concat(this.langText.refresh,"</div>\n    </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"refresh"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$9.CONTROLS_LEFT,index:1}}}]),r}(Plugin);function MoreIconSVG(){return(new DOMParser).parseFromString('<svg width="18" height="18" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M5.75 11C5.75 11.9665 4.9665 12.75 4 12.75C3.0335 12.75 2.25 11.9665 2.25 11C2.25 10.0335 3.0335 9.25 4 9.25C4.9665 9.25 5.75 10.0335 5.75 11ZM13.25 11C13.25 11.9665 12.4665 12.75 11.5 12.75C10.5335 12.75 9.75 11.9665 9.75 11C9.75 10.0335 10.5335 9.25 11.5 9.25C12.4665 9.25 13.25 10.0335 13.25 11ZM19 12.75C19.9665 12.75 20.75 11.9665 20.75 11C20.75 10.0335 19.9665 9.25 19 9.25C18.0335 9.25 17.25 10.0335 17.25 11C17.25 11.9665 18.0335 12.75 19 12.75Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}var MoreButtonPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).panel=null,n.panelContainer=null,n}return _createClass$k(r,[{key:"beforePlayerInit",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"afterCreate",value:function(){this.renderMoreIcon()}},{key:"updateLang",value:function(e){if(this.panelContainer){var t=this.panelContainer.querySelectorAll(".panel-icon-bt-text"),r=this.getAndSplitList().extraList;t.forEach((function(t){var n,i,a=Number(t.getAttribute("plugin-index"));null!==(n=r[a])&&void 0!==n&&null!==(i=n.textTips)&&void 0!==i&&i[e]&&(t.innerHTML=r[a].textTips[e])}))}}},{key:"registerIcons",value:function(){return{more:{icon:MoreIconSVG,class:"xgplayer-more-svg"}}}},{key:"getAndSplitList",value:function(){var e,t,r,n,i,a=(null!==(e=this.player.config.ignores)&&void 0!==e?e:[]).map((function(e){return e.toLowerCase()})),o=this.config.iconPlugins.filter((function(e){return!a.includes(e.pluginName.toLowerCase())}));return o.length>this.config.maxShowNum+1?(n=o.slice(0,this.config.maxShowNum),i=o.slice(-(o.length-this.config.maxShowNum))):n=_toConsumableArray$a(o),{list:null!==(t=n)&&void 0!==t?t:[],extraList:null!==(r=i)&&void 0!==r?r:[]}}},{key:"children",value:function(){var e=this,t=this.getAndSplitList().list,r={};return t.forEach((function(t){r[t.pluginName]={plugin:t,options:{root:e.root}}})),r}},{key:"renderMoreIcon",value:function(){var e=this,t=this.getAndSplitList().extraList;if(0!==t.length){var r=this.root,n=util$2.createDom("div","",{},"xgplayer-icon");n.appendChild(this.icons.more),n.addEventListener("click",(function(){e.renderPanel(t)}));var i=util$2.createDom("xg-icon","",{"data-index":0},"xgplayer-more");i.appendChild(n),r.appendChild(i)}}},{key:"renderPanel",value:function(e){var t=this;this.panelContainer||(this.panelContainer=util$2.createDom("div","",{},"panel-content"),e.forEach((function(e,r){var n,i,a=util$2.createDom("div","",{},"panel-icon-bt"),o=util$2.createDom("div","",{},"panel-icon-svg");a.appendChild(o),t.registerExtraPlugin(e,o);var s="zh-cn"===t.player.lang?"zh":t.player.lang,l=null!==(n=null===(i=e.textTips)||void 0===i?void 0:i[s])&&void 0!==n?n:e.pluginName;a.appendChild(util$2.createDom("span",l,{"plugin-index":r},"panel-icon-bt-text")),t.panelContainer.appendChild(a)}))),this.player.panel.showPanel(this.panelContainer)}},{key:"registerExtraPlugin",value:function(e,t){this.player.registerPlugin({plugin:e,options:{root:t}})}},{key:"destroy",value:function(){}},{key:"render",value:function(){return'<div class="xgplayer-rightTop-iconList"></div>'}}],[{key:"pluginName",get:function(){return"MoreButtonPlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.ROOT_TOP,iconPlugins:[],maxShowNum:2}}}]),r}(Plugin);function ErrorImg(){return(new DOMParser).parseFromString('<svg width="150" height="162" viewBox="0 0 150 162" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M127.718 112.831H6.13675C4.19663 112.831 2.25651 108.974 2.90322 104.475C3.54993 99.9761 8.07687 99.9761 13.8972 99.9761C11.9571 97.4052 9.37028 88.4069 15.8373 81.3369C22.3044 74.2668 25.5379 74.2668 34.5918 75.5526C33.9451 63.9837 47.526 34.4178 77.2744 35.0605C107.023 35.7032 116.077 54.3421 119.957 63.3404C129.011 62.6976 147.765 66.554 149.706 87.1214C151.258 103.575 135.694 111.117 127.718 112.831Z" fill="#F1F4F8"/>\n<path d="M44.9346 91.6022L43.6782 99.8032" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M47.3545 125.695L48.6109 117.494" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M31.5347 97.7378L38.7295 101.869" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M60.7544 119.559L53.5595 115.428" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n<path d="M69.6755 44.5318L138.35 26.0209C139.115 25.8148 139.804 26.5367 139.563 27.2909L121.081 85.1146C120.982 85.4243 120.739 85.6665 120.429 85.7641L52.0645 107.28C51.2996 107.521 50.5766 106.809 50.8062 106.04L68.9776 45.2111C69.0768 44.879 69.3409 44.622 69.6755 44.5318Z" fill="#D0D6E0" stroke="#D0D6E0" stroke-width="4" stroke-linecap="round"/>\n<path d="M83.1285 52.7415C91.6454 54.3438 107.322 62.0019 101.894 79.8155" stroke="white" stroke-width="3" stroke-linecap="round"/>\n<path d="M84.138 62.3385C88.3894 63.1384 96.2148 66.9611 93.5053 75.8531" stroke="white" stroke-width="3" stroke-linecap="round"/>\n<ellipse cx="83.6417" cy="71.98" rx="3.08443" ry="3.07025" transform="rotate(12.6375 83.6417 71.98)" fill="white"/>\n<path d="M43.4699 110.358C39.5425 109.114 30.6316 108.203 26.4077 114.511C21.1278 122.397 36.5031 152.755 2.11053 160.141" stroke="#D0D6E0" stroke-width="2" stroke-linecap="round"/>\n</svg>\n',"image/svg+xml").firstChild}var ErrorPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).playerData=null,n.state={showError:!1,retryTimes:0,idx:0},n._errDetailList=[],n.playerData=e.player.config.playerData,n}return _createClass$k(r,[{key:"afterCreate",value:function(){var e,t,r;this.initEvents(),this.errNoteMap={other:null!==(e=null===(t=this.i18n.ERROR_TYPES)||void 0===t||null===(r=t.other)||void 0===r?void 0:r.msg)&&void 0!==e?e:"error",1:this.i18n.MEDIA_ERR_ABORTED,2:this.i18n.MEDIA_ERR_NETWORK,3:this.i18n.MEDIA_ERR_DECODE,4:this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED,1100:this.i18n.GET_URL_ERR_BY_TOKEN,1101:this.i18n.PLAY_AUTH_TOKEN_EXPIRED,1102:this.i18n.HLS_KEY_TOKEN_EXPIRED}}},{key:"registerLanguageTexts",value:function(){return{clickButton:{jp:"",en:"Refresh",zh:"","zh-hk":""},errorTips:{jp:"[]",en:"An error occurred while playing, click refresh to try",zh:"","zh-hk":""}}}},{key:"registerIcons",value:function(){return{errorImg:{icon:ErrorImg,class:"xgplayer-error-svg"}}}},{key:"updateLang",value:function(){if(this.$errorDom){var e=this.$errorDom.querySelector(".xgplayer-error-tips");if(e){var t,r,n=null!==(t=null===(r=this.config.errorTipsText)||void 0===r?void 0:r[this.lang])&&void 0!==t?t:this.langText.errorTips;e.innerHTML=n}var i=this.$errorDom.querySelector(".xgplayer-error-button");i&&(i.innerHTML=this.langText.clickButton)}}},{key:"initEvents",value:function(){this.player.on(ERROR$3,this.handleError.bind(this)),this.playerData.isLive&&(this.player.on(ENDED,this.handleEnd.bind(this)),this.player.on(PluginEvents.REFRESH_CLICK,this.closeError.bind(this))),this.on(CANPLAY,this.closeError.bind(this)),this.on(PLAY,this.closeError.bind(this))}},{key:"handleError",value:function(e){this.player&&this.player.pause(),this.config.isNeedDemoteBack?(this.state.showError=!1,this.changeMainOrBackup()):this.state.showError=!0,this.renderError(e)}},{key:"handleEnd",value:function(){this.player&&this.player.pause(),this.config.isNeedDemoteBack&&this.changeMainOrBackup()}},{key:"getRetryList",value:function(){var e,t=this.playerData.getCurrentStreams()[0];return[null==t?void 0:t.url].concat(_toConsumableArray$a(null!==(e=null==t?void 0:t.backUrlList)&&void 0!==e?e:[]))}},{key:"changeMainOrBackup",value:function(){var e=this;this.player.addClass(STATE_CLASS.ENTER);var t=this.getRetryList(),r=this.config.retryLoopNum*t.length,n=(t.indexOf(this.player.config.url)+1)%t.length;this.state.idx=n;var i=t[n];if(!i||this.state.retryTimes===r)return this.player.removeClass(STATE_CLASS.ENTER),this.state.retryTimes===r&&this.player.emit(PluginEvents.PLAY_BACKUP_CHANGE_FINISH),this.state.showError=!0,this.renderError(),void this.resetTimes();this.player.once("canplay",(function(){e.state.retryTimes=0})),console.log("".concat(this.state.retryTimes,""),i),this.player.emit(PluginEvents.PLAY_BACKUP_CHANGE,{currentUrl:this.player.config.url,nextUrl:i,retryTimes:this.state.retryTimes}),this.changeUrl(i),this.state.retryTimes=this.state.retryTimes+1}},{key:"changeUrl",value:function(e){this.player.config.url=e,this.player.switchURL(e,!1),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:e,from:PluginEvents.PLAY_BACKUP_CHANGE})}},{key:"resetTimes",value:function(){this.state.retryTimes=0,this.state.idx=0}},{key:"renderError",value:function(e){var t=this.root;t&&(t.innerHTML="",t.style.display="none",this.state.showError&&(this.player.emit(PluginEvents.SHOW_PLAY_ERROR),t.style.display="block",t.appendChild(this.getErrorDom(e))))}},{key:"addErrDetail",value:function(e){Array.isArray(e)?this._errDetailList=[].concat(_toConsumableArray$a(this._errDetailList),_toConsumableArray$a(e)):this._errDetailList.push(e)}},{key:"getErrorDom",value:function(e){var t=this;if(!this.$errorDom){var r,n;if(this.$errorDom=util$2.createDom("div","",void 0,"xgplayer-error-cover"),this.config.errorImg){var i=util$2.createDom("div","",void 0,"xgplayer-error-img");i.appendChild(this.icons.errorImg),this.$errorDom.appendChild(i)}if(this.config.errorTips){var a="";if(e){var o,s,l=e.errorCode,u=this.player.errorNote?this.i18n[this.player.errorNote]:"";if(!u)u=null!==(o=null!==(s=this.errNoteMap[l])&&void 0!==s?s:this.errNoteMap.other)&&void 0!==o?o:"error";a=u}else{var c,d;a=null!==(c=null===(d=this.config.errorTipsText)||void 0===d?void 0:d[this.lang])&&void 0!==c?c:this.langText.errorTips}var h=util$2.createDom("div",a,void 0,"xgplayer-error-tips");this.$errorDom.appendChild(h)}if(this.config.isNeedRefreshButton){var f=util$2.createDom("div",this.langText.clickButton,void 0,"xgplayer-error-button");this.bind(".xgplayer-error-button","click",this.handleButtonClick.bind(this)),this.$errorDom.appendChild(f)}if(null!==(r=this._errDetailList)&&void 0!==r&&r.length)null===(n=this._errDetailList)||void 0===n||n.forEach((function(e){var r="function"==typeof e?e():e;if(r){var n=util$2.createDom("div","".concat(r.label,": ").concat(r.value),void 0,"xgplayer-error-detail-info");t.$errorDom.appendChild(n)}}));this.emit("sdkerrorplugin_render",this.$errorDom)}return this.$errorDom}},{key:"handleButtonClick",value:function(){var e,t;null===(e=this.player)||void 0===e||e.emit(PluginEvents.PLAY_ERROR_BUTTON_CLICK),null===(t=this.player)||void 0===t||t.retry(),this.closeError()}},{key:"closeError",value:function(){this.state.showError=!1,this.renderError()}},{key:"destroy",value:function(){this.player.off(ERROR$3,this.handleError.bind(this)),this.playerData.isLive&&this.player.off(ENDED,this.handleEnd.bind(this))}},{key:"render",value:function(){return'<xgplayer-error class="xgplayer-error"></xgplayer-error>'}}],[{key:"pluginName",get:function(){return"sdkErrorPlugin"}},{key:"defaultConfig",get:function(){return{errorImg:!0,errorTips:!0,isNeedRefreshButton:!0,isNeedDemoteBack:!1,retryLoopNum:1,errorTipsText:null,position:Plugin.POSITIONS.ROOT}}}]),r}(Plugin);function danmuActiveSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.5 4.106h-13a.3.3 0 00-.3.3v11.186a.3.3 0 00.3.3h7.111v1.7H3.5a2 2 0 01-2-2V4.406a2 2 0 012-2h13a2 2 0 012 2V10h-1.7V4.406a.3.3 0 00-.3-.3zM6 7.722c0-.42.34-.76.76-.76h6.58a.76.76 0 110 1.52H6.76a.76.76 0 01-.76-.76zm0 3.037c0-.42.34-.759.76-.759h3.543a.76.76 0 110 1.519H6.76a.76.76 0 01-.76-.76z" fill="#fff"/><circle cx="15.1" cy="14.201" r="3.4" fill="#3370FF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13.185 13.756a.5.5 0 01.707 0l.866.866 1.78-1.78a.5.5 0 11.707.707l-2.133 2.134a.5.5 0 01-.707 0l-1.22-1.22a.5.5 0 010-.707z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function Default(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.5 4.106h-13a.3.3 0 00-.3.3v11.186a.3.3 0 00.3.3h7.111v1.7H3.5a2 2 0 01-2-2V4.406a2 2 0 012-2h13a2 2 0 012 2V10h-1.7V4.406a.3.3 0 00-.3-.3zM6 7.722c0-.42.34-.76.76-.76h6.58a.76.76 0 110 1.52H6.76a.76.76 0 01-.76-.76zm0 3.037c0-.42.34-.759.76-.759h3.543a.76.76 0 110 1.519H6.759a.76.76 0 01-.759-.76zm7.202 2.303a2.2 2.2 0 003.011 3.011l-3.011-3.01zm3.915 1.992a2.2 2.2 0 00-2.896-2.896l2.896 2.896zm1.383-.879a3.4 3.4 0 11-6.8 0 3.4 3.4 0 016.8 0z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function resetIcon(){return(new DOMParser).parseFromString('<svg fill="none" stroke="currentColor" stroke-width="4" viewBox="0 0 48 48" width="1em" height="1em"\n    class="arco-icon arco-icon-refresh">\n    <path\n        d="M38.837 18C36.463 12.136 30.715 8 24 8 15.163 8 8 15.163 8 24s7.163 16 16 16c7.455 0 13.72-5.1 15.496-12M40 8v10H30">\n    </path>\n</svg>',"image/svg+xml").firstChild}function ownerDocument(e){return e&&e.ownerDocument||document}function activeElement(t){void 0===t&&(t=ownerDocument());try{var r=t.activeElement;return r&&r.nodeName?r:null}catch(e){return t.body}}function hasClass(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}function addClass(e,t){e.classList?e.classList.add(t):hasClass(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}var canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement),optionsSupported=!1,onceSupported=!1;try{var options={get passive(){return optionsSupported=!0},get once(){return onceSupported=optionsSupported=!0}};canUseDOM&&(window.addEventListener("test",options,options),window.removeEventListener("test",options,!0))}catch(e){}function addEventListener(e,t,r,n){if(n&&"boolean"!=typeof n&&!onceSupported){var i=n.once,a=n.capture,o=r;!onceSupported&&i&&(o=r.__once||function e(n){this.removeEventListener(t,e,a),r.call(this,n)},r.__once=o),e.addEventListener(t,o,optionsSupported?n:a)}e.addEventListener(t,r,n)}function ownerWindow(e){var t=ownerDocument(e);return t&&t.defaultView||window}function getComputedStyle(e,t){return ownerWindow(e).getComputedStyle(e,t)}var rUpper=/([A-Z])/g;function hyphenate(e){return e.replace(rUpper,"-$1").toLowerCase()}var msPattern=/^ms-/;function hyphenateStyleName(e){return hyphenate(e).replace(msPattern,"-ms-")}var supportedTransforms=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function isTransform(e){return!(!e||!supportedTransforms.test(e))}function style(e,t){var r="",n="";if("string"==typeof t)return e.style.getPropertyValue(hyphenateStyleName(t))||getComputedStyle(e).getPropertyValue(hyphenateStyleName(t));Object.keys(t).forEach((function(i){var a=t[i];a||0===a?isTransform(i)?n+=i+"("+a+") ":r+=hyphenateStyleName(i)+": "+a+";":e.style.removeProperty(hyphenateStyleName(i))})),n&&(r+="transform: "+n+";"),e.style.cssText+=";"+r}function removeEventListener(e,t,r,n){var i=n&&"boolean"!=typeof n?n.capture:n;e.removeEventListener(t,r,i),r.__once&&e.removeEventListener(t,r.__once,i)}function listen(e,t,r,n){return addEventListener(e,t,r,n),function(){removeEventListener(e,t,r,n)}}function triggerEvent(e,t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!0),e){var i=document.createEvent("HTMLEvents");i.initEvent(t,r,n),e.dispatchEvent(i)}}function parseDuration(e){var t=style(e,"transitionDuration")||"",r=-1===t.indexOf("ms")?1e3:1;return parseFloat(t)*r}function emulateTransitionEnd(e,t,r){void 0===r&&(r=5);var n=!1,i=setTimeout((function(){n||triggerEvent(e,"transitionend",!0)}),t+r),a=listen(e,"transitionend",(function(){n=!0}),{once:!0});return function(){clearTimeout(i),a()}}function transitionEnd(e,t,r,n){null==r&&(r=parseDuration(e)||0);var i=emulateTransitionEnd(e,r,n),a=listen(e,"transitionend",t);return function(){i(),a()}}var reset={transition:"","transition-duration":"","transition-delay":"","transition-timing-function":""};function _animate(e){var t=e.node,r=e.properties,n=e.duration,i=void 0===n?200:n,a=e.easing,o=e.callback,s=[],l={},u="";Object.keys(r).forEach((function(e){var t=r[e];isTransform(e)?u+=e+"("+t+") ":(l[e]=t,s.push(hyphenate(e)))})),u&&(l.transform=u,s.push("transform")),i>0&&(l.transition=s.join(", "),l["transition-duration"]=i/1e3+"s",l["transition-delay"]="0s",l["transition-timing-function"]=a||"linear");var c=transitionEnd(t,(function(e){e.target===e.currentTarget&&(style(t,reset),o&&o.call(this,e))}),i);return t.clientLeft,style(t,l),{cancel:function(){c(),style(t,reset)}}}function animate(e,t,r,n,i){if(!("nodeType"in e))return _animate(e);if(!t)throw new Error("must include properties to animate");return"function"==typeof n&&(i=n,n=""),_animate({node:e,properties:t,duration:r,easing:n,callback:i})}var prev=(new Date).getTime();function fallback(e){var t=(new Date).getTime(),r=Math.max(0,16-(t-prev)),n=setTimeout(e,r);return prev=t,n}var vendors=["","webkit","moz","o","ms"],cancelMethod="clearTimeout",rafImpl=fallback,getKey=function(e,t){return e+(e?t[0].toUpperCase()+t.substr(1):t)+"AnimationFrame"};canUseDOM&&vendors.some((function(e){var t=getKey(e,"request");return t in window&&(cancelMethod=getKey(e,"cancel"),rafImpl=function(e){return window[t](e)}),!!rafImpl}));var cancel=function(e){"function"==typeof window[cancelMethod]&&window[cancelMethod](e)},request$1=rafImpl,matchesImpl;function attribute(e,t,r){if(e){if(void 0===r)return e.getAttribute(t);r||""===r?e.setAttribute(t,String(r)):e.removeAttribute(t)}}function childElements(e){return e?Array.from(e.children):[]}function clear(e){if(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}return null}function matches(e,t){if(!matchesImpl){var r=document.body,n=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector;matchesImpl=function(e,t){return n.call(e,t)}}return matchesImpl(e,t)}function closest(e,t,r){e.closest&&!r&&e.closest(t);var n=e;do{if(matches(n,t))return n;n=n.parentElement}while(n&&n!==r&&n.nodeType===document.ELEMENT_NODE);return null}function contains(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):void 0}var toArray$1=Function.prototype.bind.call(Function.prototype.call,[].slice);function childNodes(e){return e?toArray$1(e.childNodes):[]}var toArray=Function.prototype.bind.call(Function.prototype.call,[].slice);function qsa(e,t){return toArray(e.querySelectorAll(t))}function filterEvents(e,t){return function(r){var n=r.currentTarget,i=r.target;qsa(n,e).some((function(e){return contains(e,i)}))&&t.call(this,r)}}function isDocument(e){return"nodeType"in e&&e.nodeType===document.DOCUMENT_NODE}function isWindow(e){return"window"in e&&e.window===e?e:isDocument(e)&&e.defaultView||!1}function getscrollAccessor(e){var t="pageXOffset"===e?"scrollLeft":"scrollTop";return function(r,n){var i=isWindow(r);if(void 0===n)return i?i[e]:r[t];i?i.scrollTo(i[e],n):r[t]=n}}var scrollLeft=getscrollAccessor("pageXOffset"),scrollTop=getscrollAccessor("pageYOffset");function offset(e){var t=ownerDocument(e),r={top:0,left:0,height:0,width:0},n=t&&t.documentElement;return n&&contains(n,e)?(void 0!==e.getBoundingClientRect&&(r=e.getBoundingClientRect()),r={top:r.top+scrollTop(n)-(n.clientTop||0),left:r.left+scrollLeft(n)-(n.clientLeft||0),width:r.width,height:r.height}):r}function height(e,t){var r=isWindow(e);return r?r.innerHeight:t?e.clientHeight:offset(e).height}function insertAfter(e,t){return e&&t&&t.parentNode?(t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e),e):null}var regExpInputs=/^(?:input|select|textarea|button)$/i;function isInput(e){return!!e&&regExpInputs.test(e.nodeName)}function isVisible(e){return!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}function collectSiblings(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null);for(var n=[];e;e=e.nextElementSibling)if(e!==t){if(r&&matches(e,r))break;n.push(e)}return n}function nextUntil(e,t){return collectSiblings(e,e,t)}var isHTMLElement=function(e){return!!e&&"offsetParent"in e};function offsetParent(e){for(var t=ownerDocument(e),r=e&&e.offsetParent;isHTMLElement(r)&&"HTML"!==r.nodeName&&"static"===style(r,"position");)r=r.offsetParent;return r||t.documentElement}function collectElements(e,t){var r=null,n=[];for(r=e?e[t]:null;r&&9!==r.nodeType;)n.push(r),r=r[t]||null;return n}function parents(e){return collectElements(e,"parentElement")}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}var nodeName=function(e){return e.nodeName&&e.nodeName.toLowerCase()},size;function position(e,t){var r,n={top:0,left:0};if("fixed"===style(e,"position"))r=e.getBoundingClientRect();else{var i=t||offsetParent(e);r=offset(e),"html"!==nodeName(i)&&(n=offset(i));var a=String(style(i,"borderTopWidth")||0);n.top+=parseInt(a,10)-scrollTop(i)||0;var o=String(style(i,"borderLeftWidth")||0);n.left+=parseInt(o,10)-scrollLeft(i)||0}var s=String(style(e,"marginTop")||0),l=String(style(e,"marginLeft")||0);return _extends({},r,{top:r.top-n.top-(parseInt(s,10)||0),left:r.left-n.left-(parseInt(l,10)||0)})}function prepend(e,t){return e&&t?(t.firstElementChild?t.insertBefore(e,t.firstElementChild):t.appendChild(e),e):null}function remove(e){return e&&e.parentNode?(e.parentNode.removeChild(e),e):null}function replaceClassName(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function removeClass(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=replaceClassName(e.className,t):e.setAttribute("class",replaceClassName(e.className&&e.className.baseVal||"",t))}function scrollbarSize(e){if((!size&&0!==size||e)&&canUseDOM){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),size=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return size}function scrollParent(e,t){var r=style(e,"position"),n="absolute"===r,i=e.ownerDocument;if("fixed"===r)return i||document;for(;(e=e.parentNode)&&!isDocument(e);){var a=n&&"static"===style(e,"position"),o=(style(e,"overflow")||"")+(style(e,"overflow-y")||"")+style(e,"overflow-x");if(!a&&(/(auto|scroll)/.test(o)&&(t||height(e)<e.scrollHeight)))return e}return i||document}function scrollTo(e,t){var r=offset(e),n={top:0,left:0};if(e){var i=t||scrollParent(e),a=isWindow(i),o=scrollTop(i),s=height(i,!0);a||(n=offset(i));var l=(r={top:r.top-n.top,left:r.left-n.left,height:r.height,width:r.width}).height,u=r.top+(a?0:o),c=u+l;o=o>u?u:c>o+s?c-s:o;var d=request$1((function(){return scrollTop(i,o)}));return function(){return cancel(d)}}}function siblings(e){return collectSiblings(e&&e.parentElement?e.parentElement.firstElementChild:null,e)}var regExpNbspEntity=/&nbsp;/gi,regExpNbspHex=/\xA0/g,regExpSpaces=/\s+([^\s])/gm;function text(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var n="";return e&&(n=(e.textContent||"").replace(regExpNbspEntity," ").replace(regExpNbspHex," "),t&&(n=n.trim()),r&&(n=n.replace(regExpSpaces," $1"))),n}function toggleClass(e,t){e.classList?e.classList.toggle(t):hasClass(e,t)?removeClass(e,t):addClass(e,t)}function getWidth(e,t){var r=isWindow(e);return r?r.innerWidth:t?e.clientWidth:offset(e).width}var helpers={addEventListener:addEventListener,removeEventListener:removeEventListener,triggerEvent:triggerEvent,animate:animate,filter:filterEvents,listen:listen,style:style,getComputedStyle:getComputedStyle,attribute:attribute,activeElement:activeElement,ownerDocument:ownerDocument,ownerWindow:ownerWindow,requestAnimationFrame:request$1,cancelAnimationFrame:cancel,matches:matches,height:height,width:getWidth,offset:offset,offsetParent:offsetParent,position:position,contains:contains,scrollbarSize:scrollbarSize,scrollLeft:scrollLeft,scrollParent:scrollParent,scrollTo:scrollTo,scrollTop:scrollTop,querySelectorAll:qsa,closest:closest,addClass:addClass,removeClass:removeClass,hasClass:hasClass,toggleClass:toggleClass,transitionEnd:transitionEnd,childNodes:childNodes,childElements:childElements,nextUntil:nextUntil,parents:parents,siblings:siblings,clear:clear,insertAfter:insertAfter,isInput:isInput,isVisible:isVisible,prepend:prepend,remove:remove,text:text},Slider=function(){function e(t,r){_classCallCheck$j(this,e),this.ticks=[],this.range=[0,100],this.currentValue=0,this.currentTick={name:"",val:0,renderVal:0},this.buttonStatus=1,this.startClientX=0,this.wrapperWidth=1,this.wrapperLeft=0,this.handleChange=function(){},this.parent=t,this.ticks=r.ticks,this.itemProps=r,this.sliderTitle=document.createElement("div"),this.sliderTitle.innerHTML=r.name,this.sliderContent=document.createElement("div"),this.sliderValue=document.createElement("div"),this.wrapper=document.createElement("div"),this.inner=document.createElement("div"),this.button=document.createElement("div"),helpers.addClass(this.wrapper,"wrapper"),helpers.addClass(this.parent,"xg-player-slider"),helpers.addClass(this.sliderContent,"line-slider"),helpers.addClass(this.sliderTitle,"line-title"),helpers.addClass(this.sliderValue,"line-value"),this.renderTicks(),this.rendInner(),this.parent.appendChild(this.sliderTitle),this.parent.appendChild(this.sliderContent),this.parent.appendChild(this.sliderValue),this.sliderContent.appendChild(this.wrapper),this.bindEvents(),this.setValue(r.defaultValue)}return _createClass$k(e,[{key:"renderTicks",value:function(){var e=this.wrapper,t=document.createElement("div");helpers.addClass(t,"ticks");for(var r=1;r<this.ticks.length-1;r++){var n=this.ticks[r],i=document.createElement("div");helpers.addClass(i,"tick"),helpers.style(i,{left:n.val+"%"}),t.appendChild(i)}e.appendChild(t)}},{key:"rendInner",value:function(){var e=this.wrapper,t=this.inner;helpers.addClass(t,"inner");var r=this.button;helpers.addClass(r,"button"),e.appendChild(t),e.appendChild(r)}},{key:"bindEvents",value:function(){helpers.addEventListener(this.wrapper,"click",this.onClick.bind(this)),helpers.addEventListener(this.button,"touchstart",this.onTouchStart.bind(this)),helpers.addEventListener(this.button,"touchmove",throttle$1(this.onTouchmove.bind(this),30)),helpers.addEventListener(this.button,"touchend",this.onTouchend.bind(this)),helpers.addEventListener(this.button,"touchcancel",this.onTouchend.bind(this))}},{key:"setValue",value:function(e){var t=this;if(e>this.range[1]||e<this.range[0])return!1;this.currentTick=this.getCurrentTick(e),this.currentValue=this.currentTick.val;var r=this.currentValue+"%";return setTimeout((function(){helpers.style(t.inner,{width:r}),helpers.style(t.button,{left:r})})),this.sliderValue.innerHTML=this.currentTick.name,this.handleChange(this.currentValue),!0}},{key:"renderText",value:function(e){var t=this;this.ticks=e.ticks,this.itemProps=e,this.sliderTitle.innerHTML=e.name,this.currentTick=this.ticks.filter((function(e){return e.val===t.currentValue}))[0],this.sliderValue.innerHTML=this.currentTick.name}},{key:"onChange",value:function(e){this.handleChange=e}},{key:"getCurrentTick",value:function(e){for(var t=0;t<this.ticks.length-1;t++)if(this.ticks[t].val<=e&&this.ticks[t+1].val>=e)return e-this.ticks[t].val>this.ticks[t+1].val-e?this.ticks[t+1]:this.ticks[t];return this.ticks[0]}},{key:"onMousedown",value:function(e){this.startClientX=e.clientX,this.onStart()}},{key:"onTouchStart",value:function(e){e.stopPropagation(),this.startClientX=e.touches[0].clientX,this.onStart()}},{key:"onStart",value:function(){this.buttonStatus=2;var e=helpers.offset(this.wrapper);this.wrapperWidth=e.width,this.wrapperLeft=e.left}},{key:"onMousemove",value:function(e){if(2===this.buttonStatus){var t=e.clientX-this.startClientX;this.onMove(t)}}},{key:"onTouchmove",value:function(e){e.stopPropagation();var t=e.touches[0].clientX-this.startClientX;this.onMove(t)}},{key:"onMove",value:function(e){var t=this.startClientX+e;if(!(t-this.wrapperLeft<0||t-this.wrapperLeft>this.wrapperWidth)){this.startClientX=this.startClientX+e;var r=(this.startClientX-this.wrapperLeft)*(this.range[1]-this.range[0])/this.wrapperWidth;helpers.style(this.inner,{width:r+"%"}),helpers.style(this.button,{left:r+"%"})}}},{key:"onMouseup",value:function(e){console.log("mouse up",e.clientX),this.onEnd()}},{key:"onTouchend",value:function(){this.onEnd()}},{key:"onEnd",value:function(){this.buttonStatus=3;var e=(this.startClientX-this.wrapperLeft)*(this.range[1]-this.range[0])/this.wrapperWidth;this.setValue(e)}},{key:"onClick",value:function(e){e.stopPropagation();var t=helpers.offset(this.wrapper);this.wrapperWidth=t.width,this.wrapperLeft=t.left;var r=(e.clientX-this.wrapperLeft)*(this.range[1]-this.range[0])/this.wrapperWidth;this.setValue(r)}}]),e}(),zh={danmuSwitch:"",danmuSetting:"",openDanmu:"",reset:"",opacity:"",area:"",speed:"",fontSize:"",danmuMask:"",screen0:"1/4",screen1:"",screen2:"3/4",screen3:"",opacity0:"0",opacity1:"1/3",opacity2:"2/3",opacity3:"1",speed0:"0.25",speed1:"0.5",speed2:"",speed3:"1.25",speed4:"1.5",speed5:"2",fontSize0:"",fontSize1:"",fontSize2:""},en={danmuSwitch:"Barrage switch",danmuSetting:"Barrage settings",openDanmu:"Open Barrage",reset:"Reset",opacity:"Opacity",area:"Display  area",speed:"Barrage speed",fontSize:"Font size",danmuMask:"Intelligent blocking",screen0:"1/4 screen",screen1:"Half screen",screen2:"3/4 screen",screen3:"Full screen",opacity0:"0",opacity1:"1/3",opacity2:"2/3",opacity3:"1",speed0:"0.25",speed1:"0.5",speed2:"Normal",speed3:"1.25",speed4:"1.5",speed5:"2",fontSize0:"Minimal",fontSize1:"Moderate",fontSize2:"Great"},jp=en,zhHK={danmuSwitch:"",danmuSetting:"",openDanmu:"",reset:"",opacity:"",area:"",speed:"",fontSize:"",danmuMask:"",screen0:"1/4",screen1:"",screen2:"3/4",screen3:"",opacity0:"0",opacity1:"1/3",opacity2:"2/3",opacity3:"1",speed0:"0.25",speed1:"0.5",speed2:"",speed3:"1.25",speed4:"1.5",speed5:"2",fontSize0:"",fontSize1:"",fontSize2:""},lang={zh:zh,"zh-cn":zh,en:en,jp:jp,"zh-hk":zhHK},State=function(){function e(t){_classCallCheck$j(this,e),this.curLang="en",this._defaultConfig={opacity:99,area:99,fontSize:50,speed:40,active:!1,usePanel:!0,danmuItems:[],maskConfig:{maskUrl:"",maskOffset:0,interval:200},maskActive:!1,external:[]},Object.assign(this._defaultConfig,t)}return _createClass$k(e,[{key:"updateLang",value:function(e){this.curLang=e,this.curLangMap=lang[e]||lang.en;var t=this.curLangMap;this.sliderItemsProps=[{key:"opacity",name:t.opacity,defaultValue:99,ticks:[{name:t.opacity0,val:0,renderVal:0},{name:t.opacity1,val:33,renderVal:.33},{name:t.opacity2,val:66,renderVal:.66},{name:t.opacity3,val:99,renderVal:1}]},{key:"area",name:t.area,defaultValue:99,ticks:[{name:t.screen0,val:0,renderVal:1/4},{name:t.screen1,val:33,renderVal:.5},{name:t.screen2,val:66,renderVal:3/4},{name:t.screen3,val:99,renderVal:1}]},{key:"speed",name:t.speed,defaultValue:40,ticks:[{name:t.speed0,val:0,renderVal:1/4},{name:t.speed1,val:20,renderVal:.5},{name:t.speed2,val:40,renderVal:1},{name:t.speed3,val:60,renderVal:5/4},{name:t.speed4,val:80,renderVal:1.5},{name:t.speed5,val:100,renderVal:2}]},{key:"fontSize",name:t.fontSize,defaultValue:50,ticks:[{name:t.fontSize0,val:0,renderVal:14},{name:t.fontSize1,val:50,renderVal:16},{name:t.fontSize2,val:100,renderVal:20}]}],this._defaultConfig.external.forEach((function(t){t.name=t.lang[e]||t.lang.en}))}},{key:"getConfig",value:function(){return this._defaultConfig}},{key:"updateConfig",value:function(e){Object.assign(this._defaultConfig,e)}},{key:"updateComments",value:function(e){this._defaultConfig.danmuItems=e}},{key:"getRenderVal",value:function(e,t){var r=this.sliderItemsProps.find((function(t){return t.key===e}))||this.sliderItemsProps[0];return(r.ticks.find((function(e){return e.val===t}))||r.ticks[0]).renderVal}}]),e}(),dist$2={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$b(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n={createDom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=n,i.innerHTML=t,Object.keys(r).forEach((function(t){var n=t,a=r[t];"video"===e||"audio"===e?a&&i.setAttribute(n,a):i.setAttribute(n,a)})),i},hasClass:function(e,t){return e.classList?Array.prototype.some.call(e.classList,(function(e){return e===t})):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)})):n.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){e.classList?t.split(/\s+/g).forEach((function(t){e.classList.remove(t)})):n.hasClass(e,t)&&t.split(/\s+/g).forEach((function(t){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(r," ")}))},toggleClass:function(e,t){t.split(/\s+/g).forEach((function(t){n.hasClass(e,t)?n.removeClass(e,t):n.addClass(e,t)}))},findDom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments[1],r=void 0;try{r=e.querySelector(t)}catch(n){t.startsWith("#")&&(r=e.getElementById(t.slice(1)))}return r},deepCopy:function(e,t){if("Object"===n.typeOf(t)&&"Object"===n.typeOf(e))return Object.keys(t).forEach((function(r){"Object"!==n.typeOf(t[r])||t[r]instanceof Node?"Array"===n.typeOf(t[r])?e[r]="Array"===n.typeOf(e[r])?e[r].concat(t[r]):t[r]:e[r]=t[r]:e[r]?n.deepCopy(e[r],t[r]):e[r]=t[r]})),e},typeOf:function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},copyDom:function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},formatTime:function(e){var t=Math.floor(e);return 1e3*t+(e-t)},offInDestroy:function(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))},on:function(e,t,r,i){i?(e.on(t,r),n.offInDestroy(e,t,r,i)):e.on(t,(function n(i){r(i),e.off(t,n)}))},style:function(e,t,r){var n=e.style;try{n[t]=r}catch(i){n.setProperty(t,r)}}};t.default=n,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(26))&&n.__esModule?n:{default:n},o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"setLogger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.logger=new a.default(e+".js")}}]),e}();t.default=o,e.exports=t.default},function(e,t,r){var n=r(19)();e.exports=function(e){return e!==n&&null!==e}},function(e,t,r){e.exports=function(e){return null!=e}},function(e,t,r){e.exports=r(5)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r(6))&&n.__esModule?n:{default:n};r(34),t.default=i.default,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=d(r(7)),a=d(r(1)),o=d(r(27)),s=d(r(31)),l=d(r(0)),u=r(32),c=r(33);function d(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}var f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.setLogger("danmu"),r.logger&&r.logger.info("danmu.js version: "+u.version);var n=r;if(n.config=l.default.deepCopy({overlap:!1,area:{start:0,end:1},live:!1,comments:[],direction:"r2l",needResizeObserver:!1},e),n.hideArr=[],n.domObj=new s.default,(0,i.default)(n),n.config.comments.forEach((function(e){e.duration=e.duration?e.duration:5e3,e.mode||(e.mode="scroll")})),!n.config.container||1!==n.config.container.nodeType)return n.emit("error","container id can't be empty"),h(r,!1);if(n.container=n.config.container,n.config.containerStyle){var a=n.config.containerStyle;Object.keys(a).forEach((function(e){n.container.style[e]=a[e]}))}return n.live=n.config.live,n.player=n.config.player,n.direction=n.config.direction,l.default.addClass(n.container,"danmu"),n.bulletBtn=new o.default(n),n.isReady=!0,n.emit("ready"),r.logger&&r.logger.info("ready"),r.addResizeObserver(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"addResizeObserver",value:function(){var e=this;this.config.needResizeObserver&&(0,c.addObserver)(this.container,(function(){e.logger&&e.logger.info("needResizeObserver"),e.resize()}))}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.bulletBtn.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.bulletBtn.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.bulletBtn.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.bulletBtn.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.bulletBtn.main.clear()}},{key:"destroy",value:function(){for(var e in(0,c.unObserver)(this.container),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn.destroy(),this.domObj.destroy(),this)delete this[e];this.emit("destroy")}},{key:"sendComment",value:function(e){this.logger&&this.logger.info("sendComment: "+(e.txt||"[DOM Element]")),e.duration||(e.duration=15e3),e&&e.id&&e.duration&&(e.el||e.txt)&&(e.duration=e.duration?e.duration:5e3,e.style||(e.style={opacity:void 0,fontSize:void 0}),e.style&&(this.opacity&&this.opacity!==e.style.opacity&&(e.style.opacity=this.opacity),this.fontSize&&this.fontSize!==e.style.fontSize&&(e.style.fontSize=this.fontSize)),e.prior||e.realTime?(this.bulletBtn.main.data.unshift(e),e.realTime&&(this.bulletBtn.main.readData(),this.bulletBtn.main.dataHandle())):this.bulletBtn.main.data.push(e))}},{key:"setCommentID",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentID: oldID "+e+" newID "+t);var n=this.container.getBoundingClientRect();e&&t&&(this.bulletBtn.main.data.some((function(r){return r.id===e&&(r.id=t,!0)})),this.bulletBtn.main.queue.some((function(i){return i.id===e&&(i.id=t,i.pauseMove(n),"paused"!==r.bulletBtn.main.status&&i.startMove(n),!0)})))}},{key:"setCommentDuration",value:function(e,t){var r=this;this.logger&&this.logger.info("setCommentDuration: id "+e+" duration "+t);var n=this.container.getBoundingClientRect();e&&t&&(t=t||5e3,this.bulletBtn.main.data.some((function(r){return r.id===e&&(r.duration=t,!0)})),this.bulletBtn.main.queue.some((function(i){return i.id===e&&(i.duration=t,i.pauseMove(n),"paused"!==r.bulletBtn.main.status&&i.startMove(n),!0)})))}},{key:"setCommentLike",value:function(e,t){this.logger&&this.logger.info("setCommentLike: id "+e+" like "+t);var r=this.container.getBoundingClientRect();e&&t&&(this.bulletBtn.main.data.some((function(r){return r.id===e&&(r.like=t,!0)})),this.bulletBtn.main.queue.some((function(n){return n.id===e&&(n.pauseMove(r),n.setLikeDom(t.el,t.style),"paused"!==n.danmu.bulletBtn.main.status&&n.startMove(r),!0)})))}},{key:"restartComment",value:function(e){this.logger&&this.logger.info("restartComment: id "+e),this.mouseControl=!1;var t=this.container.getBoundingClientRect();e&&this.bulletBtn.main.queue.some((function(r){return r.id===e&&("paused"!==r.danmu.bulletBtn.main.status?r.startMove(t,!0):r.status="paused",!0)}))}},{key:"freezeComment",value:function(e){this.logger&&this.logger.info("freezeComment: id "+e),this.mouseControl=!0;var t=this.container.getBoundingClientRect();e&&this.bulletBtn.main.queue.some((function(r){return r.id===e&&(r.status="forcedPause",r.pauseMove(t),r.el&&r.el.style&&l.default.style(r.el,"zIndex",10),!0)}))}},{key:"removeComment",value:function(e){this.logger&&this.logger.info("removeComment: id "+e),e&&(this.bulletBtn.main.queue.some((function(t){return t.id===e&&(t.remove(),!0)})),this.bulletBtn.main.data=this.bulletBtn.main.data.filter((function(t){return t.id!==e})))}},{key:"updateComments",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(this.bulletBtn.main.data=[]),this.bulletBtn.main.data=this.bulletBtn.main.data.concat(e)}},{key:"setAllDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",t=arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger&&this.logger.info("setAllDuration: mode "+e+" duration "+t+" force "+r);var n=this.container.getBoundingClientRect();t&&(t=t||5e3,r&&(this.bulletBtn.main.forceDuration=t),this.bulletBtn.main.data.forEach((function(r){e===r.mode&&(r.duration=t)})),this.bulletBtn.main.queue.forEach((function(r){e===r.mode&&(r.duration=t,r.pauseMove(n),"paused"!==r.danmu.bulletBtn.main.status&&r.startMove(n))})))}},{key:"setOpacity",value:function(e){this.logger&&this.logger.info("setOpacity: opacity "+e),this.container.style.opacity=e}},{key:"setFontSize",value:function(e,t){var r=this;this.logger&&this.logger.info("setFontSize: size "+e+" channelSize "+t),this.fontSize=e+"px",e&&(this.bulletBtn.main.data.forEach((function(e){e.style&&(e.style.fontSize=r.fontSize)})),this.bulletBtn.main.queue.forEach((function(e){e.options.style||(e.options.style={}),e.options.style.fontSize=r.fontSize,e.setFontSize(r.fontSize),t&&(e.top=e.channel_id[0]*t,e.topInit())}))),t&&(this.config.channelSize=t,this.bulletBtn.main.channel.resize(!0))}},{key:"setArea",value:function(e){this.logger&&this.logger.info("setArea: area "+e),this.config.area=e,this.bulletBtn.main.channel.resize(!0)}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode "+e),this.hideArr.indexOf(e)<0&&this.hideArr.push(e),this.bulletBtn.main.queue.filter((function(t){return e===t.mode||"color"===e&&t.color})).forEach((function(e){return e.remove()}))}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode "+e);var t=this.hideArr.indexOf(e);t>-1&&this.hideArr.splice(t,1)}},{key:"setDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction "+e),this.emit("changeDirection",e)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}}]),t}(a.default);t.default=f,e.exports=t.default},function(e,t,r){var n,i,a,o,s,l,u,c=r(8),d=r(25),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,y=Object.defineProperty,m=Object.defineProperties,g=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var r,i;return d(t),i=this,n.call(this,e,r=function(){a.call(i,e,r),h.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:n=function(e,t){var r;return d(t),g.call(this,"__ee__")?r=this.__ee__:(r=v.value=p(null),y(this,"__ee__",v),v.value=null),r[e]?"object"==_typeof$b(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:i,off:a=function(e,t){var r,n,i,a;if(d(t),!g.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==_typeof$b(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:o=function(e){var t,r,n,i,a;if(g.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==_typeof$b(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)h.call(n,this,a)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];h.call(i,this,a)}}},l={on:c(n),once:c(i),off:c(a),emit:c(o)},u=m({},l),e.exports=t=function(e){return null==e?p(u):m(Object(e),l)},t.methods=s},function(e,t,r){var n=r(3),i=r(9),a=r(13),o=r(21),s=r(22);(e.exports=function(e,t){var r,i,l,u,c;return arguments.length<2||"string"!=typeof e?(u=t,t=e,e=null):u=arguments[2],n(e)?(r=s.call(e,"c"),i=s.call(e,"e"),l=s.call(e,"w")):(r=l=!0,i=!1),c={value:t,configurable:r,enumerable:i,writable:l},u?a(o(u),c):c}).gs=function(e,t,r){var l,u,c,d;return"string"!=typeof e?(c=r,r=t,t=e,e=null):c=arguments[3],n(t)?i(t)?n(r)?i(r)||(c=r,r=void 0):r=void 0:(c=t,t=r=void 0):t=void 0,n(e)?(l=s.call(e,"c"),u=s.call(e,"e")):(l=!0,u=!1),d={get:t,set:r,configurable:l,enumerable:u},c?a(o(c),d):d}},function(e,t,r){var n=r(10),i=/^\s*class[\s{/}]/,a=Function.prototype.toString;e.exports=function(e){return!!n(e)&&!i.test(a.call(e))}},function(e,t,r){var n=r(11);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(t){return!1}return!n(e)}},function(e,t,r){var n=r(12);e.exports=function(e){if(!n(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}}},function(e,t,r){var n=r(3),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!n(e)&&hasOwnProperty.call(i,_typeof$b(e))}},function(e,t,r){e.exports=r(14)()?Object.assign:r(15)},function(e,t,r){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,r){var n=r(16),i=r(20),a=Math.max;e.exports=function(e,t){var r,o,s,l=a(arguments.length,2);for(e=Object(i(e)),s=function(n){try{e[n]=t[n]}catch(i){r||(r=i)}},o=1;o<l;++o)n(t=arguments[o]).forEach(s);if(void 0!==r)throw r;return e}},function(e,t,r){e.exports=r(17)()?Object.keys:r(18)},function(e,t,r){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,r){var n=r(2),i=Object.keys;e.exports=function(e){return i(n(e)?Object(e):e)}},function(e,t,r){e.exports=function(){}},function(e,t,r){var n=r(2);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,r){var n=r(2),i=Array.prototype.forEach,a=Object.create,o=function(e,t){var r;for(r in e)t[r]=e[r]};e.exports=function(e){var t=a(null);return i.call(arguments,(function(e){n(e)&&o(Object(e),t)})),t}},function(e,t,r){e.exports=r(23)()?String.prototype.contains:r(24)},function(e,t,r){var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},function(e,t,r){var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.constructorName=t||""}return n(e,[{key:"info",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];i&&(t=console).log.apply(t,["[Danmu Log]["+this.constructorName+"]",e].concat(n))}}]),e}();t.default=a,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(1)),a=s(r(0)),o=s(r(28));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setLogger("control"),r.danmu=e,r.main=new o.default(e),e.config.defaultOff||r.main.start(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"createSwitch",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=a.default.createDom("dk-switch",'<span class="txt"></span>',{},"danmu-switch "+(e?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)delete this[e]}}]),t}(i.default);t.default=l,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=l(r(1)),a=l(r(29)),o=l(r(30)),s=l(r(0));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.setLogger("main"),r.danmu=e,r.container=e.container,r.channel=new a.default(e),r.data=[].concat(e.config.comments),r.playedData=[],r.queue=[],r.timer=null,r.retryTimer=null,r.retryStatus="normal",r.interval=e.config.interval||2e3,r.status="idle",s.default.on(e,"bullet_remove",r.updateQueue.bind(r),"destroy");var n=r;return s.default.on(r.danmu,"changeDirection",(function(e){n.danmu.direction=e}),"destroy"),r.nums=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),clearTimeout(this.dataHandleTimer),this.channel.destroy(),this.data=[],this)delete this[e]}},{key:"updateQueue",value:function(e){this.logger&&this.logger.info("updateQueue");var t=this;t.queue.some((function(r,n){return r.id===e.bullet.id&&(t.queue.splice(n,1),!0)})),t.data.some((function(t,r){return t.id===e.bullet.id&&(t.hasAttached=!1,!0)}))}},{key:"init",value:function(e,t){t.logger&&t.logger.info("init"),t||(t=this),t.retryStatus="normal",t.data.sort((function(e,t){return e.start-t.start})),t.retryTimer||function e(){"closed"===t.status&&"stop"===t.retryStatus||("playing"===t.status&&(t.readData(),t.dataHandle()),"stop"===t.retryStatus&&"paused"!==t.status||(t.dataHandleTimer=setTimeout((function(){e()}),t.interval-1e3)))}()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.status="playing",this.queue=[],this.container.innerHTML="",this.channel.resetWithCb(this.init,this)}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.status="closed",this.retryTimer=null,this.retryStatus="stop",this.channel.reset(),this.queue=[],this.container.innerHTML=""}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel.reset(),this.data=[],this.queue=[],this.container.innerHTML=""}},{key:"play",value:function(){var e=this;this.logger&&this.logger.info("play"),this.status="playing";var t=this.channel.channels,r=this.danmu.container.getBoundingClientRect();t&&t.length>0&&["scroll","top","bottom"].forEach((function(n){e.queue.forEach((function(e){e.startMove(r),e.resized=!0}));for(var i=0;i<t.length;i++)t[i].queue[n].forEach((function(e){e.resized=!1}))}))}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.status="paused";var e=this.channel.channels,t=this.danmu.container.getBoundingClientRect();e&&e.length>0&&this.queue.forEach((function(e){e.pauseMove(t)}))}},{key:"dataHandle",value:function(){var e=this;"paused"!==this.status&&"closed"!==this.status&&e.queue.length&&e.queue.forEach((function(t){"waiting"===t.status&&t.startMove(e.channel.containerPos)}))}},{key:"readData",value:function(){var e=this,t=this.danmu;if(t.isReady){var r=0;t.player&&t.player.currentTime&&(r=s.default.formatTime(t.player.currentTime));var n=void 0,i=e.interval,a=e.channel,l=void 0;t.player?(l=e.data.filter((function(t){return!t.start&&e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&(t.start=r),e.danmu.hideArr.indexOf(t.mode)<0&&(!t.color||e.danmu.hideArr.indexOf("color")<0)&&t.start-i<=r&&r<=t.start+i})),t.live&&(e.data=[])):0===(l=e.data.splice(0,1)).length&&(l=e.playedData.splice(0,1)),l.length>0&&l.forEach((function(r){if(e.forceDuration&&e.forceDuration!=r.duration&&(r.duration=e.forceDuration),(n=new o.default(t,r))&&!n.bulletCreateFail)if(r.hasAttached){for(var i in n.detach(),n)delete n[i];n=null,r.hasAttached=!1,r.noDiscard&&(r.prior?e.data.unshift(r):e.data.push(r))}else if(n.attach(),r.hasAttached=!0,a.addBullet(n).result)e.queue.push(n),e.nums++,n.topInit();else{for(var s in n.detach(),n)delete n[s];n=null,r.hasAttached=!1,r.noDiscard&&(r.prior?e.data.unshift(r):e.data.push(r))}}))}}}]),t}(i.default);t.default=u,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=o(r(1)),a=o(r(0));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.setLogger("channel"),r.danmu=e,r.reset(!0);var n=r;return a.default.on(r.danmu,"bullet_remove",(function(e){n.removeBullet(e.bullet)}),"destroy"),r.direction=e.direction,a.default.on(r.danmu,"changeDirection",(function(e){n.direction=e}),"destroy"),r.containerPos=r.danmu.container.getBoundingClientRect(),r.containerWidth=r.containerPos.width,r.containerHeight=r.containerPos.height,r.containerLeft=r.containerPos.left,r.containerRight=r.containerPos.right,a.default.on(r.danmu,"channel_resize",(function(){n.containerPos=n.danmu.container.getBoundingClientRect(),n.resizing||(n.containerWidth=n.containerPos.width,n.containerHeight=n.containerPos.height,n.containerLeft=n.containerPos.left,n.containerRight=n.containerPos.right,n.resize(!0))}),"destroy"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),clearTimeout(this.resizeTimer),this.channels=[],this)delete this[e]}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("resize");var t=this.danmu.container,r=this;r.resizing||(r.resizing=!0,this.resizeTimer=setTimeout((function(){r.danmu.bulletBtn.main.data&&r.danmu.bulletBtn.main.data.forEach((function(e){e.bookChannelId&&(delete e.bookChannelId,r.logger&&r.logger.info("resize"+e.id+""))})),r.logger&&r.logger.info("resize");var n=t.getBoundingClientRect();r.width=n.width,r.height=n.height,r.danmu.config.area&&r.danmu.config.area.start>=0&&r.danmu.config.area.end>=r.danmu.config.area.start&&("b2t"===r.direction?r.width=r.width*(r.danmu.config.area.end-r.danmu.config.area.start):r.height=r.height*(r.danmu.config.area.end-r.danmu.config.area.start)),r.container=t;var i=r.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),a=void 0;a="b2t"===r.direction?Math.floor(r.width/i):Math.floor(r.height/i);for(var o=[],s=0;s<a;s++)o[s]={id:s,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};if(r.channels&&r.channels.length<=o.length){for(var l=function(t){o[t]={id:t,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top"].forEach((function(n){r.channels[t].queue[n].forEach((function(i){i.el&&(o[t].queue[n].push(i),i.resized||(i.pauseMove(r.containerPos,e),"paused"!==i.danmu.bulletBtn.main.status&&i.startMove(r.containerPos),i.resized=!0))}))})),r.channels[t].queue.bottom.forEach((function(n){if(n.el){if(o[t+o.length-r.channels.length].queue.bottom.push(n),n.channel_id[0]+n.channel_id[1]-1===t){var a=[].concat(n.channel_id);n.channel_id=[a[0]-r.channels.length+o.length,a[1]],n.top=n.channel_id[0]*i,r.danmu.config.area&&r.danmu.config.area.start&&(n.top+=r.containerHeight*r.danmu.config.area.start),n.topInit()}n.resized||(n.pauseMove(r.containerPos,e),"paused"!==n.danmu.bulletBtn.main.status&&n.startMove(r.containerPos),n.resized=!0)}}))},u=0;u<r.channels.length;u++)l(u);for(var c=function(e){["scroll","top","bottom"].forEach((function(t){o[e].queue[t].forEach((function(e){e.resized=!1}))}))},d=0;d<o.length;d++)c(d);r.channels=o,"b2t"===r.direction?r.channelWidth=i:r.channelHeight=i}else if(r.channels&&r.channels.length>o.length){for(var h=function(t){o[t]={id:t,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top","bottom"].forEach((function(n){if("top"===n&&t>Math.floor(o.length/2));else if("bottom"===n&&t<=Math.floor(o.length/2));else{var a="bottom"===n?t-o.length+r.channels.length:t;r.channels[a].queue[n].forEach((function(s,l){if(s.el){if(o[t].queue[n].push(s),"bottom"===n&&s.channel_id[0]+s.channel_id[1]-1===a){var u=[].concat(s.channel_id);s.channel_id=[u[0]-r.channels.length+o.length,u[1]],s.top=s.channel_id[0]*i,r.danmu.config.area&&r.danmu.config.area.start&&(s.top+=r.containerHeight*r.danmu.config.area.start),s.topInit()}s.pauseMove(r.containerPos,e),"paused"!==s.danmu.bulletBtn.main.status&&s.startMove(r.containerPos),s.resized||(s.resized=!0)}r.channels[a].queue[n].splice(l,1)}))}}))},f=0;f<o.length;f++)h(f);for(var p=function(e){["scroll","top","bottom"].forEach((function(t){o[e].queue[t].forEach((function(e){e.resized=!1}))}))},y=0;y<o.length;y++)p(y);r.channels=o,"b2t"===r.direction?r.channelWidth=i:r.channelHeight=i}r.resizing=!1}),10))}},{key:"addBullet",value:function(e){var t=this,r=this.danmu,n=this.channels,i=void 0,a=void 0,o=void 0;if("b2t"===t.direction?(a=this.channelWidth,o=Math.ceil(e.width/a)):(i=this.channelHeight,o=Math.ceil(e.height/i)),o>n.length)return{result:!1,message:"exceed channels.length, occupy="+o+",channelsSize="+n.length};for(var s=!0,l=void 0,u=-1,c=0,d=n.length;c<d;c++)if(n[c].queue[e.mode].some((function(t){return t.id===e.id})))return{result:!1,message:"exsited, channelOrder="+c+",danmu_id="+e.id};if("scroll"===e.mode)for(var h=0,f=n.length-o;h<=f;h++){s=!0;for(var p=h;p<h+o;p++){if((l=n[p]).operating.scroll){s=!1;break}if(l.bookId.scroll&&l.bookId.scroll!==e.id){s=!1;break}l.operating.scroll=!0;var y=l.queue.scroll[0];if(y){var m=y.el.getBoundingClientRect();if("b2t"===t.direction){if(m.bottom>t.containerPos.bottom){s=!1,l.operating.scroll=!1;break}}else if(m.right>t.containerPos.right){s=!1,l.operating.scroll=!1;break}var g,v=void 0,b=void 0,_=void 0,E=void 0;if("b2t"===t.direction?(b=(m.top-t.containerPos.top+m.height)/(v=(t.containerPos.height+m.height)/y.duration),_=t.containerPos.height,E=(t.containerPos.height+e.height)/e.duration):(b=(m.left-t.containerPos.left+m.width)/(v=(t.containerPos.width+m.width)/y.duration),_=t.containerPos.width,E=(t.containerPos.width+e.width)/e.duration),g=_/E,r.config.bOffset||(r.config.bOffset=0),v<E&&b+r.config.bOffset>g){s=!1,l.operating.scroll=!1;break}}l.operating.scroll=!1}if(s){u=h;break}}else if("top"===e.mode)for(var T=0,S=n.length-o;T<=S;T++){s=!0;for(var $=T;$<T+o;$++){if($>Math.floor(n.length/2)){s=!1;break}if((l=n[$]).operating[e.mode]){s=!1;break}if((l.bookId[e.mode]||e.prior)&&l.bookId[e.mode]!==e.id){s=!1;break}if(l.operating[e.mode]=!0,l.queue[e.mode].length>0){s=!1,l.operating[e.mode]=!1;break}l.operating[e.mode]=!1}if(s){u=T;break}}else if("bottom"===e.mode)for(var A=n.length-o;A>=0;A--){s=!0;for(var w=A;w<A+o;w++){if(w<=Math.floor(n.length/2)){s=!1;break}if((l=n[w]).operating[e.mode]){s=!1;break}if((l.bookId[e.mode]||e.prior)&&l.bookId[e.mode]!==e.id){s=!1;break}if(l.operating[e.mode]=!0,l.queue[e.mode].length>0){s=!1,l.operating[e.mode]=!1;break}l.operating[e.mode]=!1}if(s){u=A;break}}if(-1!==u){for(var k=u,I=u+o;k<I;k++)(l=n[k]).operating[e.mode]=!0,l.queue[e.mode].unshift(e),e.prior&&(delete l.bookId[e.mode],t.logger&&t.logger.info(k+"")),l.operating[e.mode]=!1;return e.prior&&(t.logger&&t.logger.info(e.id+""),delete e.bookChannelId,r.player&&r.bulletBtn.main.data.some((function(t){return t.id===e.id&&(delete t.bookChannelId,!0)}))),e.channel_id=[u,o],"b2t"===t.direction?(e.top=u*a,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerWidth*t.danmu.config.area.start)):(e.top=u*i,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start)),{result:e,message:"success"}}if(e.options.realTime){var C=0,P=-1,x=null;if(t.danmu.bulletBtn.main.queue.forEach((function(e,r){!e.prior&&!e.options.realTime&&e.el&&e.el.getBoundingClientRect().left>t.containerPos.right&&e.start>=C&&(C=e.start,P=r,x=e)})),x){x.remove(),t.removeBullet(x),t.danmu.bulletBtn.main.queue.splice(P,1),e.channel_id=x.channel_id;for(var R=x.channel_id[0],O=x.channel_id[0]+x.channel_id[1];R<O;R++)(l=n[R]).operating[e.mode]=!0,l.queue[e.mode].unshift(e),e.prior&&delete l.bookId[e.mode],l.operating[e.mode]=!1;return e.top=x.top,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start),{result:e,message:"success"}}}if(e.prior)if(e.bookChannelId||t.danmu.live)r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"2"),r.start+=2e3,!0)}));else{u=-1;for(var L=0,D=n.length-o;L<=D;L++){s=!0;for(var M=L;M<L+o;M++)if(n[M].bookId[e.mode]){s=!1;break}if(s){u=L;break}}if(-1!==u){for(var N=u;N<u+o;N++)n[N].bookId[e.mode]=e.id,t.logger&&t.logger.info(N+""+e.id+"");r.player&&r.bulletBtn.main.data.some((function(r){return r.id===e.id&&(t.logger&&t.logger.info(e.id+"2"),r.start+=2e3,r.bookChannelId=[u,o],t.logger&&t.logger.info(e.id+""+u+"~"+(u+o-1)+""),!0)}))}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(e){this.logger&&this.logger.info("removeBullet "+(e.options.txt||"[DOM Element]"));for(var t=this.channels,r=e.channel_id,n=void 0,i=r[0],a=r[0]+r[1];i<a;i++)if(n=t[i]){n.operating[e.mode]=!0;var o=-1;n.queue[e.mode].some((function(t,r){return t.id===e.id&&(o=r,!0)})),o>-1&&n.queue[e.mode].splice(o,1),n.operating[e.mode]=!1}e.options.loop&&this.danmu.bulletBtn.main.playedData.push(e.options)}},{key:"resetArea",value:function(){this.logger&&this.logger.info("resetArea");var e=this.danmu.container,t=this,r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.danmu.config.area&&t.danmu.config.area.start>=0&&t.danmu.config.area.end>=t.danmu.config.area.start&&("b2t"===t.direction?t.width=t.width*(t.danmu.config.area.end-t.danmu.config.area.start):t.height=t.height*(t.danmu.config.area.end-t.danmu.config.area.start)),t.container=e;var n=t.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),i=void 0;i="b2t"===t.direction?Math.floor(t.width/n):Math.floor(t.height/n);for(var a=[],o=0;o<i;o++)a[o]={id:o,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};if(t.channels&&t.channels.length<=a.length){for(var s=function(e){a[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top"].forEach((function(r){t.channels[e].queue[r].forEach((function(n){n.el&&(a[e].queue[r].push(n),n.resized||(n.pauseMove(t.containerPos,!1),n.startMove(t.containerPos),n.resized=!0))}))})),t.channels[e].queue.bottom.forEach((function(r){if(r.el){if(a[e+a.length-t.channels.length].queue.bottom.push(r),r.channel_id[0]+r.channel_id[1]-1===e){var i=[].concat(r.channel_id);r.channel_id=[i[0]-t.channels.length+a.length,i[1]],r.top=r.channel_id[0]*n,t.danmu.config.area&&t.danmu.config.area.start&&(r.top+=t.containerHeight*t.danmu.config.area.start),r.topInit()}r.resized||(r.pauseMove(t.containerPos,!1),r.startMove(t.containerPos),r.resized=!0)}}))},l=0;l<t.channels.length;l++)s(l);for(var u=function(e){["scroll","top","bottom"].forEach((function(t){a[e].queue[t].forEach((function(e){e.resized=!1}))}))},c=0;c<a.length;c++)u(c);t.channels=a,"b2t"===t.direction?t.channelWidth=n:t.channelHeight=n}else if(t.channels&&t.channels.length>a.length){for(var d=function(e){a[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}},["scroll","top","bottom"].forEach((function(r){if("top"===r&&e>Math.floor(a.length/2));else if("bottom"===r&&e<=Math.floor(a.length/2));else{var i="bottom"===r?e-a.length+t.channels.length:e;t.channels[i].queue[r].forEach((function(o,s){if(o.el){if(a[e].queue[r].push(o),"bottom"===r&&o.channel_id[0]+o.channel_id[1]-1===i){var l=[].concat(o.channel_id);o.channel_id=[l[0]-t.channels.length+a.length,l[1]],o.top=o.channel_id[0]*n,t.danmu.config.area&&t.danmu.config.area.start&&(o.top+=t.containerHeight*t.danmu.config.area.start),o.topInit()}o.resized||(o.pauseMove(t.containerPos,!1),o.startMove(t.containerPos),o.resized=!0)}t.channels[i].queue[r].splice(s,1)}))}}))},h=0;h<a.length;h++)d(h);for(var f=function(e){["scroll","top","bottom"].forEach((function(t){a[e].queue[t].forEach((function(e){e.resized=!1}))}))},p=0;p<a.length;p++)f(p);t.channels=a,"b2t"===t.direction?t.channelWidth=n:t.channelHeight=n}}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("reset");var t=this.danmu.container,r=this;function n(){var e=t.getBoundingClientRect();r.width=e.width,r.height=e.height,r.danmu.config.area&&r.danmu.config.area.start>=0&&r.danmu.config.area.end>=r.danmu.config.area.start&&("b2t"===r.direction?r.width=r.width*(r.danmu.config.area.end-r.danmu.config.area.start):r.height=r.height*(r.danmu.config.area.end-r.danmu.config.area.start)),r.container=t;var n=r.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),i=void 0;i="b2t"===r.direction?Math.floor(r.width/n):Math.floor(r.height/n);for(var a=[],o=0;o<i;o++)a[o]={id:o,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};r.channels=a,"b2t"===r.direction?r.channelWidth=n:r.channelHeight=n}r.danmu.bulletBtn&&r.danmu.bulletBtn.main&&r.danmu.bulletBtn.main.queue.forEach((function(e){e.pauseMove(r.containerPos),e.remove()})),r.channels&&r.channels.length>0&&["scroll","top","bottom"].forEach((function(e){for(var t=0;t<r.channels.length;t++)r.channels[t].queue[e].forEach((function(e){e.pauseMove(r.containerPos),e.remove()}))})),r.danmu.bulletBtn&&r.danmu.bulletBtn.main&&r.danmu.bulletBtn.main.data&&r.danmu.bulletBtn.main.data.forEach((function(e){e.hasAttached=!1})),e?this.resetTimer=setTimeout(n,200):n()}},{key:"resetWithCb",value:function(e,t){this.logger&&this.logger.info("resetWithCb");var r=this.danmu.container,n=this;n.channels&&n.channels.length>0&&["scroll","top","bottom"].forEach((function(e){for(var t=0;t<n.channels.length;t++)n.channels[t].queue[e].forEach((function(e){e.pauseMove(n.containerPos),e.remove()}))}));var i=r.getBoundingClientRect();n.width=i.width,n.height=i.height,n.danmu.config.area&&n.danmu.config.area.start>=0&&n.danmu.config.area.end>=n.danmu.config.area.start&&("b2t"===n.direction?n.width=n.width*(n.danmu.config.area.end-n.danmu.config.area.start):n.height=n.height*(n.danmu.config.area.end-n.danmu.config.area.start)),n.container=r;var a=n.danmu.config.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),o=void 0;o="b2t"===n.direction?Math.floor(n.width/a):Math.floor(n.height/a);for(var s=[],l=0;l<o;l++)s[l]={id:l,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};n.channels=s,n.channelHeight=a,e&&e(!0,t)}}]),t}(i.default);t.default=s,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=o(r(1)),a=o(r(0));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=_typeof$b(t)&&"function"!=typeof t?e:t}var l=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.setLogger("bullet"),n.danmu=e,n.options=r,n.duration=r.duration,n.moveV=r.moveV,n.id=r.id,n.container=e.container,n.start=r.start,n.prior=r.prior,n.color=r.color,n.bookChannelId=r.bookChannelId,n.direction=e.direction,n.reuseDOM=!0;var i=n,o=void 0;if(n.domObj=e.domObj,r.el&&1===r.el.nodeType){if(r.el.parentNode)return s(n,{bulletCreateFail:!0});if(e.config.disableCopyDOM)o=r.el,n.reuseDOM=!1;else{o=n.domObj.use();var l=a.default.copyDom(r.el);r.eventListeners&&r.eventListeners.length>0&&r.eventListeners.forEach((function(e){l.addEventListener(e.event,e.listener,e.useCapture||!1)})),o.appendChild(l)}}else(o=n.domObj.use()).textContent=r.txt;if(n.onChangeDirection=function(e){i.direction=e},n.danmu.on("changeDirection",n.onChangeDirection),r.style){var u=r.style;Object.keys(u).forEach((function(e){a.default.style(o,e,u[e])}))}"top"===r.mode||"bottom"===r.mode?n.mode=r.mode:n.mode="scroll",n.el=o,r.like&&r.like.el&&n.setLikeDom(r.like.el,r.like.style),n.status="waiting";var c=n.container.getBoundingClientRect(),d=Math.floor(Math.random()*(c.width/10>100?200:c.width/10));r.realTime&&(d=0);var h=c.width+d+"px";return a.default.style(n.el,"left",h),n.containerPos=c,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof$b(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"attach",value:function(){if(this.container.appendChild(this.el),this.elPos=this.el.getBoundingClientRect(),"b2t"===this.direction?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV){var e=this.containerPos;this.duration=(e.width+this.width)/this.moveV*1e3}this.danmu.config&&this.danmu.config.mouseControl&&(this.mouseoverFunWrapper=this.mouseoverFun.bind(this),this.el.addEventListener("mouseover",this.mouseoverFunWrapper,!1)),this.danmu.config&&this.danmu.config.mouseEnterControl&&(this.mouseEnterFunWrapper=this.mouseoverFun.bind(this),this.el.addEventListener("mouseenter",this.mouseEnterFunWrapper,!1))}},{key:"mouseoverFun",value:function(e){this.danmu&&this.danmu.mouseControl&&this.danmu.config.mouseControlPause||"waiting"===this.status||"end"===this.status||this.danmu&&this.danmu.emit("bullet_hover",{bullet:this,event:e})}},{key:"detach",value:function(){this.el&&(this.danmu.config&&this.danmu.config.mouseControl&&this.el.removeEventListener("mouseover",this.mouseoverFunWrapper,!1),this.danmu.config&&this.danmu.config.mouseEnterControl&&this.el.removeEventListener("mouseenter",this.mouseEnterFunWrapper,!1),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.reuseDOM&&this.domObj.unuse(this.el),this.el=null),this.danmu.off("changeDirection",this.onChangeDirection)}},{key:"topInit",value:function(){if(this.logger&&this.logger.info("topInit #"+(this.options.txt||"[DOM Element]")+"#"),"b2t"===this.direction){var e=this.containerPos;a.default.style(this.el,"transformOrigin","left top"),a.default.style(this.el,"transform","translateX(-"+this.top+"px) translateY("+e.height+"px) translateZ(0px) rotate(90deg)"),a.default.style(this.el,"transition","transform 0s linear 0s")}else a.default.style(this.el,"top",this.top+"px")}},{key:"pauseMove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.logger&&this.logger.info("pauseMove #"+(this.options.txt||"[DOM Element]")+"#");var r=this;if("paused"!==this.status&&("forcedPause"!==r.status&&(this.status="paused"),clearTimeout(r.removeTimer),this.el))if(a.default.style(this.el,"willChange","auto"),"scroll"===this.mode){if(t){var n=((new Date).getTime()-r.moveTime)/1e3*this.moveV,i=0;i=r.moveMoreS-n>=0?"b2t"===this.direction?(r.moveMoreS-n)/r.moveContainerHeight*e.height:(r.moveMoreS-n)/r.moveContainerWidth*e.width:r.moveMoreS-n,"b2t"===this.direction?a.default.style(this.el,"transform","translateX(-"+this.top+"px) translateY("+i+"px) translateZ(0px) rotate(90deg)"):a.default.style(this.el,"left",i+"px")}else"b2t"===this.direction?a.default.style(this.el,"transform","translateX(-"+this.top+"px) translateY("+(this.el.getBoundingClientRect().top-e.top)+"px) translateZ(0px) rotate(90deg)"):a.default.style(this.el,"left",this.el.getBoundingClientRect().left-e.left+"px");"b2t"===this.direction||a.default.style(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),a.default.style(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+(new Date).getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(e,t){this.logger&&this.logger.info("startMove #"+(this.options.txt||"[DOM Element]")+"#");var r=this;if(r.hasMove||(r.danmu.emit("bullet_start",r),r.hasMove=!0),("forcedPause"!==r.status||t)&&this.el&&"start"!==this.status)if(this.status="start",a.default.style(this.el,"willChange","transform"),"scroll"===this.mode)if("b2t"===this.direction){this.moveV=(e.height+this.height)/this.duration*1e3;var n=(r.el.getBoundingClientRect().bottom-e.top)/this.moveV;a.default.style(this.el,"transition","transform "+n+"s linear 0s"),this.startMoveTimer=setTimeout((function(){r.el&&(a.default.style(r.el,"transform","translateX(-"+r.top+"px) translateY(-"+r.height+"px) translateZ(0px) rotate(90deg)"),r.moveTime=(new Date).getTime(),r.moveMoreS=r.el.getBoundingClientRect().top-e.top,r.moveContainerHeight=e.height,r.removeTimer=setTimeout(l,1e3*n))}),20)}else{var i=this.el.getBoundingClientRect();this.moveV=(e.width+this.width)/this.duration*1e3;var o=(i.right-e.left)/this.moveV;a.default.style(this.el,"transition","transform "+o+"s linear 0s"),this.startMoveTimer=setTimeout((function(){if(r.el){var t=r.el.getBoundingClientRect(),n=(t.right-e.left)/o;t.right>e.left&&n>r.moveV-1&&n<r.moveV+1?(a.default.style(r.el,"transform","translateX(-"+(t.right-e.left)+"px) translateY(0px) translateZ(0px)"),r.moveTime=(new Date).getTime(),r.moveMoreS=t.left-e.left,r.moveContainerWidth=e.width,r.removeTimer=setTimeout(l,1e3*o)):(r.status="end",r.remove())}}),0)}else{a.default.style(this.el,"left","50%"),a.default.style(this.el,"margin","0 0 0 -"+this.width/2+"px"),this.pastDuration||(this.pastDuration=1);var s=this.duration>=this.pastDuration?this.duration-this.pastDuration:0;this.removeTimer=setTimeout(l,s),this.startTime=(new Date).getTime()}function l(){if(r.el)if("scroll"===r.mode){var e=r.containerPos,t=r.el.getBoundingClientRect();"b2t"===r.direction?t&&t.bottom<=e.top+100?(r.status="end",r.remove()):(r.pauseMove(e),"paused"!==r.danmu.bulletBtn.main.status&&r.startMove(e)):t&&t.right<=e.left+100?(r.status="end",r.remove()):(r.pauseMove(e),"paused"!==r.danmu.bulletBtn.main.status&&r.startMove(e))}else r.status="end",r.remove()}}},{key:"remove",value:function(){this.logger&&this.logger.info("remove #"+(this.options.txt||"[DOM Element]")+"#"),this.removeTimer&&clearTimeout(this.removeTimer),this.startMoveTimer&&clearTimeout(this.startMoveTimer),this.el&&this.el.parentNode&&(a.default.style(this.el,"willChange","auto"),this.detach(),this.options.el&&1===this.options.el.nodeType&&this.danmu.config.disableCopyDOM&&a.default.style(this.options.el,"transform","none"),this.danmu.emit("bullet_remove",{bullet:this}))}},{key:"setFontSize",value:function(e){this.el&&(this.el.style.fontSize=e)}},{key:"setLikeDom",value:function(e,t){if(e&&(Object.keys(t).forEach((function(r){e.style[r]=t[r]})),e.className="danmu-like",this.el)){var r=this.el.querySelector(".danmu-like");r&&this.el.removeChild(r),this.el.innerHTML=""+this.el.innerHTML+e.outerHTML}return e}}]),t}(i.default);t.default=l,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(0))&&n.__esModule?n:{default:n},o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t={initDOM:function(){return document.createElement("div")},initSize:10},this.init(t)}return i(e,[{key:"init",value:function(e){this.idleList=[],this.usingList=[],this._id=0,this.options=e,this._expand(e.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var e=this.idleList.shift();return this.usingList.push(e),e}},{key:"unuse",value:function(e){var t=this.usingList.indexOf(e);t<0||(this.usingList.splice(t,1),e.innerHTML="",e.textcontent="",this.clearElementStyle(e),this.idleList.push(e))}},{key:"_expand",value:function(e){for(var t=0;t<e;t++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var e=0;e<this.idleList.length;e++)this.idleList[e].innerHTML="",this.idleList[e].textcontent="",this.clearElementStyle(this.idleList[e]);for(var t=0;t<this.usingList.length;t++)this.usingList[t].innerHTML="",this.usingList[t].textcontent="",this.clearElementStyle(this.usingList[t]);for(var r in this)delete this[r]}},{key:"clearElementStyle",value:function(e){var t="undefined"!=typeof window?window.navigator.userAgent:null;t&&(t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1?a.default.style(e,"transform","none"):e.setAttribute("style",""))}}]),e}();t.default=o,e.exports=t.default},function(e){e.exports=JSON.parse('{"version":"0.6.3"}')},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=new(function(){function e(){var t=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__handlers=[],window.ResizeObserver)try{this.observer=new window.ResizeObserver((function(e){var r=(new Date).getTime();r-t.timeStampe<200||(t.timeStampe=r,t.__trigger(e))})),this.timeStampe=(new Date).getTime()}catch(r){}}return n(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var r=this.__handlers,n=-1,i=0;i<r.length;i++)r[i]&&e===r[i].target&&(n=i);n>-1?this.__handlers[n].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(r,n){e===r.target&&(t=n)})),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,r=0;r<t.length;r++)if(t[r]&&e===t[r].target){t[r].handler&&t[r].handler.map((function(e){try{e()}catch(t){console.error(t)}}));break}}},{key:"__trigger",value:function(e){var t=this;e.map((function(e){t.__runHandler(e.target)}))}}]),e}());t.addObserver=function(e,t){i.addObserver(e,t)},t.unObserver=function(e,t){i.unObserver(e,t)},t.destroyObserver=function(e,t){i.destroyObserver(e,t)}},function(e,t,r){var n=r(35);"string"==typeof n&&(n=[[e.i,n,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(37)(n,i),n.locals&&(e.exports=n.locals)},function(e,t,r){(e.exports=r(36)(!1)).push([e.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#ffffff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}\n",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r,n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var a=(r=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(o).concat([a]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(n[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];"number"==typeof o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]="("+o[2]+") and ("+r+")"),t.push(o))}},t}},function(e,t,r){var n,i,a,o={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),l=function(e){return document.querySelector(e)},u=(a={},function(e){if("function"==typeof e)return e();if(void 0===a[e]){var t=l.call(this,e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(r){t=null}a[e]=t}return a[e]}),c=null,d=0,h=[],f=r(38);function p(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=o[n.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](n.parts[a]);for(;a<n.parts.length;a++)i.parts.push(_(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(_(n.parts[a],t));o[n.id]={id:n.id,refs:1,parts:s}}}}function y(e,t){for(var r=[],n={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};n[o]?n[o].parts.push(s):r.push(n[o]={id:o,parts:[s]})}return r}function m(e,t){var r=u(e.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=h[h.length-1];if("top"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),h.push(t);else if("bottom"===e.insertAt)r.appendChild(t);else{if("object"!=_typeof$b(e.insertAt)||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=u(e.insertInto+" "+e.insertAt.before);r.insertBefore(t,i)}}function g(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function v(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),b(t,e.attrs),m(e,t),t}function b(e,t){Object.keys(t).forEach((function(r){e.setAttribute(r,t[r])}))}function _(e,t){var r,n,i,a,o,s;if(t.transform&&e.css){if(!(a=t.transform(e.css)))return function(){};e.css=a}if(t.singleton){var l=d++;r=c||(c=v(t)),n=S.bind(null,r,l,!1),i=S.bind(null,r,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(o=t,s=document.createElement("link"),void 0===o.attrs.type&&(o.attrs.type="text/css"),o.attrs.rel="stylesheet",b(s,o.attrs),m(o,s),r=s,n=A.bind(null,r,t),i=function(){g(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=$.bind(null,r),i=function(){g(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=("undefined"==typeof document?"undefined":_typeof$b(document)))throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==_typeof$b(t.attrs)?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var r=y(e,t);return p(r,t),function(e){for(var n=[],i=0;i<r.length;i++){var a=r[i];(s=o[a.id]).refs--,n.push(s)}for(e&&p(y(e,t),t),i=0;i<n.length;i++){var s;if(0===(s=n[i]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete o[s.id]}}}};var E,T=(E=[],function(e,t){return E[e]=t,E.filter(Boolean).join("\n")});function S(e,t,r,n){var i=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=T(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}function $(e,t){var r=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}function A(e,t,r){var n=r.css,i=r.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(n=f(n)),i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var r=t.protocol+"//"+t.host,n=r+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?r+a:n+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}}])}(dist$2);var DanmuJs=getDefaultExportFromCjs(dist$2.exports),NormalSpeed=1e4,Container=function(){function e(t){_classCallCheck$j(this,e),this.state=t,this.root=util$2.createDom("xg-danmu"),helpers.addClass(this.root,"xgplayer-danmu-container")}var t;return _createClass$k(e,[{key:"initDanmuContainer",value:function(){var e=this.state.getConfig(),t=e.opacity,r=void 0===t?1:t,n=e.fontSize,i=void 0===n?16:n,a=e.area,o=void 0===a?1:a,s=e.danmuItems,l=void 0===s?[]:s,u=e.active,c=e.speed,d=void 0===c?40:c,h=(u?l:[]).map((function(e){return!e.style&&(e.style={}),e})),f={container:this.root,comments:h,live:!1,area:{start:0,end:this.state.getRenderVal("area",o)}};this.danmuJs=new DanmuJs(f),this.setOpacity(this.state.getRenderVal("opacity",r)),this.setFontSize(this.state.getRenderVal("fontSize",i)),this.setSpeed(this.state.getRenderVal("speed",d))}},{key:"start",value:function(){this.danmuJs.start()}},{key:"pause",value:function(){this.danmuJs.pause()}},{key:"play",value:function(){this.danmuJs.play()}},{key:"stop",value:function(){this.danmuJs.stop()}},{key:"resize",value:function(){this.danmuJs.resize()}},{key:"sendDanmu",value:function(e){this.state.getConfig().active&&this.danmuJs.sendComment(e)}},{key:"clear",value:function(){this.danmuJs.clear()}},{key:"setProperty",value:function(e,t){return"opacity"===e?this.setOpacity(this.state.getRenderVal(e,t)):"area"===e?this.setArea(this.state.getRenderVal(e,t)):"speed"===e?this.setSpeed(this.state.getRenderVal(e,t)):"fontSize"===e?this.setFontSize(this.state.getRenderVal(e,t)):void 0}},{key:"setOpacity",value:function(e){this.danmuJs.setOpacity(e)}},{key:"setFontSize",value:function(e){this.danmuJs.setFontSize(e)}},{key:"setArea",value:function(e){this.danmuJs.setArea({start:0,end:this.state.getRenderVal("area",e)})}},{key:"setSpeed",value:function(e){this.danmuJs.setAllDuration("scroll",NormalSpeed/e)}},{key:"destroy",value:(t=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(){return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.danmuJs){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.danmuJs.stop();case 4:return e.next=6,this.danmuJs.destroy();case 6:this.danmuJs=null,this.root.parentNode.removeChild(this.root),this.root=null;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Panel=function(){function e(t){_classCallCheck$j(this,e),this.state=t,this.root=document.createElement("div"),helpers.addClass(this.root,"panel-box"),helpers.addEventListener(this.root,"click",(function(e){e.stopPropagation()}))}return _createClass$k(e,[{key:"destroy",value:function(){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.root=null}}]),e}(),Switch=function(){function e(t){_classCallCheck$j(this,e),this.callback=function(){},this.key=t.key,this.name=t.name,this.value=t.value,this.root=document.createElement("div"),helpers.addClass(this.root,"xg-player-switch-wrapper"),this.render()}return _createClass$k(e,[{key:"render",value:function(){var e=this;if(!this.root.childNodes.length){var t=document.createElement("div");this.$left=t,helpers.addClass(t,"left"),t.innerHTML=this.name;var r=document.createElement("div");this.$right=r,helpers.addClass(r,"right"),r.innerHTML='<label class="switch">\n    <input type="checkbox">\n    <span class="slider round"></span>\n  </label>',this.root.appendChild(t),this.root.appendChild(r);var n=this.$right.querySelector("input");helpers.addEventListener(this.$right,"click",debounce$3((function(t){t.stopPropagation(),e.value=!e.value,e.value?null==n||n.setAttribute("checked","checked"):null==n||n.removeAttribute("checked"),e.callback(e.value)}),50))}var i=this.$right.querySelector("input");this.value?null==i||i.setAttribute("checked","checked"):i.removeAttribute("checked"),i.checked=this.value}},{key:"renderName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$left.innerHTML=e}},{key:"onChange",value:function(e){this.callback=e}}]),e}(),dist$1={exports:{}};!function(e,t){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$b(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t,r){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=_typeof$b(r))throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){var t,r,n,i,a,o;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(o=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)a=e[t],o.set(a,i),i+=a.length;return o}},o={arraySet:function(e,t,r,n,i){for(var a=0;a<n;a++)e[i+a]=t[r+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,a)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,o))},t.setTyped(n)},function(e,t,r){var n=r(23)();e.exports=function(e){return e!==n&&null!==e}},function(e,t,r){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,r){var n,i,a,o,s,l,u,c=r(12),d=r(29),h=Function.prototype.apply,f=Function.prototype.call,p=Object.create,y=Object.defineProperty,m=Object.defineProperties,g=Object.prototype.hasOwnProperty,v={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var r,i;return d(t),i=this,n.call(this,e,r=function(){a.call(i,e,r),h.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:n=function(e,t){var r;return d(t),g.call(this,"__ee__")?r=this.__ee__:(r=v.value=p(null),y(this,"__ee__",v),v.value=null),r[e]?"object"==_typeof$b(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:i,off:a=function(e,t){var r,n,i,a;if(d(t),!g.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==_typeof$b(n=r[e]))for(a=0;i=n[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===n.length?r[e]=n[a?0:1]:n.splice(a,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:o=function(e){var t,r,n,i,a;if(g.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==_typeof$b(i)){for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;n=i[t];++t)h.call(n,this,a)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,a=new Array(r-1),t=1;t<r;++t)a[t-1]=arguments[t];h.call(i,this,a)}}},l={on:c(n),once:c(i),off:c(a),emit:c(o)},u=m({},l),e.exports=t=function(e){return null==e?p(u):m(Object(e),l)},t.methods=s},function(e,t,r){e.exports=function(e){return null!=e}},function(e,t,r){e.exports=function(e,t,r,n){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{a=a+(i=i+t[n++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0}},function(e,t,r){var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();e.exports=function(e,t,r,i){var a=n,o=i+r;e^=-1;for(var s=i;s<o;s++)e=e>>>8^a[255&(e^t[s])];return-1^e}},function(e,t,r){var n=r(0),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(u){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(u){a=!1}for(var o=new n.Buf8(256),s=0;s<256;s++)o[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&a||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",o=0;o<t;o++)r+=String.fromCharCode(e[o]);return r}o[254]=o[254]=1,t.string2buf=function(e){var t,r,i,a,o,s=e.length,l=0;for(a=0;a<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(l),o=0,a=0;o<l;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<s&&56320==(64512&(i=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},t.buf2string=function(e,t){var r,n,i,a,s=t||e.length,u=new Array(2*s);for(n=0,r=0;r<s;)if((i=e[r++])<128)u[n++]=i;else if((a=o[i])>4)u[n++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<s;)i=i<<6|63&e[r++],a--;a>1?u[n++]=65533:i<65536?u[n++]=i:(i-=65536,u[n++]=55296|i>>10&1023,u[n++]=56320|1023&i)}return l(u,n)},t.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+o[e[r]]>t?r:t}},function(e,t,r){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,r){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,r){e.exports=r(11)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=f(r(3)),a=f(r(30)),o=f(r(31)),s=f(r(32)),l=r(33),u=f(r(34)),c=f(r(43)),d=f(r(44)),h=r(46);function f(e){return e&&e.__esModule?e:{default:e}}var p=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(0,i.default)(this),this.url=t.url,this.player=t.player,this.aheadTime=parseFloat(localStorage.getItem("danmuMaskAheadTime"))||t.aheadTime||0,this.originStart=parseFloat(t.originStart)||0,this.interval=parseFloat(localStorage.getItem("danmuMaskInterval"))||t.interval||o.default.DEFAULT_INTERVAL,this.metaDataAreaLength=o.default.VERSION_LENGTH+o.default.INDEX_LENGTH+o.default.RESERVE_LENGTH,(0,l.log)("DanmuMask NPM Version: ",h.version),(0,l.log)("DanmuMask Config: ",t),this.searchFrameWorker=new d.default,this.searchFrameWorker.onmessage=function(e){if("searchResult"===e.data.method){var t=e.data.args;r.setDanmuMask(t.svgData||"")}else if("getData"===e.data.method){var n=e.data.args;r.getData(r.url,n.range).then((function(e){r.parseSvgData(n.index,e),r.searchFrameWorker.postMessage({method:"updateDataListItem",args:{index:n.index,key:"download",value:!0}})}))}}}return n(e,[{key:"init",value:function(){var e=this;(0,l.log)("DanmuMask init");var t=this;this.dataList=[],this.danmuEl=this.player.root.querySelector("xg-danmu"),this.danmuEl||(this.danmuEl=this.player.root.querySelector("xg-bullet")),this.danmuEl.style["-webkit-mask-position"]="center",this.danmuEl.style["-webkit-box-direction"]="normal",this.danmuEl.style["-webkit-mask-size"]="100% 100%";var r=this.player.root.getBoundingClientRect();this.containerWidth=r.width,this.containerHeight=r.height,this.getData(this.url,[0,this.metaDataAreaLength-1]).then((function(r){var n=new s.default(r);e.protocolVersion=n.readUint8(),e.indexAreaByteLength=n.readBigEnd(4),(0,l.log)("DanmuMask this.protocolVersion: ",e.protocolVersion),(0,l.log)("DanmuMask this.indexAreaByteLength: ",e.indexAreaByteLength),e.dataAreaBase=0,e.getData(e.url,[e.metaDataAreaLength,e.metaDataAreaLength+e.indexAreaByteLength-1]).then((function(r){var n=new s.default(r);e.indexByteStep=8,e.indexCount=e.indexAreaByteLength/e.indexByteStep;for(var i=n.readBigEnd(8)+e.dataAreaBase,a=void 0,u=0;u<e.indexCount;u++)a=u<e.indexCount-1?n.readBigEnd(8)+e.dataAreaBase:0,e.dataList.push({idx:u,timeStart:u*o.default.DURATION_STEP,timeEnd:(u+1)*o.default.DURATION_STEP,dataStart:i,dataEnd:a-1,download:!1,currentFrame:-1}),i=a;e.searchFrameWorker.postMessage({method:"updateData",args:{dataList:e.dataList,indexCount:e.indexCount}}),e.player.stopDanmuMaskTimer=function(){(0,l.log)("DanmuMask stopDanmuMaskTimer"),t.timer&&(t.timer.clear(),t.timer=null)},e.player.startDanmuMaskTimer=function(){(0,l.log)("DanmuMask startDanmuMaskTimer"),t.timer||(t.timer=new c.default,t.timer.repeat(t.timeupdateFunc.bind(t),t.interval))},e.player.onDanmuMaskSeeked=function(){e.searchFrameWorker.postMessage({method:"onDanmuMaskSeeked"})},t.player.startDanmuMaskTimer(),["ended","pause","error"].forEach((function(r){e.player.on(r,t.player.stopDanmuMaskTimer)})),["play","playing"].forEach((function(r){e.player.on(r,t.player.startDanmuMaskTimer)})),e.player.on("seeked",t.player.onDanmuMaskSeeked)}))}))}},{key:"timeupdateFunc",value:function(){var e=this.player.currentTime+this.originStart-this.aheadTime;this.searchFrameWorker.postMessage({method:"searchFrame",args:{currentTime:e}})}},{key:"getData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this;return new Promise((function(n){var i=new a.default(e,t,n);i.once("error",(function(e){r.player.emit("error",e)})),i.once("progress_event",(function(e){r.player.emit("progress_event",e)}))}))}},{key:"setContainerSize",value:function(e,t){(0,l.log)("DanmuMask setContainerSize: ",e,t),this.containerWidth=e,this.containerHeight=t}},{key:"setDanmuMask",value:function(e){if((0,l.log)("DanmuMask setDanmuMask"),e){var t=this.player.video;this.containerWidth/this.containerHeight>=t.videoWidth/t.videoHeight?(this.topRatio=0,this.bottomRatio=100,this.leftRatio=100*(1-t.videoWidth*this.containerHeight/t.videoHeight/this.containerWidth)/2,this.rightRatio=100-this.leftRatio):(this.topRatio=100*(1-t.videoHeight*this.containerWidth/t.videoWidth/this.containerHeight)/2,this.bottomRatio=100-this.topRatio,this.leftRatio=0,this.rightRatio=100);var r="linear-gradient(rgb(0, 0, 0), rgb(0, 0, 0) "+this.topRatio+"%, rgba(0, 0, 0, 0) "+this.topRatio+"%), linear-gradient(rgba(0, 0, 0, 0) "+this.bottomRatio+"%, rgb(0, 0, 0) "+this.bottomRatio+"%, rgb(0, 0, 0)), linear-gradient(to right, rgb(0, 0, 0), rgb(0, 0, 0) "+this.leftRatio+"%, rgba(0, 0, 0, 0) "+this.leftRatio+"%), linear-gradient(to right, rgba(0, 0, 0, 0) "+this.rightRatio+"%, rgb(0, 0, 0) "+this.rightRatio+'%, rgb(0, 0, 0)),url("data:image/svg+xml;base64,'+e+'")';this.danmuEl.style["-webkit-mask-image"]=r,this.danmuEl.style["mask-image"]=r}else{var n="linear-gradient(rgb(0, 0, 0), rgb(0, 0, 0) 0%, rgba(0, 0, 0) 0%), linear-gradient(rgba(0, 0, 0) 100%, rgb(0, 0, 0) 100%, rgb(0, 0, 0)), linear-gradient(to right, rgb(0, 0, 0), rgb(0, 0, 0) 0%, rgba(0, 0, 0) 0%), linear-gradient(to right, rgba(0, 0, 0) 100%, rgb(0, 0, 0) 100%, rgb(0, 0, 0))";this.danmuEl.style["-webkit-mask-image"]=n,this.danmuEl.style["mask-image"]=n}}},{key:"parseSvgData",value:function(e,t){try{var r=u.default.inflate(t);(0,l.log)("DanmuMask output: ",r);for(var n=new s.default(r.buffer),i=[];n.position<r.byteLength-1;){var a={};a.dataPts=n.readBigEnd(8),a.dataSvgLength=n.readBigEnd(4),a.dataSvgBase64="";for(var o=0;o<a.dataSvgLength;o++)a.dataSvgBase64+=String.fromCharCode(n.readUint8());a.dataSvgBase64=window.btoa(a.dataSvgBase64),i.push(a)}this.searchFrameWorker.postMessage({method:"updateDataListItem",args:{index:e,key:"data",value:r}}),this.searchFrameWorker.postMessage({method:"updateDataListItem",args:{index:e,key:"frameList",value:i}}),(0,l.log)("DanmuMask frameList: ",i)}catch(c){(0,l.log)("DanmuMask zlib inflate error: ",c)}}},{key:"destroy",value:function(){var e=this;(0,l.log)("DanmuMask destroy"),this.player&&"function"==typeof this.player.off&&(["ended","pause","error"].forEach((function(t){e.player.stopDanmuMaskTimer&&e.player.off(t,e.player.stopDanmuMaskTimer)})),["play","playing"].forEach((function(t){e.player.startDanmuMaskTimer&&e.player.off(t,e.player.startDanmuMaskTimer)})),this.player.onDanmuMaskSeeked&&this.player.off("seeked",this.player.onDanmuMaskSeeked)),this.timer&&this.timer.clear(),this.searchFrameWorker&&this.searchFrameWorker.terminate(),this.setDanmuMask()}}]),e}();t.default=p,e.exports=t.default},function(e,t,r){var n=r(4),i=r(13),a=r(17),o=r(25),s=r(26);(e.exports=function(e,t){var r,i,l,u,c;return arguments.length<2||"string"!=typeof e?(u=t,t=e,e=null):u=arguments[2],n(e)?(r=s.call(e,"c"),i=s.call(e,"e"),l=s.call(e,"w")):(r=l=!0,i=!1),c={value:t,configurable:r,enumerable:i,writable:l},u?a(o(u),c):c}).gs=function(e,t,r){var l,u,c,d;return"string"!=typeof e?(c=r,r=t,t=e,e=null):c=arguments[3],n(t)?i(t)?n(r)?i(r)||(c=r,r=void 0):r=void 0:(c=t,t=r=void 0):t=void 0,n(e)?(l=s.call(e,"c"),u=s.call(e,"e")):(l=!0,u=!1),d={get:t,set:r,configurable:l,enumerable:u},c?a(o(c),d):d}},function(e,t,r){var n=r(14),i=/^\s*class[\s{/}]/,a=Function.prototype.toString;e.exports=function(e){return!!n(e)&&!i.test(a.call(e))}},function(e,t,r){var n=r(15);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(t){return!1}return!n(e)}},function(e,t,r){var n=r(16);e.exports=function(e){if(!n(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(t){return!1}}},function(e,t,r){var n=r(4),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!n(e)&&hasOwnProperty.call(i,_typeof$b(e))}},function(e,t,r){e.exports=r(18)()?Object.assign:r(19)},function(e,t,r){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,r){var n=r(20),i=r(24),a=Math.max;e.exports=function(e,t){var r,o,s,l=a(arguments.length,2);for(e=Object(i(e)),s=function(n){try{e[n]=t[n]}catch(i){r||(r=i)}},o=1;o<l;++o)n(t=arguments[o]).forEach(s);if(void 0!==r)throw r;return e}},function(e,t,r){e.exports=r(21)()?Object.keys:r(22)},function(e,t,r){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,r){var n=r(1),i=Object.keys;e.exports=function(e){return i(n(e)?Object(e):e)}},function(e,t,r){e.exports=function(){}},function(e,t,r){var n=r(1);e.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,r){var n=r(1),i=Array.prototype.forEach,a=Object.create,o=function(e,t){var r;for(r in e)t[r]=e[r]};e.exports=function(e){var t=a(null);return i.call(arguments,(function(e){n(e)&&o(Object(e),t)})),t}},function(e,t,r){e.exports=r(27)()?String.prototype.contains:r(28)},function(e,t,r){var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},function(e,t,r){var n=String.prototype.indexOf;e.exports=function(e){return n.call(this,e,arguments[1])>-1}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=(n=r(3))&&n.__esModule?n:{default:n};function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments[2];o(this,e),(0,a.default)(this);var i=this;if(i.url=t,i.on=!1,i.range=r,e.queue.some((function(e){return e.url===t&&JSON.stringify(e.range)===JSON.stringify(r)})))n("repeat");else{var s=new XMLHttpRequest;s.target=i,s.responseType="arraybuffer",s.open("get",t),r&&r.length>1&&(i.range=r,i.id=r.join("-"),s.setRequestHeader("Range","bytes="+r[0]+"-"+(r[1]||""))),s.onload=function(){200===s.status||206===s.status?n&&n instanceof Function&&n(s.response):n&&n instanceof Function?n("Not Found"):i.emit("error"),s.target.remove()},s.onerror=function(){n(!1),s.target.remove()},s.onabort=function(){s.target.remove()},i.xhr=s,e.queue.push(i),i.update()}}return i(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter((function(r,n){return r.url===t.url&&JSON.stringify(r.range)===JSON.stringify(t.range)&&(e.queue.splice(n,1),!0)})),this.update()}},{key:"update",value:function(){var t=e.queue,r=t.filter((function(e){return e.on})),n=t.filter((function(e){return!e.on})),i=e.limit-r.length;n.forEach((function(e,t){t<i&&e.run()}))}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(){e.queue.forEach((function(e){e.on&&e.cancel()})),e.queue.length=0}}]),e}();s.queue=[],s.limit=4,window.Task=s,t.default=s,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return n(e,[{key:"init",value:function(){this.VERSION_LENGTH=1,this.INDEX_LENGTH=4,this.RESERVE_LENGTH=4,this.DURATION_STEP=10,this.DEFAULT_INTERVAL=30}}]),e}());t.default=i,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof ArrayBuffer&&(this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0)}return n(e,[{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this.dataview,4);n>0&&e.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"readLittleEnd",value:function(t){for(var r=0,n=0;n<t;n++)r+=Math.pow(256,n)*e.readByte(this.dataview,1);return r}},{key:"readBigEnd",value:function(t){for(var r=0,n=0;n<t;n++)r+=Math.pow(256,t-n-1)*e.readByte(this.dataview,1);return r}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,r){var n=void 0;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw"not supported for readByte 3";n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}();t.default=i,e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.log=function(e){var t;if(n){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];console&&(t=console).log.apply(t,[e].concat(i))}};var n=t.LOGOPEN=window.location.search.indexOf("log=true")>-1},function(e,t,r){var n={};(0,r(0).assign)(n,r(35),r(38),r(9)),e.exports=n},function(e,t,r){var n=r(36),i=r(0),a=r(7),o=r(2),s=r(8),l=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(o[r]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var c;if(c="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=n.deflateSetDictionary(this.strm,c)))throw new Error(o[r]);this._dict_set=!0}}function c(e,t){var r=new u(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}u.prototype.push=function(e,t){var r,o,s=this.strm,u=this.options.chunkSize;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?s.input=a.string2buf(e):"[object ArrayBuffer]"===l.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(u),s.next_out=0,s.avail_out=u),1!==(r=n.deflate(s,o))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===o?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==o||(this.onEnd(0),s.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=u,t.deflate=c,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},function(e,t,r){var n,i=r(0),a=r(37),o=r(5),s=r(6),l=r(2);function u(e,t){return e.msg=l[t],t}function c(e){return(e<<1)-(e>4?9:0)}function d(e){for(var t=e.length;--t>=0;)e[t]=0}function h(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(i.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function f(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,h(e.strm)}function p(e,t){e.pending_buf[e.pending++]=t}function y(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function m(e,t){var r,n,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,u=e.window,c=e.w_mask,d=e.prev,h=e.strstart+258,f=u[a+o-1],p=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+o]===p&&u[r+o-1]===f&&u[r]===u[a]&&u[++r]===u[a+1]){a+=2,r++;do{}while(u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&u[++a]===u[++r]&&a<h);if(n=258-(h-a),a=h-258,n>o){if(e.match_start=t,o=n,n>=s)break;f=u[a+o-1],p=u[a+o]}}}while((t=d[t&c])>l&&0!=--i);return o<=e.lookahead?o:e.lookahead}function g(e){var t,r,n,a,l,u,c,d,h,f,p=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=p+(p-262)){i.arraySet(e.window,e.window,p,p,0),e.match_start-=p,e.strstart-=p,e.block_start-=p,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=p?n-p:0}while(--r);t=r=p;do{n=e.prev[--t],e.prev[t]=n>=p?n-p:0}while(--r);a+=p}if(0===e.strm.avail_in)break;if(u=e.strm,c=e.window,d=e.strstart+e.lookahead,h=a,f=void 0,(f=u.avail_in)>h&&(f=h),r=0===f?0:(u.avail_in-=f,i.arraySet(c,u.input,u.next_in,f,d),1===u.state.wrap?u.adler=o(u.adler,c,f,d):2===u.state.wrap&&(u.adler=s(u.adler,c,f,d)),u.next_in+=f,u.total_in+=f,f),e.lookahead+=r,e.lookahead+e.insert>=3)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+3-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)}function v(e,t){for(var r,n;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=m(e,r)),e.match_length>=3)if(n=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function b(e,t){for(var r,n,i;;){if(e.lookahead<262){if(g(e),e.lookahead<262&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=m(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(f(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=a._tr_tally(e,0,e.window[e.strstart-1]))&&f(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}function _(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function E(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),d(this.dyn_ltree),d(this.dyn_dtree),d(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),d(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),d(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function T(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):u(e,-2)}function S(e){var t,r=T(e);return 0===r&&((t=e.state).window_size=2*t.w_size,d(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function $(e,t,r,n,a,o){if(!e)return-2;var s=1;if(-1===t&&(t=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>9||8!==r||n<8||n>15||t<0||t>9||o<0||o>4)return u(e,-2);8===n&&(n=9);var l=new E;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=r,S(e)}n=[new _(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(g(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,f(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(f(e,!1),e.strm.avail_out),1)})),new _(4,4,8,4,v),new _(4,5,16,8,v),new _(4,6,32,32,v),new _(4,4,16,16,b),new _(8,16,32,32,b),new _(8,16,128,128,b),new _(8,32,128,256,b),new _(32,128,258,1024,b),new _(32,258,258,4096,b)],t.deflateInit=function(e,t){return $(e,t,8,15,8,0)},t.deflateInit2=$,t.deflateReset=S,t.deflateResetKeep=T,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?-2:(e.state.gzhead=t,0):-2},t.deflate=function(e,t){var r,i,o,l;if(!e||!e.state||t>5||t<0)return e?u(e,-2):-2;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&4!==t)return u(e,0===e.avail_out?-5:-2);if(i.strm=e,r=i.last_flush,i.last_flush=t,42===i.status)if(2===i.wrap)e.adler=0,p(i,31),p(i,139),p(i,8),i.gzhead?(p(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),p(i,255&i.gzhead.time),p(i,i.gzhead.time>>8&255),p(i,i.gzhead.time>>16&255),p(i,i.gzhead.time>>24&255),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(p(i,255&i.gzhead.extra.length),p(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=s(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(p(i,0),p(i,0),p(i,0),p(i,0),p(i,0),p(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),p(i,3),i.status=113);else{var m=8+(i.w_bits-8<<4)<<8;m|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(m|=32),m+=31-m%31,i.status=113,y(i,m),0!==i.strstart&&(y(i,e.adler>>>16),y(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),h(e),o=i.pending,i.pending!==i.pending_buf_size));)p(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),h(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),h(e),o=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,p(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>o&&(e.adler=s(e.adler,i.pending_buf,i.pending-o,o)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&h(e),i.pending+2<=i.pending_buf_size&&(p(i,255&e.adler),p(i,e.adler>>8&255),e.adler=0,i.status=113)):i.status=113),0!==i.pending){if(h(e),0===e.avail_out)return i.last_flush=-1,0}else if(0===e.avail_in&&c(t)<=c(r)&&4!==t)return u(e,-5);if(666===i.status&&0!==e.avail_in)return u(e,-5);if(0!==e.avail_in||0!==i.lookahead||0!==t&&666!==i.status){var v=2===i.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(g(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):3===i.strategy?function(e,t){for(var r,n,i,o,s=e.window;;){if(e.lookahead<=258){if(g(e),e.lookahead<=258&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=s[i=e.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){o=e.strstart+258;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<o);e.match_length=258-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(f(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(f(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(f(e,!1),0===e.strm.avail_out)?1:2}(i,t):n[i.level].func(i,t);if(3!==v&&4!==v||(i.status=666),1===v||3===v)return 0===e.avail_out&&(i.last_flush=-1),0;if(2===v&&(1===t?a._tr_align(i):5!==t&&(a._tr_stored_block(i,0,0,!1),3===t&&(d(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),h(e),0===e.avail_out))return i.last_flush=-1,0}return 4!==t?0:i.wrap<=0?1:(2===i.wrap?(p(i,255&e.adler),p(i,e.adler>>8&255),p(i,e.adler>>16&255),p(i,e.adler>>24&255),p(i,255&e.total_in),p(i,e.total_in>>8&255),p(i,e.total_in>>16&255),p(i,e.total_in>>24&255)):(y(i,e.adler>>>16),y(i,65535&e.adler)),h(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?u(e,-2):(e.state=null,113===t?u(e,-3):0):-2},t.deflateSetDictionary=function(e,t){var r,n,a,s,l,u,c,h,f=t.length;if(!e||!e.state)return-2;if(2===(s=(r=e.state).wrap)||1===s&&42!==r.status||r.lookahead)return-2;for(1===s&&(e.adler=o(e.adler,t,f,0)),r.wrap=0,f>=r.w_size&&(0===s&&(d(r.head),r.strstart=0,r.block_start=0,r.insert=0),h=new i.Buf8(r.w_size),i.arraySet(h,t,f-r.w_size,r.w_size,0),t=h,f=r.w_size),l=e.avail_in,u=e.next_in,c=e.input,e.avail_in=f,e.next_in=0,e.input=t,g(r);r.lookahead>=3;){n=r.strstart,a=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--a);r.strstart=n,r.lookahead=2,g(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=u,e.input=c,e.avail_in=l,r.wrap=s,0},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,r){var n=r(0);function i(e){for(var t=e.length;--t>=0;)e[t]=0}var a=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],o=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],l=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576);i(u);var c=new Array(60);i(c);var d=new Array(512);i(d);var h=new Array(256);i(h);var f=new Array(29);i(f);var p,y,m,g=new Array(30);function v(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function _(e){return e<256?d[e]:d[256+(e>>>7)]}function E(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function T(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,E(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function S(e,t,r){T(e,r[2*t],r[2*t+1])}function $(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function A(e,t,r){var n,i,a=new Array(16),o=0;for(n=1;n<=15;n++)a[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=$(a[s]++,s))}}function w(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function k(e){e.bi_valid>8?E(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function I(e,t,r,n){var i=2*t,a=2*r;return e[i]<e[a]||e[i]===e[a]&&n[t]<=n[r]}function C(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&I(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!I(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function P(e,t,r){var n,i,s,l,u=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],i=e.pending_buf[e.l_buf+u],u++,0===n?S(e,i,t):(S(e,(s=h[i])+256+1,t),0!==(l=a[s])&&T(e,i-=f[s],l),S(e,s=_(--n),r),0!==(l=o[s])&&T(e,n-=g[s],l))}while(u<e.last_lit);S(e,256,t)}function x(e,t){var r,n,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;r>=1;r--)C(e,a,r);i=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],C(e,a,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,a[2*i]=a[2*r]+a[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,a[2*r+1]=a[2*n+1]=i,e.heap[1]=i++,C(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,a,o,s,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,y=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(a=l[2*l[2*(n=e.heap[r])+1]+1]+1)>p&&(a=p,y++),l[2*n+1]=a,n>u||(e.bl_count[a]++,o=0,n>=f&&(o=h[n-f]),s=l[2*n],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(c[2*n+1]+o)));if(0!==y){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,y-=2}while(y>0);for(a=p;0!==a;a--)for(n=e.bl_count[a];0!==n;)(i=e.heap[--r])>u||(l[2*i+1]!==a&&(e.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),n--)}}(e,t),A(a,u,e.bl_count)}function R(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=o,o=t[2*(n+1)+1],++s<l&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4))}function O(e,t,r){var n,i,a=-1,o=t[1],s=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=r;n++)if(i=o,o=t[2*(n+1)+1],!(++s<l&&i===o)){if(s<u)do{S(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(S(e,i,e.bl_tree),s--),S(e,16,e.bl_tree),T(e,s-3,2)):s<=10?(S(e,17,e.bl_tree),T(e,s-3,3)):(S(e,18,e.bl_tree),T(e,s-11,7));s=0,a=i,0===o?(l=138,u=3):i===o?(l=6,u=3):(l=7,u=4)}}i(g);var L=!1;function D(e,t,r,i){var a,o,s,l;T(e,0+(i?1:0),3),o=t,s=r,l=!0,k(a=e),l&&(E(a,s),E(a,~s)),n.arraySet(a.pending_buf,a.window,o,s,a.pending),a.pending+=s}t._tr_init=function(e){L||(function(){var e,t,r,n,i,l=new Array(16);for(r=0,n=0;n<28;n++)for(f[n]=r,e=0;e<1<<a[n];e++)h[r++]=n;for(h[r-1]=n,i=0,n=0;n<16;n++)for(g[n]=i,e=0;e<1<<o[n];e++)d[i++]=n;for(i>>=7;n<30;n++)for(g[n]=i<<7,e=0;e<1<<o[n]-7;e++)d[256+i++]=n;for(t=0;t<=15;t++)l[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,l[8]++;for(;e<=255;)u[2*e+1]=9,e++,l[9]++;for(;e<=279;)u[2*e+1]=7,e++,l[7]++;for(;e<=287;)u[2*e+1]=8,e++,l[8]++;for(A(u,287,l),e=0;e<30;e++)c[2*e+1]=5,c[2*e]=$(e,5);p=new v(u,a,257,286,15),y=new v(c,o,0,30,15),m=new v(new Array(0),s,0,19,7)}(),L=!0),e.l_desc=new b(e.dyn_ltree,p),e.d_desc=new b(e.dyn_dtree,y),e.bl_desc=new b(e.bl_tree,m),e.bi_buf=0,e.bi_valid=0,w(e)},t._tr_stored_block=D,t._tr_flush_block=function(e,t,r,n){var i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),x(e,e.l_desc),x(e,e.d_desc),o=function(e){var t;for(R(e,e.dyn_ltree,e.l_desc.max_code),R(e,e.dyn_dtree,e.d_desc.max_code),x(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==t?D(e,t,r,n):4===e.strategy||a===i?(T(e,2+(n?1:0),3),P(e,u,c)):(T(e,4+(n?1:0),3),function(e,t,r,n){var i;for(T(e,t-257,5),T(e,r-1,5),T(e,n-4,4),i=0;i<n;i++)T(e,e.bl_tree[2*l[i]+1],3);O(e,e.dyn_ltree,t-1),O(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),P(e,e.dyn_ltree,e.dyn_dtree)),w(e),n&&k(e)},t._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(h[r]+256+1)]++,e.dyn_dtree[2*_(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){var t;T(e,2,3),S(e,256,u),16===(t=e).bi_valid?(E(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},function(e,t,r){var n=r(39),i=r(0),a=r(7),o=r(9),s=r(2),l=r(8),u=r(42),c=Object.prototype.toString;function d(e){if(!(this instanceof d))return new d(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==o.Z_OK)throw new Error(s[r]);if(this.header=new u,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==o.Z_OK))throw new Error(s[r])}function h(e,t){var r=new d(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}d.prototype.push=function(e,t){var r,s,l,u,d,h=this.strm,f=this.options.chunkSize,p=this.options.dictionary,y=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof e?h.input=a.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?h.input=new Uint8Array(e):h.input=e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(f),h.next_out=0,h.avail_out=f),(r=n.inflate(h,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===o.Z_BUF_ERROR&&!0===y&&(r=o.Z_OK,y=!1),r!==o.Z_STREAM_END&&r!==o.Z_OK)return this.onEnd(r),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&r!==o.Z_STREAM_END&&(0!==h.avail_in||s!==o.Z_FINISH&&s!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(h.output,h.next_out),u=h.next_out-l,d=a.buf2string(h.output,l),h.next_out=u,h.avail_out=f-u,u&&i.arraySet(h.output,h.output,l,u,0),this.onData(d)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(y=!0)}while((h.avail_in>0||0===h.avail_out)&&r!==o.Z_STREAM_END);return r===o.Z_STREAM_END&&(s=o.Z_FINISH),s===o.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===o.Z_OK):s!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),h.avail_out=0,!0)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=d,t.inflate=h,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},t.ungzip=h},function(e,t,r){var n=r(0),i=r(5),a=r(6),o=r(40),s=r(41);function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function c(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(852),t.distcode=t.distdyn=new n.Buf32(592),t.sane=1,t.back=-1,0):-2}function d(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,c(e)):-2}function h(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?-2:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,d(e))):-2}function f(e,t){var r,n;return e?(n=new u,e.state=n,n.window=null,0!==(r=h(e,t))&&(e.state=null),r):-2}var p,y,m=!0;function g(e){if(m){var t;for(p=new n.Buf32(512),y=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(1,e.lens,0,288,p,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(2,e.lens,0,32,y,0,e.work,{bits:5}),m=!1}e.lencode=p,e.lenbits=9,e.distcode=y,e.distbits=5}function v(e,t,r,i){var a,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),i>=o.wsize?(n.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((a=o.wsize-o.wnext)>i&&(a=i),n.arraySet(o.window,t,r-i,a,o.wnext),(i-=a)?(n.arraySet(o.window,t,r-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=a,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=a))),0}t.inflateReset=d,t.inflateReset2=h,t.inflateResetKeep=c,t.inflateInit=function(e){return f(e,15)},t.inflateInit2=f,t.inflate=function(e,t){var r,u,c,d,h,f,p,y,m,b,_,E,T,S,$,A,w,k,I,C,P,x,R,O,L=0,D=new n.Buf8(4),M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(r=e.state).mode&&(r.mode=13),h=e.next_out,c=e.output,p=e.avail_out,d=e.next_in,u=e.input,f=e.avail_in,y=r.hold,m=r.bits,b=f,_=p,x=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;m<16;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(2&r.wrap&&35615===y){r.check=0,D[0]=255&y,D[1]=y>>>8&255,r.check=a(r.check,D,2,0),y=0,m=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&y)){e.msg="unknown compression method",r.mode=30;break}if(m-=4,P=8+(15&(y>>>=4)),0===r.wbits)r.wbits=P;else if(P>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<P,e.adler=r.check=1,r.mode=512&y?10:12,y=0,m=0;break;case 2:for(;m<16;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(r.flags=y,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=y>>8&1),512&r.flags&&(D[0]=255&y,D[1]=y>>>8&255,r.check=a(r.check,D,2,0)),y=0,m=0,r.mode=3;case 3:for(;m<32;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}r.head&&(r.head.time=y),512&r.flags&&(D[0]=255&y,D[1]=y>>>8&255,D[2]=y>>>16&255,D[3]=y>>>24&255,r.check=a(r.check,D,4,0)),y=0,m=0,r.mode=4;case 4:for(;m<16;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}r.head&&(r.head.xflags=255&y,r.head.os=y>>8),512&r.flags&&(D[0]=255&y,D[1]=y>>>8&255,r.check=a(r.check,D,2,0)),y=0,m=0,r.mode=5;case 5:if(1024&r.flags){for(;m<16;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}r.length=y,r.head&&(r.head.extra_len=y),512&r.flags&&(D[0]=255&y,D[1]=y>>>8&255,r.check=a(r.check,D,2,0)),y=0,m=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((E=r.length)>f&&(E=f),E&&(r.head&&(P=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,u,d,E,P)),512&r.flags&&(r.check=a(r.check,u,E,d)),f-=E,d+=E,r.length-=E),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===f)break e;E=0;do{P=u[d+E++],r.head&&P&&r.length<65536&&(r.head.name+=String.fromCharCode(P))}while(P&&E<f);if(512&r.flags&&(r.check=a(r.check,u,E,d)),f-=E,d+=E,P)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===f)break e;E=0;do{P=u[d+E++],r.head&&P&&r.length<65536&&(r.head.comment+=String.fromCharCode(P))}while(P&&E<f);if(512&r.flags&&(r.check=a(r.check,u,E,d)),f-=E,d+=E,P)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;m<16;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(y!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}y=0,m=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;m<32;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}e.adler=r.check=l(y),y=0,m=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,r.hold=y,r.bits=m,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){y>>>=7&m,m-=7&m,r.mode=27;break}for(;m<3;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}switch(r.last=1&y,m-=1,3&(y>>>=1)){case 0:r.mode=14;break;case 1:if(g(r),r.mode=20,6===t){y>>>=2,m-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}y>>>=2,m-=2;break;case 14:for(y>>>=7&m,m-=7&m;m<32;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&y,y=0,m=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(E=r.length){if(E>f&&(E=f),E>p&&(E=p),0===E)break e;n.arraySet(c,u,d,E,h),f-=E,d+=E,p-=E,h+=E,r.length-=E;break}r.mode=12;break;case 17:for(;m<14;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(r.nlen=257+(31&y),y>>>=5,m-=5,r.ndist=1+(31&y),y>>>=5,m-=5,r.ncode=4+(15&y),y>>>=4,m-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;m<3;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}r.lens[M[r.have++]]=7&y,y>>>=3,m-=3}for(;r.have<19;)r.lens[M[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,R={bits:r.lenbits},x=s(0,r.lens,0,19,r.lencode,0,r.work,R),r.lenbits=R.bits,x){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;A=(L=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,w=65535&L,!(($=L>>>24)<=m);){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(w<16)y>>>=$,m-=$,r.lens[r.have++]=w;else{if(16===w){for(O=$+2;m<O;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(y>>>=$,m-=$,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}P=r.lens[r.have-1],E=3+(3&y),y>>>=2,m-=2}else if(17===w){for(O=$+3;m<O;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}m-=$,P=0,E=3+(7&(y>>>=$)),y>>>=3,m-=3}else{for(O=$+7;m<O;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}m-=$,P=0,E=11+(127&(y>>>=$)),y>>>=7,m-=7}if(r.have+E>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;E--;)r.lens[r.have++]=P}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,R={bits:r.lenbits},x=s(1,r.lens,0,r.nlen,r.lencode,0,r.work,R),r.lenbits=R.bits,x){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,R={bits:r.distbits},x=s(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,R),r.distbits=R.bits,x){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(f>=6&&p>=258){e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,r.hold=y,r.bits=m,o(e,_),h=e.next_out,c=e.output,p=e.avail_out,d=e.next_in,u=e.input,f=e.avail_in,y=r.hold,m=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;A=(L=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,w=65535&L,!(($=L>>>24)<=m);){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(A&&0==(240&A)){for(k=$,I=A,C=w;A=(L=r.lencode[C+((y&(1<<k+I)-1)>>k)])>>>16&255,w=65535&L,!(k+($=L>>>24)<=m);){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}y>>>=k,m-=k,r.back+=k}if(y>>>=$,m-=$,r.back+=$,r.length=w,0===A){r.mode=26;break}if(32&A){r.back=-1,r.mode=12;break}if(64&A){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&A,r.mode=22;case 22:if(r.extra){for(O=r.extra;m<O;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}r.length+=y&(1<<r.extra)-1,y>>>=r.extra,m-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;A=(L=r.distcode[y&(1<<r.distbits)-1])>>>16&255,w=65535&L,!(($=L>>>24)<=m);){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(0==(240&A)){for(k=$,I=A,C=w;A=(L=r.distcode[C+((y&(1<<k+I)-1)>>k)])>>>16&255,w=65535&L,!(k+($=L>>>24)<=m);){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}y>>>=k,m-=k,r.back+=k}if(y>>>=$,m-=$,r.back+=$,64&A){e.msg="invalid distance code",r.mode=30;break}r.offset=w,r.extra=15&A,r.mode=24;case 24:if(r.extra){for(O=r.extra;m<O;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}r.offset+=y&(1<<r.extra)-1,y>>>=r.extra,m-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===p)break e;if(E=_-p,r.offset>E){if((E=r.offset-E)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}E>r.wnext?(E-=r.wnext,T=r.wsize-E):T=r.wnext-E,E>r.length&&(E=r.length),S=r.window}else S=c,T=h-r.offset,E=r.length;E>p&&(E=p),p-=E,r.length-=E;do{c[h++]=S[T++]}while(--E);0===r.length&&(r.mode=21);break;case 26:if(0===p)break e;c[h++]=r.length,p--,r.mode=21;break;case 27:if(r.wrap){for(;m<32;){if(0===f)break e;f--,y|=u[d++]<<m,m+=8}if(_-=p,e.total_out+=_,r.total+=_,_&&(e.adler=r.check=r.flags?a(r.check,c,_,h-_):i(r.check,c,_,h-_)),_=p,(r.flags?y:l(y))!==r.check){e.msg="incorrect data check",r.mode=30;break}y=0,m=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;m<32;){if(0===f)break e;f--,y+=u[d++]<<m,m+=8}if(y!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}y=0,m=0}r.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;default:return-2}return e.next_out=h,e.avail_out=p,e.next_in=d,e.avail_in=f,r.hold=y,r.bits=m,(r.wsize||_!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&v(e,e.output,e.next_out,_-e.avail_out)?(r.mode=31,-4):(b-=e.avail_in,_-=e.avail_out,e.total_in+=b,e.total_out+=_,r.total+=_,r.wrap&&_&&(e.adler=r.check=r.flags?a(r.check,c,_,e.next_out-_):i(r.check,c,_,e.next_out-_)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===b&&0===_||4===t)&&0===x&&(x=-5),x)},t.inflateEnd=function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?-2:(r.head=t,t.done=!1,0):-2},t.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?-2:11===r.mode&&i(1,t,n,0)!==r.check?-3:v(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):-2},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,r){e.exports=function(e,t){var r,n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b,_,E,T,S,$,A,w;r=e.state,n=e.next_in,A=e.input,i=n+(e.avail_in-5),a=e.next_out,w=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=r.dmax,u=r.wsize,c=r.whave,d=r.wnext,h=r.window,f=r.hold,p=r.bits,y=r.lencode,m=r.distcode,g=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{p<15&&(f+=A[n++]<<p,p+=8,f+=A[n++]<<p,p+=8),b=y[f&g];t:for(;;){if(f>>>=_=b>>>24,p-=_,0==(_=b>>>16&255))w[a++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=y[(65535&b)+(f&(1<<_)-1)];continue t}if(32&_){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}E=65535&b,(_&=15)&&(p<_&&(f+=A[n++]<<p,p+=8),E+=f&(1<<_)-1,f>>>=_,p-=_),p<15&&(f+=A[n++]<<p,p+=8,f+=A[n++]<<p,p+=8),b=m[f&v];r:for(;;){if(f>>>=_=b>>>24,p-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=m[(65535&b)+(f&(1<<_)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(T=65535&b,p<(_&=15)&&(f+=A[n++]<<p,(p+=8)<_&&(f+=A[n++]<<p,p+=8)),(T+=f&(1<<_)-1)>l){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=_,p-=_,T>(_=a-o)){if((_=T-_)>c&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(S=0,$=h,0===d){if(S+=u-_,_<E){E-=_;do{w[a++]=h[S++]}while(--_);S=a-T,$=w}}else if(d<_){if(S+=u+d-_,(_-=d)<E){E-=_;do{w[a++]=h[S++]}while(--_);if(S=0,d<E){E-=_=d;do{w[a++]=h[S++]}while(--_);S=a-T,$=w}}}else if(S+=d-_,_<E){E-=_;do{w[a++]=h[S++]}while(--_);S=a-T,$=w}for(;E>2;)w[a++]=$[S++],w[a++]=$[S++],w[a++]=$[S++],E-=3;E&&(w[a++]=$[S++],E>1&&(w[a++]=$[S++]))}else{S=a-T;do{w[a++]=w[S++],w[a++]=w[S++],w[a++]=w[S++],E-=3}while(E>2);E&&(w[a++]=w[S++],E>1&&(w[a++]=w[S++]))}break}}break}}while(n<i&&a<s);n-=E=p>>3,f&=(1<<(p-=E<<3))-1,e.next_in=n,e.next_out=a,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=a<s?s-a+257:257-(a-s),r.hold=f,r.bits=p}},function(e,t,r){var n=r(0),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,r,l,u,c,d,h){var f,p,y,m,g,v,b,_,E,T=h.bits,S=0,$=0,A=0,w=0,k=0,I=0,C=0,P=0,x=0,R=0,O=null,L=0,D=new n.Buf16(16),M=new n.Buf16(16),N=null,G=0;for(S=0;S<=15;S++)D[S]=0;for($=0;$<l;$++)D[t[r+$]]++;for(k=T,w=15;w>=1&&0===D[w];w--);if(k>w&&(k=w),0===w)return u[c++]=20971520,u[c++]=20971520,h.bits=1,0;for(A=1;A<w&&0===D[A];A++);for(k<A&&(k=A),P=1,S=1;S<=15;S++)if(P<<=1,(P-=D[S])<0)return-1;if(P>0&&(0===e||1!==w))return-1;for(M[1]=0,S=1;S<15;S++)M[S+1]=M[S]+D[S];for($=0;$<l;$++)0!==t[r+$]&&(d[M[t[r+$]]++]=$);if(0===e?(O=N=d,v=19):1===e?(O=i,L-=257,N=a,G-=257,v=256):(O=o,N=s,v=-1),R=0,$=0,S=A,g=c,I=k,C=0,y=-1,m=(x=1<<k)-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){b=S-C,d[$]<v?(_=0,E=d[$]):d[$]>v?(_=N[G+d[$]],E=O[L+d[$]]):(_=96,E=0),f=1<<S-C,A=p=1<<I;do{u[g+(R>>C)+(p-=f)]=b<<24|_<<16|E|0}while(0!==p);for(f=1<<S-1;R&f;)f>>=1;if(0!==f?(R&=f-1,R+=f):R=0,$++,0==--D[S]){if(S===w)break;S=t[r+d[$]]}if(S>k&&(R&m)!==y){for(0===C&&(C=k),g+=A,P=1<<(I=S-C);I+C<w&&!((P-=D[I+C])<=0);)I++,P<<=1;if(x+=1<<I,1===e&&x>852||2===e&&x>592)return 1;u[y=R&m]=k<<24|I<<16|g-c|0}}return 0!==R&&(u[g+R]=S-C<<24|64<<16|0),h.bits=k,0}},function(e,t,r){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timeID=null,this.func=null}return n(e,[{key:"repeat",value:function(e,t){var r=this;null===this.func&&(this.func=e),this.func===e&&(this.timeID=setTimeout((function(){e(),r.repeat(e,t)}),t))}},{key:"clear",value:function(){clearTimeout(this.timeID)}}]),e}();t.default=i,e.exports=t.default},function(e,t,r){e.exports=function(){return r(45)('!function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";var r,n=a(1),o=(r=n)&&r.__esModule?r:{default:r};var i=[],s=-1,u=0,d=function(e){for(var t=new o.default,a=s<0?u-1:s+1,r=null,n=s<0?0:s;n<=a;n++)if(i[n]&&e>=i[n].timeStart&&e<i[n].timeEnd){if(s=n,i[n].download){if(!i[n].frameList)break;if(i[n].currentFrame<0)for(var d=i[n].frameList,f=0,l=d.length-1;f<=l;){var c=Math.ceil(f+(l-f)*(1e3*e-d[f].dataPts)/(d[l].dataPts-d[f].dataPts));if(1e3*e>=d[c=Math.min(c,l)].dataPts){if(!(c<d.length-1)){r={svgData:d[c].dataSvgBase64};break}if(1e3*e<d[c+1].dataPts){r={svgData:d[c].dataSvgBase64};break}f=c+1}else{if(!(c>0)){r={svgData:d[c].dataSvgBase64};break}if(1e3*e>=d[c-1].dataPts){r={svgData:d[c].dataSvgBase64};break}l=c-1}}else for(var v=i[n].currentFrame;v<i[n].frameList.length-1;v++){var g=i[n].frameList[v],m=i[n].frameList[v+1];if(1e3*e>=g.dataPts&&1e3*e<m.dataPts){r={svgData:(1e3*e-g.dataPts<=m.dataPts-1e3*e?g:m).dataSvgBase64};break}}}else r={range:[i[n].dataStart,i[n].dataEnd],index:n};n+1<u&&!i[n+1].download&&(r={range:[i[n+1].dataStart,i[n+1].dataEnd],index:n+1});break}return t.resolve(r),t};onmessage=function(e){var t=this;if("searchFrame"===e.data.method){var a=e.data.args;d(a.currentTime||0).then((function(e){e&&(void 0!==e.svgData?t.postMessage({method:"searchResult",args:{svgData:e.svgData}}):e.range&&t.postMessage({method:"getData",args:{range:e.range,index:e.index}}))}))}else if("updateData"===e.data.method){var r=e.data.args;i=r.dataList,u=r.indexCount}else if("updateDataListItem"===e.data.method){var n=e.data.args;i[n.index][n.key]=n.value}else"onDanmuMaskSeeked"===e.data.method&&(s=-1,i&&i.forEach((function(e){e.currentFrame=-1})))}},function(e,t,a){"use strict";a.r(t);var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=void 0,a=void 0,r=new Promise((function(e,r){t=e,a=r}));return r.resolve=t,r.reject=a,r}return r(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}();t.default=n}]);\n//# sourceMappingURL=4fb552b0780015bcf95a.worker.js.map',"/4fb552b0780015bcf95a.worker.js")}},function(e,t,r){var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(i){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(i){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(a){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e){e.exports=JSON.parse('{"version":"0.3.6"}')}])}(dist$1);var DanmuMask=getDefaultExportFromCjs(dist$1.exports),isPC="pc"===sniffer$1.device,MIN_INTERVAL=300,POSITIONS$8=Plugin.POSITIONS,DanmuPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).seekCost=window.performance.now(),n.eventBus=new EventEmitter$1,n.state=new State(e.config),n.state.updateLang(n.player.lang),n.iconWrap=document.createElement("div"),helpers.addClass(n.iconWrap,"icon-warp"),n.tipsWrap=document.createElement("div"),helpers.addClass(n.tipsWrap,"tips-wrap"),n.container=new Container(n.state),n.panel=new Panel(n.state),n}return _createClass$k(r,[{key:"afterCreate",value:function(){var e;null===(e=this.player.root)||void 0===e||e.appendChild(this.container.root),this.renderIcon(),this.renderBox(),this.root.appendChild(this.iconWrap),isPC&&(this.state.getConfig().usePanel&&this.root.appendChild(this.panel.root),this.renderTips(),helpers.addClass(this.panel.root,"pc-panel"),this.root.appendChild(this.tipsWrap)),this.initEvents(),this.container.initDanmuContainer()}},{key:"afterPlayerInit",value:function(){this.initDanmuMask()}},{key:"updateLang",value:function(e){this.state.updateLang(this.player.lang),this.eventBus.emit("updateLang")}},{key:"registerIcons",value:function(){return{open:{icon:danmuActiveSVG$1,class:"xgplayer-danmu-open-svg"},close:{icon:Default,class:"xgplayer-danmu-close-svg"},reset:{icon:resetIcon,class:"xgplayer-danmu-reset-svg"}}}},{key:"initEvents",value:function(){isPC?this.bindPCEvent():this.bindMobileEvent(),this.bindPlayerEvent()}},{key:"bindPlayerEvent",value:function(){var e=this;this.once(TIME_UPDATE,(function(){e.container.start()})),this.on(PAUSE,(function(){e.container.pause()})),this.on(PLAY,(function(){e.container.play()})),this.on(SEEKING,(function(){e.seekCost=window.performance.now(),e.container.stop()})),this.on(SEEKED,debounce$3((function(){e.container.start()}),MIN_INTERVAL)),this.on([FULLSCREEN_CHANGE,CSS_FULLSCREEN_CHANGE,MINI_STATE_CHANGE],(function(){e.container.resize(),e.handleResize()})),this.on(PIP_CHANGE,this.handlePIP.bind(this))}},{key:"bindPCEvent",value:function(){var e=this;helpers.addEventListener(this.root,"click",this.onClick.bind(this)),helpers.addEventListener(this.root,"mouseenter",(function(){e.state.getConfig().active?(helpers.style(e.panel.root,{display:"block"}),helpers.style(e.tipsWrap,{display:"none"})):(helpers.style(e.panel.root,{display:"none"}),helpers.style(e.tipsWrap,{display:"block"}))})),helpers.addEventListener(this.root,"mouseleave",(function(){helpers.style(e.panel.root,{display:"none"}),helpers.style(e.tipsWrap,{display:"none"})}))}},{key:"bindMobileEvent",value:function(){var e=this;helpers.addEventListener(this.root,"click",(function(){e.state.getConfig().usePanel?e.player.panel.showPanel(e.panel.root):e.onClick()}))}},{key:"onClick",value:function(){this.toggleDanmu(),this.renderIcon()}},{key:"toggleDanmu",value:function(){var e=this.state.getConfig(),t=e.active,r=e.maskActive,n=!t;n?(this.state.updateConfig({active:n}),r&&this.initMask()):(null==this||this.container.clear(),this.destroyMask(),this.state.updateConfig({active:n})),this.player.emit(PluginEvents.DANMU_CHANGE,{active:n}),this.danmuSwitchInSettingPanel&&(this.danmuSwitchInSettingPanel.value=n,this.danmuSwitchInSettingPanel.render())}},{key:"renderIcon",value:function(){this.iconWrap.innerHTML="",this.state.getConfig().active?this.iconWrap.appendChild(this.icons.open):this.iconWrap.appendChild(this.icons.close)}},{key:"renderTips",value:function(){this.tipsWrap.innerHTML=this.state.curLangMap.openDanmu}},{key:"renderBox",value:function(){var e=this;this.panel.root.innerHTML="";var t=document.createElement("div");helpers.addClass(t,"box-header"),t.innerHTML='<div class="header-setting">'+this.state.curLangMap.danmuSetting+'</div> <div class="header-reset"></div>';var r=t.querySelector(".header-reset");r.appendChild(this.icons.reset),helpers.addEventListener(r,"click",(function(t){t.stopPropagation(),e.eventBus.emit("reset")}),{capture:!0});var n=document.createElement("span");n.innerHTML=this.state.curLangMap.reset,r.appendChild(n),this.eventBus.on("updateLang",(function(){n.innerHTML=e.state.curLangMap.reset,t.querySelector(".header-setting").innerHTML=e.state.curLangMap.danmuSetting})),this.panel.root.appendChild(t),isPC||this.renderTurnOff(),this.renderSliders(),this.renderSwitches()}},{key:"renderTurnOff",value:function(){var e=this,t={name:this.state.curLangMap.danmuSwitch,key:"active",value:this.state.getConfig().active||!1},r=new Switch(t);this.danmuSwitchInSettingPanel=r,this.panel.root.appendChild(r.root),r.onChange((function(t){e.toggleDanmu(),e.renderIcon()})),this.eventBus.on("updateLang",(function(){r.renderName(e.state.curLangMap.danmuSwitch)}))}},{key:"renderSwitches",value:function(){var e,t=this;null===(e=this.state.getConfig().external)||void 0===e||e.forEach((function(e){var r=new Switch(e);t.panel.root.appendChild(r.root),t.eventBus.on("updateLang",(function(){r.renderName(e.name)})),r.onChange((function(r){var n=t.state.getConfig().external||[];n.forEach((function(t){t.key===e.key&&(t.value=r)})),t.state.updateConfig({external:n}),t.player.emit(PluginEvents.DANMU_CHANGE,{external:n})}))}))}},{key:"renderSliders",value:function(){var e=this;this.state.sliderItemsProps.forEach((function(t,r){var n,i,a=document.createElement("div"),o=new Slider(a,t);null!=(null===(n=e.state.getConfig())||void 0===n?void 0:n[t.key])&&o.setValue(null===(i=e.state.getConfig())||void 0===i?void 0:i[t.key]);o.onChange((function(r){e.state.updateConfig(_defineProperty$j({},t.key,r)),console.log("val",e.state.getConfig()),e.player.emit(PluginEvents.DANMU_CHANGE,_defineProperty$j({},t.key,r)),e.container.setProperty(t.key,r)})),e.eventBus.on("reset",(function(){o.setValue(t.defaultValue)})),e.eventBus.on("updateLang",(function(){o.renderText(e.state.sliderItemsProps[r])})),e.panel.root.appendChild(a)}))}},{key:"sendDanmu",value:function(e){return this.container.sendDanmu(e)}},{key:"updateConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.state.updateConfig(e)}},{key:"getConfig",value:function(){return this.state.getConfig()}},{key:"initDanmuMask",value:function(){if(this.player){var e=this.state.getConfig(),t=e.maskConfig,r=e.active,n=e.maskActive;t.maskUrl&&(this.renderDanmuMaskTurnOff(),r&&n&&this.initMask())}}},{key:"renderDanmuMaskTurnOff",value:function(){var e=this,t={name:this.state.curLangMap.danmuMask,key:"maskActive",value:this.state.getConfig().maskActive||!1},r=new Switch(t);this.panel.root.appendChild(r.root),r.onChange((function(t){e.state.updateConfig({maskActive:t}),t?e.initMask():e.destroyMask(),e.renderIcon()})),this.eventBus.on("updateLang",(function(){r.renderName(e.state.curLangMap.danmuMask)}))}},{key:"initMask",value:function(){this.destroyMask();var e=this.state.getConfig(),t=e.maskConfig,r=e.maskActive,n=e.active;t.maskUrl&&r&&n&&(this.mask=new DanmuMask({player:this.player,url:t.maskUrl,originStart:t.maskOffset,interval:t.interval}),this.mask.init())}},{key:"destroyMask",value:function(){this.mask&&(this.mask.destroy(),this.mask=null)}},{key:"handleResize",value:function(){var e,t,r,n;if(this.mask){var i=this.player;this.mask.setContainerSize(null!==(e=null==i||null===(t=i.root)||void 0===t?void 0:t.offsetWidth)&&void 0!==e?e:0,null!==(r=null==i||null===(n=i.root)||void 0===n?void 0:n.offsetHeight)&&void 0!==r?r:0)}}},{key:"handlePIP",value:function(e){e?this.destroyMask():this.initMask()}},{key:"destroy",value:function(){this.destroyMask(),this.container.destroy(),this.panel.destroy()}},{key:"render",value:function(){return'<div class="xgplayer-danmu"></div>'}}],[{key:"pluginName",get:function(){return"DanmuPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$8.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.DanmuPlugin}}}]),r}(Plugin);function ownKeys$4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$4(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$4(Object(r),!0).forEach((function(t){_defineProperty$7(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$4(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$4(){_regeneratorRuntime$4=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var i=c(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function _typeof$3(e){return(_typeof$3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$5(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$5(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$5(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$5(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$8(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass$8(e,t,r){return t&&_defineProperties$8(e.prototype,t),r&&_defineProperties$8(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$7(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$4(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$4(e,t)}function _getPrototypeOf$4(e){return(_getPrototypeOf$4=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$4(e,t){return(_setPrototypeOf$4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$5(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized$4(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$4(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$4(e)}function _createSuper$5(e){var t=_isNativeReflectConstruct$5();return function(){var r,n=_getPrototypeOf$4(e);if(t){var i=_getPrototypeOf$4(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$4(this,r)}}function _toConsumableArray$4(e){return _arrayWithoutHoles$4(e)||_iterableToArray$4(e)||_unsupportedIterableToArray$5(e)||_nonIterableSpread$4()}function _arrayWithoutHoles$4(e){if(Array.isArray(e))return _arrayLikeToArray$5(e)}function _iterableToArray$4(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray$5(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$5(e,t):void 0}}function _arrayLikeToArray$5(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$4(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toPrimitive(e,t){if("object"!==_typeof$b(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==_typeof$b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof$b(t)?t:String(t)}function _regeneratorRuntime$3(){_regeneratorRuntime$3=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep$4(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$4(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$4(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$4(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$6(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$7(e,t,r){return t&&_defineProperties$7(e.prototype,t),r&&_defineProperties$7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$6(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$3(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$3(e,t)}function _getPrototypeOf$3(e){return(_getPrototypeOf$3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$3(e,t){return(_setPrototypeOf$3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$4(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct$1(e,t,r){return(_construct$1=_isNativeReflectConstruct$4()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$3(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction$1(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper$1(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper$1=function(e){if(null===e||!_isNativeFunction$1(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct$1(e,arguments,_getPrototypeOf$3(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$3(r,e)},_wrapNativeSuper$1(e)}function _assertThisInitialized$3(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$3(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$3(e)}function _createSuper$4(e){var t=_isNativeReflectConstruct$4();return function(){var r,n=_getPrototypeOf$3(e);if(t){var i=_getPrototypeOf$3(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$3(this,r)}}function createPublicPromise$1(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}function nowTime$1(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}var Buffer$2=function(){function e(){_classCallCheck$6(this,e)}return _createClass$7(e,null,[{key:"start",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6||1===e.length&&e.start(0)<0?0:e.start(0):0}},{key:"end",value:function(e){return e&&e.length?1===e.length&&e.end(0)-e.start(0)<1e-6?0:e.end(e.length-1):0}},{key:"get",value:function(e){if(e)try{return e.buffered}catch(error){}}},{key:"buffers",value:function(e,t){if(!e||!e.length)return[];for(var r=[],n=0,i=e.length;n<i;n++){var a=r.length;if(a&&t){var o=r[a-1],s=o[1];if(e.start(n)-s<=t){var l=e.end(n);l>s&&(o[1]=l)}else r.push([e.start(n),e.end(n)])}else r.push([e.start(n),e.end(n)])}return r}},{key:"totalLength",value:function(e){return e&&e.length?e.reduce((function(e,t){return e+(t[1]-t[0])}),0):0}},{key:"info",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t||!t.length)return{start:0,end:0,buffers:[]};for(var i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=e.buffers(t,n),h=0,f=d.length;h<f;h++){var p=d[h];if(r+n>=p[0]&&r<p[1])i=p[0],a=p[1],o=h;else{if(r+n<p[0]){s=p[0],l=p[1];break}r+n>p[1]&&(u=p[0],c=p[1])}}return{start:i,end:a,index:o,buffers:d,nextStart:s,nextEnd:l,prevStart:u,prevEnd:c,currentTime:r,behind:r-i,remaining:a?a-r:0,length:e.totalLength&&e.totalLength(d)}}}]),e}(),_ERR_CODE,ERR={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION"}},ERR_CODE=(_ERR_CODE={},_defineProperty$6(_ERR_CODE,ERR.MANIFEST,{HLS:1100}),_defineProperty$6(_ERR_CODE,ERR.NETWORK,2100),_defineProperty$6(_ERR_CODE,ERR.NETWORK_TIMEOUT,2101),_defineProperty$6(_ERR_CODE,ERR.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400}),_defineProperty$6(_ERR_CODE,ERR.REMUX,{FMP4:4100,MP4:4200}),_defineProperty$6(_ERR_CODE,ERR.MEDIA,{MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203}),_defineProperty$6(_ERR_CODE,ERR.OTHER,8e3),_ERR_CODE),StreamingError=function(e){_inherits$3(r,e);var t=_createSuper$4(r);function r(e,n,i,a,o){var s;return _classCallCheck$6(this,r),(s=t.call(this,o||(null==i?void 0:i.message))).errorType=e===ERR.NETWORK_TIMEOUT?ERR.NETWORK:e,s.originError=i,s.ext=a,s.errorCode=ERR_CODE[e][n]||ERR_CODE[e],s.errorMessage=s.message,s.errorCode||(s.errorType=ERR.OTHER,s.errorCode=ERR_CODE[s.errorType]),s}return _createClass$7(r,null,[{key:"create",value:function(e,t,n,i,a){return e instanceof r?e:(e instanceof Error&&(n=e,e=""),e||(e=ERR.OTHER),new r(e,t,n,i,a))}},{key:"network",value:function(e){var t;return new r(null!=e&&e.isTimeout?ERR.NETWORK_TIMEOUT:ERR.NETWORK,e,null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e||null===(t=e.response)||void 0===t?void 0:t.status})}}]),r}(_wrapNativeSuper$1(Error)),isBrowser$2="undefined"!=typeof window,Logger$4=function(){function e(t){_classCallCheck$6(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$7(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix,nowTime$1()].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix,nowTime$1()].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix,nowTime$1()].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix,nowTime$1()].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function getMediaSource(){try{return isBrowser$2?window.MediaSource:null}catch(e){}}_defineProperty$6(Logger$4,"disabled",!0);var MediaSource$1=getMediaSource(),OP_NAME={APPEND:"appendBuffer",REMOVE:"removeBuffer"},MSE=function(){function e(t,r){var n=this;_classCallCheck$6(this,e),_defineProperty$6(this,"media",null),_defineProperty$6(this,"mediaSource",null),_defineProperty$6(this,"_openPromise",createPublicPromise$1()),_defineProperty$6(this,"_queue",Object.create(null)),_defineProperty$6(this,"_sourceBuffer",Object.create(null)),_defineProperty$6(this,"_mseFullFlag",{}),_defineProperty$6(this,"_st",0),_defineProperty$6(this,"_opst",0),_defineProperty$6(this,"_logger",null),_defineProperty$6(this,"_config",null),_defineProperty$6(this,"_url",null),_defineProperty$6(this,"_onSBUpdateEnd",(function(e){var t=n._queue[e];if(t){var r=t.shift();if(r){var i=nowTime$1()-n._opst;n._logger.debug("UpdateEnd",r.opName,i,r.context),r.promise.resolve({name:r.opName,context:r.context,costtime:i}),n._startQueue(e)}}})),_defineProperty$6(this,"_onSBUpdateError",(function(e,t){var r=n._queue[e];if(r){var i=r[0];i&&(n._logger.error("UpdateError",e,i.opName,i.context),i.promise.reject(new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_APPEND_BUFFER,t)))}})),this._config=Object.assign(e.getDefaultConfig(),r),t&&this.bindMedia(t),this._logger=new Logger$4("MSE"),this._config.openLog&&Logger$4.enable()}var t,r,n;return _createClass$7(e,[{key:"isOpened",get:function(){var e;return"open"===(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"isFull",value:function(t){return t?this._mseFullFlag[t]:this._mseFullFlag[e.VIDEO]}},{key:"updateDuration",value:function(e){var t=this;return this.mediaSource&&this.mediaSource.duration>e?Promise.resolve():this._enqueueBlockingOp((function(){t.isEnded?t._logger.debug("[debug mse] setDuration ended"):t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("[debug mse] setDuration"))}),"updateDuration")}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",(function r(){var n=nowTime$1()-e._st;e._logger.debug("MSE OPEN",n),t.removeEventListener("sourceopen",r),e._openPromise.resolve({costtime:n})})),this._openPromise=createPublicPromise$1()}return this._openPromise}},{key:"bindMedia",value:(n=_asyncToGenerator$4(_regeneratorRuntime$3().mark((function e(t){var r,n,i=this;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mediaSource&&!this.media){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(t&&MediaSource$1){e.next=5;break}throw new Error("Param media or MediaSource does not exist");case 5:return this.media=t,r=this.mediaSource=new MediaSource$1,this._st=nowTime$1(),n=function e(){var n=nowTime$1()-i._st;i._logger.debug("MSE OPEN"),r.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),i._openPromise.resolve({costtime:n})},r.addEventListener("sourceopen",n),this._url=URL.createObjectURL(r),t.src=this._url,e.abrupt("return",this._openPromise);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"unbindMedia",value:(r=_asyncToGenerator$4(_regeneratorRuntime$3().mark((function e(){var t,r,n,i=this;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach((function(e){var t=i._queue[e];t&&t.forEach((function(e){return e.promise.resolve}))})),r=!!this.media&&this.media.readyState>=1,n="open"===t.readyState,r&&n)try{t.endOfStream()}catch(error){}Object.keys(this._sourceBuffer).forEach((function(e){try{t.removeSourceBuffer(i._sourceBuffer[e])}catch(error){}}))}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(error){}this.media=null}this.mediaSource=null,this._openPromise=createPublicPromise$1(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"createSource",value:function(e,t){if(!this._sourceBuffer[e]&&this.mediaSource){var r;try{r=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(error){throw new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_ADD_SB,error)}r.mimeType=t,r.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),r.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var r=this._sourceBuffer[e];return this.mediaSource&&r&&r.mimeType!==t&&"function"==typeof r.changeType?this._enqueueOp((function(){r.changeType(t)})):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,r){var n=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,(function(){var i;n.mediaSource&&(n._logger.debug("MSE APPEND START",r),n._opst=nowTime$1(),null===(i=n._sourceBuffer[e])||void 0===i||i.appendBuffer(t))}),OP_NAME.APPEND,r):Promise.resolve()}},{key:"remove",value:function(e,t,r,n){var i=this,a=!1;return this._mseFullFlag[e]&&(a=!0),this._enqueueOp(e,(function(){if(i.mediaSource){var a=i._sourceBuffer[e];t>=r||!a?i._onSBUpdateEnd(e):(i._opst=nowTime$1(),i._logger.debug("MSE REMOVE START",e,t,r,n),a.remove(t,r))}}),OP_NAME.REMOVE,n,a)}},{key:"clearBuffer",value:function(e,t){var r,n=this;return Object.keys(this._sourceBuffer).forEach((function(i){r=n._enqueueOp(i,(function(){if(n.mediaSource){var r=n._sourceBuffer[i];n._logger.debug("MSE clearBuffer START",i,e,t),r.remove(e,t)}}))})),r}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach((function(r){e=t._enqueueOp(r,(function(){if(t.mediaSource){var e=t._sourceBuffer[r];t._logger.debug("MSE clearAllBuffer START",r),e.remove(0,Buffer$2.end(Buffer$2.get(e)))}}))})),e}},{key:"clearOpQueues",value:function(e){var t;this._logger.debug("MSE clearOpQueue START");var r=this._queue[e];if(r&&r[e]&&!(r.length<5)){var n=[];r.forEach((function(e){e.context&&e.context.isinit&&n.push(e)})),this._queue[e]=r.slice(0,2),n.length>0&&(t=this._queue[e]).push.apply(t,n)}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp((function(){var r=t.mediaSource;r&&"open"===r.readyState&&(t._logger.debug("MSE endOfStream START"),e?r.endOfStream(e):r.endOfStream())}),"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var r=this.mediaSource;e<0||t<e||null==r||!r.setLiveSeekableRange||"open"!==r.readyState||r.setLiveSeekableRange(e,t)}},{key:"buffered",value:function(e){return Buffer$2.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return Buffer$2.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return Buffer$2.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,r,n,i){var a=this;if(!this.mediaSource)return Promise.resolve();var o=this._queue[e]=this._queue[e]||[],s={exec:t,promise:createPublicPromise$1(),opName:r,context:n};return i?(o.splice(0,0,s),this._mseFullFlag[e]=!1,this._startQueue(e)):o.push(s),this.isOpened?1===o.length&&this._startQueue(e):this._openPromise.then((function(){1===o.length&&a._startQueue(e)})),s.promise}},{key:"_enqueueBlockingOp",value:(t=_asyncToGenerator$4(_regeneratorRuntime$3().mark((function e(t,r){var n,i,a=this;return _regeneratorRuntime$3().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((n=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return i=[],n.forEach((function(e){var t=a._queue[e],n=createPublicPromise$1();i.push(n),t.push({exec:function(){return n.resolve()},promise:n,opName:r}),1===t.length&&a._startQueue(e)})),e.abrupt("return",Promise.all(i).then((function(){try{return t()}finally{n.forEach((function(e){var t=a._queue[e],r=a._sourceBuffer[e];null==t||t.shift(),r&&r.updating||a._startQueue(e)}))}})));case 8:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var r=t[0];if(r&&!this._mseFullFlag[e])try{r.exec()}catch(error){error&&error.message&&error.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,this._logger.error("[MSE error],  context,",r.context," ,name,",r.opName,",err,SourceBuffer is full"),r.promise.reject(new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_FULL,error))):(this._logger.error(error),r.promise.reject(new StreamingError(ERR.MEDIA,ERR.SUB_TYPES.MSE_OTHER,error)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,r){var n=this;return this._enqueueOp(e,(function(){t<0&&(t+=.001),n._sourceBuffer[e].timestampOffset=t,n._onSBUpdateEnd(e)}),"setTimeoffset",r)}},{key:"abort",value:function(e,t){var r=this;return this.isOpened?this._enqueueOp(e,(function(){r._sourceBuffer[e].abort(),r._onSBUpdateEnd(e)}),"abort",t):Promise.resolve()}}],[{key:"getDefaultConfig",value:function(){return{openLog:!1}}},{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!MediaSource$1)return!1;try{return MediaSource$1.isTypeSupported(e)}catch(error){return this._logger.error(e,error),!1}}}]),e}();function _classCallCheck$5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$6(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$6(e,t,r){return t&&_defineProperties$6(e.prototype,t),r&&_defineProperties$6(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$5(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _slicedToArray$3(e,t){return _arrayWithHoles$3(e)||_iterableToArrayLimit$3(e,t)||_unsupportedIterableToArray$4(e,t)||_nonIterableRest$3()}function _toConsumableArray$3(e){return _arrayWithoutHoles$3(e)||_iterableToArray$3(e)||_unsupportedIterableToArray$4(e)||_nonIterableSpread$3()}function _arrayWithoutHoles$3(e){if(Array.isArray(e))return _arrayLikeToArray$4(e)}function _arrayWithHoles$3(e){if(Array.isArray(e))return e}function _iterableToArray$3(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$3(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$4(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$4(e,t):void 0}}function _arrayLikeToArray$4(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$3(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$3(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}_defineProperty$6(MSE,"VIDEO","video"),_defineProperty$6(MSE,"AUDIO","audio");var TrackType$1={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType$1={AVC:"avc",HEVC:"hevc"},AudioCodecType={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m"},VideoTrack=function(){function e(){_classCallCheck$5(this,e),_defineProperty$5(this,"id",1),_defineProperty$5(this,"type",TrackType$1.VIDEO),_defineProperty$5(this,"codecType",VideoCodecType$1.AVC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"hvcC",void 0),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"pps",[]),_defineProperty$5(this,"sps",[]),_defineProperty$5(this,"vps",[]),_defineProperty$5(this,"fpsNum",0),_defineProperty$5(this,"fpsDen",0),_defineProperty$5(this,"sarRatio",[]),_defineProperty$5(this,"width",0),_defineProperty$5(this,"height",0),_defineProperty$5(this,"nalUnitSize",4),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"isVideoEncryption",!1),_defineProperty$5(this,"isAudioEncryption",!1),_defineProperty$5(this,"kid",null),_defineProperty$5(this,"pssh",null),_defineProperty$5(this,"ext",void 0)}return _createClass$6(e,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"exist",value:function(){return!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),AudioTrack=function(){function e(){_classCallCheck$5(this,e),_defineProperty$5(this,"id",2),_defineProperty$5(this,"type",TrackType$1.AUDIO),_defineProperty$5(this,"codecType",AudioCodecType.AAC),_defineProperty$5(this,"pid",-1),_defineProperty$5(this,"codec",""),_defineProperty$5(this,"sequenceNumber",0),_defineProperty$5(this,"sampleDuration",0),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"formatTimescale",0),_defineProperty$5(this,"baseMediaDecodeTime",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"warnings",[]),_defineProperty$5(this,"samples",[]),_defineProperty$5(this,"baseDts",0),_defineProperty$5(this,"sampleSize",16),_defineProperty$5(this,"sampleRate",0),_defineProperty$5(this,"channelCount",0),_defineProperty$5(this,"objectType",0),_defineProperty$5(this,"sampleRateIndex",0),_defineProperty$5(this,"config",[]),_defineProperty$5(this,"present",!1),_defineProperty$5(this,"isVideoEncryption",!1),_defineProperty$5(this,"isAudioEncryption",!1),_defineProperty$5(this,"kid",null),_defineProperty$5(this,"ext",void 0)}return _createClass$6(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===AudioCodecType.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}}]),e}(),VideoSample=function(){function e(t,r,n){_classCallCheck$5(this,e),_defineProperty$5(this,"flag",{}),_defineProperty$5(this,"keyframe",!1),_defineProperty$5(this,"gopId",0),_defineProperty$5(this,"duration",0),_defineProperty$5(this,"size",0),_defineProperty$5(this,"units",[]),_defineProperty$5(this,"chromaFormat",420),this.originPts=this.pts=t,this.originDts=this.dts=r,n&&(this.units=n)}return _createClass$6(e,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),e}(),AudioSample=_createClass$6((function e(t,r,n,i){_classCallCheck$5(this,e),_defineProperty$5(this,"duration",1024),_defineProperty$5(this,"flag",{dependsOn:2,isNonSyncSample:0}),_defineProperty$5(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=r,this.size=r.byteLength,this.sampleOffset=i,n&&(this.duration=n)})),MetadataTrack=function(){function e(){_classCallCheck$5(this,e),_defineProperty$5(this,"id",3),_defineProperty$5(this,"type",TrackType$1.METADATA),_defineProperty$5(this,"timescale",0),_defineProperty$5(this,"flvScriptSamples",[]),_defineProperty$5(this,"seiSamples",[])}return _createClass$6(e,[{key:"exist",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length||!this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!(!this.flvScriptSamples.length&&!this.seiSamples.length)}}]),e}(),isBrowser$1="undefined"!=typeof window,ua$1=isBrowser$1&&navigator.userAgent.toLocaleLowerCase();isBrowser$1&&/^((?!chrome|android).)*safari/.test(ua$1);var isFirefox$1=isBrowser$1&&ua$1.includes("firefox"),isAndroid$1=isBrowser$1&&ua$1.includes("android"),AAC$1=function(){function e(){_classCallCheck$5(this,e)}return _createClass$6(e,null,[{key:"getRateIndexByRate",value:function(t){return e.FREQ.indexOf(t)}},{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,l=e.FREQ[s];if(!l)throw new Error("Invalid sampling index: ".concat(s));for(var u,c,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,y=f.codec,m=0,g=e.getFrameDuration(l);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(c=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;u=2*(1&~t[i+1]),o.push({pts:r+m*g,data:t.subarray(i+7+u,i+c)}),m++,i+=c}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,samplingFrequencyIndex:s,sampleRate:l,objectType:d,channelCount:h,codec:y,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(!a)throw new Error("Invalid sampling index: ".concat(n));var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return isFirefox$1?e>=6?(n=5,i=e-3):(n=2,i=e):isAndroid$1?(n=2,i=e):(n=2===r||5===r?r:5,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}();function concatUint8Array$2(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}_defineProperty$5(AAC$1,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var MAX_SIZE=Math.pow(2,32);function readBig16(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<8)+(e[t+1]||0)}function readBig24(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<16)+(e[t+1]<<8)+(e[t+2]||0)}function readBig32$1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function readBig64(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return readBig32$1(e,t)*MAX_SIZE+readBig32$1(e,t+4)}function getAvcCodec(e){for(var t,r="avc1.",n=0;n<3;n++)(t=e[n].toString(16)).length<2&&(t="0".concat(t)),r+=t;return r}function formatIV(e){var t="";if(e.forEach((function(e){t+=bufferToString(e)})),t.length<=32)for(var r=32-t.length,n=0;n<r;n++)t+="0";return t}function parse$1(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))}function bufferToString(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()}var MP4Parser=function(){function e(){_classCallCheck$5(this,e)}return _createClass$6(e,null,[{key:"findBox",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(!t)return i;for(var a=0,o="",s=0;t.length>7;){if(a=readBig32$1(t),o=String.fromCharCode.apply(null,t.subarray(4,8)),s=8,1===a?(a=readBig64(t,8),s+=8):a||(a=t.length),!r[0]||o===r[0]){var l=t.subarray(0,a);if(!(r.length<2))return e.findBox(l.subarray(s),r.slice(1),n+s);i.push({start:n,size:a,headerSize:s,type:o,data:l})}n+=a,t=t.subarray(a)}return i}},{key:"tfhd",value:function(e){return parseBox(e,!0,(function(e,t){e.trackId=readBig32$1(t);var r=4,n=1&e.flags,i=2&e.flags,a=8&e.flags,o=16&e.flags,s=32&e.flags;n&&(r+=4,e.baseDataOffset=readBig32$1(t,r),r+=4),i&&(e.sampleDescriptionIndex=readBig32$1(t,r),r+=4),a&&(e.defaultSampleDuration=readBig32$1(t,r),r+=4),o&&(e.defaultSampleSize=readBig32$1(t,r),r+=4),s&&(e.defaultSampleFlags=readBig32$1(t,r))}))}},{key:"sidx",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;e.reference_ID=readBig32$1(t,r),r+=4,e.timescale=readBig32$1(t,r),r+=4,0===e.version?(e.earliest_presentation_time=readBig32$1(t,r),r+=4,e.first_offset=readBig32$1(t,r),r+=4):(e.earliest_presentation_time=readBig64(t,r),r+=8,e.first_offset=readBig64(t,r),r+=8),r+=2,e.references=[];var n=readBig16(t,r);r+=2;for(var i=0;i<n;i++){var a={};e.references.push(a);var o=readBig32$1(t,r);r+=4,a.reference_type=o>>31&1,a.referenced_size=2147483647&o,a.subsegment_duration=readBig32$1(t,r),o=readBig32$1(t,r+=4),r+=4,a.starts_with_SAP=o>>31&1,a.SAP_type=o>>28&7,a.SAP_delta_time=268435455&o}}))}},{key:"moov",value:function(t){return parseBox(t,!1,(function(t,r,n){t.mvhd=e.mvhd(e.findBox(r,["mvhd"],n)[0]),t.trak=e.findBox(r,["trak"],n).map((function(t){return e.trak(t)})),t.pssh=e.pssh(e.findBox(r,["pssh"],n)[0])}))}},{key:"mvhd",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32$1(t,16),e.duration=readBig64(t,20),r+=28):(e.timescale=readBig32$1(t,8),e.duration=readBig32$1(t,12),r+=16),e.nextTrackId=readBig32$1(t,r+76)}))}},{key:"trak",value:function(t){return parseBox(t,!1,(function(t,r,n){t.tkhd=e.tkhd(e.findBox(r,["tkhd"],n)[0]),t.mdia=e.mdia(e.findBox(r,["mdia"],n)[0])}))}},{key:"tkhd",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;1===e.version?(e.trackId=readBig32$1(t,16),e.duration=readBig64(t,24),r+=32):(e.trackId=readBig32$1(t,8),e.duration=readBig32$1(t,16),r+=20),e.width=readBig32$1(t,r+52),e.height=readBig32$1(t,r+56)}))}},{key:"mdia",value:function(t){return parseBox(t,!1,(function(t,r,n){t.mdhd=e.mdhd(e.findBox(r,["mdhd"],n)[0]),t.hdlr=e.hdlr(e.findBox(r,["hdlr"],n)[0]),t.minf=e.minf(e.findBox(r,["minf"],n)[0])}))}},{key:"mdhd",value:function(e){return parseBox(e,!0,(function(e,t){var r=0;1===e.version?(e.timescale=readBig32$1(t,16),e.duration=readBig64(t,20),r+=28):(e.timescale=readBig32$1(t,8),e.duration=readBig32$1(t,12),r+=16);var n=readBig16(t,r);e.language=String.fromCharCode(96+(n>>10&31),96+(n>>5&31),96+(31&n))}))}},{key:"hdlr",value:function(e){return parseBox(e,!0,(function(e,t){0===e.version&&(e.handlerType=String.fromCharCode.apply(null,t.subarray(4,8)))}))}},{key:"minf",value:function(t){return parseBox(t,!1,(function(t,r,n){t.vmhd=e.vmhd(e.findBox(r,["vmhd"],n)[0]),t.smhd=e.smhd(e.findBox(r,["smhd"],n)[0]),t.stbl=e.stbl(e.findBox(r,["stbl"],n)[0])}))}},{key:"vmhd",value:function(e){return parseBox(e,!0,(function(e,t){e.graphicsmode=readBig16(t),e.opcolor=[readBig16(t,2),readBig16(t,4),readBig16(t,6)]}))}},{key:"smhd",value:function(e){return parseBox(e,!0,(function(e,t){e.balance=readBig16(t)}))}},{key:"stbl",value:function(t){return parseBox(t,!1,(function(t,r,n){t.stsd=e.stsd(e.findBox(r,["stsd"],n)[0]),t.stts=e.stts(e.findBox(r,["stts"],n)[0]),t.ctts=e.ctts(e.findBox(r,["ctts"],n)[0]),t.stsc=e.stsc(e.findBox(r,["stsc"],n)[0]),t.stsz=e.stsz(e.findBox(r,["stsz"],n)[0]),t.stco=e.stco(e.findBox(r,["stco"],n)[0]),t.stco||(t.co64=e.co64(e.findBox(r,["co64"],n)[0]),t.stco=t.co64),t.stss=e.stss(e.findBox(r,["stss"],n)[0]),t.senc=e.senc(e.findBox(r,["senc"],n)[0])}))}},{key:"senc",value:function(e){return parseBox(e,!0,(function(e,t){var r=0,n=readBig32$1(t,r);r+=4,e.samples=[];for(var i=0;i<n;i++){var a={};if(a.InitializationVector=[t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5],t[r+6],t[r+7]],r+=8,2&e.flags){a.subsamples=[];var o=readBig16(t,r);r+=2;for(var s=0;s<o;s++){var l={};l.BytesOfClearData=readBig16(t,r),r+=2,l.BytesOfProtectedData=readBig32$1(t,r),r+=4,a.subsamples.push(l)}}e.samples.push(a)}}))}},{key:"pssh",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=[],n=[],i=0,a=0;a<16;a++)n.push(toHex(t[i+a]));if(i+=16,e.version>0){var o=readBig32$1(t,i);i+=4;for(var s=0;s<(""+o).length;s++)for(var l=0;l<16;l++){var u=t[i];i+=1,r.push(toHex(u))}}var c=readBig32$1(t,i);e.data_size=c,i+=4,e.kid=r,e.system_id=n,e.buffer=t}))}},{key:"stsd",value:function(t){return parseBox(t,!0,(function(t,r,n){t.entryCount=readBig32$1(r),t.entries=e.findBox(r.subarray(4),[],n+4).map((function(t){switch(t.type){case"avc1":case"avc2":case"avc3":case"avc4":return e.avc1(t);case"hvc1":case"hev1":return e.hvc1(t);case"mp4a":return e.mp4a(t);case"alaw":case"ulaw":return e.alaw(t);case"enca":return parseBox(t,!1,(function(t,r,n){t.channelCount=readBig16(r,16),t.samplesize=readBig16(r,18),t.sampleRate=readBig32$1(r,24)/65536,r=r.subarray(28),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.esds=e.esds(e.findBox(r,["esds"],n)[0])}));case"encv":return parseBox(t,!1,(function(t,r,n){t.width=readBig16(r,24),t.height=readBig16(r,26),t.horizresolution=readBig32$1(r,28),t.vertresolution=readBig32$1(r,32),r=r.subarray(78),t.sinf=e.sinf(e.findBox(r,["sinf"],n)[0]),t.avcC=e.avcC(e.findBox(r,["avcC"],n)[0]),t.hvcC=e.hvcC(e.findBox(r,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(r,["pasp"],n)[0])}))}})).filter(Boolean)}))}},{key:"tenc",value:function(e){return parseBox(e,!1,(function(e,t){var r=6;e.default_IsEncrypted=t[r],r+=1,e.default_IV_size=t[r],r+=1,e.default_KID=[];for(var n=0;n<16;n++)e.default_KID.push(toHex(t[r])),r+=1}))}},{key:"schi",value:function(t){return parseBox(t,!1,(function(t,r,n){t.tenc=e.tenc(e.findBox(r,["tenc"],n)[0])}))}},{key:"sinf",value:function(t){return parseBox(t,!1,(function(t,r,n){t.schi=e.schi(e.findBox(r,["schi"],n)[0]),t.frma=e.frma(e.findBox(r,["frma"],n)[0])}))}},{key:"frma",value:function(e){return parseBox(e,!1,(function(e,t){e.data_format="";for(var r=0;r<4;r++)e.data_format+=String.fromCharCode(t[r])}))}},{key:"avc1",value:function(t){return parseBox(t,!1,(function(t,r,n){var i=parseVisualSampleEntry(t,r),a=r.subarray(i);n+=i,t.avcC=e.avcC(e.findBox(a,["avcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"avcC",value:function(e){return parseBox(e,!1,(function(e,t){e.configurationVersion=t[0],e.AVCProfileIndication=t[1],e.profileCompatibility=t[2],e.AVCLevelIndication=t[3],e.codec=getAvcCodec([t[1],t[2],t[3]]),e.lengthSizeMinusOne=3&t[4],e.spsLength=31&t[5],e.sps=[];for(var r=6,n=0;n<e.spsLength;n++){var i=readBig16(t,r);r+=2,e.sps.push(t.subarray(r,r+i)),r+=i}e.ppsLength=t[r],r+=1,e.pps=[];for(var a=0;a<e.ppsLength;a++){var o=readBig16(t,r);r+=2,e.pps.push(t.subarray(r,r+=o)),r+=o}}))}},{key:"hvc1",value:function(t){return parseBox(t,!1,(function(t,r,n){var i=parseVisualSampleEntry(t,r),a=r.subarray(i);n+=i,t.hvcC=e.hvcC(e.findBox(a,["hvcC"],n)[0]),t.pasp=e.pasp(e.findBox(a,["pasp"],n)[0])}))}},{key:"hvcC",value:function(e){return parseBox(e,!1,(function(t,r){t.data=e.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=r[0];var n=r[1];t.generalProfileSpace=n>>6,t.generalTierFlag=(32&n)>>5,t.generalProfileIdc=31&n,t.generalProfileCompatibility=readBig32$1(r,2),t.generalConstraintIndicatorFlags=r.subarray(6,12),t.generalLevelIdc=r[12],t.avgFrameRate=readBig16(r,19),t.numOfArrays=r[22],t.vps=[],t.sps=[],t.pps=[];for(var i=23,a=0,o=0,s=0,l=0;l<t.numOfArrays;l++){a=63&r[i],o=readBig16(r,i+1),i+=3;for(var u,c=[],d=0;d<o;d++)s=readBig16(r,i),i+=2,c.push(r.subarray(i,i+s)),i+=s;if(32===a)(u=t.vps).push.apply(u,c);else if(33===a){var h;(h=t.sps).push.apply(h,c)}else if(34===a){var f;(f=t.pps).push.apply(f,c)}}}))}},{key:"pasp",value:function(e){return parseBox(e,!1,(function(e,t){e.hSpacing=readBig32$1(t),e.vSpacing=readBig32$1(t,4)}))}},{key:"mp4a",value:function(t){return parseBox(t,!1,(function(t,r,n){var i=parseAudioSampleEntry(t,r);t.esds=e.esds(e.findBox(r.subarray(i),["esds"],n+i)[0])}))}},{key:"esds",value:function(e){return parseBox(e,!0,(function(e,t){e.codec="mp4a.";for(var r=0,n=0,i=0,a=0;t.length;){for(a=t[r=0],n=t[r+1],r+=2;128&n;)i=(127&n)<<7,n=t[r],r+=1;if(i+=127&n,3===a)t=t.subarray(r+3);else{if(4!==a){if(5===a){var o=e.config=t.subarray(r,r+i),s=(248&o[0])>>3;return 31===s&&o.length>=2&&(s=32+((7&o[0])<<3)+((224&o[1])>>5)),e.objectType=s,e.codec+=s.toString(16),void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}return void("."===e.codec[e.codec.length-1]&&(e.codec=e.codec.substring(0,e.codec.length-1)))}e.codec+=(t[r].toString(16)+".").padStart(3,"0"),t=t.subarray(r+13)}}}))}},{key:"alaw",value:function(e){return parseBox(e,!1,(function(e,t){parseAudioSampleEntry(e,t)}))}},{key:"stts",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push({count:readBig32$1(t,i),delta:readBig32$1(t,i+4)}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"ctts",value:function(e){return parseBox(e,!0,(function(e,t){var r=readBig32$1(t),n=[],i=4;if(1===e.version)for(var a=0;a<r;a++)n.push({count:readBig32$1(t,i),offset:readBig32$1(t,i+4)}),i+=8;else for(var o=0;o<r;o++)n.push({count:readBig32$1(t,i),offset:-(1+~readBig32$1(t,i+4))}),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stsc",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push({firstChunk:readBig32$1(t,i),samplesPerChunk:readBig32$1(t,i+4),sampleDescriptionIndex:readBig32$1(t,i+8)}),i+=12;e.entryCount=r,e.entries=n}))}},{key:"stsz",value:function(e){return parseBox(e,!0,(function(e,t){var r=readBig32$1(t),n=readBig32$1(t,4),i=[];if(!r)for(var a=8,o=0;o<n;o++)i.push(readBig32$1(t,a)),a+=4;e.sampleSize=r,e.sampleCount=n,e.entrySizes=i}))}},{key:"stco",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32$1(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"co64",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push(readBig64(t,i)),i+=8;e.entryCount=r,e.entries=n}))}},{key:"stss",value:function(e){return parseBox(e,!0,(function(e,t){for(var r=readBig32$1(t),n=[],i=4,a=0;a<r;a++)n.push(readBig32$1(t,i)),i+=4;e.entryCount=r,e.entries=n}))}},{key:"moof",value:function(t){return parseBox(t,!1,(function(t,r,n){t.mfhd=e.mfhd(e.findBox(r,["mfhd"],n)[0]),t.traf=e.findBox(r,["traf"],n).map((function(t){return e.traf(t)}))}))}},{key:"mfhd",value:function(e){return parseBox(e,!0,(function(e,t){e.sequenceNumber=readBig32$1(t)}))}},{key:"traf",value:function(t){return parseBox(t,!1,(function(t,r,n){t.tfhd=e.tfhd(e.findBox(r,["tfhd"],n)[0]),t.tfdt=e.tfdt(e.findBox(r,["tfdt"],n)[0]),t.trun=e.trun(e.findBox(r,["trun"],n)[0])}))}},{key:"trun",value:function(e){return parseBox(e,!0,(function(e,t){var r=e.version,n=e.flags,i=t.length,a=e.sampleCount=readBig32$1(t),o=4;if(i>o&&1&n&&(e.dataOffset=-(1+~readBig32$1(t,o)),o+=4),i>o&&4&n&&(e.firstSampleFlags=readBig32$1(t,o),o+=4),e.samples=[],i>o)for(var s,l=0;l<a;l++)s={},256&n&&(s.duration=readBig32$1(t,o),o+=4),512&n&&(s.size=readBig32$1(t,o),o+=4),1024&n&&(s.flags=readBig32$1(t,o),o+=4),2048&n&&(s.cts=r?-(1+~readBig32$1(t,o+4)):readBig32$1(t,o),o+=4),e.samples.push(s)}))}},{key:"tfdt",value:function(e){return parseBox(e,!0,(function(e,t){1===e.version?e.baseMediaDecodeTime=readBig64(t):e.baseMediaDecodeTime=readBig32$1(t)}))}},{key:"probe",value:function(t){return!!e.findBox(t,["ftyp"])}},{key:"parseSampleFlags",value:function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}}},{key:"moovToTrack",value:function(e,t,r){var n,i,a=e.trak;if(a&&a.length){var o=a.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),s=a.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(o&&t){var l,u,c,d,h,f,p,y=t,m=null===(l=o.tkhd)||void 0===l?void 0:l.trackId;null!=m&&(y.id=o.tkhd.trackId),y.tkhdDuration=o.tkhd.duration,y.mvhdDurtion=e.mvhd.duration,y.mvhdTimecale=e.mvhd.timescale,y.timescale=y.formatTimescale=o.mdia.mdhd.timescale,y.duration=o.mdia.mdhd.duration||y.mvhdDurtion/y.mvhdTimecale*y.timescale;var g,v,b,_,E,T,S,$,A=o.mdia.minf.stbl.stsd.entries[0];if(y.width=A.width,y.height=A.height,A.pasp&&(y.sarRatio=[A.pasp.hSpacing,A.pasp.vSpacing]),A.hvcC)y.codecType=VideoCodecType$1.HEVC,y.codec=A.hvcC.codec,y.vps=A.hvcC.vps,y.sps=A.hvcC.sps,y.pps=A.hvcC.pps,y.hvcC=A.hvcC.data;else{if(!A.avcC)throw new Error("unknown video stsd entry");y.codec=A.avcC.codec,y.sps=A.avcC.sps,y.pps=A.avcC.pps}if(y.present=!0,y.ext={},y.ext.stss=null===(u=o.mdia)||void 0===u||null===(c=u.minf)||void 0===c||null===(d=c.stbl)||void 0===d?void 0:d.stss,y.ext.ctts=null===(h=o.mdia)||void 0===h||null===(f=h.minf)||void 0===f||null===(p=f.stbl)||void 0===p?void 0:p.ctts,A&&"encv"===A.type)y.isVideoEncryption=!0,A.default_KID=null===(g=A.sinf)||void 0===g||null===(v=g.schi)||void 0===v?void 0:v.tenc.default_KID,A.default_IsEncrypted=null===(b=A.sinf)||void 0===b||null===(_=b.schi)||void 0===_?void 0:_.tenc.default_IsEncrypted,A.default_IV_size=null===(E=A.sinf)||void 0===E||null===(T=E.schi)||void 0===T?void 0:T.tenc.default_IV_size,y.videoSenc=o.mdia.minf.stbl.senc&&o.mdia.minf.stbl.senc.samples,A.data_format=null===(S=A.sinf)||void 0===S||null===($=S.frma)||void 0===$?void 0:$.data_format,y.useEME=e.useEME,y.kidValue=e.kidValue,y.pssh=e.pssh,y.encv=A}if(s&&r){var w,k,I,C,P,x,R,O,L,D=r,M=null===(w=s.tkhd)||void 0===w?void 0:w.trackId;null!=M&&(D.id=s.tkhd.trackId),D.tkhdDuration=s.tkhd.duration,D.mvhdDurtion=e.mvhd.duration,D.mvhdTimecale=e.mvhd.timescale,D.timescale=D.formatTimescale=s.mdia.mdhd.timescale,D.duration=s.mdia.mdhd.duration||D.mvhdDurtion/D.mvhdTimecale*D.timescale;var N,G,V,U,Z,B,F,j,W=s.mdia.minf.stbl.stsd.entries[0];switch(D.sampleSize=W.sampleSize,D.sampleRate=W.sampleRate,D.channelCount=W.channelCount,D.present=!0,W.type){case"alaw":D.codecType=D.codec=AudioCodecType.G711PCMA,D.sampleRate=8e3;break;case"ulaw":D.codecType=D.codec=AudioCodecType.G711PCMU,D.sampleRate=8e3;break;default:D.sampleDuration=AAC$1.getFrameDuration(D.sampleRate,D.timescale),D.sampleRateIndex=AAC$1.getRateIndexByRate(D.sampleRate),D.objectType=(null===(n=W.esds)||void 0===n?void 0:n.objectType)||2,W.esds&&(D.config=Array.from(W.esds.config)),D.codec=(null===(i=W.esds)||void 0===i?void 0:i.codec)||"mp4a.40.2"}if(D.sampleDuration=AAC$1.getFrameDuration(D.sampleRate,D.timescale),D.objectType=(null===(k=W.esds)||void 0===k?void 0:k.objectType)||2,W.esds&&(W.esds.config?D.config=Array.from(W.esds.config):console.warn("esds config is null")),D.codec=(null===(I=W.esds)||void 0===I?void 0:I.codec)||"mp4a.40.2",D.sampleRateIndex=AAC$1.getRateIndexByRate(D.sampleRate),D.ext={},D.ext.stss=null===(C=s.mdia)||void 0===C||null===(P=C.minf)||void 0===P||null===(x=P.stbl)||void 0===x?void 0:x.stss,D.ext.ctts=null===(R=s.mdia)||void 0===R||null===(O=R.minf)||void 0===O||null===(L=O.stbl)||void 0===L?void 0:L.ctts,D.present=!0,W&&"enca"===W.type)D.isAudioEncryption=!0,W.data_format=null===(N=W.sinf)||void 0===N||null===(G=N.frma)||void 0===G?void 0:G.data_format,W.default_KID=null===(V=W.sinf)||void 0===V||null===(U=V.schi)||void 0===U?void 0:U.tenc.default_KID,W.default_IsEncrypted=null===(Z=W.sinf)||void 0===Z||null===(B=Z.schi)||void 0===B?void 0:B.tenc.default_IsEncrypted,W.default_IV_size=null===(F=W.sinf)||void 0===F||null===(j=F.schi)||void 0===j?void 0:j.tenc.default_IV_size,D.audioSenc=s.mdia.minf.stbl.senc&&s.mdia.minf.stbl.senc.samples,D.useEME=e.useEME,D.kidValue=e.kidValue,D.enca=W}if(r&&(r.isVideoEncryption=!!t&&t.isVideoEncryption),t&&(t.isAudioEncryption=!!r&&r.isAudioEncryption),null!=t&&t.encv||null!=r&&r.enca){var X,H,K=null==t||null===(X=t.encv)||void 0===X?void 0:X.default_KID,Y=null==r||null===(H=r.enca)||void 0===H?void 0:H.default_KID,z=K||Y?(K||Y).join(""):null;t&&(t.kid=z),r&&(r.kid=z)}return t&&(t.flags=3841),r&&(r.flags=1793),{videoTrack:t,audioTrack:r}}}},{key:"evaluateDefaultDuration",value:function(e,t,r){var n,i=null==t||null===(n=t.samples)||void 0===n?void 0:n.length;return i?1024*i/t.timescale*e.timescale/r:1024}},{key:"moofToSamples",value:function(t,r,n){var i={};return t.mfhd&&(r&&(r.sequenceNumber=t.mfhd.sequenceNumber),n&&(n.sequenceNumber=t.mfhd.sequenceNumber)),t.traf.forEach((function(t){var a=t.tfhd,o=t.tfdt,s=t.trun;if(a&&s){o&&(r&&r.id===a.trackId&&(r.baseMediaDecodeTime=o.baseMediaDecodeTime),n&&n.id===a.trackId&&(n.baseMediaDecodeTime=o.baseMediaDecodeTime));var l=a.defaultSampleSize||0,u=a.defaultSampleDuration||e.evaluateDefaultDuration(r,n,s.samples.length||s.sampleCount),c=s.dataOffset||0,d=0,h=-1;if(!s.samples.length&&s.sampleCount){i[a.trackId]=[];for(var f=0;f<s.sampleCount;f++)i[a.trackId].push({offset:c,dts:d,duration:u,size:l}),d+=u,c+=l}else i[a.trackId]=s.samples.map((function(e,t){return(e={offset:c,dts:d,pts:d+(e.cts||0),duration:e.duration||u,size:e.size||l,gopId:h,keyframe:0===t||null!==e.flags&&void 0!==e.flags&&(65536&e.flags)>>>0!=65536}).keyframe&&(h++,e.gopId=h),d+=e.duration,c+=e.size,e}))}})),i}},{key:"moovToSamples",value:function(e){var t=e.trak;if(t&&t.length){var r=t.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),n=t.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(r||n){var i,a;if(r){var o,s,l=null===(o=r.mdia)||void 0===o||null===(s=o.minf)||void 0===s?void 0:s.stbl;if(!l)return;var u=l.stts,c=l.stsc,d=l.stsz,h=l.stco,f=l.stss,p=l.ctts;if(!(u&&c&&d&&h&&f))return;i=getSamples(u,c,d,h,p,f)}if(n){var y,m,g,v=null===(y=n.mdia)||void 0===y||null===(m=y.minf)||void 0===m?void 0:m.stbl;if(!v)return;var b=null===(g=n.mdia.mdhd)||void 0===g?void 0:g.timescale,_=v.stts,E=v.stsc,T=v.stsz,S=v.stco;if(!(b&&_&&E&&T&&S))return;a=getSamples(_,E,T,S)}return{videoSamples:i,audioSamples:a}}}}}]),e}();function getSamples(e,t,r,n,i,a){var o,s,l,u=[],c=null==i?void 0:i.entries,d=t.entries,h=n.entries,f=r.entrySizes,p=null==a?void 0:a.entries;p&&(o={},p.forEach((function(e){o[e-1]=!0}))),c&&(s=[],c.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)s.push(r)})));var y=-1,m=0,g=0,v=0,b=0,_=0,E=d[0].samplesPerChunk,T=d[1]?d[1].firstChunk-1:1/0;return e.entries.forEach((function(e){for(var t=e.count,n=e.delta,i=0;i<t;i++)l={dts:m,duration:n,size:f[g]||r.sampleSize,offset:h[v]+_,index:g},p&&(l.keyframe=o[g],l.keyframe&&y++,l.gopId=y),s&&g<s.length&&(l.pts=l.dts+s[g]),u.push(l),m+=n,++g<E?_+=l.size:(v++,_=0,v>=T&&(b++,T=d[b+1]?d[b+1].firstChunk-1:1/0),E+=d[b].samplesPerChunk)})),u}function parseVisualSampleEntry(e,t){return e.dataReferenceIndex=readBig16(t,6),e.width=readBig16(t,24),e.height=readBig16(t,26),e.horizresolution=readBig32$1(t,28),e.vertresolution=readBig32$1(t,32),e.frameCount=readBig16(t,40),e.depth=readBig16(t,74),78}function parseAudioSampleEntry(e,t){return e.dataReferenceIndex=readBig16(t,6),e.channelCount=readBig16(t,16),e.sampleSize=readBig16(t,18),e.sampleRate=readBig32$1(t,24)/65536,28}function parseBox(e,t,r){if(e){if(e.size!==e.data.length)throw new Error("box ".concat(e.type," size !== data.length"));var n={start:e.start,size:e.size,headerSize:e.headerSize,type:e.type};return t&&(n.version=e.data[e.headerSize],n.flags=readBig24(e.data,e.headerSize+1),n.headerSize+=4),r(n,e.data.subarray(n.headerSize),n.start+n.headerSize),n}}var padStart=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},toHex=function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(padStart(Number(t).toString(16),2,0))})),e[0]},Buffer$1=function(){function e(){_classCallCheck$5(this,e),this.buffer=new Uint8Array(0)}return _createClass$6(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){t?e.buffer=lib$1(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),UINT32_MAX$1=Math.pow(2,32)-1,MP4$2=function(){function e(){_classCallCheck$5(this,e)}return _createClass$6(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType$1.VIDEO&&e.codecType===VideoCodecType$1.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array$2(e.ftyp(t),e.moov(t))}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],parse$1(t.kid),[0,0,0,0]));return e.box(e.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(_toConsumableArray$3(t.map((function(t){return e.trak(t)}))),[r]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(_toConsumableArray$3(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]));return a}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]));return n}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType$1.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){var r=[];return t&&t.ext&&t.ext.stss&&r.push(e.stss(t.ext.stss.entries)),e.box(e.types.stbl,e.stsd(t),e.STTS,r[0],e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){var r;return r="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):e.avc1hev1(t),e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r)}},{key:"enca",value:function(t){var r=t.enca.channelCount,n=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,i,a,o)}},{key:"encv",value:function(t){var r,n,i=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],o=t.width,s=t.height,l=t.sarRatio[0],u=t.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((r=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(n,_toConsumableArray$3(i)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(r,_toConsumableArray$3(a))),h=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u]);return e.box(e.types.encv,c,e.box(e.types.avcC,d),e.box(e.types.btrt,h),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var r=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,r,n)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(parse$1(t.default_KID)));return e.box(e.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,r,e.box(e.types.frma,n),e.box(e.types.schm,i),a)}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType$1.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n,i,a=[],o=[];return t.sps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,_toConsumableArray$3(e))})),t.pps.forEach((function(e){i=e.byteLength,o.push(i>>>8&255),o.push(255&i),o.push.apply(o,_toConsumableArray$3(e))})),e.box(e.types.avcC,new Uint8Array((r=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(r,o)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,l=r.generalConstraintIndicatorFlags,u=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,l[0],l[1],l[2],l[3],l[4],l[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,u];var c=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,_toConsumableArray$3(e))};i.length&&(n.push(160,0,i.length),i.forEach(c)),a.length&&(n.push(161,0,a.length),a.forEach(c)),o.length&&(n.push(162,0,o.length),o.forEach(c))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=_slicedToArray$3(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(_toConsumableArray$3(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(t){return e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(_toConsumableArray$3(t.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){var r=e.tfhd(t.id),n=e.tfdt(t,t.baseMediaDecodeTime);if(t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(1===t.id){var i=e.saiz(t),a=e.saio(t),o=e.trun1(t),s=e.senc(t);return e.box(e.types.traf,r,n,i,a,o,s)}if(t.isAudioEncryption){var l=e.sbgp(),u=e.saiz(t),c=e.saio(t),d=e.senc(t),h=e.trun1(t);return e.box(e.types.traf,r,n,l,u,c,d,h)}var f=e.sbgp(),p=e.trun1(t);return e.box(e.types.traf,r,n,f,p)}if(1===t.id){var y=e.trun1(t);return e.box(e.types.traf,r,n,y)}var m=e.sbgp(),g=e.saiz(t),v=e.saio(t),b=e.senc(t),_=e.trun1(t);return e.box(e.types.traf,r,n,m,g,v,b,_)}var E=e.sdtp(t);return e.box(e.types.traf,r,n,E,e.trun(t.samples,E.byteLength+76))}},{key:"sdtp",value:function(t){var r=new Buffer$1;return t.samples.forEach((function(e){r.write(new Uint8Array(1===t.id?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Buffer$1,n=Buffer$1.writeUint32(t.samples.length),i=null;if(1===t.id){var a=t.videoSencLength;i=Buffer$1.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Buffer$1.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),i=Buffer$1.writeUint32(o)}return t.samples.forEach((function(e){r.write(Buffer$1.writeUint32(e.duration)),r.write(Buffer$1.writeUint32(e.size)),r.write(Buffer$1.writeUint32(e.keyframe?33554432:65536)),1===t.id&&r.write(Buffer$1.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(t){var r=new Buffer$1,n=t.samples.length,i=1===t.id?16:8,a=1===t.id?2:0,o=[],s=0;return 1===t.id?(o=t.videoSenc,s=t.videoSencLength):o=t.audioSenc,s=s||i*n,r.write(Buffer$1.writeUint32(16+s),e.types.senc,this.extension(0,a)),r.write(Buffer$1.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(Buffer$1.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){r.write(Buffer$1.writeUint16(e.BytesOfClearData)),r.write(Buffer$1.writeUint32(e.BytesOfProtectedData))})))})),r.buffer}},{key:"saio",value:function(t){var r=12*t.samples.length+141;2===t.id&&t.isAudioEncryption&&(r=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var r=t.samples.length,n=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,r){var n=Math.floor(r/(UINT32_MAX$1+1)),i=Math.floor(r%(UINT32_MAX$1+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],l=s.duration,u=s.size,c=s.flag,d=void 0===c?{}:c,h=s.cts,f=void 0===h?0:h;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,d.isLeading<<2|(null===d.dependsOn||void 0===d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null===d.isNonSyncSample||void 0===d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray$3(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType$1.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array$2(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array$2(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,n=t.samples[0].duration,i=n*t.samples.length,a=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var s=0;if(1===t.id){var l,u=0;t.videoSenc&&(l=t.videoSenc),1===t.id&&l.forEach((function(e){u+=8,e.subsamples&&e.subsamples.length&&(u+=2,u+=6*e.subsamples.length)})),t.videoSencLength=u,s=o+141+16*t.samples.length+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(s=o+16*t.samples.length+84)}else s=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(s=o+169+12*t.samples.length+8*t.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,255&t.id,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,c)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();_defineProperty$5(MP4$2,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty$5(MP4$2,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty$5(MP4$2,"FTYPAVC1",MP4$2.box(MP4$2.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty$5(MP4$2,"FTYPHEV1",MP4$2.box(MP4$2.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty$5(MP4$2,"DINF",MP4$2.box(MP4$2.types.dinf,MP4$2.box(MP4$2.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty$5(MP4$2,"VMHD",MP4$2.box(MP4$2.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$2,"SMHD",MP4$2.box(MP4$2.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$2,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty$5(MP4$2,"STTS",MP4$2.box(MP4$2.types.stts,MP4$2.StblTable)),_defineProperty$5(MP4$2,"STSC",MP4$2.box(MP4$2.types.stsc,MP4$2.StblTable)),_defineProperty$5(MP4$2,"STSZ",MP4$2.box(MP4$2.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty$5(MP4$2,"STCO",MP4$2.box(MP4$2.types.stco,MP4$2.StblTable));var Logger$3=function(){function e(t,r){_classCallCheck$5(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=r}return _createClass$6(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$5(Logger$3,"disabled",!0);var FMP4Remuxer$1=function(){function e(t,r,n){_classCallCheck$5(this,e),this.videoTrack=t,this.audioTrack=r;var i=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=i&&Number(i[1])<50,this.log=new Logger$3("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return _createClass$6(e,[{key:"remux",value:function(){var e,t,r,n,i,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.videoTrack,l=this.audioTrack,u=s.exist(),c=l.exist(),d=[];return a&&(o&&o.initMerge?(u&&d.push(this.videoTrack),c&&d.push(this.audioTrack),r=MP4$2.initSegment(d)):(u&&(e=MP4$2.initSegment([this.videoTrack])),c&&(t=MP4$2.initSegment([this.audioTrack])))),u&&s.hasSample()&&(n=this._remuxVideo()),c&&l.hasSample()&&(i=this._remuxAudio()),s.samples=[],l.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var l=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,l+=4+e.byteLength})),s.size=l,u=o,n=s},s=0,l=t.length,u=0;s<l;s++)o(s,0,u,n);var c=MP4$2.mdat(i);return e.isVideoEncryption||e.isAudioEncryption?concatUint8Array$2(MP4$2.styp(),MP4$2.sidx(e),MP4$2.moof([e]),c):concatUint8Array$2(MP4$2.moof([e]),c)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,r){return t.set(r.data,e),e+r.size}),0);var r=MP4$2.mdat(t);return e.isVideoEncryption||e.isAudioEncryption?concatUint8Array$2(MP4$2.styp(),MP4$2.sidx(e),MP4$2.moof([e]),r):concatUint8Array$2(MP4$2.moof([e]),r)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),Crypto={decryptWordArray:function(e,t,r){var n=Hex.parse(t),i=Hex.parse(formatIV(r)),a=WordArray.create(new Uint8Array(e)),o=AES.decrypt(CipherParams.create({ciphertext:a}),n,{iv:i,mode:CTR,padding:NoPadding});return Crypto.wordArrayToUint8Array(o)},wordArrayToUint8Array:function(e){for(var t=e.sigBytes,r=e.words,n=new Uint8Array(t),i=0,a=0;i!==t;){var o=r[a++];if(n[i++]=(4278190080&o)>>>24,i===t)break;if(n[i++]=(16711680&o)>>>16,i===t)break;if(n[i++]=(65280&o)>>>8,i===t)break;n[i++]=255&o}return n}},NEW_ARRAY_MAX_CNT=20,MP4Demuxer=function(){function t(e,r,n,i){var a=this;_classCallCheck$5(this,t),_defineProperty$5(this,"_videoSamples",[]),_defineProperty$5(this,"_audioSamples",[]),_defineProperty$5(this,"_lastRemainBuffer",[]),_defineProperty$5(this,"_lastRemainBufferStartPos",0),this.videoTrack=new VideoTrack,this.audioTrack=new AudioTrack,this.metadataTrack=n||new MetadataTrack,this.log=new Logger$3("MP4Demuxer",!i||!i.openLog||!i.openLog),e&&e.forEach((function(e){var t;(t=a._videoSamples).push.apply(t,_toConsumableArray$3(e.frames))})),r&&r.forEach((function(e){var t;(t=a._audioSamples).push.apply(t,_toConsumableArray$3(e.frames))}))}return _createClass$6(t,[{key:"parseSamples",value:function(e){if(!e)throw new Error("moov is required");if(this.videoTrack.codec||this.audioTrack.codec||(MP4Parser.moovToTrack(e,this.videoTrack,this.audioTrack),this.videoSenc=this.videoTrack.videoSenc,this.audioSenc=this.audioTrack.audioSenc),!this._audioSamples.length&&!this._videoSamples.length){var t=MP4Parser.moovToSamples(e);if(!t)throw new Error("cannot parse samples from moov box");this._videoSamples=t.videoSamples||[],this._audioSamples=t.audioSamples||[]}}},{key:"demux",value:function(e,t,r,n,i){this.parseSamples(i);var a,o,s,l=this.videoTrack,u=this.audioTrack;if(l.samples=[],u.samples=[],r){for(var c,d=0,h=r[0],f=r[1];h<=f;h++){if(!(a=this._videoSamples[h]))throw new Error("cannot found video frame #".concat(h));s=a.offset-t,o=e.subarray(s,s+a.size),(c=new VideoSample(a.pts||a.dts,a.dts)).duration=a.duration,c.gopId=a.gopId,a.keyframe&&c.setToKeyframe();for(var p=0,y=o.length-1;p<y;)d=readBig32$1(o,p),p+=4,c.units.push(o.subarray(p,p+d)),p+=d;l.samples.push(c)}l.baseMediaDecodeTime=l.samples[0].dts}if(n){for(var m=n[0],g=n[1];m<=g;m++){if(!(a=this._audioSamples[m]))throw new Error("cannot found video frame #".concat(m));s=a.offset-t,o=e.subarray(s,s+a.size),u.samples.push(new AudioSample(a.dts,o,a.duration))}u.baseMediaDecodeTime=u.samples[0].dts}return{videoTrack:l,audioTrack:u,metadataTrack:this.metadataTrack}}},{key:"demuxPart",value:function(t,r,n,i,a,o,s){if(this.parseSamples(a),this.videoTrack.useEME=o,this.audioTrack.useEME=o,this._lastRemainBuffer&&this._lastRemainBuffer.byteLength>0&&r>this._lastRemainBufferStartPos&&r<=this._lastRemainBufferStartPos+this._lastRemainBuffer.byteLength)for(var l=0;l<NEW_ARRAY_MAX_CNT;)try{var u=this._lastRemainBuffer.subarray(0,r-this._lastRemainBufferStartPos),c=new Uint8Array(t.byteLength+u.byteLength);c.set(u,0),c.set(new Uint8Array(t),u.byteLength),t=c,r-=u.byteLength,this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0;break}catch(e){if(!(l<NEW_ARRAY_MAX_CNT))throw new Error("new Uint8Array error:,"+e.errorMessage);l++}var d,h,f,p=this.videoTrack,y=this.audioTrack;p.samples=[],y.samples=[],p.videoSenc=null,y.audioSenc=null;var m=0,g=0;if(this._videoSamples.length>0&&n.length>0){for(var v,b=t.byteLength+r,_=n[0];_<=n[1];_++){if(!(d=this._videoSamples[_]))throw new Error("cannot found video frame #".concat(_));d.offset>=r&&d.offset+d.size<=b&&(m=(f=d.offset-r)+d.size,h=t.subarray(f,m),(v=new VideoSample(d.pts||d.dts,d.dts)).duration=d.duration,v.gopId=d.gopId,v.sampleOffset=d.index,d.keyframe&&v.setToKeyframe(),v.data=h,v.size=d.size,p.samples.push(v))}p.samples.length>0&&(p.gopId=p.samples[0].gopId,p.baseMediaDecodeTime=p.samples[0].dts,p.startPts=p.samples[0].pts/p.timescale,p.endPts=p.samples[p.samples.length-1].pts/p.timescale,this.videoSenc&&(p.videoSenc=this.videoSenc.slice(p.samples[0].sampleOffset,p.samples[0].sampleOffset+p.samples.length),p.kidValue=s))}if(this._audioSamples.length>0&&i.length>0){for(var E=i[0];E<=i[1];E++){if(!(d=this._audioSamples[E]))throw new Error("cannot found video frame #".concat(E));d.offset>=r&&d.offset+d.size<=t.byteLength+r&&(g=(f=d.offset-r)+d.size,h=t.subarray(f,g),y.samples.push(new AudioSample(d.dts,h,d.duration,d.index)))}y.samples.length>0&&(y.gopId=y.samples[0].gopId||p.gopId,y.baseMediaDecodeTime=y.samples[0].dts,y.startPts=y.samples[0].pts/y.timescale,y.endPts=y.samples[y.samples.length-1].pts/y.timescale,this.audioSenc&&(y.audioSenc=this.audioSenc.slice(y.samples[0].sampleOffset,y.samples[0].sampleOffset+y.samples.length),y.kidValue=s))}this.decoderData(p,y);for(var T=0,S=0;S<p.samples.length;S++)for(var $=0,A=p.samples[S].data,w=A.length-1;$<w;)T=readBig32$1(A,$),$+=4,p.samples[S].units.push(A.subarray($,$+T)),$+=T;return this._lastRemainBuffer=t.subarray(Math.max(m,g)),this._lastRemainBuffer.byteLength>0?this._lastRemainBufferStartPos=r+t.byteLength-this._lastRemainBuffer.byteLength:this._lastRemainBufferStartPos=0,{videoTrack:p,audioTrack:y,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this._videoSamples=[],this._audioSamples=[],this._lastRemainBuffer=null,this._lastRemainBufferStartPos=0,this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}},{key:"decoderData",value:function(e,t){if(!e.useEME&&!t.useEME){if(e.videoSenc&&1===e.id){var r=e.kidValue,n=e.videoSenc;e.samples.forEach((function(t,i){var a=n[i],o=t.data,s=[],l=[],u=a.InitializationVector;if(a.subsamples&&a.subsamples.length)a.subsamples.forEach((function(e){var t=e.BytesOfClearData+e.BytesOfProtectedData,r=o.slice(0,t);s.push(r.slice(0,e.BytesOfClearData)),l.push(r.slice(e.BytesOfClearData)),o=o.slice(t)}));else{var c=t.size;s.push(o.slice(0,0)),l.push(o.slice(0,c)),o=o.slice(c)}var d=new Buffer$1;d.write.apply(d,l);var h=Crypto.decryptWordArray(d.buffer,r,u),f=new Buffer$1;s.forEach((function(e,t){var r=l[t].length,n=h.slice(0,r);f.write(e),f.write(n),h=h.slice(r)})),e.samples[i].data=f.buffer}))}if(t.audioSenc&&2===t.id){var i=t.kidValue,a=t.audioSenc;t.samples.forEach((function(e,r){var n=a[r],o=Crypto.decryptWordArray(e.data,i,n.InitializationVector);t.samples[r].data=o}))}}}}],[{key:"probe",value:function(e){return MP4Parser.probe(e)}}]),t}(),version$1="3.0.0-alpha.36-7",ERROR_CODES={416:-499899,401:-499898,403:-499897,404:-499896,timeout:-499895,"4xx":-499894,"5xx":-499893,networkError:-499892,contentError:-499891,mse:-499971,mseOpen:-499972,mseAppend:-499973,boxsError:-499980,moovError:-499981,notH264:-499982,mdatError:-499983,mdhdError:-499984,metaError:-499985,muxError:-499986,h265Error:-499987,noneURL:-499988,other:-499989,other1:-499990,waitTimeout:-499791,onWaitInBufferRange:-499792},ERROR_TYPES={network:1003,format:1005,runtime:1002,other:9999,demux:1006,remux:1007};function getErrorCodeByHttpCode(e){var t=0;switch(e){case 0:t=0;break;case-1:t=ERROR_CODES.networkError;break;case-2:t=ERROR_CODES.timeout;break;case-3:t=ERROR_CODES.contentError;break;default:t=e<500?ERROR_CODES[e]||e["4xx"]:ERROR_CODES[e]||e["5xx"]}return t}var NetWorkError=_createClass$8((function e(t,r,n){_classCallCheck$7(this,e);var i=0,a=0;n&&n.range&&n.range.length>1&&(i=n.range[0],a=n.range[1]);var o=getErrorCodeByHttpCode(r);return{errorCode:o,errorType:t,errorTypeCode:ERROR_TYPES[t],errorMessage:(null==n?void 0:n.httpText)||(null==n?void 0:n.message),url:null==n?void 0:n.url,httpCode:r,version:version$1,rangeStart:i,rangeEnd:a,ext:n,mediaError:{code:o,message:(null==n?void 0:n.httpText)||(null==n?void 0:n.message)}}})),ParserError=_createClass$8((function e(t,r,n){return _classCallCheck$7(this,e),{errorCode:r,errorType:t,errorTypeCode:ERROR_TYPES[t],version:version$1,errorMessage:n.msg,ext:n,mediaError:{code:r,message:n.msg}}})),util={};function ownKeys$3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$3(Object(r),!0).forEach((function(t){_defineProperty$4(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$3(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$2(){_regeneratorRuntime$2=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep$3(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$3(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$3(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$3(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$4(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$5(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$5(e,t,r){return t&&_defineProperties$5(e.prototype,t),r&&_defineProperties$5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$4(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$2(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$2(e,t)}function _getPrototypeOf$2(e){return(_getPrototypeOf$2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$2(e,t){return(_setPrototypeOf$2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$3(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _objectWithoutPropertiesLoose$1(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties$1(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose$1(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$2(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$2(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$2(e)}function _createSuper$3(e){var t=_isNativeReflectConstruct$3();return function(){var r,n=_getPrototypeOf$2(e);if(t){var i=_getPrototypeOf$2(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$2(this,r)}}function _slicedToArray$2(e,t){return _arrayWithHoles$2(e)||_iterableToArrayLimit$2(e,t)||_unsupportedIterableToArray$3(e,t)||_nonIterableRest$2()}function _toConsumableArray$2(e){return _arrayWithoutHoles$2(e)||_iterableToArray$2(e)||_unsupportedIterableToArray$3(e)||_nonIterableSpread$2()}function _arrayWithoutHoles$2(e){if(Array.isArray(e))return _arrayLikeToArray$3(e)}function _arrayWithHoles$2(e){if(Array.isArray(e))return e}function _iterableToArray$2(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$2(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$3(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$3(e,t):void 0}}function _arrayLikeToArray$3(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$2(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$2(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ownKeys$2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(Object(r),!0).forEach((function(t){_defineProperty$3(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$2(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime$1(){_regeneratorRuntime$1=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function _typeof$2(e){return(_typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep$2(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$2(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$2(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$2(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$3(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$4(e,t,r){return t&&_defineProperties$4(e.prototype,t),r&&_defineProperties$4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$3(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf$1(e,t)}function _getPrototypeOf$1(e){return(_getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf$1(e,t){return(_setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct$2(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct$2()?Reflect.construct.bind():function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&_setPrototypeOf$1(i,r.prototype),i}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return _construct(e,arguments,_getPrototypeOf$1(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$1(r,e)},_wrapNativeSuper(e)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function _assertThisInitialized$1(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn$1(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$1(e)}function _createSuper$2(e){var t=_isNativeReflectConstruct$2();return function(){var r,n=_getPrototypeOf$1(e);if(t){var i=_getPrototypeOf$1(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$1(this,r)}}function _superPropBase$1(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf$1(e)););return e}function _get$1(){return _get$1="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase$1(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get$1.apply(this,arguments)}function _unsupportedIterableToArray$2(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$2(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray$2(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function createPublicPromise(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.used=!1,r.resolve=function(){return r.used=!0,e.apply(void 0,arguments)},r.reject=function(){return r.used=!0,t.apply(void 0,arguments)},r}function nowTime(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}}util.findBox=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var n=e.subBox.filter((function(e){return e.type===t}));n.length?n.forEach((function(e){return r.push(e)})):e.subBox.forEach((function(e){return util.findBox(e,t,r)}))}}else r.push(e);return(r=[].concat(r)).length>1?r:r[0]},util.padStart=function(e,t,r){for(var n=String(r),i=t>>0,a=Math.ceil(i/n.length),o=[],s=String(e);a--;)o.push(n);return o.join("").substring(0,i-s.length)+s},util.toHex=function(){for(var e=[],t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e.push(util.padStart(Number(t).toString(16),2,0))})),e},util.sum=function(){for(var e=0,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach((function(t){e+=t})),e},util.StringToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t},util.fromHex=function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=window.parseInt(e.substr(r,2),16);return t},util.fromCharCode=function(e){for(var t="",r=0;r<e.length;r+=16e3){var n=e.subarray(r,r+16e3);t+=String.fromCharCode.apply(null,n)}return t},util.ArrayBufferToString=function(e){for(var t="",r=new Uint8Array(e),n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t},util.Base64ToHex=function(e){for(var t=window.atob(e.replace(/-/g,"+").replace(/_/g,"/")),r="",n=0;n<t.length;n++)r+=("0"+t.charCodeAt(n).toString(16)).substr(-2);return r},util.toBase64=function(e,t){var r=util.fromCharCode(e);t=void 0===t||t;var n=window.btoa(r).replace(/\+/g,"-").replace(/\//g,"_");return t?n:n.replace(/=*$/,"")},util.toUTF8=function(e){for(var t=encodeURIComponent(e),r=unescape(t),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n.buffer},util.bufferToString=function(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()},util.strToBuf=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e[r]+e[r+1],16));return new Uint8Array(t)},util.formatIV=function(e){var t="";if(e.forEach((function(e){t+=util.bufferToString(e)})),t.length<=32)for(var r=32-t.length,n=0;n<r;n++)t+="0";return t},util.str2hex=function(e){if(""===e)return"";for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t},util.parse=function(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))},util.generateUniqueKey=function(e){var t=e.vid;e.start,e.end;var r=e.mediaType,n=e.definition;return e.preloadTime,r=r||"video",n=n||"0",t?"".concat(t,"#").concat(r,"#").concat(n,"#mp4"):null},util.validateFragment=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t instanceof ArrayBuffer){try{if(2===r.length){var n=r[1]-r[0]+1;if(!(t.byteLength===n))return}}catch(e){return console.error(e),!1}return!0}return!1},util.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},util.getBufferSplits=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e5,n=t-e;if(n-r<r/2||!t)return[[e,t]];for(var i=[];e<t;){var a=e+r;(a>t||t-a<r/2)&&(a=t),i.push([e,a]),e=a+1}return i},util.nowTime=function(){try{return parseInt(performance.now(),10)}catch(e){return(new Date).getTime()}},util.extUrl=function(t,r){try{var n=t.indexOf("?");return n<0?Object.keys(r).map((function(e,n){t+=0===n?"?".concat(e,"=").concat(r[e]):"&".concat(e,"=").concat(r[e])})):Object.keys(r).map((function(e,i){n===t.length-1?t+="".concat(e,"=").concat(r[e]):t+="&".concat(e,"=").concat(r[e])})),t}catch(e){return t}},util.getFileSize=function(t,r){try{return t&&r?parseInt(r*t/8,10):0}catch(e){return 0}},util.hashVal=function(e){var t,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r},util.getFileSize=function(t,r){try{return t&&r?parseInt(r*t/8,10):0}catch(e){return 0}},util.concatData=function(e,t){var r=[],n=0;e&&r.push(e),t&&r.push(t),r.every((function(e){return e&&(n+=e.byteLength),!0}));var i=new Uint8Array(n),a=0;return r.every((function(e){return e&&(i.set(e,a),a+=e.byteLength),!0})),i},util.getFragRange=function(e,t,r){var n=e<t.length?t[e]:null,i=e<r.length?r[e]:null,a=0,o=0;return e===t.length-1&&(a=-1),e===r.length-1&&(o=-1),[Math.min((null==n?void 0:n.range[0])||1/0,(null==i?void 0:i.range[0])||1/0),Math.max((null==n?void 0:n.range[1])+a||0,(null==i?void 0:i.range[1])+o||0)]};var Logger$2=function(){function e(t){_classCallCheck$3(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]")}return _createClass$4(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix,nowTime()].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix,nowTime()].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix,nowTime()].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix,nowTime()].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty$3(Logger$2,"disabled",!0);var LoaderType={FETCH:"fetch",XHR:"xhr"},ResponseType={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},NetError=function(e){_inherits$1(r,e);var t=_createSuper$2(r);function r(e,n,i,a){var o;return _classCallCheck$3(this,r),_defineProperty$3(_assertThisInitialized$1(o=t.call(this,a)),"retryCount",0),_defineProperty$3(_assertThisInitialized$1(o),"isTimeout",!1),_defineProperty$3(_assertThisInitialized$1(o),"loaderType",LoaderType.FETCH),_defineProperty$3(_assertThisInitialized$1(o),"startTime",0),_defineProperty$3(_assertThisInitialized$1(o),"endTime",0),_defineProperty$3(_assertThisInitialized$1(o),"options",{}),o.url=e,o.request=n,o.response=i,o}return _createClass$4(r)}(_wrapNativeSuper(Error)),toString$4=Object.prototype.toString;function isObject$1(e){return null!==e&&"object"===_typeof$2(e)}function isPlainObject(e){if("[object Object]"!==toString$4.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function isDate(e){return"[object Date]"===toString$4.call(e)}function getRangeValue(e){if(e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function setUrlParams(e,t){if(e){if(!t)return e;var r,n=Object.keys(t).map((function(e){if(null!=(r=t[e]))return Array.isArray(r)?e+="[]":r=[r],r.map((function(t){return isDate(t)?t=t.toISOString():isObject$1(t)&&(t=JSON.stringify(t)),"".concat(encode(e),"=").concat(encode(t))})).join("&")})).filter(Boolean).join("&");if(n){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+n}return e}}function createResponse(e,t,r,n,i,a,o,s,l,u,c){return i=null!=i?parseFloat(i):null,n=parseInt(n||"0",10),Number.isNaN(n)&&(n=0),{data:e,done:t,option:{range:l,vid:u,index:s,contentLength:n,age:i,startTime:a,firstByteTime:o,endTime:Date.now(),priOptions:c},response:r}}function calculateSpeed(e,t){return Math.round(8*e*1e3/t/1024)}var EVENT={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},CACHESIZE=2097152,FetchLoader=function(e){_inherits$1(n,e);var t,r=_createSuper$2(n);function n(){var e;return _classCallCheck$3(this,n),_defineProperty$3(_assertThisInitialized$1(e=r.call(this)),"_abortController",null),_defineProperty$3(_assertThisInitialized$1(e),"_timeoutTimer",null),_defineProperty$3(_assertThisInitialized$1(e),"_reader",null),_defineProperty$3(_assertThisInitialized$1(e),"_response",null),_defineProperty$3(_assertThisInitialized$1(e),"_aborted",!1),_defineProperty$3(_assertThisInitialized$1(e),"_index",-1),_defineProperty$3(_assertThisInitialized$1(e),"_range",null),_defineProperty$3(_assertThisInitialized$1(e),"_receivedLength",0),_defineProperty$3(_assertThisInitialized$1(e),"_running",!1),_defineProperty$3(_assertThisInitialized$1(e),"_logger",null),_defineProperty$3(_assertThisInitialized$1(e),"_vid",""),_defineProperty$3(_assertThisInitialized$1(e),"_onProcessMinLen",0),_defineProperty$3(_assertThisInitialized$1(e),"_onCancel",null),_defineProperty$3(_assertThisInitialized$1(e),"_priOptions",null),e}return _createClass$4(n,[{key:"load",value:function(e){var t,r=this,n=e.url,i=e.vid,a=e.timeout,o=e.responseType,s=e.onProgress,l=e.index,u=e.onTimeout,c=e.onCancel,d=e.range,h=e.transformResponse,f=e.request,p=e.params,y=e.logger,m=e.method,g=e.headers,v=e.body,b=e.mode,_=e.credentials,E=e.cache,T=e.redirect,S=e.referrer,$=e.referrerPolicy,A=e.onProcessMinLen,w=e.priOptions;this._logger=y,this._aborted=!1,this._onProcessMinLen=A,this._onCancel=c,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=l,this._range=d||[0,0],this._vid=i||n,this._priOptions=w||{};var k={method:m,headers:g,body:v,mode:b,credentials:_,cache:E,redirect:T,referrer:S,referrerPolicy:$,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},I=!1;clearTimeout(this._timeoutTimer),n=setUrlParams(n,p);var C=getRangeValue(d);C&&(g=f?f.headers:k.headers=k.headers||(Headers?new Headers:{}),Headers&&g instanceof Headers?g.append("Range",C):g.Range=C),a&&(this._timeoutTimer=setTimeout((function(){if(I=!0,r.cancel(),u){var e=new NetError(n,k,null,"timeout");e.isTimeout=!0,u(e,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})}}),a));var P=Date.now();return this._logger.debug("[fetch load start], index,",l,",range,",d),new Promise((function(e,t){fetch(f||n,f?void 0:k).then(function(){var i=_asyncToGenerator$2(_regeneratorRuntime$1().mark((function i(a){var u,c,f,p;return _regeneratorRuntime$1().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(clearTimeout(r._timeoutTimer),r._response=a,!r._aborted&&r._running){i.next=4;break}return i.abrupt("return");case 4:if(h&&(a=h(a,n)||a),a.ok){i.next=7;break}throw new NetError(n,k,a,"bad network response");case 7:if(u=Date.now(),o!==ResponseType.TEXT){i.next=15;break}return i.next=11,a.text();case 11:c=i.sent,r._running=!1,i.next=37;break;case 15:if(o!==ResponseType.JSON){i.next=22;break}return i.next=18,a.json();case 18:c=i.sent,r._running=!1,i.next=37;break;case 22:if(!s){i.next=29;break}return r.resolve=e,r.reject=t,r._loadChunk(a,s,P,u),i.abrupt("return");case 29:return i.next=31,a.arrayBuffer();case 31:c=i.sent,c=new Uint8Array(c),r._running=!1,f=Date.now()-P,p=calculateSpeed(c.byteLength,f),r.emit(EVENT.REAL_TIME_SPEED,{speed:p,len:c.byteLength,time:f,vid:r._vid,index:r._index,range:r._range,priOptions:r._priOptions});case 37:r._logger.debug("[fetch load end], index,",l,",range,",d),e(createResponse(c,!0,a,a.headers.get("Content-Length"),a.headers.get("age"),P,u,l,d,r._vid,r._priOptions));case 39:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()).catch((function(e){var i;clearTimeout(r._timeoutTimer),r._running=!1,r._aborted&&!I||((e=e instanceof NetError?e:new NetError(n,k,null,null===(i=e)||void 0===i?void 0:i.message)).startTime=P,e.endTime=Date.now(),e.isTimeout=I,e.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},t(e))}))}))}},{key:"cancel",value:(t=_asyncToGenerator$2(_regeneratorRuntime$1().mark((function e(){return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(error){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,r,n){var i=this;if(!e.body||!e.body.getReader){this._running=!1;var a=new NetError(e.url,"",e,"onProgress of bad response.body.getReader");return a.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},void this.reject(a)}this._onProcessMinLen>0&&(this._cache=new Uint8Array(CACHESIZE),this._writeIdx=0);var o,s,l,u=this._reader=e.body.getReader(),c=function(){var a=_asyncToGenerator$2(_regeneratorRuntime$1().mark((function a(){var d,h,f,p,y,m;return _regeneratorRuntime$1().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=Date.now(),a.prev=1,a.next=4,u.read();case 4:o=a.sent,l=Date.now(),a.next=13;break;case 8:return a.prev=8,a.t0=a.catch(1),l=Date.now(),i._aborted||(i._running=!1,a.t0.options={index:i._index,range:i._range,vid:i._vid,priOptions:i._priOptions},i.reject(a.t0)),a.abrupt("return");case 13:if(d=i._range[0]+i._receivedLength,!i._aborted){a.next=18;break}return i._running=!1,t(void 0,!1,{range:[d,d],vid:i._vid,index:i._index,startTime:s,endTime:l,priOptions:i._priOptions},e),a.abrupt("return");case 18:h=o.value?o.value.byteLength:0,i._receivedLength+=h,i._logger.debug("fetchLoader,onProgress call,task,",i._range,", start,",d,", end,",i._range[0]+i._receivedLength,", done,",o.done),i._onProcessMinLen>0?i._writeIdx+h>=i._onProcessMinLen||o.done?((f=new Uint8Array(i._writeIdx+h)).set(i._cache.slice(0,i._writeIdx),0),h>0&&f.set(o.value,i._writeIdx),i._writeIdx=0,i._logger.debug("fetchLoader,onProgress enough,done,",o.done,",len,",f.byteLength,", writeIdx,",i._writeIdx)):h>0&&i._writeIdx+h<CACHESIZE?(i._cache.set(o.value,i._writeIdx),i._writeIdx+=h,i._logger.debug("fetchLoader,onProgress cache,len,",h,", writeIdx,",i._writeIdx)):h>0&&(p=new Uint8Array(i._writeIdx+h+2048),i._logger.debug("fetchLoader,onProgress extra start,size,",i._writeIdx+h+2048,", datalen,",h,", writeIdx,",i._writeIdx),p.set(i._cache.slice(0,i._writeIdx),0),h>0&&p.set(o.value,i._writeIdx),i._writeIdx+=h,delete i._cache,i._cache=p,i._logger.debug("fetchLoader,onProgress extra end,len,",h,", writeIdx,",i._writeIdx)):f=o.value,(f&&f.byteLength>0||o.done)&&t(f,o.done,{range:[i._range[0]+i._receivedLength-(f?f.byteLength:0),i._range[0]+i._receivedLength],vid:i._vid,index:i._index,startTime:s,endTime:l,priOptions:i._priOptions},e),o.done?(y=Date.now()-r,m=calculateSpeed(i._receivedLength,y),i.emit(EVENT.REAL_TIME_SPEED,{speed:m,len:i._receivedLength,time:y,vid:i._vid,index:i._index,range:i._range,priOptions:i._priOptions}),i._running=!1,i._logger.debug("[fetchLoader onProgress end],task,",i._range,",done,",o.done),i.resolve(createResponse(o,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),r,n,i._index,i._range,i._vid,i._priOptions))):c();case 24:case"end":return a.stop()}}),a,null,[[1,8]])})));return function(){return a.apply(this,arguments)}}();c()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return!("undefined"==typeof fetch)}}]),n}(EventEmitter$1);function getConfig$1(e){return _objectSpread2$2({loaderType:LoaderType.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:ResponseType.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e)}var XhrLoader=function(t){_inherits$1(n,t);var r=_createSuper$2(n);function n(){var e;return _classCallCheck$3(this,n),_defineProperty$3(_assertThisInitialized$1(e=r.call(this)),"_xhr",null),_defineProperty$3(_assertThisInitialized$1(e),"_aborted",!1),_defineProperty$3(_assertThisInitialized$1(e),"_timeoutTimer",null),_defineProperty$3(_assertThisInitialized$1(e),"_range",null),_defineProperty$3(_assertThisInitialized$1(e),"_receivedLength",0),_defineProperty$3(_assertThisInitialized$1(e),"_url",null),_defineProperty$3(_assertThisInitialized$1(e),"_onProgress",null),_defineProperty$3(_assertThisInitialized$1(e),"_index",-1),_defineProperty$3(_assertThisInitialized$1(e),"_headers",null),_defineProperty$3(_assertThisInitialized$1(e),"_currentChunkSizeKB",384),_defineProperty$3(_assertThisInitialized$1(e),"_timeout",null),_defineProperty$3(_assertThisInitialized$1(e),"_xhr",null),_defineProperty$3(_assertThisInitialized$1(e),"_withCredentials",null),_defineProperty$3(_assertThisInitialized$1(e),"_startTime",-1),_defineProperty$3(_assertThisInitialized$1(e),"_loadCompleteResolve",null),_defineProperty$3(_assertThisInitialized$1(e),"_loadCompleteReject",null),_defineProperty$3(_assertThisInitialized$1(e),"_runing",!1),_defineProperty$3(_assertThisInitialized$1(e),"_logger",!1),_defineProperty$3(_assertThisInitialized$1(e),"_vid",""),_defineProperty$3(_assertThisInitialized$1(e),"_responseType",void 0),_defineProperty$3(_assertThisInitialized$1(e),"_credentials",void 0),_defineProperty$3(_assertThisInitialized$1(e),"_method",void 0),_defineProperty$3(_assertThisInitialized$1(e),"_transformResponse",void 0),_defineProperty$3(_assertThisInitialized$1(e),"_firstRtt",void 0),_defineProperty$3(_assertThisInitialized$1(e),"_onCancel",null),_defineProperty$3(_assertThisInitialized$1(e),"_priOptions",null),e}return _createClass$4(n,[{key:"load",value:function(e){var t=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials="include"===e.credentials||"same-origin"===e.credentials,this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("xhrLoader task, range",this._range),this._url=setUrlParams(e.url,e.params);var r=Date.now();return new Promise((function(e,r){t._loadCompleteResolve=e,t._loadCompleteReject=r,t._startLoad()})).catch((function(e){if(clearTimeout(t._timeoutTimer),t._runing=!1,!t._aborted)throw(e=e instanceof NetError?e:new NetError(t._url,t._request)).startTime=r,e.endTime=Date.now(),e.options={index:t._index,vid:t._vid,priOptions:t._priOptions},e}))}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===ResponseType.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var t=1024*this._currentChunkSizeKB,r=this._range[0]+this._receivedLength,n=this._range[1];t<this._range[1]-r&&(n=r+t),e=[r,n],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(t){var r=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(e){var t,n,i;r._running=!1;var a=new NetError(r._url,r._request,null==e||null===(t=e.currentTarget)||void 0===t?void 0:t.response,"xhr.onerror.status:"+(null==e||null===(n=e.currentTarget)||void 0===n?void 0:n.status)+",statusText,"+(null==e||null===(i=e.currentTarget)||void 0===i?void 0:i.statusText));a.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},r._loadCompleteReject(a)},n.ontimeout=function(e){r.cancel();var t=new NetError(r._url,r._request,{status:408},"timeout");r._onTimeout&&(t.isTimeout=!0,r._onTimeout(t,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})),t.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},r._loadCompleteReject(t)};var i=this._headers||{},a=getRangeValue(t);a&&(i.Range=a),i&&Object.keys(i).forEach((function(e){n.setRequestHeader(e,i[e])})),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",t),n.send(this._body)}catch(e){e.options={index:this._index,range:t,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(e)}}},{key:"_onReadyStatechange",value:function(e){2===e.target.readyState&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var t=e.target.status;if(t<200||t>299){var r=new NetError(this._url,null,_objectSpread2$2(_objectSpread2$2({},e.target.response),{},{status:t}),"bad response,status:"+t);return r.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(r)}var n,i=null,a=!1;if(this._responseType===ResponseType.ARRAY_BUFFER){var o=new Uint8Array(e.target.response);if(n=this._range[0]+this._receivedLength,o&&o.byteLength>0){this._receivedLength+=o.byteLength;var s=Date.now()-this._startTime,l=calculateSpeed(this._receivedLength,s);this.emit(EVENT.REAL_TIME_SPEED,{speed:l,len:this._receivedLength,time:s,vid:this._vid,index:this._index,range:[n,this._range[0]+this._receivedLength],priOptions:this._priOptions})}i=o,a=!(this._range.length>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]),this._logger.debug("[xhr load done->], tast :",this._range,", start",n,"end ",this._range[0]+this._receivedLength,",dataLen,",o?o.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",a)}else a=!0,i=e.target.response;var u={ok:t>=200&&t<300,status:t,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(u=this._transformResponse(u,this._url)||u),this._onProgress&&this._onProgress(i,a,{index:this._index,vid:this._vid,range:[n,this._range[0]+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},u),a?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(createResponse(this._onProgress?null:i,a,u,u.headers["content-length"],u.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted)return this._aborted=!0,this._runing=!1,_get$1(_getPrototypeOf$1(n.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr?this._xhr.abort():void 0}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var t,r={},n=_createForOfIteratorHelper(e.getAllResponseHeaders().trim().split("\r\n"));try{for(n.s();!(t=n.n()).done;){var i=t.value.split(": ");r[i[0].toLowerCase()]=i.slice(1).join(": ")}}catch(a){n.e(a)}finally{n.f()}return r}}],[{key:"isSupported",value:function(){return"undefined"!=typeof XMLHttpRequest}}]),n}(EventEmitter$1),_excluded$2=["retry","retryDelay","onRetryError","transformError"],Task=function(){function e(t,r){_classCallCheck$3(this,e),this.promise=createPublicPromise(),this.alive=!!r.onProgress,!r.logger&&(r.logger=new Logger$2("Loader")),this._loaderType=t,this._loader=t===LoaderType.FETCH&&window.fetch?new FetchLoader:new XhrLoader,this._config=r,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._logger=r.logger}var t;return _createClass$4(e,[{key:"exec",value:function(){var e=this,t=this._config,r=t.retry,n=t.retryDelay,i=t.onRetryError,a=t.transformError,o=_objectWithoutProperties(t,_excluded$2),s=function(){var t=_asyncToGenerator$2(_regeneratorRuntime$1().mark((function t(){var l,u;return _regeneratorRuntime$1().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._loader.load(o);case 3:l=t.sent,e.promise.resolve(l),t.next=28;break;case 7:if(t.prev=7,t.t0=t.catch(0),e._loader.running=!1,e._logger.debug("[task request catch err]",t.t0),!e._canceled){t.next=13;break}return t.abrupt("return");case 13:if(!(t.t0.response&&t.t0.response.status>=400&&t.t0.response.status<=599)){t.next=16;break}return e.promise.reject(t.t0),t.abrupt("return");case 16:if(t.t0.loaderType=e._loaderType,t.t0.retryCount=e._retryCount,u=t.t0,a&&(u=a(u)||u),i&&e._retryCount>0&&i(u,e._retryCount,{index:o.index,vid:o.vid,range:o.range,priOptions:o.priOptions}),e._retryCount++,!(e._retryCount<=r)){t.next=27;break}return clearTimeout(e._retryTimer),e._logger.debug("[task request setTimeout],retry",e._retryCount,",retry range,",o.range),e._retryTimer=setTimeout(s,n),t.abrupt("return");case 27:e.promise.reject(u);case 28:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();return s(),this.promise}},{key:"cancel",value:(t=_asyncToGenerator$2(_regeneratorRuntime$1().mark((function e(){return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),e}();function concatUint8Array$1(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if((t=t.filter(Boolean)).length<2)return t[0];var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function sleep(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var NetLoader=function(e){_inherits$1(n,e);var t,r=_createSuper$2(n);function n(e){var t;return _classCallCheck$3(this,n),_defineProperty$3(_assertThisInitialized$1(t=r.call(this,e)),"type",LoaderType.FETCH),_defineProperty$3(_assertThisInitialized$1(t),"_queue",[]),_defineProperty$3(_assertThisInitialized$1(t),"_alive",[]),_defineProperty$3(_assertThisInitialized$1(t),"_currentTask",null),_defineProperty$3(_assertThisInitialized$1(t),"_config",void 0),t._config=getConfig$1(e),t._config.loaderType!==LoaderType.XHR&&FetchLoader.isSupported()||(t.type=LoaderType.XHR),t.log=e.logger,t}return _createClass$4(n,[{key:"isFetch",value:function(){return this.type===LoaderType.FETCH}},{key:"load",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"!=typeof e&&e?r=e:r.url=e||r.url||this._config.url,(r=Object.assign({},this._config,r)).params&&(r.params=Object.assign({},r.params)),r.headers&&isPlainObject(r.headers)&&(r.headers=Object.assign({},r.headers)),r.body&&isPlainObject(r.body)&&(r.body=Object.assign({},r.body)),r.transformRequest&&(r=r.transformRequest(r)||r),r.logger=this.log;var n=new Task(this.type,r);return n.loader.on(EVENT.REAL_TIME_SPEED,(function(e){t.emit(EVENT.REAL_TIME_SPEED,e)})),this._queue.push(n),1!==this._queue.length||this._currentTask&&this._currentTask.running||this._processTask(),n.promise}},{key:"cancel",value:(t=_asyncToGenerator$2(_regeneratorRuntime$1().mark((function e(){var t;return _regeneratorRuntime$1().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.map((function(e){return e.cancel()})).concat(this._alive.map((function(e){return e.cancel()}))),this._currentTask&&t.push(this._currentTask.cancel()),this._queue=[],this._alive=[],e.next=6,Promise.all(t);case 6:return e.next=8,sleep();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_processTask",value:function(){var e=this;this._currentTask=this._queue.shift(),this._currentTask&&(this._currentTask.alive&&this._alive.push(this._currentTask),this._currentTask.exec().catch((function(e){})).finally((function(){e._processTask()})))}}],[{key:"isFetchSupport",value:function(){return FetchLoader.isSupported()}}]),n}(EventEmitter$1);function getConfig(e){return _objectSpread2$3({vid:"",moovEnd:8e4,segmentDuration:2,maxDownloadInfoSize:30,responseType:"arraybuffer",cache:null},e)}var MediaError=_createClass$5((function e(t,r){_classCallCheck$4(this,e),this.type="file",this.message=t,this.data=r})),Cache=function(){function e(){_classCallCheck$4(this,e),_defineProperty$4(this,"_data",Object.create(null))}return _createClass$5(e,[{key:"set",value:function(e,t){this._data[e]=t}},{key:"get",value:function(e){return this._data[e]}},{key:"clear",value:function(){this._data=Object.create(null)}}]),e}();function moovToSegments(e,t){var r=e.trak;if(r&&r.length){var n=r.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),i=r.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)}));if(n||i){var a,o=[],s=[];if(n){var l,u,c,d=null===(l=n.mdia)||void 0===l||null===(u=l.minf)||void 0===u?void 0:u.stbl;if(!d)return;var h=null===(c=n.mdia.mdhd)||void 0===c?void 0:c.timescale,f=d.stts,p=d.stsc,y=d.stsz,m=d.stco,g=d.stss,v=d.ctts;if(!(h&&f&&p&&y&&m&&g))return;a=(o=getSegments(t,h,f,p,y,m,g,v)).map((function(e){return e.duration}))}if(i){var b,_,E,T=null===(b=i.mdia)||void 0===b||null===(_=b.minf)||void 0===_?void 0:_.stbl;if(!T)return;var S=null===(E=i.mdia.mdhd)||void 0===E?void 0:E.timescale,$=T.stts,A=T.stsc,w=T.stsz,k=T.stco;if(!(S&&$&&A&&w&&k))return;s=getSegments(t,S,$,A,w,k,null,null,a)}return{videoSegments:o,audioSegments:s}}}}function getSegments(e,t,r,n,i,a,o,s,l){var u,c,d,h,f=[],p=[],y=[],m=n.entries,g=a.entries,v=i.entrySizes,b=null==o?void 0:o.entries,_=null==s?void 0:s.entries;_&&(u=[],_.forEach((function(e){for(var t=e.count,r=e.offset,n=0;n<t;n++)u.push(r)}))),b&&(c={},b.forEach((function(e){c[e-1]=!0})));var E=0,T=0,S=0,$=0,A=0,w=m[0].samplesPerChunk,k=m[1]?m[1].firstChunk-1:1/0,I=0,C=-1;r.entries.forEach((function(e){var t=e.count,r=e.delta;h=r;for(var n=0;n<t;n++)d={dts:I,startTime:E,duration:h,size:v[T]||i.sampleSize,offset:g[S]+A,index:T},b&&(d.keyframe=c[T],d.keyframe?(C++,p.push([d]),y.push(d.duration)):(p[p.length-1].push(d),y[p.length-1]+=d.duration),d.gopId=C),u&&T<u.length&&(d.pts=I+u[T]),0===T&&(d.pts=0),f.push(d),E+=h,I+=r,++T<w?A+=d.size:(S++,A=0,S>=k&&($++,k=m[$+1]?m[$+1].firstChunk-1:1/0),w+=m[$].samplesPerChunk)}));var P=f.length;if(P&&(!o||f[0].keyframe)){var x,R=[],O=[],L=0,D=0,M=function(e){var r;x=O[O.length-1],R.push({index:R.length,startTime:(null===(r=R[R.length-1])||void 0===r?void 0:r.endTime)||O[0].startTime/t,endTime:(x.startTime+x.duration)/t,duration:e,range:[O[0].offset,x.offset+x.size],frames:O}),L=0,O=[]};if(o)for(var N=e*t,G=0,V=p.length;G<V;G++){var U;L+=y[G],(U=O).push.apply(U,_toConsumableArray$2(p[G])),G+1<V?(0===G||L>N)&&M(L/t):M(L/t)}else for(var Z=(l=l||[])[0]||e,B=0;B<P;B++){O.push(f[B]);var F=(L+=f[B].duration)/t;(B+1>=P||F+D>=Z)&&(D+=F-Z,M(F),Z=l[R.length]||e)}return R}}function moovToMeta(e){var t="",r="",n=0,i=0,a=0,o=0,s=0,l=0,u=0;e.mvhd&&(s=e.mvhd.duration/e.mvhd.timescale);var c=e.trak;if(c){var d,h,f,p,y,m,g,v,b,_,E,T,S,$,A,w,k,I=c.find((function(e){var t,r;return"vide"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),C=c.find((function(e){var t,r;return"soun"===(null===(t=e.mdia)||void 0===t||null===(r=t.hdlr)||void 0===r?void 0:r.handlerType)})),P=null;if(I)if(P=null===(h=I.mdia)||void 0===h||null===(f=h.minf)||void 0===f||null===(p=f.stbl)||void 0===p?void 0:p.stsd.entries[0])if(n=P.width,i=P.height,l=null===(y=I.mdia)||void 0===y||null===(m=y.mdhd)||void 0===m?void 0:m.timescale,t=null===(g=P.avcC||P.hvcC)||void 0===g?void 0:g.codec,"encv"===P.type)d=null===(v=P.sinf)||void 0===v||null===(b=v.schi)||void 0===b?void 0:b.tenc.default_KID;if(C)if(P=null===(_=C.mdia)||void 0===_||null===(E=_.minf)||void 0===E||null===(T=E.stbl)||void 0===T?void 0:T.stsd.entries[0])if(a=P.channelCount,o=P.sampleRate,r=null===(S=P.esds)||void 0===S?void 0:S.codec,u=null===($=C.mdia)||void 0===$||null===(A=$.mdhd)||void 0===A?void 0:A.timescale,"enca"===P.type)d=d||(null===(w=P.sinf)||void 0===w||null===(k=w.schi)||void 0===k?void 0:k.tenc.default_KID);return{kid:d?d.join(""):null,videoCodec:t,audioCodec:r,width:n,height:i,videoTimescale:l,audioChannelCount:a,audioSampleRate:o,duration:s,audioTimescale:u,moov:e}}}function isNumber$1(e){return"number"==typeof e&&!Number.isNaN(e)}var _excluded$1=["vid","cache"],MP4Loader=function(e){_inherits$2(f,e);var t,r,n,i,a,o,s,l,u,c,d,h=_createSuper$3(f);function f(e){var t;_classCallCheck$4(this,f),_defineProperty$4(_assertThisInitialized$2(t=h.call(this)),"vid",""),_defineProperty$4(_assertThisInitialized$2(t),"url",""),_defineProperty$4(_assertThisInitialized$2(t),"meta",{}),_defineProperty$4(_assertThisInitialized$2(t),"downloadInfo",[]),_defineProperty$4(_assertThisInitialized$2(t),"videoSegments",[]),_defineProperty$4(_assertThisInitialized$2(t),"audioSegments",[]),_defineProperty$4(_assertThisInitialized$2(t),"cache",null),_defineProperty$4(_assertThisInitialized$2(t),"_currentSegmentIndex",-1),_defineProperty$4(_assertThisInitialized$2(t),"_currentLoadingSegmentIndex",-1),_defineProperty$4(_assertThisInitialized$2(t),"buffer",void 0),_defineProperty$4(_assertThisInitialized$2(t),"_error",void 0),_defineProperty$4(_assertThisInitialized$2(t),"_transformError",(function(e){return e})),t._config=getConfig(e);var r=t._config,n=r.vid,i=r.cache,a=_objectWithoutProperties$1(r,_excluded$1);return t.cache=i||new Cache,t.vid=n||a.url,t.url=a.url,a.transformError=t._transformError,t.logger=new Logger$2("MP4Loader_"+t.vid),e.openLog&&Logger$2.enable(),a.logger=t.logger,t._loader=new NetLoader(a),t._loader.on(EVENT.REAL_TIME_SPEED,(function(e){t.emit(EVENT.REAL_TIME_SPEED,e)})),t}return _createClass$5(f,[{key:"isMetaLoaded",get:function(){return this.videoSegments.length||this.audioSegments.length}},{key:"setCurrentSegment",value:function(e){isNumber$1(e)&&(this._currentSegmentIndex=e)}},{key:"isLastSegment",value:function(e){var t,r;return!!isNumber$1(e)&&e===((null===(t=this.videoSegments[this.videoSegments.length-1])||void 0===t?void 0:t.index)||(null===(r=this.audioSegments[this.audioSegments.length-1])||void 0===r?void 0:r.index)||0)}},{key:"isSegmentLoading",value:function(e){return e===this._currentLoadingSegmentIndex}},{key:"changeUrl",value:(d=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t){var r,n,i,a=arguments;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:t,n=a.length>2?a[2]:void 0,i=a.length>3?a[3]:void 0,e.next=5,this.reset(i);case 5:t&&(this.url=t),r&&(this.vid=r),n&&(this._config.moovEnd=n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getOrLoadMeta",value:(c=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(t);case 3:return e.abrupt("return",this.meta);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"loadMetaProcess",value:(u=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t,r,n,i){var a,o,s,l,u=this;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=_slicedToArray$2(r,2),o=a[0],s=a[1],this._error=!1,this.logger.debug("[loadMetaProcess start], range,",[o,s]),l=function(){var e=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(r,a,l){var c,d,h,f,p,y,m,g;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.meta&&null!=l&&l.range&&l.range.length>0&&l.range[1]>=s&&(a=!0,u.logger.debug("[loadMetaProcess],data done,setstate true,[",o,s,"]")),a&&null!=l&&l.range&&l.range.length>0&&l.range[1]<s&&(a=!1,u.logger.debug("[loadMetaProcess],data not done,setstate false,[",o,s,"]")),u.logger.debug("[loadMetaProcess],task,[",o,s,"], range,",l.range,",dataLen,",r?r.byteLength:void 0,", state,",a,",err,",u._error),!u._error&&r&&r.byteLength>0&&n(r,a,l),!u.meta.moov&&!u._error){e.next=6;break}return e.abrupt("return");case 6:if(!(r&&r.byteLength>0)){e.next=44;break}if(u.buffer=concatUint8Array$1(u.buffer,r),c=MP4Parser.findBox(u.buffer,["moov"])[0]){e.next=23;break}if(d=MP4Parser.findBox(u.buffer,["mdat"])[0],!a){e.next=23;break}if(d){e.next=18;break}return u._error=!0,n(null,a,l,{err:"cannot find moov or mdat box"}),e.abrupt("return");case 18:return h=d.start+d.size,e.next=21,u.loadData([h,""],t,i);case 21:(f=e.sent)&&(c=MP4Parser.findBox(f.data,["moov"])[0]);case 23:if(!(c&&a&&c.size>c.data.length)){e.next=27;break}return u.logger.debug("[loadMetaProcess],moov not all, range,",l.range[1],",dataLen,",u.buffer.byteLength,", state,",a),e.next=27,u.loadMetaProcess(t,[l.range[1],c.start+c.size-1],n);case 27:if(!(c&&c.size<=c.data.length)||u.meta.moov){e.next=44;break}if(p=MP4Parser.moov(c)){e.next=33;break}return u._error=!0,n(null,a,l,{err:"cannot parse moov box"}),e.abrupt("return");case 33:if(y=moovToSegments(p,u._config.segmentDuration)){e.next=38;break}return u._error=!0,n(null,a,l,{err:"cannot parse segments"}),e.abrupt("return");case 38:u.meta=moovToMeta(p),m=y.videoSegments,g=y.audioSegments,u.videoSegments=m,u.audioSegments=g,u.logger.debug("[loadMetaProcess] moov ok"),n(void 0,a,{meta:{meta:u.meta,videoSegments:m,audioSegments:g}});case 44:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),e.next=6,this.loadData([o,s||this._config.moovEnd],t,_objectSpread2$3({onProgress:l},i));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return u.apply(this,arguments)})},{key:"loadMeta",value:(l=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t,r,n){var i,a,o,s,l,u,c,d,h;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],this.logger.debug("[loadMeta start]"),e.next=4,this.loadData([0,r||this._config.moovEnd],t,n);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(i.push(a),o=MP4Parser.findBox(a.data,["moov"])[0]){e.next=23;break}if(s=MP4Parser.findBox(a.data,["mdat"])[0]){e.next=13;break}throw new MediaError("cannot find moov or mdat box",a.data);case 13:return l=s.start+s.size,e.next=16,this.loadData([l],t,n);case 16:if(a=e.sent){e.next=19;break}return e.abrupt("return");case 19:if(i.push(a),o=MP4Parser.findBox(a.data,["moov"],l)[0]){e.next=23;break}throw new MediaError("cannot find moov box",a.data);case 23:if(!(o.size>o.data.length)){e.next=31;break}return e.next=26,this.loadData([a.data.length,o.start+o.size-1],t,n);case 26:if(a=e.sent){e.next=29;break}return e.abrupt("return");case 29:i.push(a),o.data=concatUint8Array$1(o.data,a.data);case 31:if(u=MP4Parser.moov(o)){e.next=34;break}throw new MediaError("cannot parse moov box",o.data);case 34:if(c=moovToSegments(u,this._config.segmentDuration)){e.next=37;break}throw new MediaError("cannot parse segments",o.data);case 37:return this.meta=moovToMeta(u),d=c.videoSegments,h=c.audioSegments,this.videoSegments=d,this.audioSegments=h,this.logger.debug("[load moov end!!!!!]"),e.abrupt("return",{meta:this.meta,videoSegments:d,audioSegments:h,responses:i});case 43:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return l.apply(this,arguments)})},{key:"getSegmentByTime",value:function(e){var t,r;return this.videoSegments.length?(t=this.videoSegments.find((function(t){return t.startTime<=e&&t.endTime>e})))&&(r=this.audioSegments[t.index]):r=this.audioSegments.find((function(t){return t.startTime<=e&&t.endTime>e})),{video:t,audio:r}}},{key:"loadSegmentByTime",value:(s=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t,r){var n,i,a,o,s,l=arguments;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(l.length>2&&void 0!==l[2])||l[2],i=l.length>3&&void 0!==l[3]?l[3]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta(r);case 5:return a=this.getSegmentByTime(t),o=a.video,s=a.audio,e.abrupt("return",this._loadSegment(o,s,r,n,i));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"loadNextSegment",value:(o=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t){var r,n,i,a,o=arguments;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(o.length>1&&void 0!==o[1])||o[1],n=o.length>2&&void 0!==o[2]?o[2]:{},this.isMetaLoaded){e.next=5;break}return e.next=5,this.loadMeta();case 5:return i=this.videoSegments[this._currentSegmentIndex+1],a=this.audioSegments[this._currentSegmentIndex+1],e.abrupt("return",this._loadSegment(i,a,t,r,n));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"preload",value:(a=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t){var r,n,i,a,o,s,l,u=this;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isMetaLoaded){e.next=3;break}return e.next=3,this.loadMeta(!0);case 3:if(t&&!(t<0)){e.next=5;break}return e.abrupt("return");case 5:if(r=this.getSegmentByTime(t),n=r.video,i=r.audio,a=Math.max((null==n?void 0:n.index)||0,(null==i?void 0:i.index)||0)){e.next=9;break}return e.abrupt("return");case 9:return o=this.videoSegments.slice(0,a),s=this.audioSegments.slice(0,a),l=function(){var e=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>a)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,u._loadSegment(o[t],s[t],!0,!1);case 4:return e.next=6,l(t+1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=14,l(0);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"cancel",value:function(){return this._loader.cancel()}},{key:"reset",value:(i=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(){var t=arguments;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length>0&&void 0!==t[0]&&t[0]){e.next=5;break}return this.logger.debug("[MP4loader reset func call loader.cancel]"),e.next=5,this._loader.cancel();case 5:this.vid=this.url="",this.meta={},this.downloadInfo=[],this.videoSegments=[],this.audioSegments=[],this._currentSegmentIndex=-1,this._currentLoadingSegmentIndex=-1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"destroy",value:(n=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(){return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.reset();case 2:this.cache.clear();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_loadSegment",value:(r=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t,r,n,i,a){var o,s;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||r){e.next=2;break}return e.abrupt("return");case 2:return o=(null==t?void 0:t.index)||(null==r?void 0:r.index)||0,this._currentLoadingSegmentIndex=o,e.prev=4,e.next=7,this.loadData([Math.min((null==t?void 0:t.range[0])||1/0,(null==r?void 0:r.range[0])||1/0),Math.max((null==t?void 0:t.range[1])||0,(null==r?void 0:r.range[1])||0)],n,a);case 7:s=e.sent;case 8:return e.prev=8,this._currentLoadingSegmentIndex=-1,e.finish(8);case 11:if(s){e.next=13;break}return e.abrupt("return");case 13:return i&&(this._currentSegmentIndex=o),s.video=t,s.audio=r,e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this,[[4,,8,11]])}))),function(e,t,n,i,a){return r.apply(this,arguments)})},{key:"loadData",value:(t=_asyncToGenerator$3(_regeneratorRuntime$2().mark((function e(t,r,n){var i,a,o,s;return _regeneratorRuntime$2().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._getCacheKey(t),e.next=3,this.cache.get(i);case 3:if(a=e.sent){e.next=11;break}return s=n&&n.url?n.url:this.url,e.next=8,this._loader.load(s,_objectSpread2$3({range:t,vid:this.vid},n));case 8:o=e.sent,e.next=12;break;case 11:o={data:a,state:!0,options:{fromCache:!0,range:t,vid:this.vid}};case 12:if(o){e.next=14;break}return e.abrupt("return");case 14:return a||(o.data&&this.downloadInfo.push({startTime:o.startTime,endTime:o.endTime,size:o.data.byteLength,range:t}),this.downloadInfo&&this.downloadInfo.length>this._config.maxDownloadInfoSize&&(this.downloadInfo=this.downloadInfo.slice(-this._config.maxDownloadInfoSize))),e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"_getCacheKey",value:function(e){return(this.vid||this.url)+":"+e}}]),f}(EventEmitter$1),isSupport=_isLocalStorageUsable(),openLog=checkOpenLog();function probeSupport(){try{return"undefined"!=typeof localStorage&&"setItem"in window.localStorage&&!!window.localStorage.setItem}catch(e){return!1}}function checkIfLocalStorageThrows(){var t="_localstorage_support_test";try{return window.localStorage.setItem(t,!0),window.localStorage.removeItem(t),!1}catch(e){return!0}}function checkOpenLog(){if(isSupport)try{return!!window.localStorage.getItem("playerlog")}catch(e){return!1}return!1}function _isLocalStorageUsable(){return probeSupport()&&!checkIfLocalStorageThrows()}function log$1(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];openLog&&console.log&&(t=console).log.apply(t,["[logger]",util.nowTime(),e].concat(n))}var MONITOR_HEADERS={"x-cache":"x_cache","x-response-sinfo":"server_ip","x-response-cinfo":"x-response-cinfo"};function transformHeaders(e){var t={};return Object.keys(MONITOR_HEADERS).forEach((function(r){var n=MONITOR_HEADERS[r];e&&e.get&&e.get(r)&&(t[n]=e.get(r))})),t}var metaSizeConfig=[{range:[0,90],size:614400},{range:[90,120],size:1228800},{range:[120,Number.MAX_VALUE],size:2048e3}];function getMetaSize(e,t,r){var n=r>51200?Math.min(r,t):t;if(!e)return n;for(var i=0;i<metaSizeConfig.length;i++)if(e>=metaSizeConfig[i].range[0]&&e<metaSizeConfig[i].range[1]){n=Math.min(Math.max(n,metaSizeConfig[i].size),r>0?r:t);break}return n}var encodedJs$4="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHQodCxlKXt2YXIgcj1PYmplY3Qua2V5cyh0KTtpZihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbj1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHQpO2UmJihuPW4uZmlsdGVyKChmdW5jdGlvbihlKXtyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LGUpLmVudW1lcmFibGV9KSkpLHIucHVzaC5hcHBseShyLG4pfXJldHVybiByfWZ1bmN0aW9uIGUoZSl7Zm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyl7dmFyIG49bnVsbCE9YXJndW1lbnRzW3JdP2FyZ3VtZW50c1tyXTp7fTtyJTI/dChPYmplY3QobiksITApLmZvckVhY2goKGZ1bmN0aW9uKHQpe28oZSx0LG5bdF0pfSkpOk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGUsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMobikpOnQoT2JqZWN0KG4pKS5mb3JFYWNoKChmdW5jdGlvbih0KXtPYmplY3QuZGVmaW5lUHJvcGVydHkoZSx0LE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobix0KSl9KSl9cmV0dXJuIGV9ZnVuY3Rpb24gcih0KXtyZXR1cm4ocj0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiYic3ltYm9sIj09dHlwZW9mIFN5bWJvbC5pdGVyYXRvcj9mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHR9OmZ1bmN0aW9uKHQpe3JldHVybiB0JiYiZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sJiZ0LmNvbnN0cnVjdG9yPT09U3ltYm9sJiZ0IT09U3ltYm9sLnByb3RvdHlwZT8ic3ltYm9sIjp0eXBlb2YgdH0pKHQpfWZ1bmN0aW9uIG4odCxlKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX1mdW5jdGlvbiBpKHQsZSl7Zm9yKHZhciByPTA7cjxlLmxlbmd0aDtyKyspe3ZhciBuPWVbcl07bi5lbnVtZXJhYmxlPW4uZW51bWVyYWJsZXx8ITEsbi5jb25maWd1cmFibGU9ITAsInZhbHVlImluIG4mJihuLndyaXRhYmxlPSEwKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCx5KG4ua2V5KSxuKX19ZnVuY3Rpb24gYSh0LGUscil7cmV0dXJuIGUmJmkodC5wcm90b3R5cGUsZSksciYmaSh0LHIpLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJwcm90b3R5cGUiLHt3cml0YWJsZTohMX0pLHR9ZnVuY3Rpb24gbyh0LGUscil7cmV0dXJuKGU9eShlKSlpbiB0P09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTp0W2VdPXIsdH1mdW5jdGlvbiBzKHQsZSl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUmJm51bGwhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7dC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnQsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJwcm90b3R5cGUiLHt3cml0YWJsZTohMX0pLGUmJmModCxlKX1mdW5jdGlvbiB1KHQpe3JldHVybih1PU9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3QuZ2V0UHJvdG90eXBlT2YuYmluZCgpOmZ1bmN0aW9uKHQpe3JldHVybiB0Ll9fcHJvdG9fX3x8T2JqZWN0LmdldFByb3RvdHlwZU9mKHQpfSkodCl9ZnVuY3Rpb24gYyh0LGUpe3JldHVybihjPU9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQuX19wcm90b19fPWUsdH0pKHQsZSl9ZnVuY3Rpb24gZigpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgUmVmbGVjdHx8IVJlZmxlY3QuY29uc3RydWN0KXJldHVybiExO2lmKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pcmV0dXJuITE7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFByb3h5KXJldHVybiEwO3RyeXtyZXR1cm4gQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sW10sKGZ1bmN0aW9uKCl7fSkpKSwhMH1jYXRjaCh0KXtyZXR1cm4hMX19ZnVuY3Rpb24gbCh0LGUscil7cmV0dXJuKGw9ZigpP1JlZmxlY3QuY29uc3RydWN0LmJpbmQoKTpmdW5jdGlvbih0LGUscil7dmFyIG49W251bGxdO24ucHVzaC5hcHBseShuLGUpO3ZhciBpPW5ldyhGdW5jdGlvbi5iaW5kLmFwcGx5KHQsbikpO3JldHVybiByJiZjKGksci5wcm90b3R5cGUpLGl9KS5hcHBseShudWxsLGFyZ3VtZW50cyl9ZnVuY3Rpb24gZCh0LGUpe2lmKGUmJigib2JqZWN0Ij09dHlwZW9mIGV8fCJmdW5jdGlvbiI9PXR5cGVvZiBlKSlyZXR1cm4gZTtpZih2b2lkIDAhPT1lKXRocm93IG5ldyBUeXBlRXJyb3IoIkRlcml2ZWQgY29uc3RydWN0b3JzIG1heSBvbmx5IHJldHVybiBvYmplY3Qgb3IgdW5kZWZpbmVkIik7cmV0dXJuIGZ1bmN0aW9uKHQpe2lmKHZvaWQgMD09PXQpdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTtyZXR1cm4gdH0odCl9ZnVuY3Rpb24gaCh0KXt2YXIgZT1mKCk7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIHIsbj11KHQpO2lmKGUpe3ZhciBpPXUodGhpcykuY29uc3RydWN0b3I7cj1SZWZsZWN0LmNvbnN0cnVjdChuLGFyZ3VtZW50cyxpKX1lbHNlIHI9bi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIGQodGhpcyxyKX19ZnVuY3Rpb24gcCh0LGUpe2Zvcig7IU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LGUpJiZudWxsIT09KHQ9dSh0KSk7KTtyZXR1cm4gdH1mdW5jdGlvbiB2KCl7cmV0dXJuIHY9InVuZGVmaW5lZCIhPXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmdldD9SZWZsZWN0LmdldC5iaW5kKCk6ZnVuY3Rpb24odCxlLHIpe3ZhciBuPXAodCxlKTtpZihuKXt2YXIgaT1PYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG4sZSk7cmV0dXJuIGkuZ2V0P2kuZ2V0LmNhbGwoYXJndW1lbnRzLmxlbmd0aDwzP3Q6cik6aS52YWx1ZX19LHYuYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIHkodCl7dmFyIGU9ZnVuY3Rpb24odCxlKXtpZigib2JqZWN0IiE9dHlwZW9mIHR8fG51bGw9PT10KXJldHVybiB0O3ZhciByPXRbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZih2b2lkIDAhPT1yKXt2YXIgbj1yLmNhbGwodCxlfHwiZGVmYXVsdCIpO2lmKCJvYmplY3QiIT10eXBlb2YgbilyZXR1cm4gbjt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpfXJldHVybigic3RyaW5nIj09PWU/U3RyaW5nOk51bWJlcikodCl9KHQsInN0cmluZyIpO3JldHVybiJzeW1ib2wiPT10eXBlb2YgZT9lOlN0cmluZyhlKX1mdW5jdGlvbiBnKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9ZnVuY3Rpb24gbSh0LGUpe2Zvcih2YXIgcj0wO3I8ZS5sZW5ndGg7cisrKXt2YXIgbj1lW3JdO24uZW51bWVyYWJsZT1uLmVudW1lcmFibGV8fCExLG4uY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiBuJiYobi53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsbi5rZXksbil9fWZ1bmN0aW9uIGIodCxlLHIpe3JldHVybiBlJiZtKHQucHJvdG90eXBlLGUpLHImJm0odCxyKSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCwicHJvdG90eXBlIix7d3JpdGFibGU6ITF9KSx0fWZ1bmN0aW9uIHcodCxlLHIpe3JldHVybiBlIGluIHQ/T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOnRbZV09cix0fWZ1bmN0aW9uIGsodCxlKXtyZXR1cm4gZnVuY3Rpb24odCl7aWYoQXJyYXkuaXNBcnJheSh0KSlyZXR1cm4gdH0odCl8fGZ1bmN0aW9uKHQsZSl7dmFyIHI9bnVsbD09dD9udWxsOiJ1bmRlZmluZWQiIT10eXBlb2YgU3ltYm9sJiZ0W1N5bWJvbC5pdGVyYXRvcl18fHRbIkBAaXRlcmF0b3IiXTtpZihudWxsPT1yKXJldHVybjt2YXIgbixpLGE9W10sbz0hMCxzPSExO3RyeXtmb3Iocj1yLmNhbGwodCk7IShvPShuPXIubmV4dCgpKS5kb25lKSYmKGEucHVzaChuLnZhbHVlKSwhZXx8YS5sZW5ndGghPT1lKTtvPSEwKTt9Y2F0Y2godSl7cz0hMCxpPXV9ZmluYWxseXt0cnl7b3x8bnVsbD09ci5yZXR1cm58fHIucmV0dXJuKCl9ZmluYWxseXtpZihzKXRocm93IGl9fXJldHVybiBhfSh0LGUpfHxBKHQsZSl8fGZ1bmN0aW9uKCl7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiB4KHQpe3JldHVybiBmdW5jdGlvbih0KXtpZihBcnJheS5pc0FycmF5KHQpKXJldHVybiBTKHQpfSh0KXx8ZnVuY3Rpb24odCl7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJm51bGwhPXRbU3ltYm9sLml0ZXJhdG9yXXx8bnVsbCE9dFsiQEBpdGVyYXRvciJdKXJldHVybiBBcnJheS5mcm9tKHQpfSh0KXx8QSh0KXx8ZnVuY3Rpb24oKXt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX0oKX1mdW5jdGlvbiBBKHQsZSl7aWYodCl7aWYoInN0cmluZyI9PXR5cGVvZiB0KXJldHVybiBTKHQsZSk7dmFyIHI9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpLnNsaWNlKDgsLTEpO3JldHVybiJPYmplY3QiPT09ciYmdC5jb25zdHJ1Y3RvciYmKHI9dC5jb25zdHJ1Y3Rvci5uYW1lKSwiTWFwIj09PXJ8fCJTZXQiPT09cj9BcnJheS5mcm9tKHQpOiJBcmd1bWVudHMiPT09cnx8L14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3Qocik/Uyh0LGUpOnZvaWQgMH19ZnVuY3Rpb24gUyh0LGUpeyhudWxsPT1lfHxlPnQubGVuZ3RoKSYmKGU9dC5sZW5ndGgpO2Zvcih2YXIgcj0wLG49bmV3IEFycmF5KGUpO3I8ZTtyKyspbltyXT10W3JdO3JldHVybiBufXZhciBfPSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e30sVD1mdW5jdGlvbih0KXtyZXR1cm4gdCYmdC5NYXRoPT1NYXRoJiZ0fSxFPVQoIm9iamVjdCI9PSgidW5kZWZpbmVkIj09dHlwZW9mIGdsb2JhbFRoaXM/InVuZGVmaW5lZCI6cihnbG9iYWxUaGlzKSkmJmdsb2JhbFRoaXMpfHxUKCJvYmplY3QiPT0oInVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3c/InVuZGVmaW5lZCI6cih3aW5kb3cpKSYmd2luZG93KXx8VCgib2JqZWN0Ij09KCJ1bmRlZmluZWQiPT10eXBlb2Ygc2VsZj8idW5kZWZpbmVkIjpyKHNlbGYpKSYmc2VsZil8fFQoIm9iamVjdCI9PXIoXykmJl8pfHxmdW5jdGlvbigpe3JldHVybiB0aGlzfSgpfHxGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpLEk9e30sTz1mdW5jdGlvbih0KXt0cnl7cmV0dXJuISF0KCl9Y2F0Y2goZSl7cmV0dXJuITB9fSxNPSFPKChmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkoe30sMSx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIDd9fSlbMV19KSksQz17fSxSPXt9LnByb3BlcnR5SXNFbnVtZXJhYmxlLEI9T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcixQPUImJiFSLmNhbGwoezE6Mn0sMSk7Qy5mPVA/ZnVuY3Rpb24odCl7dmFyIGU9Qih0aGlzLHQpO3JldHVybiEhZSYmZS5lbnVtZXJhYmxlfTpSO3ZhciBVPWZ1bmN0aW9uKHQsZSl7cmV0dXJue2VudW1lcmFibGU6ISgxJnQpLGNvbmZpZ3VyYWJsZTohKDImdCksd3JpdGFibGU6ISg0JnQpLHZhbHVlOmV9fSxEPXt9LnRvU3RyaW5nLHo9ZnVuY3Rpb24odCl7cmV0dXJuIEQuY2FsbCh0KS5zbGljZSg4LC0xKX0saj16LEw9IiIuc3BsaXQsRj1PKChmdW5jdGlvbigpe3JldHVybiFPYmplY3QoInoiKS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgwKX0pKT9mdW5jdGlvbih0KXtyZXR1cm4iU3RyaW5nIj09aih0KT9MLmNhbGwodCwiIik6T2JqZWN0KHQpfTpPYmplY3QsTj1mdW5jdGlvbih0KXtpZihudWxsPT10KXRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIit0KTtyZXR1cm4gdH0sVj1GLEg9TixZPWZ1bmN0aW9uKHQpe3JldHVybiBWKEgodCkpfSxLPWZ1bmN0aW9uKHQpe3JldHVybiJvYmplY3QiPT09cih0KT9udWxsIT09dDoiZnVuY3Rpb24iPT10eXBlb2YgdH0sVz1LLEc9ZnVuY3Rpb24odCxlKXtpZighVyh0KSlyZXR1cm4gdDt2YXIgcixuO2lmKGUmJiJmdW5jdGlvbiI9PXR5cGVvZihyPXQudG9TdHJpbmcpJiYhVyhuPXIuY2FsbCh0KSkpcmV0dXJuIG47aWYoImZ1bmN0aW9uIj09dHlwZW9mKHI9dC52YWx1ZU9mKSYmIVcobj1yLmNhbGwodCkpKXJldHVybiBuO2lmKCFlJiYiZnVuY3Rpb24iPT10eXBlb2Yocj10LnRvU3RyaW5nKSYmIVcobj1yLmNhbGwodCkpKXJldHVybiBuO3Rocm93IFR5cGVFcnJvcigiQ2FuJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlIil9LHE9TixYPWZ1bmN0aW9uKHQpe3JldHVybiBPYmplY3QocSh0KSl9LCQ9WCxRPXt9Lmhhc093blByb3BlcnR5LFo9ZnVuY3Rpb24odCxlKXtyZXR1cm4gUS5jYWxsKCQodCksZSl9LEo9Syx0dD1FLmRvY3VtZW50LGV0PUoodHQpJiZKKHR0LmNyZWF0ZUVsZW1lbnQpLHJ0PWZ1bmN0aW9uKHQpe3JldHVybiBldD90dC5jcmVhdGVFbGVtZW50KHQpOnt9fSxudD1ydCxpdD0hTSYmIU8oKGZ1bmN0aW9uKCl7cmV0dXJuIDchPU9iamVjdC5kZWZpbmVQcm9wZXJ0eShudCgiZGl2IiksImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KS5hfSkpLGF0PU0sb3Q9QyxzdD1VLHV0PVksY3Q9RyxmdD1aLGx0PWl0LGR0PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7SS5mPWF0P2R0OmZ1bmN0aW9uKHQsZSl7aWYodD11dCh0KSxlPWN0KGUsITApLGx0KXRyeXtyZXR1cm4gZHQodCxlKX1jYXRjaChyKXt9aWYoZnQodCxlKSlyZXR1cm4gc3QoIW90LmYuY2FsbCh0LGUpLHRbZV0pfTt2YXIgaHQ9e30scHQ9Syx2dD1mdW5jdGlvbih0KXtpZighcHQodCkpdGhyb3cgVHlwZUVycm9yKFN0cmluZyh0KSsiIGlzIG5vdCBhbiBvYmplY3QiKTtyZXR1cm4gdH0seXQ9TSxndD1pdCxtdD12dCxidD1HLHd0PU9iamVjdC5kZWZpbmVQcm9wZXJ0eTtodC5mPXl0P3d0OmZ1bmN0aW9uKHQsZSxyKXtpZihtdCh0KSxlPWJ0KGUsITApLG10KHIpLGd0KXRyeXtyZXR1cm4gd3QodCxlLHIpfWNhdGNoKG4pe31pZigiZ2V0ImluIHJ8fCJzZXQiaW4gcil0aHJvdyBUeXBlRXJyb3IoIkFjY2Vzc29ycyBub3Qgc3VwcG9ydGVkIik7cmV0dXJuInZhbHVlImluIHImJih0W2VdPXIudmFsdWUpLHR9O3ZhciBrdD1odCx4dD1VLEF0PU0/ZnVuY3Rpb24odCxlLHIpe3JldHVybiBrdC5mKHQsZSx4dCgxLHIpKX06ZnVuY3Rpb24odCxlLHIpe3JldHVybiB0W2VdPXIsdH0sU3Q9e2V4cG9ydHM6e319LF90PUUsVHQ9QXQsRXQ9ZnVuY3Rpb24odCxlKXt0cnl7VHQoX3QsdCxlKX1jYXRjaChyKXtfdFt0XT1lfXJldHVybiBlfSxJdD1FdCxPdD0iX19jb3JlLWpzX3NoYXJlZF9fIixNdD1FW090XXx8SXQoT3Qse30pLEN0PU10LFJ0PUZ1bmN0aW9uLnRvU3RyaW5nOyJmdW5jdGlvbiIhPXR5cGVvZiBDdC5pbnNwZWN0U291cmNlJiYoQ3QuaW5zcGVjdFNvdXJjZT1mdW5jdGlvbih0KXtyZXR1cm4gUnQuY2FsbCh0KX0pO3ZhciBCdD1DdC5pbnNwZWN0U291cmNlLFB0PUJ0LFV0PUUuV2Vha01hcCxEdD0iZnVuY3Rpb24iPT10eXBlb2YgVXQmJi9uYXRpdmUgY29kZS8udGVzdChQdChVdCkpLHp0PXtleHBvcnRzOnt9fSxqdD1NdDsoenQuZXhwb3J0cz1mdW5jdGlvbih0LGUpe3JldHVybiBqdFt0XXx8KGp0W3RdPXZvaWQgMCE9PWU/ZTp7fSl9KSgidmVyc2lvbnMiLFtdKS5wdXNoKHt2ZXJzaW9uOiIzLjEyLjEiLG1vZGU6Imdsb2JhbCIsY29weXJpZ2h0OiLCqSAyMDIxIERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpIn0pO3ZhciBMdCxGdCxOdCxWdD0wLEh0PU1hdGgucmFuZG9tKCksWXQ9ZnVuY3Rpb24odCl7cmV0dXJuIlN5bWJvbCgiK1N0cmluZyh2b2lkIDA9PT10PyIiOnQpKyIpXyIrKCsrVnQrSHQpLnRvU3RyaW5nKDM2KX0sS3Q9enQuZXhwb3J0cyxXdD1ZdCxHdD1LdCgia2V5cyIpLHF0PWZ1bmN0aW9uKHQpe3JldHVybiBHdFt0XXx8KEd0W3RdPVd0KHQpKX0sWHQ9e30sJHQ9RHQsUXQ9SyxadD1BdCxKdD1aLHRlPU10LGVlPXF0LHJlPVh0LG5lPSJPYmplY3QgYWxyZWFkeSBpbml0aWFsaXplZCIsaWU9RS5XZWFrTWFwO2lmKCR0fHx0ZS5zdGF0ZSl7dmFyIGFlPXRlLnN0YXRlfHwodGUuc3RhdGU9bmV3IGllKSxvZT1hZS5nZXQsc2U9YWUuaGFzLHVlPWFlLnNldDtMdD1mdW5jdGlvbih0LGUpe2lmKHNlLmNhbGwoYWUsdCkpdGhyb3cgbmV3IFR5cGVFcnJvcihuZSk7cmV0dXJuIGUuZmFjYWRlPXQsdWUuY2FsbChhZSx0LGUpLGV9LEZ0PWZ1bmN0aW9uKHQpe3JldHVybiBvZS5jYWxsKGFlLHQpfHx7fX0sTnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHNlLmNhbGwoYWUsdCl9fWVsc2V7dmFyIGNlPWVlKCJzdGF0ZSIpO3JlW2NlXT0hMCxMdD1mdW5jdGlvbih0LGUpe2lmKEp0KHQsY2UpKXRocm93IG5ldyBUeXBlRXJyb3IobmUpO3JldHVybiBlLmZhY2FkZT10LFp0KHQsY2UsZSksZX0sRnQ9ZnVuY3Rpb24odCl7cmV0dXJuIEp0KHQsY2UpP3RbY2VdOnt9fSxOdD1mdW5jdGlvbih0KXtyZXR1cm4gSnQodCxjZSl9fXZhciBmZT17c2V0Okx0LGdldDpGdCxoYXM6TnQsZW5mb3JjZTpmdW5jdGlvbih0KXtyZXR1cm4gTnQodCk/RnQodCk6THQodCx7fSl9LGdldHRlckZvcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI7aWYoIVF0KGUpfHwocj1GdChlKSkudHlwZSE9PXQpdGhyb3cgVHlwZUVycm9yKCJJbmNvbXBhdGlibGUgcmVjZWl2ZXIsICIrdCsiIHJlcXVpcmVkIik7cmV0dXJuIHJ9fX0sbGU9RSxkZT1BdCxoZT1aLHBlPUV0LHZlPUJ0LHllPWZlLmdldCxnZT1mZS5lbmZvcmNlLG1lPVN0cmluZyhTdHJpbmcpLnNwbGl0KCJTdHJpbmciKTsoU3QuZXhwb3J0cz1mdW5jdGlvbih0LGUscixuKXt2YXIgaSxhPSEhbiYmISFuLnVuc2FmZSxvPSEhbiYmISFuLmVudW1lcmFibGUscz0hIW4mJiEhbi5ub1RhcmdldEdldDsiZnVuY3Rpb24iPT10eXBlb2YgciYmKCJzdHJpbmciIT10eXBlb2YgZXx8aGUociwibmFtZSIpfHxkZShyLCJuYW1lIixlKSwoaT1nZShyKSkuc291cmNlfHwoaS5zb3VyY2U9bWUuam9pbigic3RyaW5nIj09dHlwZW9mIGU/ZToiIikpKSx0IT09bGU/KGE/IXMmJnRbZV0mJihvPSEwKTpkZWxldGUgdFtlXSxvP3RbZV09cjpkZSh0LGUscikpOm8/dFtlXT1yOnBlKGUscil9KShGdW5jdGlvbi5wcm90b3R5cGUsInRvU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdGhpcyYmeWUodGhpcykuc291cmNlfHx2ZSh0aGlzKX0pKTt2YXIgYmU9RSx3ZT1FLGtlPWZ1bmN0aW9uKHQpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6dm9pZCAwfSx4ZT1mdW5jdGlvbih0LGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/a2UoYmVbdF0pfHxrZSh3ZVt0XSk6YmVbdF0mJmJlW3RdW2VdfHx3ZVt0XSYmd2VbdF1bZV19LEFlPXt9LFNlPU1hdGguY2VpbCxfZT1NYXRoLmZsb29yLFRlPWZ1bmN0aW9uKHQpe3JldHVybiBpc05hTih0PSt0KT8wOih0PjA/X2U6U2UpKHQpfSxFZT1UZSxJZT1NYXRoLm1pbixPZT1mdW5jdGlvbih0KXtyZXR1cm4gdD4wP0llKEVlKHQpLDkwMDcxOTkyNTQ3NDA5OTEpOjB9LE1lPVRlLENlPU1hdGgubWF4LFJlPU1hdGgubWluLEJlPWZ1bmN0aW9uKHQsZSl7dmFyIHI9TWUodCk7cmV0dXJuIHI8MD9DZShyK2UsMCk6UmUocixlKX0sUGU9WSxVZT1PZSxEZT1CZSx6ZT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyLG4pe3ZhciBpLGE9UGUoZSksbz1VZShhLmxlbmd0aCkscz1EZShuLG8pO2lmKHQmJnIhPXIpe2Zvcig7bz5zOylpZigoaT1hW3MrK10pIT1pKXJldHVybiEwfWVsc2UgZm9yKDtvPnM7cysrKWlmKCh0fHxzIGluIGEpJiZhW3NdPT09cilyZXR1cm4gdHx8c3x8MDtyZXR1cm4hdCYmLTF9fSxqZT17aW5jbHVkZXM6emUoITApLGluZGV4T2Y6emUoITEpfSxMZT1aLEZlPVksTmU9amUuaW5kZXhPZixWZT1YdCxIZT1mdW5jdGlvbih0LGUpe3ZhciByLG49RmUodCksaT0wLGE9W107Zm9yKHIgaW4gbikhTGUoVmUscikmJkxlKG4scikmJmEucHVzaChyKTtmb3IoO2UubGVuZ3RoPmk7KUxlKG4scj1lW2krK10pJiYofk5lKGEscil8fGEucHVzaChyKSk7cmV0dXJuIGF9LFllPVsiY29uc3RydWN0b3IiLCJoYXNPd25Qcm9wZXJ0eSIsImlzUHJvdG90eXBlT2YiLCJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsInRvTG9jYWxlU3RyaW5nIiwidG9TdHJpbmciLCJ2YWx1ZU9mIl0sS2U9SGUsV2U9WWUuY29uY2F0KCJsZW5ndGgiLCJwcm90b3R5cGUiKTtBZS5mPU9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzfHxmdW5jdGlvbih0KXtyZXR1cm4gS2UodCxXZSl9O3ZhciBHZT17fTtHZS5mPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7dmFyIHFlLFhlLCRlPUFlLFFlPUdlLFplPXZ0LEplPXhlKCJSZWZsZWN0Iiwib3duS2V5cyIpfHxmdW5jdGlvbih0KXt2YXIgZT0kZS5mKFplKHQpKSxyPVFlLmY7cmV0dXJuIHI/ZS5jb25jYXQocih0KSk6ZX0sdHI9Wixlcj1KZSxycj1JLG5yPWh0LGlyPU8sYXI9LyN8XC5wcm90b3R5cGVcLi8sb3I9ZnVuY3Rpb24odCxlKXt2YXIgcj11cltzcih0KV07cmV0dXJuIHI9PWZyfHxyIT1jciYmKCJmdW5jdGlvbiI9PXR5cGVvZiBlP2lyKGUpOiEhZSl9LHNyPW9yLm5vcm1hbGl6ZT1mdW5jdGlvbih0KXtyZXR1cm4gU3RyaW5nKHQpLnJlcGxhY2UoYXIsIi4iKS50b0xvd2VyQ2FzZSgpfSx1cj1vci5kYXRhPXt9LGNyPW9yLk5BVElWRT0iTiIsZnI9b3IuUE9MWUZJTEw9IlAiLGxyPW9yLGRyPUUsaHI9SS5mLHByPUF0LHZyPVN0LmV4cG9ydHMseXI9RXQsZ3I9ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9ZXIoZSksbj1uci5mLGk9cnIuZixhPTA7YTxyLmxlbmd0aDthKyspe3ZhciBvPXJbYV07dHIodCxvKXx8bih0LG8saShlLG8pKX19LG1yPWxyLGJyPWZ1bmN0aW9uKHQsZSl7dmFyIG4saSxhLG8scyx1PXQudGFyZ2V0LGM9dC5nbG9iYWwsZj10LnN0YXQ7aWYobj1jP2RyOmY/ZHJbdV18fHlyKHUse30pOihkclt1XXx8e30pLnByb3RvdHlwZSlmb3IoaSBpbiBlKXtpZihvPWVbaV0sYT10Lm5vVGFyZ2V0R2V0PyhzPWhyKG4saSkpJiZzLnZhbHVlOm5baV0sIW1yKGM/aTp1KyhmPyIuIjoiIyIpK2ksdC5mb3JjZWQpJiZ2b2lkIDAhPT1hKXtpZihyKG8pPT09cihhKSljb250aW51ZTtncihvLGEpfSh0LnNoYW18fGEmJmEuc2hhbSkmJnByKG8sInNoYW0iLCEwKSx2cihuLGksbyx0KX19LHdyPXosa3I9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24odCl7cmV0dXJuIkFycmF5Ij09d3IodCl9LHhyPUcsQXI9aHQsU3I9VSxfcj1mdW5jdGlvbih0LGUscil7dmFyIG49eHIoZSk7biBpbiB0P0FyLmYodCxuLFNyKDAscikpOnRbbl09cn0sVHI9eGUoIm5hdmlnYXRvciIsInVzZXJBZ2VudCIpfHwiIixFcj1UcixJcj1FLnByb2Nlc3MsT3I9SXImJklyLnZlcnNpb25zLE1yPU9yJiZPci52ODtNcj9YZT0ocWU9TXIuc3BsaXQoIi4iKSlbMF08ND8xOnFlWzBdK3FlWzFdOkVyJiYoIShxZT1Fci5tYXRjaCgvRWRnZVwvKFxkKykvKSl8fHFlWzFdPj03NCkmJihxZT1Fci5tYXRjaCgvQ2hyb21lXC8oXGQrKS8pKSYmKFhlPXFlWzFdKTt2YXIgQ3I9WGUmJitYZSxScj1DcixCcj1PLFByPSEhT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyYmIUJyKChmdW5jdGlvbigpe3JldHVybiFTdHJpbmcoU3ltYm9sKCkpfHwhU3ltYm9sLnNoYW0mJlJyJiZScjw0MX0pKSxVcj1QciYmIVN5bWJvbC5zaGFtJiYic3ltYm9sIj09cihTeW1ib2wuaXRlcmF0b3IpLERyPUUsenI9enQuZXhwb3J0cyxqcj1aLExyPVl0LEZyPVByLE5yPVVyLFZyPXpyKCJ3a3MiKSxIcj1Eci5TeW1ib2wsWXI9TnI/SHI6SHImJkhyLndpdGhvdXRTZXR0ZXJ8fExyLEtyPWZ1bmN0aW9uKHQpe3JldHVybiBqcihWcix0KSYmKEZyfHwic3RyaW5nIj09dHlwZW9mIFZyW3RdKXx8KEZyJiZqcihIcix0KT9Wclt0XT1Iclt0XTpWclt0XT1ZcigiU3ltYm9sLiIrdCkpLFZyW3RdfSxXcj1LLEdyPWtyLHFyPUtyKCJzcGVjaWVzIiksWHI9ZnVuY3Rpb24odCxlKXt2YXIgcjtyZXR1cm4gR3IodCkmJigiZnVuY3Rpb24iIT10eXBlb2Yocj10LmNvbnN0cnVjdG9yKXx8ciE9PUFycmF5JiYhR3Ioci5wcm90b3R5cGUpP1dyKHIpJiZudWxsPT09KHI9cltxcl0pJiYocj12b2lkIDApOnI9dm9pZCAwKSxuZXcodm9pZCAwPT09cj9BcnJheTpyKSgwPT09ZT8wOmUpfSwkcj1PLFFyPUNyLFpyPUtyKCJzcGVjaWVzIiksSnI9ZnVuY3Rpb24odCl7cmV0dXJuIFFyPj01MXx8ISRyKChmdW5jdGlvbigpe3ZhciBlPVtdO3JldHVybihlLmNvbnN0cnVjdG9yPXt9KVtacl09ZnVuY3Rpb24oKXtyZXR1cm57Zm9vOjF9fSwxIT09ZVt0XShCb29sZWFuKS5mb299KSl9LHRuPWJyLGVuPU8scm49a3Isbm49Syxhbj1YLG9uPU9lLHNuPV9yLHVuPVhyLGNuPUpyLGZuPUNyLGxuPUtyKCJpc0NvbmNhdFNwcmVhZGFibGUiKSxkbj05MDA3MTk5MjU0NzQwOTkxLGhuPSJNYXhpbXVtIGFsbG93ZWQgaW5kZXggZXhjZWVkZWQiLHBuPWZuPj01MXx8IWVuKChmdW5jdGlvbigpe3ZhciB0PVtdO3JldHVybiB0W2xuXT0hMSx0LmNvbmNhdCgpWzBdIT09dH0pKSx2bj1jbigiY29uY2F0IikseW49ZnVuY3Rpb24odCl7aWYoIW5uKHQpKXJldHVybiExO3ZhciBlPXRbbG5dO3JldHVybiB2b2lkIDAhPT1lPyEhZTpybih0KX07dG4oe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDohcG58fCF2bn0se2NvbmNhdDpmdW5jdGlvbih0KXt2YXIgZSxyLG4saSxhLG89YW4odGhpcykscz11bihvLDApLHU9MDtmb3IoZT0tMSxuPWFyZ3VtZW50cy5sZW5ndGg7ZTxuO2UrKylpZih5bihhPS0xPT09ZT9vOmFyZ3VtZW50c1tlXSkpe2lmKHUrKGk9b24oYS5sZW5ndGgpKT5kbil0aHJvdyBUeXBlRXJyb3IoaG4pO2ZvcihyPTA7cjxpO3IrKyx1KyspciBpbiBhJiZzbihzLHUsYVtyXSl9ZWxzZXtpZih1Pj1kbil0aHJvdyBUeXBlRXJyb3IoaG4pO3NuKHMsdSsrLGEpfXJldHVybiBzLmxlbmd0aD11LHN9fSk7dmFyIGduPXt9O2duW0tyKCJ0b1N0cmluZ1RhZyIpXT0ieiI7dmFyIG1uPSJbb2JqZWN0IHpdIj09PVN0cmluZyhnbiksYm49bW4sd249eixrbj1LcigidG9TdHJpbmdUYWciKSx4bj0iQXJndW1lbnRzIj09d24oZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzfSgpKSxBbj1ibj93bjpmdW5jdGlvbih0KXt2YXIgZSxyLG47cmV0dXJuIHZvaWQgMD09PXQ/IlVuZGVmaW5lZCI6bnVsbD09PXQ/Ik51bGwiOiJzdHJpbmciPT10eXBlb2Yocj1mdW5jdGlvbih0LGUpe3RyeXtyZXR1cm4gdFtlXX1jYXRjaChyKXt9fShlPU9iamVjdCh0KSxrbikpP3I6eG4/d24oZSk6Ik9iamVjdCI9PShuPXduKGUpKSYmImZ1bmN0aW9uIj09dHlwZW9mIGUuY2FsbGVlPyJBcmd1bWVudHMiOm59LFNuPUFuLF9uPW1uP3t9LnRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIltvYmplY3QgIitTbih0aGlzKSsiXSJ9LFRuPW1uLEVuPVN0LmV4cG9ydHMsSW49X247VG58fEVuKE9iamVjdC5wcm90b3R5cGUsInRvU3RyaW5nIixJbix7dW5zYWZlOiEwfSk7dmFyIE9uPXtDU1NSdWxlTGlzdDowLENTU1N0eWxlRGVjbGFyYXRpb246MCxDU1NWYWx1ZUxpc3Q6MCxDbGllbnRSZWN0TGlzdDowLERPTVJlY3RMaXN0OjAsRE9NU3RyaW5nTGlzdDowLERPTVRva2VuTGlzdDoxLERhdGFUcmFuc2Zlckl0ZW1MaXN0OjAsRmlsZUxpc3Q6MCxIVE1MQWxsQ29sbGVjdGlvbjowLEhUTUxDb2xsZWN0aW9uOjAsSFRNTEZvcm1FbGVtZW50OjAsSFRNTFNlbGVjdEVsZW1lbnQ6MCxNZWRpYUxpc3Q6MCxNaW1lVHlwZUFycmF5OjAsTmFtZWROb2RlTWFwOjAsTm9kZUxpc3Q6MSxQYWludFJlcXVlc3RMaXN0OjAsUGx1Z2luOjAsUGx1Z2luQXJyYXk6MCxTVkdMZW5ndGhMaXN0OjAsU1ZHTnVtYmVyTGlzdDowLFNWR1BhdGhTZWdMaXN0OjAsU1ZHUG9pbnRMaXN0OjAsU1ZHU3RyaW5nTGlzdDowLFNWR1RyYW5zZm9ybUxpc3Q6MCxTb3VyY2VCdWZmZXJMaXN0OjAsU3R5bGVTaGVldExpc3Q6MCxUZXh0VHJhY2tDdWVMaXN0OjAsVGV4dFRyYWNrTGlzdDowLFRvdWNoTGlzdDowfSxNbj1mdW5jdGlvbih0KXtpZigiZnVuY3Rpb24iIT10eXBlb2YgdCl0aHJvdyBUeXBlRXJyb3IoU3RyaW5nKHQpKyIgaXMgbm90IGEgZnVuY3Rpb24iKTtyZXR1cm4gdH0sQ249TW4sUm49ZnVuY3Rpb24odCxlLHIpe2lmKENuKHQpLHZvaWQgMD09PWUpcmV0dXJuIHQ7c3dpdGNoKHIpe2Nhc2UgMDpyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdC5jYWxsKGUpfTtjYXNlIDE6cmV0dXJuIGZ1bmN0aW9uKHIpe3JldHVybiB0LmNhbGwoZSxyKX07Y2FzZSAyOnJldHVybiBmdW5jdGlvbihyLG4pe3JldHVybiB0LmNhbGwoZSxyLG4pfTtjYXNlIDM6cmV0dXJuIGZ1bmN0aW9uKHIsbixpKXtyZXR1cm4gdC5jYWxsKGUscixuLGkpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdC5hcHBseShlLGFyZ3VtZW50cyl9fSxCbj1SbixQbj1GLFVuPVgsRG49T2Usem49WHIsam49W10ucHVzaCxMbj1mdW5jdGlvbih0KXt2YXIgZT0xPT10LHI9Mj09dCxuPTM9PXQsaT00PT10LGE9Nj09dCxvPTc9PXQscz01PT10fHxhO3JldHVybiBmdW5jdGlvbih1LGMsZixsKXtmb3IodmFyIGQsaCxwPVVuKHUpLHY9UG4ocCkseT1CbihjLGYsMyksZz1Ebih2Lmxlbmd0aCksbT0wLGI9bHx8em4sdz1lP2IodSxnKTpyfHxvP2IodSwwKTp2b2lkIDA7Zz5tO20rKylpZigoc3x8bSBpbiB2KSYmKGg9eShkPXZbbV0sbSxwKSx0KSlpZihlKXdbbV09aDtlbHNlIGlmKGgpc3dpdGNoKHQpe2Nhc2UgMzpyZXR1cm4hMDtjYXNlIDU6cmV0dXJuIGQ7Y2FzZSA2OnJldHVybiBtO2Nhc2UgMjpqbi5jYWxsKHcsZCl9ZWxzZSBzd2l0Y2godCl7Y2FzZSA0OnJldHVybiExO2Nhc2UgNzpqbi5jYWxsKHcsZCl9cmV0dXJuIGE/LTE6bnx8aT9pOnd9fSxGbj17Zm9yRWFjaDpMbigwKSxtYXA6TG4oMSksZmlsdGVyOkxuKDIpLHNvbWU6TG4oMyksZXZlcnk6TG4oNCksZmluZDpMbig1KSxmaW5kSW5kZXg6TG4oNiksZmlsdGVyT3V0OkxuKDcpfSxObj1PLFZuPWZ1bmN0aW9uKHQsZSl7dmFyIHI9W11bdF07cmV0dXJuISFyJiZObigoZnVuY3Rpb24oKXtyLmNhbGwobnVsbCxlfHxmdW5jdGlvbigpe3Rocm93IDF9LDEpfSkpfSxIbj1Gbi5mb3JFYWNoLFluPVZuKCJmb3JFYWNoIik/W10uZm9yRWFjaDpmdW5jdGlvbih0KXtyZXR1cm4gSG4odGhpcyx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX0sS249RSxXbj1PbixHbj1Zbixxbj1BdDtmb3IodmFyIFhuIGluIFduKXt2YXIgJG49S25bWG5dLFFuPSRuJiYkbi5wcm90b3R5cGU7aWYoUW4mJlFuLmZvckVhY2ghPT1Hbil0cnl7cW4oUW4sImZvckVhY2giLEduKX1jYXRjaChfdil7UW4uZm9yRWFjaD1Hbn19dmFyIFpuPUZuLm1hcDticih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiFKcigibWFwIil9LHttYXA6ZnVuY3Rpb24odCl7cmV0dXJuIFpuKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIEpuLHRpPUhlLGVpPVllLHJpPU9iamVjdC5rZXlzfHxmdW5jdGlvbih0KXtyZXR1cm4gdGkodCxlaSl9LG5pPWh0LGlpPXZ0LGFpPXJpLG9pPU0/T2JqZWN0LmRlZmluZVByb3BlcnRpZXM6ZnVuY3Rpb24odCxlKXtpaSh0KTtmb3IodmFyIHIsbj1haShlKSxpPW4ubGVuZ3RoLGE9MDtpPmE7KW5pLmYodCxyPW5bYSsrXSxlW3JdKTtyZXR1cm4gdH0sc2k9eGUoImRvY3VtZW50IiwiZG9jdW1lbnRFbGVtZW50IiksdWk9dnQsY2k9b2ksZmk9WWUsbGk9WHQsZGk9c2ksaGk9cnQscGk9cXQoIklFX1BST1RPIiksdmk9ZnVuY3Rpb24oKXt9LHlpPWZ1bmN0aW9uKHQpe3JldHVybiI8c2NyaXB0PiIrdCsiPC8iKyJzY3JpcHQ+In0sZ2k9ZnVuY3Rpb24oKXt0cnl7Sm49ZG9jdW1lbnQuZG9tYWluJiZuZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKX1jYXRjaChfdil7fXZhciB0LGU7Z2k9Sm4/ZnVuY3Rpb24odCl7dC53cml0ZSh5aSgiIikpLHQuY2xvc2UoKTt2YXIgZT10LnBhcmVudFdpbmRvdy5PYmplY3Q7cmV0dXJuIHQ9bnVsbCxlfShKbik6KChlPWhpKCJpZnJhbWUiKSkuc3R5bGUuZGlzcGxheT0ibm9uZSIsZGkuYXBwZW5kQ2hpbGQoZSksZS5zcmM9U3RyaW5nKCJqYXZhc2NyaXB0OiIpLCh0PWUuY29udGVudFdpbmRvdy5kb2N1bWVudCkub3BlbigpLHQud3JpdGUoeWkoImRvY3VtZW50LkY9T2JqZWN0IikpLHQuY2xvc2UoKSx0LkYpO2Zvcih2YXIgcj1maS5sZW5ndGg7ci0tOylkZWxldGUgZ2kucHJvdG90eXBlW2ZpW3JdXTtyZXR1cm4gZ2koKX07bGlbcGldPSEwO3ZhciBtaT1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbih0LGUpe3ZhciByO3JldHVybiBudWxsIT09dD8odmkucHJvdG90eXBlPXVpKHQpLHI9bmV3IHZpLHZpLnByb3RvdHlwZT1udWxsLHJbcGldPXQpOnI9Z2koKSx2b2lkIDA9PT1lP3I6Y2kocixlKX0sYmk9bWksd2k9aHQsa2k9S3IoInVuc2NvcGFibGVzIikseGk9QXJyYXkucHJvdG90eXBlO251bGw9PXhpW2tpXSYmd2kuZih4aSxraSx7Y29uZmlndXJhYmxlOiEwLHZhbHVlOmJpKG51bGwpfSk7dmFyIEFpPWZ1bmN0aW9uKHQpe3hpW2tpXVt0XT0hMH0sU2k9amUuaW5jbHVkZXMsX2k9QWk7YnIoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwfSx7aW5jbHVkZXM6ZnVuY3Rpb24odCl7cmV0dXJuIFNpKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSksX2koImluY2x1ZGVzIik7dmFyIFRpPUssRWk9eixJaT1LcigibWF0Y2giKSxPaT1mdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4gVGkodCkmJih2b2lkIDAhPT0oZT10W0lpXSk/ISFlOiJSZWdFeHAiPT1FaSh0KSl9LE1pPUtyKCJtYXRjaCIpLENpPWZ1bmN0aW9uKHQpe2lmKE9pKHQpKXRocm93IFR5cGVFcnJvcigiVGhlIG1ldGhvZCBkb2Vzbid0IGFjY2VwdCByZWd1bGFyIGV4cHJlc3Npb25zIik7cmV0dXJuIHR9LFJpPU47YnIoe3RhcmdldDoiU3RyaW5nIixwcm90bzohMCxmb3JjZWQ6IWZ1bmN0aW9uKHQpe3ZhciBlPS8uLzt0cnl7Ii8uLyJbdF0oZSl9Y2F0Y2gocil7dHJ5e3JldHVybiBlW01pXT0hMSwiLy4vIlt0XShlKX1jYXRjaChuKXt9fXJldHVybiExfSgiaW5jbHVkZXMiKX0se2luY2x1ZGVzOmZ1bmN0aW9uKHQpe3JldHVybiEhflN0cmluZyhSaSh0aGlzKSkuaW5kZXhPZihDaSh0KSxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIEJpPUZuLmZpbHRlcjticih7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiFKcigiZmlsdGVyIil9LHtmaWx0ZXI6ZnVuY3Rpb24odCl7cmV0dXJuIEJpKHRoaXMsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9fSk7dmFyIFBpPSJ2aWRlbyIsVWk9ImF1ZGlvIixEaT0ibWV0YWRhdGEiLHppPSJhdmMiLGppPSJoZXZjIixMaT0iYWFjIixGaT0iZzcxMTBhIixOaT0iZzcxMTBtIixWaT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXtnKHRoaXMsdCksdyh0aGlzLCJpZCIsMSksdyh0aGlzLCJ0eXBlIixQaSksdyh0aGlzLCJjb2RlY1R5cGUiLHppKSx3KHRoaXMsInBpZCIsLTEpLHcodGhpcywiaHZjQyIsdm9pZCAwKSx3KHRoaXMsImNvZGVjIiwiIiksdyh0aGlzLCJ0aW1lc2NhbGUiLDApLHcodGhpcywiZm9ybWF0VGltZXNjYWxlIiwwKSx3KHRoaXMsInNlcXVlbmNlTnVtYmVyIiwwKSx3KHRoaXMsImJhc2VNZWRpYURlY29kZVRpbWUiLDApLHcodGhpcywiYmFzZUR0cyIsMCksdyh0aGlzLCJkdXJhdGlvbiIsMCksdyh0aGlzLCJ3YXJuaW5ncyIsW10pLHcodGhpcywic2FtcGxlcyIsW10pLHcodGhpcywicHBzIixbXSksdyh0aGlzLCJzcHMiLFtdKSx3KHRoaXMsInZwcyIsW10pLHcodGhpcywiZnBzTnVtIiwwKSx3KHRoaXMsImZwc0RlbiIsMCksdyh0aGlzLCJzYXJSYXRpbyIsW10pLHcodGhpcywid2lkdGgiLDApLHcodGhpcywiaGVpZ2h0IiwwKSx3KHRoaXMsIm5hbFVuaXRTaXplIiw0KSx3KHRoaXMsInByZXNlbnQiLCExKSx3KHRoaXMsImlzVmlkZW9FbmNyeXB0aW9uIiwhMSksdyh0aGlzLCJpc0F1ZGlvRW5jcnlwdGlvbiIsITEpLHcodGhpcywia2lkIixudWxsKSx3KHRoaXMsInBzc2giLG51bGwpLHcodGhpcywiZXh0Iix2b2lkIDApfXJldHVybiBiKHQsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuc2VxdWVuY2VOdW1iZXI9dGhpcy53aWR0aD10aGlzLmhlaWdodD10aGlzLmZwc0Rlbj10aGlzLmZwc051bT10aGlzLmR1cmF0aW9uPXRoaXMuYmFzZU1lZGlhRGVjb2RlVGltZT10aGlzLnRpbWVzY2FsZT0wLHRoaXMuY29kZWM9IiIsdGhpcy5wcmVzZW50PSExLHRoaXMucGlkPS0xLHRoaXMucHBzPVtdLHRoaXMuc3BzPVtdLHRoaXMudnBzPVtdLHRoaXMuc2FyUmF0aW89W10sdGhpcy5zYW1wbGVzPVtdLHRoaXMud2FybmluZ3M9W10sdGhpcy5odmNDPW51bGx9fSx7a2V5OiJleGlzdCIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hISh0aGlzLnBwcy5sZW5ndGgmJnRoaXMuc3BzLmxlbmd0aCYmdGhpcy5jb2RlYyl9fSx7a2V5OiJoYXNTYW1wbGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLnNhbXBsZXMubGVuZ3RofX1dKSx0fSgpLEhpPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe2codGhpcyx0KSx3KHRoaXMsImlkIiwyKSx3KHRoaXMsInR5cGUiLFVpKSx3KHRoaXMsImNvZGVjVHlwZSIsTGkpLHcodGhpcywicGlkIiwtMSksdyh0aGlzLCJjb2RlYyIsIiIpLHcodGhpcywic2VxdWVuY2VOdW1iZXIiLDApLHcodGhpcywic2FtcGxlRHVyYXRpb24iLDApLHcodGhpcywidGltZXNjYWxlIiwwKSx3KHRoaXMsImZvcm1hdFRpbWVzY2FsZSIsMCksdyh0aGlzLCJiYXNlTWVkaWFEZWNvZGVUaW1lIiwwKSx3KHRoaXMsImR1cmF0aW9uIiwwKSx3KHRoaXMsIndhcm5pbmdzIixbXSksdyh0aGlzLCJzYW1wbGVzIixbXSksdyh0aGlzLCJiYXNlRHRzIiwwKSx3KHRoaXMsInNhbXBsZVNpemUiLDE2KSx3KHRoaXMsInNhbXBsZVJhdGUiLDApLHcodGhpcywiY2hhbm5lbENvdW50IiwwKSx3KHRoaXMsIm9iamVjdFR5cGUiLDApLHcodGhpcywic2FtcGxlUmF0ZUluZGV4IiwwKSx3KHRoaXMsImNvbmZpZyIsW10pLHcodGhpcywicHJlc2VudCIsITEpLHcodGhpcywiaXNWaWRlb0VuY3J5cHRpb24iLCExKSx3KHRoaXMsImlzQXVkaW9FbmNyeXB0aW9uIiwhMSksdyh0aGlzLCJraWQiLG51bGwpLHcodGhpcywiZXh0Iix2b2lkIDApfXJldHVybiBiKHQsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuc2VxdWVuY2VOdW1iZXI9MCx0aGlzLnRpbWVzY2FsZT0wLHRoaXMuc2FtcGxlRHVyYXRpb249MCx0aGlzLnNhbXBsZVJhdGU9MCx0aGlzLmNoYW5uZWxDb3VudD0wLHRoaXMuYmFzZU1lZGlhRGVjb2RlVGltZT0wLHRoaXMucHJlc2VudD0hMSx0aGlzLnBpZD0tMSx0aGlzLmNvZGVjPSIiLHRoaXMuc2FtcGxlcz1bXSx0aGlzLmNvbmZpZz1bXSx0aGlzLndhcm5pbmdzPVtdfX0se2tleToiZXhpc3QiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISEodGhpcy5zYW1wbGVSYXRlJiZ0aGlzLmNoYW5uZWxDb3VudCYmdGhpcy5jb2RlYyYmdGhpcy5jb2RlY1R5cGU9PT1MaSl9fSx7a2V5OiJoYXNTYW1wbGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuISF0aGlzLnNhbXBsZXMubGVuZ3RofX1dKSx0fSgpLFlpPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlLHIsbil7Zyh0aGlzLHQpLHcodGhpcywiZmxhZyIse30pLHcodGhpcywia2V5ZnJhbWUiLCExKSx3KHRoaXMsImdvcElkIiwwKSx3KHRoaXMsImR1cmF0aW9uIiwwKSx3KHRoaXMsInNpemUiLDApLHcodGhpcywidW5pdHMiLFtdKSx3KHRoaXMsImNocm9tYUZvcm1hdCIsNDIwKSx0aGlzLm9yaWdpblB0cz10aGlzLnB0cz1lLHRoaXMub3JpZ2luRHRzPXRoaXMuZHRzPXIsbiYmKHRoaXMudW5pdHM9bil9cmV0dXJuIGIodCxbe2tleToiY3RzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdHMtdGhpcy5kdHN9fSx7a2V5OiJzZXRUb0tleWZyYW1lIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMua2V5ZnJhbWU9ITAsdGhpcy5mbGFnLmRlcGVuZHNPbj0yLHRoaXMuZmxhZy5pc05vblN5bmNTYW1wbGU9MH19XSksdH0oKSxLaT1iKChmdW5jdGlvbiB0KGUscixuLGkpe2codGhpcyx0KSx3KHRoaXMsImR1cmF0aW9uIiwxMDI0KSx3KHRoaXMsImZsYWciLHtkZXBlbmRzT246Mixpc05vblN5bmNTYW1wbGU6MH0pLHcodGhpcywia2V5ZnJhbWUiLCEwKSx0aGlzLm9yaWdpblB0cz10aGlzLnB0cz10aGlzLmR0cz1lLHRoaXMuZGF0YT1yLHRoaXMuc2l6ZT1yLmJ5dGVMZW5ndGgsdGhpcy5zYW1wbGVPZmZzZXQ9aSxuJiYodGhpcy5kdXJhdGlvbj1uKX0pKSxXaT1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXtnKHRoaXMsdCksdyh0aGlzLCJpZCIsMyksdyh0aGlzLCJ0eXBlIixEaSksdyh0aGlzLCJ0aW1lc2NhbGUiLDApLHcodGhpcywiZmx2U2NyaXB0U2FtcGxlcyIsW10pLHcodGhpcywic2VpU2FtcGxlcyIsW10pfXJldHVybiBiKHQsW3trZXk6ImV4aXN0Iix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiEoIXRoaXMuZmx2U2NyaXB0U2FtcGxlcy5sZW5ndGgmJiF0aGlzLnNlaVNhbXBsZXMubGVuZ3RofHwhdGhpcy50aW1lc2NhbGUpfX0se2tleToicmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy50aW1lc2NhbGU9MCx0aGlzLmZsdlNjcmlwdFNhbXBsZXM9W10sdGhpcy5zZWlTYW1wbGVzPVtdfX0se2tleToiaGFzU2FtcGxlIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiEoIXRoaXMuZmx2U2NyaXB0U2FtcGxlcy5sZW5ndGgmJiF0aGlzLnNlaVNhbXBsZXMubGVuZ3RoKX19XSksdH0oKSxHaT1LLHFpPXZ0LFhpPWZ1bmN0aW9uKHQpe2lmKCFHaSh0KSYmbnVsbCE9PXQpdGhyb3cgVHlwZUVycm9yKCJDYW4ndCBzZXQgIitTdHJpbmcodCkrIiBhcyBhIHByb3RvdHlwZSIpO3JldHVybiB0fSwkaT1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fCgiX19wcm90b19fImlue30/ZnVuY3Rpb24oKXt2YXIgdCxlPSExLHI9e307dHJ5eyh0PU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoT2JqZWN0LnByb3RvdHlwZSwiX19wcm90b19fIikuc2V0KS5jYWxsKHIsW10pLGU9ciBpbnN0YW5jZW9mIEFycmF5fWNhdGNoKF92KXt9cmV0dXJuIGZ1bmN0aW9uKHIsbil7cmV0dXJuIHFpKHIpLFhpKG4pLGU/dC5jYWxsKHIsbik6ci5fX3Byb3RvX189bixyfX0oKTp2b2lkIDApLFFpPUssWmk9JGksSmk9ZnVuY3Rpb24odCxlLHIpe3ZhciBuLGk7cmV0dXJuIFppJiYiZnVuY3Rpb24iPT10eXBlb2Yobj1lLmNvbnN0cnVjdG9yKSYmbiE9PXImJlFpKGk9bi5wcm90b3R5cGUpJiZpIT09ci5wcm90b3R5cGUmJlppKHQsaSksdH0sdGE9TixlYT0iW1x0XG5cdlxmXHIgwqDhmoDigIDigIHigILigIPigITigIXigIbigIfigIjigInigIrigK/igZ/jgIBcdTIwMjhcdTIwMjlcdWZlZmZdIixyYT1SZWdFeHAoIl4iK2VhK2VhKyIqIiksbmE9UmVnRXhwKGVhK2VhKyIqJCIpLGlhPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcj1TdHJpbmcodGEoZSkpO3JldHVybiAxJnQmJihyPXIucmVwbGFjZShyYSwiIikpLDImdCYmKHI9ci5yZXBsYWNlKG5hLCIiKSkscn19LGFhPXtzdGFydDppYSgxKSxlbmQ6aWEoMiksdHJpbTppYSgzKX0sb2E9TSxzYT1FLHVhPWxyLGNhPVN0LmV4cG9ydHMsZmE9WixsYT16LGRhPUppLGhhPUcscGE9Tyx2YT1taSx5YT1BZS5mLGdhPUkuZixtYT1odC5mLGJhPWFhLnRyaW0sd2E9Ik51bWJlciIsa2E9c2EuTnVtYmVyLHhhPWthLnByb3RvdHlwZSxBYT1sYSh2YSh4YSkpPT13YSxTYT1mdW5jdGlvbih0KXt2YXIgZSxyLG4saSxhLG8scyx1LGM9aGEodCwhMSk7aWYoInN0cmluZyI9PXR5cGVvZiBjJiZjLmxlbmd0aD4yKWlmKDQzPT09KGU9KGM9YmEoYykpLmNoYXJDb2RlQXQoMCkpfHw0NT09PWUpe2lmKDg4PT09KHI9Yy5jaGFyQ29kZUF0KDIpKXx8MTIwPT09cilyZXR1cm4gTmFOfWVsc2UgaWYoNDg9PT1lKXtzd2l0Y2goYy5jaGFyQ29kZUF0KDEpKXtjYXNlIDY2OmNhc2UgOTg6bj0yLGk9NDk7YnJlYWs7Y2FzZSA3OTpjYXNlIDExMTpuPTgsaT01NTticmVhaztkZWZhdWx0OnJldHVybitjfWZvcihvPShhPWMuc2xpY2UoMikpLmxlbmd0aCxzPTA7czxvO3MrKylpZigodT1hLmNoYXJDb2RlQXQocykpPDQ4fHx1PmkpcmV0dXJuIE5hTjtyZXR1cm4gcGFyc2VJbnQoYSxuKX1yZXR1cm4rY307aWYodWEod2EsIWthKCIgMG8xIil8fCFrYSgiMGIxIil8fGthKCIrMHgxIikpKXtmb3IodmFyIF9hLFRhPWZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg8MT8wOnQscj10aGlzO3JldHVybiByIGluc3RhbmNlb2YgVGEmJihBYT9wYSgoZnVuY3Rpb24oKXt4YS52YWx1ZU9mLmNhbGwocil9KSk6bGEocikhPXdhKT9kYShuZXcga2EoU2EoZSkpLHIsVGEpOlNhKGUpfSxFYT1vYT95YShrYSk6Ik1BWF9WQUxVRSxNSU5fVkFMVUUsTmFOLE5FR0FUSVZFX0lORklOSVRZLFBPU0lUSVZFX0lORklOSVRZLEVQU0lMT04saXNGaW5pdGUsaXNJbnRlZ2VyLGlzTmFOLGlzU2FmZUludGVnZXIsTUFYX1NBRkVfSU5URUdFUixNSU5fU0FGRV9JTlRFR0VSLHBhcnNlRmxvYXQscGFyc2VJbnQsaXNJbnRlZ2VyLGZyb21TdHJpbmcscmFuZ2UiLnNwbGl0KCIsIiksSWE9MDtFYS5sZW5ndGg+SWE7SWErKylmYShrYSxfYT1FYVtJYV0pJiYhZmEoVGEsX2EpJiZtYShUYSxfYSxnYShrYSxfYSkpO1RhLnByb3RvdHlwZT14YSx4YS5jb25zdHJ1Y3Rvcj1UYSxjYShzYSx3YSxUYSl9dmFyIE9hLE1hLENhLFJhPXt9LEJhPSFPKChmdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt9cmV0dXJuIHQucHJvdG90eXBlLmNvbnN0cnVjdG9yPW51bGwsT2JqZWN0LmdldFByb3RvdHlwZU9mKG5ldyB0KSE9PXQucHJvdG90eXBlfSkpLFBhPVosVWE9WCxEYT1CYSx6YT1xdCgiSUVfUFJPVE8iKSxqYT1PYmplY3QucHJvdG90eXBlLExhPURhP09iamVjdC5nZXRQcm90b3R5cGVPZjpmdW5jdGlvbih0KXtyZXR1cm4gdD1VYSh0KSxQYSh0LHphKT90W3phXToiZnVuY3Rpb24iPT10eXBlb2YgdC5jb25zdHJ1Y3RvciYmdCBpbnN0YW5jZW9mIHQuY29uc3RydWN0b3I/dC5jb25zdHJ1Y3Rvci5wcm90b3R5cGU6dCBpbnN0YW5jZW9mIE9iamVjdD9qYTpudWxsfSxGYT1PLE5hPUxhLFZhPUF0LEhhPVosWWE9S3IoIml0ZXJhdG9yIiksS2E9ITE7W10ua2V5cyYmKCJuZXh0ImluKENhPVtdLmtleXMoKSk/KE1hPU5hKE5hKENhKSkpIT09T2JqZWN0LnByb3RvdHlwZSYmKE9hPU1hKTpLYT0hMCksKG51bGw9PU9hfHxGYSgoZnVuY3Rpb24oKXt2YXIgdD17fTtyZXR1cm4gT2FbWWFdLmNhbGwodCkhPT10fSkpKSYmKE9hPXt9KSxIYShPYSxZYSl8fFZhKE9hLFlhLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBXYT17SXRlcmF0b3JQcm90b3R5cGU6T2EsQlVHR1lfU0FGQVJJX0lURVJBVE9SUzpLYX0sR2E9aHQuZixxYT1aLFhhPUtyKCJ0b1N0cmluZ1RhZyIpLCRhPWZ1bmN0aW9uKHQsZSxyKXt0JiYhcWEodD1yP3Q6dC5wcm90b3R5cGUsWGEpJiZHYSh0LFhhLHtjb25maWd1cmFibGU6ITAsdmFsdWU6ZX0pfSxRYT1XYS5JdGVyYXRvclByb3RvdHlwZSxaYT1taSxKYT1VLHRvPSRhLGVvPVJhLHJvPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LG5vPWJyLGlvPWZ1bmN0aW9uKHQsZSxyKXt2YXIgbj1lKyIgSXRlcmF0b3IiO3JldHVybiB0LnByb3RvdHlwZT1aYShRYSx7bmV4dDpKYSgxLHIpfSksdG8odCxuLCExKSxlb1tuXT1ybyx0fSxhbz1MYSxvbz0kaSxzbz0kYSx1bz1BdCxjbz1TdC5leHBvcnRzLGZvPVJhLGxvPVdhLkl0ZXJhdG9yUHJvdG90eXBlLGhvPVdhLkJVR0dZX1NBRkFSSV9JVEVSQVRPUlMscG89S3IoIml0ZXJhdG9yIiksdm89ImtleXMiLHlvPSJ2YWx1ZXMiLGdvPSJlbnRyaWVzIixtbz1mdW5jdGlvbigpe3JldHVybiB0aGlzfSxibz1mdW5jdGlvbih0LGUscixuLGksYSxvKXtpbyhyLGUsbik7dmFyIHMsdSxjLGY9ZnVuY3Rpb24odCl7aWYodD09PWkmJnYpcmV0dXJuIHY7aWYoIWhvJiZ0IGluIGgpcmV0dXJuIGhbdF07c3dpdGNoKHQpe2Nhc2Ugdm86Y2FzZSB5bzpjYXNlIGdvOnJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgcih0aGlzLHQpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHIodGhpcyl9fSxsPWUrIiBJdGVyYXRvciIsZD0hMSxoPXQucHJvdG90eXBlLHA9aFtwb118fGhbIkBAaXRlcmF0b3IiXXx8aSYmaFtpXSx2PSFobyYmcHx8ZihpKSx5PSJBcnJheSI9PWUmJmguZW50cmllc3x8cDtpZih5JiYocz1hbyh5LmNhbGwobmV3IHQpKSxsbyE9PU9iamVjdC5wcm90b3R5cGUmJnMubmV4dCYmKGFvKHMpIT09bG8mJihvbz9vbyhzLGxvKToiZnVuY3Rpb24iIT10eXBlb2Ygc1twb10mJnVvKHMscG8sbW8pKSxzbyhzLGwsITApKSksaT09eW8mJnAmJnAubmFtZSE9PXlvJiYoZD0hMCx2PWZ1bmN0aW9uKCl7cmV0dXJuIHAuY2FsbCh0aGlzKX0pLGhbcG9dIT09diYmdW8oaCxwbyx2KSxmb1tlXT12LGkpaWYodT17dmFsdWVzOmYoeW8pLGtleXM6YT92OmYodm8pLGVudHJpZXM6Zihnbyl9LG8pZm9yKGMgaW4gdSkoaG98fGR8fCEoYyBpbiBoKSkmJmNvKGgsYyx1W2NdKTtlbHNlIG5vKHt0YXJnZXQ6ZSxwcm90bzohMCxmb3JjZWQ6aG98fGR9LHUpO3JldHVybiB1fSx3bz1ZLGtvPUFpLHhvPVJhLEFvPWZlLFNvPWJvLF9vPSJBcnJheSBJdGVyYXRvciIsVG89QW8uc2V0LEVvPUFvLmdldHRlckZvcihfbyksSW89U28oQXJyYXksIkFycmF5IiwoZnVuY3Rpb24odCxlKXtUbyh0aGlzLHt0eXBlOl9vLHRhcmdldDp3byh0KSxpbmRleDowLGtpbmQ6ZX0pfSksKGZ1bmN0aW9uKCl7dmFyIHQ9RW8odGhpcyksZT10LnRhcmdldCxyPXQua2luZCxuPXQuaW5kZXgrKztyZXR1cm4hZXx8bj49ZS5sZW5ndGg/KHQudGFyZ2V0PXZvaWQgMCx7dmFsdWU6dm9pZCAwLGRvbmU6ITB9KToia2V5cyI9PXI/e3ZhbHVlOm4sZG9uZTohMX06InZhbHVlcyI9PXI/e3ZhbHVlOmVbbl0sZG9uZTohMX06e3ZhbHVlOltuLGVbbl1dLGRvbmU6ITF9fSksInZhbHVlcyIpO3hvLkFyZ3VtZW50cz14by5BcnJheSxrbygia2V5cyIpLGtvKCJ2YWx1ZXMiKSxrbygiZW50cmllcyIpO3ZhciBPbz17ZXhwb3J0czp7fX0sTW89S3IoIml0ZXJhdG9yIiksQ289ITE7dHJ5e3ZhciBSbz0wLEJvPXtuZXh0OmZ1bmN0aW9uKCl7cmV0dXJue2RvbmU6ISFSbysrfX0scmV0dXJuOmZ1bmN0aW9uKCl7Q289ITB9fTtCb1tNb109ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sQXJyYXkuZnJvbShCbywoZnVuY3Rpb24oKXt0aHJvdyAyfSkpfWNhdGNoKF92KXt9dmFyIFBvLFVvPWZ1bmN0aW9uKHQsZSl7aWYoIWUmJiFDbylyZXR1cm4hMTt2YXIgcj0hMTt0cnl7dmFyIG49e307bltNb109ZnVuY3Rpb24oKXtyZXR1cm57bmV4dDpmdW5jdGlvbigpe3JldHVybntkb25lOnI9ITB9fX19LHQobil9Y2F0Y2goX3Ype31yZXR1cm4gcn0sRG89InVuZGVmaW5lZCIhPXR5cGVvZiBBcnJheUJ1ZmZlciYmInVuZGVmaW5lZCIhPXR5cGVvZiBEYXRhVmlldyx6bz1Ebyxqbz1NLExvPUUsRm89SyxObz1aLFZvPUFuLEhvPUF0LFlvPVN0LmV4cG9ydHMsS289aHQuZixXbz1MYSxHbz0kaSxxbz1LcixYbz1ZdCwkbz1Mby5JbnQ4QXJyYXksUW89JG8mJiRvLnByb3RvdHlwZSxabz1Mby5VaW50OENsYW1wZWRBcnJheSxKbz1abyYmWm8ucHJvdG90eXBlLHRzPSRvJiZXbygkbyksZXM9UW8mJldvKFFvKSxycz1PYmplY3QucHJvdG90eXBlLG5zPXJzLmlzUHJvdG90eXBlT2YsaXM9cW8oInRvU3RyaW5nVGFnIiksYXM9WG8oIlRZUEVEX0FSUkFZX1RBRyIpLG9zPXpvJiYhIUdvJiYiT3BlcmEiIT09Vm8oTG8ub3BlcmEpLHNzPSExLHVzPXtJbnQ4QXJyYXk6MSxVaW50OEFycmF5OjEsVWludDhDbGFtcGVkQXJyYXk6MSxJbnQxNkFycmF5OjIsVWludDE2QXJyYXk6MixJbnQzMkFycmF5OjQsVWludDMyQXJyYXk6NCxGbG9hdDMyQXJyYXk6NCxGbG9hdDY0QXJyYXk6OH0sY3M9e0JpZ0ludDY0QXJyYXk6OCxCaWdVaW50NjRBcnJheTo4fSxmcz1mdW5jdGlvbih0KXtpZighRm8odCkpcmV0dXJuITE7dmFyIGU9Vm8odCk7cmV0dXJuIE5vKHVzLGUpfHxObyhjcyxlKX07Zm9yKFBvIGluIHVzKUxvW1BvXXx8KG9zPSExKTtpZigoIW9zfHwiZnVuY3Rpb24iIT10eXBlb2YgdHN8fHRzPT09RnVuY3Rpb24ucHJvdG90eXBlKSYmKHRzPWZ1bmN0aW9uKCl7dGhyb3cgVHlwZUVycm9yKCJJbmNvcnJlY3QgaW52b2NhdGlvbiIpfSxvcykpZm9yKFBvIGluIHVzKUxvW1BvXSYmR28oTG9bUG9dLHRzKTtpZigoIW9zfHwhZXN8fGVzPT09cnMpJiYoZXM9dHMucHJvdG90eXBlLG9zKSlmb3IoUG8gaW4gdXMpTG9bUG9dJiZHbyhMb1tQb10ucHJvdG90eXBlLGVzKTtpZihvcyYmV28oSm8pIT09ZXMmJkdvKEpvLGVzKSxqbyYmIU5vKGVzLGlzKSlmb3IoUG8gaW4gc3M9ITAsS28oZXMsaXMse2dldDpmdW5jdGlvbigpe3JldHVybiBGbyh0aGlzKT90aGlzW2FzXTp2b2lkIDB9fSksdXMpTG9bUG9dJiZIbyhMb1tQb10sYXMsUG8pO3ZhciBscz17TkFUSVZFX0FSUkFZX0JVRkZFUl9WSUVXUzpvcyxUWVBFRF9BUlJBWV9UQUc6c3MmJmFzLGFUeXBlZEFycmF5OmZ1bmN0aW9uKHQpe2lmKGZzKHQpKXJldHVybiB0O3Rocm93IFR5cGVFcnJvcigiVGFyZ2V0IGlzIG5vdCBhIHR5cGVkIGFycmF5Iil9LGFUeXBlZEFycmF5Q29uc3RydWN0b3I6ZnVuY3Rpb24odCl7aWYoR28pe2lmKG5zLmNhbGwodHMsdCkpcmV0dXJuIHR9ZWxzZSBmb3IodmFyIGUgaW4gdXMpaWYoTm8odXMsUG8pKXt2YXIgcj1Mb1tlXTtpZihyJiYodD09PXJ8fG5zLmNhbGwocix0KSkpcmV0dXJuIHR9dGhyb3cgVHlwZUVycm9yKCJUYXJnZXQgaXMgbm90IGEgdHlwZWQgYXJyYXkgY29uc3RydWN0b3IiKX0sZXhwb3J0VHlwZWRBcnJheU1ldGhvZDpmdW5jdGlvbih0LGUscil7aWYoam8pe2lmKHIpZm9yKHZhciBuIGluIHVzKXt2YXIgaT1Mb1tuXTtpZihpJiZObyhpLnByb3RvdHlwZSx0KSl0cnl7ZGVsZXRlIGkucHJvdG90eXBlW3RdfWNhdGNoKF92KXt9fWVzW3RdJiYhcnx8WW8oZXMsdCxyP2U6b3MmJlFvW3RdfHxlKX19LGV4cG9ydFR5cGVkQXJyYXlTdGF0aWNNZXRob2Q6ZnVuY3Rpb24odCxlLHIpe3ZhciBuLGk7aWYoam8pe2lmKEdvKXtpZihyKWZvcihuIGluIHVzKWlmKChpPUxvW25dKSYmTm8oaSx0KSl0cnl7ZGVsZXRlIGlbdF19Y2F0Y2goX3Ype31pZih0c1t0XSYmIXIpcmV0dXJuO3RyeXtyZXR1cm4gWW8odHMsdCxyP2U6b3MmJnRzW3RdfHxlKX1jYXRjaChfdil7fX1mb3IobiBpbiB1cykhKGk9TG9bbl0pfHxpW3RdJiYhcnx8WW8oaSx0LGUpfX0saXNWaWV3OmZ1bmN0aW9uKHQpe2lmKCFGbyh0KSlyZXR1cm4hMTt2YXIgZT1Wbyh0KTtyZXR1cm4iRGF0YVZpZXciPT09ZXx8Tm8odXMsZSl8fE5vKGNzLGUpfSxpc1R5cGVkQXJyYXk6ZnMsVHlwZWRBcnJheTp0cyxUeXBlZEFycmF5UHJvdG90eXBlOmVzfSxkcz1FLGhzPU8scHM9VW8sdnM9bHMuTkFUSVZFX0FSUkFZX0JVRkZFUl9WSUVXUyx5cz1kcy5BcnJheUJ1ZmZlcixncz1kcy5JbnQ4QXJyYXksbXM9IXZzfHwhaHMoKGZ1bmN0aW9uKCl7Z3MoMSl9KSl8fCFocygoZnVuY3Rpb24oKXtuZXcgZ3MoLTEpfSkpfHwhcHMoKGZ1bmN0aW9uKHQpe25ldyBncyxuZXcgZ3MobnVsbCksbmV3IGdzKDEuNSksbmV3IGdzKHQpfSksITApfHxocygoZnVuY3Rpb24oKXtyZXR1cm4gMSE9PW5ldyBncyhuZXcgeXMoMiksMSx2b2lkIDApLmxlbmd0aH0pKSxicz1TdC5leHBvcnRzLHdzPWZ1bmN0aW9uKHQsZSxyKXtpZighKHQgaW5zdGFuY2VvZiBlKSl0aHJvdyBUeXBlRXJyb3IoIkluY29ycmVjdCAiKyhyP3IrIiAiOiIiKSsiaW52b2NhdGlvbiIpO3JldHVybiB0fSxrcz1UZSx4cz1PZSxBcz1mdW5jdGlvbih0KXtpZih2b2lkIDA9PT10KXJldHVybiAwO3ZhciBlPWtzKHQpLHI9eHMoZSk7aWYoZSE9PXIpdGhyb3cgUmFuZ2VFcnJvcigiV3JvbmcgbGVuZ3RoIG9yIGluZGV4Iik7cmV0dXJuIHJ9LFNzPU1hdGguYWJzLF9zPU1hdGgucG93LFRzPU1hdGguZmxvb3IsRXM9TWF0aC5sb2csSXM9TWF0aC5MTjIsT3M9WCxNcz1CZSxDcz1PZSxScz1mdW5jdGlvbih0KXtmb3IodmFyIGU9T3ModGhpcykscj1DcyhlLmxlbmd0aCksbj1hcmd1bWVudHMubGVuZ3RoLGk9TXMobj4xP2FyZ3VtZW50c1sxXTp2b2lkIDAsciksYT1uPjI/YXJndW1lbnRzWzJdOnZvaWQgMCxvPXZvaWQgMD09PWE/cjpNcyhhLHIpO28+aTspZVtpKytdPXQ7cmV0dXJuIGV9LEJzPUUsUHM9TSxVcz1EbyxEcz1BdCx6cz1mdW5jdGlvbih0LGUscil7Zm9yKHZhciBuIGluIGUpYnModCxuLGVbbl0scik7cmV0dXJuIHR9LGpzPU8sTHM9d3MsRnM9VGUsTnM9T2UsVnM9QXMsSHM9e3BhY2s6ZnVuY3Rpb24odCxlLHIpe3ZhciBuLGksYSxvPW5ldyBBcnJheShyKSxzPTgqci1lLTEsdT0oMTw8cyktMSxjPXU+PjEsZj0yMz09PWU/X3MoMiwtMjQpLV9zKDIsLTc3KTowLGw9dDwwfHwwPT09dCYmMS90PDA/MTowLGQ9MDtmb3IoKHQ9U3ModCkpIT10fHx0PT09MS8wPyhpPXQhPXQ/MTowLG49dSk6KG49VHMoRXModCkvSXMpLHQqKGE9X3MoMiwtbikpPDEmJihuLS0sYSo9MiksKHQrPW4rYz49MT9mL2E6ZipfcygyLDEtYykpKmE+PTImJihuKyssYS89MiksbitjPj11PyhpPTAsbj11KTpuK2M+PTE/KGk9KHQqYS0xKSpfcygyLGUpLG4rPWMpOihpPXQqX3MoMixjLTEpKl9zKDIsZSksbj0wKSk7ZT49ODtvW2QrK109MjU1JmksaS89MjU2LGUtPTgpO2ZvcihuPW48PGV8aSxzKz1lO3M+MDtvW2QrK109MjU1Jm4sbi89MjU2LHMtPTgpO3JldHVybiBvWy0tZF18PTEyOCpsLG99LHVucGFjazpmdW5jdGlvbih0LGUpe3ZhciByLG49dC5sZW5ndGgsaT04Km4tZS0xLGE9KDE8PGkpLTEsbz1hPj4xLHM9aS03LHU9bi0xLGM9dFt1LS1dLGY9MTI3JmM7Zm9yKGM+Pj03O3M+MDtmPTI1NipmK3RbdV0sdS0tLHMtPTgpO2ZvcihyPWYmKDE8PC1zKS0xLGY+Pj0tcyxzKz1lO3M+MDtyPTI1NipyK3RbdV0sdS0tLHMtPTgpO2lmKDA9PT1mKWY9MS1vO2Vsc2V7aWYoZj09PWEpcmV0dXJuIHI/TmFOOmM/LTEvMDoxLzA7cis9X3MoMixlKSxmLT1vfXJldHVybihjPy0xOjEpKnIqX3MoMixmLWUpfX0sWXM9TGEsS3M9JGksV3M9QWUuZixHcz1odC5mLHFzPVJzLFhzPSRhLCRzPWZlLmdldCxRcz1mZS5zZXQsWnM9IkFycmF5QnVmZmVyIixKcz0iRGF0YVZpZXciLHR1PSJXcm9uZyBpbmRleCIsZXU9QnMuQXJyYXlCdWZmZXIscnU9ZXUsbnU9QnMuRGF0YVZpZXcsaXU9bnUmJm51LnByb3RvdHlwZSxhdT1PYmplY3QucHJvdG90eXBlLG91PUJzLlJhbmdlRXJyb3Isc3U9SHMucGFjayx1dT1Icy51bnBhY2ssY3U9ZnVuY3Rpb24odCl7cmV0dXJuWzI1NSZ0XX0sZnU9ZnVuY3Rpb24odCl7cmV0dXJuWzI1NSZ0LHQ+PjgmMjU1XX0sbHU9ZnVuY3Rpb24odCl7cmV0dXJuWzI1NSZ0LHQ+PjgmMjU1LHQ+PjE2JjI1NSx0Pj4yNCYyNTVdfSxkdT1mdW5jdGlvbih0KXtyZXR1cm4gdFszXTw8MjR8dFsyXTw8MTZ8dFsxXTw8OHx0WzBdfSxodT1mdW5jdGlvbih0KXtyZXR1cm4gc3UodCwyMyw0KX0scHU9ZnVuY3Rpb24odCl7cmV0dXJuIHN1KHQsNTIsOCl9LHZ1PWZ1bmN0aW9uKHQsZSl7R3ModC5wcm90b3R5cGUsZSx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuICRzKHRoaXMpW2VdfX0pfSx5dT1mdW5jdGlvbih0LGUscixuKXt2YXIgaT1WcyhyKSxhPSRzKHQpO2lmKGkrZT5hLmJ5dGVMZW5ndGgpdGhyb3cgb3UodHUpO3ZhciBvPSRzKGEuYnVmZmVyKS5ieXRlcyxzPWkrYS5ieXRlT2Zmc2V0LHU9by5zbGljZShzLHMrZSk7cmV0dXJuIG4/dTp1LnJldmVyc2UoKX0sZ3U9ZnVuY3Rpb24odCxlLHIsbixpLGEpe3ZhciBvPVZzKHIpLHM9JHModCk7aWYobytlPnMuYnl0ZUxlbmd0aCl0aHJvdyBvdSh0dSk7Zm9yKHZhciB1PSRzKHMuYnVmZmVyKS5ieXRlcyxjPW8rcy5ieXRlT2Zmc2V0LGY9bigraSksbD0wO2w8ZTtsKyspdVtjK2xdPWZbYT9sOmUtbC0xXX07aWYoVXMpe2lmKCFqcygoZnVuY3Rpb24oKXtldSgxKX0pKXx8IWpzKChmdW5jdGlvbigpe25ldyBldSgtMSl9KSl8fGpzKChmdW5jdGlvbigpe3JldHVybiBuZXcgZXUsbmV3IGV1KDEuNSksbmV3IGV1KE5hTiksZXUubmFtZSE9WnN9KSkpe2Zvcih2YXIgbXUsYnU9KHJ1PWZ1bmN0aW9uKHQpe3JldHVybiBMcyh0aGlzLHJ1KSxuZXcgZXUoVnModCkpfSkucHJvdG90eXBlPWV1LnByb3RvdHlwZSx3dT1XcyhldSksa3U9MDt3dS5sZW5ndGg+a3U7KShtdT13dVtrdSsrXSlpbiBydXx8RHMocnUsbXUsZXVbbXVdKTtidS5jb25zdHJ1Y3Rvcj1ydX1LcyYmWXMoaXUpIT09YXUmJktzKGl1LGF1KTt2YXIgeHU9bmV3IG51KG5ldyBydSgyKSksQXU9aXUuc2V0SW50ODt4dS5zZXRJbnQ4KDAsMjE0NzQ4MzY0OCkseHUuc2V0SW50OCgxLDIxNDc0ODM2NDkpLCF4dS5nZXRJbnQ4KDApJiZ4dS5nZXRJbnQ4KDEpfHx6cyhpdSx7c2V0SW50ODpmdW5jdGlvbih0LGUpe0F1LmNhbGwodGhpcyx0LGU8PDI0Pj4yNCl9LHNldFVpbnQ4OmZ1bmN0aW9uKHQsZSl7QXUuY2FsbCh0aGlzLHQsZTw8MjQ+PjI0KX19LHt1bnNhZmU6ITB9KX1lbHNlIHJ1PWZ1bmN0aW9uKHQpe0xzKHRoaXMscnUsWnMpO3ZhciBlPVZzKHQpO1FzKHRoaXMse2J5dGVzOnFzLmNhbGwobmV3IEFycmF5KGUpLDApLGJ5dGVMZW5ndGg6ZX0pLFBzfHwodGhpcy5ieXRlTGVuZ3RoPWUpfSxudT1mdW5jdGlvbih0LGUscil7THModGhpcyxudSxKcyksTHModCxydSxKcyk7dmFyIG49JHModCkuYnl0ZUxlbmd0aCxpPUZzKGUpO2lmKGk8MHx8aT5uKXRocm93IG91KCJXcm9uZyBvZmZzZXQiKTtpZihpKyhyPXZvaWQgMD09PXI/bi1pOk5zKHIpKT5uKXRocm93IG91KCJXcm9uZyBsZW5ndGgiKTtRcyh0aGlzLHtidWZmZXI6dCxieXRlTGVuZ3RoOnIsYnl0ZU9mZnNldDppfSksUHN8fCh0aGlzLmJ1ZmZlcj10LHRoaXMuYnl0ZUxlbmd0aD1yLHRoaXMuYnl0ZU9mZnNldD1pKX0sUHMmJih2dShydSwiYnl0ZUxlbmd0aCIpLHZ1KG51LCJidWZmZXIiKSx2dShudSwiYnl0ZUxlbmd0aCIpLHZ1KG51LCJieXRlT2Zmc2V0IikpLHpzKG51LnByb3RvdHlwZSx7Z2V0SW50ODpmdW5jdGlvbih0KXtyZXR1cm4geXUodGhpcywxLHQpWzBdPDwyND4+MjR9LGdldFVpbnQ4OmZ1bmN0aW9uKHQpe3JldHVybiB5dSh0aGlzLDEsdClbMF19LGdldEludDE2OmZ1bmN0aW9uKHQpe3ZhciBlPXl1KHRoaXMsMix0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKTtyZXR1cm4oZVsxXTw8OHxlWzBdKTw8MTY+PjE2fSxnZXRVaW50MTY6ZnVuY3Rpb24odCl7dmFyIGU9eXUodGhpcywyLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApO3JldHVybiBlWzFdPDw4fGVbMF19LGdldEludDMyOmZ1bmN0aW9uKHQpe3JldHVybiBkdSh5dSh0aGlzLDQsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCkpfSxnZXRVaW50MzI6ZnVuY3Rpb24odCl7cmV0dXJuIGR1KHl1KHRoaXMsNCx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKSk+Pj4wfSxnZXRGbG9hdDMyOmZ1bmN0aW9uKHQpe3JldHVybiB1dSh5dSh0aGlzLDQsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCksMjMpfSxnZXRGbG9hdDY0OmZ1bmN0aW9uKHQpe3JldHVybiB1dSh5dSh0aGlzLDgsdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCksNTIpfSxzZXRJbnQ4OmZ1bmN0aW9uKHQsZSl7Z3UodGhpcywxLHQsY3UsZSl9LHNldFVpbnQ4OmZ1bmN0aW9uKHQsZSl7Z3UodGhpcywxLHQsY3UsZSl9LHNldEludDE2OmZ1bmN0aW9uKHQsZSl7Z3UodGhpcywyLHQsZnUsZSxhcmd1bWVudHMubGVuZ3RoPjI/YXJndW1lbnRzWzJdOnZvaWQgMCl9LHNldFVpbnQxNjpmdW5jdGlvbih0LGUpe2d1KHRoaXMsMix0LGZ1LGUsYXJndW1lbnRzLmxlbmd0aD4yP2FyZ3VtZW50c1syXTp2b2lkIDApfSxzZXRJbnQzMjpmdW5jdGlvbih0LGUpe2d1KHRoaXMsNCx0LGx1LGUsYXJndW1lbnRzLmxlbmd0aD4yP2FyZ3VtZW50c1syXTp2b2lkIDApfSxzZXRVaW50MzI6ZnVuY3Rpb24odCxlKXtndSh0aGlzLDQsdCxsdSxlLGFyZ3VtZW50cy5sZW5ndGg+Mj9hcmd1bWVudHNbMl06dm9pZCAwKX0sc2V0RmxvYXQzMjpmdW5jdGlvbih0LGUpe2d1KHRoaXMsNCx0LGh1LGUsYXJndW1lbnRzLmxlbmd0aD4yP2FyZ3VtZW50c1syXTp2b2lkIDApfSxzZXRGbG9hdDY0OmZ1bmN0aW9uKHQsZSl7Z3UodGhpcyw4LHQscHUsZSxhcmd1bWVudHMubGVuZ3RoPjI/YXJndW1lbnRzWzJdOnZvaWQgMCl9fSk7WHMocnUsWnMpLFhzKG51LEpzKTt2YXIgU3U9e0FycmF5QnVmZmVyOnJ1LERhdGFWaWV3Om51fSxfdT1UZSxUdT1mdW5jdGlvbih0KXt2YXIgZT1fdSh0KTtpZihlPDApdGhyb3cgUmFuZ2VFcnJvcigiVGhlIGFyZ3VtZW50IGNhbid0IGJlIGxlc3MgdGhhbiAwIik7cmV0dXJuIGV9LEV1PWZ1bmN0aW9uKHQsZSl7dmFyIHI9VHUodCk7aWYociVlKXRocm93IFJhbmdlRXJyb3IoIldyb25nIG9mZnNldCIpO3JldHVybiByfSxJdT1BbixPdT1SYSxNdT1LcigiaXRlcmF0b3IiKSxDdT1mdW5jdGlvbih0KXtpZihudWxsIT10KXJldHVybiB0W011XXx8dFsiQEBpdGVyYXRvciJdfHxPdVtJdSh0KV19LFJ1PVJhLEJ1PUtyKCJpdGVyYXRvciIpLFB1PUFycmF5LnByb3RvdHlwZSxVdT1mdW5jdGlvbih0KXtyZXR1cm4gdm9pZCAwIT09dCYmKFJ1LkFycmF5PT09dHx8UHVbQnVdPT09dCl9LER1PVgsenU9T2UsanU9Q3UsTHU9VXUsRnU9Um4sTnU9bHMuYVR5cGVkQXJyYXlDb25zdHJ1Y3RvcixWdT14ZSxIdT1odCxZdT1NLEt1PUtyKCJzcGVjaWVzIiksV3U9ZnVuY3Rpb24odCl7dmFyIGU9VnUodCkscj1IdS5mO1l1JiZlJiYhZVtLdV0mJnIoZSxLdSx7Y29uZmlndXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzfX0pfSxHdT1icixxdT1FLFh1PU0sJHU9bXMsUXU9bHMsWnU9U3UsSnU9d3MsdGM9VSxlYz1BdCxyYz1PZSxuYz1BcyxpYz1FdSxhYz1HLG9jPVosc2M9QW4sdWM9SyxjYz1taSxmYz0kaSxsYz1BZS5mLGRjPWZ1bmN0aW9uKHQpe3ZhciBlLHIsbixpLGEsbyxzPUR1KHQpLHU9YXJndW1lbnRzLmxlbmd0aCxjPXU+MT9hcmd1bWVudHNbMV06dm9pZCAwLGY9dm9pZCAwIT09YyxsPWp1KHMpO2lmKG51bGwhPWwmJiFMdShsKSlmb3Iobz0oYT1sLmNhbGwocykpLm5leHQscz1bXTshKGk9by5jYWxsKGEpKS5kb25lOylzLnB1c2goaS52YWx1ZSk7Zm9yKGYmJnU+MiYmKGM9RnUoYyxhcmd1bWVudHNbMl0sMikpLHI9enUocy5sZW5ndGgpLG49bmV3KE51KHRoaXMpKShyKSxlPTA7cj5lO2UrKyluW2VdPWY/YyhzW2VdLGUpOnNbZV07cmV0dXJuIG59LGhjPUZuLmZvckVhY2gscGM9V3UsdmM9aHQseWM9SSxnYz1KaSxtYz1mZS5nZXQsYmM9ZmUuc2V0LHdjPXZjLmYsa2M9eWMuZix4Yz1NYXRoLnJvdW5kLEFjPXF1LlJhbmdlRXJyb3IsU2M9WnUuQXJyYXlCdWZmZXIsX2M9WnUuRGF0YVZpZXcsVGM9UXUuTkFUSVZFX0FSUkFZX0JVRkZFUl9WSUVXUyxFYz1RdS5UWVBFRF9BUlJBWV9UQUcsSWM9UXUuVHlwZWRBcnJheSxPYz1RdS5UeXBlZEFycmF5UHJvdG90eXBlLE1jPVF1LmFUeXBlZEFycmF5Q29uc3RydWN0b3IsQ2M9UXUuaXNUeXBlZEFycmF5LFJjPSJCWVRFU19QRVJfRUxFTUVOVCIsQmM9Ildyb25nIGxlbmd0aCIsUGM9ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9MCxuPWUubGVuZ3RoLGk9bmV3KE1jKHQpKShuKTtuPnI7KWlbcl09ZVtyKytdO3JldHVybiBpfSxVYz1mdW5jdGlvbih0LGUpe3djKHQsZSx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG1jKHRoaXMpW2VdfX0pfSxEYz1mdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4gdCBpbnN0YW5jZW9mIFNjfHwiQXJyYXlCdWZmZXIiPT0oZT1zYyh0KSl8fCJTaGFyZWRBcnJheUJ1ZmZlciI9PWV9LHpjPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIENjKHQpJiYic3ltYm9sIiE9cihlKSYmZSBpbiB0JiZTdHJpbmcoK2UpPT1TdHJpbmcoZSl9LGpjPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIHpjKHQsZT1hYyhlLCEwKSk/dGMoMix0W2VdKTprYyh0LGUpfSxMYz1mdW5jdGlvbih0LGUscil7cmV0dXJuISh6Yyh0LGU9YWMoZSwhMCkpJiZ1YyhyKSYmb2MociwidmFsdWUiKSl8fG9jKHIsImdldCIpfHxvYyhyLCJzZXQiKXx8ci5jb25maWd1cmFibGV8fG9jKHIsIndyaXRhYmxlIikmJiFyLndyaXRhYmxlfHxvYyhyLCJlbnVtZXJhYmxlIikmJiFyLmVudW1lcmFibGU/d2ModCxlLHIpOih0W2VdPXIudmFsdWUsdCl9O1h1PyhUY3x8KHljLmY9amMsdmMuZj1MYyxVYyhPYywiYnVmZmVyIiksVWMoT2MsImJ5dGVPZmZzZXQiKSxVYyhPYywiYnl0ZUxlbmd0aCIpLFVjKE9jLCJsZW5ndGgiKSksR3Uoe3RhcmdldDoiT2JqZWN0IixzdGF0OiEwLGZvcmNlZDohVGN9LHtnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6amMsZGVmaW5lUHJvcGVydHk6TGN9KSxPby5leHBvcnRzPWZ1bmN0aW9uKHQsZSxyKXt2YXIgbj10Lm1hdGNoKC9cZCskLylbMF0vOCxpPXQrKHI/IkNsYW1wZWQiOiIiKSsiQXJyYXkiLGE9ImdldCIrdCxvPSJzZXQiK3Qscz1xdVtpXSx1PXMsYz11JiZ1LnByb3RvdHlwZSxmPXt9LGw9ZnVuY3Rpb24odCxlKXt3Yyh0LGUse2dldDpmdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbih0LGUpe3ZhciByPW1jKHQpO3JldHVybiByLnZpZXdbYV0oZSpuK3IuYnl0ZU9mZnNldCwhMCl9KHRoaXMsZSl9LHNldDpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24odCxlLGkpe3ZhciBhPW1jKHQpO3ImJihpPShpPXhjKGkpKTwwPzA6aT4yNTU/MjU1OjI1NSZpKSxhLnZpZXdbb10oZSpuK2EuYnl0ZU9mZnNldCxpLCEwKX0odGhpcyxlLHQpfSxlbnVtZXJhYmxlOiEwfSl9O1RjPyR1JiYodT1lKChmdW5jdGlvbih0LGUscixhKXtyZXR1cm4gSnUodCx1LGkpLGdjKHVjKGUpP0RjKGUpP3ZvaWQgMCE9PWE/bmV3IHMoZSxpYyhyLG4pLGEpOnZvaWQgMCE9PXI/bmV3IHMoZSxpYyhyLG4pKTpuZXcgcyhlKTpDYyhlKT9QYyh1LGUpOmRjLmNhbGwodSxlKTpuZXcgcyhuYyhlKSksdCx1KX0pKSxmYyYmZmModSxJYyksaGMobGMocyksKGZ1bmN0aW9uKHQpe3QgaW4gdXx8ZWModSx0LHNbdF0pfSkpLHUucHJvdG90eXBlPWMpOih1PWUoKGZ1bmN0aW9uKHQsZSxyLGEpe0p1KHQsdSxpKTt2YXIgbyxzLGMsZj0wLGQ9MDtpZih1YyhlKSl7aWYoIURjKGUpKXJldHVybiBDYyhlKT9QYyh1LGUpOmRjLmNhbGwodSxlKTtvPWUsZD1pYyhyLG4pO3ZhciBoPWUuYnl0ZUxlbmd0aDtpZih2b2lkIDA9PT1hKXtpZihoJW4pdGhyb3cgQWMoQmMpO2lmKChzPWgtZCk8MCl0aHJvdyBBYyhCYyl9ZWxzZSBpZigocz1yYyhhKSpuKStkPmgpdGhyb3cgQWMoQmMpO2M9cy9ufWVsc2UgYz1uYyhlKSxvPW5ldyBTYyhzPWMqbik7Zm9yKGJjKHQse2J1ZmZlcjpvLGJ5dGVPZmZzZXQ6ZCxieXRlTGVuZ3RoOnMsbGVuZ3RoOmMsdmlldzpuZXcgX2Mobyl9KTtmPGM7KWwodCxmKyspfSkpLGZjJiZmYyh1LEljKSxjPXUucHJvdG90eXBlPWNjKE9jKSksYy5jb25zdHJ1Y3RvciE9PXUmJmVjKGMsImNvbnN0cnVjdG9yIix1KSxFYyYmZWMoYyxFYyxpKSxmW2ldPXUsR3Uoe2dsb2JhbDohMCxmb3JjZWQ6dSE9cyxzaGFtOiFUY30sZiksUmMgaW4gdXx8ZWModSxSYyxuKSxSYyBpbiBjfHxlYyhjLFJjLG4pLHBjKGkpfSk6T28uZXhwb3J0cz1mdW5jdGlvbigpe30sKDAsT28uZXhwb3J0cykoIlVpbnQ4IiwoZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscixuKXtyZXR1cm4gdCh0aGlzLGUscixuKX19KSk7dmFyIEZjPU9lLE5jPVRlLFZjPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJhdCIsKGZ1bmN0aW9uKHQpe3ZhciBlPVZjKHRoaXMpLHI9RmMoZS5sZW5ndGgpLG49TmModCksaT1uPj0wP246cituO3JldHVybiBpPDB8fGk+PXI/dm9pZCAwOmVbaV19KSk7dmFyIEhjPVgsWWM9QmUsS2M9T2UsV2M9TWF0aC5taW4sR2M9W10uY29weVdpdGhpbnx8ZnVuY3Rpb24odCxlKXt2YXIgcj1IYyh0aGlzKSxuPUtjKHIubGVuZ3RoKSxpPVljKHQsbiksYT1ZYyhlLG4pLG89YXJndW1lbnRzLmxlbmd0aD4yP2FyZ3VtZW50c1syXTp2b2lkIDAscz1XYygodm9pZCAwPT09bz9uOlljKG8sbikpLWEsbi1pKSx1PTE7Zm9yKGE8aSYmaTxhK3MmJih1PS0xLGErPXMtMSxpKz1zLTEpO3MtLSA+MDspYSBpbiByP3JbaV09clthXTpkZWxldGUgcltpXSxpKz11LGErPXU7cmV0dXJuIHJ9LHFjPUdjLFhjPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJjb3B5V2l0aGluIiwoZnVuY3Rpb24odCxlKXtyZXR1cm4gcWMuY2FsbChYYyh0aGlzKSx0LGUsYXJndW1lbnRzLmxlbmd0aD4yP2FyZ3VtZW50c1syXTp2b2lkIDApfSkpO3ZhciAkYz1Gbi5ldmVyeSxRYz1scy5hVHlwZWRBcnJheTsoMCxscy5leHBvcnRUeXBlZEFycmF5TWV0aG9kKSgiZXZlcnkiLChmdW5jdGlvbih0KXtyZXR1cm4gJGMoUWModGhpcyksdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9KSk7dmFyIFpjPVJzLEpjPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJmaWxsIiwoZnVuY3Rpb24odCl7cmV0dXJuIFpjLmFwcGx5KEpjKHRoaXMpLGFyZ3VtZW50cyl9KSk7dmFyIHRmPXZ0LGVmPU1uLHJmPUtyKCJzcGVjaWVzIiksbmY9ZnVuY3Rpb24odCxlKXt2YXIgcixuPXRmKHQpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDA9PT1ufHxudWxsPT0ocj10ZihuKVtyZl0pP2U6ZWYocil9LGFmPWxzLmFUeXBlZEFycmF5Q29uc3RydWN0b3Isb2Y9bmYsc2Y9Rm4uZmlsdGVyLHVmPWZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPW9mKHQsdC5jb25zdHJ1Y3Rvciksbj0wLGk9ZS5sZW5ndGgsYT1uZXcoYWYocikpKGkpO2k+bjspYVtuXT1lW24rK107cmV0dXJuIGF9LGNmPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJmaWx0ZXIiLChmdW5jdGlvbih0KXt2YXIgZT1zZihjZih0aGlzKSx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKTtyZXR1cm4gdWYodGhpcyxlKX0pKTt2YXIgZmY9Rm4uZmluZCxsZj1scy5hVHlwZWRBcnJheTsoMCxscy5leHBvcnRUeXBlZEFycmF5TWV0aG9kKSgiZmluZCIsKGZ1bmN0aW9uKHQpe3JldHVybiBmZihsZih0aGlzKSx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX0pKTt2YXIgZGY9Rm4uZmluZEluZGV4LGhmPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJmaW5kSW5kZXgiLChmdW5jdGlvbih0KXtyZXR1cm4gZGYoaGYodGhpcyksdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9KSk7dmFyIHBmPVJuLHZmPUYseWY9WCxnZj1PZSxtZj1mdW5jdGlvbih0KXt2YXIgZT02PT10O3JldHVybiBmdW5jdGlvbihyLG4saSl7Zm9yKHZhciBhLG89eWYocikscz12ZihvKSx1PXBmKG4saSwzKSxjPWdmKHMubGVuZ3RoKTtjLS0gPjA7KWlmKHUoYT1zW2NdLGMsbykpc3dpdGNoKHQpe2Nhc2UgNTpyZXR1cm4gYTtjYXNlIDY6cmV0dXJuIGN9cmV0dXJuIGU/LTE6dm9pZCAwfX0sYmY9e2ZpbmRMYXN0Om1mKDUpLGZpbmRMYXN0SW5kZXg6bWYoNil9LHdmPWJmLmZpbmRMYXN0LGtmPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJmaW5kTGFzdCIsKGZ1bmN0aW9uKHQpe3JldHVybiB3ZihrZih0aGlzKSx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX0pKTt2YXIgeGY9YmYuZmluZExhc3RJbmRleCxBZj1scy5hVHlwZWRBcnJheTsoMCxscy5leHBvcnRUeXBlZEFycmF5TWV0aG9kKSgiZmluZExhc3RJbmRleCIsKGZ1bmN0aW9uKHQpe3JldHVybiB4ZihBZih0aGlzKSx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX0pKTt2YXIgU2Y9Rm4uZm9yRWFjaCxfZj1scy5hVHlwZWRBcnJheTsoMCxscy5leHBvcnRUeXBlZEFycmF5TWV0aG9kKSgiZm9yRWFjaCIsKGZ1bmN0aW9uKHQpe1NmKF9mKHRoaXMpLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfSkpO3ZhciBUZj1qZS5pbmNsdWRlcyxFZj1scy5hVHlwZWRBcnJheTsoMCxscy5leHBvcnRUeXBlZEFycmF5TWV0aG9kKSgiaW5jbHVkZXMiLChmdW5jdGlvbih0KXtyZXR1cm4gVGYoRWYodGhpcyksdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9KSk7dmFyIElmPWplLmluZGV4T2YsT2Y9bHMuYVR5cGVkQXJyYXk7KDAsbHMuZXhwb3J0VHlwZWRBcnJheU1ldGhvZCkoImluZGV4T2YiLChmdW5jdGlvbih0KXtyZXR1cm4gSWYoT2YodGhpcyksdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9KSk7dmFyIE1mPUUsQ2Y9bHMsUmY9SW8sQmY9S3IoIml0ZXJhdG9yIiksUGY9TWYuVWludDhBcnJheSxVZj1SZi52YWx1ZXMsRGY9UmYua2V5cyx6Zj1SZi5lbnRyaWVzLGpmPUNmLmFUeXBlZEFycmF5LExmPUNmLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QsRmY9UGYmJlBmLnByb3RvdHlwZVtCZl0sTmY9ISFGZiYmKCJ2YWx1ZXMiPT1GZi5uYW1lfHxudWxsPT1GZi5uYW1lKSxWZj1mdW5jdGlvbigpe3JldHVybiBVZi5jYWxsKGpmKHRoaXMpKX07TGYoImVudHJpZXMiLChmdW5jdGlvbigpe3JldHVybiB6Zi5jYWxsKGpmKHRoaXMpKX0pKSxMZigia2V5cyIsKGZ1bmN0aW9uKCl7cmV0dXJuIERmLmNhbGwoamYodGhpcykpfSkpLExmKCJ2YWx1ZXMiLFZmLCFOZiksTGYoQmYsVmYsIU5mKTt2YXIgSGY9bHMuYVR5cGVkQXJyYXksWWY9W10uam9pbjsoMCxscy5leHBvcnRUeXBlZEFycmF5TWV0aG9kKSgiam9pbiIsKGZ1bmN0aW9uKHQpe3JldHVybiBZZi5hcHBseShIZih0aGlzKSxhcmd1bWVudHMpfSkpO3ZhciBLZj1ZLFdmPVRlLEdmPU9lLHFmPVZuLFhmPU1hdGgubWluLCRmPVtdLmxhc3RJbmRleE9mLFFmPSEhJGYmJjEvWzFdLmxhc3RJbmRleE9mKDEsLTApPDAsWmY9cWYoImxhc3RJbmRleE9mIiksSmY9UWZ8fCFaZj9mdW5jdGlvbih0KXtpZihRZilyZXR1cm4gJGYuYXBwbHkodGhpcyxhcmd1bWVudHMpfHwwO3ZhciBlPUtmKHRoaXMpLHI9R2YoZS5sZW5ndGgpLG49ci0xO2Zvcihhcmd1bWVudHMubGVuZ3RoPjEmJihuPVhmKG4sV2YoYXJndW1lbnRzWzFdKSkpLG48MCYmKG49cituKTtuPj0wO24tLSlpZihuIGluIGUmJmVbbl09PT10KXJldHVybiBufHwwO3JldHVybi0xfTokZix0bD1KZixlbD1scy5hVHlwZWRBcnJheTsoMCxscy5leHBvcnRUeXBlZEFycmF5TWV0aG9kKSgibGFzdEluZGV4T2YiLChmdW5jdGlvbih0KXtyZXR1cm4gdGwuYXBwbHkoZWwodGhpcyksYXJndW1lbnRzKX0pKTt2YXIgcmw9Rm4ubWFwLG5sPW5mLGlsPWxzLmFUeXBlZEFycmF5LGFsPWxzLmFUeXBlZEFycmF5Q29uc3RydWN0b3I7KDAsbHMuZXhwb3J0VHlwZWRBcnJheU1ldGhvZCkoIm1hcCIsKGZ1bmN0aW9uKHQpe3JldHVybiBybChpbCh0aGlzKSx0LGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwLChmdW5jdGlvbih0LGUpe3JldHVybiBuZXcoYWwobmwodCx0LmNvbnN0cnVjdG9yKSkpKGUpfSkpfSkpO3ZhciBvbD1NbixzbD1YLHVsPUYsY2w9T2UsZmw9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscixuLGkpe29sKHIpO3ZhciBhPXNsKGUpLG89dWwoYSkscz1jbChhLmxlbmd0aCksdT10P3MtMTowLGM9dD8tMToxO2lmKG48Milmb3IoOzspe2lmKHUgaW4gbyl7aT1vW3VdLHUrPWM7YnJlYWt9aWYodSs9Yyx0P3U8MDpzPD11KXRocm93IFR5cGVFcnJvcigiUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSIpfWZvcig7dD91Pj0wOnM+dTt1Kz1jKXUgaW4gbyYmKGk9cihpLG9bdV0sdSxhKSk7cmV0dXJuIGl9fSxsbD17bGVmdDpmbCghMSkscmlnaHQ6ZmwoITApfSxkbD1sbC5sZWZ0LGhsPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJyZWR1Y2UiLChmdW5jdGlvbih0KXtyZXR1cm4gZGwoaGwodGhpcyksdCxhcmd1bWVudHMubGVuZ3RoLGFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwKX0pKTt2YXIgcGw9bGwucmlnaHQsdmw9bHMuYVR5cGVkQXJyYXk7KDAsbHMuZXhwb3J0VHlwZWRBcnJheU1ldGhvZCkoInJlZHVjZVJpZ2h0IiwoZnVuY3Rpb24odCl7cmV0dXJuIHBsKHZsKHRoaXMpLHQsYXJndW1lbnRzLmxlbmd0aCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9KSk7dmFyIHlsPWxzLmFUeXBlZEFycmF5LGdsPWxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QsbWw9TWF0aC5mbG9vcjtnbCgicmV2ZXJzZSIsKGZ1bmN0aW9uKCl7Zm9yKHZhciB0LGU9dGhpcyxyPXlsKGUpLmxlbmd0aCxuPW1sKHIvMiksaT0wO2k8bjspdD1lW2ldLGVbaSsrXT1lWy0tcl0sZVtyXT10O3JldHVybiBlfSkpO3ZhciBibD1PZSx3bD1FdSxrbD1YLHhsPWxzLmFUeXBlZEFycmF5OygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJzZXQiLChmdW5jdGlvbih0KXt4bCh0aGlzKTt2YXIgZT13bChhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCwxKSxyPXRoaXMubGVuZ3RoLG49a2wodCksaT1ibChuLmxlbmd0aCksYT0wO2lmKGkrZT5yKXRocm93IFJhbmdlRXJyb3IoIldyb25nIGxlbmd0aCIpO2Zvcig7YTxpOyl0aGlzW2UrYV09blthKytdfSksTygoZnVuY3Rpb24oKXtuZXcgSW50OEFycmF5KDEpLnNldCh7fSl9KSkpO3ZhciBBbD1uZixTbD1scy5hVHlwZWRBcnJheSxfbD1scy5hVHlwZWRBcnJheUNvbnN0cnVjdG9yLFRsPVtdLnNsaWNlOygwLGxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QpKCJzbGljZSIsKGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPVRsLmNhbGwoU2wodGhpcyksdCxlKSxuPUFsKHRoaXMsdGhpcy5jb25zdHJ1Y3RvciksaT0wLGE9ci5sZW5ndGgsbz1uZXcoX2wobikpKGEpO2E+aTspb1tpXT1yW2krK107cmV0dXJuIG99KSxPKChmdW5jdGlvbigpe25ldyBJbnQ4QXJyYXkoMSkuc2xpY2UoKX0pKSk7dmFyIEVsPUZuLnNvbWUsSWw9bHMuYVR5cGVkQXJyYXk7KDAsbHMuZXhwb3J0VHlwZWRBcnJheU1ldGhvZCkoInNvbWUiLChmdW5jdGlvbih0KXtyZXR1cm4gRWwoSWwodGhpcyksdCxhcmd1bWVudHMubGVuZ3RoPjE/YXJndW1lbnRzWzFdOnZvaWQgMCl9KSk7dmFyIE9sPWxzLmFUeXBlZEFycmF5LE1sPVtdLnNvcnQ7KDAsbHMuZXhwb3J0VHlwZWRBcnJheU1ldGhvZCkoInNvcnQiLChmdW5jdGlvbih0KXtyZXR1cm4gTWwuY2FsbChPbCh0aGlzKSx0KX0pKTt2YXIgQ2w9T2UsUmw9QmUsQmw9bmYsUGw9bHMuYVR5cGVkQXJyYXk7KDAsbHMuZXhwb3J0VHlwZWRBcnJheU1ldGhvZCkoInN1YmFycmF5IiwoZnVuY3Rpb24odCxlKXt2YXIgcj1QbCh0aGlzKSxuPXIubGVuZ3RoLGk9UmwodCxuKTtyZXR1cm4gbmV3KEJsKHIsci5jb25zdHJ1Y3RvcikpKHIuYnVmZmVyLHIuYnl0ZU9mZnNldCtpKnIuQllURVNfUEVSX0VMRU1FTlQsQ2woKHZvaWQgMD09PWU/bjpSbChlLG4pKS1pKSl9KSk7dmFyIFVsPWxzLERsPU8semw9RS5JbnQ4QXJyYXksamw9VWwuYVR5cGVkQXJyYXksTGw9VWwuZXhwb3J0VHlwZWRBcnJheU1ldGhvZCxGbD1bXS50b0xvY2FsZVN0cmluZyxObD1bXS5zbGljZSxWbD0hIXpsJiZEbCgoZnVuY3Rpb24oKXtGbC5jYWxsKG5ldyB6bCgxKSl9KSk7TGwoInRvTG9jYWxlU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4gRmwuYXBwbHkoVmw/TmwuY2FsbChqbCh0aGlzKSk6amwodGhpcyksYXJndW1lbnRzKX0pLERsKChmdW5jdGlvbigpe3JldHVyblsxLDJdLnRvTG9jYWxlU3RyaW5nKCkhPW5ldyB6bChbMSwyXSkudG9Mb2NhbGVTdHJpbmcoKX0pKXx8IURsKChmdW5jdGlvbigpe3psLnByb3RvdHlwZS50b0xvY2FsZVN0cmluZy5jYWxsKFsxLDJdKX0pKSk7dmFyIEhsPWxzLmV4cG9ydFR5cGVkQXJyYXlNZXRob2QsWWw9TyxLbD1FLlVpbnQ4QXJyYXksV2w9S2wmJktsLnByb3RvdHlwZXx8e30sR2w9W10udG9TdHJpbmcscWw9W10uam9pbjtZbCgoZnVuY3Rpb24oKXtHbC5jYWxsKHt9KX0pKSYmKEdsPWZ1bmN0aW9uKCl7cmV0dXJuIHFsLmNhbGwodGhpcyl9KTt2YXIgWGw9V2wudG9TdHJpbmchPUdsO0hsKCJ0b1N0cmluZyIsR2wsWGwpO3ZhciAkbD12dCxRbD1mdW5jdGlvbigpe3ZhciB0PSRsKHRoaXMpLGU9IiI7cmV0dXJuIHQuZ2xvYmFsJiYoZSs9ImciKSx0Lmlnbm9yZUNhc2UmJihlKz0iaSIpLHQubXVsdGlsaW5lJiYoZSs9Im0iKSx0LmRvdEFsbCYmKGUrPSJzIiksdC51bmljb2RlJiYoZSs9InUiKSx0LnN0aWNreSYmKGUrPSJ5IiksZX0sWmw9U3QuZXhwb3J0cyxKbD12dCx0ZD1PLGVkPVFsLHJkPSJ0b1N0cmluZyIsbmQ9UmVnRXhwLnByb3RvdHlwZSxpZD1uZC50b1N0cmluZyxhZD10ZCgoZnVuY3Rpb24oKXtyZXR1cm4iL2EvYiIhPWlkLmNhbGwoe3NvdXJjZToiYSIsZmxhZ3M6ImIifSl9KSksb2Q9aWQubmFtZSE9cmQ7KGFkfHxvZCkmJlpsKFJlZ0V4cC5wcm90b3R5cGUscmQsKGZ1bmN0aW9uKCl7dmFyIHQ9SmwodGhpcyksZT1TdHJpbmcodC5zb3VyY2UpLHI9dC5mbGFncztyZXR1cm4iLyIrZSsiLyIrU3RyaW5nKHZvaWQgMD09PXImJnQgaW5zdGFuY2VvZiBSZWdFeHAmJiEoImZsYWdzImluIG5kKT9lZC5jYWxsKHQpOnIpfSkse3Vuc2FmZTohMH0pO3ZhciBzZD1icix1ZD1LLGNkPWtyLGZkPUJlLGxkPU9lLGRkPVksaGQ9X3IscGQ9S3IsdmQ9SnIoInNsaWNlIikseWQ9cGQoInNwZWNpZXMiKSxnZD1bXS5zbGljZSxtZD1NYXRoLm1heDtzZCh7dGFyZ2V0OiJBcnJheSIscHJvdG86ITAsZm9yY2VkOiF2ZH0se3NsaWNlOmZ1bmN0aW9uKHQsZSl7dmFyIHIsbixpLGE9ZGQodGhpcyksbz1sZChhLmxlbmd0aCkscz1mZCh0LG8pLHU9ZmQodm9pZCAwPT09ZT9vOmUsbyk7aWYoY2QoYSkmJigiZnVuY3Rpb24iIT10eXBlb2Yocj1hLmNvbnN0cnVjdG9yKXx8ciE9PUFycmF5JiYhY2Qoci5wcm90b3R5cGUpP3VkKHIpJiZudWxsPT09KHI9clt5ZF0pJiYocj12b2lkIDApOnI9dm9pZCAwLHI9PT1BcnJheXx8dm9pZCAwPT09cikpcmV0dXJuIGdkLmNhbGwoYSxzLHUpO2ZvcihuPW5ldyh2b2lkIDA9PT1yP0FycmF5OnIpKG1kKHUtcywwKSksaT0wO3M8dTtzKyssaSsrKXMgaW4gYSYmaGQobixpLGFbc10pO3JldHVybiBuLmxlbmd0aD1pLG59fSk7dmFyIGJkPU0sd2Q9aHQuZixrZD1GdW5jdGlvbi5wcm90b3R5cGUseGQ9a2QudG9TdHJpbmcsQWQ9L15ccypmdW5jdGlvbiAoW14gKF0qKS8sU2Q9Im5hbWUiO2JkJiYhKFNkIGluIGtkKSYmd2Qoa2QsU2Qse2NvbmZpZ3VyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIHhkLmNhbGwodGhpcykubWF0Y2goQWQpWzFdfWNhdGNoKF92KXtyZXR1cm4iIn19fSk7dmFyIF9kPWJyLFRkPVksRWQ9W10uam9pbixJZD1GIT1PYmplY3QsT2Q9Vm4oImpvaW4iLCIsIik7X2Qoe3RhcmdldDoiQXJyYXkiLHByb3RvOiEwLGZvcmNlZDpJZHx8IU9kfSx7am9pbjpmdW5jdGlvbih0KXtyZXR1cm4gRWQuY2FsbChUZCh0aGlzKSx2b2lkIDA9PT10PyIsIjp0KX19KTt2YXIgTWQ9e30sQ2Q9TztmdW5jdGlvbiBSZCh0LGUpe3JldHVybiBSZWdFeHAodCxlKX1NZC5VTlNVUFBPUlRFRF9ZPUNkKChmdW5jdGlvbigpe3ZhciB0PVJkKCJhIiwieSIpO3JldHVybiB0Lmxhc3RJbmRleD0yLG51bGwhPXQuZXhlYygiYWJjZCIpfSkpLE1kLkJST0tFTl9DQVJFVD1DZCgoZnVuY3Rpb24oKXt2YXIgdD1SZCgiXnIiLCJneSIpO3JldHVybiB0Lmxhc3RJbmRleD0yLG51bGwhPXQuZXhlYygic3RyIil9KSk7dmFyIEJkLFBkLFVkPVFsLERkPU1kLHpkPXp0LmV4cG9ydHMsamQ9UmVnRXhwLnByb3RvdHlwZS5leGVjLExkPXpkKCJuYXRpdmUtc3RyaW5nLXJlcGxhY2UiLFN0cmluZy5wcm90b3R5cGUucmVwbGFjZSksRmQ9amQsTmQ9KEJkPS9hLyxQZD0vYiovZyxqZC5jYWxsKEJkLCJhIiksamQuY2FsbChQZCwiYSIpLDAhPT1CZC5sYXN0SW5kZXh8fDAhPT1QZC5sYXN0SW5kZXgpLFZkPURkLlVOU1VQUE9SVEVEX1l8fERkLkJST0tFTl9DQVJFVCxIZD12b2lkIDAhPT0vKCk/Py8uZXhlYygiIilbMV07KE5kfHxIZHx8VmQpJiYoRmQ9ZnVuY3Rpb24odCl7dmFyIGUscixuLGksYT10aGlzLG89VmQmJmEuc3RpY2t5LHM9VWQuY2FsbChhKSx1PWEuc291cmNlLGM9MCxmPXQ7cmV0dXJuIG8mJigtMT09PShzPXMucmVwbGFjZSgieSIsIiIpKS5pbmRleE9mKCJnIikmJihzKz0iZyIpLGY9U3RyaW5nKHQpLnNsaWNlKGEubGFzdEluZGV4KSxhLmxhc3RJbmRleD4wJiYoIWEubXVsdGlsaW5lfHxhLm11bHRpbGluZSYmIlxuIiE9PXRbYS5sYXN0SW5kZXgtMV0pJiYodT0iKD86ICIrdSsiKSIsZj0iICIrZixjKyspLHI9bmV3IFJlZ0V4cCgiXig/OiIrdSsiKSIscykpLEhkJiYocj1uZXcgUmVnRXhwKCJeIit1KyIkKD8hXFxzKSIscykpLE5kJiYoZT1hLmxhc3RJbmRleCksbj1qZC5jYWxsKG8/cjphLGYpLG8/bj8obi5pbnB1dD1uLmlucHV0LnNsaWNlKGMpLG5bMF09blswXS5zbGljZShjKSxuLmluZGV4PWEubGFzdEluZGV4LGEubGFzdEluZGV4Kz1uWzBdLmxlbmd0aCk6YS5sYXN0SW5kZXg9MDpOZCYmbiYmKGEubGFzdEluZGV4PWEuZ2xvYmFsP24uaW5kZXgrblswXS5sZW5ndGg6ZSksSGQmJm4mJm4ubGVuZ3RoPjEmJkxkLmNhbGwoblswXSxyLChmdW5jdGlvbigpe2ZvcihpPTE7aTxhcmd1bWVudHMubGVuZ3RoLTI7aSsrKXZvaWQgMD09PWFyZ3VtZW50c1tpXSYmKG5baV09dm9pZCAwKX0pKSxufSk7YnIoe3RhcmdldDoiUmVnRXhwIixwcm90bzohMCxmb3JjZWQ6Ly4vLmV4ZWMhPT1GZH0se2V4ZWM6RmR9KTt2YXIgWWQsS2QsV2Q9YnIsR2Q9SyxxZD0oWWQ9ITEsKEtkPS9bYWNdLykuZXhlYz1mdW5jdGlvbigpe3JldHVybiBZZD0hMCwvLi8uZXhlYy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LCEwPT09S2QudGVzdCgiYWJjIikmJllkKSxYZD0vLi8udGVzdDtXZCh7dGFyZ2V0OiJSZWdFeHAiLHByb3RvOiEwLGZvcmNlZDohcWR9LHt0ZXN0OmZ1bmN0aW9uKHQpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0aGlzLmV4ZWMpcmV0dXJuIFhkLmNhbGwodGhpcyx0KTt2YXIgZT10aGlzLmV4ZWModCk7aWYobnVsbCE9PWUmJiFHZChlKSl0aHJvdyBuZXcgRXJyb3IoIlJlZ0V4cCBleGVjIG1ldGhvZCByZXR1cm5lZCBzb21ldGhpbmcgb3RoZXIgdGhhbiBhbiBPYmplY3Qgb3IgbnVsbCIpO3JldHVybiEhZX19KTt2YXIgJGQ9InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3csUWQ9JGQmJm5hdmlnYXRvci51c2VyQWdlbnQudG9Mb2NhbGVMb3dlckNhc2UoKTskZCYmL14oKD8hY2hyb21lfGFuZHJvaWQpLikqc2FmYXJpLy50ZXN0KFFkKTt2YXIgWmQ9JGQmJlFkLmluY2x1ZGVzKCJmaXJlZm94IiksSmQ9JGQmJlFkLmluY2x1ZGVzKCJhbmRyb2lkIiksdGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7Zyh0aGlzLHQpfXJldHVybiBiKHQsbnVsbCxbe2tleToiZ2V0UmF0ZUluZGV4QnlSYXRlIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdC5GUkVRLmluZGV4T2YoZSl9fSx7a2V5OiJwYXJzZUFEVFMiLHZhbHVlOmZ1bmN0aW9uKGUscil7Zm9yKHZhciBuPWUubGVuZ3RoLGk9MDtpKzI8biYmKDI1NSE9PWVbaV18fDI0MCE9KDI0NiZlW2krMV0pKTspaSsrO2lmKCEoaT49bikpe3ZhciBhPWksbz1bXSxzPSg2MCZlW2krMl0pPj4+Mix1PXQuRlJFUVtzXTtpZighdSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc2FtcGxpbmcgaW5kZXg6ICIuY29uY2F0KHMpKTtmb3IodmFyIGMsZixsPTErKCgxOTImZVtpKzJdKT4+PjYpLGQ9KDEmZVtpKzJdKTw8MnwoMTkyJmVbaSszXSk+Pj42LGg9dC5fZ2V0Q29uZmlnKHMsZCxsKSxwPWguY29uZmlnLHY9aC5jb2RlYyx5PTAsZz10LmdldEZyYW1lRHVyYXRpb24odSk7aSs3PG47KWlmKDI1NT09PWVbaV0mJjI0MD09KDI0NiZlW2krMV0pKXtpZihuLWk8KGY9KDMmZVtpKzNdKTw8MTF8ZVtpKzRdPDwzfCgyMjQmZVtpKzVdKT4+NSkpYnJlYWs7Yz0yKigxJn5lW2krMV0pLG8ucHVzaCh7cHRzOnIreSpnLGRhdGE6ZS5zdWJhcnJheShpKzcrYyxpK2YpfSkseSsrLGkrPWZ9ZWxzZSBpKys7cmV0dXJue3NraXA6YSxyZW1haW5pbmc6aT49bj92b2lkIDA6ZS5zdWJhcnJheShpKSxmcmFtZXM6byxzYW1wbGluZ0ZyZXF1ZW5jeUluZGV4OnMsc2FtcGxlUmF0ZTp1LG9iamVjdFR5cGU6bCxjaGFubmVsQ291bnQ6ZCxjb2RlYzp2LGNvbmZpZzpwLG9yaWdpbkNvZGVjOiJtcDRhLjQwLiIuY29uY2F0KGwpfX19fSx7a2V5OiJwYXJzZUF1ZGlvU3BlY2lmaWNDb25maWciLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKGUubGVuZ3RoKXt2YXIgcj1lWzBdPj4+MyxuPSg3JmVbMF0pPDwxfGVbMV0+Pj43LGk9KDEyMCZlWzFdKT4+PjMsYT10LkZSRVFbbl07aWYoIWEpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHNhbXBsaW5nIGluZGV4OiAiLmNvbmNhdChuKSk7dmFyIG89dC5fZ2V0Q29uZmlnKG4saSxyKTtyZXR1cm57c2FtcGxpbmdGcmVxdWVuY3lJbmRleDpuLHNhbXBsZVJhdGU6YSxvYmplY3RUeXBlOnIsY2hhbm5lbENvdW50OmksY29uZmlnOm8uY29uZmlnLGNvZGVjOm8uY29kZWMsb3JpZ2luQ29kZWM6Im1wNGEuNDAuIi5jb25jYXQocil9fX19LHtrZXk6ImdldEZyYW1lRHVyYXRpb24iLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo5ZTQ7cmV0dXJuIDEwMjQqZS90fX0se2tleToiX2dldENvbmZpZyIsdmFsdWU6ZnVuY3Rpb24odCxlLHIpe3ZhciBuLGksYT1bXTtyZXR1cm4gWmQ/dD49Nj8obj01LGk9dC0zKToobj0yLGk9dCk6SmQ/KG49MixpPXQpOihuPTI9PT1yfHw1PT09cj9yOjUsaT10LHQ+PTY/aT10LTM6MT09PWUmJihuPTIsaT10KSksYVswXT1uPDwzLGFbMF18PSgxNCZ0KT4+MSxhWzFdPSgxJnQpPDw3LGFbMV18PWU8PDMsNT09PW4mJihhWzFdfD0oMTQmaSk+PjEsYVsyXT0oMSZpKTw8NyxhWzJdfD04LGFbM109MCkse2NvbmZpZzphLGNvZGVjOiJtcDRhLjQwLiIuY29uY2F0KG4pfX19LHtrZXk6ImdldFNpbGVudEZyYW1lIix2YWx1ZTpmdW5jdGlvbih0LGUpe2lmKCJtcDRhLjQwLjIiPT09dCl7aWYoMT09PWUpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzNSwxMjhdKTtpZigyPT09ZSlyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzMzLDAsNzMsMTQ0LDIsMjUsMCwzNSwxMjhdKTtpZigzPT09ZSlyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoWzAsMjAwLDAsMTI4LDMyLDEzMiwxLDM4LDY0LDgsMTAwLDAsMTQyXSk7aWYoND09PWUpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEyOCw0NCwxMjgsOCwyLDU2XSk7aWYoNT09PWUpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEzMCw0OCw0LDE1MywwLDMzLDE0NCwyLDU2XSk7aWYoNj09PWUpcmV0dXJuIG5ldyBVaW50OEFycmF5KFswLDIwMCwwLDEyOCwzMiwxMzIsMSwzOCw2NCw4LDEwMCwwLDEzMCw0OCw0LDE1MywwLDMzLDE0NCwyLDAsMTc4LDAsMzIsOCwyMjRdKX1lbHNle2lmKDE9PT1lKXJldHVybiBuZXcgVWludDhBcnJheShbMSw2NCwzNCwxMjgsMTYzLDc4LDIzMCwxMjgsMTg2LDgsMCwwLDAsMjgsNiwyNDEsMTkzLDEwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDkwLDk0XSk7aWYoMj09PWUpcmV0dXJuIG5ldyBVaW50OEFycmF5KFsxLDY0LDM0LDEyOCwxNjMsOTQsMjMwLDEyOCwxODYsOCwwLDAsMCwwLDE0OSwwLDYsMjQxLDE2MSwxMCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5MCw5NF0pO2lmKDM9PT1lKXJldHVybiBuZXcgVWludDhBcnJheShbMSw2NCwzNCwxMjgsMTYzLDk0LDIzMCwxMjgsMTg2LDgsMCwwLDAsMCwxNDksMCw2LDI0MSwxNjEsMTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTAsOTRdKX19fV0pLHR9KCk7ZnVuY3Rpb24gZWgoKXtmb3IodmFyIHQ9YXJndW1lbnRzLmxlbmd0aCxlPW5ldyBBcnJheSh0KSxyPTA7cjx0O3IrKyllW3JdPWFyZ3VtZW50c1tyXTtlPWUuZmlsdGVyKEJvb2xlYW4pO3ZhciBuPW5ldyBVaW50OEFycmF5KGUucmVkdWNlKChmdW5jdGlvbih0LGUpe3JldHVybiB0K2UuYnl0ZUxlbmd0aH0pLDApKSxpPTA7cmV0dXJuIGUuZm9yRWFjaCgoZnVuY3Rpb24odCl7bi5zZXQodCxpKSxpKz10LmJ5dGVMZW5ndGh9KSksbn13KHRoLCJGUkVRIixbOTZlMyw4ODIwMCw2NGUzLDQ4ZTMsNDQxMDAsMzJlMywyNGUzLDIyMDUwLDE2ZTMsMTJlMywxMTAyNSw4ZTMsNzM1MF0pO3ZhciByaD1NYXRoLnBvdygyLDMyKTtmdW5jdGlvbiBuaCh0KXt2YXIgZT1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MDtyZXR1cm4odFtlXTw8OCkrKHRbZSsxXXx8MCl9ZnVuY3Rpb24gaWgodCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjA7cmV0dXJuKHRbZV08PDI0Pj4+MCkrKHRbZSsxXTw8MTYpKyh0W2UrMl08PDgpKyh0W2UrM118fDApfWZ1bmN0aW9uIGFoKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTowO3JldHVybiBpaCh0LGUpKnJoK2loKHQsZSs0KX1mdW5jdGlvbiBvaCh0KXt2YXIgZT0iIjtpZih0LmZvckVhY2goKGZ1bmN0aW9uKHQpe2UrPWZ1bmN0aW9uKHQpe3JldHVybigiMCIrTnVtYmVyKHQpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpLnRvVXBwZXJDYXNlKCl9KHQpfSkpLGUubGVuZ3RoPD0zMilmb3IodmFyIHI9MzItZS5sZW5ndGgsbj0wO248cjtuKyspZSs9IjAiO3JldHVybiBlfWZ1bmN0aW9uIHNoKHQpe2lmKCFBcnJheS5pc0FycmF5KHQpKXtmb3IodmFyIGU9W10scj0iIixuPTA7bjx0Lmxlbmd0aDtuKyspbiUyJiYocj10W24tMV0rdFtuXSxlLnB1c2gocGFyc2VJbnQociwxNikpLHI9IiIpO3JldHVybiBlfXJldHVybiB0Lm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuIHBhcnNlSW50KHQsMTYpfSkpfXZhciB1aD1NLGNoPWh0LGZoPVFsLGxoPU1kLlVOU1VQUE9SVEVEX1k7dWgmJigiZyIhPS8uL2cuZmxhZ3N8fGxoKSYmY2guZihSZWdFeHAucHJvdG90eXBlLCJmbGFncyIse2NvbmZpZ3VyYWJsZTohMCxnZXQ6Zmh9KTt2YXIgZGg9RSxoaD1PbixwaD1Jbyx2aD1BdCx5aD1LcixnaD15aCgiaXRlcmF0b3IiKSxtaD15aCgidG9TdHJpbmdUYWciKSxiaD1waC52YWx1ZXM7Zm9yKHZhciB3aCBpbiBoaCl7dmFyIGtoPWRoW3doXSx4aD1raCYma2gucHJvdG90eXBlO2lmKHhoKXtpZih4aFtnaF0hPT1iaCl0cnl7dmgoeGgsZ2gsYmgpfWNhdGNoKF92KXt4aFtnaF09Ymh9aWYoeGhbbWhdfHx2aCh4aCxtaCx3aCksaGhbd2hdKWZvcih2YXIgQWggaW4gcGgpaWYoeGhbQWhdIT09cGhbQWhdKXRyeXt2aCh4aCxBaCxwaFtBaF0pfWNhdGNoKF92KXt4aFtBaF09cGhbQWhdfX19dmFyIFNoPVRlLF9oPU4sVGg9T2UsRWg9ZnVuY3Rpb24odCl7dmFyIGU9U3RyaW5nKF9oKHRoaXMpKSxyPSIiLG49U2godCk7aWYobjwwfHxuPT0xLzApdGhyb3cgUmFuZ2VFcnJvcigiV3JvbmcgbnVtYmVyIG9mIHJlcGV0aXRpb25zIik7Zm9yKDtuPjA7KG4+Pj49MSkmJihlKz1lKSkxJm4mJihyKz1lKTtyZXR1cm4gcn0sSWg9TixPaD1NYXRoLmNlaWwsTWg9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscixuKXt2YXIgaSxhLG89U3RyaW5nKEloKGUpKSxzPW8ubGVuZ3RoLHU9dm9pZCAwPT09bj8iICI6U3RyaW5nKG4pLGM9VGgocik7cmV0dXJuIGM8PXN8fCIiPT11P286KGk9Yy1zLChhPUVoLmNhbGwodSxPaChpL3UubGVuZ3RoKSkpLmxlbmd0aD5pJiYoYT1hLnNsaWNlKDAsaSkpLHQ/bythOmErbyl9fSxDaD17c3RhcnQ6TWgoITEpLGVuZDpNaCghMCl9LFJoPS9WZXJzaW9uXC8xMCg/OlwuXGQrKXsxLDJ9KD86IFtcdy4vXSspPyg/OiBNb2JpbGVcL1x3Kyk/IFNhZmFyaVwvLy50ZXN0KFRyKSxCaD1DaC5zdGFydDticih7dGFyZ2V0OiJTdHJpbmciLHByb3RvOiEwLGZvcmNlZDpSaH0se3BhZFN0YXJ0OmZ1bmN0aW9uKHQpe3JldHVybiBCaCh0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pO3ZhciBQaD1icixVaD1Gbi5maW5kLERoPUFpLHpoPSJmaW5kIixqaD0hMDt6aCBpbltdJiZBcnJheSgxKS5maW5kKChmdW5jdGlvbigpe2poPSExfSkpLFBoKHt0YXJnZXQ6IkFycmF5Iixwcm90bzohMCxmb3JjZWQ6amh9LHtmaW5kOmZ1bmN0aW9uKHQpe3JldHVybiBVaCh0aGlzLHQsYXJndW1lbnRzLmxlbmd0aD4xP2FyZ3VtZW50c1sxXTp2b2lkIDApfX0pLERoKHpoKTt2YXIgTGg9dnQsRmg9dnQsTmg9ZnVuY3Rpb24odCl7dmFyIGU9dC5yZXR1cm47aWYodm9pZCAwIT09ZSlyZXR1cm4gTGgoZS5jYWxsKHQpKS52YWx1ZX0sVmg9Um4sSGg9WCxZaD1mdW5jdGlvbih0LGUscixuKXt0cnl7cmV0dXJuIG4/ZShGaChyKVswXSxyWzFdKTplKHIpfWNhdGNoKF92KXt0aHJvdyBOaCh0KSxfdn19LEtoPVV1LFdoPU9lLEdoPV9yLHFoPUN1LFhoPWZ1bmN0aW9uKHQpe3ZhciBlLHIsbixpLGEsbyxzPUhoKHQpLHU9ImZ1bmN0aW9uIj09dHlwZW9mIHRoaXM/dGhpczpBcnJheSxjPWFyZ3VtZW50cy5sZW5ndGgsZj1jPjE/YXJndW1lbnRzWzFdOnZvaWQgMCxsPXZvaWQgMCE9PWYsZD1xaChzKSxoPTA7aWYobCYmKGY9VmgoZixjPjI/YXJndW1lbnRzWzJdOnZvaWQgMCwyKSksbnVsbD09ZHx8dT09QXJyYXkmJktoKGQpKWZvcihyPW5ldyB1KGU9V2gocy5sZW5ndGgpKTtlPmg7aCsrKW89bD9mKHNbaF0saCk6c1toXSxHaChyLGgsbyk7ZWxzZSBmb3IoYT0oaT1kLmNhbGwocykpLm5leHQscj1uZXcgdTshKG49YS5jYWxsKGkpKS5kb25lO2grKylvPWw/WWgoaSxmLFtuLnZhbHVlLGhdLCEwKTpuLnZhbHVlLEdoKHIsaCxvKTtyZXR1cm4gci5sZW5ndGg9aCxyfTticih7dGFyZ2V0OiJBcnJheSIsc3RhdDohMCxmb3JjZWQ6IVVvKChmdW5jdGlvbih0KXtBcnJheS5mcm9tKHQpfSkpfSx7ZnJvbTpYaH0pO3ZhciAkaD1UZSxRaD1OLFpoPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3ZhciBuLGksYT1TdHJpbmcoUWgoZSkpLG89JGgocikscz1hLmxlbmd0aDtyZXR1cm4gbzwwfHxvPj1zP3Q/IiI6dm9pZCAwOihuPWEuY2hhckNvZGVBdChvKSk8NTUyOTZ8fG4+NTYzMTl8fG8rMT09PXN8fChpPWEuY2hhckNvZGVBdChvKzEpKTw1NjMyMHx8aT41NzM0Mz90P2EuY2hhckF0KG8pOm46dD9hLnNsaWNlKG8sbysyKTppLTU2MzIwKyhuLTU1Mjk2PDwxMCkrNjU1MzZ9fSxKaD17Y29kZUF0OlpoKCExKSxjaGFyQXQ6WmgoITApfS5jaGFyQXQsdHA9ZmUsZXA9Ym8scnA9IlN0cmluZyBJdGVyYXRvciIsbnA9dHAuc2V0LGlwPXRwLmdldHRlckZvcihycCk7ZXAoU3RyaW5nLCJTdHJpbmciLChmdW5jdGlvbih0KXtucCh0aGlzLHt0eXBlOnJwLHN0cmluZzpTdHJpbmcodCksaW5kZXg6MH0pfSksKGZ1bmN0aW9uKCl7dmFyIHQsZT1pcCh0aGlzKSxyPWUuc3RyaW5nLG49ZS5pbmRleDtyZXR1cm4gbj49ci5sZW5ndGg/e3ZhbHVlOnZvaWQgMCxkb25lOiEwfToodD1KaChyLG4pLGUuaW5kZXgrPXQubGVuZ3RoLHt2YWx1ZTp0LGRvbmU6ITF9KX0pKTt2YXIgYXA9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KCl7Zyh0aGlzLHQpfXJldHVybiBiKHQsbnVsbCxbe2tleToiZmluZEJveCIsdmFsdWU6ZnVuY3Rpb24oZSxyKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06MCxpPVtdO2lmKCFlKXJldHVybiBpO2Zvcih2YXIgYT0wLG89IiIscz0wO2UubGVuZ3RoPjc7KXtpZihhPWloKGUpLG89U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLGUuc3ViYXJyYXkoNCw4KSkscz04LDE9PT1hPyhhPWFoKGUsOCkscys9OCk6YXx8KGE9ZS5sZW5ndGgpLCFyWzBdfHxvPT09clswXSl7dmFyIHU9ZS5zdWJhcnJheSgwLGEpO2lmKCEoci5sZW5ndGg8MikpcmV0dXJuIHQuZmluZEJveCh1LnN1YmFycmF5KHMpLHIuc2xpY2UoMSksbitzKTtpLnB1c2goe3N0YXJ0Om4sc2l6ZTphLGhlYWRlclNpemU6cyx0eXBlOm8sZGF0YTp1fSl9bis9YSxlPWUuc3ViYXJyYXkoYSl9cmV0dXJuIGl9fSx7a2V5OiJ0ZmhkIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXt0LnRyYWNrSWQ9aWgoZSk7dmFyIHI9NCxuPTEmdC5mbGFncyxpPTImdC5mbGFncyxhPTgmdC5mbGFncyxvPTE2JnQuZmxhZ3Mscz0zMiZ0LmZsYWdzO24mJihyKz00LHQuYmFzZURhdGFPZmZzZXQ9aWgoZSxyKSxyKz00KSxpJiYodC5zYW1wbGVEZXNjcmlwdGlvbkluZGV4PWloKGUscikscis9NCksYSYmKHQuZGVmYXVsdFNhbXBsZUR1cmF0aW9uPWloKGUscikscis9NCksbyYmKHQuZGVmYXVsdFNhbXBsZVNpemU9aWgoZSxyKSxyKz00KSxzJiYodC5kZWZhdWx0U2FtcGxlRmxhZ3M9aWgoZSxyKSl9KSl9fSx7a2V5OiJzaWR4Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXt2YXIgcj0wO3QucmVmZXJlbmNlX0lEPWloKGUscikscis9NCx0LnRpbWVzY2FsZT1paChlLHIpLHIrPTQsMD09PXQudmVyc2lvbj8odC5lYXJsaWVzdF9wcmVzZW50YXRpb25fdGltZT1paChlLHIpLHIrPTQsdC5maXJzdF9vZmZzZXQ9aWgoZSxyKSxyKz00KToodC5lYXJsaWVzdF9wcmVzZW50YXRpb25fdGltZT1haChlLHIpLHIrPTgsdC5maXJzdF9vZmZzZXQ9YWgoZSxyKSxyKz04KSxyKz0yLHQucmVmZXJlbmNlcz1bXTt2YXIgbj1uaChlLHIpO3IrPTI7Zm9yKHZhciBpPTA7aTxuO2krKyl7dmFyIGE9e307dC5yZWZlcmVuY2VzLnB1c2goYSk7dmFyIG89aWgoZSxyKTtyKz00LGEucmVmZXJlbmNlX3R5cGU9bz4+MzEmMSxhLnJlZmVyZW5jZWRfc2l6ZT0yMTQ3NDgzNjQ3Jm8sYS5zdWJzZWdtZW50X2R1cmF0aW9uPWloKGUsciksbz1paChlLHIrPTQpLHIrPTQsYS5zdGFydHNfd2l0aF9TQVA9bz4+MzEmMSxhLlNBUF90eXBlPW8+PjI4JjcsYS5TQVBfZGVsdGFfdGltZT0yNjg0MzU0NTUmb319KSl9fSx7a2V5OiJtb292Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gY3AoZSwhMSwoZnVuY3Rpb24oZSxyLG4pe2UubXZoZD10Lm12aGQodC5maW5kQm94KHIsWyJtdmhkIl0sbilbMF0pLGUudHJhaz10LmZpbmRCb3gocixbInRyYWsiXSxuKS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiB0LnRyYWsoZSl9KSksZS5wc3NoPXQucHNzaCh0LmZpbmRCb3gocixbInBzc2giXSxuKVswXSl9KSl9fSx7a2V5OiJtdmhkIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXt2YXIgcj0wOzE9PT10LnZlcnNpb24/KHQudGltZXNjYWxlPWloKGUsMTYpLHQuZHVyYXRpb249YWgoZSwyMCkscis9MjgpOih0LnRpbWVzY2FsZT1paChlLDgpLHQuZHVyYXRpb249aWgoZSwxMikscis9MTYpLHQubmV4dFRyYWNrSWQ9aWgoZSxyKzc2KX0pKX19LHtrZXk6InRyYWsiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBjcChlLCExLChmdW5jdGlvbihlLHIsbil7ZS50a2hkPXQudGtoZCh0LmZpbmRCb3gocixbInRraGQiXSxuKVswXSksZS5tZGlhPXQubWRpYSh0LmZpbmRCb3gocixbIm1kaWEiXSxuKVswXSl9KSl9fSx7a2V5OiJ0a2hkIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXt2YXIgcj0wOzE9PT10LnZlcnNpb24/KHQudHJhY2tJZD1paChlLDE2KSx0LmR1cmF0aW9uPWFoKGUsMjQpLHIrPTMyKToodC50cmFja0lkPWloKGUsOCksdC5kdXJhdGlvbj1paChlLDE2KSxyKz0yMCksdC53aWR0aD1paChlLHIrNTIpLHQuaGVpZ2h0PWloKGUscis1Nil9KSl9fSx7a2V5OiJtZGlhIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gY3AoZSwhMSwoZnVuY3Rpb24oZSxyLG4pe2UubWRoZD10Lm1kaGQodC5maW5kQm94KHIsWyJtZGhkIl0sbilbMF0pLGUuaGRscj10LmhkbHIodC5maW5kQm94KHIsWyJoZGxyIl0sbilbMF0pLGUubWluZj10Lm1pbmYodC5maW5kQm94KHIsWyJtaW5mIl0sbilbMF0pfSkpfX0se2tleToibWRoZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7dmFyIHI9MDsxPT09dC52ZXJzaW9uPyh0LnRpbWVzY2FsZT1paChlLDE2KSx0LmR1cmF0aW9uPWFoKGUsMjApLHIrPTI4KToodC50aW1lc2NhbGU9aWgoZSw4KSx0LmR1cmF0aW9uPWloKGUsMTIpLHIrPTE2KTt2YXIgbj1uaChlLHIpO3QubGFuZ3VhZ2U9U3RyaW5nLmZyb21DaGFyQ29kZSg5Nisobj4+MTAmMzEpLDk2KyhuPj41JjMxKSw5NisoMzEmbikpfSkpfX0se2tleToiaGRsciIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7MD09PXQudmVyc2lvbiYmKHQuaGFuZGxlclR5cGU9U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLGUuc3ViYXJyYXkoNCw4KSkpfSkpfX0se2tleToibWluZiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGNwKGUsITEsKGZ1bmN0aW9uKGUscixuKXtlLnZtaGQ9dC52bWhkKHQuZmluZEJveChyLFsidm1oZCJdLG4pWzBdKSxlLnNtaGQ9dC5zbWhkKHQuZmluZEJveChyLFsic21oZCJdLG4pWzBdKSxlLnN0Ymw9dC5zdGJsKHQuZmluZEJveChyLFsic3RibCJdLG4pWzBdKX0pKX19LHtrZXk6InZtaGQiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBjcCh0LCEwLChmdW5jdGlvbih0LGUpe3QuZ3JhcGhpY3Ntb2RlPW5oKGUpLHQub3Bjb2xvcj1bbmgoZSwyKSxuaChlLDQpLG5oKGUsNildfSkpfX0se2tleToic21oZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7dC5iYWxhbmNlPW5oKGUpfSkpfX0se2tleToic3RibCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGNwKGUsITEsKGZ1bmN0aW9uKGUscixuKXtlLnN0c2Q9dC5zdHNkKHQuZmluZEJveChyLFsic3RzZCJdLG4pWzBdKSxlLnN0dHM9dC5zdHRzKHQuZmluZEJveChyLFsic3R0cyJdLG4pWzBdKSxlLmN0dHM9dC5jdHRzKHQuZmluZEJveChyLFsiY3R0cyJdLG4pWzBdKSxlLnN0c2M9dC5zdHNjKHQuZmluZEJveChyLFsic3RzYyJdLG4pWzBdKSxlLnN0c3o9dC5zdHN6KHQuZmluZEJveChyLFsic3RzeiJdLG4pWzBdKSxlLnN0Y289dC5zdGNvKHQuZmluZEJveChyLFsic3RjbyJdLG4pWzBdKSxlLnN0Y298fChlLmNvNjQ9dC5jbzY0KHQuZmluZEJveChyLFsiY282NCJdLG4pWzBdKSxlLnN0Y289ZS5jbzY0KSxlLnN0c3M9dC5zdHNzKHQuZmluZEJveChyLFsic3RzcyJdLG4pWzBdKSxlLnNlbmM9dC5zZW5jKHQuZmluZEJveChyLFsic2VuYyJdLG4pWzBdKX0pKX19LHtrZXk6InNlbmMiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBjcCh0LCEwLChmdW5jdGlvbih0LGUpe3ZhciByPTAsbj1paChlLHIpO3IrPTQsdC5zYW1wbGVzPVtdO2Zvcih2YXIgaT0wO2k8bjtpKyspe3ZhciBhPXt9O2lmKGEuSW5pdGlhbGl6YXRpb25WZWN0b3I9W2Vbcl0sZVtyKzFdLGVbcisyXSxlW3IrM10sZVtyKzRdLGVbcis1XSxlW3IrNl0sZVtyKzddXSxyKz04LDImdC5mbGFncyl7YS5zdWJzYW1wbGVzPVtdO3ZhciBvPW5oKGUscik7cis9Mjtmb3IodmFyIHM9MDtzPG87cysrKXt2YXIgdT17fTt1LkJ5dGVzT2ZDbGVhckRhdGE9bmgoZSxyKSxyKz0yLHUuQnl0ZXNPZlByb3RlY3RlZERhdGE9aWgoZSxyKSxyKz00LGEuc3Vic2FtcGxlcy5wdXNoKHUpfX10LnNhbXBsZXMucHVzaChhKX19KSl9fSx7a2V5OiJwc3NoIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9W10sbj1bXSxpPTAsYT0wO2E8MTY7YSsrKW4ucHVzaChscChlW2krYV0pKTtpZihpKz0xNix0LnZlcnNpb24+MCl7dmFyIG89aWgoZSxpKTtpKz00O2Zvcih2YXIgcz0wO3M8KCIiK28pLmxlbmd0aDtzKyspZm9yKHZhciB1PTA7dTwxNjt1Kyspe3ZhciBjPWVbaV07aSs9MSxyLnB1c2gobHAoYykpfX12YXIgZj1paChlLGkpO3QuZGF0YV9zaXplPWYsaSs9NCx0LmtpZD1yLHQuc3lzdGVtX2lkPW4sdC5idWZmZXI9ZX0pKX19LHtrZXk6InN0c2QiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBjcChlLCEwLChmdW5jdGlvbihlLHIsbil7ZS5lbnRyeUNvdW50PWloKHIpLGUuZW50cmllcz10LmZpbmRCb3goci5zdWJhcnJheSg0KSxbXSxuKzQpLm1hcCgoZnVuY3Rpb24oZSl7c3dpdGNoKGUudHlwZSl7Y2FzZSJhdmMxIjpjYXNlImF2YzIiOmNhc2UiYXZjMyI6Y2FzZSJhdmM0IjpyZXR1cm4gdC5hdmMxKGUpO2Nhc2UiaHZjMSI6Y2FzZSJoZXYxIjpyZXR1cm4gdC5odmMxKGUpO2Nhc2UibXA0YSI6cmV0dXJuIHQubXA0YShlKTtjYXNlImFsYXciOmNhc2UidWxhdyI6cmV0dXJuIHQuYWxhdyhlKTtjYXNlImVuY2EiOnJldHVybiBjcChlLCExLChmdW5jdGlvbihlLHIsbil7ZS5jaGFubmVsQ291bnQ9bmgociwxNiksZS5zYW1wbGVzaXplPW5oKHIsMTgpLGUuc2FtcGxlUmF0ZT1paChyLDI0KS82NTUzNixyPXIuc3ViYXJyYXkoMjgpLGUuc2luZj10LnNpbmYodC5maW5kQm94KHIsWyJzaW5mIl0sbilbMF0pLGUuZXNkcz10LmVzZHModC5maW5kQm94KHIsWyJlc2RzIl0sbilbMF0pfSkpO2Nhc2UiZW5jdiI6cmV0dXJuIGNwKGUsITEsKGZ1bmN0aW9uKGUscixuKXtlLndpZHRoPW5oKHIsMjQpLGUuaGVpZ2h0PW5oKHIsMjYpLGUuaG9yaXpyZXNvbHV0aW9uPWloKHIsMjgpLGUudmVydHJlc29sdXRpb249aWgociwzMikscj1yLnN1YmFycmF5KDc4KSxlLnNpbmY9dC5zaW5mKHQuZmluZEJveChyLFsic2luZiJdLG4pWzBdKSxlLmF2Y0M9dC5hdmNDKHQuZmluZEJveChyLFsiYXZjQyJdLG4pWzBdKSxlLmh2Y0M9dC5odmNDKHQuZmluZEJveChyLFsiaHZjQyJdLG4pWzBdKSxlLnBhc3A9dC5wYXNwKHQuZmluZEJveChyLFsicGFzcCJdLG4pWzBdKX0pKX19KSkuZmlsdGVyKEJvb2xlYW4pfSkpfX0se2tleToidGVuYyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITEsKGZ1bmN0aW9uKHQsZSl7dmFyIHI9Njt0LmRlZmF1bHRfSXNFbmNyeXB0ZWQ9ZVtyXSxyKz0xLHQuZGVmYXVsdF9JVl9zaXplPWVbcl0scis9MSx0LmRlZmF1bHRfS0lEPVtdO2Zvcih2YXIgbj0wO248MTY7bisrKXQuZGVmYXVsdF9LSUQucHVzaChscChlW3JdKSkscis9MX0pKX19LHtrZXk6InNjaGkiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBjcChlLCExLChmdW5jdGlvbihlLHIsbil7ZS50ZW5jPXQudGVuYyh0LmZpbmRCb3gocixbInRlbmMiXSxuKVswXSl9KSl9fSx7a2V5OiJzaW5mIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gY3AoZSwhMSwoZnVuY3Rpb24oZSxyLG4pe2Uuc2NoaT10LnNjaGkodC5maW5kQm94KHIsWyJzY2hpIl0sbilbMF0pLGUuZnJtYT10LmZybWEodC5maW5kQm94KHIsWyJmcm1hIl0sbilbMF0pfSkpfX0se2tleToiZnJtYSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITEsKGZ1bmN0aW9uKHQsZSl7dC5kYXRhX2Zvcm1hdD0iIjtmb3IodmFyIHI9MDtyPDQ7cisrKXQuZGF0YV9mb3JtYXQrPVN0cmluZy5mcm9tQ2hhckNvZGUoZVtyXSl9KSl9fSx7a2V5OiJhdmMxIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gY3AoZSwhMSwoZnVuY3Rpb24oZSxyLG4pe3ZhciBpPXNwKGUsciksYT1yLnN1YmFycmF5KGkpO24rPWksZS5hdmNDPXQuYXZjQyh0LmZpbmRCb3goYSxbImF2Y0MiXSxuKVswXSksZS5wYXNwPXQucGFzcCh0LmZpbmRCb3goYSxbInBhc3AiXSxuKVswXSl9KSl9fSx7a2V5OiJhdmNDIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMSwoZnVuY3Rpb24odCxlKXt0LmNvbmZpZ3VyYXRpb25WZXJzaW9uPWVbMF0sdC5BVkNQcm9maWxlSW5kaWNhdGlvbj1lWzFdLHQucHJvZmlsZUNvbXBhdGliaWxpdHk9ZVsyXSx0LkFWQ0xldmVsSW5kaWNhdGlvbj1lWzNdLHQuY29kZWM9ZnVuY3Rpb24odCl7Zm9yKHZhciBlLHI9ImF2YzEuIixuPTA7bjwzO24rKykoZT10W25dLnRvU3RyaW5nKDE2KSkubGVuZ3RoPDImJihlPSIwIi5jb25jYXQoZSkpLHIrPWU7cmV0dXJuIHJ9KFtlWzFdLGVbMl0sZVszXV0pLHQubGVuZ3RoU2l6ZU1pbnVzT25lPTMmZVs0XSx0LnNwc0xlbmd0aD0zMSZlWzVdLHQuc3BzPVtdO2Zvcih2YXIgcj02LG49MDtuPHQuc3BzTGVuZ3RoO24rKyl7dmFyIGk9bmgoZSxyKTtyKz0yLHQuc3BzLnB1c2goZS5zdWJhcnJheShyLHIraSkpLHIrPWl9dC5wcHNMZW5ndGg9ZVtyXSxyKz0xLHQucHBzPVtdO2Zvcih2YXIgYT0wO2E8dC5wcHNMZW5ndGg7YSsrKXt2YXIgbz1uaChlLHIpO3IrPTIsdC5wcHMucHVzaChlLnN1YmFycmF5KHIscis9bykpLHIrPW99fSkpfX0se2tleToiaHZjMSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGNwKGUsITEsKGZ1bmN0aW9uKGUscixuKXt2YXIgaT1zcChlLHIpLGE9ci5zdWJhcnJheShpKTtuKz1pLGUuaHZjQz10Lmh2Y0ModC5maW5kQm94KGEsWyJodmNDIl0sbilbMF0pLGUucGFzcD10LnBhc3AodC5maW5kQm94KGEsWyJwYXNwIl0sbilbMF0pfSkpfX0se2tleToiaHZjQyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITEsKGZ1bmN0aW9uKGUscil7ZS5kYXRhPXQuZGF0YSxlLmNvZGVjPSJoZXYxLjEuNi5MOTMuQjAiLGUuY29uZmlndXJhdGlvblZlcnNpb249clswXTt2YXIgbj1yWzFdO2UuZ2VuZXJhbFByb2ZpbGVTcGFjZT1uPj42LGUuZ2VuZXJhbFRpZXJGbGFnPSgzMiZuKT4+NSxlLmdlbmVyYWxQcm9maWxlSWRjPTMxJm4sZS5nZW5lcmFsUHJvZmlsZUNvbXBhdGliaWxpdHk9aWgociwyKSxlLmdlbmVyYWxDb25zdHJhaW50SW5kaWNhdG9yRmxhZ3M9ci5zdWJhcnJheSg2LDEyKSxlLmdlbmVyYWxMZXZlbElkYz1yWzEyXSxlLmF2Z0ZyYW1lUmF0ZT1uaChyLDE5KSxlLm51bU9mQXJyYXlzPXJbMjJdLGUudnBzPVtdLGUuc3BzPVtdLGUucHBzPVtdO2Zvcih2YXIgaT0yMyxhPTAsbz0wLHM9MCx1PTA7dTxlLm51bU9mQXJyYXlzO3UrKyl7YT02MyZyW2ldLG89bmgocixpKzEpLGkrPTM7Zm9yKHZhciBjLGY9W10sbD0wO2w8bztsKyspcz1uaChyLGkpLGkrPTIsZi5wdXNoKHIuc3ViYXJyYXkoaSxpK3MpKSxpKz1zO2lmKDMyPT09YSkoYz1lLnZwcykucHVzaC5hcHBseShjLGYpO2Vsc2UgaWYoMzM9PT1hKXt2YXIgZDsoZD1lLnNwcykucHVzaC5hcHBseShkLGYpfWVsc2UgaWYoMzQ9PT1hKXt2YXIgaDsoaD1lLnBwcykucHVzaC5hcHBseShoLGYpfX19KSl9fSx7a2V5OiJwYXNwIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMSwoZnVuY3Rpb24odCxlKXt0LmhTcGFjaW5nPWloKGUpLHQudlNwYWNpbmc9aWgoZSw0KX0pKX19LHtrZXk6Im1wNGEiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBjcChlLCExLChmdW5jdGlvbihlLHIsbil7dmFyIGk9dXAoZSxyKTtlLmVzZHM9dC5lc2RzKHQuZmluZEJveChyLnN1YmFycmF5KGkpLFsiZXNkcyJdLG4raSlbMF0pfSkpfX0se2tleToiZXNkcyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7dC5jb2RlYz0ibXA0YS4iO2Zvcih2YXIgcj0wLG49MCxpPTAsYT0wO2UubGVuZ3RoOyl7Zm9yKGE9ZVtyPTBdLG49ZVtyKzFdLHIrPTI7MTI4Jm47KWk9KDEyNyZuKTw8NyxuPWVbcl0scis9MTtpZihpKz0xMjcmbiwzPT09YSllPWUuc3ViYXJyYXkociszKTtlbHNle2lmKDQhPT1hKXtpZig1PT09YSl7dmFyIG89dC5jb25maWc9ZS5zdWJhcnJheShyLHIraSkscz0oMjQ4Jm9bMF0pPj4zO3JldHVybiAzMT09PXMmJm8ubGVuZ3RoPj0yJiYocz0zMisoKDcmb1swXSk8PDMpKygoMjI0Jm9bMV0pPj41KSksdC5vYmplY3RUeXBlPXMsdC5jb2RlYys9cy50b1N0cmluZygxNiksdm9pZCgiLiI9PT10LmNvZGVjW3QuY29kZWMubGVuZ3RoLTFdJiYodC5jb2RlYz10LmNvZGVjLnN1YnN0cmluZygwLHQuY29kZWMubGVuZ3RoLTEpKSl9cmV0dXJuIHZvaWQoIi4iPT09dC5jb2RlY1t0LmNvZGVjLmxlbmd0aC0xXSYmKHQuY29kZWM9dC5jb2RlYy5zdWJzdHJpbmcoMCx0LmNvZGVjLmxlbmd0aC0xKSkpfXQuY29kZWMrPShlW3JdLnRvU3RyaW5nKDE2KSsiLiIpLnBhZFN0YXJ0KDMsIjAiKSxlPWUuc3ViYXJyYXkocisxMyl9fX0pKX19LHtrZXk6ImFsYXciLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBjcCh0LCExLChmdW5jdGlvbih0LGUpe3VwKHQsZSl9KSl9fSx7a2V5OiJzdHRzIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9aWgoZSksbj1bXSxpPTQsYT0wO2E8cjthKyspbi5wdXNoKHtjb3VudDppaChlLGkpLGRlbHRhOmloKGUsaSs0KX0pLGkrPTg7dC5lbnRyeUNvdW50PXIsdC5lbnRyaWVzPW59KSl9fSx7a2V5OiJjdHRzIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXt2YXIgcj1paChlKSxuPVtdLGk9NDtpZigxPT09dC52ZXJzaW9uKWZvcih2YXIgYT0wO2E8cjthKyspbi5wdXNoKHtjb3VudDppaChlLGkpLG9mZnNldDppaChlLGkrNCl9KSxpKz04O2Vsc2UgZm9yKHZhciBvPTA7bzxyO28rKyluLnB1c2goe2NvdW50OmloKGUsaSksb2Zmc2V0Oi0oMSt+aWgoZSxpKzQpKX0pLGkrPTg7dC5lbnRyeUNvdW50PXIsdC5lbnRyaWVzPW59KSl9fSx7a2V5OiJzdHNjIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9aWgoZSksbj1bXSxpPTQsYT0wO2E8cjthKyspbi5wdXNoKHtmaXJzdENodW5rOmloKGUsaSksc2FtcGxlc1BlckNodW5rOmloKGUsaSs0KSxzYW1wbGVEZXNjcmlwdGlvbkluZGV4OmloKGUsaSs4KX0pLGkrPTEyO3QuZW50cnlDb3VudD1yLHQuZW50cmllcz1ufSkpfX0se2tleToic3RzeiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7dmFyIHI9aWgoZSksbj1paChlLDQpLGk9W107aWYoIXIpZm9yKHZhciBhPTgsbz0wO288bjtvKyspaS5wdXNoKGloKGUsYSkpLGErPTQ7dC5zYW1wbGVTaXplPXIsdC5zYW1wbGVDb3VudD1uLHQuZW50cnlTaXplcz1pfSkpfX0se2tleToic3RjbyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPWloKGUpLG49W10saT00LGE9MDthPHI7YSsrKW4ucHVzaChpaChlLGkpKSxpKz00O3QuZW50cnlDb3VudD1yLHQuZW50cmllcz1ufSkpfX0se2tleToiY282NCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPWloKGUpLG49W10saT00LGE9MDthPHI7YSsrKW4ucHVzaChhaChlLGkpKSxpKz04O3QuZW50cnlDb3VudD1yLHQuZW50cmllcz1ufSkpfX0se2tleToic3RzcyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPWloKGUpLG49W10saT00LGE9MDthPHI7YSsrKW4ucHVzaChpaChlLGkpKSxpKz00O3QuZW50cnlDb3VudD1yLHQuZW50cmllcz1ufSkpfX0se2tleToibW9vZiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGNwKGUsITEsKGZ1bmN0aW9uKGUscixuKXtlLm1maGQ9dC5tZmhkKHQuZmluZEJveChyLFsibWZoZCJdLG4pWzBdKSxlLnRyYWY9dC5maW5kQm94KHIsWyJ0cmFmIl0sbikubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gdC50cmFmKGUpfSkpfSkpfX0se2tleToibWZoZCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7dC5zZXF1ZW5jZU51bWJlcj1paChlKX0pKX19LHtrZXk6InRyYWYiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBjcChlLCExLChmdW5jdGlvbihlLHIsbil7ZS50ZmhkPXQudGZoZCh0LmZpbmRCb3gocixbInRmaGQiXSxuKVswXSksZS50ZmR0PXQudGZkdCh0LmZpbmRCb3gocixbInRmZHQiXSxuKVswXSksZS50cnVuPXQudHJ1bih0LmZpbmRCb3gocixbInRydW4iXSxuKVswXSl9KSl9fSx7a2V5OiJ0cnVuIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gY3AodCwhMCwoZnVuY3Rpb24odCxlKXt2YXIgcj10LnZlcnNpb24sbj10LmZsYWdzLGk9ZS5sZW5ndGgsYT10LnNhbXBsZUNvdW50PWloKGUpLG89NDtpZihpPm8mJjEmbiYmKHQuZGF0YU9mZnNldD0tKDErfmloKGUsbykpLG8rPTQpLGk+byYmNCZuJiYodC5maXJzdFNhbXBsZUZsYWdzPWloKGUsbyksbys9NCksdC5zYW1wbGVzPVtdLGk+bylmb3IodmFyIHMsdT0wO3U8YTt1Kyspcz17fSwyNTYmbiYmKHMuZHVyYXRpb249aWgoZSxvKSxvKz00KSw1MTImbiYmKHMuc2l6ZT1paChlLG8pLG8rPTQpLDEwMjQmbiYmKHMuZmxhZ3M9aWgoZSxvKSxvKz00KSwyMDQ4Jm4mJihzLmN0cz1yPy0oMSt+aWgoZSxvKzQpKTppaChlLG8pLG8rPTQpLHQuc2FtcGxlcy5wdXNoKHMpfSkpfX0se2tleToidGZkdCIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGNwKHQsITAsKGZ1bmN0aW9uKHQsZSl7MT09PXQudmVyc2lvbj90LmJhc2VNZWRpYURlY29kZVRpbWU9YWgoZSk6dC5iYXNlTWVkaWFEZWNvZGVUaW1lPWloKGUpfSkpfX0se2tleToicHJvYmUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiEhdC5maW5kQm94KGUsWyJmdHlwIl0pfX0se2tleToicGFyc2VTYW1wbGVGbGFncyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJue2lzTGVhZGluZzooMTImdFswXSk+Pj4yLGRlcGVuZHNPbjozJnRbMF0saXNEZXBlbmRlZE9uOigxOTImdFsxXSk+Pj42LGhhc1JlZHVuZGFuY3k6KDQ4JnRbMV0pPj4+NCxwYWRkaW5nVmFsdWU6KDE0JnRbMV0pPj4+MSxpc05vblN5bmNTYW1wbGU6MSZ0WzFdLGRlZ3JhZGF0aW9uUHJpb3JpdHk6dFsyXTw8OHx0WzNdfX19LHtrZXk6Im1vb3ZUb1RyYWNrIix2YWx1ZTpmdW5jdGlvbih0LGUscil7dmFyIG4saSxhPXQudHJhaztpZihhJiZhLmxlbmd0aCl7dmFyIG89YS5maW5kKChmdW5jdGlvbih0KXt2YXIgZSxyO3JldHVybiJ2aWRlIj09PShudWxsPT09KGU9dC5tZGlhKXx8dm9pZCAwPT09ZXx8bnVsbD09PShyPWUuaGRscil8fHZvaWQgMD09PXI/dm9pZCAwOnIuaGFuZGxlclR5cGUpfSkpLHM9YS5maW5kKChmdW5jdGlvbih0KXt2YXIgZSxyO3JldHVybiJzb3VuIj09PShudWxsPT09KGU9dC5tZGlhKXx8dm9pZCAwPT09ZXx8bnVsbD09PShyPWUuaGRscil8fHZvaWQgMD09PXI/dm9pZCAwOnIuaGFuZGxlclR5cGUpfSkpO2lmKG8mJmUpe3ZhciB1LGMsZixsLGQsaCxwLHY9ZSx5PW51bGw9PT0odT1vLnRraGQpfHx2b2lkIDA9PT11P3ZvaWQgMDp1LnRyYWNrSWQ7bnVsbCE9eSYmKHYuaWQ9by50a2hkLnRyYWNrSWQpLHYudGtoZER1cmF0aW9uPW8udGtoZC5kdXJhdGlvbix2Lm12aGREdXJ0aW9uPXQubXZoZC5kdXJhdGlvbix2Lm12aGRUaW1lY2FsZT10Lm12aGQudGltZXNjYWxlLHYudGltZXNjYWxlPXYuZm9ybWF0VGltZXNjYWxlPW8ubWRpYS5tZGhkLnRpbWVzY2FsZSx2LmR1cmF0aW9uPW8ubWRpYS5tZGhkLmR1cmF0aW9ufHx2Lm12aGREdXJ0aW9uL3YubXZoZFRpbWVjYWxlKnYudGltZXNjYWxlO3ZhciBnLG0sYix3LGsseCxBLFMsXz1vLm1kaWEubWluZi5zdGJsLnN0c2QuZW50cmllc1swXTtpZih2LndpZHRoPV8ud2lkdGgsdi5oZWlnaHQ9Xy5oZWlnaHQsXy5wYXNwJiYodi5zYXJSYXRpbz1bXy5wYXNwLmhTcGFjaW5nLF8ucGFzcC52U3BhY2luZ10pLF8uaHZjQyl2LmNvZGVjVHlwZT1qaSx2LmNvZGVjPV8uaHZjQy5jb2RlYyx2LnZwcz1fLmh2Y0MudnBzLHYuc3BzPV8uaHZjQy5zcHMsdi5wcHM9Xy5odmNDLnBwcyx2Lmh2Y0M9Xy5odmNDLmRhdGE7ZWxzZXtpZighXy5hdmNDKXRocm93IG5ldyBFcnJvcigidW5rbm93biB2aWRlbyBzdHNkIGVudHJ5Iik7di5jb2RlYz1fLmF2Y0MuY29kZWMsdi5zcHM9Xy5hdmNDLnNwcyx2LnBwcz1fLmF2Y0MucHBzfWlmKHYucHJlc2VudD0hMCx2LmV4dD17fSx2LmV4dC5zdHNzPW51bGw9PT0oYz1vLm1kaWEpfHx2b2lkIDA9PT1jfHxudWxsPT09KGY9Yy5taW5mKXx8dm9pZCAwPT09Znx8bnVsbD09PShsPWYuc3RibCl8fHZvaWQgMD09PWw/dm9pZCAwOmwuc3Rzcyx2LmV4dC5jdHRzPW51bGw9PT0oZD1vLm1kaWEpfHx2b2lkIDA9PT1kfHxudWxsPT09KGg9ZC5taW5mKXx8dm9pZCAwPT09aHx8bnVsbD09PShwPWguc3RibCl8fHZvaWQgMD09PXA/dm9pZCAwOnAuY3R0cyxfJiYiZW5jdiI9PT1fLnR5cGUpdi5pc1ZpZGVvRW5jcnlwdGlvbj0hMCxfLmRlZmF1bHRfS0lEPW51bGw9PT0oZz1fLnNpbmYpfHx2b2lkIDA9PT1nfHxudWxsPT09KG09Zy5zY2hpKXx8dm9pZCAwPT09bT92b2lkIDA6bS50ZW5jLmRlZmF1bHRfS0lELF8uZGVmYXVsdF9Jc0VuY3J5cHRlZD1udWxsPT09KGI9Xy5zaW5mKXx8dm9pZCAwPT09Ynx8bnVsbD09PSh3PWIuc2NoaSl8fHZvaWQgMD09PXc/dm9pZCAwOncudGVuYy5kZWZhdWx0X0lzRW5jcnlwdGVkLF8uZGVmYXVsdF9JVl9zaXplPW51bGw9PT0oaz1fLnNpbmYpfHx2b2lkIDA9PT1rfHxudWxsPT09KHg9ay5zY2hpKXx8dm9pZCAwPT09eD92b2lkIDA6eC50ZW5jLmRlZmF1bHRfSVZfc2l6ZSx2LnZpZGVvU2VuYz1vLm1kaWEubWluZi5zdGJsLnNlbmMmJm8ubWRpYS5taW5mLnN0Ymwuc2VuYy5zYW1wbGVzLF8uZGF0YV9mb3JtYXQ9bnVsbD09PShBPV8uc2luZil8fHZvaWQgMD09PUF8fG51bGw9PT0oUz1BLmZybWEpfHx2b2lkIDA9PT1TP3ZvaWQgMDpTLmRhdGFfZm9ybWF0LHYudXNlRU1FPXQudXNlRU1FLHYua2lkVmFsdWU9dC5raWRWYWx1ZSx2LnBzc2g9dC5wc3NoLHYuZW5jdj1ffWlmKHMmJnIpe3ZhciBULEUsSSxPLE0sQyxSLEIsUCxVPXIsRD1udWxsPT09KFQ9cy50a2hkKXx8dm9pZCAwPT09VD92b2lkIDA6VC50cmFja0lkO251bGwhPUQmJihVLmlkPXMudGtoZC50cmFja0lkKSxVLnRraGREdXJhdGlvbj1zLnRraGQuZHVyYXRpb24sVS5tdmhkRHVydGlvbj10Lm12aGQuZHVyYXRpb24sVS5tdmhkVGltZWNhbGU9dC5tdmhkLnRpbWVzY2FsZSxVLnRpbWVzY2FsZT1VLmZvcm1hdFRpbWVzY2FsZT1zLm1kaWEubWRoZC50aW1lc2NhbGUsVS5kdXJhdGlvbj1zLm1kaWEubWRoZC5kdXJhdGlvbnx8VS5tdmhkRHVydGlvbi9VLm12aGRUaW1lY2FsZSpVLnRpbWVzY2FsZTt2YXIgeixqLEwsRixOLFYsSCxZLEs9cy5tZGlhLm1pbmYuc3RibC5zdHNkLmVudHJpZXNbMF07c3dpdGNoKFUuc2FtcGxlU2l6ZT1LLnNhbXBsZVNpemUsVS5zYW1wbGVSYXRlPUsuc2FtcGxlUmF0ZSxVLmNoYW5uZWxDb3VudD1LLmNoYW5uZWxDb3VudCxVLnByZXNlbnQ9ITAsSy50eXBlKXtjYXNlImFsYXciOlUuY29kZWNUeXBlPVUuY29kZWM9RmksVS5zYW1wbGVSYXRlPThlMzticmVhaztjYXNlInVsYXciOlUuY29kZWNUeXBlPVUuY29kZWM9TmksVS5zYW1wbGVSYXRlPThlMzticmVhaztkZWZhdWx0OlUuc2FtcGxlRHVyYXRpb249dGguZ2V0RnJhbWVEdXJhdGlvbihVLnNhbXBsZVJhdGUsVS50aW1lc2NhbGUpLFUuc2FtcGxlUmF0ZUluZGV4PXRoLmdldFJhdGVJbmRleEJ5UmF0ZShVLnNhbXBsZVJhdGUpLFUub2JqZWN0VHlwZT0obnVsbD09PShuPUsuZXNkcyl8fHZvaWQgMD09PW4/dm9pZCAwOm4ub2JqZWN0VHlwZSl8fDIsSy5lc2RzJiYoVS5jb25maWc9QXJyYXkuZnJvbShLLmVzZHMuY29uZmlnKSksVS5jb2RlYz0obnVsbD09PShpPUsuZXNkcyl8fHZvaWQgMD09PWk/dm9pZCAwOmkuY29kZWMpfHwibXA0YS40MC4yIn1pZihVLnNhbXBsZUR1cmF0aW9uPXRoLmdldEZyYW1lRHVyYXRpb24oVS5zYW1wbGVSYXRlLFUudGltZXNjYWxlKSxVLm9iamVjdFR5cGU9KG51bGw9PT0oRT1LLmVzZHMpfHx2b2lkIDA9PT1FP3ZvaWQgMDpFLm9iamVjdFR5cGUpfHwyLEsuZXNkcyYmKEsuZXNkcy5jb25maWc/VS5jb25maWc9QXJyYXkuZnJvbShLLmVzZHMuY29uZmlnKTpjb25zb2xlLndhcm4oImVzZHMgY29uZmlnIGlzIG51bGwiKSksVS5jb2RlYz0obnVsbD09PShJPUsuZXNkcyl8fHZvaWQgMD09PUk/dm9pZCAwOkkuY29kZWMpfHwibXA0YS40MC4yIixVLnNhbXBsZVJhdGVJbmRleD10aC5nZXRSYXRlSW5kZXhCeVJhdGUoVS5zYW1wbGVSYXRlKSxVLmV4dD17fSxVLmV4dC5zdHNzPW51bGw9PT0oTz1zLm1kaWEpfHx2b2lkIDA9PT1PfHxudWxsPT09KE09Ty5taW5mKXx8dm9pZCAwPT09TXx8bnVsbD09PShDPU0uc3RibCl8fHZvaWQgMD09PUM/dm9pZCAwOkMuc3RzcyxVLmV4dC5jdHRzPW51bGw9PT0oUj1zLm1kaWEpfHx2b2lkIDA9PT1SfHxudWxsPT09KEI9Ui5taW5mKXx8dm9pZCAwPT09Qnx8bnVsbD09PShQPUIuc3RibCl8fHZvaWQgMD09PVA/dm9pZCAwOlAuY3R0cyxVLnByZXNlbnQ9ITAsSyYmImVuY2EiPT09Sy50eXBlKVUuaXNBdWRpb0VuY3J5cHRpb249ITAsSy5kYXRhX2Zvcm1hdD1udWxsPT09KHo9Sy5zaW5mKXx8dm9pZCAwPT09enx8bnVsbD09PShqPXouZnJtYSl8fHZvaWQgMD09PWo/dm9pZCAwOmouZGF0YV9mb3JtYXQsSy5kZWZhdWx0X0tJRD1udWxsPT09KEw9Sy5zaW5mKXx8dm9pZCAwPT09THx8bnVsbD09PShGPUwuc2NoaSl8fHZvaWQgMD09PUY/dm9pZCAwOkYudGVuYy5kZWZhdWx0X0tJRCxLLmRlZmF1bHRfSXNFbmNyeXB0ZWQ9bnVsbD09PShOPUsuc2luZil8fHZvaWQgMD09PU58fG51bGw9PT0oVj1OLnNjaGkpfHx2b2lkIDA9PT1WP3ZvaWQgMDpWLnRlbmMuZGVmYXVsdF9Jc0VuY3J5cHRlZCxLLmRlZmF1bHRfSVZfc2l6ZT1udWxsPT09KEg9Sy5zaW5mKXx8dm9pZCAwPT09SHx8bnVsbD09PShZPUguc2NoaSl8fHZvaWQgMD09PVk/dm9pZCAwOlkudGVuYy5kZWZhdWx0X0lWX3NpemUsVS5hdWRpb1NlbmM9cy5tZGlhLm1pbmYuc3RibC5zZW5jJiZzLm1kaWEubWluZi5zdGJsLnNlbmMuc2FtcGxlcyxVLnVzZUVNRT10LnVzZUVNRSxVLmtpZFZhbHVlPXQua2lkVmFsdWUsVS5lbmNhPUt9aWYociYmKHIuaXNWaWRlb0VuY3J5cHRpb249ISFlJiZlLmlzVmlkZW9FbmNyeXB0aW9uKSxlJiYoZS5pc0F1ZGlvRW5jcnlwdGlvbj0hIXImJnIuaXNBdWRpb0VuY3J5cHRpb24pLG51bGwhPWUmJmUuZW5jdnx8bnVsbCE9ciYmci5lbmNhKXt2YXIgVyxHLHE9bnVsbD09ZXx8bnVsbD09PShXPWUuZW5jdil8fHZvaWQgMD09PVc/dm9pZCAwOlcuZGVmYXVsdF9LSUQsWD1udWxsPT1yfHxudWxsPT09KEc9ci5lbmNhKXx8dm9pZCAwPT09Rz92b2lkIDA6Ry5kZWZhdWx0X0tJRCwkPXF8fFg/KHF8fFgpLmpvaW4oIiIpOm51bGw7ZSYmKGUua2lkPSQpLHImJihyLmtpZD0kKX1yZXR1cm4gZSYmKGUuZmxhZ3M9Mzg0MSksciYmKHIuZmxhZ3M9MTc5Mykse3ZpZGVvVHJhY2s6ZSxhdWRpb1RyYWNrOnJ9fX19LHtrZXk6ImV2YWx1YXRlRGVmYXVsdER1cmF0aW9uIix2YWx1ZTpmdW5jdGlvbih0LGUscil7dmFyIG4saT1udWxsPT1lfHxudWxsPT09KG49ZS5zYW1wbGVzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5sZW5ndGg7cmV0dXJuIGk/MTAyNCppL2UudGltZXNjYWxlKnQudGltZXNjYWxlL3I6MTAyNH19LHtrZXk6Im1vb2ZUb1NhbXBsZXMiLHZhbHVlOmZ1bmN0aW9uKGUscixuKXt2YXIgaT17fTtyZXR1cm4gZS5tZmhkJiYociYmKHIuc2VxdWVuY2VOdW1iZXI9ZS5tZmhkLnNlcXVlbmNlTnVtYmVyKSxuJiYobi5zZXF1ZW5jZU51bWJlcj1lLm1maGQuc2VxdWVuY2VOdW1iZXIpKSxlLnRyYWYuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIGE9ZS50ZmhkLG89ZS50ZmR0LHM9ZS50cnVuO2lmKGEmJnMpe28mJihyJiZyLmlkPT09YS50cmFja0lkJiYoci5iYXNlTWVkaWFEZWNvZGVUaW1lPW8uYmFzZU1lZGlhRGVjb2RlVGltZSksbiYmbi5pZD09PWEudHJhY2tJZCYmKG4uYmFzZU1lZGlhRGVjb2RlVGltZT1vLmJhc2VNZWRpYURlY29kZVRpbWUpKTt2YXIgdT1hLmRlZmF1bHRTYW1wbGVTaXplfHwwLGM9YS5kZWZhdWx0U2FtcGxlRHVyYXRpb258fHQuZXZhbHVhdGVEZWZhdWx0RHVyYXRpb24ocixuLHMuc2FtcGxlcy5sZW5ndGh8fHMuc2FtcGxlQ291bnQpLGY9cy5kYXRhT2Zmc2V0fHwwLGw9MCxkPS0xO2lmKCFzLnNhbXBsZXMubGVuZ3RoJiZzLnNhbXBsZUNvdW50KXtpW2EudHJhY2tJZF09W107Zm9yKHZhciBoPTA7aDxzLnNhbXBsZUNvdW50O2grKylpW2EudHJhY2tJZF0ucHVzaCh7b2Zmc2V0OmYsZHRzOmwsZHVyYXRpb246YyxzaXplOnV9KSxsKz1jLGYrPXV9ZWxzZSBpW2EudHJhY2tJZF09cy5zYW1wbGVzLm1hcCgoZnVuY3Rpb24odCxlKXtyZXR1cm4odD17b2Zmc2V0OmYsZHRzOmwscHRzOmwrKHQuY3RzfHwwKSxkdXJhdGlvbjp0LmR1cmF0aW9ufHxjLHNpemU6dC5zaXplfHx1LGdvcElkOmQsa2V5ZnJhbWU6MD09PWV8fG51bGwhPT10LmZsYWdzJiZ2b2lkIDAhPT10LmZsYWdzJiYoNjU1MzYmdC5mbGFncyk+Pj4wIT02NTUzNn0pLmtleWZyYW1lJiYoZCsrLHQuZ29wSWQ9ZCksbCs9dC5kdXJhdGlvbixmKz10LnNpemUsdH0pKX19KSksaX19LHtrZXk6Im1vb3ZUb1NhbXBsZXMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXQudHJhaztpZihlJiZlLmxlbmd0aCl7dmFyIHI9ZS5maW5kKChmdW5jdGlvbih0KXt2YXIgZSxyO3JldHVybiJ2aWRlIj09PShudWxsPT09KGU9dC5tZGlhKXx8dm9pZCAwPT09ZXx8bnVsbD09PShyPWUuaGRscil8fHZvaWQgMD09PXI/dm9pZCAwOnIuaGFuZGxlclR5cGUpfSkpLG49ZS5maW5kKChmdW5jdGlvbih0KXt2YXIgZSxyO3JldHVybiJzb3VuIj09PShudWxsPT09KGU9dC5tZGlhKXx8dm9pZCAwPT09ZXx8bnVsbD09PShyPWUuaGRscil8fHZvaWQgMD09PXI/dm9pZCAwOnIuaGFuZGxlclR5cGUpfSkpO2lmKHJ8fG4pe3ZhciBpLGE7aWYocil7dmFyIG8scyx1PW51bGw9PT0obz1yLm1kaWEpfHx2b2lkIDA9PT1vfHxudWxsPT09KHM9by5taW5mKXx8dm9pZCAwPT09cz92b2lkIDA6cy5zdGJsO2lmKCF1KXJldHVybjt2YXIgYz11LnN0dHMsZj11LnN0c2MsbD11LnN0c3osZD11LnN0Y28saD11LnN0c3MscD11LmN0dHM7aWYoIShjJiZmJiZsJiZkJiZoKSlyZXR1cm47aT1vcChjLGYsbCxkLHAsaCl9aWYobil7dmFyIHYseSxnLG09bnVsbD09PSh2PW4ubWRpYSl8fHZvaWQgMD09PXZ8fG51bGw9PT0oeT12Lm1pbmYpfHx2b2lkIDA9PT15P3ZvaWQgMDp5LnN0Ymw7aWYoIW0pcmV0dXJuO3ZhciBiPW51bGw9PT0oZz1uLm1kaWEubWRoZCl8fHZvaWQgMD09PWc/dm9pZCAwOmcudGltZXNjYWxlLHc9bS5zdHRzLGs9bS5zdHNjLHg9bS5zdHN6LEE9bS5zdGNvO2lmKCEoYiYmdyYmayYmeCYmQSkpcmV0dXJuO2E9b3AodyxrLHgsQSl9cmV0dXJue3ZpZGVvU2FtcGxlczppLGF1ZGlvU2FtcGxlczphfX19fX1dKSx0fSgpO2Z1bmN0aW9uIG9wKHQsZSxyLG4saSxhKXt2YXIgbyxzLHUsYz1bXSxmPW51bGw9PWk/dm9pZCAwOmkuZW50cmllcyxsPWUuZW50cmllcyxkPW4uZW50cmllcyxoPXIuZW50cnlTaXplcyxwPW51bGw9PWE/dm9pZCAwOmEuZW50cmllcztwJiYobz17fSxwLmZvckVhY2goKGZ1bmN0aW9uKHQpe29bdC0xXT0hMH0pKSksZiYmKHM9W10sZi5mb3JFYWNoKChmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5jb3VudCxyPXQub2Zmc2V0LG49MDtuPGU7bisrKXMucHVzaChyKX0pKSk7dmFyIHY9LTEseT0wLGc9MCxtPTAsYj0wLHc9MCxrPWxbMF0uc2FtcGxlc1BlckNodW5rLHg9bFsxXT9sWzFdLmZpcnN0Q2h1bmstMToxLzA7cmV0dXJuIHQuZW50cmllcy5mb3JFYWNoKChmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5jb3VudCxuPXQuZGVsdGEsaT0wO2k8ZTtpKyspdT17ZHRzOnksZHVyYXRpb246bixzaXplOmhbZ118fHIuc2FtcGxlU2l6ZSxvZmZzZXQ6ZFttXSt3LGluZGV4Omd9LHAmJih1LmtleWZyYW1lPW9bZ10sdS5rZXlmcmFtZSYmdisrLHUuZ29wSWQ9dikscyYmZzxzLmxlbmd0aCYmKHUucHRzPXUuZHRzK3NbZ10pLGMucHVzaCh1KSx5Kz1uLCsrZzxrP3crPXUuc2l6ZToobSsrLHc9MCxtPj14JiYoYisrLHg9bFtiKzFdP2xbYisxXS5maXJzdENodW5rLTE6MS8wKSxrKz1sW2JdLnNhbXBsZXNQZXJDaHVuayl9KSksY31mdW5jdGlvbiBzcCh0LGUpe3JldHVybiB0LmRhdGFSZWZlcmVuY2VJbmRleD1uaChlLDYpLHQud2lkdGg9bmgoZSwyNCksdC5oZWlnaHQ9bmgoZSwyNiksdC5ob3JpenJlc29sdXRpb249aWgoZSwyOCksdC52ZXJ0cmVzb2x1dGlvbj1paChlLDMyKSx0LmZyYW1lQ291bnQ9bmgoZSw0MCksdC5kZXB0aD1uaChlLDc0KSw3OH1mdW5jdGlvbiB1cCh0LGUpe3JldHVybiB0LmRhdGFSZWZlcmVuY2VJbmRleD1uaChlLDYpLHQuY2hhbm5lbENvdW50PW5oKGUsMTYpLHQuc2FtcGxlU2l6ZT1uaChlLDE4KSx0LnNhbXBsZVJhdGU9aWgoZSwyNCkvNjU1MzYsMjh9ZnVuY3Rpb24gY3AodCxlLHIpe2lmKHQpe2lmKHQuc2l6ZSE9PXQuZGF0YS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJib3ggIi5jb25jYXQodC50eXBlLCIgc2l6ZSAhPT0gZGF0YS5sZW5ndGgiKSk7dmFyIG49e3N0YXJ0OnQuc3RhcnQsc2l6ZTp0LnNpemUsaGVhZGVyU2l6ZTp0LmhlYWRlclNpemUsdHlwZTp0LnR5cGV9O3JldHVybiBlJiYobi52ZXJzaW9uPXQuZGF0YVt0LmhlYWRlclNpemVdLG4uZmxhZ3M9ZnVuY3Rpb24odCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjA7cmV0dXJuKHRbZV08PDE2KSsodFtlKzFdPDw4KSsodFtlKzJdfHwwKX0odC5kYXRhLHQuaGVhZGVyU2l6ZSsxKSxuLmhlYWRlclNpemUrPTQpLHIobix0LmRhdGEuc3ViYXJyYXkobi5oZWFkZXJTaXplKSxuLnN0YXJ0K24uaGVhZGVyU2l6ZSksbn19dmFyIGZwPWZ1bmN0aW9uKHQsZSxyKXtmb3IodmFyIG49U3RyaW5nKHIpLGk9ZT4+MCxhPU1hdGguY2VpbChpL24ubGVuZ3RoKSxvPVtdLHM9U3RyaW5nKHQpO2EtLTspby5wdXNoKG4pO3JldHVybiBvLmpvaW4oIiIpLnN1YnN0cmluZygwLGktcy5sZW5ndGgpK3N9LGxwPWZ1bmN0aW9uKCl7Zm9yKHZhciB0PVtdLGU9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheShlKSxuPTA7bjxlO24rKylyW25dPWFyZ3VtZW50c1tuXTtyZXR1cm4gci5mb3JFYWNoKChmdW5jdGlvbihlKXt0LnB1c2goZnAoTnVtYmVyKGUpLnRvU3RyaW5nKDE2KSwyLDApKX0pKSx0WzBdfSxkcD1XdSxocD0iQXJyYXlCdWZmZXIiLHBwPVN1LkFycmF5QnVmZmVyO2JyKHtnbG9iYWw6ITAsZm9yY2VkOkUuQXJyYXlCdWZmZXIhPT1wcH0se0FycmF5QnVmZmVyOnBwfSksZHAoaHApO3ZhciB2cCx5cD17fTtPYmplY3QuZGVmaW5lUHJvcGVydHkoeXAsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pLHlwLmRlZmF1bHQ9ZnVuY3Rpb24odCl7Zm9yKHZhciBlPTAscj1hcmd1bWVudHMubGVuZ3RoLG49QXJyYXkocj4xP3ItMTowKSxpPTE7aTxyO2krKyluW2ktMV09YXJndW1lbnRzW2ldO3ZhciBhPSEwLG89ITEscz12b2lkIDA7dHJ5e2Zvcih2YXIgdSxjPW5bU3ltYm9sLml0ZXJhdG9yXSgpOyEoYT0odT1jLm5leHQoKSkuZG9uZSk7YT0hMCl7dmFyIGY9dS52YWx1ZTtlKz1mLmxlbmd0aH19Y2F0Y2goYil7bz0hMCxzPWJ9ZmluYWxseXt0cnl7IWEmJmMucmV0dXJuJiZjLnJldHVybigpfWZpbmFsbHl7aWYobyl0aHJvdyBzfX12YXIgbD1uZXcgdChlKSxkPTAsaD0hMCxwPSExLHY9dm9pZCAwO3RyeXtmb3IodmFyIHksZz1uW1N5bWJvbC5pdGVyYXRvcl0oKTshKGg9KHk9Zy5uZXh0KCkpLmRvbmUpO2g9ITApe3ZhciBtPXkudmFsdWU7bC5zZXQobSxkKSxkKz1tLmxlbmd0aH19Y2F0Y2goYil7cD0hMCx2PWJ9ZmluYWxseXt0cnl7IWgmJmcucmV0dXJuJiZnLnJldHVybigpfWZpbmFsbHl7aWYocCl0aHJvdyB2fX1yZXR1cm4gbH07dmFyIGdwPSgodnA9eXApJiZ2cC5fX2VzTW9kdWxlP3ZwOntkZWZhdWx0OnZwfSkuZGVmYXVsdCxtcD1mdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXtnKHRoaXMsdCksdGhpcy5idWZmZXI9bmV3IFVpbnQ4QXJyYXkoMCl9cmV0dXJuIGIodCxbe2tleToid3JpdGUiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciB0PXRoaXMsZT1hcmd1bWVudHMubGVuZ3RoLHI9bmV3IEFycmF5KGUpLG49MDtuPGU7bisrKXJbbl09YXJndW1lbnRzW25dO3IuZm9yRWFjaCgoZnVuY3Rpb24oZSl7ZT90LmJ1ZmZlcj1ncChVaW50OEFycmF5LHQuYnVmZmVyLGUpOndpbmRvdy5jb25zb2xlLndhcm4oZSl9KSl9fV0sW3trZXk6IndyaXRlVWludDE2Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoW3Q+PjgmMjU1LDI1NSZ0XSl9fSx7a2V5OiJ3cml0ZVVpbnQzMiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBVaW50OEFycmF5KFt0Pj4yNCx0Pj4xNiYyNTUsdD4+OCYyNTUsMjU1JnRdKX19XSksdH0oKSxicD1NYXRoLnBvdygyLDMyKS0xLHdwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe2codGhpcyx0KX1yZXR1cm4gYih0LG51bGwsW3trZXk6ImJveCIsdmFsdWU6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZT4xP2UtMTowKSxuPTE7bjxlO24rKylyW24tMV09YXJndW1lbnRzW25dO3ZhciBpPTgrKHI9ci5maWx0ZXIoQm9vbGVhbikpLnJlZHVjZSgoZnVuY3Rpb24odCxlKXtyZXR1cm4gdCtlLmJ5dGVMZW5ndGh9KSwwKSxhPW5ldyBVaW50OEFycmF5KGkpO2FbMF09aT4+MjQmMjU1LGFbMV09aT4+MTYmMjU1LGFbMl09aT4+OCYyNTUsYVszXT0yNTUmaSxhLnNldCh0LDQpO3ZhciBvPTg7cmV0dXJuIHIuZm9yRWFjaCgoZnVuY3Rpb24odCl7YS5zZXQodCxvKSxvKz10LmJ5dGVMZW5ndGh9KSksYX19LHtrZXk6ImZ0eXAiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlLmZpbmQoKGZ1bmN0aW9uKHQpe3JldHVybiB0LnR5cGU9PT1QaSYmdC5jb2RlY1R5cGU9PT1qaX0pKT90LkZUWVBIRVYxOnQuRlRZUEFWQzF9fSx7a2V5OiJpbml0U2VnbWVudCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGVoKHQuZnR5cChlKSx0Lm1vb3YoZSkpfX0se2tleToicHNzaCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IFVpbnQ4QXJyYXkoWzEsMCwwLDBdLmNvbmNhdChbMTYsMTE5LDIzOSwyMzYsMTkyLDE3OCw3NywyLDE3MiwyMjcsNjAsMzAsODIsMjI2LDI1MSw3NV0sWzAsMCwwLDFdLHNoKGUua2lkKSxbMCwwLDAsMF0pKTtyZXR1cm4gdC5ib3godC50eXBlcy5wc3NoLHIpfX0se2tleToibW9vdiIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoZVswXS51c2VFTUUmJihlWzBdLmVuY3Z8fGVbMF0uZW5jYSkpe2VbMF0ucHNzaHx8KGVbMF0ucHNzaD17a2lkOmVbMF0ua2lkfSk7dmFyIHI9dGhpcy5wc3NoKGVbMF0ucHNzaCk7cmV0dXJuIHQuYm94LmFwcGx5KHQsW3QudHlwZXMubW9vdix0Lm12aGQoZVswXS5tdmhkRHVydGlvbnx8ZVswXS5kdXJhdGlvbixlWzBdLm12aGRUaW1lY2FsZXx8ZVswXS50aW1lc2NhbGUpLHQubXZleChlKV0uY29uY2F0KHgoZS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiB0LnRyYWsoZSl9KSkpLFtyXSkpfXJldHVybiB0LmJveC5hcHBseSh0LFt0LnR5cGVzLm1vb3YsdC5tdmhkKGVbMF0ubXZoZER1cnRpb258fGVbMF0uZHVyYXRpb24sZVswXS5tdmhkVGltZWNhbGV8fGVbMF0udGltZXNjYWxlKV0uY29uY2F0KHgoZS5tYXAoKGZ1bmN0aW9uKGUpe3JldHVybiB0LnRyYWsoZSl9KSkpLFt0Lm12ZXgoZSldKSl9fSx7a2V5OiJtdmhkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06OWU0LG49dC5ib3godC50eXBlcy5tdmhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxyPj4yNCYyNTUscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyLGU+PjI0JjI1NSxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmUsMCwxLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsNjQsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMjU1LDI1NSwyNTUsMjU1XSkpO3JldHVybiBufX0se2tleToidHJhayIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuYm94KHQudHlwZXMudHJhayx0LnRraGQoZS5pZCxlLnRraGREdXJhdGlvbnx8MCxlLndpZHRoLGUuaGVpZ2h0KSx0Lm1kaWEoZSkpfX0se2tleToidGtoZCIsdmFsdWU6ZnVuY3Rpb24oZSxyKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06MCxpPWFyZ3VtZW50cy5sZW5ndGg+MyYmdm9pZCAwIT09YXJndW1lbnRzWzNdP2FyZ3VtZW50c1szXTowLGE9dC5ib3godC50eXBlcy50a2hkLG5ldyBVaW50OEFycmF5KFswLDAsMCw3LDAsMCwwLDAsMCwwLDAsMCxlPj4yNCYyNTUsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlLDAsMCwwLDAscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmciwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCw2NCwwLDAsMCxuPj44JjI1NSwyNTUmbiwwLDAsaT4+OCYyNTUsMjU1JmksMCwwXSkpO3JldHVybiBhfX0se2tleToibWRpYSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuYm94KHQudHlwZXMubWRpYSx0Lm1kaGQoZS5kdXJhdGlvbixlLnRpbWVzY2FsZSksdC5oZGxyKGUudHlwZSksdC5taW5mKGUpKX19LHtrZXk6Im1kaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTo5ZTQsbj10LmJveCh0LnR5cGVzLm1kaGQsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLHI+PjI0JjI1NSxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsZT4+MjQmMjU1LGU+PjE2JjI1NSxlPj44JjI1NSwyNTUmZSw4NSwxOTYsMCwwXSkpO3JldHVybiBufX0se2tleToiaGRsciIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuYm94KHQudHlwZXMuaGRscix0LkhETFJfVFlQRVNbZV0pfX0se2tleToibWluZiIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuYm94KHQudHlwZXMubWluZixlLnR5cGU9PT1QaT90LlZNSEQ6dC5TTUhELHQuRElORix0LnN0YmwoZSkpfX0se2tleToic3RibCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9W107cmV0dXJuIGUmJmUuZXh0JiZlLmV4dC5zdHNzJiZyLnB1c2godC5zdHNzKGUuZXh0LnN0c3MuZW50cmllcykpLHQuYm94KHQudHlwZXMuc3RibCx0LnN0c2QoZSksdC5TVFRTLHJbMF0sdC5TVFNDLHQuU1RTWix0LlNUQ08pfX0se2tleToic3RzZCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI7cmV0dXJuIHI9ImF1ZGlvIj09PWUudHlwZT9lLnVzZUVNRSYmZS5lbmNhP3QuZW5jYShlKTp0Lm1wNGEoZSk6ZS51c2VFTUUmJmUuZW5jdj90LmVuY3YoZSk6dC5hdmMxaGV2MShlKSx0LmJveCh0LnR5cGVzLnN0c2QsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMV0pLHIpfX0se2tleToiZW5jYSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9ZS5lbmNhLmNoYW5uZWxDb3VudCxuPWUuZW5jYS5zYW1wbGVSYXRlLGk9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCxyLDAsMTYsMCwwLDAsMCxuPj44JjI1NSwyNTUmbiwwLDBdKSxhPXQuZXNkcyhlLmNvbmZpZyksbz10LnNpbmYoZS5lbmNhKTtyZXR1cm4gdC5ib3godC50eXBlcy5lbmNhLGksYSxvKX19LHtrZXk6ImVuY3YiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByLG4saT1lLnNwcy5sZW5ndGg+MD9lLnNwc1swXTpbXSxhPWUucHBzLmxlbmd0aD4wP2UucHBzWzBdOltdLG89ZS53aWR0aCxzPWUuaGVpZ2h0LHU9ZS5zYXJSYXRpb1swXSxjPWUuc2FyUmF0aW9bMV0sZj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsbz4+OCYyNTUsMjU1Jm8scz4+OCYyNTUsMjU1JnMsMCw3MiwwLDAsMCw3MiwwLDAsMCwwLDAsMCwwLDEsMTgsMTAwLDk3LDEwNSwxMDgsMTIxLDEwOSwxMTEsMTE2LDEwNSwxMTEsMTEwLDQ3LDEwNCwxMDgsMTE1LDQ2LDEwNiwxMTUsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDI0LDE3LDE3XSksbD1uZXcgVWludDhBcnJheSgocj0obj1bMSxpWzFdLGlbMl0saVszXSwyNTUsMjI1LGkubGVuZ3RoPj4+OCYyNTUsMjU1JmkubGVuZ3RoXSkuY29uY2F0LmFwcGx5KG4seChpKSkuY29uY2F0KFsxLGEubGVuZ3RoPj4+OCYyNTUsMjU1JmEubGVuZ3RoXSkpLmNvbmNhdC5hcHBseShyLHgoYSkpKSxkPW5ldyBVaW50OEFycmF5KFswLDAsODgsNTcsMCwxNSwyMDAsMTkyLDAsNCw4Niw3Ml0pLGg9dC5zaW5mKGUuZW5jdikscD1uZXcgVWludDhBcnJheShbdT4+MjQsdT4+MTYmMjU1LHU+PjgmMjU1LDI1NSZ1LGM+PjI0LGM+PjE2JjI1NSxjPj44JjI1NSwyNTUmY10pO3JldHVybiB0LmJveCh0LnR5cGVzLmVuY3YsZix0LmJveCh0LnR5cGVzLmF2Y0MsbCksdC5ib3godC50eXBlcy5idHJ0LGQpLGgsdC5ib3godC50eXBlcy5wYXNwLHApKX19LHtrZXk6InNjaGkiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyBVaW50OEFycmF5KFtdKSxuPXQudGVuYyhlKTtyZXR1cm4gdC5ib3godC50eXBlcy5zY2hpLHIsbil9fSx7a2V5OiJ0ZW5jIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMjU1JmUuZGVmYXVsdF9Jc0VuY3J5cHRlZCwyNTUmZS5kZWZhdWx0X0lWX3NpemVdLmNvbmNhdChzaChlLmRlZmF1bHRfS0lEKSkpO3JldHVybiB0LmJveCh0LnR5cGVzLnRlbmMscil9fSx7a2V5OiJzaW5mIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgVWludDhBcnJheShbXSksbj1uZXcgVWludDhBcnJheShbZS5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDApLGUuZGF0YV9mb3JtYXQuY2hhckNvZGVBdCgxKSxlLmRhdGFfZm9ybWF0LmNoYXJDb2RlQXQoMiksZS5kYXRhX2Zvcm1hdC5jaGFyQ29kZUF0KDMpXSksaT1uZXcgVWludDhBcnJheShbMCwwLDAsMCw5OSwxMDEsMTEwLDk5LDAsMSwwLDBdKSxhPXQuc2NoaShlKTtyZXR1cm4gdC5ib3godC50eXBlcy5zaW5mLHIsdC5ib3godC50eXBlcy5mcm1hLG4pLHQuYm94KHQudHlwZXMuc2NobSxpKSxhKX19LHtrZXk6ImF2YzFoZXYxIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1lLmNvZGVjVHlwZT09PWppLG49cj90LnR5cGVzLmh2YzE6dC50eXBlcy5hdmMxLGk9cj90Lmh2Y0MoZSk6dC5hdmNDKGUpLGE9W25ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCxlLndpZHRoPj44JjI1NSwyNTUmZS53aWR0aCxlLmhlaWdodD4+OCYyNTUsMjU1JmUuaGVpZ2h0LDAsNzIsMCwwLDAsNzIsMCwwLDAsMCwwLDAsMCwxLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDI0LDE3LDE3XSksaV07cmV0dXJuIHI/YS5wdXNoKHQuYm94KHQudHlwZXMuZmllbCxuZXcgVWludDhBcnJheShbMSwwXSkpKTplLnNhclJhdGlvJiZlLnNhclJhdGlvLmxlbmd0aD4xJiZhLnB1c2godC5wYXNwKGUuc2FyUmF0aW8pKSx0LmJveC5hcHBseSh0LFtuXS5jb25jYXQoYSkpfX0se2tleToiYXZjQyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHIsbixpLGE9W10sbz1bXTtyZXR1cm4gZS5zcHMuZm9yRWFjaCgoZnVuY3Rpb24odCl7aT10LmJ5dGVMZW5ndGgsYS5wdXNoKGk+Pj44JjI1NSksYS5wdXNoKDI1NSZpKSxhLnB1c2guYXBwbHkoYSx4KHQpKX0pKSxlLnBwcy5mb3JFYWNoKChmdW5jdGlvbih0KXtpPXQuYnl0ZUxlbmd0aCxvLnB1c2goaT4+PjgmMjU1KSxvLnB1c2goMjU1JmkpLG8ucHVzaC5hcHBseShvLHgodCkpfSkpLHQuYm94KHQudHlwZXMuYXZjQyxuZXcgVWludDhBcnJheSgocj0obj1bMSxhWzNdLGFbNF0sYVs1XSwyNTUsMjI0fGUuc3BzLmxlbmd0aF0pLmNvbmNhdC5hcHBseShuLGEpLmNvbmNhdChbZS5wcHMubGVuZ3RoXSkpLmNvbmNhdC5hcHBseShyLG8pKSl9fSx7a2V5OiJodmNDIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1lLmh2Y0M7aWYociBpbnN0YW5jZW9mIEFycmF5QnVmZmVyfHxyIGluc3RhbmNlb2YgVWludDhBcnJheSlyZXR1cm4gcjt2YXIgbixpPWUudnBzLGE9ZS5zcHMsbz1lLnBwcztpZihyKXt2YXIgcz1yLmdlbmVyYWxQcm9maWxlQ29tcGF0aWJpbGl0eUZsYWdzLHU9ci5nZW5lcmFsQ29uc3RyYWludEluZGljYXRvckZsYWdzLGM9KGkubGVuZ3RoJiYxKSsoYS5sZW5ndGgmJjEpKyhvLmxlbmd0aCYmMSk7bj1bMSxyLmdlbmVyYWxQcm9maWxlU3BhY2U8PDZ8ci5nZW5lcmFsVGllckZsYWc8PDV8ci5nZW5lcmFsUHJvZmlsZUlkYyxzPj4+MjQscz4+PjE2LHM+Pj44LHMsdVswXSx1WzFdLHVbMl0sdVszXSx1WzRdLHVbNV0sci5nZW5lcmFsTGV2ZWxJZGMsMjQwLDAsMjUyLDI1MnxyLmNocm9tYUZvcm1hdElkYywyNDh8ci5iaXREZXB0aEx1bWFNaW51czgsMjQ4fHIuYml0RGVwdGhDaHJvbWFNaW51czgsMCwwLHIubnVtVGVtcG9yYWxMYXllcnM8PDN8ci50ZW1wb3JhbElkTmVzdGVkPDwyfDMsY107dmFyIGY9ZnVuY3Rpb24odCl7dmFyIGU7bi5wdXNoKHQubGVuZ3RoPj44LHQubGVuZ3RoKSwoZT1uKS5wdXNoLmFwcGx5KGUseCh0KSl9O2kubGVuZ3RoJiYobi5wdXNoKDE2MCwwLGkubGVuZ3RoKSxpLmZvckVhY2goZikpLGEubGVuZ3RoJiYobi5wdXNoKDE2MSwwLGEubGVuZ3RoKSxhLmZvckVhY2goZikpLG8ubGVuZ3RoJiYobi5wdXNoKDE2MiwwLG8ubGVuZ3RoKSxvLmZvckVhY2goZikpfWVsc2Ugbj1bMSwxLDk2LDAsMCwwLDE0NCwwLDAsMCwwLDAsOTMsMjQwLDAsMjUyLDI1MywyNDgsMjQ4LDAsMCwxNSwzLDE2MCwwLDEsMCwyNCw2NCwxLDEyLDEsMjU1LDI1NSwxLDk2LDAsMCwzLDAsMTQ0LDAsMCwzLDAsMCwzLDAsOTMsMTUzLDE1Miw5LDE2MSwwLDEsMCw0NSw2NiwxLDEsMSw5NiwwLDAsMywwLDE0NCwwLDAsMywwLDAsMywwLDkzLDE2MCwyLDEyOCwxMjgsNDUsMjIsODksMTUzLDE2NCwxNDcsNDMsMTU0LDEyOCwxMjgsMTI4LDEzMCwwLDAsMywwLDIsMCwwLDMsMCw1MCwxNiwxNjIsMCwxLDAsNyw2OCwxLDE5MywxMTQsMTgwLDk4LDY0XTtyZXR1cm4gdC5ib3godC50eXBlcy5odmNDLG5ldyBVaW50OEFycmF5KG4pKX19LHtrZXk6InBhc3AiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPWsoZSwyKSxuPXJbMF0saT1yWzFdO3JldHVybiB0LmJveCh0LnR5cGVzLnBhc3AsbmV3IFVpbnQ4QXJyYXkoW24+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbixpPj4yNCxpPj4xNiYyNTUsaT4+OCYyNTUsMjU1JmldKSl9fSx7a2V5OiJtcDRhIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdC5ib3godC50eXBlcy5tcDRhLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDEsMCwwLDAsMCwwLDAsMCwwLDAsZS5jaGFubmVsQ291bnQsMCwxNiwwLDAsMCwwLGUuc2FtcGxlUmF0ZT4+OCYyNTUsMjU1JmUuc2FtcGxlUmF0ZSwwLDBdKSxlLmNvbmZpZy5sZW5ndGg/dC5lc2RzKGUuY29uZmlnKTp2b2lkIDApfX0se2tleToiZXNkcyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9ZS5sZW5ndGg7cmV0dXJuIHQuYm94KHQudHlwZXMuZXNkcyxuZXcgVWludDhBcnJheShbMCwwLDAsMCwzLDIzK3IsMCwwLDAsNCwxNStyLDY0LDIxLDAsNiwwLDAsMCwyMTgsMTkyLDAsMCwyMTgsMTkyLDVdLmNvbmNhdChbcl0pLmNvbmNhdChlKS5jb25jYXQoWzYsMSwyXSkpKX19LHtrZXk6Im12ZXgiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0LmJveC5hcHBseSh0LFt0LnR5cGVzLm12ZXhdLmNvbmNhdCh4KGUubWFwKChmdW5jdGlvbihlKXtyZXR1cm4gdC50cmV4KGUuaWQpfSkpKSkpfX0se2tleToidHJleCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuYm94KHQudHlwZXMudHJleCxuZXcgVWludDhBcnJheShbMCwwLDAsMCxlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmUsMCwwLDAsMSwwLDAsMCwwLDAsMCwwLDAsMCwxLDAsMV0pKX19LHtrZXk6InRyZXgxIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdC5ib3godC50eXBlcy50cmV4LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLGU+PjI0LGU+PjE2JjI1NSxlPj44JjI1NSwyNTUmZSwwLDAsMCwxLDAsMCwyLDAsMCwwLDAsMCwwLDEsMCwwXSkpfX0se2tleToidHJleDIiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0LmJveCh0LnR5cGVzLnRyZXgsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlLDAsMCwwLDEsMCwwLDQsMCwwLDAsMCwwLDIsMCwwLDBdKSl9fSx7a2V5OiJtb29mIix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdC5ib3guYXBwbHkodCxbdC50eXBlcy5tb29mLHQubWZoZChlWzBdLnNhbXBsZXM/ZVswXS5zYW1wbGVzWzBdLmdvcElkOjApXS5jb25jYXQoeChlLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIHQudHJhZihlKX0pKSkpKX19LHtrZXk6Im1maGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0LmJveCh0LnR5cGVzLm1maGQsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSkpfX0se2tleToidHJhZiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9dC50ZmhkKGUuaWQpLG49dC50ZmR0KGUsZS5iYXNlTWVkaWFEZWNvZGVUaW1lKTtpZihlLnVzZUVNRSYmKGUuaXNWaWRlb0VuY3J5cHRpb258fGUuaXNBdWRpb0VuY3J5cHRpb24pKXtpZihlLmlzVmlkZW9FbmNyeXB0aW9uKXtpZigxPT09ZS5pZCl7dmFyIGk9dC5zYWl6KGUpLGE9dC5zYWlvKGUpLG89dC50cnVuMShlKSxzPXQuc2VuYyhlKTtyZXR1cm4gdC5ib3godC50eXBlcy50cmFmLHIsbixpLGEsbyxzKX1pZihlLmlzQXVkaW9FbmNyeXB0aW9uKXt2YXIgdT10LnNiZ3AoKSxjPXQuc2FpeihlKSxmPXQuc2FpbyhlKSxsPXQuc2VuYyhlKSxkPXQudHJ1bjEoZSk7cmV0dXJuIHQuYm94KHQudHlwZXMudHJhZixyLG4sdSxjLGYsbCxkKX12YXIgaD10LnNiZ3AoKSxwPXQudHJ1bjEoZSk7cmV0dXJuIHQuYm94KHQudHlwZXMudHJhZixyLG4saCxwKX1pZigxPT09ZS5pZCl7dmFyIHY9dC50cnVuMShlKTtyZXR1cm4gdC5ib3godC50eXBlcy50cmFmLHIsbix2KX12YXIgeT10LnNiZ3AoKSxnPXQuc2FpeihlKSxtPXQuc2FpbyhlKSxiPXQuc2VuYyhlKSx3PXQudHJ1bjEoZSk7cmV0dXJuIHQuYm94KHQudHlwZXMudHJhZixyLG4seSxnLG0sYix3KX12YXIgaz10LnNkdHAoZSk7cmV0dXJuIHQuYm94KHQudHlwZXMudHJhZixyLG4sayx0LnRydW4oZS5zYW1wbGVzLGsuYnl0ZUxlbmd0aCs3NikpfX0se2tleToic2R0cCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9bmV3IG1wO3JldHVybiBlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24odCl7ci53cml0ZShuZXcgVWludDhBcnJheSgxPT09ZS5pZD9bdC5rZXlmcmFtZT8zMjoxNl06WzE2XSkpfSkpLHQuYm94KHQudHlwZXMuc2R0cCx0aGlzLmV4dGVuc2lvbigwLDApLHIuYnVmZmVyKX19LHtrZXk6InRydW4xIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1uZXcgbXAsbj1tcC53cml0ZVVpbnQzMihlLnNhbXBsZXMubGVuZ3RoKSxpPW51bGw7aWYoMT09PWUuaWQpe3ZhciBhPWUudmlkZW9TZW5jTGVuZ3RoO2k9bXAud3JpdGVVaW50MzIoMTYqZS5zYW1wbGVzLmxlbmd0aCthKzE0OSksIWUuaXNWaWRlb0VuY3J5cHRpb24mJmUuaXNBdWRpb0VuY3J5cHRpb24mJihpPW1wLndyaXRlVWludDMyKDE2KmUuc2FtcGxlcy5sZW5ndGgrOTIpKX1lbHNle3ZhciBvPTEyKmUuc2FtcGxlcy5sZW5ndGgrMTI0O2UuaXNBdWRpb0VuY3J5cHRpb24mJihvPTEyKmUuc2FtcGxlcy5sZW5ndGgrOCplLmF1ZGlvU2VuYy5sZW5ndGgrMTc3KSxpPW1wLndyaXRlVWludDMyKG8pfXJldHVybiBlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24odCl7ci53cml0ZShtcC53cml0ZVVpbnQzMih0LmR1cmF0aW9uKSksci53cml0ZShtcC53cml0ZVVpbnQzMih0LnNpemUpKSxyLndyaXRlKG1wLndyaXRlVWludDMyKHQua2V5ZnJhbWU/MzM1NTQ0MzI6NjU1MzYpKSwxPT09ZS5pZCYmci53cml0ZShtcC53cml0ZVVpbnQzMih0LmN0cz90LmN0czowKSl9KSksdC5ib3godC50eXBlcy50cnVuLHRoaXMuZXh0ZW5zaW9uKDAsZS5mbGFncyksbixpLHIuYnVmZmVyKX19LHtrZXk6InNlbmMiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPW5ldyBtcCxuPWUuc2FtcGxlcy5sZW5ndGgsaT0xPT09ZS5pZD8xNjo4LGE9MT09PWUuaWQ/MjowLG89W10scz0wO3JldHVybiAxPT09ZS5pZD8obz1lLnZpZGVvU2VuYyxzPWUudmlkZW9TZW5jTGVuZ3RoKTpvPWUuYXVkaW9TZW5jLHM9c3x8aSpuLHIud3JpdGUobXAud3JpdGVVaW50MzIoMTYrcyksdC50eXBlcy5zZW5jLHRoaXMuZXh0ZW5zaW9uKDAsYSkpLHIud3JpdGUobXAud3JpdGVVaW50MzIobikpLG8uZm9yRWFjaCgoZnVuY3Rpb24odCl7Zm9yKHZhciBlPTA7ZTx0LkluaXRpYWxpemF0aW9uVmVjdG9yLmxlbmd0aDtlKyspci53cml0ZShuZXcgVWludDhBcnJheShbdC5Jbml0aWFsaXphdGlvblZlY3RvcltlXV0pKTt0LnN1YnNhbXBsZXMmJnQuc3Vic2FtcGxlcy5sZW5ndGgmJihyLndyaXRlKG1wLndyaXRlVWludDE2KHQuc3Vic2FtcGxlcy5sZW5ndGgpKSx0LnN1YnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24odCl7ci53cml0ZShtcC53cml0ZVVpbnQxNih0LkJ5dGVzT2ZDbGVhckRhdGEpKSxyLndyaXRlKG1wLndyaXRlVWludDMyKHQuQnl0ZXNPZlByb3RlY3RlZERhdGEpKX0pKSl9KSksci5idWZmZXJ9fSx7a2V5OiJzYWlvIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj0xMiplLnNhbXBsZXMubGVuZ3RoKzE0MTsyPT09ZS5pZCYmZS5pc0F1ZGlvRW5jcnlwdGlvbiYmKHI9MTQ5KTt2YXIgbj1uZXcgVWludDhBcnJheShbMSwwLDAsMCwwLDAsMCwxLDAsMCwwLDAscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pO3JldHVybiB0LmJveCh0LnR5cGVzLnNhaW8sbil9fSx7a2V5OiJzYWl6Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1lLnNhbXBsZXMubGVuZ3RoLG49bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMTYscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pO3JldHVybiB0LmJveCh0LnR5cGVzLnNhaXosbil9fSx7a2V5OiJzYmdwIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPW5ldyBVaW50OEFycmF5KFsxMTQsMTExLDEwOCwxMDgsMCwwLDAsMSwwLDAsMSwyNSwwLDAsMCwxXSk7cmV0dXJuIHQuYm94KHQudHlwZXMuc2JncCx0aGlzLmV4dGVuc2lvbigwLDApLGUpfX0se2tleToiZXh0ZW5zaW9uIix2YWx1ZTpmdW5jdGlvbih0LGUpe3JldHVybiBuZXcgVWludDhBcnJheShbdCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdKX19LHtrZXk6InRmaGQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0LmJveCh0LnR5cGVzLnRmaGQsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSkpfX0se2tleToidGZkdCIsdmFsdWU6ZnVuY3Rpb24oZSxyKXt2YXIgbj1NYXRoLmZsb29yKHIvKGJwKzEpKSxpPU1hdGguZmxvb3IociUoYnArMSkpO3JldHVybiBlLnVzZUVNRSYmKGUuaXNWaWRlb0VuY3J5cHRpb258fGUuaXNBdWRpb0VuY3J5cHRpb24pP3QuYm94KHQudHlwZXMudGZkdCxuZXcgVWludDhBcnJheShbMCwwLDAsMCxpPj4yNCxpPj4xNiYyNTUsaT4+OCYyNTUsMjU1JmldKSk6dC5ib3godC50eXBlcy50ZmR0LG5ldyBVaW50OEFycmF5KFsxLDAsMCwwLG4+PjI0LG4+PjE2JjI1NSxuPj44JjI1NSwyNTUmbixpPj4yNCxpPj4xNiYyNTUsaT4+OCYyNTUsMjU1JmldKSl9fSx7a2V5OiJ0cnVuIix2YWx1ZTpmdW5jdGlvbihlLHIpe3ZhciBuPWUubGVuZ3RoLGk9MTIrMTYqbjtyKz04K2k7dmFyIGE9bmV3IFVpbnQ4QXJyYXkoaSk7YS5zZXQoWzAsMCwxNSwxLG4+Pj4yNCYyNTUsbj4+PjE2JjI1NSxuPj4+OCYyNTUsMjU1Jm4scj4+PjI0JjI1NSxyPj4+MTYmMjU1LHI+Pj44JjI1NSwyNTUmcl0sMCk7Zm9yKHZhciBvPTA7bzxuO28rKyl7dmFyIHM9ZVtvXSx1PXMuZHVyYXRpb24sYz1zLnNpemUsZj1zLmZsYWcsbD12b2lkIDA9PT1mP3t9OmYsZD1zLmN0cyxoPXZvaWQgMD09PWQ/MDpkO2Euc2V0KFt1Pj4+MjQmMjU1LHU+Pj4xNiYyNTUsdT4+PjgmMjU1LDI1NSZ1LGM+Pj4yNCYyNTUsYz4+PjE2JjI1NSxjPj4+OCYyNTUsMjU1JmMsbC5pc0xlYWRpbmc8PDJ8KG51bGw9PT1sLmRlcGVuZHNPbnx8dm9pZCAwPT09bC5kZXBlbmRzT24/MTpsLmRlcGVuZHNPbiksbC5pc0RlcGVuZGVkT248PDZ8bC5oYXNSZWR1bmRhbmN5PDw0fGwucGFkZGluZ1ZhbHVlPDwxfChudWxsPT09bC5pc05vblN5bmNTYW1wbGV8fHZvaWQgMD09PWwuaXNOb25TeW5jU2FtcGxlPzE6bC5pc05vblN5bmNTYW1wbGUpLDYxNDQwJmwuZGVncmFkYXRpb25Qcmlvcml0eSwxNSZsLmRlZ3JhZGF0aW9uUHJpb3JpdHksaD4+PjI0JjI1NSxoPj4+MTYmMjU1LGg+Pj44JjI1NSwyNTUmaF0sMTIrMTYqbyl9cmV0dXJuIHQuYm94KHQudHlwZXMudHJ1bixhKX19LHtrZXk6Im1vb3ZNUDQiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0LmJveC5hcHBseSh0LFt0LnR5cGVzLm1vb3YsdC5tdmhkKGVbMF0uZHVyYXRpb24sZVswXS50aW1lc2NhbGUpXS5jb25jYXQoeChlLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIHQudHJhY2tNUDQoZSl9KSkpKSl9fSx7a2V5OiJ0cmFja01QNCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuYm94KHQudHlwZXMudHJhayx0LnRraGQoZS5pZCxlLmR1cmF0aW9uLGUud2lkdGgsZS5oZWlnaHQpLHQubWRpYU1QNChlKSl9fSx7a2V5OiJtZGlhTVA0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdC5ib3godC50eXBlcy5tZGlhLHQubWRoZChlLmR1cmF0aW9uLGUudGltZXNjYWxlKSx0LmhkbHIoZS50eXBlKSx0Lm1pbmZNUDQoZSkpfX0se2tleToibWluZk1QNCIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHQuYm94KHQudHlwZXMubWluZixlLnR5cGU9PT1QaT90LlZNSEQ6dC5TTUhELHQuRElORix0LnN0YmxNUDQoZSkpfX0se2tleToic3RibE1QNCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9ZS5leHQsbj1bdC5zdHNkKGUpLHQuc3R0cyhyLnN0dHMpLHQuc3RzYyhyLnN0c2MpLHQuc3RzeihyLnN0c3opLHQuc3RjbyhyLnN0Y28pXTtyZXR1cm4gci5zdHNzLmxlbmd0aCYmbi5wdXNoKHQuc3RzcyhyLnN0c3MpKSxyLmN0dHMubGVuZ3RoJiZuLnB1c2godC5jdHRzKHIuY3R0cykpLHQuYm94LmFwcGx5KHQsW3QudHlwZXMuc3RibF0uY29uY2F0KG4pKX19LHtrZXk6InN0dHMiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPWUubGVuZ3RoLG49bmV3IFVpbnQ4QXJyYXkoOCpyKSxpPTA7cmV0dXJuIGUuZm9yRWFjaCgoZnVuY3Rpb24odCl7dmFyIGU9dC52YWx1ZSxyPXQuY291bnQ7bi5zZXQoW3I+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcixlPj4yNCxlPj4xNiYyNTUsZT4+OCYyNTUsMjU1JmVdLGkpLGkrPTh9KSksdC5ib3godC50eXBlcy5zdHRzLGVoKG5ldyBVaW50OEFycmF5KFswLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLG4pKX19LHtrZXk6InN0c2MiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPWUubGVuZ3RoLG49bmV3IFVpbnQ4QXJyYXkoMTIqciksaT0wO3JldHVybiBlLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciBlPXQuZmlyc3RDaHVuayxyPXQuc2FtcGxlc1BlckNodW5rLGE9dC5zYW1wbGVEZXNjSW5kZXg7bi5zZXQoW2U+PjI0LGU+PjE2JjI1NSxlPj44JjI1NSwyNTUmZSxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsYT4+MjQsYT4+MTYmMjU1LGE+PjgmMjU1LDI1NSZhXSxpKSxpKz0xMn0pKSx0LmJveCh0LnR5cGVzLnN0c2MsZWgobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksbikpfX0se2tleToic3RzeiIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9ZS5sZW5ndGgsbj1uZXcgVWludDhBcnJheSg0KnIpLGk9MDtyZXR1cm4gZS5mb3JFYWNoKChmdW5jdGlvbih0KXtuLnNldChbdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0XSxpKSxpKz00fSkpLHQuYm94KHQudHlwZXMuc3RzeixlaChuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLHI+PjI0LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcl0pLG4pKX19LHtrZXk6InN0Y28iLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciByPWUubGVuZ3RoLG49bmV3IFVpbnQ4QXJyYXkoNCpyKSxpPTA7cmV0dXJuIGUuZm9yRWFjaCgoZnVuY3Rpb24odCl7bi5zZXQoW3Q+PjI0LHQ+PjE2JjI1NSx0Pj44JjI1NSwyNTUmdF0saSksaSs9NH0pKSx0LmJveCh0LnR5cGVzLnN0Y28sZWgobmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAscj4+MjQscj4+MTYmMjU1LHI+PjgmMjU1LDI1NSZyXSksbikpfX0se2tleToic3RzcyIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHI9ZS5sZW5ndGgsbj1uZXcgVWludDhBcnJheSg0KnIpLGk9MDtyZXR1cm4gZS5mb3JFYWNoKChmdW5jdGlvbih0KXtuLnNldChbdD4+MjQsdD4+MTYmMjU1LHQ+PjgmMjU1LDI1NSZ0XSxpKSxpKz00fSkpLHQuYm94KHQudHlwZXMuc3RzcyxlaChuZXcgVWludDhBcnJheShbMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxuKSl9fSx7a2V5OiJjdHRzIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1lLmxlbmd0aCxuPW5ldyBVaW50OEFycmF5KDgqciksaT0wO3JldHVybiBlLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciBlPXQudmFsdWUscj10LmNvdW50O24uc2V0KFtyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnIsZT4+MjQsZT4+MTYmMjU1LGU+PjgmMjU1LDI1NSZlXSxpKSxpKz04fSkpLHQuYm94KHQudHlwZXMuY3R0cyxlaChuZXcgVWludDhBcnJheShbMCwwLDAsMCxyPj4yNCxyPj4xNiYyNTUscj4+OCYyNTUsMjU1JnJdKSxuKSl9fSx7a2V5OiJzdHlwIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiB0LmJveCh0LnR5cGVzLnN0eXAsbmV3IFVpbnQ4QXJyYXkoWzEwOSwxMTUsMTAwLDEwNCwwLDAsMCwwLDEwOSwxMTUsMTAwLDEwNCwxMDksMTE1LDEwNSwxMjBdKSl9fSx7a2V5OiJzaWR4Iix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgcj1lLnRpbWVzY2FsZSxuPWUuc2FtcGxlc1swXS5kdXJhdGlvbixpPW4qZS5zYW1wbGVzLmxlbmd0aCxhPWUuc2FtcGxlc1swXS5zYW1wbGVPZmZzZXQqbixvPTg7ZS5zYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQpe28rPXQuc2l6ZX0pKTt2YXIgcz0wO2lmKDE9PT1lLmlkKXt2YXIgdSxjPTA7ZS52aWRlb1NlbmMmJih1PWUudmlkZW9TZW5jKSwxPT09ZS5pZCYmdS5mb3JFYWNoKChmdW5jdGlvbih0KXtjKz04LHQuc3Vic2FtcGxlcyYmdC5zdWJzYW1wbGVzLmxlbmd0aCYmKGMrPTIsYys9Nip0LnN1YnNhbXBsZXMubGVuZ3RoKX0pKSxlLnZpZGVvU2VuY0xlbmd0aD1jLHM9bysxNDErMTYqZS5zYW1wbGVzLmxlbmd0aCtjLGUudXNlRU1FJiZlLmlzQXVkaW9FbmNyeXB0aW9uJiYhZS5pc1ZpZGVvRW5jcnlwdGlvbiYmKHM9bysxNiplLnNhbXBsZXMubGVuZ3RoKzg0KX1lbHNlIHM9bysxMTYrMTIqZS5zYW1wbGVzLmxlbmd0aCxlLnVzZUVNRSYmZS5pc0F1ZGlvRW5jcnlwdGlvbiYmKHM9bysxNjkrMTIqZS5zYW1wbGVzLmxlbmd0aCs4KmUuYXVkaW9TZW5jLmxlbmd0aCk7dmFyIGY9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMjU1JmUuaWQscj4+MjQmMjU1LHI+PjE2JjI1NSxyPj44JjI1NSwyNTUmcixhPj4yNCYyNTUsYT4+MTYmMjU1LGE+PjgmMjU1LDI1NSZhLDAsMCwwLDAsMCwwLDAsMSwwLHM+PjE2JjI1NSxzPj44JjI1NSwyNTUmcyxpPj4yNCYyNTUsaT4+MTYmMjU1LGk+PjgmMjU1LDI1NSZpLDE0NCwwLDAsMF0pO3JldHVybiB0LmJveCh0LnR5cGVzLnNpZHgsZil9fSx7a2V5OiJtZGF0Iix2YWx1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdC5ib3godC50eXBlcy5tZGF0LGUpfX1dKSx0fSgpO3cod3AsInR5cGVzIixbImF2YzEiLCJhdmNDIiwiaHZjMSIsImh2Y0MiLCJkaW5mIiwiZHJlZiIsImVzZHMiLCJmdHlwIiwiaGRsciIsIm1kYXQiLCJtZGhkIiwibWRpYSIsIm1maGQiLCJtaW5mIiwibW9vZiIsIm1vb3YiLCJtcDRhIiwibXZleCIsIm12aGQiLCJwYXNwIiwic3RibCIsInN0Y28iLCJzdHNjIiwic3RzZCIsInN0c3oiLCJzdHRzIiwidGZkdCIsInRmaGQiLCJ0cmFmIiwidHJhayIsInRyZXgiLCJ0a2hkIiwidm1oZCIsInNtaGQiLCJjdHRzIiwic3RzcyIsInN0eXAiLCJwc3NoIiwic2lkeCIsInNiZ3AiLCJzYWl6Iiwic2FpbyIsInNlbmMiLCJ0cnVuIiwiZW5jdiIsImVuY2EiLCJzaW5mIiwiYnRydCIsImZybWEiLCJ0ZW5jIiwic2NobSIsInNjaGkiLCJtZWhkIiwiZmllbCIsInNkdHAiXS5yZWR1Y2UoKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRbZV09W2UuY2hhckNvZGVBdCgwKSxlLmNoYXJDb2RlQXQoMSksZS5jaGFyQ29kZUF0KDIpLGUuY2hhckNvZGVBdCgzKV0sdH0pLE9iamVjdC5jcmVhdGUobnVsbCkpKSx3KHdwLCJIRExSX1RZUEVTIix7dmlkZW86bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwxMTgsMTA1LDEwMCwxMDEsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsODYsMTA1LDEwMCwxMDEsMTExLDcyLDk3LDExMCwxMDAsMTA4LDEwMSwxMTQsMF0pLGF1ZGlvOm5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMTE1LDExMSwxMTcsMTEwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDgzLDExMSwxMTcsMTEwLDEwMCw3Miw5NywxMTAsMTAwLDEwOCwxMDEsMTE0LDBdKX0pLHcod3AsIkZUWVBBVkMxIix3cC5ib3god3AudHlwZXMuZnR5cCxuZXcgVWludDhBcnJheShbMTA1LDExNSwxMTEsMTA5LDAsMCwwLDEsMTA1LDExNSwxMTEsMTA5LDk3LDExOCw5OSw0OV0pKSksdyh3cCwiRlRZUEhFVjEiLHdwLmJveCh3cC50eXBlcy5mdHlwLG5ldyBVaW50OEFycmF5KFsxMDUsMTE1LDExMSwxMDksMCwwLDAsMSwxMDUsMTE1LDExMSwxMDksMTA0LDEwMSwxMTgsNDldKSkpLHcod3AsIkRJTkYiLHdwLmJveCh3cC50eXBlcy5kaW5mLHdwLmJveCh3cC50eXBlcy5kcmVmLG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDEsMCwwLDAsMTIsMTE3LDExNCwxMDgsMzIsMCwwLDAsMV0pKSkpLHcod3AsIlZNSEQiLHdwLmJveCh3cC50eXBlcy52bWhkLG5ldyBVaW50OEFycmF5KFswLDAsMCwxLDAsMCwwLDAsMCwwLDAsMF0pKSksdyh3cCwiU01IRCIsd3AuYm94KHdwLnR5cGVzLnNtaGQsbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMF0pKSksdyh3cCwiU3RibFRhYmxlIixuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwXSkpLHcod3AsIlNUVFMiLHdwLmJveCh3cC50eXBlcy5zdHRzLHdwLlN0YmxUYWJsZSkpLHcod3AsIlNUU0MiLHdwLmJveCh3cC50eXBlcy5zdHNjLHdwLlN0YmxUYWJsZSkpLHcod3AsIlNUU1oiLHdwLmJveCh3cC50eXBlcy5zdHN6LG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMCwwLDAsMF0pKSksdyh3cCwiU1RDTyIsd3AuYm94KHdwLnR5cGVzLnN0Y28sd3AuU3RibFRhYmxlKSk7dmFyIGtwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlLHIpe2codGhpcyx0KSx0aGlzLm5hbWU9ZXx8IiIsdGhpcy5fcHJlZml4PSJbIi5jb25jYXQodGhpcy5uYW1lLCJdIiksdC5kaXNhYmxlZD1yfXJldHVybiBiKHQsW3trZXk6ImRlYnVnIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlO2lmKCF0LmRpc2FibGVkKXtmb3IodmFyIHI9YXJndW1lbnRzLmxlbmd0aCxuPW5ldyBBcnJheShyKSxpPTA7aTxyO2krKyluW2ldPWFyZ3VtZW50c1tpXTsoZT1jb25zb2xlKS5kZWJ1Zy5hcHBseShlLFt0aGlzLl9wcmVmaXhdLmNvbmNhdChuKSl9fX0se2tleToibG9nIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlO2lmKCF0LmRpc2FibGVkKXtmb3IodmFyIHI9YXJndW1lbnRzLmxlbmd0aCxuPW5ldyBBcnJheShyKSxpPTA7aTxyO2krKyluW2ldPWFyZ3VtZW50c1tpXTsoZT1jb25zb2xlKS5sb2cuYXBwbHkoZSxbdGhpcy5fcHJlZml4XS5jb25jYXQobikpfX19LHtrZXk6Indhcm4iLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU7aWYoIXQuZGlzYWJsZWQpe2Zvcih2YXIgcj1hcmd1bWVudHMubGVuZ3RoLG49bmV3IEFycmF5KHIpLGk9MDtpPHI7aSsrKW5baV09YXJndW1lbnRzW2ldOyhlPWNvbnNvbGUpLndhcm4uYXBwbHkoZSxbdGhpcy5fcHJlZml4XS5jb25jYXQobikpfX19LHtrZXk6ImVycm9yIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlO2lmKCF0LmRpc2FibGVkKXtmb3IodmFyIHI9YXJndW1lbnRzLmxlbmd0aCxuPW5ldyBBcnJheShyKSxpPTA7aTxyO2krKyluW2ldPWFyZ3VtZW50c1tpXTsoZT1jb25zb2xlKS5lcnJvci5hcHBseShlLFt0aGlzLl9wcmVmaXhdLmNvbmNhdChuKSl9fX0se2tleToidGFibGUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU7dC5kaXNhYmxlZHx8KGNvbnNvbGUuZ3JvdXAodGhpcy5fcHJlZml4KSwoZT1jb25zb2xlKS50YWJsZS5hcHBseShlLGFyZ3VtZW50cyksY29uc29sZS5ncm91cEVuZCgpKX19XSxbe2tleToiZW5hYmxlIix2YWx1ZTpmdW5jdGlvbigpe3QuZGlzYWJsZWQ9ITF9fSx7a2V5OiJkaXNhYmxlIix2YWx1ZTpmdW5jdGlvbigpe3QuZGlzYWJsZWQ9ITB9fV0pLHR9KCk7dyhrcCwiZGlzYWJsZWQiLCEwKTtmb3IodmFyIHhwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlLHIsbil7Zyh0aGlzLHQpLHRoaXMudmlkZW9UcmFjaz1lLHRoaXMuYXVkaW9UcmFjaz1yO3ZhciBpPS9DaHJvbWVcLyhbXi5dKykvLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudCk7dGhpcy5mb3JjZUZpcnN0SURSPWkmJk51bWJlcihpWzFdKTw1MCx0aGlzLmxvZz1uZXcga3AoIkZNUDRSZW11eGVyIiwhbnx8IW4ub3BlbkxvZ3x8IW4ub3BlbkxvZyl9cmV0dXJuIGIodCxbe2tleToicmVtdXgiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQsZSxyLG4saSxhPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdJiZhcmd1bWVudHNbMF0sbz1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e30scz10aGlzLnZpZGVvVHJhY2ssdT10aGlzLmF1ZGlvVHJhY2ssYz1zLmV4aXN0KCksZj11LmV4aXN0KCksbD1bXTtyZXR1cm4gYSYmKG8mJm8uaW5pdE1lcmdlPyhjJiZsLnB1c2godGhpcy52aWRlb1RyYWNrKSxmJiZsLnB1c2godGhpcy5hdWRpb1RyYWNrKSxyPXdwLmluaXRTZWdtZW50KGwpKTooYyYmKHQ9d3AuaW5pdFNlZ21lbnQoW3RoaXMudmlkZW9UcmFja10pKSxmJiYoZT13cC5pbml0U2VnbWVudChbdGhpcy5hdWRpb1RyYWNrXSkpKSksYyYmcy5oYXNTYW1wbGUoKSYmKG49dGhpcy5fcmVtdXhWaWRlbygpKSxmJiZ1Lmhhc1NhbXBsZSgpJiYoaT10aGlzLl9yZW11eEF1ZGlvKCkpLHMuc2FtcGxlcz1bXSx1LnNhbXBsZXM9W10se2luaXRTZWdtZW50OnIsdmlkZW9Jbml0U2VnbWVudDp0LGF1ZGlvSW5pdFNlZ21lbnQ6ZSx2aWRlb1NlZ21lbnQ6bixhdWRpb1NlZ21lbnQ6aX19fSx7a2V5OiJfcmVtdXhWaWRlbyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLnZpZGVvVHJhY2s7dGhpcy5mb3JjZUZpcnN0SURSJiYodC5zYW1wbGVzWzBdLmZsYWc9e2RlcGVuZHNPbjoyLGlzTm9uU3luY1NhbXBsZTowfSk7dmFyIGU9dC5zYW1wbGVzLHI9MDtlLmZvckVhY2goKGZ1bmN0aW9uKHQpe3IrPXQudW5pdHMucmVkdWNlKChmdW5jdGlvbih0LGUpe3JldHVybiB0K2UuYnl0ZUxlbmd0aH0pLDApLHIrPTQqdC51bml0cy5sZW5ndGh9KSk7Zm9yKHZhciBuLGk9bmV3IFVpbnQ4QXJyYXkociksYT1uZXcgRGF0YVZpZXcoaS5idWZmZXIpLG89ZnVuY3Rpb24odCxyLG8scyl7cz1lW3RdO3ZhciB1PTA7cy51bml0cy5mb3JFYWNoKChmdW5jdGlvbih0KXthLnNldFVpbnQzMihvLHQuYnl0ZUxlbmd0aCksbys9NCxpLnNldCh0LG8pLG8rPXQuYnl0ZUxlbmd0aCx1Kz00K3QuYnl0ZUxlbmd0aH0pKSxzLnNpemU9dSxjPW8sbj1zfSxzPTAsdT1lLmxlbmd0aCxjPTA7czx1O3MrKylvKHMsMCxjLG4pO3ZhciBmPXdwLm1kYXQoaSk7cmV0dXJuIHQuaXNWaWRlb0VuY3J5cHRpb258fHQuaXNBdWRpb0VuY3J5cHRpb24/ZWgod3Auc3R5cCgpLHdwLnNpZHgodCksd3AubW9vZihbdF0pLGYpOmVoKHdwLm1vb2YoW3RdKSxmKX19LHtrZXk6Il9yZW11eEF1ZGlvIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuYXVkaW9UcmFjayxlPW5ldyBVaW50OEFycmF5KHQuc2FtcGxlcy5yZWR1Y2UoKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQrZS5zaXplfSksMCkpO3Quc2FtcGxlcy5yZWR1Y2UoKGZ1bmN0aW9uKHQscil7cmV0dXJuIGUuc2V0KHIuZGF0YSx0KSx0K3Iuc2l6ZX0pLDApO3ZhciByPXdwLm1kYXQoZSk7cmV0dXJuIHQuaXNWaWRlb0VuY3J5cHRpb258fHQuaXNBdWRpb0VuY3J5cHRpb24/ZWgod3Auc3R5cCgpLHdwLnNpZHgodCksd3AubW9vZihbdF0pLHIpOmVoKHdwLm1vb2YoW3RdKSxyKX19LHtrZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMudmlkZW9UcmFjay5yZXNldCgpLHRoaXMuYXVkaW9UcmFjay5yZXNldCgpfX1dKSx0fSgpLEFwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe24odGhpcyx0KX1yZXR1cm4gYSh0LFt7a2V5OiJtaXhJbiIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIE9iamVjdC5hc3NpZ24odGhpcyx0KX19LHtrZXk6ImNsb25lIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PW5ldyB0aGlzLmNvbnN0cnVjdG9yO3JldHVybiBPYmplY3QuYXNzaWduKHQsdGhpcyksdH19XSxbe2tleToiY3JlYXRlIix2YWx1ZTpmdW5jdGlvbigpe2Zvcih2YXIgdD1hcmd1bWVudHMubGVuZ3RoLGU9bmV3IEFycmF5KHQpLHI9MDtyPHQ7cisrKWVbcl09YXJndW1lbnRzW3JdO3JldHVybiBsKHRoaXMsZSl9fV0pLHR9KCksU3A9ZnVuY3Rpb24odCl7cyhyLHQpO3ZhciBlPWgocik7ZnVuY3Rpb24gcigpe3ZhciB0LGk9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOltdLGE9YXJndW1lbnRzLmxlbmd0aD4xJiZ2b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjQqaS5sZW5ndGg7bih0aGlzLHIpLHQ9ZS5jYWxsKHRoaXMpO3ZhciBvPWk7aWYobyBpbnN0YW5jZW9mIEFycmF5QnVmZmVyJiYobz1uZXcgVWludDhBcnJheShvKSksKG8gaW5zdGFuY2VvZiBJbnQ4QXJyYXl8fG8gaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheXx8byBpbnN0YW5jZW9mIEludDE2QXJyYXl8fG8gaW5zdGFuY2VvZiBVaW50MTZBcnJheXx8byBpbnN0YW5jZW9mIEludDMyQXJyYXl8fG8gaW5zdGFuY2VvZiBVaW50MzJBcnJheXx8byBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheXx8byBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkmJihvPW5ldyBVaW50OEFycmF5KG8uYnVmZmVyLG8uYnl0ZU9mZnNldCxvLmJ5dGVMZW5ndGgpKSxvIGluc3RhbmNlb2YgVWludDhBcnJheSl7Zm9yKHZhciBzPW8uYnl0ZUxlbmd0aCx1PVtdLGM9MDtjPHM7Yys9MSl1W2M+Pj4yXXw9b1tjXTw8MjQtYyU0Kjg7dC53b3Jkcz11LHQuc2lnQnl0ZXM9c31lbHNlIHQud29yZHM9aSx0LnNpZ0J5dGVzPWE7cmV0dXJuIHR9cmV0dXJuIGEocixbe2tleToidG9TdHJpbmciLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aD4wJiZ2b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOl9wO3JldHVybiB0LnN0cmluZ2lmeSh0aGlzKX19LHtrZXk6ImNvbmNhdCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy53b3JkcyxyPXQud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9dC5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKz0xKXt2YXIgbz1yW2E+Pj4yXT4+PjI0LWElNCo4JjI1NTtlW24rYT4+PjJdfD1vPDwyNC0obithKSU0Kjh9ZWxzZSBmb3IodmFyIHM9MDtzPGk7cys9NCllW24rcz4+PjJdPXJbcz4+PjJdO3JldHVybiB0aGlzLnNpZ0J5dGVzKz1pLHRoaXN9fSx7a2V5OiJjbGFtcCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLndvcmRzLGU9dGhpcy5zaWdCeXRlczt0W2U+Pj4yXSY9NDI5NDk2NzI5NTw8MzItZSU0KjgsdC5sZW5ndGg9TWF0aC5jZWlsKGUvNCl9fSx7a2V5OiJjbG9uZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD12KHUoci5wcm90b3R5cGUpLCJjbG9uZSIsdGhpcykuY2FsbCh0aGlzKTtyZXR1cm4gdC53b3Jkcz10aGlzLndvcmRzLnNsaWNlKDApLHR9fV0sW3trZXk6InJhbmRvbSIsdmFsdWU6ZnVuY3Rpb24odCl7Zm9yKHZhciBlLG49W10saT1mdW5jdGlvbih0KXt2YXIgZT10LHI9OTg3NjU0MzIxLG49NDI5NDk2NzI5NTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgdD0oKHI9MzY5NjkqKDY1NTM1JnIpKyhyPj4xNikmbik8PDE2KSsoZT0xOGUzKig2NTUzNSZlKSsoZT4+MTYpJm4pJm47cmV0dXJuIHQvPTQyOTQ5NjcyOTYsKHQrPS41KSooTWF0aC5yYW5kb20oKT4uNT8xOi0xKX19LGE9MDthPHQ7YSs9NCl7dmFyIG89aSg0Mjk0OTY3Mjk2KihlfHxNYXRoLnJhbmRvbSgpKSk7ZT05ODc2NTQwNzEqbygpLG4ucHVzaCg0Mjk0OTY3Mjk2Km8oKXwwKX1yZXR1cm4gbmV3IHIobix0KX19XSkscn0oQXApLF9wPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKz0xKXt2YXIgYT1lW2k+Pj4yXT4+PjI0LWklNCo4JjI1NTtuLnB1c2goKGE+Pj40KS50b1N0cmluZygxNikpLG4ucHVzaCgoMTUmYSkudG9TdHJpbmcoMTYpKX1yZXR1cm4gbi5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQubGVuZ3RoLHI9W10sbj0wO248ZTtuKz0yKXJbbj4+PjNdfD1wYXJzZUludCh0LnN1YnN0cihuLDIpLDE2KTw8MjQtbiU4KjQ7cmV0dXJuIG5ldyBTcChyLGUvMil9fSxUcD1mdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rPTEpcltuPj4+Ml18PSgyNTUmdC5jaGFyQ29kZUF0KG4pKTw8MjQtbiU0Kjg7cmV0dXJuIG5ldyBTcChyLGUpfSxFcD1mdW5jdGlvbih0KXtyZXR1cm4gVHAodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHQpKSl9LElwPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIoKXt2YXIgdDtyZXR1cm4gbih0aGlzLHIpLCh0PWUuY2FsbCh0aGlzKSkuX21pbkJ1ZmZlclNpemU9MCx0fXJldHVybiBhKHIsW3trZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuX2RhdGE9bmV3IFNwLHRoaXMuX25EYXRhQnl0ZXM9MH19LHtrZXk6Il9hcHBlbmQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXQ7InN0cmluZyI9PXR5cGVvZiBlJiYoZT1FcChlKSksdGhpcy5fZGF0YS5jb25jYXQoZSksdGhpcy5fbkRhdGFCeXRlcys9ZS5zaWdCeXRlc319LHtrZXk6Il9wcm9jZXNzIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZSxyPXRoaXMuX2RhdGEsbj10aGlzLmJsb2NrU2l6ZSxpPXIud29yZHMsYT1yLnNpZ0J5dGVzLG89YS8oNCpuKSxzPShvPXQ/TWF0aC5jZWlsKG8pOk1hdGgubWF4KCgwfG8pLXRoaXMuX21pbkJ1ZmZlclNpemUsMCkpKm4sdT1NYXRoLm1pbig0KnMsYSk7aWYocyl7Zm9yKHZhciBjPTA7YzxzO2MrPW4pdGhpcy5fZG9Qcm9jZXNzQmxvY2soaSxjKTtlPWkuc3BsaWNlKDAscyksci5zaWdCeXRlcy09dX1yZXR1cm4gbmV3IFNwKGUsdSl9fSx7a2V5OiJjbG9uZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD12KHUoci5wcm90b3R5cGUpLCJjbG9uZSIsdGhpcykuY2FsbCh0aGlzKTtyZXR1cm4gdC5fZGF0YT10aGlzLl9kYXRhLmNsb25lKCksdH19XSkscn0oQXApLE9wPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIodCl7dmFyIGk7cmV0dXJuIG4odGhpcyxyKSwoaT1lLmNhbGwodGhpcykpLmJsb2NrU2l6ZT0xNixpLmNmZz1PYmplY3QuYXNzaWduKG5ldyBBcCx0KSxpLnJlc2V0KCksaX1yZXR1cm4gYShyLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2KHUoci5wcm90b3R5cGUpLCJyZXNldCIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9fSx7a2V5OiJ1cGRhdGUiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpLHRoaXN9fSx7a2V5OiJmaW5hbGl6ZSIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnRoaXMuX2FwcGVuZCh0KSx0aGlzLl9kb0ZpbmFsaXplKCl9fV0sW3trZXk6Il9jcmVhdGVIZWxwZXIiLHZhbHVlOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiBuZXcgdChyKS5maW5hbGl6ZShlKX19fSx7a2V5OiJfY3JlYXRlSG1hY0hlbHBlciIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscil7cmV0dXJuIG5ldyBNcCh0LHIpLmZpbmFsaXplKGUpfX19XSkscn0oSXApLE1wPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIodCxpKXt2YXIgYTtuKHRoaXMsciksYT1lLmNhbGwodGhpcyk7dmFyIG89bmV3IHQ7YS5faGFzaGVyPW87dmFyIHM9aTsic3RyaW5nIj09dHlwZW9mIHMmJihzPUVwKHMpKTt2YXIgdT1vLmJsb2NrU2l6ZSxjPTQqdTtzLnNpZ0J5dGVzPmMmJihzPW8uZmluYWxpemUoaSkpLHMuY2xhbXAoKTt2YXIgZj1zLmNsb25lKCk7YS5fb0tleT1mO3ZhciBsPXMuY2xvbmUoKTthLl9pS2V5PWw7Zm9yKHZhciBkPWYud29yZHMsaD1sLndvcmRzLHA9MDtwPHU7cCs9MSlkW3BdXj0xNTQ5NTU2ODI4LGhbcF1ePTkwOTUyMjQ4NjtyZXR1cm4gZi5zaWdCeXRlcz1jLGwuc2lnQnl0ZXM9YyxhLnJlc2V0KCksYX1yZXR1cm4gYShyLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9oYXNoZXI7dC5yZXNldCgpLHQudXBkYXRlKHRoaXMuX2lLZXkpfX0se2tleToidXBkYXRlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZSh0KSx0aGlzfX0se2tleToiZmluYWxpemUiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMuX2hhc2hlcixyPWUuZmluYWxpemUodCk7cmV0dXJuIGUucmVzZXQoKSxlLmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQocikpfX1dKSxyfShBcCksQ3A9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LndvcmRzLHI9dC5zaWdCeXRlcyxuPXRoaXMuX21hcDt0LmNsYW1wKCk7Zm9yKHZhciBpPVtdLGE9MDthPHI7YSs9Mylmb3IodmFyIG89KGVbYT4+PjJdPj4+MjQtYSU0KjgmMjU1KTw8MTZ8KGVbYSsxPj4+Ml0+Pj4yNC0oYSsxKSU0KjgmMjU1KTw8OHxlW2ErMj4+PjJdPj4+MjQtKGErMiklNCo4JjI1NSxzPTA7czw0JiZhKy43NSpzPHI7cys9MSlpLnB1c2gobi5jaGFyQXQobz4+PjYqKDMtcykmNjMpKTt2YXIgdT1uLmNoYXJBdCg2NCk7aWYodSlmb3IoO2kubGVuZ3RoJTQ7KWkucHVzaCh1KTtyZXR1cm4gaS5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGU9dC5sZW5ndGgscj10aGlzLl9tYXAsbj10aGlzLl9yZXZlcnNlTWFwO2lmKCFuKXt0aGlzLl9yZXZlcnNlTWFwPVtdLG49dGhpcy5fcmV2ZXJzZU1hcDtmb3IodmFyIGk9MDtpPHIubGVuZ3RoO2krPTEpbltyLmNoYXJDb2RlQXQoaSldPWl9dmFyIGE9ci5jaGFyQXQoNjQpO2lmKGEpe3ZhciBvPXQuaW5kZXhPZihhKTstMSE9PW8mJihlPW8pfXJldHVybiBmdW5jdGlvbih0LGUscil7Zm9yKHZhciBuPVtdLGk9MCxhPTA7YTxlO2ErPTEpaWYoYSU0KXt2YXIgbz1yW3QuY2hhckNvZGVBdChhLTEpXTw8YSU0KjJ8clt0LmNoYXJDb2RlQXQoYSldPj4+Ni1hJTQqMjtuW2k+Pj4yXXw9bzw8MjQtaSU0KjgsaSs9MX1yZXR1cm4gU3AuY3JlYXRlKG4saSl9KHQsZSxuKX0sX21hcDoiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0ifSxScD1bXSxCcD0wO0JwPDY0O0JwKz0xKVJwW0JwXT00Mjk0OTY3Mjk2Kk1hdGguYWJzKE1hdGguc2luKEJwKzEpKXwwO3ZhciBQcD1mdW5jdGlvbih0LGUscixuLGksYSxvKXt2YXIgcz10KyhlJnJ8fmUmbikraStvO3JldHVybihzPDxhfHM+Pj4zMi1hKStlfSxVcD1mdW5jdGlvbih0LGUscixuLGksYSxvKXt2YXIgcz10KyhlJm58ciZ+bikraStvO3JldHVybihzPDxhfHM+Pj4zMi1hKStlfSxEcD1mdW5jdGlvbih0LGUscixuLGksYSxvKXt2YXIgcz10KyhlXnJebikraStvO3JldHVybihzPDxhfHM+Pj4zMi1hKStlfSx6cD1mdW5jdGlvbih0LGUscixuLGksYSxvKXt2YXIgcz10KyhyXihlfH5uKSkraStvO3JldHVybihzPDxhfHM+Pj4zMi1hKStlfSxqcD1mdW5jdGlvbih0KXtzKHIsdCk7dmFyIGU9aChyKTtmdW5jdGlvbiByKCl7cmV0dXJuIG4odGhpcyxyKSxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gYShyLFt7a2V5OiJfZG9SZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBTcChbMTczMjU4NDE5Myw0MDIzMjMzNDE3LDI1NjIzODMxMDIsMjcxNzMzODc4XSl9fSx7a2V5OiJfZG9Qcm9jZXNzQmxvY2siLHZhbHVlOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXQsbj0wO248MTY7bis9MSl7dmFyIGk9ZStuLGE9dFtpXTtyW2ldPTE2NzExOTM1JihhPDw4fGE+Pj4yNCl8NDI3ODI1NTM2MCYoYTw8MjR8YT4+PjgpfXZhciBvPXRoaXMuX2hhc2gud29yZHMscz1yW2UrMF0sdT1yW2UrMV0sYz1yW2UrMl0sZj1yW2UrM10sbD1yW2UrNF0sZD1yW2UrNV0saD1yW2UrNl0scD1yW2UrN10sdj1yW2UrOF0seT1yW2UrOV0sZz1yW2UrMTBdLG09cltlKzExXSxiPXJbZSsxMl0sdz1yW2UrMTNdLGs9cltlKzE0XSx4PXJbZSsxNV0sQT1vWzBdLFM9b1sxXSxfPW9bMl0sVD1vWzNdO0E9UHAoQSxTLF8sVCxzLDcsUnBbMF0pLFQ9UHAoVCxBLFMsXyx1LDEyLFJwWzFdKSxfPVBwKF8sVCxBLFMsYywxNyxScFsyXSksUz1QcChTLF8sVCxBLGYsMjIsUnBbM10pLEE9UHAoQSxTLF8sVCxsLDcsUnBbNF0pLFQ9UHAoVCxBLFMsXyxkLDEyLFJwWzVdKSxfPVBwKF8sVCxBLFMsaCwxNyxScFs2XSksUz1QcChTLF8sVCxBLHAsMjIsUnBbN10pLEE9UHAoQSxTLF8sVCx2LDcsUnBbOF0pLFQ9UHAoVCxBLFMsXyx5LDEyLFJwWzldKSxfPVBwKF8sVCxBLFMsZywxNyxScFsxMF0pLFM9UHAoUyxfLFQsQSxtLDIyLFJwWzExXSksQT1QcChBLFMsXyxULGIsNyxScFsxMl0pLFQ9UHAoVCxBLFMsXyx3LDEyLFJwWzEzXSksXz1QcChfLFQsQSxTLGssMTcsUnBbMTRdKSxTPVBwKFMsXyxULEEseCwyMixScFsxNV0pLEE9VXAoQSxTLF8sVCx1LDUsUnBbMTZdKSxUPVVwKFQsQSxTLF8saCw5LFJwWzE3XSksXz1VcChfLFQsQSxTLG0sMTQsUnBbMThdKSxTPVVwKFMsXyxULEEscywyMCxScFsxOV0pLEE9VXAoQSxTLF8sVCxkLDUsUnBbMjBdKSxUPVVwKFQsQSxTLF8sZyw5LFJwWzIxXSksXz1VcChfLFQsQSxTLHgsMTQsUnBbMjJdKSxTPVVwKFMsXyxULEEsbCwyMCxScFsyM10pLEE9VXAoQSxTLF8sVCx5LDUsUnBbMjRdKSxUPVVwKFQsQSxTLF8sayw5LFJwWzI1XSksXz1VcChfLFQsQSxTLGYsMTQsUnBbMjZdKSxTPVVwKFMsXyxULEEsdiwyMCxScFsyN10pLEE9VXAoQSxTLF8sVCx3LDUsUnBbMjhdKSxUPVVwKFQsQSxTLF8sYyw5LFJwWzI5XSksXz1VcChfLFQsQSxTLHAsMTQsUnBbMzBdKSxTPVVwKFMsXyxULEEsYiwyMCxScFszMV0pLEE9RHAoQSxTLF8sVCxkLDQsUnBbMzJdKSxUPURwKFQsQSxTLF8sdiwxMSxScFszM10pLF89RHAoXyxULEEsUyxtLDE2LFJwWzM0XSksUz1EcChTLF8sVCxBLGssMjMsUnBbMzVdKSxBPURwKEEsUyxfLFQsdSw0LFJwWzM2XSksVD1EcChULEEsUyxfLGwsMTEsUnBbMzddKSxfPURwKF8sVCxBLFMscCwxNixScFszOF0pLFM9RHAoUyxfLFQsQSxnLDIzLFJwWzM5XSksQT1EcChBLFMsXyxULHcsNCxScFs0MF0pLFQ9RHAoVCxBLFMsXyxzLDExLFJwWzQxXSksXz1EcChfLFQsQSxTLGYsMTYsUnBbNDJdKSxTPURwKFMsXyxULEEsaCwyMyxScFs0M10pLEE9RHAoQSxTLF8sVCx5LDQsUnBbNDRdKSxUPURwKFQsQSxTLF8sYiwxMSxScFs0NV0pLF89RHAoXyxULEEsUyx4LDE2LFJwWzQ2XSksUz1EcChTLF8sVCxBLGMsMjMsUnBbNDddKSxBPXpwKEEsUyxfLFQscyw2LFJwWzQ4XSksVD16cChULEEsUyxfLHAsMTAsUnBbNDldKSxfPXpwKF8sVCxBLFMsaywxNSxScFs1MF0pLFM9enAoUyxfLFQsQSxkLDIxLFJwWzUxXSksQT16cChBLFMsXyxULGIsNixScFs1Ml0pLFQ9enAoVCxBLFMsXyxmLDEwLFJwWzUzXSksXz16cChfLFQsQSxTLGcsMTUsUnBbNTRdKSxTPXpwKFMsXyxULEEsdSwyMSxScFs1NV0pLEE9enAoQSxTLF8sVCx2LDYsUnBbNTZdKSxUPXpwKFQsQSxTLF8seCwxMCxScFs1N10pLF89enAoXyxULEEsUyxoLDE1LFJwWzU4XSksUz16cChTLF8sVCxBLHcsMjEsUnBbNTldKSxBPXpwKEEsUyxfLFQsbCw2LFJwWzYwXSksVD16cChULEEsUyxfLG0sMTAsUnBbNjFdKSxfPXpwKF8sVCxBLFMsYywxNSxScFs2Ml0pLFM9enAoUyxfLFQsQSx5LDIxLFJwWzYzXSksb1swXT1vWzBdK0F8MCxvWzFdPW9bMV0rU3wwLG9bMl09b1syXStffDAsb1szXT1vWzNdK1R8MH19LHtrZXk6Il9kb0ZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEsZT10LndvcmRzLHI9OCp0aGlzLl9uRGF0YUJ5dGVzLG49OCp0LnNpZ0J5dGVzO2Vbbj4+PjVdfD0xMjg8PDI0LW4lMzI7dmFyIGk9TWF0aC5mbG9vcihyLzQyOTQ5NjcyOTYpLGE9cjtlWzE1KyhuKzY0Pj4+OTw8NCldPTE2NzExOTM1JihpPDw4fGk+Pj4yNCl8NDI3ODI1NTM2MCYoaTw8MjR8aT4+PjgpLGVbMTQrKG4rNjQ+Pj45PDw0KV09MTY3MTE5MzUmKGE8PDh8YT4+PjI0KXw0Mjc4MjU1MzYwJihhPDwyNHxhPj4+OCksdC5zaWdCeXRlcz00KihlLmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBvPXRoaXMuX2hhc2gscz1vLndvcmRzLHU9MDt1PDQ7dSs9MSl7dmFyIGM9c1t1XTtzW3VdPTE2NzExOTM1JihjPDw4fGM+Pj4yNCl8NDI3ODI1NTM2MCYoYzw8MjR8Yz4+PjgpfXJldHVybiBvfX0se2tleToiY2xvbmUiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ9dih1KHIucHJvdG90eXBlKSwiY2xvbmUiLHRoaXMpLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fV0pLHJ9KE9wKTtPcC5fY3JlYXRlSGVscGVyKGpwKSxPcC5fY3JlYXRlSG1hY0hlbHBlcihqcCk7dmFyIExwPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIodCl7dmFyIGk7cmV0dXJuIG4odGhpcyxyKSwoaT1lLmNhbGwodGhpcykpLmNmZz1PYmplY3QuYXNzaWduKG5ldyBBcCx7a2V5U2l6ZTo0LGhhc2hlcjpqcCxpdGVyYXRpb25zOjF9LHQpLGl9cmV0dXJuIGEocixbe2tleToiY29tcHV0ZSIsdmFsdWU6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHIsbj10aGlzLmNmZyxpPW4uaGFzaGVyLmNyZWF0ZSgpLGE9U3AuY3JlYXRlKCksbz1hLndvcmRzLHM9bi5rZXlTaXplLHU9bi5pdGVyYXRpb25zO28ubGVuZ3RoPHM7KXtyJiZpLnVwZGF0ZShyKSxyPWkudXBkYXRlKHQpLmZpbmFsaXplKGUpLGkucmVzZXQoKTtmb3IodmFyIGM9MTtjPHU7Yys9MSlyPWkuZmluYWxpemUociksaS5yZXNldCgpO2EuY29uY2F0KHIpfXJldHVybiBhLnNpZ0J5dGVzPTQqcyxhfX1dKSxyfShBcCksRnA9ZnVuY3Rpb24odCl7cyhyLHQpO3ZhciBlPWgocik7ZnVuY3Rpb24gcih0LGksYSl7dmFyIG87cmV0dXJuIG4odGhpcyxyKSwobz1lLmNhbGwodGhpcykpLmNmZz1PYmplY3QuYXNzaWduKG5ldyBBcCxhKSxvLl94Zm9ybU1vZGU9dCxvLl9rZXk9aSxvLnJlc2V0KCksb31yZXR1cm4gYShyLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2KHUoci5wcm90b3R5cGUpLCJyZXNldCIsdGhpcykuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9fSx7a2V5OiJwcm9jZXNzIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKX19LHtrZXk6ImZpbmFsaXplIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX19XSxbe2tleToiY3JlYXRlRW5jcnlwdG9yIix2YWx1ZTpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9FTkNfWEZPUk1fTU9ERSx0LGUpfX0se2tleToiY3JlYXRlRGVjcnlwdG9yIix2YWx1ZTpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9ERUNfWEZPUk1fTU9ERSx0LGUpfX0se2tleToiX2NyZWF0ZUhlbHBlciIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24odCl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0PyRwOnFwfTtyZXR1cm57ZW5jcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIGUobikuZW5jcnlwdCh0LHIsbixpKX0sZGVjcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIGUobikuZGVjcnlwdCh0LHIsbixpKX19fX1dKSxyfShJcCk7RnAuX0VOQ19YRk9STV9NT0RFPTEsRnAuX0RFQ19YRk9STV9NT0RFPTIsRnAua2V5U2l6ZT00LEZwLml2U2l6ZT00O3ZhciBOcD1mdW5jdGlvbih0KXtzKHIsdCk7dmFyIGU9aChyKTtmdW5jdGlvbiByKHQsaSl7dmFyIGE7cmV0dXJuIG4odGhpcyxyKSwoYT1lLmNhbGwodGhpcykpLl9jaXBoZXI9dCxhLl9pdj1pLGF9cmV0dXJuIGEocixudWxsLFt7a2V5OiJjcmVhdGVFbmNyeXB0b3IiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRW5jcnlwdG9yLmNyZWF0ZSh0LGUpfX0se2tleToiY3JlYXRlRGVjcnlwdG9yIix2YWx1ZTpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkRlY3J5cHRvci5jcmVhdGUodCxlKX19XSkscn0oQXApO2Z1bmN0aW9uIFZwKHQsZSxyKXt2YXIgbixpPXQsYT10aGlzLl9pdjthPyhuPWEsdGhpcy5faXY9dm9pZCAwKTpuPXRoaXMuX3ByZXZCbG9jaztmb3IodmFyIG89MDtvPHI7bys9MSlpW2Urb11ePW5bb119dmFyIEhwPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIoKXtyZXR1cm4gbih0aGlzLHIpLGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBhKHIpfShOcCk7SHAuRW5jcnlwdG9yPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIoKXtyZXR1cm4gbih0aGlzLHIpLGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBhKHIsW3trZXk6InByb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24odCxlKXt2YXIgcj10aGlzLl9jaXBoZXIsbj1yLmJsb2NrU2l6ZTtWcC5jYWxsKHRoaXMsdCxlLG4pLHIuZW5jcnlwdEJsb2NrKHQsZSksdGhpcy5fcHJldkJsb2NrPXQuc2xpY2UoZSxlK24pfX1dKSxyfShIcCksSHAuRGVjcnlwdG9yPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIoKXtyZXR1cm4gbih0aGlzLHIpLGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBhKHIsW3trZXk6InByb2Nlc3NCbG9jayIsdmFsdWU6ZnVuY3Rpb24odCxlKXt2YXIgcj10aGlzLl9jaXBoZXIsbj1yLmJsb2NrU2l6ZSxpPXQuc2xpY2UoZSxlK24pO3IuZGVjcnlwdEJsb2NrKHQsZSksVnAuY2FsbCh0aGlzLHQsZSxuKSx0aGlzLl9wcmV2QmxvY2s9aX19XSkscn0oSHApO3ZhciBZcD17cGFkOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTQqZSxuPXItdC5zaWdCeXRlcyVyLGk9bjw8MjR8bjw8MTZ8bjw8OHxuLGE9W10sbz0wO288bjtvKz00KWEucHVzaChpKTt2YXIgcz1TcC5jcmVhdGUoYSxuKTt0LmNvbmNhdChzKX0sdW5wYWQ6ZnVuY3Rpb24odCl7dmFyIGU9dCxyPTI1NSZlLndvcmRzW2Uuc2lnQnl0ZXMtMT4+PjJdO2Uuc2lnQnl0ZXMtPXJ9fSxLcD1mdW5jdGlvbih0KXtzKHIsdCk7dmFyIGU9aChyKTtmdW5jdGlvbiByKHQsaSxhKXt2YXIgbztyZXR1cm4gbih0aGlzLHIpLChvPWUuY2FsbCh0aGlzLHQsaSxPYmplY3QuYXNzaWduKHttb2RlOkhwLHBhZGRpbmc6WXB9LGEpKSkuYmxvY2tTaXplPTQsb31yZXR1cm4gYShyLFt7a2V5OiJyZXNldCIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdDt2KHUoci5wcm90b3R5cGUpLCJyZXNldCIsdGhpcykuY2FsbCh0aGlzKTt2YXIgZT10aGlzLmNmZyxuPWUuaXYsaT1lLm1vZGU7dGhpcy5feGZvcm1Nb2RlPT09dGhpcy5jb25zdHJ1Y3Rvci5fRU5DX1hGT1JNX01PREU/dD1pLmNyZWF0ZUVuY3J5cHRvcjoodD1pLmNyZWF0ZURlY3J5cHRvcix0aGlzLl9taW5CdWZmZXJTaXplPTEpLHRoaXMuX21vZGU9dC5jYWxsKGksdGhpcyxuJiZuLndvcmRzKSx0aGlzLl9tb2RlLl9fY3JlYXRvcj10fX0se2tleToiX2RvUHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbih0LGUpe3RoaXMuX21vZGUucHJvY2Vzc0Jsb2NrKHQsZSl9fSx7a2V5OiJfZG9GaW5hbGl6ZSIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgdCxlPXRoaXMuY2ZnLnBhZGRpbmc7cmV0dXJuIHRoaXMuX3hmb3JtTW9kZT09PXRoaXMuY29uc3RydWN0b3IuX0VOQ19YRk9STV9NT0RFPyhlLnBhZCh0aGlzLl9kYXRhLHRoaXMuYmxvY2tTaXplKSx0PXRoaXMuX3Byb2Nlc3MoITApKToodD10aGlzLl9wcm9jZXNzKCEwKSxlLnVucGFkKHQpKSx0fX1dKSxyfShGcCksV3A9ZnVuY3Rpb24odCl7cyhyLHQpO3ZhciBlPWgocik7ZnVuY3Rpb24gcih0KXt2YXIgaTtyZXR1cm4gbih0aGlzLHIpLChpPWUuY2FsbCh0aGlzKSkubWl4SW4odCksaX1yZXR1cm4gYShyLFt7a2V5OiJ0b1N0cmluZyIsdmFsdWU6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fHRoaXMuZm9ybWF0dGVyKS5zdHJpbmdpZnkodGhpcyl9fV0pLHJ9KEFwKSxHcD17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQuY2lwaGVydGV4dCxyPXQuc2FsdDtyZXR1cm4ocj9TcC5jcmVhdGUoWzEzOTg4OTM2ODQsMTcwMTA3NjgzMV0pLmNvbmNhdChyKS5jb25jYXQoZSk6ZSkudG9TdHJpbmcoQ3ApfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZSxyPUNwLnBhcnNlKHQpLG49ci53b3JkcztyZXR1cm4gMTM5ODg5MzY4ND09PW5bMF0mJjE3MDEwNzY4MzE9PT1uWzFdJiYoZT1TcC5jcmVhdGUobi5zbGljZSgyLDQpKSxuLnNwbGljZSgwLDQpLHIuc2lnQnl0ZXMtPTE2KSxXcC5jcmVhdGUoe2NpcGhlcnRleHQ6cixzYWx0OmV9KX19LHFwPWZ1bmN0aW9uKHQpe3Mocix0KTt2YXIgZT1oKHIpO2Z1bmN0aW9uIHIoKXtyZXR1cm4gbih0aGlzLHIpLGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfXJldHVybiBhKHIsbnVsbCxbe2tleToiZW5jcnlwdCIsdmFsdWU6ZnVuY3Rpb24odCxlLHIsbil7dmFyIGk9T2JqZWN0LmFzc2lnbihuZXcgQXAsdGhpcy5jZmcsbiksYT10LmNyZWF0ZUVuY3J5cHRvcihyLGkpLG89YS5maW5hbGl6ZShlKSxzPWEuY2ZnO3JldHVybiBXcC5jcmVhdGUoe2NpcGhlcnRleHQ6byxrZXk6cixpdjpzLml2LGFsZ29yaXRobTp0LG1vZGU6cy5tb2RlLHBhZGRpbmc6cy5wYWRkaW5nLGJsb2NrU2l6ZTphLmJsb2NrU2l6ZSxmb3JtYXR0ZXI6aS5mb3JtYXR9KX19LHtrZXk6ImRlY3J5cHQiLHZhbHVlOmZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPWUsYT1PYmplY3QuYXNzaWduKG5ldyBBcCx0aGlzLmNmZyxuKTtyZXR1cm4gaT10aGlzLl9wYXJzZShpLGEuZm9ybWF0KSx0LmNyZWF0ZURlY3J5cHRvcihyLGEpLmZpbmFsaXplKGkuY2lwaGVydGV4dCl9fSx7a2V5OiJfcGFyc2UiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P2UucGFyc2UodCx0aGlzKTp0fX1dKSxyfShBcCk7cXAuY2ZnPU9iamVjdC5hc3NpZ24obmV3IEFwLHtmb3JtYXQ6R3B9KTt2YXIgWHA9e2V4ZWN1dGU6ZnVuY3Rpb24odCxlLHIsbil7dmFyIGk9bjtpfHwoaT1TcC5yYW5kb20oOCkpO3ZhciBhPUxwLmNyZWF0ZSh7a2V5U2l6ZTplK3J9KS5jb21wdXRlKHQsaSksbz1TcC5jcmVhdGUoYS53b3Jkcy5zbGljZShlKSw0KnIpO3JldHVybiBhLnNpZ0J5dGVzPTQqZSxXcC5jcmVhdGUoe2tleTphLGl2Om8sc2FsdDppfSl9fSwkcD1mdW5jdGlvbih0KXtzKHIsdCk7dmFyIGU9aChyKTtmdW5jdGlvbiByKCl7cmV0dXJuIG4odGhpcyxyKSxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gYShyLG51bGwsW3trZXk6ImVuY3J5cHQiLHZhbHVlOmZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBpPU9iamVjdC5hc3NpZ24obmV3IEFwLHRoaXMuY2ZnLG4pLGE9aS5rZGYuZXhlY3V0ZShyLHQua2V5U2l6ZSx0Lml2U2l6ZSk7aS5pdj1hLml2O3ZhciBvPXFwLmVuY3J5cHQuY2FsbCh0aGlzLHQsZSxhLmtleSxpKTtyZXR1cm4gby5taXhJbihhKSxvfX0se2tleToiZGVjcnlwdCIsdmFsdWU6ZnVuY3Rpb24odCxlLHIsbil7dmFyIGk9ZSxhPU9iamVjdC5hc3NpZ24obmV3IEFwLHRoaXMuY2ZnLG4pO2k9dGhpcy5fcGFyc2UoaSxhLmZvcm1hdCk7dmFyIG89YS5rZGYuZXhlY3V0ZShyLHQua2V5U2l6ZSx0Lml2U2l6ZSxpLnNhbHQpO3JldHVybiBhLml2PW8uaXYscXAuZGVjcnlwdC5jYWxsKHRoaXMsdCxpLG8ua2V5LGEpfX1dKSxyfShxcCk7JHAuY2ZnPU9iamVjdC5hc3NpZ24ocXAuY2ZnLHtrZGY6WHB9KTtmb3IodmFyIFFwPVtdLFpwPVtdLEpwPVtdLHR2PVtdLGV2PVtdLHJ2PVtdLG52PVtdLGl2PVtdLGF2PVtdLG92PVtdLHN2PVtdLHV2PTA7dXY8MjU2O3V2Kz0xKXN2W3V2XT11djwxMjg/dXY8PDE6dXY8PDFeMjgzO2Zvcih2YXIgY3Y9MCxmdj0wLGx2PTA7bHY8MjU2O2x2Kz0xKXt2YXIgZHY9ZnZeZnY8PDFeZnY8PDJeZnY8PDNeZnY8PDQ7ZHY9ZHY+Pj44XjI1NSZkdl45OSxRcFtjdl09ZHYsWnBbZHZdPWN2O3ZhciBodj1zdltjdl0scHY9c3ZbaHZdLHZ2PXN2W3B2XSx5dj0yNTcqc3ZbZHZdXjE2ODQzMDA4KmR2O0pwW2N2XT15djw8MjR8eXY+Pj44LHR2W2N2XT15djw8MTZ8eXY+Pj4xNixldltjdl09eXY8PDh8eXY+Pj4yNCxydltjdl09eXYseXY9MTY4NDMwMDkqdnZeNjU1MzcqcHZeMjU3Kmh2XjE2ODQzMDA4KmN2LG52W2R2XT15djw8MjR8eXY+Pj44LGl2W2R2XT15djw8MTZ8eXY+Pj4xNixhdltkdl09eXY8PDh8eXY+Pj4yNCxvdltkdl09eXYsY3Y/KGN2PWh2XnN2W3N2W3N2W3Z2Xmh2XV1dLGZ2Xj1zdltzdltmdl1dKTpjdj1mdj0xfXZhciBndj1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0sbXY9ZnVuY3Rpb24odCl7cyhyLHQpO3ZhciBlPWgocik7ZnVuY3Rpb24gcigpe3JldHVybiBuKHRoaXMsciksZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIGEocixbe2tleToiX2RvUmVzZXQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIHQ7aWYoIXRoaXMuX25Sb3VuZHN8fHRoaXMuX2tleVByaW9yUmVzZXQhPT10aGlzLl9rZXkpe3RoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5O3ZhciBlPXRoaXMuX2tleVByaW9yUmVzZXQscj1lLndvcmRzLG49ZS5zaWdCeXRlcy80O3RoaXMuX25Sb3VuZHM9bis2O3ZhciBpPTQqKHRoaXMuX25Sb3VuZHMrMSk7dGhpcy5fa2V5U2NoZWR1bGU9W107Zm9yKHZhciBhPXRoaXMuX2tleVNjaGVkdWxlLG89MDtvPGk7bys9MSlvPG4/YVtvXT1yW29dOih0PWFbby0xXSxvJW4/bj42JiZvJW49PTQmJih0PVFwW3Q+Pj4yNF08PDI0fFFwW3Q+Pj4xNiYyNTVdPDwxNnxRcFt0Pj4+OCYyNTVdPDw4fFFwWzI1NSZ0XSk6KHQ9UXBbKHQ9dDw8OHx0Pj4+MjQpPj4+MjRdPDwyNHxRcFt0Pj4+MTYmMjU1XTw8MTZ8UXBbdD4+PjgmMjU1XTw8OHxRcFsyNTUmdF0sdF49Z3Zbby9ufDBdPDwyNCksYVtvXT1hW28tbl1edCk7dGhpcy5faW52S2V5U2NoZWR1bGU9W107Zm9yKHZhciBzPXRoaXMuX2ludktleVNjaGVkdWxlLHU9MDt1PGk7dSs9MSl7dmFyIGM9aS11O3Q9dSU0P2FbY106YVtjLTRdLHNbdV09dTw0fHxjPD00P3Q6bnZbUXBbdD4+PjI0XV1eaXZbUXBbdD4+PjE2JjI1NV1dXmF2W1FwW3Q+Pj44JjI1NV1dXm92W1FwWzI1NSZ0XV19fX19LHtrZXk6ImVuY3J5cHRCbG9jayIsdmFsdWU6ZnVuY3Rpb24odCxlKXt0aGlzLl9kb0NyeXB0QmxvY2sodCxlLHRoaXMuX2tleVNjaGVkdWxlLEpwLHR2LGV2LHJ2LFFwKX19LHtrZXk6ImRlY3J5cHRCbG9jayIsdmFsdWU6ZnVuY3Rpb24odCxlKXt2YXIgcj10LG49cltlKzFdO3JbZSsxXT1yW2UrM10scltlKzNdPW4sdGhpcy5fZG9DcnlwdEJsb2NrKHIsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxudixpdixhdixvdixacCksbj1yW2UrMV0scltlKzFdPXJbZSszXSxyW2UrM109bn19LHtrZXk6Il9kb0NyeXB0QmxvY2siLHZhbHVlOmZ1bmN0aW9uKHQsZSxyLG4saSxhLG8scyl7Zm9yKHZhciB1PXQsYz10aGlzLl9uUm91bmRzLGY9dVtlXV5yWzBdLGw9dVtlKzFdXnJbMV0sZD11W2UrMl1eclsyXSxoPXVbZSszXV5yWzNdLHA9NCx2PTE7djxjO3YrPTEpe3ZhciB5PW5bZj4+PjI0XV5pW2w+Pj4xNiYyNTVdXmFbZD4+PjgmMjU1XV5vWzI1NSZoXV5yW3BdO3ArPTE7dmFyIGc9bltsPj4+MjRdXmlbZD4+PjE2JjI1NV1eYVtoPj4+OCYyNTVdXm9bMjU1JmZdXnJbcF07cCs9MTt2YXIgbT1uW2Q+Pj4yNF1eaVtoPj4+MTYmMjU1XV5hW2Y+Pj44JjI1NV1eb1syNTUmbF1ecltwXTtwKz0xO3ZhciBiPW5baD4+PjI0XV5pW2Y+Pj4xNiYyNTVdXmFbbD4+PjgmMjU1XV5vWzI1NSZkXV5yW3BdO3ArPTEsZj15LGw9ZyxkPW0saD1ifXZhciB3PShzW2Y+Pj4yNF08PDI0fHNbbD4+PjE2JjI1NV08PDE2fHNbZD4+PjgmMjU1XTw8OHxzWzI1NSZoXSlecltwXTtwKz0xO3ZhciBrPShzW2w+Pj4yNF08PDI0fHNbZD4+PjE2JjI1NV08PDE2fHNbaD4+PjgmMjU1XTw8OHxzWzI1NSZmXSlecltwXTtwKz0xO3ZhciB4PShzW2Q+Pj4yNF08PDI0fHNbaD4+PjE2JjI1NV08PDE2fHNbZj4+PjgmMjU1XTw8OHxzWzI1NSZsXSlecltwXTtwKz0xO3ZhciBBPShzW2g+Pj4yNF08PDI0fHNbZj4+PjE2JjI1NV08PDE2fHNbbD4+PjgmMjU1XTw8OHxzWzI1NSZkXSlecltwXTtwKz0xLHVbZV09dyx1W2UrMV09ayx1W2UrMl09eCx1W2UrM109QX19XSkscn0oS3ApO212LmtleVNpemU9ODt2YXIgYnY9S3AuX2NyZWF0ZUhlbHBlcihtdiksd3Y9ZnVuY3Rpb24odCl7cyhyLHQpO3ZhciBlPWgocik7ZnVuY3Rpb24gcigpe3JldHVybiBuKHRoaXMsciksZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIGEocil9KE5wKTt3di5FbmNyeXB0b3I9ZnVuY3Rpb24odCl7cyhyLHQpO3ZhciBlPWgocik7ZnVuY3Rpb24gcigpe3JldHVybiBuKHRoaXMsciksZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9cmV0dXJuIGEocixbe2tleToicHJvY2Vzc0Jsb2NrIix2YWx1ZTpmdW5jdGlvbih0LGUpe3ZhciByPXQsbj10aGlzLl9jaXBoZXIsaT1uLmJsb2NrU2l6ZSxhPXRoaXMuX2l2LG89dGhpcy5fY291bnRlcjthJiYodGhpcy5fY291bnRlcj1hLnNsaWNlKDApLG89dGhpcy5fY291bnRlcix0aGlzLl9pdj12b2lkIDApO3ZhciBzPW8uc2xpY2UoMCk7bi5lbmNyeXB0QmxvY2socywwKSxvW2ktMV09b1tpLTFdKzF8MDtmb3IodmFyIHU9MDt1PGk7dSs9MSlyW2UrdV1ePXNbdV19fV0pLHJ9KHd2KSx3di5EZWNyeXB0b3I9d3YuRW5jcnlwdG9yO3ZhciBrdj17cGFkOmZ1bmN0aW9uKCl7fSx1bnBhZDpmdW5jdGlvbigpe319LHh2PXtkZWNyeXB0V29yZEFycmF5OmZ1bmN0aW9uKHQsZSxyKXt2YXIgbj1fcC5wYXJzZShlKSxpPV9wLnBhcnNlKG9oKHIpKSxhPVNwLmNyZWF0ZShuZXcgVWludDhBcnJheSh0KSksbz1idi5kZWNyeXB0KFdwLmNyZWF0ZSh7Y2lwaGVydGV4dDphfSksbix7aXY6aSxtb2RlOnd2LHBhZGRpbmc6a3Z9KTtyZXR1cm4geHYud29yZEFycmF5VG9VaW50OEFycmF5KG8pfSx3b3JkQXJyYXlUb1VpbnQ4QXJyYXk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQuc2lnQnl0ZXMscj10LndvcmRzLG49bmV3IFVpbnQ4QXJyYXkoZSksaT0wLGE9MDtpIT09ZTspe3ZhciBvPXJbYSsrXTtpZihuW2krK109KDQyNzgxOTAwODAmbyk+Pj4yNCxpPT09ZSlicmVhaztpZihuW2krK109KDE2NzExNjgwJm8pPj4+MTYsaT09PWUpYnJlYWs7aWYobltpKytdPSg2NTI4MCZvKT4+PjgsaT09PWUpYnJlYWs7bltpKytdPTI1NSZvfXJldHVybiBufX0sQXY9ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KGUscixuLGkpe3ZhciBhPXRoaXM7Zyh0aGlzLHQpLHcodGhpcywiX3ZpZGVvU2FtcGxlcyIsW10pLHcodGhpcywiX2F1ZGlvU2FtcGxlcyIsW10pLHcodGhpcywiX2xhc3RSZW1haW5CdWZmZXIiLFtdKSx3KHRoaXMsIl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3MiLDApLHRoaXMudmlkZW9UcmFjaz1uZXcgVmksdGhpcy5hdWRpb1RyYWNrPW5ldyBIaSx0aGlzLm1ldGFkYXRhVHJhY2s9bnx8bmV3IFdpLHRoaXMubG9nPW5ldyBrcCgiTVA0RGVtdXhlciIsIWl8fCFpLm9wZW5Mb2d8fCFpLm9wZW5Mb2cpLGUmJmUuZm9yRWFjaCgoZnVuY3Rpb24odCl7dmFyIGU7KGU9YS5fdmlkZW9TYW1wbGVzKS5wdXNoLmFwcGx5KGUseCh0LmZyYW1lcykpfSkpLHImJnIuZm9yRWFjaCgoZnVuY3Rpb24odCl7dmFyIGU7KGU9YS5fYXVkaW9TYW1wbGVzKS5wdXNoLmFwcGx5KGUseCh0LmZyYW1lcykpfSkpfXJldHVybiBiKHQsW3trZXk6InBhcnNlU2FtcGxlcyIsdmFsdWU6ZnVuY3Rpb24odCl7aWYoIXQpdGhyb3cgbmV3IEVycm9yKCJtb292IGlzIHJlcXVpcmVkIik7aWYodGhpcy52aWRlb1RyYWNrLmNvZGVjfHx0aGlzLmF1ZGlvVHJhY2suY29kZWN8fChhcC5tb292VG9UcmFjayh0LHRoaXMudmlkZW9UcmFjayx0aGlzLmF1ZGlvVHJhY2spLHRoaXMudmlkZW9TZW5jPXRoaXMudmlkZW9UcmFjay52aWRlb1NlbmMsdGhpcy5hdWRpb1NlbmM9dGhpcy5hdWRpb1RyYWNrLmF1ZGlvU2VuYyksIXRoaXMuX2F1ZGlvU2FtcGxlcy5sZW5ndGgmJiF0aGlzLl92aWRlb1NhbXBsZXMubGVuZ3RoKXt2YXIgZT1hcC5tb292VG9TYW1wbGVzKHQpO2lmKCFlKXRocm93IG5ldyBFcnJvcigiY2Fubm90IHBhcnNlIHNhbXBsZXMgZnJvbSBtb292IGJveCIpO3RoaXMuX3ZpZGVvU2FtcGxlcz1lLnZpZGVvU2FtcGxlc3x8W10sdGhpcy5fYXVkaW9TYW1wbGVzPWUuYXVkaW9TYW1wbGVzfHxbXX19fSx7a2V5OiJkZW11eCIsdmFsdWU6ZnVuY3Rpb24odCxlLHIsbixpKXt0aGlzLnBhcnNlU2FtcGxlcyhpKTt2YXIgYSxvLHMsdT10aGlzLnZpZGVvVHJhY2ssYz10aGlzLmF1ZGlvVHJhY2s7aWYodS5zYW1wbGVzPVtdLGMuc2FtcGxlcz1bXSxyKXtmb3IodmFyIGYsbD0wLGQ9clswXSxoPXJbMV07ZDw9aDtkKyspe2lmKCEoYT10aGlzLl92aWRlb1NhbXBsZXNbZF0pKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGZvdW5kIHZpZGVvIGZyYW1lICMiLmNvbmNhdChkKSk7cz1hLm9mZnNldC1lLG89dC5zdWJhcnJheShzLHMrYS5zaXplKSwoZj1uZXcgWWkoYS5wdHN8fGEuZHRzLGEuZHRzKSkuZHVyYXRpb249YS5kdXJhdGlvbixmLmdvcElkPWEuZ29wSWQsYS5rZXlmcmFtZSYmZi5zZXRUb0tleWZyYW1lKCk7Zm9yKHZhciBwPTAsdj1vLmxlbmd0aC0xO3A8djspbD1paChvLHApLHArPTQsZi51bml0cy5wdXNoKG8uc3ViYXJyYXkocCxwK2wpKSxwKz1sO3Uuc2FtcGxlcy5wdXNoKGYpfXUuYmFzZU1lZGlhRGVjb2RlVGltZT11LnNhbXBsZXNbMF0uZHRzfWlmKG4pe2Zvcih2YXIgeT1uWzBdLGc9blsxXTt5PD1nO3krKyl7aWYoIShhPXRoaXMuX2F1ZGlvU2FtcGxlc1t5XSkpdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZm91bmQgdmlkZW8gZnJhbWUgIyIuY29uY2F0KHkpKTtzPWEub2Zmc2V0LWUsbz10LnN1YmFycmF5KHMscythLnNpemUpLGMuc2FtcGxlcy5wdXNoKG5ldyBLaShhLmR0cyxvLGEuZHVyYXRpb24pKX1jLmJhc2VNZWRpYURlY29kZVRpbWU9Yy5zYW1wbGVzWzBdLmR0c31yZXR1cm57dmlkZW9UcmFjazp1LGF1ZGlvVHJhY2s6YyxtZXRhZGF0YVRyYWNrOnRoaXMubWV0YWRhdGFUcmFja319fSx7a2V5OiJkZW11eFBhcnQiLHZhbHVlOmZ1bmN0aW9uKHQsZSxyLG4saSxhLG8pe2lmKHRoaXMucGFyc2VTYW1wbGVzKGkpLHRoaXMudmlkZW9UcmFjay51c2VFTUU9YSx0aGlzLmF1ZGlvVHJhY2sudXNlRU1FPWEsdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlciYmdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoPjAmJmU+dGhpcy5fbGFzdFJlbWFpbkJ1ZmZlclN0YXJ0UG9zJiZlPD10aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3MrdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoKWZvcih2YXIgcz0wO3M8MjA7KXRyeXt2YXIgdT10aGlzLl9sYXN0UmVtYWluQnVmZmVyLnN1YmFycmF5KDAsZS10aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3MpLGM9bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoK3UuYnl0ZUxlbmd0aCk7Yy5zZXQodSwwKSxjLnNldChuZXcgVWludDhBcnJheSh0KSx1LmJ5dGVMZW5ndGgpLHQ9YyxlLT11LmJ5dGVMZW5ndGgsdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlcj1udWxsLHRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcz0wO2JyZWFrfWNhdGNoKFQpe2lmKCEoczwyMCkpdGhyb3cgbmV3IEVycm9yKCJuZXcgVWludDhBcnJheSBlcnJvcjosIitULmVycm9yTWVzc2FnZSk7cysrfXZhciBmLGwsZCxoPXRoaXMudmlkZW9UcmFjayxwPXRoaXMuYXVkaW9UcmFjaztoLnNhbXBsZXM9W10scC5zYW1wbGVzPVtdLGgudmlkZW9TZW5jPW51bGwscC5hdWRpb1NlbmM9bnVsbDt2YXIgdj0wLHk9MDtpZih0aGlzLl92aWRlb1NhbXBsZXMubGVuZ3RoPjAmJnIubGVuZ3RoPjApe2Zvcih2YXIgZyxtPXQuYnl0ZUxlbmd0aCtlLGI9clswXTtiPD1yWzFdO2IrKyl7aWYoIShmPXRoaXMuX3ZpZGVvU2FtcGxlc1tiXSkpdGhyb3cgbmV3IEVycm9yKCJjYW5ub3QgZm91bmQgdmlkZW8gZnJhbWUgIyIuY29uY2F0KGIpKTtmLm9mZnNldD49ZSYmZi5vZmZzZXQrZi5zaXplPD1tJiYodj0oZD1mLm9mZnNldC1lKStmLnNpemUsbD10LnN1YmFycmF5KGQsdiksKGc9bmV3IFlpKGYucHRzfHxmLmR0cyxmLmR0cykpLmR1cmF0aW9uPWYuZHVyYXRpb24sZy5nb3BJZD1mLmdvcElkLGcuc2FtcGxlT2Zmc2V0PWYuaW5kZXgsZi5rZXlmcmFtZSYmZy5zZXRUb0tleWZyYW1lKCksZy5kYXRhPWwsZy5zaXplPWYuc2l6ZSxoLnNhbXBsZXMucHVzaChnKSl9aC5zYW1wbGVzLmxlbmd0aD4wJiYoaC5nb3BJZD1oLnNhbXBsZXNbMF0uZ29wSWQsaC5iYXNlTWVkaWFEZWNvZGVUaW1lPWguc2FtcGxlc1swXS5kdHMsaC5zdGFydFB0cz1oLnNhbXBsZXNbMF0ucHRzL2gudGltZXNjYWxlLGguZW5kUHRzPWguc2FtcGxlc1toLnNhbXBsZXMubGVuZ3RoLTFdLnB0cy9oLnRpbWVzY2FsZSx0aGlzLnZpZGVvU2VuYyYmKGgudmlkZW9TZW5jPXRoaXMudmlkZW9TZW5jLnNsaWNlKGguc2FtcGxlc1swXS5zYW1wbGVPZmZzZXQsaC5zYW1wbGVzWzBdLnNhbXBsZU9mZnNldCtoLnNhbXBsZXMubGVuZ3RoKSxoLmtpZFZhbHVlPW8pKX1pZih0aGlzLl9hdWRpb1NhbXBsZXMubGVuZ3RoPjAmJm4ubGVuZ3RoPjApe2Zvcih2YXIgdz1uWzBdO3c8PW5bMV07dysrKXtpZighKGY9dGhpcy5fYXVkaW9TYW1wbGVzW3ddKSl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCBmb3VuZCB2aWRlbyBmcmFtZSAjIi5jb25jYXQodykpO2Yub2Zmc2V0Pj1lJiZmLm9mZnNldCtmLnNpemU8PXQuYnl0ZUxlbmd0aCtlJiYoeT0oZD1mLm9mZnNldC1lKStmLnNpemUsbD10LnN1YmFycmF5KGQseSkscC5zYW1wbGVzLnB1c2gobmV3IEtpKGYuZHRzLGwsZi5kdXJhdGlvbixmLmluZGV4KSkpfXAuc2FtcGxlcy5sZW5ndGg+MCYmKHAuZ29wSWQ9cC5zYW1wbGVzWzBdLmdvcElkfHxoLmdvcElkLHAuYmFzZU1lZGlhRGVjb2RlVGltZT1wLnNhbXBsZXNbMF0uZHRzLHAuc3RhcnRQdHM9cC5zYW1wbGVzWzBdLnB0cy9wLnRpbWVzY2FsZSxwLmVuZFB0cz1wLnNhbXBsZXNbcC5zYW1wbGVzLmxlbmd0aC0xXS5wdHMvcC50aW1lc2NhbGUsdGhpcy5hdWRpb1NlbmMmJihwLmF1ZGlvU2VuYz10aGlzLmF1ZGlvU2VuYy5zbGljZShwLnNhbXBsZXNbMF0uc2FtcGxlT2Zmc2V0LHAuc2FtcGxlc1swXS5zYW1wbGVPZmZzZXQrcC5zYW1wbGVzLmxlbmd0aCkscC5raWRWYWx1ZT1vKSl9dGhpcy5kZWNvZGVyRGF0YShoLHApO2Zvcih2YXIgaz0wLHg9MDt4PGguc2FtcGxlcy5sZW5ndGg7eCsrKWZvcih2YXIgQT0wLFM9aC5zYW1wbGVzW3hdLmRhdGEsXz1TLmxlbmd0aC0xO0E8Xzspaz1paChTLEEpLEErPTQsaC5zYW1wbGVzW3hdLnVuaXRzLnB1c2goUy5zdWJhcnJheShBLEEraykpLEErPWs7cmV0dXJuIHRoaXMuX2xhc3RSZW1haW5CdWZmZXI9dC5zdWJhcnJheShNYXRoLm1heCh2LHkpKSx0aGlzLl9sYXN0UmVtYWluQnVmZmVyLmJ5dGVMZW5ndGg+MD90aGlzLl9sYXN0UmVtYWluQnVmZmVyU3RhcnRQb3M9ZSt0LmJ5dGVMZW5ndGgtdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlci5ieXRlTGVuZ3RoOnRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcz0wLHt2aWRlb1RyYWNrOmgsYXVkaW9UcmFjazpwLG1ldGFkYXRhVHJhY2s6dGhpcy5tZXRhZGF0YVRyYWNrfX19LHtrZXk6InJlc2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuX3ZpZGVvU2FtcGxlcz1bXSx0aGlzLl9hdWRpb1NhbXBsZXM9W10sdGhpcy5fbGFzdFJlbWFpbkJ1ZmZlcj1udWxsLHRoaXMuX2xhc3RSZW1haW5CdWZmZXJTdGFydFBvcz0wLHRoaXMudmlkZW9UcmFjay5yZXNldCgpLHRoaXMuYXVkaW9UcmFjay5yZXNldCgpLHRoaXMubWV0YWRhdGFUcmFjay5yZXNldCgpfX0se2tleToiZGVjb2RlckRhdGEiLHZhbHVlOmZ1bmN0aW9uKHQsZSl7aWYoIXQudXNlRU1FJiYhZS51c2VFTUUpe2lmKHQudmlkZW9TZW5jJiYxPT09dC5pZCl7dmFyIHI9dC5raWRWYWx1ZSxuPXQudmlkZW9TZW5jO3Quc2FtcGxlcy5mb3JFYWNoKChmdW5jdGlvbihlLGkpe3ZhciBhPW5baV0sbz1lLmRhdGEscz1bXSx1PVtdLGM9YS5Jbml0aWFsaXphdGlvblZlY3RvcjtpZihhLnN1YnNhbXBsZXMmJmEuc3Vic2FtcGxlcy5sZW5ndGgpYS5zdWJzYW1wbGVzLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZhciBlPXQuQnl0ZXNPZkNsZWFyRGF0YSt0LkJ5dGVzT2ZQcm90ZWN0ZWREYXRhLHI9by5zbGljZSgwLGUpO3MucHVzaChyLnNsaWNlKDAsdC5CeXRlc09mQ2xlYXJEYXRhKSksdS5wdXNoKHIuc2xpY2UodC5CeXRlc09mQ2xlYXJEYXRhKSksbz1vLnNsaWNlKGUpfSkpO2Vsc2V7dmFyIGY9ZS5zaXplO3MucHVzaChvLnNsaWNlKDAsMCkpLHUucHVzaChvLnNsaWNlKDAsZikpLG89by5zbGljZShmKX12YXIgbD1uZXcgbXA7bC53cml0ZS5hcHBseShsLHUpO3ZhciBkPXh2LmRlY3J5cHRXb3JkQXJyYXkobC5idWZmZXIscixjKSxoPW5ldyBtcDtzLmZvckVhY2goKGZ1bmN0aW9uKHQsZSl7dmFyIHI9dVtlXS5sZW5ndGgsbj1kLnNsaWNlKDAscik7aC53cml0ZSh0KSxoLndyaXRlKG4pLGQ9ZC5zbGljZShyKX0pKSx0LnNhbXBsZXNbaV0uZGF0YT1oLmJ1ZmZlcn0pKX1pZihlLmF1ZGlvU2VuYyYmMj09PWUuaWQpe3ZhciBpPWUua2lkVmFsdWUsYT1lLmF1ZGlvU2VuYztlLnNhbXBsZXMuZm9yRWFjaCgoZnVuY3Rpb24odCxyKXt2YXIgbj1hW3JdLG89eHYuZGVjcnlwdFdvcmRBcnJheSh0LmRhdGEsaSxuLkluaXRpYWxpemF0aW9uVmVjdG9yKTtlLnNhbXBsZXNbcl0uZGF0YT1vfSkpfX19fV0sW3trZXk6InByb2JlIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gYXAucHJvYmUodCl9fV0pLHR9KCksU3Y9e2ZpbmRCb3g6ZnVuY3Rpb24odCxlKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06W107aWYodC50eXBlIT09ZSl7aWYodCYmdC5zdWJCb3gpe3ZhciBuPXQuc3ViQm94LmZpbHRlcigoZnVuY3Rpb24odCl7cmV0dXJuIHQudHlwZT09PWV9KSk7bi5sZW5ndGg/bi5mb3JFYWNoKChmdW5jdGlvbih0KXtyZXR1cm4gci5wdXNoKHQpfSkpOnQuc3ViQm94LmZvckVhY2goKGZ1bmN0aW9uKHQpe3JldHVybiBTdi5maW5kQm94KHQsZSxyKX0pKX19ZWxzZSByLnB1c2godCk7cmV0dXJuKHI9W10uY29uY2F0KHIpKS5sZW5ndGg+MT9yOnJbMF19LHBhZFN0YXJ0OmZ1bmN0aW9uKHQsZSxyKXtmb3IodmFyIG49U3RyaW5nKHIpLGk9ZT4+MCxhPU1hdGguY2VpbChpL24ubGVuZ3RoKSxvPVtdLHM9U3RyaW5nKHQpO2EtLTspby5wdXNoKG4pO3JldHVybiBvLmpvaW4oIiIpLnN1YnN0cmluZygwLGktcy5sZW5ndGgpK3N9LHRvSGV4OmZ1bmN0aW9uKCl7Zm9yKHZhciB0PVtdLGU9YXJndW1lbnRzLmxlbmd0aCxyPW5ldyBBcnJheShlKSxuPTA7bjxlO24rKylyW25dPWFyZ3VtZW50c1tuXTtyZXR1cm4gci5mb3JFYWNoKChmdW5jdGlvbihlKXt0LnB1c2goU3YucGFkU3RhcnQoTnVtYmVyKGUpLnRvU3RyaW5nKDE2KSwyLDApKX0pKSx0fSxzdW06ZnVuY3Rpb24oKXtmb3IodmFyIHQ9MCxlPWFyZ3VtZW50cy5sZW5ndGgscj1uZXcgQXJyYXkoZSksbj0wO248ZTtuKyspcltuXT1hcmd1bWVudHNbbl07cmV0dXJuIHIuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dCs9ZX0pKSx0fSxTdHJpbmdUb0FycmF5QnVmZmVyOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1uZXcgQXJyYXlCdWZmZXIodC5sZW5ndGgpLHI9bmV3IFVpbnQ4QXJyYXkoZSksbj0wO248dC5sZW5ndGg7bisrKXJbbl09dC5jaGFyQ29kZUF0KG4pO3JldHVybiBlfSxmcm9tSGV4OmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1uZXcgVWludDhBcnJheSh0Lmxlbmd0aC8yKSxyPTA7cjx0Lmxlbmd0aDtyKz0yKWVbci8yXT13aW5kb3cucGFyc2VJbnQodC5zdWJzdHIociwyKSwxNik7cmV0dXJuIGV9LGZyb21DaGFyQ29kZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9IiIscj0wO3I8dC5sZW5ndGg7cis9MTZlMyl7dmFyIG49dC5zdWJhcnJheShyLHIrMTZlMyk7ZSs9U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLG4pfXJldHVybiBlfSxBcnJheUJ1ZmZlclRvU3RyaW5nOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT0iIixyPW5ldyBVaW50OEFycmF5KHQpLG49MDtuPHIubGVuZ3RoO24rKyllKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHJbbl0pO3JldHVybiBlfSxCYXNlNjRUb0hleDpmdW5jdGlvbih0KXtmb3IodmFyIGU9d2luZG93LmF0b2IodC5yZXBsYWNlKC8tL2csIisiKS5yZXBsYWNlKC9fL2csIi8iKSkscj0iIixuPTA7bjxlLmxlbmd0aDtuKyspcis9KCIwIitlLmNoYXJDb2RlQXQobikudG9TdHJpbmcoMTYpKS5zdWJzdHIoLTIpO3JldHVybiByfSx0b0Jhc2U2NDpmdW5jdGlvbih0LGUpe3ZhciByPVN2LmZyb21DaGFyQ29kZSh0KTtlPXZvaWQgMD09PWV8fGU7dmFyIG49d2luZG93LmJ0b2EocikucmVwbGFjZSgvXCsvZywiLSIpLnJlcGxhY2UoL1wvL2csIl8iKTtyZXR1cm4gZT9uOm4ucmVwbGFjZSgvPSokLywiIil9LHRvVVRGODpmdW5jdGlvbih0KXtmb3IodmFyIGU9ZW5jb2RlVVJJQ29tcG9uZW50KHQpLHI9dW5lc2NhcGUoZSksbj1uZXcgVWludDhBcnJheShyLmxlbmd0aCksaT0wO2k8ci5sZW5ndGg7KytpKW5baV09ci5jaGFyQ29kZUF0KGkpO3JldHVybiBuLmJ1ZmZlcn0sYnVmZmVyVG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKCIwIitOdW1iZXIodCkudG9TdHJpbmcoMTYpKS5zbGljZSgtMikudG9VcHBlckNhc2UoKX0sc3RyVG9CdWY6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPVtdLHI9MDtyPHQubGVuZ3RoO3IrPTIpZS5wdXNoKHBhcnNlSW50KHRbcl0rdFtyKzFdLDE2KSk7cmV0dXJuIG5ldyBVaW50OEFycmF5KGUpfSxmb3JtYXRJVjpmdW5jdGlvbih0KXt2YXIgZT0iIjtpZih0LmZvckVhY2goKGZ1bmN0aW9uKHQpe2UrPVN2LmJ1ZmZlclRvU3RyaW5nKHQpfSkpLGUubGVuZ3RoPD0zMilmb3IodmFyIHI9MzItZS5sZW5ndGgsbj0wO248cjtuKyspZSs9IjAiO3JldHVybiBlfSxzdHIyaGV4OmZ1bmN0aW9uKHQpe2lmKCIiPT09dClyZXR1cm4iIjtmb3IodmFyIGU9W10scj0wO3I8dC5sZW5ndGg7cisrKWUucHVzaCh0LmNoYXJDb2RlQXQocikpO3JldHVybiBlfSxwYXJzZTpmdW5jdGlvbih0KXtpZighQXJyYXkuaXNBcnJheSh0KSl7Zm9yKHZhciBlPVtdLHI9IiIsbj0wO248dC5sZW5ndGg7bisrKW4lMiYmKHI9dFtuLTFdK3Rbbl0sZS5wdXNoKHBhcnNlSW50KHIsMTYpKSxyPSIiKTtyZXR1cm4gZX1yZXR1cm4gdC5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiBwYXJzZUludCh0LDE2KX0pKX0sZ2VuZXJhdGVVbmlxdWVLZXk6ZnVuY3Rpb24odCl7dmFyIGU9dC52aWQ7dC5zdGFydCx0LmVuZDt2YXIgcj10Lm1lZGlhVHlwZSxuPXQuZGVmaW5pdGlvbjtyZXR1cm4gdC5wcmVsb2FkVGltZSxyPXJ8fCJ2aWRlbyIsbj1ufHwiMCIsZT8iIi5jb25jYXQoZSwiIyIpLmNvbmNhdChyLCIjIikuY29uY2F0KG4sIiNtcDQiKTpudWxsfSx2YWxpZGF0ZUZyYWdtZW50OmZ1bmN0aW9uKHQpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpbXTtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe3RyeXtpZigyPT09ZS5sZW5ndGgpe3ZhciByPWVbMV0tZVswXSsxO2lmKCEodC5ieXRlTGVuZ3RoPT09cikpcmV0dXJufX1jYXRjaChuKXtyZXR1cm4gY29uc29sZS5lcnJvcihuKSwhMX1yZXR1cm4hMH1yZXR1cm4hMX0sdHlwZU9mOmZ1bmN0aW9uKHQpe3JldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCkubWF0Y2goLyhbXlxzLipdKykoPz1dJCkvZylbMF19LGdldEJ1ZmZlclNwbGl0czpmdW5jdGlvbih0LGUpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTo1ZTUsbj1lLXQ7aWYobi1yPHIvMnx8IWUpcmV0dXJuW1t0LGVdXTtmb3IodmFyIGk9W107dDxlOyl7dmFyIGE9dCtyOyhhPmV8fGUtYTxyLzIpJiYoYT1lKSxpLnB1c2goW3QsYV0pLHQ9YSsxfXJldHVybiBpfSxub3dUaW1lOmZ1bmN0aW9uKCl7dHJ5e3JldHVybiBwYXJzZUludChwZXJmb3JtYW5jZS5ub3coKSwxMCl9Y2F0Y2godCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCl9fSxleHRVcmw6ZnVuY3Rpb24odCxlKXt0cnl7dmFyIHI9dC5pbmRleE9mKCI/Iik7cmV0dXJuIHI8MD9PYmplY3Qua2V5cyhlKS5tYXAoKGZ1bmN0aW9uKHIsbil7dCs9MD09PW4/Ij8iLmNvbmNhdChyLCI9IikuY29uY2F0KGVbcl0pOiImIi5jb25jYXQociwiPSIpLmNvbmNhdChlW3JdKX0pKTpPYmplY3Qua2V5cyhlKS5tYXAoKGZ1bmN0aW9uKG4saSl7cj09PXQubGVuZ3RoLTE/dCs9IiIuY29uY2F0KG4sIj0iKS5jb25jYXQoZVtuXSk6dCs9IiYiLmNvbmNhdChuLCI9IikuY29uY2F0KGVbbl0pfSkpLHR9Y2F0Y2gobil7cmV0dXJuIHR9fSxnZXRGaWxlU2l6ZTpmdW5jdGlvbih0LGUpe3RyeXtyZXR1cm4gdCYmZT9wYXJzZUludChlKnQvOCwxMCk6MH1jYXRjaChyKXtyZXR1cm4gMH19LGhhc2hWYWw6ZnVuY3Rpb24odCl7dmFyIGUscj0wO2lmKDA9PT10Lmxlbmd0aClyZXR1cm4gcjtmb3IoZT0wO2U8dC5sZW5ndGg7ZSsrKXI9KHI8PDUpLXIrdC5jaGFyQ29kZUF0KGUpLHJ8PTA7cmV0dXJuIHJ9fTtTdi5nZXRGaWxlU2l6ZT1mdW5jdGlvbih0LGUpe3RyeXtyZXR1cm4gdCYmZT9wYXJzZUludChlKnQvOCwxMCk6MH1jYXRjaChyKXtyZXR1cm4gMH19LFN2LmNvbmNhdERhdGE9ZnVuY3Rpb24odCxlKXt2YXIgcj1bXSxuPTA7dCYmci5wdXNoKHQpLGUmJnIucHVzaChlKSxyLmV2ZXJ5KChmdW5jdGlvbih0KXtyZXR1cm4gdCYmKG4rPXQuYnl0ZUxlbmd0aCksITB9KSk7dmFyIGk9bmV3IFVpbnQ4QXJyYXkobiksYT0wO3JldHVybiByLmV2ZXJ5KChmdW5jdGlvbih0KXtyZXR1cm4gdCYmKGkuc2V0KHQsYSksYSs9dC5ieXRlTGVuZ3RoKSwhMH0pKSxpfSxTdi5nZXRGcmFnUmFuZ2U9ZnVuY3Rpb24odCxlLHIpe3ZhciBuPXQ8ZS5sZW5ndGg/ZVt0XTpudWxsLGk9dDxyLmxlbmd0aD9yW3RdOm51bGwsYT0wLG89MDtyZXR1cm4gdD09PWUubGVuZ3RoLTEmJihhPS0xKSx0PT09ci5sZW5ndGgtMSYmKG89LTEpLFtNYXRoLm1pbigobnVsbD09bj92b2lkIDA6bi5yYW5nZVswXSl8fDEvMCwobnVsbD09aT92b2lkIDA6aS5yYW5nZVswXSl8fDEvMCksTWF0aC5tYXgoKG51bGw9PW4/dm9pZCAwOm4ucmFuZ2VbMV0pK2F8fDAsKG51bGw9PWk/dm9pZCAwOmkucmFuZ2VbMV0pK298fDApXX0sb25tZXNzYWdlPWZ1bmN0aW9uKHQpe3ZhciByPXQuZGF0YTtzd2l0Y2goci5tZXRob2Qpe2Nhc2UiaW5pdCI6dGhpcy5jb2RlY1R5cGU9ci5hcmdzLmNvZGVjVHlwZSx0aGlzLm9wZW5sb2c9ci5hcmdzLm9wZW5Mb2csdGhpcy5NUDREZW11eGVyPW51bGwsdGhpcy5GTVA0UmVtdXhlcj1udWxsLHRoaXMuX25lZWRJbml0U2VnbWVudD0hMCx0aGlzLnN1cHBvcnRIZXZjPXIuYXJncy5zdXBwb3J0SGV2YzticmVhaztjYXNlInRyYW5zbXV4Ijp2YXIgbj10LmRhdGEuYXJncyxpPW5ldyBVaW50OEFycmF5KHQuZGF0YS5idWZmZXIpO3RoaXMuTVA0RGVtdXhlcnx8KHRoaXMuTVA0RGVtdXhlcj1uZXcgQXYobnVsbCxudWxsLG51bGwse29wZW5sb2c6dGhpcy5vcGVubG9nfSkpO3ZhciBhLG89dGhpcy5NUDREZW11eGVyLmRlbXV4UGFydChpLG4uc3RhcnQsbi52aWRlb0lkeCxuLmF1ZGlvSWR4LG4ubW9vdixuLnVzZUVNRSxuLmtpZFZhbHVlKTtpZih0aGlzLkZNUDRSZW11eGVyfHwiaDI2NSI9PT10aGlzLmNvZGVjVHlwZSYmIXRoaXMuc3VwcG9ydEhldmN8fCh0aGlzLkZNUDRSZW11eGVyPW5ldyB4cCh0aGlzLk1QNERlbXV4ZXIudmlkZW9UcmFjayx0aGlzLk1QNERlbXV4ZXIuYXVkaW9UcmFjayx7b3BlbkxvZzp0aGlzLm9wZW5sb2d9KSksdGhpcy5GTVA0UmVtdXhlcil7dmFyIHM9dGhpcy5GTVA0UmVtdXhlci5yZW11eCh0aGlzLl9uZWVkSW5pdFNlZ21lbnQse2luaXRNZXJnZTohMH0pO3MuaW5pdFNlZ21lbnQmJih0aGlzLl9uZWVkSW5pdFNlZ21lbnQ9ITEpLGE9e2J1ZmZlcjpTdi5jb25jYXREYXRhKHMuYXVkaW9TZWdtZW50LHMudmlkZW9TZWdtZW50KSxyYW5nZTpuLmNvbnRleHQucmFuZ2Usc3RhdGU6bi5jb250ZXh0LnN0YXRlLGNvbnRleHQ6e3JhbmdlOm4uY29udGV4dC5yYW5nZSxmcmFnSW5kZXg6bi5jb250ZXh0LmZyYWdJbmRleCxzdGFydFB0czpNYXRoLm1pbihvLnZpZGVvVHJhY2suc3RhcnRQdHMsby5hdWRpb1RyYWNrLnN0YXJ0UHRzKSxlbmRQdHM6TWF0aC5tYXgoby52aWRlb1RyYWNrLmVuZFB0cyxvLmF1ZGlvVHJhY2suZW5kUHRzKX0saW5pdFNlZzpzLmluaXRTZWdtZW50fX10aGlzLnBvc3RNZXNzYWdlKHttZXRob2Q6InRyYW5zbXV4IixpZDp0LmRhdGEuaWQsYXJnczplKHt9LGEpfSk7YnJlYWs7Y2FzZSJyZXNldCI6dGhpcy5GTVA0UmVtdXhlciYmdGhpcy5GTVA0UmVtdXhlci5yZXNldCgpLHRoaXMuTVA0RGVtdXhlciYmdGhpcy5NUDREZW11eGVyLnJlc2V0KCksdGhpcy5GTVA0UmVtdXhlcj1udWxsLHRoaXMuTVA0RGVtdXhlcj1udWxsLHRoaXMuX25lZWRJbml0U2VnbWVudD0hMH19fSgpOwo=",blob$4="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs$4)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper$4(){var e=blob$4&&(window.URL||window.webkitURL).createObjectURL(blob$4);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+encodedJs$4,{type:"module"})}finally{!("undefined"!=typeof window&&navigator.userAgent.indexOf("Trident/")>0)&&e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var TransmuxerWorkerControl=function(e){_inherits$4(r,e);var t=_createSuper$5(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this)).openlog=e.openLog,n.codecType=e.codecType,n.supportHevc=e.supportHevc,n.worker=new WorkerWrapper$4,n.worker.onmessage=function(e){n.emit(e.data.method,e.data)},n.worker.postMessage({method:"init",id:e.id||0,args:{openlog:n.openlog,supportHevc:n.supportHevc,codecType:n.codecType}}),n}return _createClass$8(r,[{key:"transmux",value:function(e,t,r,n,i,a,o,s,l){var u=t.buffer;this.worker&&this.worker.postMessage({method:"transmux",id:e,buffer:u,args:{start:r,videoIdx:n,audioIdx:i,moov:a,useEME:o,kidValue:s,context:l}},[u])}},{key:"reset",value:function(){this.worker&&this.worker.postMessage({method:"reset"})}},{key:"destroy",value:function(){this.worker&&this.worker.terminate()}}]),r}(EventEmitter$1),MP4_EVENTS={ERROR:"error",META_READY:"metaReady",MOOV_READY:"moovReady",MOOV_REQ_PROGRESS:"moov_request_Progress",TASK_PROGRESS:"progress_event",REMOVE_URL:"remove_url",FRAGMENT:"fragment",UPDATEEME:"updateEME",CHANGE_URL:"chaneg_url"},MP4$1=function(t){_inherits$4(h,t);var r,n,i,a,o,s,l,u,c,d=_createSuper$5(h);function h(e,t,r,n){var i,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],o=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0;if(_classCallCheck$7(this,h),_defineProperty$7(_assertThisInitialized$4(i=d.call(this)),"onprogressDataArrive",function(){var e=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t,r,n){var a;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&t.byteLength>0&&((a=i.timeRange[n.index].range)&&n.range[1]>=a[1]&&!r&&(r=!0),i.log("[mp4.loadFragment onprogressDataArrive ] receive data, >>> index,",n.index,",range,",JSON.stringify(n.range),", dataLen,",t.byteLength),i._mux(t,n.range[0],n.index,r)),r&&(i.timeRange[n.index].downloaded=!0,i.bufferLoadedPos=-1,i.log("[FragLoadDowned],fragmentIdx,",n.index,",rangeEnd,",n.range[1]));case 2:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()),i.timeRecord={startMuxTime:-1,startLoadTime:-1,newMP4Time:util.nowTime(),startLoadMetaTime:-1},i.url=e,i.backUrl=a||[],i._bitRate=t,i.options=h.getDefaultConfig(),Object.keys(r).map((function(e){void 0!==r[e]&&null!==r[e]&&(i.options[e]=r[e])})),i.timeRange=[],i.firstFrameTime=o||{},i._logTag=s||"",i.CHUNK_SIZE=getMetaSize(r.duration,i.options.chunkSize,r.fileSize),i.player=n,i.bufferLoaded=new Uint8Array(0),i.bufferLoadedPos=0,i.meta=null,i.preloadCache=null,i.videoTrak=null,i.audioTrak=null,i.canDownload=!0,i._loadSuccessCallBack=null,i._isPending=!1,i._metaLoading=!1,i.MP4Loader=new MP4Loader(_objectSpread2$4(_objectSpread2$4({segmentDuration:r.segmentDuration,url:e,vid:r.vid+"-"+t,retry:r.retryCount||2,retryDelay:r.retryDelay||1e3,timeout:3e3},r.reqOptions),{},{openLog:checkOpenLog()})),i.MP4Demuxer=null,i.FMP4Remuxer=null,i._needInitSegment=!0,i._bitRateInfoMap=new Map,i._switchBitRate=!1,i._segmentToBitRateMap=new Map,i.useEME=!1,i.kidValue=null,i.enableWorker=r.enableWorker&&("h265"!==r.codecType||r.supportHevc),i.enableWorker&&"undefined"!=typeof Worker)try{i.workerSequence=0,i.transmuxerWorkerControl=new TransmuxerWorkerControl({id:i.workerSequence,codecType:r.codecType,supportHevc:i.options.supportHevc,openLog:checkOpenLog()}),i.transmuxerWorkerControl.on("transmux",(function(e){var t=e.args;i.log("[transmuxerworker end] ,range, ",JSON.stringify(t.range),",dataLen,",t.buffer.byteLength,t.context),i.firstFrameTime.firstmux<0&&i.timeRecord.startMuxTime>0&&(i.firstFrameTime.firstmux=util.nowTime()-i.timeRecord.startMuxTime),i._loadSuccessCallBack&&i._loadSuccessCallBack(t)}))}catch(error){i.log("Error in worker:",error),i.enableWorker=!1,i.transmuxerWorkerControl=null}return i.enableWorker||(i.MP4Demuxer=null,i.FMP4Remuxer=null),i.seekTime=-1,i}return _createClass$8(h,[{key:"changeBitRate",value:(c=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.bitrate===this._bitRate){e.next=9;break}return this.url=t.url,this._bitRate=t.bitrate,this.backUrl=t.backupURL,e.next=6,this.MP4Loader.changeUrl(this.url,this.options.vid+"-"+this._bitRate,this.CHUNK_SIZE);case 6:this.emit(MP4_EVENTS.CHANGE_URL,this.url),this._switchBitRate=!0,this.log("[switchBitrate] changeUrl, bitRate,",this._bitRate,this.url);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"_getByPreload",value:function(t,r,n,i){try{if(t&&t.byteLength>=r){var a={endTime:(new Date).getTime(),startTime:(new Date).getTime(),index:i,range:[],vid:this.options.vid,from:"local"};if(n<=t.byteLength){var o=t.slice(r,n);return a.range=[r,n],a.state=!0,{buffer:o,context:a,state:!0}}var s=t.byteLength-1,l=t.slice(r,s);return a.range=[r,s],{context:a,buffer:l,state:!1}}return null}catch(e){return console.error("[MP4] _getByPreload",r,n,e),null}}},{key:"log",value:function(e){for(var t=this.options,r=t&&t.vid?"[MP4]".concat(this._logTag," ").concat(t.vid," ").concat(e):"[MP4]".concat(this._logTag," ").concat(e),n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];log$1.apply(void 0,[r].concat(i))}},{key:"errorHandler",value:(u=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h=arguments;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>2&&void 0!==h[2]?h[2]:{},i=t.response,a=t.message,o=this.options?this.options.vid:"",s=null,this._isPending=!0,!i){e.next=33;break}if(l=transformHeaders(i.headers),s=new NetWorkError("network",i.status,{httpText:i.httpText,message:a,url:i.url,headers:l}),console.log("[MP4] [".concat(o,"] errorHandler error state:[").concat(r,"], _isPending:[").concat(this._isPending,"] "),s),!(this.backUrl&&this.backUrl.length>0)){e.next=29;break}if(console.log("[MP4] [".concat(o,"] errorHandler start backUpUrl retry"),this.backUrl.length,this.backUrl),u=this.backUrl.shift(),this.update(u),this._isPending=!1,!this.MP4Loader){e.next=18;break}return e.next=17,this.MP4Loader.changeUrl(this.url,this.url+"-"+this._bitRate,this.CHUNK_SIZE);case 17:this.emit(MP4_EVENTS.CHANGE_URL,this.url);case 18:if(this.emit(MP4_EVENTS.TASK_PROGRESS,{type:"error",error:t}),"getMetaInfo"!==r){e.next=24;break}return this.getMetaInfo(),e.abrupt("return");case 24:if("loadFragment"!==r){e.next=29;break}if(c=n.index,d=n.range,!c||!d){e.next=29;break}return this.loadFragment(c,d),e.abrupt("return");case 29:console.log("[MP4] [".concat(o,"] errorHandler backUpUrl is null emit error")),this.emit(MP4_EVENTS.ERROR,s),e.next=36;break;case 33:console.log("[MP4] [".concat(o,"] errorHandler,"),t),s=t,this.emit(MP4_EVENTS.ERROR,s);case 36:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"init",value:(l=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t){var r,n,i,a,o,s,l,u;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.url){e.next=3;break}return e.next=3,this.MP4Loader.changeUrl(this.url,this.options.vid+"-"+this._bitRate,this.CHUNK_SIZE);case 3:if(this.emit(MP4_EVENTS.CHANGE_URL,this.url),this.meta=null,r=t.meta,n=t.mediaSegList,i=t.buffer,a=t.fileSize,o=t.initSeg,s=t.bitrate,!r||!r.ext){e.next=21;break}this.meta=r,this._bitRate=s,this.videoTrak=r.ext.videoTrak,this.audioTrak=r.ext.audioTrak,this.timeRange=this.getTimeRange(),n?this.preloadCache={segList:n||[],initSeg:o}:i&&(this.size=a,this.bufferLoaded=i),l={meta:r,videoSegments:r.ext.videoTrak,audioSegments:r.ext.audioTrak,bufferLoaded:i||null},this._bitRateInfoMap.set(this._bitRate,l),u=(new Date).getTime(),setTimeout((function(){console.log(">>>>metaReady setTimeout",(new Date).getTime()-u)})),console.log(">>>>metaReady",util.nowTime()),this.emit(MP4_EVENTS.META_READY,this.meta),e.next=23;break;case 21:return e.next=23,this.getMetaInfo();case 23:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getTimeRange",value:function(){for(var e=[],t=null,r=0;this.videoTrak&&r<this.videoTrak.length;r++)t={startTime:this.videoTrak[r].startTime,endTime:this.videoTrak[r].endTime,downloaded:!1,isLoading:!1},e.push(t);if(this.audioTrak&&this.audioTrak.length>e.length)for(var n=e.length;n<this.audioTrak.length;n++)t={startTime:Math.max(this.audioTrak[n].startTime,t?t.endTime:0),endTime:Math.max(this.audioTrak[n].endTime,t?t.endTime:0),downloaded:!1,isLoading:!1},e.push(t);return e}},{key:"getMetaInfo",value:(s=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(){var t,r,n,i,a=this,o=arguments;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(o.length>0&&void 0!==o[0])||o[0],e.prev=1,r=util.nowTime(),this._metaLoading=!0,this.log("getMetaInfo start, bitRate,",this._bitRate),this.bufferLoaded=new Uint8Array(0),n=0,i=function(){var e=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(i,o,s,l){var u,c;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.log("getMetaInfo onProgressHandle, dataLen,",i?i.byteLength:-1,", state,",o,",range,",JSON.stringify(s.range)),!l){e.next=7;break}return e.next=4,a.cancelLoading();case 4:return u=new ParserError(ERROR_TYPES.demux,ERROR_CODES.metaError,{msg:JSON.stringify(l)}),a.errorHandler(u,"getMetaInfo"),e.abrupt("return");case 7:i&&s.range[0]===n&&(a.bufferLoaded=lib$1(Uint8Array,a.bufferLoaded,new Uint8Array(i)),n+=i.byteLength),s.meta&&!a.meta&&(a.firstFrameTime.metaload=util.nowTime()-r,c=s.meta,a.videoTrak=c.videoSegments,a.audioTrak=c.audioSegments,a.timeRange=a.getTimeRange(),a.meta=_objectSpread2$4(_objectSpread2$4({},c.meta),{},{ext:{videoTrak:a.videoTrak,audioTrak:a.audioTrak}}),c.bufferLoaded=a.bufferLoaded,a._bitRateInfoMap.set(a._bitRate,c),a.log("meta reach, bitRate,",a._bitRate),t&&a.emit(MP4_EVENTS.META_READY,a.meta)),a.meta&&o&&(a.log("[getMetaInfo req end]"),a._metaLoading=!1),a.meta&&(i||o)&&(a.log("emit moov_req_progress"),a.emit(MP4_EVENTS.MOOV_REQ_PROGRESS));case 11:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),e.next=10,this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,this.CHUNK_SIZE],i);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("[MP4] trigger errorHandler getMetaInfo",e.t0),this.errorHandler(e.t0,"getMetaInfo");case 16:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(){return s.apply(this,arguments)})},{key:"getFragmentIdx",value:function(e){var t,r;if(this.videoTrak.length){if(t=this.videoTrak.find((function(t){return t.startTime<=e&&t.endTime>e})),r=this.audioTrak.find((function(t){return t.startTime<=e&&t.endTime>e})),t&&r)return Math.min(t.index,r.index);if(t||r)return t?t.index:r.index;var n=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(n=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(n=Math.min(this.audioTrak.length-1,n)),n}return(r=this.audioTrak.find((function(t){return t.startTime<=e&&t.endTime>e})))?r.index:0}},{key:"_checkHasMeta",value:(o=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(){var t,r;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._bitRateInfoMap.get(this._bitRate)){e.next=19;break}return this.log("[ABR], need load InitSegment, bitRate, ",this._bitRate),this._metaLoading=!0,e.next=6,this.MP4Loader.loadMeta(this.MP4Loader.cache,Math.round(this.CHUNK_SIZE/2));case 6:return r=e.sent,this._metaLoading=!1,this.videoTrak=r.videoSegments,this.audioTrak=r.audioSegments,this.meta=_objectSpread2$4(_objectSpread2$4({},r.meta),{},{ext:{videoTrak:this.videoTrak,audioTrak:this.audioTrak}}),this.emit(MP4_EVENTS.UPDATEEME,this.meta),this.timeRange=this.getTimeRange(),this.bufferLoaded=new Uint8Array(0),r.bufferLoaded=this.bufferLoaded,this._bitRateInfoMap.set(this._bitRate,r),e.abrupt("return",!0);case 19:return this.log("[ABR], not need load InitSegment, bitRate, ",this._bitRate),this.videoTrak=t.videoSegments,this.audioTrak=t.audioSegments,this.meta=t.meta,this.emit(MP4_EVENTS.UPDATEEME,this.meta),this.timeRange=this.getTimeRange(),this.bufferLoaded=new Uint8Array(0),e.abrupt("return",!0);case 27:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"resetFragmentLoadState",value:function(e){for(var t=0;t<this.timeRange.length;t++)t<e?(this.timeRange[t].downloaded=!0,this.timeRange[t].isLoading=!0):(this.timeRange[t].downloaded=!1,this.timeRange[t].isLoading=!1)}},{key:"getFragRange",value:function(e){var t,r,n,i,a=null;this.videoTrak&&(a=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1]);var o=null;this.audioTrak&&(o=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1]);var s=0,l=0;this.videoTrak&&e>=this.videoTrak.length-1&&(s=-1),this.audioTrak&&e>=this.audioTrak.length-1&&(l=-1);var u=[Math.min((null===(t=a)||void 0===t?void 0:t.range[0])||1/0,(null===(r=o)||void 0===r?void 0:r.range[0])||1/0),Math.max((null===(n=a)||void 0===n?void 0:n.range[1])+s||0,(null===(i=o)||void 0===i?void 0:i.range[1])+l||0)];return e<this.timeRange.length&&(this.timeRange[e].range=u),u}},{key:"load",value:(a=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t,r){var n,i,a,o;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loadSuccessCallBack=r,!this._switchBitRate||this._metaLoading){e.next=11;break}return this.log("[switchBitrate], switch bitRate start load, bitRate,",this._bitRate,", time,",t>=this.videoTrak.length?this.audioTrak[t].startTime:this.videoTrak[t].startTime,", fragIndex,",t),e.next=5,this._checkHasMeta();case 5:n=e.sent,this.resetFragmentLoadState(t),this.log("[switchBitrate], reset timerange state,",t),this._needInitSegment=!0,this.resetTansmuxer(),n&&(this._switchBitRate=!1);case 11:if(!this._switchBitRate||!this._metaLoading){e.next=13;break}return e.abrupt("return");case 13:i=this.getFragRange(t),(a=this.getFragmentFromCache(t,i))?(this.log("[mp4.load], segment ,",t,"Data In Cache",JSON.stringify(i),", needInit,",this._needInitSegment),this.timeRange[t].downloaded=!0,this.timeRange[t].isLoading=!1,this._needInitSegment=!1,this._loadSuccessCallBack&&this._loadSuccessCallBack(a)):(this.log("loadFragment,",t,",bitRate,",this._bitRate,",range,",JSON.stringify(i)),this.seekTime>0?(o=this.getSubRange(t,this.seekTime,i),this.loadFragment(t,o),this.seekTime=-1):this.loadFragment(t,i));case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"getSubRange",value:function(e,t,r){var n=r[0],i=r[0],a=1,o=!1;if(this.log(">>>>>getSubRange time,",t,JSON.stringify(r)),this.videoTrak){var s=e<this.videoTrak.length?this.videoTrak[e]:this.videoTrak[this.videoTrak.length-1],l=s.frames.filter(getKeyFrameList),u=this.meta.videoTimescale,c=l[0].startTime/u;this.log(">>>>>getSubRange video, startTime,",s.startTime,",endTime,",s.endTime);for(var d=0;d<l.length;d++)this.log(">>>>>getSubRange video keyFrameList, startTime,",l[d].startTime/u,",range,",l[d].offset);for(;a<l.length;a++){var h=l[a].startTime/u;if(c<=t&&t<h&&r[0]<l[a-1].offset){n=l[a-1].offset,o=!0,this.log(">>>>>getSubRange video end, startTime,",c,",endTime,",h,",startRange,",n,", keyFrameIndex,",a-1);break}c=h}!o&&c<=t&&t<s.endTime+.8&&(n=l[a-1].offset,this.log(">>>>>getSubRange video last, startTime,",c,",endTime,",s.endTime,",startRange,",n))}if(a=1,this.audioTrak){var f=e<this.audioTrak.length?this.audioTrak[e]:this.audioTrak[this.audioTrak.length-1],p=f.frames,y=this.meta.audioTimescale;a=Math.floor((t*y-p[0].startTime)/f.frames[0].duration);for(var m=(a=Math.min(p.length-1,a))>0?p[a-1].startTime/y:p[0].startTime/y;a>=0&&a<p.length;)if(a>0&&m>t)m=p[a-=1].startTime/y;else{var g=(p[a].startTime+p[a].duration)/y;if(m<=t&&t<g&&r[0]<p[a].offset){i=p[a].offset,o=!0,this.log(">>>>>getSubRange audio end, startTime,",m,",endTime,",g,",startRange,",i,", index,",a);break}m=g,a++}}var v=[Math.min(i,n),r[1]];return this.log(">>>>>getSubRange finalRange ",JSON.stringify(v),",oldRange,",JSON.stringify(r)),v}},{key:"getFragmentFromCache",value:function(e,t){var r=this.preloadCache;if(!r||!r.segList)return null;for(var n=-1,i=r.segList,a=r.initSeg,o=0;o<i.length;o++)if(i[o].index===e){n=o;break}if(n<0)return null;var s=i[n];if(console.log(">>>>preloadCache",n,s,s.range,t[1],s.range[1]>=t[1]),s.range[1]>=t[1]){var l=[this.timeRange[e].startTime,this.timeRange[e].endTime];return{buffer:s.buffer,range:t,context:{range:t,fragIndex:e,state:!0,timeRange:[l[0],l[1]]},state:!0,initSeg:this._needInitSegment?a:void 0}}return null}},{key:"_mux",value:function(t,r,n,i){this.firstFrameTime.firstmux<0&&this.timeRecord.startMuxTime<0&&(this.timeRecord.startMuxTime=util.nowTime(),this.firstFrameTime.startMuxTime=util.nowTime()-this.timeRecord.startLoadTime);var a=this.getSamplesRange(n,"video"),o=this.getSamplesRange(n,"audio"),s=[r,r+t.byteLength];if(this.transmuxerWorkerControl){var l={range:s,state:i,fragIndex:n};this.log("[transmuxerworker start] ,range, ",JSON.stringify(s),",dataLen,",t.byteLength,l),this.transmuxerWorkerControl.transmux(this.workerSequence,t,r,a,o,this.meta.moov,this.useEME,this.kidValue,l)}else try{this.MP4Demuxer||(this.MP4Demuxer=new MP4Demuxer(this.videoTrak,this.audioTrak,null,{openLog:checkOpenLog()}));var u,c=this.MP4Demuxer.demuxPart(t,r,a,o,this.meta.moov,this.useEME,this.kidValue);this.FMP4Remuxer||this.checkCodecH265()&&!this.options.supportHevc||(this.FMP4Remuxer=new FMP4Remuxer$1(this.MP4Demuxer.videoTrack,this.MP4Demuxer.audioTrack,{openLog:checkOpenLog()})),this.log("[mux], videoTimeRange,",c.videoTrack?[c.videoTrack.startPts,c.videoTrack.endPts]:null,",audioTimeRange,",c.audioTrack?[c.audioTrack.startPts,c.audioTrack.endPts]:null);var d=[Math.min(c.videoTrack.startPts,c.audioTrack.startPts),Math.max(c.videoTrack.endPts,c.audioTrack.endPts)];if(this.FMP4Remuxer){var h=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0,range:s});h.initSegment&&(this._needInitSegment=!1),u={buffer:util.concatData(h.audioSegment,h.videoSegment),range:s,state:i,context:{range:s,fragIndex:n,timeRange:d},initSeg:h.initSegment}}else u={videoTrack:c.videoTrack,audioTrack:c.audioTrack,buffer:null,range:s,state:i,context:{range:s,fragIndex:n,timeRange:d}};this.firstFrameTime.firstmux<0&&this.timeRecord.startMuxTime>0&&(this.firstFrameTime.firstmux=util.nowTime()-this.timeRecord.startMuxTime),this._loadSuccessCallBack&&this._loadSuccessCallBack(u)}catch(e){console.error("mux err:",e);var f=new ParserError(ERROR_TYPES.remux,ERROR_CODES.muxError,{msg:JSON.stringify(e)});this.errorHandler(f,"mux",{fragIndex:n,range:[r,r+t.byteLength]})}}},{key:"getSamplesRange",value:function(e,t){var r=[];switch(t){case"video":if(this.videoTrak&&e<this.videoTrak.length){var n=this.videoTrak[e].frames;r.push(n[0].index),r.push(n[n.length-1].index)}break;case"audio":if(this.audioTrak&&e<this.audioTrak.length){var i=this.audioTrak[e].frames;r.push(i[0].index),r.push(i[i.length-1].index)}break;default:console.warn("[getSamplesRange] type ",t," is invalid")}return r}},{key:"loadFragment",value:(i=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function t(r,n){var i,a,o,s;return _regeneratorRuntime$4().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._isPending&&n!==[0,0]&&!this.timeRange[r].isLoading){t.next=2;break}return t.abrupt("return");case 2:if(this.log("[MP4.loadFragment] ,fragIndex,",r,",range ",n,",len ,",n[1]-n[0],", bufferLoaded_Len,",this.bufferLoaded.byteLength),this._segmentToBitRateMap.set(r,this._bitRate),this.timeRecord.startLoadTime<0&&(this.timeRecord.startLoadTime=util.nowTime()),!(n.length>=2&&n[1]&&n[1]>0&&n[1]<=this.bufferLoaded.byteLength)){t.next=15;break}this.timeRange[r].isLoading=!0,i=Math.max(n[0],this.bufferLoadedPos),a=new Uint8Array(this.bufferLoaded.slice(i,n[1])),this.log("[mp4.loadFragment] has all data: ",i,n[1]),this.timeRange[r].downloaded=!0,this.bufferLoadedPos=-1,this._mux(a,i,r,!0),t.next=38;break;case 15:if(!(n.length>=2&&n[0]&&n[0]<=this.bufferLoaded.byteLength)){t.next=27;break}if(this.timeRange[r].isLoading){t.next=25;break}if(o=Math.max(n[0],this.bufferLoadedPos),!((s=new Uint8Array(this.bufferLoaded.slice(o,n[1]))).byteLength>0)){t.next=24;break}return this.bufferLoadedPos=o+s.byteLength,this.log("[mp4.loadFragment] has part data: ",o,o+s.byteLength),this._mux(s,o,r,n[1]<=this.bufferLoadedPos),t.abrupt("return");case 24:if(!this._metaLoading&&!this.timeRange[r].isLoading)try{this.log("[mp4.loadFragment] ready to load part data >>> ",this.bufferLoaded.byteLength,n[1]),this.timeRange[r].isLoading=!0,this.MP4Loader.loadData([this.bufferLoaded.byteLength,n[1]],this.MP4Loader.cache,{index:r,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen})}catch(e){this.errorHandler(e,"MP4Loader.loadData",{range:[this.bufferLoaded.byteLength,n[1]],fragIndex:r})}case 25:t.next=38;break;case 27:if(this._metaLoading&&!(n[0]>=this.CHUNK_SIZE)||this.timeRange[r].isLoading){t.next=38;break}return this.timeRange[r].isLoading=!0,this.log("[mp4.loadFragment],ready to load all data ,segmentIdx, ",r,",range >>> ",JSON.stringify(n)),t.prev=30,t.next=33,this.MP4Loader.loadData(n,this.MP4Loader.cache,{index:r,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen});case 33:t.next=38;break;case 35:t.prev=35,t.t0=t.catch(30),this.errorHandler(t.t0,"MP4Loader.loadData",{range:n,fragIndex:r});case 38:case"end":return t.stop()}}),t,this,[[30,35]])}))),function(e,t){return i.apply(this,arguments)})},{key:"loadAllFragmentData",value:(n=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t,r,n){var i,a,o;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasDestroyed){e.next=2;break}return e.abrupt("return");case 2:return i=this.getFragRange(t),e.prev=3,e.next=6,this.MP4Loader.loadData(i,this.MP4Loader.cache,{index:t});case 6:if(a=e.sent,this.log("loadAllFragmentData after",JSON.stringify(i),a),a&&a.data){e.next=11;break}return n(new Error("response null")),e.abrupt("return");case 11:o=a.data,this._loadSuccessCallBack=r,this._mux(o,i[0],t,!0),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),console.error("[MP4] loadAllFragmentData error",e.t0),n(e.t0);case 20:case"end":return e.stop()}}),e,this,[[3,16]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"cancelLoading",value:(r=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.MP4Loader;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}this.MP4Loader.cancel();case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"update",value:function(e){this.url=e}},{key:"getDataBitRate",value:function(e){return this._segmentToBitRateMap.get(e)}},{key:"checkCodecH265",value:function(){return this.meta&&(this.meta.videoCodec.indexOf("hvc1")>-1||this.meta.videoCodec.indexOf("hev1")>-1)}},{key:"destroy",value:function(){this.hasDestroyed||(this.resetTansmuxer(),this.transmuxerWorkerControl&&this.transmuxerWorkerControl.destroy(),this.size=0,this._isPending=!1,this._metaLoading=!1,this.bufferLoadedPos=0,this.bufferLoaded=new Uint8Array(0),this._bitRateInfoMap.clear(),this._segmentToBitRateMap.clear(),this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy()),this.hasDestroyed=!0)}},{key:"resetTansmuxer",value:function(){this.MP4Demuxer&&this.MP4Demuxer.reset(),this.MP4Demuxer=null,this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.FMP4Remuxer=null,this.transmuxerWorkerControl&&this.transmuxerWorkerControl.reset()}}],[{key:"getDefaultConfig",value:function(){return{onProcessMinLen:5120,xhrSetup:null,chunkSize:8e5,loadSize:800,isCache:!1,playerId:"",vid:"",ext:{}}}}]),h}(EventEmitter$1);function getKeyFrameList(e){if(e.keyframe)return e}var ProxyPromise=function(){function e(){var t,r;_classCallCheck$7(this,e);var n=new Promise((function(e,n){t=e,r=n}));return n.resolve=function(e){t(e),n.state="fulfilled"},n.reject=function(e){r(e),n.state="rejected",n.isBreak="DESTROYED"===e},n.state="pending",n}return _createClass$8(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}(),XHR=_createClass$8((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,n=t.method,i=void 0===n?"GET":n,a=t.type,o=void 0===a?"arraybuffer":a,s=t.data,l=void 0===s?{}:s;return _classCallCheck$7(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,a=i.toUpperCase(),s=[];if(o&&(n.responseType=o),Object.keys(l).map((function(e){s.push("k=".concat(l[e]))})),"GET"===a)n.open(a,"".concat(r,"?").concat(s.join("&"))),n.send();else{if("POST"!==a)throw new Error("xhr ".concat(a," is not supported"));n.open(a,r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(l))}n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)}}))}));function getPlayLicenses(e,t,r){var n=new ProxyPromise;return new XHR({type:"json",method:"POST",url:r,data:{drm_type:"22",license_request:[{vid:e,kids:[].concat(t)}]}}).then((function(r){var i=r.response;if(i){var a=i.play_licenses[e][t];n.resolve(a)}else n.reject()})).catch((function(){n.reject()})),n}function getKeyValue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=new ProxyPromise;if(r){log$1("[getKeyValue]>before openBox");var a=n.awManager.openBox(r);if(log$1("[getKeyValue]>after openBox: ",a),t){var o={clearKeys:{}};o.clearKeys[t]=a,i.resolve(o)}else i.resolve(a)}else{var s=getPlayLicenses(e,t,n.config.getLicenseUrl);s.id="requestPromise",n._addPendingPromise(s),s.then((function(e){if(n._removePendingPromise(s),n.awManager){log$1("[getKeyValue]>before openBox");var r=n.awManager.openBox(e);log$1("[getKeyValue]>after openBox: ",r);var a={clearKeys:{}};a.clearKeys[t]=r,i.resolve(a)}else i.reject({errDes:"awManager not exist, player destroyed"}),log$1("[getKeyValue]>awManager not exist, player destroyed")})).catch((function(e){i.reject(e),log$1("[getKeyValue]>requestPromise reject")}))}return i}var userGestureEventMiddleware={playBtnClick:function(e,t,r,n){e.paused||e.waitingMoreBuffer&&(e.waitingMoreBuffer=!1),n.call(e,t,r)}},videoEventMiddleware={waiting:function(e,t){var r=e.player,n=e.eventName;r.waitingMoreBuffer=!0,t(n,e)},play:function(e,t){var r=e.player,n=e.eventName;r.waitingMoreBuffer||t(n,e)},pause:function(e,t){var r=e.player,n=e.eventName;r.waitingMoreBuffer||t(n,e)},seeking:function(e,t){var r=e.player,n=e.eventName;r.isSeekingStart=!0,t(n,e)},progress:function(e,t){log$1(">>>>progress");var r=e.player,n=e.eventName;if(r.waitingMoreBuffer){var i=r.getBufferedRange(r.buffered2);0===i[0]&&0===i[1]||(void 0===r.inWaitingStart||r.isSeekingStart?(log$1("progress seek"),i[1]-r.currentTime>=(r.config.canplayWaterLevel||1)||i[1]>r.duration-1?(log$1("progress "),r.play()):(log$1("progress "),r.emit("waiting"))):(log$1("progress video"),i[1]-r.currentTime>=(r.config.bufferWaterLevel||5)||i[1]>r.duration-1?(log$1("progress "),r.play()):(log$1("progress "),r.emit("waiting"))))}t(n,e)},playing:function(e,t){var r=e.player,n=e.eventName;log$1("playing");var i=r.getBufferedRange(r.buffered2);if(0===i[0]&&0===i[1])return log$1("playing  "),r.waitingMoreBuffer=!0,r.pause(),void t.call("waiting",e);void 0===r.inWaitingStart||r.isSeekingStart?(log$1("playing seek"),i[1]-r.currentTime>=(r.config.canplayWaterLevel||1)||i[1]>r.duration-1?(log$1("playing "),r.waitingMoreBuffer=!1,r.isSeekingStart=!1,t(n,e)):(log$1("playing "),r.waitingMoreBuffer=!0,r.pause(),t.call("waiting",e))):(log$1("playing video"),i[1]-r.currentTime>=(r.config.bufferWaterLevel||5)||i[1]>r.duration-1?(log$1("playing "),r.waitingMoreBuffer=!1,t(n,e)):(log$1("playing "),r.waitingMoreBuffer=!0,r.pause(),t.call("waiting",e)))}};function offInDestroy(e,t,r,n){e.once(n,(function i(){e.off(t,r),e.off(n,i)}))}function on(e,t,r,n){if(n)e.on(t,r),offInDestroy(e,t,r,n);else{e.on(t,(function(e){r(e)}))}}var EME=function(e){_inherits$4(r,e);var t=_createSuper$5(r);function r(e){var n;return _classCallCheck$7(this,r),(n=t.call(this)).drm=e,n.KEYSYSTEM_TYPE="",n.keys={},n.drm.clearKeys&&(n.KEYSYSTEM_TYPE="org.w3.clearkey",n.keys=n.drm.clearKeys),n.options=[],n.ensurePromise=void 0,n}return _createClass$8(r,[{key:"updateDrm",value:function(e){this.drm=e,this.keys=this.drm.clearKeys}},{key:"setOptions",value:function(){var e=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/mp4; codecs="hev1.1.6.L120.90"'},{contentType:'video/webm; codecs="vp8"'}],t={videoCapabilities:e},r={videoCapabilities:e,persistentState:"required",sessionTypes:["persistent-license"]};this.options=[r,t]}},{key:"bail",value:function(e){}},{key:"UpdateSessionFunc",value:function(e){var t=this;return function(r){var n=[],i=[];Object.keys(e).forEach((function(t){var r=e[t],a=util.fromHex(t),o=util.fromHex(r),s={kty:"oct",kid:util.toBase64(a,!1),k:util.toBase64(o,!1)};n.push(s),i.push(s.kid)}));var a={keys:n},o=JSON.stringify(a);r.target.update(util.StringToArrayBuffer(o)).then((function(){}),t.bail(" MediaKeySession update failed"))}}},{key:"KeysChange",value:function(e){}},{key:"EnsureMediaKeysCreated",value:function(e,t,r){return this.ensurePromise||(this.ensurePromise=navigator.requestMediaKeySystemAccess(t,r).then((function(e){return e.createMediaKeys()}),this.bail(" Failed to request key system access.")).then((function(t){return e.setMediaKeys(t)}),this.bail(" failed to create MediaKeys object"))),this.ensurePromise}},{key:"SetupEME",value:function(e,t){var r=this;e.sessions=[],on(this,"encrypted",(function(){var t=JSON.stringify({kids:["0123456789abcdef0123456789abcdef"]}),n=new Uint8Array(util.toUTF8(t));r.EnsureMediaKeysCreated(e,r.KEYSYSTEM_TYPE,r.options).then((function(){var t=e.mediaKeys.createSession();return e.sessions.push(t),t.addEventListener("message",r.UpdateSessionFunc(r.keys)),t.addEventListener("keystatuseschange",r.KeysChange),t.generateRequest("keyids",n.buffer)}),r.bail(" failed to ensure MediaKeys on HTMLMediaElement")).then((function(){}),r.bail(" Failed to generate request."))}))}}]),r}(EventEmitter$1),WasmManager=function(){function e(){_classCallCheck$7(this,e),this.queue=[]}return _createClass$8(e,[{key:"push",value:function(e){this.queue.push(e)}},{key:"startup",value:function(){return Promise.all(this.queue)}},{key:"destroy",value:function(){this.queue=[]}}]),e}(),$$h=_export$1,fails$4=fails$1Q,$imul=Math.imul,FORCED$1=fails$4((function(){return-5!=$imul(4294967295,5)||2!=$imul.length}));$$h({target:"Math",stat:!0,forced:FORCED$1},{imul:function(e,t){var r=65535,n=+e,i=+t,a=r&n,o=r&i;return 0|a*o+((r&n>>>16)*o+a*(r&i>>>16)<<16>>>0)}});var mathSign=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1},sign=mathSign,abs=Math.abs,pow=Math.pow,EPSILON=pow(2,-52),EPSILON32=pow(2,-23),MAX32=pow(2,127)*(2-EPSILON32),MIN32=pow(2,-126),roundTiesToEven=function(e){return e+1/EPSILON-1/EPSILON},mathFround=Math.fround||function(e){var t,r,n=+e,i=abs(n),a=sign(n);return i<MIN32?a*roundTiesToEven(i/MIN32/EPSILON32)*MIN32*EPSILON32:(r=(t=(1+EPSILON32/EPSILON)*i)-(t-i))>MAX32||r!=r?a*(1/0):a*r},$$g=_export$1,fround=mathFround;$$g({target:"Math",stat:!0},{fround:fround});var $$f=_export$1,floor=Math.floor,log=Math.log,LOG2E=Math.LOG2E;$$f({target:"Math",stat:!0},{clz32:function(e){var t=e>>>0;return t?31-floor(log(t+.5)*LOG2E):32}});var $$e=_export$1,trunc=mathTrunc$1;$$e({target:"Math",stat:!0},{trunc:trunc});var $$d=_export$1,uncurryThis$4=functionUncurryThis$1,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor$1.f,toLength=toLength$m,toString$3=toString$O,notARegExp=notARegexp$1,requireObjectCoercible$2=requireObjectCoercible$p,correctIsRegExpLogic=correctIsRegexpLogic$1,nativeStartsWith=uncurryThis$4("".startsWith),stringSlice$1=uncurryThis$4("".slice),min$1=Math.min,CORRECT_IS_REGEXP_LOGIC=correctIsRegExpLogic("startsWith"),MDN_POLYFILL_BUG=!CORRECT_IS_REGEXP_LOGIC&&!!function(){var e=getOwnPropertyDescriptor(String.prototype,"startsWith");return e&&!e.writable}();$$d({target:"String",proto:!0,forced:!MDN_POLYFILL_BUG&&!CORRECT_IS_REGEXP_LOGIC},{startsWith:function(e){var t=toString$3(requireObjectCoercible$2(this));notARegExp(e);var r=toLength(min$1(arguments.length>1?arguments[1]:void 0,t.length)),n=toString$3(e);return nativeStartsWith?nativeStartsWith(t,n,r):stringSlice$1(t,r,r+n.length)===n}});var aw=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(r){var n,i=void 0!==(r=r||{})?r:{},a={};for(n in i)i.hasOwnProperty(n)&&(a[n]=i[n]);if(i.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var o="";if(document.currentScript&&(o=document.currentScript.src),t&&(o=t),o=0!==o.indexOf("blob:")?o.substr(0,o.lastIndexOf("/")+1):"","object"!==("undefined"==typeof window?"undefined":_typeof$3(window))&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var s,l=i.print||console.log.bind(console),u=i.printErr||console.warn.bind(console);for(n in a)a.hasOwnProperty(n)&&(i[n]=a[n]);function c(e){c.shown||(c.shown={}),c.shown[e]||(c.shown[e]=1,u(e))}a=null,i.arguments&&i.arguments,Object.getOwnPropertyDescriptor(i,"arguments")||Object.defineProperty(i,"arguments",{configurable:!0,get:function(){Z("Module.arguments has been replaced with plain arguments_")}}),i.thisProgram&&i.thisProgram,Object.getOwnPropertyDescriptor(i,"thisProgram")||Object.defineProperty(i,"thisProgram",{configurable:!0,get:function(){Z("Module.thisProgram has been replaced with plain thisProgram")}}),i.quit&&i.quit,Object.getOwnPropertyDescriptor(i,"quit")||Object.defineProperty(i,"quit",{configurable:!0,get:function(){Z("Module.quit has been replaced with plain quit_")}}),y(void 0===i.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),y(void 0===i.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),y(void 0===i.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),y(void 0===i.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),y(void 0===i.read,"Module.read option was removed (modify read_ in JS)"),y(void 0===i.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),y(void 0===i.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),y(void 0===i.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),Object.getOwnPropertyDescriptor(i,"read")||Object.defineProperty(i,"read",{configurable:!0,get:function(){Z("Module.read has been replaced with plain read_")}}),Object.getOwnPropertyDescriptor(i,"readAsync")||Object.defineProperty(i,"readAsync",{configurable:!0,get:function(){Z("Module.readAsync has been replaced with plain readAsync")}}),Object.getOwnPropertyDescriptor(i,"readBinary")||Object.defineProperty(i,"readBinary",{configurable:!0,get:function(){Z("Module.readBinary has been replaced with plain readBinary")}}),ce=function(){Z("cannot use the stack before compiled code is ready to run, and has provided stack access")},i.wasmBinary&&(s=i.wasmBinary),Object.getOwnPropertyDescriptor(i,"wasmBinary")||Object.defineProperty(i,"wasmBinary",{configurable:!0,get:function(){Z("Module.wasmBinary has been replaced with plain wasmBinary")}}),i.noExitRuntime&&i.noExitRuntime,Object.getOwnPropertyDescriptor(i,"noExitRuntime")||Object.defineProperty(i,"noExitRuntime",{configurable:!0,get:function(){Z("Module.noExitRuntime has been replaced with plain noExitRuntime")}});var d,h={Memory:function(e){return{buffer:new ArrayBuffer(65536*e.initial),grow:function(e){var t=this.buffer,r=he(e);return y(this.buffer!==t),r}}},Table:function(e){var t=new Array(e.initial);return t.grow=function(e){t.length>=1&&Z("Unable to grow wasm table. Use a higher value for RESERVED_FUNCTION_POINTERS or set ALLOW_TABLE_GROWTH."),t.push(null)},t.set=function(e,r){t[e]=r},t.get=function(e){return t[e]},t},Module:function(e){return{}},Instance:function(e,t){var r,n=(r=f,function(e,t,n){var i=t.memory,a=r,o=new e.Int8Array(n);new e.Int16Array(n);var s=new e.Int32Array(n),l=new e.Uint8Array(n);new e.Uint16Array(n);var u=new e.Uint32Array(n);new e.Float32Array(n),new e.Float64Array(n);var c=e.Math.imul;e.Math.fround,e.Math.abs,e.Math.clz32,e.Math.min,e.Math.max,e.Math.floor,e.Math.ceil,e.Math.sqrt,t.abort,e.NaN,e.Infinity;var d=t.emscripten_memcpy_big,h=t.emscripten_resize_heap,f=t.__unlock,p=t.__lock,y=9744;function m(e){var t,r=0;return t=T(),(e=(r=s[388])+e|0)>>>0<=t<<16>>>0||h(0|e)?(s[388]=e,r):(s[256]=48,-1)}function g(e){var t,r=0,n=0,i=0,a=0,o=0,c=0,d=0,h=0,f=0,p=0,g=0,v=0;y=t=y-16|0;e:{t:{r:{n:{i:{a:{o:{s:{l:{u:{c:{if((e|=0)>>>0<=244){if(3&(r=(o=s[261])>>>(e=(c=e>>>0<11?16:e+11&-8)>>>3))){e=(r=s[1092+(a=(n=e+(1&(-1^r))|0)<<3)>>2])+8|0,(0|(i=s[r+8>>2]))!=(0|(a=a+1084|0))?(s[i+12>>2]=a,s[a+8>>2]=i):(g=1044,v=E(n)&o,s[g>>2]=v),n<<=3,s[r+4>>2]=3|n,s[4+(r=r+n|0)>>2]=1|s[r+4>>2];break e}if(c>>>0<=(h=s[263])>>>0)break c;if(r){n=r=(e=(0-(e=(0-(n=2<<e)|n)&r<<e)&e)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1092+(i=(n=((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)|0)<<3)>>2],(0|(e=s[r+8>>2]))!=(0|(i=i+1084|0))?(s[e+12>>2]=i,s[i+8>>2]=e):(o=E(n)&o,s[261]=o),e=r+8|0,s[r+4>>2]=3|c,a=(n<<=3)-c|0,s[4+(d=r+c|0)>>2]=1|a,s[r+n>>2]=a,h&&(r=1084+((n=h>>>3)<<3)|0,i=s[266],(n=1<<n)&o?n=s[r+8>>2]:(s[261]=n|o,n=r),s[r+8>>2]=i,s[n+12>>2]=i,s[i+12>>2]=r,s[i+8>>2]=n),s[266]=d,s[263]=a;break e}if(!(p=s[262]))break c;for(n=r=(e=(p&0-p)-1|0)>>>12&16,n|=r=(e>>>=r)>>>5&8,n|=r=(e>>>=r)>>>2&4,r=s[1348+(((n|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2],i=(-8&s[r+4>>2])-c|0,n=r;(e=s[n+16>>2])||(e=s[n+20>>2]);)i=(n=(a=(-8&s[e+4>>2])-c|0)>>>0<i>>>0)?a:i,r=n?e:r,n=e;if(f=s[r+24>>2],(0|(a=s[r+12>>2]))!=(0|r)){e=s[r+8>>2],s[e+12>>2]=a,s[a+8>>2]=e;break t}if(!(e=s[(n=r+20|0)>>2])){if(!(e=s[r+16>>2]))break u;n=r+16|0}for(;d=n,a=e,(e=s[(n=e+20|0)>>2])||(n=a+16|0,e=s[a+16>>2]););s[d>>2]=0;break t}if(c=-1,!(e>>>0>4294967231)&&(c=-8&(r=e+11|0),h=s[262])){n=0-c|0,o=0,(r>>>=8)&&(o=31,c>>>0>16777215||(o=28+((e=((o=(r<<=i=r+1048320>>>16&8)<<(e=r+520192>>>16&4))<<(r=o+245760>>>16&2)>>>15)-(r|e|i)|0)<<1|c>>>e+21&1)|0));d:{h:{if(i=s[1348+(o<<2)>>2])for(r=c<<(31==(0|o)?0:25-(o>>>1)|0),e=0;;){if(!((d=(-8&s[i+4>>2])-c|0)>>>0>=n>>>0||(a=i,n=d))){n=0,e=i;break h}if(d=s[i+20>>2],i=s[16+((r>>>29&4)+i|0)>>2],e=d?(0|d)==(0|i)?e:d:e,r<<=0!=(0|i),!i)break}else e=0;if(!(e|a)){if(!(e=(0-(e=2<<o)|e)&h))break c;i=r=(e=(e&0-e)-1|0)>>>12&16,i|=r=(e>>>=r)>>>5&8,i|=r=(e>>>=r)>>>2&4,e=s[1348+(((i|=r=(e>>>=r)>>>1&2)|(r=(e>>>=r)>>>1&1))+(e>>>r)<<2)>>2]}if(!e)break d}for(;n=(r=(i=(-8&s[e+4>>2])-c|0)>>>0<n>>>0)?i:n,a=r?e:a,e=(r=s[e+16>>2])||s[e+20>>2];);}if(!(!a|n>>>0>=s[263]-c>>>0)){if(d=s[a+24>>2],(0|a)!=(0|(r=s[a+12>>2]))){e=s[a+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;break r}if(!(e=s[(i=a+20|0)>>2])){if(!(e=s[a+16>>2]))break l;i=a+16|0}for(;o=i,r=e,(e=s[(i=e+20|0)>>2])||(i=r+16|0,e=s[r+16>>2]););s[o>>2]=0;break r}}}if((r=s[263])>>>0>=c>>>0){e=s[266],(n=r-c|0)>>>0>=16?(s[263]=n,i=e+c|0,s[266]=i,s[i+4>>2]=1|n,s[e+r>>2]=n,s[e+4>>2]=3|c):(s[266]=0,s[263]=0,s[e+4>>2]=3|r,s[4+(r=e+r|0)>>2]=1|s[r+4>>2]),e=e+8|0;break e}if((i=s[264])>>>0>c>>>0){r=i-c|0,s[264]=r,n=(e=s[267])+c|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|c,e=e+8|0;break e}if(e=0,n=a=c+47|0,s[379]?r=s[381]:(s[382]=-1,s[383]=-1,s[380]=4096,s[381]=4096,s[379]=t+12&-16^1431655768,s[384]=0,s[372]=0,r=4096),(n=(o=n+r|0)&(d=0-r|0))>>>0<=c>>>0)break e;if((r=s[371])&&(f=(h=s[369])+n|0)>>>0<=h>>>0|f>>>0>r>>>0)break e;if(4&l[1488])break a;c:{d:{if(r=s[267])for(e=1492;;){if((h=s[e>>2])+s[e+4>>2]>>>0>r>>>0&&h>>>0<=r>>>0)break d;if(!(e=s[e+8>>2]))break}if(-1==(0|(r=m(0))))break o;if(o=n,(i=(e=s[380])+-1|0)&r&&(o=(n-r|0)+(r+i&0-e)|0),o>>>0<=c>>>0|o>>>0>2147483646)break o;if((e=s[371])&&(d=(i=s[369])+o|0)>>>0<=i>>>0|d>>>0>e>>>0)break o;if((0|r)!=(0|(e=m(o))))break c;break i}if((o=d&o-i)>>>0>2147483646)break o;if((0|(r=m(o)))==(s[e>>2]+s[e+4>>2]|0))break s;e=r}if(r=e,!(c+48>>>0<=o>>>0|o>>>0>2147483646|-1==(0|e))){if((e=(e=s[381])+(a-o|0)&0-e)>>>0>2147483646)break i;if(-1!=(0|m(e))){o=e+o|0;break i}m(0-o|0);break o}if(-1!=(0|r))break i;break o}a=0;break t}r=0;break r}if(-1!=(0|r))break i}s[372]=4|s[372]}if(n>>>0>2147483646)break n;if((r=m(n))>>>0>=(e=m(0))>>>0|-1==(0|r)|-1==(0|e))break n;if((o=e-r|0)>>>0<=c+40>>>0)break n}e=s[369]+o|0,s[369]=e,e>>>0>u[370]&&(s[370]=e);i:{a:{o:{if(n=s[267]){for(e=1492;;){if(((i=s[e>>2])+(a=s[e+4>>2])|0)==(0|r))break o;if(!(e=s[e+8>>2]))break}break a}for(r>>>0>=(e=s[265])>>>0&&e||(s[265]=r),e=0,s[374]=o,s[373]=r,s[269]=-1,s[270]=s[379],s[376]=0;i=1084+(n=e<<3)|0,s[n+1092>>2]=i,s[n+1096>>2]=i,32!=(0|(e=e+1|0)););i=(e=o+-40|0)-(n=r+8&7?-8-r&7:0)|0,s[264]=i,n=r+n|0,s[267]=n,s[n+4>>2]=1|i,s[4+(e+r|0)>>2]=40,s[268]=s[383];break i}if(!(8&l[e+12|0]|r>>>0<=n>>>0|i>>>0>n>>>0)){s[e+4>>2]=a+o,r=(e=n+8&7?-8-n&7:0)+n|0,s[267]=r,e=(i=s[264]+o|0)-e|0,s[264]=e,s[r+4>>2]=1|e,s[4+(n+i|0)>>2]=40,s[268]=s[383];break i}}r>>>0<(a=s[265])>>>0&&(s[265]=r,a=0),i=r+o|0,e=1492;a:{o:{s:{l:{u:{c:{for(;;){if((0|i)!=s[e>>2]){if(e=s[e+8>>2])continue;break c}break}if(!(8&l[e+12|0]))break u}for(e=1492;;){if((i=s[e>>2])>>>0<=n>>>0&&(a=i+s[e+4>>2]|0)>>>0>n>>>0)break l;e=s[e+8>>2]}}if(s[e>>2]=r,s[e+4>>2]=s[e+4>>2]+o,s[4+(f=(r+8&7?-8-r&7:0)+r|0)>>2]=3|c,e=((r=i+(i+8&7?-8-i&7:0)|0)-f|0)-c|0,d=c+f|0,(0|r)==(0|n)){s[267]=d,e=s[264]+e|0,s[264]=e,s[d+4>>2]=1|e;break o}if(s[266]==(0|r)){s[266]=d,e=s[263]+e|0,s[263]=e,s[d+4>>2]=1|e,s[e+d>>2]=e;break o}if(1==(3&(n=s[r+4>>2]))){p=-8&n;u:if(n>>>0<=255){if(a=n>>>3,n=s[r+8>>2],(0|(i=s[r+12>>2]))==(0|n)){g=1044,v=s[261]&E(a),s[g>>2]=v;break u}s[n+12>>2]=i,s[i+8>>2]=n}else{if(h=s[r+24>>2],(0|(o=s[r+12>>2]))==(0|r))if((c=s[(i=r+20|0)>>2])||(c=s[(i=r+16|0)>>2])){for(;n=i,o=c,(c=s[(i=c+20|0)>>2])||(i=o+16|0,c=s[o+16>>2]););s[n>>2]=0}else o=0;else n=s[r+8>>2],s[n+12>>2]=o,s[o+8>>2]=n;if(h){n=s[r+28>>2];c:{if(s[(i=1348+(n<<2)|0)>>2]==(0|r)){if(s[i>>2]=o,o)break c;g=1048,v=s[262]&E(n),s[g>>2]=v;break u}if(s[h+(s[h+16>>2]==(0|r)?16:20)>>2]=o,!o)break u}s[o+24>>2]=h,(n=s[r+16>>2])&&(s[o+16>>2]=n,s[n+24>>2]=o),(n=s[r+20>>2])&&(s[o+20>>2]=n,s[n+24>>2]=o)}}r=r+p|0,e=e+p|0}if(s[r+4>>2]=-2&s[r+4>>2],s[d+4>>2]=1|e,s[e+d>>2]=e,e>>>0<=255){e=1084+((r=e>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=d,s[r+12>>2]=d,s[d+12>>2]=e,s[d+8>>2]=r;break o}if(r=0,(i=e>>>8)&&(r=31,e>>>0>16777215||(r=28+((r=((c=(i<<=a=i+1048320>>>16&8)<<(r=i+520192>>>16&4))<<(i=c+245760>>>16&2)>>>15)-(i|r|a)|0)<<1|e>>>r+21&1)|0)),s[(n=d)+28>>2]=r,s[d+16>>2]=0,s[d+20>>2]=0,n=1348+(r<<2)|0,(i=s[262])&(a=1<<r)){for(i=e<<(31==(0|r)?0:25-(r>>>1)|0),r=s[n>>2];;){if(n=r,(-8&s[r+4>>2])==(0|e))break s;if(r=i>>>29,i<<=1,!(r=s[16+(a=(4&r)+n|0)>>2]))break}s[a+16>>2]=d}else s[262]=i|a,s[n>>2]=d;s[d+24>>2]=n,s[d+12>>2]=d,s[d+8>>2]=d;break o}for(d=(e=o+-40|0)-(i=r+8&7?-8-r&7:0)|0,s[264]=d,i=r+i|0,s[267]=i,s[i+4>>2]=1|d,s[4+(e+r|0)>>2]=40,s[268]=s[383],s[(i=(e=(a+(a+-39&7?39-a&7:0)|0)-47|0)>>>0<n+16>>>0?n:e)+4>>2]=27,e=s[376],s[i+16>>2]=s[375],s[i+20>>2]=e,e=s[374],s[i+8>>2]=s[373],s[i+12>>2]=e,s[375]=i+8,s[374]=o,s[373]=r,s[376]=0,e=i+24|0;s[e+4>>2]=7,r=e+8|0,e=e+4|0,r>>>0<a>>>0;);if((0|n)==(0|i))break i;if(s[i+4>>2]=-2&s[i+4>>2],a=i-n|0,s[n+4>>2]=1|a,s[i>>2]=a,a>>>0<=255){e=1084+((r=a>>>3)<<3)|0,(i=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|i,r=e),s[e+8>>2]=n,s[r+12>>2]=n,s[n+12>>2]=e,s[n+8>>2]=r;break i}if(s[n+16>>2]=0,s[n+20>>2]=0,e=0,(i=a>>>8)&&(e=31,a>>>0>16777215||(e=28+((e=((d=(i<<=o=i+1048320>>>16&8)<<(e=i+520192>>>16&4))<<(i=d+245760>>>16&2)>>>15)-(i|e|o)|0)<<1|a>>>e+21&1)|0)),s[(r=n)+28>>2]=e,r=1348+(e<<2)|0,(i=s[262])&(o=1<<e)){for(e=a<<(31==(0|e)?0:25-(e>>>1)|0),r=s[r>>2];;){if(i=r,(0|a)==(-8&s[r+4>>2]))break a;if(r=e>>>29,e<<=1,!(r=s[16+(o=i+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+24>>2]=i}else s[262]=i|o,s[r>>2]=n,s[n+24>>2]=r;s[n+12>>2]=n,s[n+8>>2]=n;break i}e=s[n+8>>2],s[e+12>>2]=d,s[n+8>>2]=d,s[d+24>>2]=0,s[d+12>>2]=n,s[d+8>>2]=e}e=f+8|0;break e}e=s[i+8>>2],s[e+12>>2]=n,s[i+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=i,s[n+8>>2]=e}if(!((e=s[264])>>>0<=c>>>0)){r=e-c|0,s[264]=r,n=(e=s[267])+c|0,s[267]=n,s[n+4>>2]=1|r,s[e+4>>2]=3|c,e=e+8|0;break e}}s[256]=48,e=0;break e}r:if(d){e=s[a+28>>2];n:{if(s[(i=1348+(e<<2)|0)>>2]==(0|a)){if(s[i>>2]=r,r)break n;h=E(e)&h,s[262]=h;break r}if(s[d+(s[d+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=d,(e=s[a+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[a+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}r:if(n>>>0<=15)e=n+c|0,s[a+4>>2]=3|e,s[4+(e=e+a|0)>>2]=1|s[e+4>>2];else if(s[a+4>>2]=3|c,s[4+(i=a+c|0)>>2]=1|n,s[n+i>>2]=n,n>>>0<=255)e=1084+((r=n>>>3)<<3)|0,(n=s[261])&(r=1<<r)?r=s[e+8>>2]:(s[261]=r|n,r=e),s[e+8>>2]=i,s[r+12>>2]=i,s[i+12>>2]=e,s[i+8>>2]=r;else{e=0,(c=n>>>8)&&(e=31,n>>>0>16777215||(e=28+((e=((d=(c<<=o=c+1048320>>>16&8)<<(e=c+520192>>>16&4))<<(c=d+245760>>>16&2)>>>15)-(c|e|o)|0)<<1|n>>>e+21&1)|0)),s[(r=i)+28>>2]=e,s[i+16>>2]=0,s[i+20>>2]=0,r=1348+(e<<2)|0;n:{if((c=1<<e)&h){for(e=n<<(31==(0|e)?0:25-(e>>>1)|0),c=s[r>>2];;){if((-8&s[(r=c)+4>>2])==(0|n))break n;if(c=e>>>29,e<<=1,!(c=s[16+(o=(4&c)+r|0)>>2]))break}s[o+16>>2]=i}else s[262]=c|h,s[r>>2]=i;s[i+24>>2]=r,s[i+12>>2]=i,s[i+8>>2]=i;break r}e=s[r+8>>2],s[e+12>>2]=i,s[r+8>>2]=i,s[i+24>>2]=0,s[i+12>>2]=r,s[i+8>>2]=e}e=a+8|0;break e}t:if(f){e=s[r+28>>2];r:{if(s[(n=1348+(e<<2)|0)>>2]==(0|r)){if(s[n>>2]=a,a)break r;g=1048,v=E(e)&p,s[g>>2]=v;break t}if(s[f+(s[f+16>>2]==(0|r)?16:20)>>2]=a,!a)break t}s[a+24>>2]=f,(e=s[r+16>>2])&&(s[a+16>>2]=e,s[e+24>>2]=a),(e=s[r+20>>2])&&(s[a+20>>2]=e,s[e+24>>2]=a)}i>>>0<=15?(e=i+c|0,s[r+4>>2]=3|e,s[4+(e=e+r|0)>>2]=1|s[e+4>>2]):(s[r+4>>2]=3|c,s[4+(c=r+c|0)>>2]=1|i,s[i+c>>2]=i,h&&(e=1084+((n=h>>>3)<<3)|0,a=s[266],(n=1<<n)&o?n=s[e+8>>2]:(s[261]=n|o,n=e),s[e+8>>2]=a,s[n+12>>2]=a,s[a+12>>2]=e,s[a+8>>2]=n),s[266]=c,s[263]=i),e=r+8|0}return y=t+16|0,0|e}function v(e){var t=0,r=0,n=0,i=0,a=0,o=0,l=0,c=0,d=0;e:if(e|=0){a=(n=e+-8|0)+(e=-8&(r=s[e+-4>>2]))|0;t:if(!(1&r)){if(!(3&r))break e;if((n=n-(r=s[n>>2])|0)>>>0<u[265])break e;if(e=e+r|0,s[266]==(0|n)){if(3==(3&(r=s[a+4>>2])))return s[263]=e,s[a+4>>2]=-2&r,s[n+4>>2]=1|e,void(s[e+n>>2]=e)}else{if(r>>>0<=255){if(i=s[n+8>>2],r>>>=3,(0|(t=s[n+12>>2]))==(0|i)){c=1044,d=s[261]&E(r),s[c>>2]=d;break t}s[i+12>>2]=t,s[t+8>>2]=i;break t}if(l=s[n+24>>2],(0|n)==(0|(r=s[n+12>>2])))if((t=s[(i=n+20|0)>>2])||(t=s[(i=n+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[n+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(!l)break t;i=s[n+28>>2];r:{if(s[(t=1348+(i<<2)|0)>>2]==(0|n)){if(s[t>>2]=r,r)break r;c=1048,d=s[262]&E(i),s[c>>2]=d;break t}if(s[l+(s[l+16>>2]==(0|n)?16:20)>>2]=r,!r)break t}if(s[r+24>>2]=l,(t=s[n+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),!(t=s[n+20>>2]))break t;s[r+20>>2]=t,s[t+24>>2]=r}}if(!(a>>>0<=n>>>0)&&1&(r=s[a+4>>2])){t:{if(!(2&r)){if(s[267]==(0|a)){if(s[267]=n,e=s[264]+e|0,s[264]=e,s[n+4>>2]=1|e,s[266]!=(0|n))break e;return s[263]=0,void(s[266]=0)}if(s[266]==(0|a))return s[266]=n,e=s[263]+e|0,s[263]=e,s[n+4>>2]=1|e,void(s[e+n>>2]=e);e=(-8&r)+e|0;r:if(r>>>0<=255){if(r>>>=3,(0|(t=s[a+8>>2]))==(0|(i=s[a+12>>2]))){c=1044,d=s[261]&E(r),s[c>>2]=d;break r}s[t+12>>2]=i,s[i+8>>2]=t}else{if(l=s[a+24>>2],(0|a)==(0|(r=s[a+12>>2])))if((t=s[(i=a+20|0)>>2])||(t=s[(i=a+16|0)>>2])){for(;o=i,(t=s[(i=(r=t)+20|0)>>2])||(i=r+16|0,t=s[r+16>>2]););s[o>>2]=0}else r=0;else t=s[a+8>>2],s[t+12>>2]=r,s[r+8>>2]=t;if(l){i=s[a+28>>2];n:{if(s[(t=1348+(i<<2)|0)>>2]==(0|a)){if(s[t>>2]=r,r)break n;c=1048,d=s[262]&E(i),s[c>>2]=d;break r}if(s[l+(s[l+16>>2]==(0|a)?16:20)>>2]=r,!r)break r}s[r+24>>2]=l,(t=s[a+16>>2])&&(s[r+16>>2]=t,s[t+24>>2]=r),(t=s[a+20>>2])&&(s[r+20>>2]=t,s[t+24>>2]=r)}}if(s[n+4>>2]=1|e,s[e+n>>2]=e,s[266]!=(0|n))break t;return void(s[263]=e)}s[a+4>>2]=-2&r,s[n+4>>2]=1|e,s[e+n>>2]=e}if(e>>>0<=255)return r=1084+((e>>>=3)<<3)|0,(t=s[261])&(e=1<<e)?e=s[r+8>>2]:(s[261]=e|t,e=r),s[r+8>>2]=n,s[e+12>>2]=n,s[n+12>>2]=r,void(s[n+8>>2]=e);s[n+16>>2]=0,s[n+20>>2]=0,t=0,(i=e>>>8)&&(t=31,e>>>0>16777215||(t=i,t<<=i=i+1048320>>>16&8,t=28+((t=((t<<=l=t+520192>>>16&4)<<(o=t+245760>>>16&2)>>>15)-(o|i|l)|0)<<1|e>>>t+21&1)|0)),s[(r=n)+28>>2]=t,o=1348+(t<<2)|0;t:if((i=s[262])&(r=1<<t)){i=e<<(31==(0|t)?0:25-(t>>>1)|0),r=s[o>>2];r:{for(;;){if(t=r,(-8&s[r+4>>2])==(0|e))break r;if(r=i>>>29,i<<=1,!(r=s[16+(o=t+(4&r)|0)>>2]))break}s[o+16>>2]=n,s[n+12>>2]=n,s[n+24>>2]=t,s[n+8>>2]=n;break t}e=s[t+8>>2],s[e+12>>2]=n,s[t+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=t,s[n+8>>2]=e}else s[262]=r|i,s[o>>2]=n,s[n+12>>2]=n,s[n+24>>2]=o,s[n+8>>2]=n;if(e=s[269]+-1|0,s[269]=e,!e){for(n=1500;n=(e=s[n>>2])+8|0,e;);s[269]=-1}}}}function b(e){var t,r=0;return u[e+20>>2]<=u[e+28>>2]||(a[s[e+36>>2]](e,0,0),s[e+20>>2])?((r=s[e+4>>2])>>>0<(t=s[e+8>>2])>>>0&&(r=r-t|0,a[s[e+40>>2]](e,r,r>>31,1)),s[e+28>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,0):-1}function _(e){for(var t=0,r=0;r=t,e;)e&=e-1,t=t+1|0;return r}function E(e){var t;return(-1>>>(t=31&e)&-2)<<t|(-1<<(e=0-e&31)&-2)>>>e}function T(){return n.byteLength/65536|0}return{__wasm_call_ctors:function(){},malloc:g,openBox:function(e,t){e|=0,t|=0;var r,n,i,a=0;return y=r=y-16|0,s[r+12>>2]=0,s[r+8>>2]=0,s[r+4>>2]=0,s[r>>2]=0,function(e,t,r,n,i,a){var u=0,c=0,d=0,h=0,f=0,p=0;if(u=(l[e+2|0]^l[e+1|0]^l[0|e])<<24>>24,s[a>>2]=u+-48,u=47+(t-u|0)|0,s[n>>2]=u,f=r,p=g(u),s[f>>2]=p,c=s[a>>2],d=g(c),s[i>>2]=d,(0|c)>0)for(u=c;;){if(d=(c-u|0)+d|0,c=(t-c|0)+e|0,o[0|d]=l[(t-u|0)+e|0]^l[c+-1|0]^l[c+-2|0],(0|(u=u+-1|0))<1){u=s[n>>2];break}d=s[i>>2],c=s[a>>2]}if((0|u)>0)for(;t=s[r>>2]+h|0,h=h+1|0,o[0|t]=l[h+e|0],(0|h)<s[n>>2];);}(e,t,r+12|0,r+4|0,r+8|0,r),function(e,t){var r=0,n=0,i=0,a=0,s=0,u=0,c=0;if((0|t)>=1)for(i=85,a=250;n=_(r),s=l[0|(u=e+r|0)],c=n,n=1&r,o[0|u]=c+(21+((s^(n?i:a))<<24>>24)|0),a=n?a:s,i=n?s:i,(0|(r=r+1|0))!=(0|t););}(e=s[r+12>>2],t=s[r+4>>2]),n=function(e){var t=0;return(255&(t=e+-48|0))>>>0<=9?t<<24>>24:((e+-97&255)>>>0<26?e+-87|0:-1)<<24>>24}(o[0|e]),s[r>>2]=n,i=g(a=t-n|0),o[i+(a=a+-1|0)|0]=0,(0|a)>=1&&function(e,t,r){var n,i=0;if(r>>>0>=8192)d(0|e,0|t,0|r);else{n=e+r|0;e:if(3&(e^t))if(n>>>0<4)r=e;else if((i=n+-4|0)>>>0<e>>>0)r=e;else for(r=e;o[0|r]=l[0|t],o[r+1|0]=l[t+1|0],o[r+2|0]=l[t+2|0],o[r+3|0]=l[t+3|0],t=t+4|0,(r=r+4|0)>>>0<=i>>>0;);else{t:if((0|r)<1)r=e;else if(3&e)for(r=e;;){if(o[0|r]=l[0|t],t=t+1|0,(r=r+1|0)>>>0>=n>>>0)break t;if(!(3&r))break}else r=e;if(!((e=-4&n)>>>0<64||r>>>0>(i=e+-64|0)>>>0))for(;s[r>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],s[r+8>>2]=s[t+8>>2],s[r+12>>2]=s[t+12>>2],s[r+16>>2]=s[t+16>>2],s[r+20>>2]=s[t+20>>2],s[r+24>>2]=s[t+24>>2],s[r+28>>2]=s[t+28>>2],s[r+32>>2]=s[t+32>>2],s[r+36>>2]=s[t+36>>2],s[r+40>>2]=s[t+40>>2],s[r+44>>2]=s[t+44>>2],s[r+48>>2]=s[t+48>>2],s[r+52>>2]=s[t+52>>2],s[r+56>>2]=s[t+56>>2],s[r+60>>2]=s[t+60>>2],t=t- -64|0,(r=r- -64|0)>>>0<=i>>>0;);if(r>>>0>=e>>>0)break e;for(;s[r>>2]=s[t>>2],t=t+4|0,(r=r+4|0)>>>0<e>>>0;);}if(r>>>0<n>>>0)for(;o[0|r]=l[0|t],t=t+1|0,(0|n)!=(0|(r=r+1|0)););}}(i,e+1|0,t+(-1^n)|0),v(e),v(s[r+8>>2]),y=r+16|0,0|i},free:v,__errno_location:function(){return 1024},fflush:function e(t){var r=0;if(t|=0)return s[t+76>>2],0|b(t);if(s[260]&&(r=e(s[260])),p(1028),t=s[259])for(;u[t+20>>2]>u[t+28>>2]&&(r=b(t)|r),t=s[t+56>>2];);return f(1028),0|r},setThrew:function(e,t){e|=0,t|=0,s[385]||(s[386]=t,s[385]=e)},stackSave:function(){return 0|y},stackAlloc:function(e){return y=e=y-(e|=0)&-16,0|e},stackRestore:function(e){y=e|=0},__growWasmMemory:function(t){return 0|function(t){t|=0;var r=0|T(),a=r+t|0;if(r<a&&a<65536){var d=new ArrayBuffer(c(a,65536)),h=new e.Int8Array(d);h.set(o),o=h,o=new e.Int8Array(d),new e.Int16Array(d),s=new e.Int32Array(d),l=new e.Uint8Array(d),new e.Uint16Array(d),u=new e.Uint32Array(d),new e.Float32Array(d),new e.Float64Array(d),n=d,i.buffer=d}return r}(0|(t|=0))}}}({Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,Math:Math},Y,d.buffer));return{exports:n}},instantiate:function(e,t){return{then:function(r,n){r({instance:new h.Instance(new h.Module(e,t))})}}},RuntimeError:Error};s=[],"object"!==_typeof$3(h)&&Z("No WebAssembly support found. Build with -s WASM=0 to target JavaScript instead.");var f=new h.Table({initial:1,maximum:1,element:"anyfunc"}),p=!1;function y(e,t){e||Z("Assertion failed: "+t)}var m="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function g(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;s>=2097152&&c("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to an UTF-8 string on the asm.js/wasm heap! (Valid unicode code points should be in range 0-0x1FFFFF)."),t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function v(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var b,_,E,T,S;function $(e,t){return e%t>0&&(e+=t-e%t),e}function A(e){b=e,i.HEAP8=_=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=T=new Int32Array(e),i.HEAPU8=E=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=S=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}var w=1712;y(!0,"stack must start aligned"),y(!0,"heap must start aligned");var k=8192;i.TOTAL_STACK&&y(k===i.TOTAL_STACK,"the stack size can no longer be determined at runtime");var I=i.TOTAL_MEMORY||65536;function C(){y(!0),S[429]=34821223,S[430]=2310721022,T[0]=1668509029}function P(){var e=S[429],t=S[430];34821223==e&&2310721022==t||Z("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x02135467, but received 0x"+t.toString(16)+" "+e.toString(16)),1668509029!==T[0]&&Z("Runtime error: The application has corrupted its heap memory area (address zero)!")}function x(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?i.dynCall_v(r):i.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}Object.getOwnPropertyDescriptor(i,"TOTAL_MEMORY")||Object.defineProperty(i,"TOTAL_MEMORY",{configurable:!0,get:function(){Z("Module.TOTAL_MEMORY has been replaced with plain INITIAL_TOTAL_MEMORY")}}),y(I>=k,"TOTAL_MEMORY should be larger than TOTAL_STACK, was "+I+"! (TOTAL_STACK="+"8192)"),y("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&void 0!==Int32Array.prototype.subarray&&void 0!==Int32Array.prototype.set,"JS engine does not provide full typed array support"),(d=i.wasmMemory?i.wasmMemory:new h.Memory({initial:I/65536}))&&(b=d.buffer),y((I=b.byteLength)%65536==0),A(b),T[388]=9904,function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian!"}();var R=[],O=[],L=[],D=[],M=!1;y(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),y(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),y(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),y(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var N=0,G=null,V=null,U={};function Z(t){i.onAbort&&i.onAbort(t),l(t+=""),u(t),p=!0;var r="abort("+t+") at "+function(){var t=function(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}();i.extraStackTrace&&(t+="\n"+i.extraStackTrace());return r=t,n=/\b_Z[\w\d_]+/g,r.replace(n,(function(e){var t,r=(t=e,c("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),t);return e===r?e:r+" ["+e+"]"}));var r,n}();throw t=r,new h.RuntimeError(t)}i.preloadedImages={},i.preloadedAudios={};var B={error:function(){Z("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with  -s FORCE_FILESYSTEM=1")},init:function(){B.error()},createDataFile:function(){B.error()},createPreloadedFile:function(){B.error()},createLazyFile:function(){B.error()},open:function(){B.error()},mkdev:function(){B.error()},registerDevice:function(){B.error()},analyzePath:function(){B.error()},loadFilesFromDB:function(){B.error()},ErrnoError:function(){B.error()}};i.FS_createDataFile=B.createDataFile,i.FS_createPreloadedFile=B.createPreloadedFile;var F="data:application/octet-stream;base64,";function j(e){return String.prototype.startsWith?e.startsWith(F):0===e.indexOf(F)}var W,X="aw.wasm";function H(){try{if(s)return new Uint8Array(s);var e=function(e){if(!j(e))return;return function(e){try{for(var t=K(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(F.length))}(X);if(e)return e;throw"both async and sync fetching of the wasm failed"}catch(t){Z(t)}}j(X)||(W=X,X=i.locateFile?i.locateFile(W,o):o+W),O.push({func:function(){le()}});var K="function"==typeof atob?atob:function(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(u++))<<2|(i=s.indexOf(e.charAt(u++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(u++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(r)),64!==o&&(l+=String.fromCharCode(n))}while(u<e.length);return l};var Y={__lock:function(){},__unlock:function(){},emscripten_memcpy_big:function(e,t,r){E.set(E.subarray(t,t+r),e)},emscripten_resize_heap:function(t){var r=_.length;y(t>r);var n=65536,i=2147418112;if(t>i)return u("Cannot enlarge memory, asked to go up to "+t+" bytes, but the limit is "+i+" bytes!"),!1;for(var a=Math.max(r,16777216);a<t;)(a=a<=536870912?$(2*a,n):Math.min($((3*a+2147483648)/4,n),i))===r&&c("Cannot ask for more memory since we reached the practical limit in browsers (which is just below 2GB), so the request would have failed. Requesting only "+_.length);var o=function(t){try{return d.grow(t-b.byteLength+65535>>16),A(d.buffer),1}catch(e){console.error("emscripten_realloc_buffer: Attempted to grow heap from "+b.byteLength+" bytes to "+t+" bytes, but got error: "+e)}}(a);return o?(u("Warning: Enlarging memory arrays, this is not fast! "+[r,a]),!0):(u("Failed to grow the heap from "+r+" bytes to "+a+" bytes, not enough memory!"),!1)},memory:d,table:f},z=function(){var t,r={env:Y,wasi_unstable:Y};function n(e,t){var r=e.exports;i.asm=r,function(e){if(N--,i.monitorRunDependencies&&i.monitorRunDependencies(N),e?(y(U[e]),delete U[e]):u("warning: run dependency removed without ID"),0==N&&(null!==G&&(clearInterval(G),G=null),V)){var t=V;V=null,t()}}("wasm-instantiate")}t="wasm-instantiate",N++,i.monitorRunDependencies&&i.monitorRunDependencies(N),t?(y(!U[t]),U[t]=1,null===G&&"undefined"!=typeof setInterval&&(G=setInterval((function(){if(p)return clearInterval(G),void(G=null);var e=!1;for(var t in U)e||(e=!0,u("still waiting on run dependencies:")),u("dependency: "+t);e&&u("(end of list)")}),1e4))):u("warning: run dependency added without ID");var a=i;function o(e){y(i===a,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),a=null,n(e.instance)}function l(e){return(s||"function"!=typeof fetch?new Promise((function(e,t){e(H())})):fetch(X,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+X+"'";return e.arrayBuffer()})).catch((function(){return H()}))).then((function(e){return h.instantiate(e,r)})).then(e,(function(e){u("failed to asynchronously prepare wasm: "+e),Z(e)}))}if(i.instantiateWasm)try{return i.instantiateWasm(r,n)}catch(e){return u("Module.instantiateWasm callback failed with error: "+e),!1}return function(){if(s||"function"!=typeof h.instantiateStreaming||j(X)||"function"!=typeof fetch)return l(o);fetch(X,{credentials:"same-origin"}).then((function(e){return h.instantiateStreaming(e,r).then(o,(function(e){u("wasm streaming compile failed: "+e),u("falling back to ArrayBuffer instantiation"),l(o)}))}))}(),{}}(),J=z.__wasm_call_ctors;z.__wasm_call_ctors=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),J.apply(null,arguments)};var Q=z.malloc;z.malloc=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),Q.apply(null,arguments)};var q=z.openBox;z.openBox=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),q.apply(null,arguments)};var ee=z.free;z.free=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ee.apply(null,arguments)};var te=z.__errno_location;z.__errno_location=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),te.apply(null,arguments)};var re=z.fflush;z.fflush=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),re.apply(null,arguments)};var ne=z.setThrew;z.setThrew=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ne.apply(null,arguments)};var ie=z.stackSave;z.stackSave=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ie.apply(null,arguments)};var ae=z.stackAlloc;z.stackAlloc=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),ae.apply(null,arguments)};var oe=z.stackRestore;z.stackRestore=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),oe.apply(null,arguments)};var se=z.__growWasmMemory;z.__growWasmMemory=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),se.apply(null,arguments)},i.asm=z;var le=i.___wasm_call_ctors=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.__wasm_call_ctors.apply(null,arguments)},ue=i._malloc=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.malloc.apply(null,arguments)};i._openBox=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.openBox.apply(null,arguments)},i._free=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.free.apply(null,arguments)},i.___errno_location=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.__errno_location.apply(null,arguments)},i._fflush=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.fflush.apply(null,arguments)},i._setThrew=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.setThrew.apply(null,arguments)};var ce=i.stackSave=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.stackSave.apply(null,arguments)};i.stackAlloc=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.stackAlloc.apply(null,arguments)},i.stackRestore=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.stackRestore.apply(null,arguments)};var de,he=i.__growWasmMemory=function(){return y(M,"you need to wait for the runtime to be ready (e.g. wait for main() to be called)"),y(!0,"the runtime was exited (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),i.asm.__growWasmMemory.apply(null,arguments)};function fe(e){function t(){de||(de=!0,p||(P(),y(!M),M=!0,x(O),P(),x(L),i.onRuntimeInitialized&&i.onRuntimeInitialized(),y(!i._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(P(),i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),D.unshift(e);var e;x(D)}()))}N>0||(C(),function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),R.unshift(e);var e;x(R)}(),N>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t(),P()))}if(i.asm=z,i.intArrayFromString=function(e,t,r){var n=r>0?r:v(e)+1,i=new Array(n),a=g(e,i,0,i.length);return t&&(i.length=a),i},Object.getOwnPropertyDescriptor(i,"intArrayToString")||(i.intArrayToString=function(){Z("'intArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"ccall")||(i.ccall=function(){Z("'ccall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"cwrap")||(i.cwrap=function(){Z("'cwrap' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"setValue")||(i.setValue=function(){Z("'setValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getValue")||(i.getValue=function(){Z("'getValue' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"allocate")||(i.allocate=function(){Z("'allocate' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getMemory")||(i.getMemory=function(){Z("'getMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"AsciiToString")||(i.AsciiToString=function(){Z("'AsciiToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToAscii")||(i.stringToAscii=function(){Z("'stringToAscii' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"UTF8ArrayToString")||(i.UTF8ArrayToString=function(){Z("'UTF8ArrayToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.UTF8ToString=function(e,t){return e?function(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&m)return m.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if(224==(240&o)?o=(15&o)<<12|s<<6|l:(240!=(248&o)&&c("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string on the asm.js/wasm heap to a JS string!"),o=(7&o)<<18|s<<12|l<<6|63&e[t++]),o<65536)a+=String.fromCharCode(o);else{var u=o-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}(E,e,t):""},Object.getOwnPropertyDescriptor(i,"stringToUTF8Array")||(i.stringToUTF8Array=function(){Z("'stringToUTF8Array' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToUTF8")||(i.stringToUTF8=function(){Z("'stringToUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"lengthBytesUTF8")||(i.lengthBytesUTF8=function(){Z("'lengthBytesUTF8' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"UTF16ToString")||(i.UTF16ToString=function(){Z("'UTF16ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToUTF16")||(i.stringToUTF16=function(){Z("'stringToUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"lengthBytesUTF16")||(i.lengthBytesUTF16=function(){Z("'lengthBytesUTF16' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"UTF32ToString")||(i.UTF32ToString=function(){Z("'UTF32ToString' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stringToUTF32")||(i.stringToUTF32=function(){Z("'stringToUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"lengthBytesUTF32")||(i.lengthBytesUTF32=function(){Z("'lengthBytesUTF32' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.allocateUTF8=function(e){var t=v(e)+1,r=ue(t);return r&&g(e,_,r,t),r},Object.getOwnPropertyDescriptor(i,"stackTrace")||(i.stackTrace=function(){Z("'stackTrace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnPreRun")||(i.addOnPreRun=function(){Z("'addOnPreRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnInit")||(i.addOnInit=function(){Z("'addOnInit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnPreMain")||(i.addOnPreMain=function(){Z("'addOnPreMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnExit")||(i.addOnExit=function(){Z("'addOnExit' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addOnPostRun")||(i.addOnPostRun=function(){Z("'addOnPostRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"writeStringToMemory")||(i.writeStringToMemory=function(){Z("'writeStringToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"writeArrayToMemory")||(i.writeArrayToMemory=function(){Z("'writeArrayToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"writeAsciiToMemory")||(i.writeAsciiToMemory=function(){Z("'writeAsciiToMemory' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addRunDependency")||(i.addRunDependency=function(){Z("'addRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"removeRunDependency")||(i.removeRunDependency=function(){Z("'removeRunDependency' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"ENV")||(i.ENV=function(){Z("'ENV' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"FS")||(i.FS=function(){Z("'FS' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"FS_createFolder")||(i.FS_createFolder=function(){Z("'FS_createFolder' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createPath")||(i.FS_createPath=function(){Z("'FS_createPath' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createDataFile")||(i.FS_createDataFile=function(){Z("'FS_createDataFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createPreloadedFile")||(i.FS_createPreloadedFile=function(){Z("'FS_createPreloadedFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createLazyFile")||(i.FS_createLazyFile=function(){Z("'FS_createLazyFile' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createLink")||(i.FS_createLink=function(){Z("'FS_createLink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_createDevice")||(i.FS_createDevice=function(){Z("'FS_createDevice' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"FS_unlink")||(i.FS_unlink=function(){Z("'FS_unlink' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}),Object.getOwnPropertyDescriptor(i,"GL")||(i.GL=function(){Z("'GL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"dynamicAlloc")||(i.dynamicAlloc=function(){Z("'dynamicAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"loadDynamicLibrary")||(i.loadDynamicLibrary=function(){Z("'loadDynamicLibrary' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"loadWebAssemblyModule")||(i.loadWebAssemblyModule=function(){Z("'loadWebAssemblyModule' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getLEB")||(i.getLEB=function(){Z("'getLEB' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getFunctionTables")||(i.getFunctionTables=function(){Z("'getFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"alignFunctionTables")||(i.alignFunctionTables=function(){Z("'alignFunctionTables' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"registerFunctions")||(i.registerFunctions=function(){Z("'registerFunctions' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"addFunction")||(i.addFunction=function(){Z("'addFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"removeFunction")||(i.removeFunction=function(){Z("'removeFunction' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getFuncWrapper")||(i.getFuncWrapper=function(){Z("'getFuncWrapper' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"prettyPrint")||(i.prettyPrint=function(){Z("'prettyPrint' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"makeBigInt")||(i.makeBigInt=function(){Z("'makeBigInt' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"dynCall")||(i.dynCall=function(){Z("'dynCall' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getCompilerSetting")||(i.getCompilerSetting=function(){Z("'getCompilerSetting' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stackSave")||(i.stackSave=function(){Z("'stackSave' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stackRestore")||(i.stackRestore=function(){Z("'stackRestore' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"stackAlloc")||(i.stackAlloc=function(){Z("'stackAlloc' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"establishStackSpace")||(i.establishStackSpace=function(){Z("'establishStackSpace' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"print")||(i.print=function(){Z("'print' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"printErr")||(i.printErr=function(){Z("'printErr' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"getTempRet0")||(i.getTempRet0=function(){Z("'getTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"setTempRet0")||(i.setTempRet0=function(){Z("'setTempRet0' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"callMain")||(i.callMain=function(){Z("'callMain' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"abort")||(i.abort=function(){Z("'abort' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.Pointer_stringify=function(e,t){Z("this function has been removed - you should use UTF8ToString(ptr, maxBytesToRead) instead!")},Object.getOwnPropertyDescriptor(i,"warnOnce")||(i.warnOnce=function(){Z("'warnOnce' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),i.writeStackCookie=C,i.checkStackCookie=P,i.abortStackOverflow=function(e){Z("Stack overflow! Attempted to allocate "+e+" bytes on the stack, but stack has only "+(w-ce()+e)+" bytes available!")},Object.getOwnPropertyDescriptor(i,"intArrayFromBase64")||(i.intArrayFromBase64=function(){Z("'intArrayFromBase64' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"tryParseAsDataURI")||(i.tryParseAsDataURI=function(){Z("'tryParseAsDataURI' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}),Object.getOwnPropertyDescriptor(i,"ALLOC_NORMAL")||Object.defineProperty(i,"ALLOC_NORMAL",{configurable:!0,get:function(){Z("'ALLOC_NORMAL' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"ALLOC_STACK")||Object.defineProperty(i,"ALLOC_STACK",{configurable:!0,get:function(){Z("'ALLOC_STACK' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"ALLOC_DYNAMIC")||Object.defineProperty(i,"ALLOC_DYNAMIC",{configurable:!0,get:function(){Z("'ALLOC_DYNAMIC' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"ALLOC_NONE")||Object.defineProperty(i,"ALLOC_NONE",{configurable:!0,get:function(){Z("'ALLOC_NONE' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ)")}}),Object.getOwnPropertyDescriptor(i,"calledRun")||Object.defineProperty(i,"calledRun",{configurable:!0,get:function(){Z("'calledRun' was not exported. add it to EXTRA_EXPORTED_RUNTIME_METHODS (see the FAQ). Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you")}}),i.then=function(e){if(de)e(i);else{var t=i.onRuntimeInitialized;i.onRuntimeInitialized=function(){t&&t(),e(i)}}return i},V=function e(){de||fe(),de||(V=e)},i.run=fe,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return fe(),r}}(),AwManager=function(){function e(t,r){_classCallCheck$7(this,e),this.cdnHost=t,this.cdnBucket=r}return _createClass$8(e,[{key:"init",value:function(){var e=new ProxyPromise;this.module={onRuntimeInitialized:function(){e.resolve()},onAbort:function(t){e.reject(t)}},this.cdnHost&&(this.module.cdnHost=this.cdnHost);var t=this.cdnBucket?"-".concat(this.cdnBucket):"";return this.module.cdnBucket="media-fe".concat(t),aw(this.module),e}},{key:"openBox",value:function(e){try{var t=window.atob(e),r=util.str2hex(t),n=this.module._malloc(Number(r.length));this.module.HEAP8.set(r,n);var i=this.module._openBox(Number(n),r.length),a=this.module.UTF8ToString(i);return this.module._free(n),a}catch(error){}}},{key:"destroy",value:function(){this.module=null}}]),e}(),ArrayBufferViewCore$4=arrayBufferViewCore$1,TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS=typedArrayConstructorsRequireWrappers$1,aTypedArrayConstructor=ArrayBufferViewCore$4.aTypedArrayConstructor,exportTypedArrayStaticMethod=ArrayBufferViewCore$4.exportTypedArrayStaticMethod;function isMSBrowser(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),r=e.indexOf("Trident/");return t>0||r>0}function checkIsQihuBrowser(){var e=navigator.mimeTypes,t=navigator.userAgent,r=!1;return e&&t.indexOf("Chrome")>1&&(r=Object.keys(e).some((function(t){return!!(e[t].type&&e[t].type.indexOf("360")>-1)||(!!(e[t].type&&e[t].type.indexOf("application/vnd.chromium.remoting-viewer")>-1)||!!(e[t].description&&e[t].description.indexOf("360")>-1))}))),r}function isEMESupported(){var e,t,r,n,i;return!(!navigator.requestMediaKeySystemAccess||(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=isMSBrowser(),r=checkIsQihuBrowser(),n=navigator.userAgent.indexOf("Firefox")>0,i=navigator.userAgent.indexOf("Edge")>0,e||t||r||n||i))}function isWebAssemblySupported(){try{if("object"===("undefined"==typeof WebAssembly?"undefined":_typeof$3(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(e){console.log(e)}return!1}function isMediaSourceSupported(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}function isSupported(){return isMediaSourceSupported()&&isWebAssemblySupported()&&!isMSBrowser()}function isSupportedWithXgmse(){return isWebAssemblySupported()&&!isMSBrowser()}exportTypedArrayStaticMethod("of",(function(){for(var e=0,t=arguments.length,r=new(aTypedArrayConstructor(this))(t);t>e;)r[e]=arguments[e++];return r}),TYPED_ARRAYS_CONSTRUCTORS_REQUIRES_WRAPPERS);var Timer=function(){function e(t){_classCallCheck$7(this,e),this.onTick_=t,this.cancelPending_=null}return _createClass$8(e,[{key:"tickAfter",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.stop();var n=!0,i=null;this.cancelPending_=function(){window.clearTimeout(i),n=!1};var a=function(){n&&(t.onTick_(),r&&r())};return i=window.setTimeout(a,1e3*e),this}},{key:"tickEvery",value:function(e){var t=this;this.tickAfter(e,(function(){t.tickEvery(e)}))}},{key:"stop",value:function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)}}]),e}(),PRELOAD_NEXT="PRELOAD_NEXT",PRELOAD_SEG_DONE="PRELOAD_SEG_DONE",STATES={PREPARE:"PREPARE",IDLE:"IDLE",PRELOADING:"PRELOADING",FINISH:"FINISH"},ONE_STEP_DONE="ONE_STEP_DONE",PRELOAD_TYPES$1={DURATION:0,SIZE:1},CACHE_TYPES={INDEXDB:0,MEMORY:1},DOWN_STATES={FAIL:-1,SUCCESS:0,DOWNLOADING:1},VTYPES$1={MP4:"MP4",DASH:"DASH",HLS:"HLS"};function _typeof$1(e){return(_typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck$2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$3(e,t,r){return t&&_defineProperties$3(e.prototype,t),r&&_defineProperties$3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var RETRY_MAX=10,PRELOADER=function(){function e(t,r,n,i,a){_classCallCheck$2(this,e),EventEmitter(this),this.state=STATES.PREPARE,this.options=t||{},this.logger=t.logger||function(){},this._preloadManager=r,this.player=r.player;var o=n.handlers,s=n.predictInst,l=n.readyPromise;this._predictInst=s,this._handlers=o,this._predictInstReadyPromise=l,this._toLoadList=[],this.retryCount=0,this._cachedHandler=i,this._cachedDataHanlder=a,this.cnt=0}return _createClass$3(e,[{key:"start",value:function(){var e=this,t=new ProxyPromise$1;return this._handlers.start(this.options).then((function(r){r.onObtain().then((function(n){e._predictInstReadyPromise.then((function(){e._predictInst.updateMediaInfos(n);var i=e._predictInst.preloadPredict(e.options),a=e._predictInst.cachedData;e._cachedDataHanlder(Object.assign({vid:e.options.vid},{data:a}));var o=Object.assign(i,e.options);r.onTransform(o).then((function(r){e._toLoadList=r,t.resolve(r)}))}))}))})).catch((function(e){t.reject(new Error("preload unit start error"))})),t}},{key:"preloadSeg",value:function(){var e=this;if(0===this._toLoadList.length)return this.state=STATES.FINISH,void this.emit(PRELOAD_SEG_DONE,!0);this.state="PRELOADING";var t=this._toLoadList.shift();this._handlers.onRequest(t,(function(r){var n=Object.assign({},t.extData,r);e._cachedHandler(n)})).then((function(){e.state=STATES.IDLE,e.emit(PRELOAD_SEG_DONE)})).catch((function(t){e.requestError(),e.emit(PRELOAD_SEG_DONE,!1)}))}},{key:"requestError",value:function(){this.retryCount++,this.state=STATES.IDLE,this.retryCount>=RETRY_MAX&&(this.state=STATES.FINISH),this.emit(ONE_STEP_DONE),this.logger("preload request error")}},{key:"cancelLoading",value:function(){this._toLoadList=[]}},{key:"destroy",value:function(){allOff(this)}}]),e}();function getIDB(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){}}var idb=getIDB();function isIndexedDBValid(){try{if(!idb||!idb.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||r)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function executeCallback(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function executeTwoCallbacks(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function normalizeKey(e){return"string"!=typeof e&&(console.warn("".concat(e," used as a key, but it is not a string.")),e=String(e)),e}var dbContexts={},READ_ONLY="readonly",READ_WRITE="readwrite";function _deferReadiness(e){var t=dbContexts[e.name],r={};r.promise=new Promise((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function _advanceReadiness(e){var t=dbContexts[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _rejectReadiness(e,t){var r=dbContexts[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function _getConnection(e,t){return new Promise((function(r,n){if(dbContexts[e.name]=dbContexts[e.name]||createDbContext(),e.db){if(!t)return r(e.db);_deferReadiness(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=idb.open.apply(idb,i);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){r(a.result),_advanceReadiness(e)}}))}function _getOriginalConnection(e){return _getConnection(e,!1)}function _getUpgradedConnection(e){return _getConnection(e,!0)}function _isUpgradeNeeded(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function _tryReconnect(e){_deferReadiness(e);for(var t=dbContexts[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,_getOriginalConnection(e).then((function(t){return e.db=t,_isUpgradeNeeded(e)?_getUpgradedConnection(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(t){throw _rejectReadiness(e,t),t}))}function createTransaction(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(a){if(n>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return Promise.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_getUpgradedConnection(e)})).then((function(){return _tryReconnect(e).then((function(){createTransaction(e,t,r,n-1)}))})).catch(r);r(a)}}function createDbContext(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}var AsyncStorage=function(){function t(){_classCallCheck$2(this,t)}return _createClass$3(t,[{key:"ready",value:function(){return this._ready}},{key:"_initStorage",value:function(e){var t=this;t._defaultConfig=e;var r={db:null};if(e)for(var n in e)r[n]=e[n];var i=dbContexts[r.name];i||(i=createDbContext(),dbContexts[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=t._fullyReady);var a=[];function o(){return Promise.resolve()}for(var s=0;s<i.forages.length;s++){var l=i.forages[s];l!==t&&a.push(l._initReady().catch(o))}var u=i.forages.slice(0);return t._ready=Promise.all(a).then((function(){return r.db=i.db,_getOriginalConnection(r)})).then((function(e){return r.db=e,_isUpgradeNeeded(r,t._defaultConfig.version)?_getUpgradedConnection(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<u.length;n++){var a=u[n];a!==t&&(a._dbInfo.db=r.db,a._dbInfo.version=r.version)}})),t._ready}},{key:"probeSupport",get:function(){return isIndexedDBValid()}},{key:"getItem",value:function(t,r){var n=this;t=normalizeKey(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction(n._dbInfo,READ_ONLY,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).get(t);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),r(e)},s.onerror=function(){i(s.error)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback(i,r),i}},{key:"setItem",value:function(t,r,n){var i=this;t=normalizeKey(t);var a=new Promise((function(n,a){i.ready().then((function(){return i._dbInfo,r})).then((function(r){createTransaction(i._dbInfo,READ_WRITE,(function(o,s){if(o)return a(o);try{var l=s.objectStore(i._dbInfo.storeName);null===r&&(r=void 0);var u=l.put(r,t);s.oncomplete=function(){void 0===r&&(r=null),n(r)},s.onabort=s.onerror=function(){var e=u.error?u.error:u.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return executeCallback(a,n),a}},{key:"removeItem",value:function(t,r){var n=this;t=normalizeKey(t);var i=new Promise((function(r,i){n.ready().then((function(){createTransaction(n._dbInfo,READ_WRITE,(function(a,o){if(a)return i(a);try{var s=o.objectStore(n._dbInfo.storeName).delete(t);o.oncomplete=function(){r()},o.onerror=function(){i(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return executeCallback(i,r),i}},{key:"clear",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction(r._dbInfo,READ_WRITE,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).clear();a.oncomplete=function(){t()},a.onabort=a.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback(n,t),n}},{key:"length",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction(r._dbInfo,READ_ONLY,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback(n,t),n}},{key:"all",value:function(t){var r=this,n=new Promise((function(t,n){r.ready().then((function(){createTransaction(r._dbInfo,READ_ONLY,(function(i,a){if(i)return n(i);try{var o=a.objectStore(r._dbInfo.storeName).openCursor(),s=[];o.onsuccess=function(){var e=o.result;e?(s.push({key:e.key,value:e.value}),e.continue()):t(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return executeCallback(n,t),n}},{key:"_fullyReady",value:function(e){var t=this,r=t._initReady().then((function(){var e=dbContexts[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return executeTwoCallbacks(r,e,e),r}}]),t}(),MemoryCache=function(){function e(){_classCallCheck$2(this,e)}return _createClass$3(e,[{key:"_initStorage",value:function(e){var t=e.name+"_"+e.storeName;return this.key=t,window[t]&&"object"===_typeof$1(window[t])||(window[t]={}),this.store=window[t],Promise.resolve()}},{key:"getItem",value:function(e,t){var r=this.store[e];return void 0===r&&(r=null),this._internalPromise(t,r)}},{key:"setItem",value:function(e,t,r){return this.store[e]=t,this._internalPromise(r)}},{key:"removeItem",value:function(e,t){return delete this.store[e],this._internalPromise(t)}},{key:"clear",value:function(e){return this.store={},window[this.key]={},this._internalPromise(e)}},{key:"length",value:function(e){var t=Object.keys(this.store).length;return this._internalPromise(e,t)}},{key:"_internalPromise",value:function(e,t){var r=t?Promise.resolve(t):Promise.resolve();return executeCallback(r,e),r}},{key:"all",value:function(e){for(var t=[],r=Object.keys(this.store),n=0;n<r.length;n++){var i=r[n];t.push({key:i,value:this.store[i]})}return this._internalPromise(e,t)}},{key:"probeSupport",value:function(){return!0}}]),e}(),DefaultConfig={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},SPLIT="|",SESSION_KEY="__PRE_CACHE__KEYS",TIMESPLIT="$",MAX_CACHE=200,PreloadCache=function(){function e(t,r){_classCallCheck$2(this,e);var n=r===CACHE_TYPES.MEMORY?MemoryCache:AsyncStorage;this._driver=new n,this._driver._initStorage(DefaultConfig).catch((function(){})),this._hasIdbForbidden=!1,this._maxCache=!t||t<=0?MAX_CACHE:t,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new ProxyPromise$1,this.init()}return _createClass$3(e,[{key:"getCachedKeysFromLocal",value:function(){var e=proxyLocalStorage$1.getItem(SESSION_KEY);if(e)for(var t=e.split(SPLIT),r=0;r<t.length;r++){var n=t[r],i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a}}},{key:"_getCacheKeyInfos",value:function(e){var t,r=e.split(TIMESPLIT);return 2===r.length&&(t=r[0],e=r[1]),{time:t,cachedKey:e}}},{key:"writeCachedKeysToLocal",value:function(e){var t=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(var r=0;r<e.length;r++){var n=e[r].key,i=this._getCacheKeyInfos(n),a=i.time,o=i.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=a,t.push(n)}var s=t.join(SPLIT);proxyLocalStorage$1.setItem(SESSION_KEY,s)}},{key:"init",value:function(){var e=this;this._driver.setItem("test","test").then((function(){})).catch((function(){e._hasIdbForbidden=!0})).finally((function(){e._driver.removeItem("test").catch((function(){})),e._hasIdbForbidden&&(e._driver=new MemoryCache,e._driver._initStorage(DefaultConfig)),e._getAll(),e._readyPromise.resolve()}))}},{key:"_getAll",value:function(){var e=this;this._driver.all().then((function(t){e._cachedLength=t.length;var r=t.length-e._maxCache,n=t;if(r>0){var i=t.slice(0,r);n=t.slice(r);for(var a=0;a<i.length;a++)e.removeItem(i[a].key).then((function(){}))}e.writeCachedKeysToLocal(n)})).catch((function(){}))}},{key:"getItem",value:function(e,t){if(!this.hasItem(e))return Promise.resolve(!1);var r=this._getTimeKey(e).timeKey;return this._driver.getItem(r,t)}},{key:"setItem",value:function(e,t,r){var n=this;this._getTimeKey(e).timeKey&&this.removeItem(e);var i=(new Date).getTime();this._allCachedKeys[e]=1,this._allCachedTimeKeys[e]=i;var a=this._genTimeKey(e,i);return r=r?function(){n._getAll(),r()}:function(){n._getAll()},this._driver.setItem(a,t,r)}},{key:"_getTimeKey",value:function(e){var t=this._allCachedTimeKeys[e],r=e;return t&&(r=this._genTimeKey(e,t)),{timeKey:r,time:t}}},{key:"_genTimeKey",value:function(e,t){return"".concat(t).concat(TIMESPLIT).concat(e)}},{key:"removeItem",value:function(e,t){var r=this._getTimeKey(e).timeKey,n=this._driver.removeItem(r,t);return delete this._allCachedKeys[e],delete this._allCachedTimeKeys[e],n}},{key:"hasItem",value:function(e){return!!this._allCachedKeys[e]}},{key:"clear",value:function(e){return this._driver.clear(e)}},{key:"length",value:function(e){return this._driver.length(e)}},{key:"setMaxCache",value:function(e){"number"==typeof e&&e>0&&(this._maxCache=e)}}]),e}(),PRELOADER_KEY="DEFAULT",PreloaderManager=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck$2(this,e),EventEmitter(this),this._preloadDataList=[],this._currentPreloadInst=null,this._dashPreloadList=[],this.autoPreload=t.autoPreload||!1,this._onPreloadNext=this.onPreloadNextReady.bind(this),this.on(PRELOAD_NEXT,this._onPreloadNext),this._preloaderConfigs={},this.update(t,r,n),this._cacheInst=new PreloadCache(t.preloadMaxCacheCount,t.preloadCacheType),this._preloadCacheProgress={},this._ptag_=!0,this._cachedDatas={}}return _createClass$3(e,[{key:"_getProloaderKey",value:function(e){return e.vtype?e.vtype:PRELOADER_KEY}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r)throw new Error("PreloaderManager predictInst is null");var n=this._getProloaderKey(e);this._preloaderConfigs[n]={predictInst:r,readyPromise:r.init(e),handlers:t}}},{key:"cachedDatas",get:function(){return this._cachedDatas}},{key:"onCacheSegment",value:function(e){var t=e.vid,r=e.format,n=e.cacheKey,i=e.total,a=e.loaded,o=e.isInitSegment,s=e.mediaType,l=this.getProgressCacheKey(t,r,s),u=this._preloadCacheProgress[l];u||(u=this._preloadCacheProgress[l]={}),u[n]={total:i,loaded:a,isInitSegment:o}}},{key:"onCachePredict",value:function(e){var t=e.vid,r=e.data;t&&r&&(this._cachedDatas[t]=r)}},{key:"getProgressCacheKey",value:function(e,t,r){return"".concat(e,"-").concat(t,"-").concat(r)}},{key:"onPreloadNextReady",value:function(){this.onPreloadNext()}},{key:"onPreloadSegDone",value:function(){this.autoPreload&&this.emit(PRELOAD_NEXT)}},{key:"onPreloadNext",value:function(){var e=this;if(null==this._currentPreloadInst&&this._preloadDataList.length>0){if(this._preloadDataList.length>0){var t=this._preloadDataList.shift().data;if(t.payload){var r=this._getProloaderKey(t),n=this._preloaderConfigs[r];if(!n)return void console.warn("need to set vtype, no preloader",t);this._currentPreloadInst=new PRELOADER(t,this,n,(function(t){e.onCacheSegment(t)}),(function(t){e.onCachePredict(t)})),this._currentPreloadInst.on(PRELOAD_SEG_DONE,this.onPreloadSegDone.bind(this)),this._currentPreloadInst.start().then((function(){e._currentPreloadInst.preloadSeg()})).catch((function(){e._currentPreloadInst=null}))}}}else null!=this._currentPreloadInst&&(this._currentPreloadInst.state===STATES.IDLE?this._currentPreloadInst.preloadSeg():this._currentPreloadInst.state===STATES.FINISH?(this._currentPreloadInst.destroy(),this._currentPreloadInst=null):this._currentPreloadInst.state===STATES.PREPARE&&(this._currentPreloadInst.cnt++,this._currentPreloadInst.cnt>2&&(this._currentPreloadInst.destroy(),this._currentPreloadInst=null)))}},{key:"addDashPreloader",value:function(e){e&&e.data&&(this._preloadDataList.push(e),this.sort(this._preloadDataList),this.autoPreload&&this.emit(PRELOAD_NEXT))}},{key:"_addDashPreloader",value:function(e){e&&e.data&&this._preloadDataList.push(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.sort(e);for(var t=0;t<e.length;t++)this._addDashPreloader(e[t])}},{key:"sort",value:function(e){e.sort((function(e,t){return void 0===e.order&&void 0===e.order||e.order<t.order?-1:1}))}},{key:"destroy",value:function(){this.off(PRELOAD_NEXT,this._onPreloadNext)}},{key:"cancelLoading",value:function(){this._currentPreloadInst&&(this._currentPreloadInst.cancelLoading(),this._currentPreloadInst=null),this._preloadDataList=[]}},{key:"preloadCacheProgress",value:function(e){var t=e.vid,r=e.format,n=e.mediaType,i=e.prelaodType,a=e.bitrate,o=e.set_duration,s=e.set_size,l=e.media_type,u=e.start_time,c=this.getProgressCacheKey(t,r,n),d=this._preloadCacheProgress[c];if(d){for(var h=Object.values(d),f=0,p=0,y=0,m=0,g=0,v=0;v<h.length;v++){var b=h[v];b.isInitSegment&&(f=b.total,y=b.loaded,m=b.loaded===b.total?DOWN_STATES.SUCCESS:DOWN_STATES.DOWNLOADING),p+=b.total,g+=b.loaded}return{media_type:l,preload_type:i,stream_bitrate:a,header_size:f,content_total_size:p,start_time:u||-1,state_info:{set_duration:o,set_size:s,current_header_download_size:y,current_content_download_size:g,header_download_state:m,content_download_state:g===p?DOWN_STATES.SUCCESS:DOWN_STATES.DOWNLOADING}}}return null}},{key:"getPreloadTaskInfos",value:function(){}},{key:"getItem",value:function(e,t){return this._cacheInst.getItem(e,t)}},{key:"setItem",value:function(e,t,r){return this._cacheInst.setItem(e,t,r)}},{key:"removeItem",value:function(e,t){return this.removeItem(e,t)}}],[{key:"getInstance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.GLOBAL_KEY+(t.globalKey?t.globalKey:""),a=window[i];if(a&&a._ptag_)return a.update(t,r,n),a;var o=new e(t,r,n);return window[i]=o,o}}]),e}();PreloaderManager.GLOBAL_KEY="__preloadcontext__";var PreloaderBase=function(){function t(e){_classCallCheck$2(this,t),EventEmitter(this),this.options=e,this.promisePolyfill(),this.before(),this.check(),this._preloadManager=PreloaderManager.getInstance(e,this.handlers,this.predictInst),this.loadingTasks=[]}return _createClass$3(t,[{key:"promisePolyfill",value:function(){Promise.prototype.finally||(Promise.prototype.finally={finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then((function(e){return t((function(){return e}))}),(function(e){return t((function(){return Promise.reject(e)}))}))}}.finally)}},{key:"before",value:function(){throw new Error("need")}},{key:"check",value:function(){if(!this.handlers)throw new Error("handlers null");if(!this.handlers.start||!this.handlers.onRequest)throw new Error("handlers callback null");if(!this.predictInst)throw new Error("predictInst null");if(!this.predictInst.__p__)throw new Error("predictInst need extends predictbase")}},{key:"preloadNext",value:function(){this._preloadManager.emit(PRELOAD_NEXT)}},{key:"preloadManager",get:function(){return this._preloadManager}},{key:"start",value:function(e){throw new Error("start need implment, return Promise")}},{key:"cancelLoading",value:function(){for(var t=0;t<this.loadingTasks.length;t++)try{var r=this.loadingTasks[t];"function"==typeof r.cancel&&r.cancel()}catch(e){}this.loadingTasks=[],this._preloadManager.cancelLoading()}},{key:"addTasker",value:function(e){this.loadingTasks.push(e)}},{key:"removeTasker",value:function(e){var t=this;setTimeout((function(){for(var r=t.loadingTasks.length-1;r>-1;r--)if(t.loadingTasks[r]===e){t.loadingTasks.splice(r,1);break}}))}},{key:"addDashPreloader",value:function(e){this._preloadManager.addDashPreloader(e)}},{key:"addDashPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._preloadManager.addDashPreloaderList(e)}}]),t}(),PredictBase=function(){function e(){_classCallCheck$2(this,e),this.bandwidth2item={},this._mediaInfos=null,this.__p__=!0}return _createClass$3(e,[{key:"init",value:function(){throw new Error("init func not implement, return promise")}},{key:"preloadPredict",value:function(e){throw new Error("preloadPredict error",e)}},{key:"updateMediaInfos",value:function(e){if(this._mediaInfos=e,this.bandwidth2item={},this.dynamic_video=e&&e.dynamic_video_list,this.dynamic_video&&this.dynamic_video.length>0)for(var t=0;t<this.dynamic_video.length;t++){var r=this.dynamic_video[t];this.bandwidth2item[r.bitrate||r.bandwidth]=r}}},{key:"getIdx",value:function(e,t){var r=0;return e.forEach((function(e,n){e.definition===t&&(r=n)})),r}},{key:"cachedData",get:function(){return null}}]),e}(),VTYPES=VTYPES$1,CODEC_TYPE$1={H264:"h264",H265:"h265"},MAX_LOADING_COUNT=1,PRELOAD_TYPES=PRELOAD_TYPES$1,DEFAULT_TRUNK=8e5,_BITRATE_SELECTOR=null,Predict=function(e){_inherits$4(r,e);var t=_createSuper$5(r);function r(){return _classCallCheck$7(this,r),t.apply(this,arguments)}return _createClass$8(r,[{key:"init",value:function(){return Promise.resolve()}},{key:"preloadPredict",value:function(e){return e}}]),r}(PredictBase),Mp4Preloader=function(e){_inherits$4(o,e);var t,r,n,i,a=_createSuper$5(o);function o(e,t){var r;return _classCallCheck$7(this,o),e.vtype=VTYPES.MP4,(r=a.call(this,e)).player=t,r.loadingCount=0,r._mp4=null,r._loader=null,r._pendingPromise=null,r.playerId=t.playerId,r}return _createClass$8(o,[{key:"log",value:function(e){for(var t="[Preloader] ".concat(e),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];log$1.apply(void 0,[t].concat(n))}},{key:"before",value:function(){var e=this;this.handlers={start:function(t){var r=t.payload||[];if(0===r.length)return Promise.reject();var n=t.vid,i=t.vtype||VTYPES.MP4,a=t.codecType||CODEC_TYPE$1.H264,s=e.getUserSelectDefinition(),l=e.checkCacheKey(n,r,s,i,a);if(console.log("[Preloader] ".concat(n," codecType:").concat(a," vtype:").concat(i," hasCache:").concat(l)),l||"MP3"===i)return Promise.reject();var u=e.getInitDefinition(r,e.options.definition,s);if(console.log("[Preloader] ".concat(n," getInitDefinition"),u),!u)return Promise.reject();var c=u.definition,d=t.preloadTime||e.options.preloadTime,h=t.preloadSize||e.options.preloadSize||Math.pow(25,4)-1,f=o.generateUniqueKey({vid:n,definition:c,vtype:i,codecType:a});log$1("[Preloader] ".concat(n," start duration:").concat(u.duration," cacheKey:").concat(f));var p=_objectSpread2$4({vid:n,definition:c,preloadTime:d,preloadSize:h,cacheKey:f,codecType:a,vtype:i},u);return e.loadingCount++,e.start(p)},onRequest:function(t,r){var n=t.url,i=t.range,a=t.extData;return e.getData(n,i,a,r)}},this.loggerConfig={logger:function(){},openLog:!1},this.predictInst=new Predict(this.loggerConfig)}},{key:"start",value:function(e){var t=this,r={mediaInfos:{dynamic_video_list:[],dynamic_audio_list:[]},onObtain:function(){var e=new ProxyPromise;return e.resolve(r.mediaInfos),e},onTransform:function(r){var n=new ProxyPromise;t._pendingPromise=n;var i=e.preloadTime,a=e.codecType;return i&&(a!==CODEC_TYPE$1.H265||t.options.supportHevc)?t.loadByPreloadTime(e,n):t.loadByChunkSize(e,n),n}};return Promise.resolve(r)}},{key:"getInitDefinition",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=null;if(o.BitRateAdapter)n=o.BitRateAdapter.getSuitableBitrate(e,r),this.log("Mp4Preloader.BitRateAdapter",n);else{for(var i=0,a=0;a<e.length;a++){var s=e[a];if(s.definition===t){i=a;break}}n=e[i]}return n||(n=e[0]),n}},{key:"getPreLoadData",value:function(e){var t=this,r=new ProxyPromise;return this.getItemSameVid(e).then((function(e){if(t.log("getPreLoadData",e.value),e.value){var n=e.value,i=n.mediaSegList,a=n.meta,o=n.type,s=n.buffer,l=n.preloadTime,u=n.vid,c=n.cacheKey,d=n.definition,h=n.byteLength,f=n.duration,p=n.fileSize,y=n.from,m=n.vtype,g=n.codecType,v=n.initSeg,b={vid:u,type:o,vtype:m,codecType:g,definition:d,bitrate:n.bitrate,cacheKey:c,duration:f||0,byteLength:h,from:y,meta:a};o===PRELOAD_TYPES.SIZE?(b.buffer=s,b.fileSize=p||0):(b.mediaSegList=i,b.preloadTime=l,b.initSeg=v),r.resolve(b)}else r.resolve(null)})).catch((function(e){r.reject(e)})),r}},{key:"setPreLoadData",value:(i=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b,_,E=this;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ProxyPromise,i=r.mediaSegList,a=r.meta,o=r.vid,s=r.definition,l=r.type,u=r.buffer,c=r.duration,d=r.byteLength,h=r.preloadTime,f=r.preloadSize,p=r.fileSize,y=r.from,m=r.vtype,g=r.codecType,v=r.initSeg,b=r.bitrate,_={codecType:g,vtype:m,vid:o,definition:s,cacheKey:t,type:l,from:y,meta:a,fileSize:p,bitrate:b},l===PRELOAD_TYPES.SIZE?(_.buffer=u,_.byteLength=d||0,_.preloadSize=f||0,_.fileSize=p,_.buffer&&_.buffer.byteLength>0&&(this.setItem(t,_),n.resolve(!0))):(_.mediaSegList=i||[],_.duration=c,_.byteLength=d||0,_.preloadTime=h||0,_.initSeg=v,a&&0===i.length?(this.setItem(t,_),n.resolve(!0)):(i.every((function(e){return!!e.buffer&&e.state}))||n.resolve(!1),this.setItem(t,_).then((function(){E.log("setPreLoadData1 success",t,(new Date).getTime())})),n.resolve(!0))),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"getInitCacheData",value:function(e,t){var r={type:e,meta:null,byteLength:0,fileSize:0,bitrate:0};return e===PRELOAD_TYPES.DURATION?(r.mediaSegList=[],r.initSeg=null,r.duration=0):r.buffer=null,Object.keys(t).map((function(e){r[e]=t[e]})),r}},{key:"updatePreCacheData",value:function(e,t,r,n,i,a,o){var s=e.mediaSegList;if(e.type===PRELOAD_TYPES.SIZE||-1===i)return e.buffer=lib$1(Uint8Array,e.buffer.buffer||[],new Uint8Array(t)),e;for(var l=-1,u=0;u<s.length;u++)if(s[u].index===i){l=u;break}var c=a||[0,0];return l>-1?(t&&(s[l].buffer=lib$1(Uint8Array,s[l].buffer||[],new Uint8Array(t))),r.length>1&&(s[l].range.length>1?s[l].range[1]=r[1]:s[l].range=r),-1!==o[1]&&(n=s[l].range[1]>=o[1]),s[l].state=n):(e.duration=c[1],s.push({buffer:t,range:r||[],index:i,totalRange:o||[],timeRange:[c[0],c[1]],state:n})),n&&(e.byteLength=r[1]),n}},{key:"checkCacheKey",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:VTYPES.MP4,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:CODEC_TYPE$1.H264;if(r){var a=o.generateUniqueKey({vid:e,definition:r,vtype:n,codecType:i});return this.hasItemSameVid(a)?a:null}for(var s=0;s<t.length;s++){var l=o.generateUniqueKey({vid:e,definition:t[s].definition,vtype:n,codecType:i}),u=this.hasItemSameVid(l);if(u)return l}return null}},{key:"checkCanPreloadNext",value:function(){var e=!0;return this.loadingCount>=MAX_LOADING_COUNT&&(e=!1),e&&this.preloadNext(),e}},{key:"loadByPreloadTime",value:function(e,t){var r=this,n=e.vid,i=e.cacheKey,a=e.preloadTime,o=e.definition,s=e.duration,l=e.bitrate,u=e.codecType,c=e.vtype,d=null;if(d="Array"===util.typeOf(e.url)?e.url.length>1?e.url[1].src:e.url[0].src:e.url){d=util.extUrl(d,{__vid:n});var h=a>=this.options.segmentMinDuration?this.options.segmentMinDuration:a;this.log("loadByPreloadTime","".concat(e.cacheKey,", definition:").concat(e.definition,",segmentMinDuration:").concat(h),e);var f=util.getFileSize(l,s);this._mp4=new MP4$1(d,l,{segmentDuration:h,codecType:this.codecType,chunkSize:this.options.preloadSize,duration:s,fileSize:f,playerId:this.playerId,vid:n,useUrlRange:!1,retryCount:1,retryDelay:1e3,supportHevc:this.options.supportHevc,reqOptions:this.options.reqOptions||{}},null,null,{},[],this.firstFrameTime,"");var p=this.getInitCacheData(PRELOAD_TYPES.DURATION,{vid:n,preloadTime:a,definition:o,cacheKey:i,codecType:u,vtype:c,bitrate:l||0});this._mp4.once("metaReady",(function(i){r.log("".concat(n," metaReady this._pendingPromise"),r._pendingPromise.state),p.meta=i,p.from=2,r._mp4.cancelLoading(),r.startLoadByFragments(p,e,t)})),this._mp4.on("error",(function(e){console.error("[Preloader] ".concat(n," loadByPreloadTime error"),e),r._endLoadFragments()})),this._mp4.init({})}else this._endLoadFragments()}},{key:"loadByChunkSize",value:(n=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t){var r,n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b=this;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.vid,n=t.cacheKey,i=t.definition,a=t.duration,o=t.bitrate,s=t.codecType,l=t.vtype,u=this.options,c="Array"===util.typeOf(t.url)?t.url[0].src:t.url){e.next=6;break}return this._endLoadChunk(),e.abrupt("return");case 6:return c=util.extUrl(c,{__vid:r}),d=util.getFileSize(o,a),h=getMetaSize(a,DEFAULT_TRUNK,d),this.log("".concat(r,"loadByChunkSize"),t.cacheKey,t.definition,h,t),f=this.getInitCacheData(PRELOAD_TYPES.SIZE,{vid:r,definition:i,cacheKey:n,codecType:s,vtype:l,fileSize:d,bitrate:o||0}),this.MP4Loader=new MP4Loader(_objectSpread2$4(_objectSpread2$4({url:c,retry:u.retry||2,retryDelay:u.retryDelay||1e3,timeout:3e3},u.reqOptions),{},{segmentDuration:u.segmentDuration})),e.prev=12,p=new Uint8Array(0),y=0,m=null,g=null,v=function(e,t,r){if(e&&r.range[0]===y&&(p=lib$1(Uint8Array,p,new Uint8Array(e)),y+=e.byteLength),r.meta){b.MP4Loader.cancel();var i=r.meta,a=i.videoSegments,o=i.audioSegments;g=_objectSpread2$4(_objectSpread2$4({},i.meta),{},{ext:{videoTrak:a,audioTrak:o}}),f.meta=g,f.buffer=p,f.byteLength=p.byteLength,b.setPreLoadData(n,f),m=util.getFragRange(0,a,o),b.log("".concat(n," onProgressHandle4 meta"),t,m,y,p.byteLength),m[0]<y&&(m[0]=y),b._loadOneChunk(f,m)}},e.next=20,this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,h],v);case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(12),console.error("[Preloader] ".concat(n," loadByChunkSize error"),e.t0),this._endLoadChunk();case 26:case"end":return e.stop()}}),e,this,[[12,22]])}))),function(e){return n.apply(this,arguments)})},{key:"_loadOneChunk",value:(r=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t,r){var n,i,a,o,s,l,u,c;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.vid,i=t.cacheKey,a=t.buffer,e.prev=1,e.next=4,this.MP4Loader.loadData(r,this.MP4Loader.cache,{});case 4:o=e.sent,this.log("".concat(n," _loadOneChunk"),r,o),s=o.response,(l=o.data)?(this._endLoadChunk(),s&&s.headers&&(u=util.getFileSize(s.headers))&&(t.fileSize=u),c=lib$1(Uint8Array,a,new Uint8Array(l)),t.buffer=c,t.byteLength=c.byteLength,this.log("".concat(n," _loadOneChunk ret"),i,c.byteLength,t),t.from=4,this.setPreLoadData(i,t)):this._endLoadChunk(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("[Preloader] ".concat(n," loadByChunkSize error"),e.t0),this._endLoadChunk();case 14:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(e,t){return r.apply(this,arguments)})},{key:"_endLoadChunk",value:function(){this.log("_endLoadChunk loadingCount:".concat(this.loadingCount),this._pendingPromise?this._pendingPromise.state:null),this._pendingPromise&&(this._pendingPromise.resolve(),this._pendingPromise=null),this.loadingCount>0&&this.loadingCount--,this.MP4Loader&&(this.MP4Loader.cancel(),this.MP4Loader.destroy(),this.MP4Loader=null)}},{key:"startLoadByFragments",value:(t=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t,r,n){var i,a,o,s,l,u,c=this;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=r.preloadTime,a=r.vid,console.log("[Preloader] ".concat(a," startLoadByFragments")),o=[],s=0;s<this._mp4.timeRange.length;s++)this._mp4.timeRange[s].startTime<=i&&o.push(s);return l=function(e){c.log("[Preloader] _failedCallback",e),c._endLoadFragments()},u=function(){var e=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(r){var n,i,a,s,d,h,f,p,y;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c._mp4){e.next=2;break}return e.abrupt("return");case 2:if(n=r.buffer,i=r.context,a=r.state,s=r.initSeg,d=i.fragIndex,h=i.range,f=i.timeRange,p=c._mp4.getFragRange(d),!t.initSeg&&s&&(t.initSeg=s),y=c.updatePreCacheData(t,n,h,a,d,f,p),console.log("[Preloader] ".concat(t.cacheKey," _successCallback"),d,a,y,h,f,p,r),t.from=3,!y){e.next=20;break}return e.next=12,c.setPreLoadData(t.cacheKey,t);case 12:if(!(d>=o.length-1)){e.next=17;break}c.log("".concat(t.cacheKey," mp4.load end"),d),c._endLoadFragments(),e.next=20;break;case 17:return c.log("".concat(t.cacheKey," mp4.load start"),d+1),e.next=20,c._mp4.loadAllFragmentData(d+1,u,l);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=8,this._mp4.loadAllFragmentData(0,u,l);case 8:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"_endLoadFragments",value:function(){this.log("_endLoadFragments loadingCount:".concat(this.loadingCount),this._pendingPromise?this._pendingPromise.state:null),this._pendingPromise&&(this._pendingPromise.resolve(),this._pendingPromise=null),this.loadingCount>0&&this.loadingCount--,this._mp4&&(this._mp4.destroy(),this._mp4=null)}},{key:"getFragment",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=new ProxyPromise;return this.getData(e,t,a,!1).then((function(e){n.createFragment(new Uint8Array(e.res),t[0]-n.mdatStart,r,{range:t,context:e.context}).then((function(e){o.resolve(e)}))})),o}},{key:"getPreloadUrl",value:function(e){var t=e.url,r=e.range,n=e.definition,i=e.vid;return[{url:t,range:r,extData:{cacheKey:o.generateUniqueKey({vid:i,start:r[0],end:r[1],definition:n}),vid:i,format:"mp4"}}]}},{key:"getRangeList",value:function(e){var t=this.allCachedKeys,r={timeRange:[],contentRange:[]};for(var n in t)if(t.hasOwnProperty(n)&&n.indexOf(e)>-1){var i=n.split("#");0===i[2].indexOf("pretime")?r.timeRange.push([0,parseFloat(i[2].slice(7))]):r.contentRange.push([parseInt(i[2]),parseInt(i[3])])}return r}},{key:"hasItemSameVid",value:function(e){if(!e)return!1;var t=this.allCachedKeys;for(var r in t)if(t.hasOwnProperty(r)){if(r===e)return r;var n=r.split("#"),i=e.split("#");if(n.length>=4&&i.length>=4&&n[0]===i[0]){if(0===n[2].indexOf("pretime")&&0===i[2].indexOf("pretime"))return r;var a=[parseInt(n[2]),parseInt(n[3])],o=[parseInt(i[2]),parseInt(i[3])];if(o[0]>=a[0]&&o[1]>o[0]&&o[1]<=a[1])return r}}return!1}},{key:"removeOthers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=this.allCachedKeys;for(var n in r)r.hasOwnProperty(n)&&n.split("#").length>=1&&function(){var r=n.split("#")[0];t.every((function(e){return e.split("#").length>=1&&e.split("#")[0]!==r}))&&(e.log("remove cache:".concat(n)),e.cacheInst.removeItem(n))}()}},{key:"getItemSameVid",value:function(e,t){var r=this.hasItemSameVid(e);return this.log("getItemSameVid: key:".concat(e," checkResult:").concat(r)),r?this.cacheInst.getItem(r,t).then((function(e){return{value:e,key:r}})):Promise.resolve({})}},{key:"setItem",value:function(e,t){return this.cacheInst.setItem(e,t)}},{key:"allCachedKeys",get:function(){return this.cacheInst._allCachedKeys}},{key:"cacheInst",get:function(){return this._preloadManager._cacheInst}},{key:"cancelPreloadByVid",value:function(e){if(e){for(var t=this._preloadManager._preloadDataList,r=[],n=0;n<t.length;n++){t[n].data.vid!==e?r.push(t[n]):(console.log("[Preloader] cancelPreloadByVid",e),this.log("cancelPreloadByVid",e))}this._preloadManager._preloadDataList=r}}},{key:"cancelLoading",value:function(e){this._endLoadFragments(),this._endLoadChunk();var t=this._preloadManager;if(t._currentPreloadInst){var r=t._currentPreloadInst._toLoadList,n=[];r.map((function(t){return t.playerId!==e&&n.push(t),t})),t._currentPreloadInst._toLoadList=n}var i=[],a=[];t._preloadDataList.map((function(t){return t.playerId!==e?i.push(t):a.push(t.data.vid),t})),this.log("cancelLoading",e,a.join(",")),t._preloadDataList=i}},{key:"checkIfExistInList",value:function(e){for(var t=this._preloadManager._preloadDataList,r=0;r<t.length;r++)if(e===t[r].data.vid)return!0;return!1}},{key:"addPreloader",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(e.data){e.data.vtype||(e.data.vtype=VTYPES.MP4);var n=e.data.vid,i=this.checkIfExistInList(n);console.log("[Preloader] addPreloader checkIfExistInList",n,i),r&&n===r||i||(e.playerId=t,this.addDashPreloader(e))}}},{key:"addPreloaderList",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=[],n=0;n<e.length;n++){var i=e[n].data,a=i.vid,o=i.vtype,s=this.checkIfExistInList(a);console.log("[Preloader] addPreloaderList checkIfExistInList",a,a===t,s),t&&a===t||s||(o||(e[n].data.vtype=VTYPES.MP4),r.push(e[n]))}console.log("[Preloader] addPreloaderList length is ".concat(r.length)),this.addDashPreloaderList(r)}},{key:"setUserSelectDefinition",value:function(e){this._preloadManager&&(this._preloadManager.userDefinition=e)}},{key:"getUserSelectDefinition",value:function(){return this._preloadManager.userDefinition||null}},{key:"destroy",value:function(){this._endLoadFragments(),this._endLoadChunk(),this.cancelLoading(this.playerId)}}],[{key:"PRELOAD_TYPES",get:function(){return PRELOAD_TYPES}},{key:"BitRateAdapter",get:function(){return _BITRATE_SELECTOR},set:function(e){_BITRATE_SELECTOR=e}},{key:"generateUniqueKey",value:function(e){var t=e.vid,r=e.mediaType,n=e.definition,i=e.codecType,a=e.vtype;return r=r||"video",n=n||"-1",i=i||CODEC_TYPE$1.H264,a=a||VTYPES.MP4,t?"".concat(t,"#").concat(r,"#").concat(i,"#").concat(a,"#").concat(n):null}}]),o}(PreloaderBase),CUSTOM_EVENTS={MEDIA_EXPIRED:"MEDIA_EXPIRED",INIT_FAIL:"INIT_FAIL",PARSE_ERROR:"PARSE_ERROR",PLAYER_LOG:"PLAYER_LOG",BUFFERED_RESET:"BUFFERED_RESET"},BUFFER_BREAK=1e4,GapJump=function(){function e(t,r){_classCallCheck$7(this,e),this.player=t,this.mediaElem=t.video,this.config=r,this.timer=new IntervalTimer$1,this.prevReadyState=this.mediaElem.readyState,this.didFireLargeGap=!1,this.seekingEventReceived=!1,this.onWaitFunc=this._onWaiting.bind(this),this.onPlayFunc=this._onPlay.bind(this),this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),!1!==this.config.useGapJump&&this._start(),this.hasPlayed=!1}return _createClass$8(e,[{key:"_onWaiting",value:function(){this.onGapJump()}},{key:"_onPlay",value:function(){this.hasPlayed=!0}},{key:"_start",value:function(){this.mediaElem.addEventListener("waiting",this.onWaitFunc),this.mediaElem.addEventListener("play",this.onPlayFunc)}},{key:"onSegmentAppend",value:function(e){if(this.config.enableCheckBufferDiff&&this.mediaElem){var t=e.reduce((function(e,t){return e+t.downloaded?t[1]-t[0]:0}),0);this._getBuffered(this.mediaElem.buffered).reduce((function(e,t){return e+(t.end-t.start)}),0)/t<.8&&(log$1("onSegmentAppend detectGap"),this.player&&this.player.emit("detectGap"))}this.onGapJump()}},{key:"onSeeking",value:function(){this.seekingEventReceived=!0,this.didFireLargeGap=!1}},{key:"onGapJump",value:function(){if(this.mediaElem.readyState!==HTMLMediaElement.HAVE_NOTHING){if(this.mediaElem.seeking){if(!this.seekingEventReceived)return}else this.seekingEventReceived=!1;if(!this.mediaElem.paused||0===this.mediaElem.currentTime||!this.hasPlayed){this.mediaElem.readyState!==this.prevReadyState&&(this.didFireLargeGap=!1,this.prevReadyState=this.mediaElem.readyState);var t=this.mediaElem.buffered,r=this.config.smallGapLimit||.5,n=this.config.gapDetectionThreshold||.1,i=this.mediaElem.currentTime,a=this._getIndex(t,i,n);if(null!==a&&(0!==a||t&&t.length)){var o=t.start(a)+.1;if(!(o>this.mediaElem.duration)){var s=o-i,l=s<=r;s<e.BROWSER_GAP_TOLERANCE||l&&(!0!==this.config.disableGapSetPosition&&(log$1("onGapJump this.mediaElem.currentTime"),this.mediaElem.currentTime=this.isSafari?o+.1:o),this.player&&this.player.emit("detectGap"),log$1("gapJump gapIndex",a,"isGapSamll",l,"jumpLargeGap",!1,"currentTime",this.mediaElem.currentTime),.08!==o&&this.player&&this.player.emit("log",{type:"oneevent",end_type:"gap",vid:this.player.config.vid,ext:{video_postion:Math.floor(1e3*o)}}))}}}}}},{key:"_getIndex",value:function(e,t,r){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var n=this._getBuffered(e),i=null,a=0;a<n.length;a++){if(n[a].start>t&&(0===a||n[a-1].end-t<=r)){i=a;break}}return i}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}},{key:"destroy",value:function(){this.mediaElem.removeEventListener("waiting",this.onWaitFunc),this.mediaElem.removeEventListener("play",this.onPlayFunc),this.timer.clear(),this.timer=null}}]),e}();GapJump.BROWSER_GAP_TOLERANCE=.001;var START_TYPES={FIXED:"FIXED",AUTO:"AUTO"},AbrService=function(){function e(t,r){var n=this;_classCallCheck$7(this,e),_defineProperty$7(this,"_onAbrChange",(function(e,t,r,i){var a=n._pluginInst.player,o=n.bitrateMap[e],s=n.bitrateMap[t],l=o.definition,u=s&&s.definition?s.definition:l;console.log("[ABR] _onAbrChange ",l,u),l!==u&&(n._abrSwitchHandler(s),a.emit("ABR_CHANGE",{prev:l,cur:u,prevName:o.definitionName,curName:s.definitionName,abrInfo:i}))})),_defineProperty$7(this,"_onAutoDescChange",(function(e){var t=e.definition,r=e.reset,i=e.fps,a=e.item;n.updateAutoDefiDesc(t,r,i,a)})),this._pluginInst=t;var i=this._pluginInst.config.autoBitrateOpts||{};this.isPlayAutoDefi=ABR.getIsPlayAutoDefi(i),this.isOpenAutoDefi=!!i.isOpenAutoDefi,this.isCurrentAutoDefi=this.isOpenAutoDefi&&this.isPlayAutoDefi,this.bitrateMap={},this.defiIdMap={},this._abrSwitchHandler=r}var t;return _createClass$8(e,[{key:"_destroyAbr",value:function(){var e=this._pluginInst.player;this.abrInstance&&(e&&e.off(ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange),this.abrInstance.destroy(),this.abrInstance=null)}},{key:"init",value:(t=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t){var r,n,i,a;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isOpenAutoDefi){e.next=2;break}return e.abrupt("return",{type:START_TYPES.FIXED});case 2:return r=this._pluginInst,n=r.player,i=r.playerConfig,a=r.config,n.on(ABR_EVENTS.UPDATE_AUTO_DESC,this._onAutoDescChange),this.bitrateMap={},this.defiIdMap={},this.abrInstance=new ABR(n,a,0,{dynamic_video_list:i.definition.list.concat()},5e3,{logger:log$1,openLog:openLog}),e.next=9,this.abrInstance.init(t);case 9:n.on(ABR_EVENTS.ABR_CHANGE,this._onAbrChange),this.abrInstance.isCurrentInAbr=this.isCurrentAutoDefi;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"execute",value:function(){var e=this.abrInstance.execute();return{bitrate:e,type:-1===e?START_TYPES.FIXED:START_TYPES.AUTO}}},{key:"updateBitrate",value:function(e){this.abrInstance&&this.abrInstance.updateBitrate(e)}},{key:"enable",value:function(){this.abrInstance.start(),this.isCurrentAutoDefi=!0,this.abrInstance.isCurrentInAbr=!0,this.abrInstance._onTimeUpdate(null,!0)}},{key:"disable",value:function(){this.abrInstance&&(this.updateAutoDefiDesc("",!0),this.isCurrentAutoDefi=!1,this.abrInstance.isCurrentInAbr=!1,this.abrInstance.stop(!0))}},{key:"isCurrentInAbr",value:function(){return!!this.abrInstance&&this.abrInstance.isCurrentInAbr}},{key:"updateAutoDefiDesc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this._pluginInst,a=i.player,o=i.config,s=o.autoBitrateOpts||{},l=s.autoDefiText||"auto";a.emit("ABR_AUTO_DESC_CHANGE",l,t?void 0:e,r,n)}},{key:"updateAbrCacheData",value:function(){var e=this,t=this._pluginInst,r=t.player,n=t.config,i=t.playerConfig,a=n.autoBitrateOpts||{},o=i.definition.list,s=!1;if(o.forEach((function(t){e.bitrateMap[t.bitrate]={url:t.url,definition:t.definition,definitionName:t.text},e.defiIdMap[t.definition]={bitrate:t.bitrate,definition:t.definition},"auto"!==t.definition&&""!==t.definition||(s=!0)})),this.isOpenAutoDefi,this.isOpenAutoDefi&&!s){var l=a.autoDefiText||"auto",u={definition:"",bitrate:r.curDefinition.bitrate,text:l,url:"__auto__",selected:this.isPlayAutoDefi,name:"",vwidth:r.curDefinition.vwidth,vheight:r.curDefinition.vheight};i.definition.list.push(u)}}},{key:"destroy",value:function(){this._pluginInst.player.off(ABR_EVENTS.ABR_CHANGE,this._onAbrChange),this._destroyAbr()}}]),e}(),DESTROYED="DESTROYED",REAL_TIME_SPEED_EVENT="real_time_speed",_playerPlayNext=null,_playerStartInit=null,_playerChangeDefinition=null,_playerSwitchUrl=null,CODEC_TYPE={H264:"h264",H265:"h265"},_realTimeSpeed=0,Mp4EncryptPlayer=function(t){_inherits$4(o,t);var r,n,i,a=_createSuper$5(o);function o(t){var r;return _classCallCheck$7(this,o),_defineProperty$7(_assertThisInitialized$4(r=a.call(this,t)),"_replayHook",(function(e){"xgmse-video"===r.player.config.mediaType?r._onReplay():r.useVideoLoad||(r._defInited=!1,r.log("replayHook ",r.playerConfig.url),r.player.video.load(),r.playerStartInit(r.playerConfig.url))})),_defineProperty$7(_assertThisInitialized$4(r),"_retryHook",(function(){var e=_assertThisInitialized$4(r),t=e.player,n=e.playerConfig,i=e.config,a=t.currentTime;if(r.codecType!==CODEC_TYPE.H265||i.supportHevc){r._defInited=!1;var o=r.config,s=o.drm,l=o.kid,u=o.secretKey,c=o.keyValue;if(s||l||u||c)r.initAwManager(),r.playerStartInit(n.url);else{if(r.useVideoLoad=!0,"Array"===util$2.typeOf(n.url)){var d=n.url.length;t.video.src=n.url[d-1].src}else t.video.src=n.url;t.currentTime=a,t.play()}}else r.log("h265 retryHook ",n.vid),r._onDegrade("retry");return!1})),_defineProperty$7(_assertThisInitialized$4(r),"_playHook",(function(e){r._usePaused=!1})),_defineProperty$7(_assertThisInitialized$4(r),"_pauseHook",(function(e){r._usePaused=!0})),_defineProperty$7(_assertThisInitialized$4(r),"abrSwitchURL",function(){var e=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(t){var n,i,a,o,s,l;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_assertThisInitialized$4(r),i=n.playerConfig,a=i.definition.list,o=0,s=0;case 4:if(!(s<a.length)){e.next=11;break}if(t.definition!==a[s].definition){e.next=8;break}return o=s,e.abrupt("break",11);case 8:s++,e.next=4;break;case 11:l=r.player.curDefinition,r.changeDefinition(a[o],l,!0);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty$7(_assertThisInitialized$4(r),"changeDefineCanPlay",(function(e,t,n,i){var a=_assertThisInitialized$4(r).player;a.ended?a.currentTime=0:(r.log("[oldChangeDefinition],this._changeDefState,",r._changeDefState),a.currentTime=r._changeDefState?r._changeDefState.currentTime:e,(r._changeDefState?r._changeDefState.paused:t)?a.pause():a.play(),r._changeDefState=null,a.emit(AFTER_DEFINITION_CHANGE,{from:n,to:i}))})),_defineProperty$7(_assertThisInitialized$4(r),"changeDefinition",(function(e,t,n){var i=_assertThisInitialized$4(r),a=i.player,o=i.playerConfig,s=i.mp4;if(t||(t=a.curDefinition),r.useVideoLoad)return"__auto__"===e.url&&(e.url=a.config.definition.list[0].url),void _playerChangeDefinition.call(r.player,e,t);if(r._switchBitRateWay&&!n)return r.log("changeDefinition old"),void r.oldChangeDefinition(e,t);var l=""===e.definition||"auto"===e.definition;if(n)r.log("[switchBitrate:ABR], ready to switch bitRate, ",e.bitrate);else{var u=!1;if(l)r._abrService&&r._abrService.enable(),u=!0;else if(r._abrService&&r._abrService.disable(),!e.bitrate||e.bitrate<=0)for(var c=0;c<o.definition.list.length;c++)e.definition===o.definition.list[c].definition&&(e.bitrate=o.definition.list[c].bitrate);a.emit(DEFINITION_CHANGE,{from:t,to:e}),setTimeout((function(){r._abrService&&r._abrService.updateAutoDefiDesc(a.curDefinition.definition,!l)})),u&&(e=a.curDefinition),r.log("[switchBitrate:CBS],switch bitRate, ",e.bitrate)}a.curDefinition=e;var d=a.definitionList.filter((function(e){return e.definition===a.curDefinition.definition}));d.length>0&&(e=d[0]),s&&(r.config.keyValue=e.keyValue,r.config.kid=e.kid,r.config.secretKey=e.secretKey,r.config.drm=e.drm,r.config.getLicenseUrl=e.getLicenseUrl,r._getLicense().then(_asyncToGenerator$5(_regeneratorRuntime$4().mark((function t(){var i,l,u,c,d,h;return _regeneratorRuntime$4().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.url=e.url,o.backupURL=e.backupURL,i=0,l=!1,r._abrService&&r._abrService.isCurrentInAbr()?(u=a.getBufferedRange(a.buffered2),(i=u[1])<a.currentTime&&(i=a.currentTime,r.log("bufferRange is invaild,adjust",u,",timeStart,",i)),r.log("[switchBitrate:ABR],switch bufferedList, ",r.player.buffered2?r.player.buffered2.bufferedList:null,",curtime,",a.currentTime,",bufferRange,",u)):(i=a.currentTime,l=!0),(c=s.getFragmentIdx(i))<0&&(c=r._curLoadSegmentIdx),r.log("switchBitrate:point,",c,",startTime,",s.timeRange[c].startTime,",currentTime,",a.currentTime),l&&a.emit("definitionSwitchTime",s.timeRange[c].startTime+1),r.changeState("changeDefinition",{abr:n,fragIndex:c,startTime:s.timeRange[c].startTime,currentTime:a.currentTime}),!s){t.next=14;break}return t.next=13,s.cancelLoading();case 13:s._metaLoading&&(s._metaLoading=!1);case 14:return!((d=a.getBufferedRange(a.buffered))[1]>0&&d[1]-a.currentTime>5)||r._abrService&&r._abrService.isCurrentInAbr()||(r.mse.clearOpQueues(MSE.VIDEO),r.mse.remove(MSE.VIDEO,a.currentTime+5,d[1])),s.resetFragmentLoadState(c),r._curLoadSegmentIdx=c,t.next=20,r.mp4.changeBitRate(e);case 20:h={width:e.width||e.vwidth,height:e.height||e.vheight},a.emit("RESOLUTION_UPDATE",h);case 22:case"end":return t.stop()}}),t)})))).catch((function(t){console.error(t),t.errorType="GET_LICENSE_ERROR",r.emit("error",t),r.changeState("LICENSE_ERROR",{d:e.definition})})))})),_defineProperty$7(_assertThisInitialized$4(r),"_onVideoError",(function(e){r.log("video err,",e)})),_defineProperty$7(_assertThisInitialized$4(r),"_onPlaying",(function(){r._waitAdjustTimeCnt>0&&r._waitInBufferTimer&&(r._waitAdjustTimeCnt-=1,r.log("[waitInBuffer resume play], waitAdjustTimeCnt,",r._waitAdjustTimeCnt)),clearTimeout(r._waitInBufferTimer),r._waitInBufferTimer=null,r.log("[Index] onPlaying, timeNow,",util.nowTime());var e=_assertThisInitialized$4(r),t=e.mp4,n=e.player,i=r.config.resumePlayWaterLevel;if(t){if(!r.playFlag||n.currentTime<1)r.playFlag=!0;else if(!(t&&t.meta&&t.meta.duration-n.currentTime<=i)&&i>0&&r.playFlag){var a=n.getBufferedRange(n.buffered2);a[1]-n.currentTime<i?(n.paused||(n.pause(),r.log("[!!!!!buffer not rich, pause],time,",util.nowTime(),", currentTime, ",n.currentTime,", bufferEnd,",a[1])),clearTimeout(r.checkResumePlayTimer),r.checkResumePlayTimer=setTimeout(r._onPlaying,i/2*1e3)):n.paused&&(r.log("[!!!!!buffer rich, play],time,",util.nowTime(),", currentTime, ",n.currentTime,", bufferEnd,",a[1]),clearTimeout(r.checkResumePlayTimer),r.checkResumePlayTimer=null,n.play())}}else r.checkResumePlayTimer>0&&(clearTimeout(r.checkResumePlayTimer),r.checkResumePlayTimer=null,n.paused&&n.play())})),_defineProperty$7(_assertThisInitialized$4(r),"_lowDecoder",(function(){var e="function"==typeof r.player.video.getStats?r.player.video.getStats():null;r.log("H265 lowdecode: ".concat(r.playerConfig.vid," "),e,", h265Degrade, ",r.config.h265Degrade),r.config.h265Degrade&&r._onDegrade()})),_defineProperty$7(_assertThisInitialized$4(r),"_onError",(function(e){console.log("H265 onError: ".concat(r.playerConfig.vid," "),e,", h265Degrade, ",r.config.h265Degrade),r._onDegrade(e)})),_defineProperty$7(_assertThisInitialized$4(r),"_onDegrade",(function(e){var t,n,i=_assertThisInitialized$4(r),a=i.player,o=i.playerConfig,s=i.config;a.video.removeEventListener("lowdecode",r._onDegrade),a.video.removeEventListener("error",r._onError),null===(t=r.mp4)||void 0===t||t.destroy();var l=a.currentTime;if(console.log("[h265 degrade], vid,",o.vid,",currtime,",l),r.emit("H265_DEGRADE",{reason:e?"error":"lowdecode",currentTime:l}),null!=s&&s.H264Config){var u=s.H264Config;s.drm=(null==u?void 0:u.drm)||null,s.getLicenseUrl=(null==u?void 0:u.getLicenseUrl)||null,s.kid=(null==u?void 0:u.kid)||null,s.keyValue=(null==u?void 0:u.keyValue)||null,s.secretKey=(null==u?void 0:u.secretKey)||null,s.isEncrypt=(null==u?void 0:u.isEncrypt)||null,s.useEME=(null==u?void 0:u.useEME)||null}var c={mp4encryptplayer:s,mediaType:"video",codecType:CODEC_TYPE.H264};(null==o||null===(n=o.H264DefinitionList)||void 0===n?void 0:n.length)>0?(a.config.definition.list=o.H264DefinitionList,a.config.url=o.H264DefinitionList[0].url,a.config.defaultBitrate=o.H264DefinitionList[0].bitrate,a.config.defaultDefinition=o.H264DefinitionList[0].definition,a.playNext(c),a.once("canplay",(function(){a.currentTime=l}))):(console.error("H265 error,degrade h264 but no h264 url"),r.emit("error",e))})),_defineProperty$7(_assertThisInitialized$4(r),"_onMp4MetaReady",(function(t){console.log(">>>>_onMp4MetaReady",util.nowTime()),r.firstFrameTime.metaload=r.mp4.firstFrameTime.metaload,r.firstFrameTime.bitrate=r.player.curDefinition.bitrate;var n=r.playerConfig.vid,i=r._checkMetaInfo(t),a=r.mp4.checkCodecH265();if(r.changeState("MP4_META_READY",{is265:a?1:0}),i)return r.removeAndRejectInitPromise(i),void r._errorHandler(i);try{if(r._initEME(r.mp4,t),r.codecType!==CODEC_TYPE.H265||r.config.supportHevc){if(!(r.player.video instanceof HTMLVideoElement))return void console.error("".concat(r.player.config.mediaType," is not match"));r._initMse(t)}else{if(!a||r.player.video instanceof HTMLVideoElement)return void console.error("[Index] ".concat(n," config_codec ").concat(r.codecType," and meta_codec ").concat(t.videoCodec," is not match or supportHevc is ").concat(r.config.supportHevc));r._initH265MseProxy()}r._initPromise.resolve()}catch(e){r.removeAndRejectInitPromise(e),console.error("[Index] ".concat(n," _initEME error"),e);var o=new Errors$1(r.player,{errorType:"runtime",errorTypeCode:ERROR_TYPES.runtime,errorCode:ERROR_CODES.other1,errorMessage:null==e?void 0:e.message,vid:n,mediaError:{code:ERROR_CODES.other1,message:null==e?void 0:e.message}});r._errorHandler(o)}if(r.mp4&&r.mp4.timeRange){var s=[];r.mp4.timeRange.every((function(e){return s.push({startTime:e.startTime,endTime:e.endTime}),!0})),r.emit("KEYFRAMETIME",s)}r._loadData()})),_defineProperty$7(_assertThisInitialized$4(r),"_onMp4Error",(function(e){var t=r.playerConfig.vid;console.error("[Index] _onMp4Error",t,e),r.changeState("MP4_ERROR",e),r._initPromise&&"pending"===r._initPromise.state&&r.removeAndRejectInitPromise(e),r._errorHandler(e)})),_defineProperty$7(_assertThisInitialized$4(r),"_onMp4Progress",(function(e){r.emit("progress_event",e)})),_defineProperty$7(_assertThisInitialized$4(r),"_onMp4DataCallBack",(function(){r._isMseInit&&r._onTimeUpdate()})),_defineProperty$7(_assertThisInitialized$4(r),"_updateDrmConfig",(function(e){var t=_assertThisInitialized$4(r),n=t.config,i=t.mp4;e.kid&&n.keyValue?n.drm={clearKeys:_defineProperty$7({},e.kid,n.keyValue)}:!e.kid&&n.keyValue&&(n.useEME=!1),i.useEME=n.useEME;var a=n.drm;n.useEME||(i.kidValue=n.keyValue||(a&&a.clearKeys?a.clearKeys[Object.keys(a.clearKeys)[0]]:null)),r.eme&&a&&a.clearKeys&&n.useEME&&r.eme.updateDrm(a)})),_defineProperty$7(_assertThisInitialized$4(r),"_onVideoTimeUpdate",(function(){r.useVideoLoad||null!==r._requestTimer||!r._offineLine&&r._startProgress(),r.useVideoLoad&&r.checkIfCanPreload()})),_defineProperty$7(_assertThisInitialized$4(r),"_onBufferedReset",(function(e){r.mp4&&r.mp4.videoTrak&&r.mp4.resetFragmentLoadState(0)})),_defineProperty$7(_assertThisInitialized$4(r),"_onOnlineHandler",(function(){r._offineLine=!1;var e=_assertThisInitialized$4(r).config;r.log("online useVideoLoad:",r.useVideoLoad,r._hasStartProgressBack),r.useVideoLoad?r.player.src=e._mainURL:(r._hasStartProgressBack&&r._startProgress(),r._hasStartProgressBack=!1)})),_defineProperty$7(_assertThisInitialized$4(r),"_onOfflineHandler",(function(){r._offineLine=!0,r.log("offline, ",r._hasStartProgress),r._hasStartProgress&&(r._stopProgress(),r._hasStartProgressBack=!0)})),_defineProperty$7(_assertThisInitialized$4(r),"_loadDataSuccess",(function(t){if(!r.isDestroy&&(r.mse||r.mseProxy)){t.state&&r._firstSegState<0&&(r._firstSegState=1),r.log("[loadFragment] _loadDataSuccess ",JSON.stringify(t.context.range),",dataLen,",t.buffer?t.buffer.byteLength:0,t.state),r.firstFrameTime.startload_stmux<0&&(r.firstFrameTime.startload_stmux=r.mp4.firstFrameTime.startMuxTime,r.firstFrameTime.firstmux=r.mp4.firstFrameTime.firstmux),r.firstFrameTime.loadst_loadeddata<0&&(r.firstFrameTime.loaddata=util.nowTime()-r.loadstart);try{t.initSeg&&(r._appendInitSeg(t.initSeg),(!t.buffer||t.buffer.byteLength<1)&&(r.log("no data, must load data"),r._onTimeUpdate()));var n=t.buffer,i=t.state,a=t.context,o=t.videoTrack,s=t.audioTrack;if(r.debugInfo.loadIndx=a?a.fragIndex:-1,r.mse&&i&&(!n||n.byteLength<=0)&&a.fragIndex===r.mp4.timeRange.length-1){var l=r.player.buffered;r.bufferEndTime=l.end(l.length-1),r._isEnded(),r.log("loaded ended !!!==>>>",JSON.stringify(a.range),", fragIndex,",a.fragIndex,", bufferEndTime,",r.bufferEndTime,",meta_duration,",r.mp4.meta.duration)}if(r.mse&&i&&a.fragIndex===r.mp4.timeRange.length-1&&(!n||n.byteLength<=0)){var u=r.player.buffered;r.bufferEndTime=u.end(u.length-1),r._isEnded(),r.log("load ended !!!==>>>",r.playerConfig.vid,JSON.stringify(a.range),", fragIndex,",a.fragIndex,", bufferEndTime,",r.bufferEndTime,",meta_duration,",r.mp4.meta.duration)}if(n&&r.mse){if(n&&n.byteLength>0){r._appendBuffer(MSE.VIDEO,n,a,i);var c=r.getDataBitRate(a.fragIndex);r.player.emit("addVideoBufferEnd",{start:Math.floor(a.startPts),end:a.endPts,bandwidth:c.bitrate})}}else if(r.mseProxy&&(o&&o.samples.length>0||s&&s.samples.length>0)){var d=o.samples.length>0?o.samples[0].sampleOffset:-1,h=o.samples.length>0?o.samples[o.samples.length-1].sampleOffset:-1,f=s.samples.length>0?s.samples[0].sampleOffset:-1,p=s.samples.length>0?s.samples[s.samples.length-1].sampleOffset:-1;r.log("[livevideo] appendBuffer,index,",a.fragIndex,",range,",JSON.stringify(t.context.range),",videoIdxRange,",d,"-",h,",audioIdxRange,",f,"-",p,", timeRange,",a.timeRange),r.mseProxy.appendBuffer(o,s)}}catch(e){r.changeState("APPEND_DATA_ERROR"),r.log("appendBuffer error",e);var y=new Errors$1(r.player,{errorType:"runtime",errorTypeCode:ERROR_TYPES.runtime,errorCode:ERROR_CODES.mse,vid:r.player.config.vid,errorMessage:e.message,mediaError:{code:ERROR_CODES.mse,message:e.message}});r._errorHandler(y)}}})),_defineProperty$7(_assertThisInitialized$4(r),"_onWaiting",(function(){var e=_assertThisInitialized$4(r),t=e.player,n=e.config,i=e.playerConfig;clearTimeout(r._waitInBufferTimer),r._waitInBufferTimer=null;var a=t.currentTime;console.log("[>>>>onWaiting],currentTime, ",a,util.nowTime());var o=t.bufferedPoint;o.end>0&&o.end-t.currentTime>=2&&(r._waitAdjustTimeCnt<n.waitJampBufferMaxCnt?r._waitInBufferTimer=setTimeout((function(){r._waitAdjustTimeCnt++,t.currentTime=t.currentTime+.5,r.log("[waitInBufferTimeout], waitAdjustTimeCnt,",r._waitAdjustTimeCnt,",curtime,",a,util.nowTime())}),n.waitingInBufferTimeOut):r._errorHandler(new Errors$1(r.player,{errorType:"waitInBuffer",errorTypeCode:ERROR_TYPES.runtime,errorCode:ERROR_CODES.onWaitInBufferRange,errorMessage:"onWait_in_buffer",vid:i.vid})))})),_defineProperty$7(_assertThisInitialized$4(r),"_onEnded",(function(){r.log("[player.onEnded], stopProgress"),r.player&&r.off("waiting",r._onWaiting),r._stopProgress()})),_defineProperty$7(_assertThisInitialized$4(r),"_onReplay",(function(){var e=_assertThisInitialized$4(r),t=e.playerConfig,n=e.player;r._reset(),r._init(t.url).then((function(e){var t=e[0],i=e[1];n.video.src=i.url,r._startProgress(),r.mp4=t,r.mse=i,r.log("_replay play"),r.once("canplay",(function(){n.play(),r.on("waiting",r._onWaiting)}))}),(function(e){r.log("_errorHandler6",e),r._errorHandler(e)}))})),_defineProperty$7(_assertThisInitialized$4(r),"_onSeeking",_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(){var t,n,i,a,o,s,l,u,c,d,h;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.useVideoLoad){e.next=2;break}return e.abrupt("return");case 2:if(t=_assertThisInitialized$4(r),n=t.player,i=t.mp4,a=n.currentTime,r.changeState("seeking",{curTime:a}),r.log("[seekTime], curTime,",a,",buffer,",n.buffered2.bufferedList),i&&i.meta){e.next=8;break}return e.abrupt("return");case 8:if(r.endofstream=!1,i.bufferLoadedPos=-1,i._metaLoading=!1,o=n.bufferedPoint,s=!1,l=0,!(o.end>0)){e.next=26;break}if(s=!0,!(i.meta.duration-o.end<.5)){e.next=19;break}return r.log("[seeking in buffered range], buffer end,",o.end,", duration,",i.meta.duration),e.abrupt("return");case 19:if(l=i.getFragmentIdx(o.end),r._curLoadSegmentIdx!==l){e.next=23;break}return r.log("[seeking in buffered range], seek fragIndex is current load segmentIdx",l),e.abrupt("return");case 23:i.seekTime=o.end,l<0&&(l=r._curLoadSegmentIdx),r.log("[seeking in buffered range], seekTime ",a,",bufferRange,",o.start,"-",o.end,", fragIndex,",l);case 26:return s||(i.seekTime=a,(l=i.getFragmentIdx(a))<0&&(l=r._curLoadSegmentIdx),r.log("[seekTime out buffer range], curTime,",a,", Idx,",l),u=_assertThisInitialized$4(r),(c=u.mse)&&c.isFull()&&(d=n.buffered2.bufferedList,h=d[d.length-1],c.clearOpQueues(MSE.VIDEO),r._checkRemoveSourceBuffer([h.start,h.end],n.currentTime,!0,!0))),e.next=29,i.cancelLoading();case 29:i.resetFragmentLoadState(l),r._curLoadSegmentIdx=l,r._onTimeUpdate(),r._isEnded();case 33:case"end":return e.stop()}}),e)})))),r._pendingPromises=[],r._allInitPromise=new ProxyPromise,r._isInit=!1,r._isEventInit=!1,r.playerId=r.player._pluginInfoId,r.preloader=null,r.gapJumpInst=null,r.log("playerId",r.playerId),r._tickInSeconds=r.config.tickInSeconds,r.awManager=null,r._useVideoLoad=!1,r.mse=null,r.mp4=null,r.eme=null,r._isMseInit=!1,r._awPromise=null,r._corePromise=null,r._initPromise=null,r._hasStartProgress=!1,r._hasStartProgressBack=!1,r._maxBufferLength=r.config.maxBufferLength,r._minBufferLength=r.config.minBufferLength,r._switchBitRateWay=r.config.switchBitRateWay,r._curLoadSegmentIdx=0,r._abrService=null,r._checkRemoveBufferLastTime=util.nowTime(),r.playFlag=!1,r.config.resumePlayWaterLevel=Math.min(r.config.minBufferLength,r.config.resumePlayWaterLevel),r.checkResumePlayTimer=null,r.loadstart=-1,r._loadStartEventTime=-1,r._waitAdjustTimeCnt=0,r._waitInBufferTimer=null,r._firstSegState=-1,r.codecType=r.playerConfig.codecType?r.playerConfig.codecType.toLowerCase():CODEC_TYPE.H264,r.playerConfig.vtype&&(r._vtype=r.playerConfig.vtype.toUpperCase()),r.firstFrameTime={newplayer:util.nowTime(),newplayer_initkernel:-1,initkernel_initmp4:-1,initmse_sbopen:-1,mseopen:-1,initmse_sbopendone:-1,metaload:-1,metaready_mseisopen:-1,metaready_initsegend:-1,startload_stmux:-1,firstmux:-1,apcnt:0,aplen:0,data_ap:-1,loadst_loadeddata:-1,loaddata:-1,new_loadeddata:-1,bitrate:-1},r.debugInfo={},r.states=[],r.removeVideo=null,r._lastCheckTime=util.nowTime(),r._changeDefState=null,r._defInited=!1,r.states=[],r.preLoadData=null,r.forPreloadTimeCache=null,r._usePaused=!1,r.endofstream=!1,r.bufferEndTime=-1,r.hitpreload=!1,window&&window.location.href.indexOf("playerInstance=true")>-1&&(void 0===window.mp4PlayerInstanceList&&(window.mp4PlayerInstanceList=[]),window.mp4PlayerInstanceList.push(r.player)),r}return _createClass$8(o,[{key:"setConfig",value:function(e){this.config=Object.assign(this.config,e)}},{key:"afterCreate",value:function(){var e=this,t=this.playerConfig,r=this.config,n=this.player;r.width=t.width||0,r.height=t.height||0,t.vid=t.vid||r.vid,MSE.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"')&&(void 0===r.supportHevc&&null!=sniffer$1&&sniffer$1.isHevcSupported&&null!=sniffer$1&&sniffer$1.isHevcSupported()&&this.player.video instanceof HTMLVideoElement&&(r.supportHevc=!0),isEMESupported()||(r.useEME=!1),this.checkConfig(),r.onlyInit&&(t.autoplay=!1,t.videoInit=!1,this._hasStartProgress=!1,this._hasStartProgressBack=!1),t.useWaterLevel&&(!t.userGestureEventMiddleware&&(t.userGestureEventMiddleware=userGestureEventMiddleware),!t.videoEventMiddleware&&n.setEventsMiddleware(videoEventMiddleware)),this.gapJumpInst=new GapJump(this.player,this.playerConfig),this.preloader=r.isOpenPreload?new Mp4Preloader(this.config,this,this.bitRateAdapter):null,n.preloader=this.preloader,this._proxyPlayer(),this.initAwManager(),n.useHooks("replay",this._replayHook),n.useHooks("play",this._playHook),n.useHooks("pause",this._pauseHook),n.useHooks("retry",this._retryHook),n.video.addEventListener(CUSTOM_EVENTS.BUFFERED_RESET,this._onBufferedReset),this._bindNetworkStateChange(),this.on(TIME_UPDATE,this._onVideoTimeUpdate),this.on(LOADED_DATA,(function(){e.changeState("LOADED_DATA"),e.deleteVideo(),e._firstSegState=2,e._onTimeUpdate(),e._firstFrameTime()})),this.on(LOAD_START,(function(){e.changeState("LOAD_START"),e._loadStartEventTime=util.nowTime(),e.codecType!==CODEC_TYPE.H265||e.config.supportHevc||(e._isMseInit=!0,e._onTimeUpdate())})),this.on("xglog",(function(t){if("firstFrame"===t.eventType){var r=e.preLoadData&&e.preLoadData.definition?e.preLoadData.definition:-1;e.codecType===CODEC_TYPE.H264?console.log("[xgplayer-encrypt-mp4]>>>>firstFrame ",e.playerConfig.vid,t.fvt,", codectype: ",e.codecType,", hitpreload: ",e.hitpreload,", video: ",e._useVideoLoad,",curPlayBitrate: ",e.player.curDefinition.definition,", preloadBitrate: ",r,",metaLoad, ",e.firstFrameTime.metaload,", mseOpen: ",e.firstFrameTime.mseopen,",appendInit: ",e.firstFrameTime.metaready_initsegend):console.log("[xgplayer-encrypt-mp4]>>>>firstFrame ",e.playerConfig.vid,t.fvt,", codectype: ",e.codecType,", hitpreload: ",e.hitpreload,",curPlayBitrate: ",e.player.curDefinition.definition,", preloadBitrate: ",r,",metaLoad, ",e.firstFrameTime.metaload)}})),n.mp4MseFlag=!0)}},{key:"_startBufferCheck",value:function(){var e=this.player;if(e.video){var t=[];if(e.video.buffered){for(var r=0,n=e.video.buffered.length;r<n;r++)t.push([e.video.buffered.start(r),e.video.buffered.end(r)]);t.toString()!==this.lastBuffer&&(this.lastBuffer=t.toString(),this._onBufferReachThreshold())}}}},{key:"_onBufferReachThreshold",value:function(){var e=this.player,t=this.config;if(e.video){for(var r=e.video.buffered,n=0,i=0,a=0;a<r.length&&(n=r.start(a),i=r.end(a),!(n<=e.video.currentTime&&e.video.currentTime<=i));a++);i-e.video.currentTime>=t.bufferThreshold&&!this._hasTriggerBufferThreshold&&(this._hasTriggerBufferThreshold=!0,e.emit("BUFFER_THRESHOLD",i-e.video.currentTime))}}},{key:"_startUrlExpiredCheck",value:function(){var e=this.player.config;e.definition&&e.definition.list&&e.definition.list.length>0&&(this.urlExpireTimestamp=e.definition.list[0].url_expire||0,this._handleUrlExpire())}},{key:"checkConfig",value:function(){var e=this.playerConfig,t=this.config,r=e.defaultDefinition,n=e.defaultBitrate;if(!r){var i=this.playerConfig.definition;r=i&&i.defaultDefinition?i.defaultDefinition:t.definition}!n&&t.bitrate&&(n=t.bitrate),e.defaultDefinition=r,e.defaultBitrate=n}},{key:"beforePlayerInit",value:function(){var e=this.player,t=this;this._isInit||(BasePlugin.defineGetterOrSetter(e,{__url:{get:function(){return t.mse?t.mse.url:e.config.url},configurable:!0},downloadSpeed:{get:function(){return _realTimeSpeed/8},configurable:!0},playerVersion:{get:function(){return version$1},configurable:!0},menuCodeType:{get:function(){return t.mp4&&t.mp4.meta?t.mp4.meta.videoCodec:"avc"},configurable:!0},playerType:{get:function(){return"MP4"},configurable:!0},supportMenus:{get:function(){return{speed:e.mp4MseFlag,cdn:e.mp4MseFlag,resolution:e.mp4MseFlag}},configurable:!0},CDNUrl:{get:function(){return t.CDNUrl},configurable:!0},abrInstance:{get:function(){return t.abrInstance},configurable:!0},ext:{get:function(){var e,r,n,i,a,o,s=[];if(null!==(e=t.player)&&void 0!==e&&null!==(r=e.video)&&void 0!==r&&r.buffered)for(var l=t.player.video.buffered,u=0,c=l.length;u<c;u++)s.push([l.start(u),l.end(u)]);var d=[];if(t.mse)for(var h=Math.min(t.opQueueLen,5),f=0;f<h;f++)d.push(t.mse.opQueues.video[f].context);return{type:"MP4",usevideo:t.useVideoLoad,duration:null===(n=t.mp4)||void 0===n||null===(i=n.meta)||void 0===i?void 0:i.duration,loadseg:{loadIdx:t._curLoadSegmentIdx,loadTimeRange:null!==(a=t.mp4)&&void 0!==a&&a.timeRange?t.mp4.timeRange[t._curLoadSegmentIdx]:{},waitIdx:t.debugInfo.loadIndx,waitTimeRange:null!==(o=t.mp4)&&void 0!==o&&o.timeRange&&void 0!==t.debugInfo.loadIndx?t.mp4.timeRange[t.debugInfo.loadIndx]:{}},bufffer:s,speed:t.debugInfo.speed,states:t.states,mseque:d,url:t.playerConfig.url}},configurable:!0}}),this._isInit=!0)}},{key:"destroy",value:function(){var e=this.player;console.log("[Index] destroy",this.playerId),this.preloader&&this.preloader.destroy(this.playerId),e.preloader=null,e.removeHooks("replay",this._replayHook),e.removeHooks("play",this._playHook),e.removeHooks("pause",this._pauseHook),e.removeHooks("retry",this._retryHook),this._reset(),this._onDestroyWasm(),this.player.playNext=_playerPlayNext,this.player._startInit=_playerStartInit,this.player.changeDefinition=_playerChangeDefinition,this.player.switchURL=_playerSwitchUrl,this._unbindNetworkStateChange(),e.video&&e.video.removeEventListener(CUSTOM_EVENTS.BUFFERED_RESET,this._onBufferedReset),this._bufferCheckTimer&&clearInterval(this._bufferCheckTimer),this._removeBufferTimer&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null)}},{key:"initAwManager",value:function(){var e=this,t=this.config;this.awManager||(this.awManager=new AwManager(t.cdnHost,t.cdnBucket));var r=new ProxyPromise;if(r.id="aw",this._awPromise=r,t.isEncrypt){var n=new WasmManager;n.push(this.awManager.init()),n.startup().then((function(){n.destroy(),r.resolve()})).catch((function(t){n.destroy(),e._emitInitFail(t),r.reject()}))}else r.resolve()}},{key:"_proxyPlayer",value:function(){var e=this;"function"==typeof this.player.playNext&&(_playerPlayNext=this.player.playNext),this.player.playNext=function(){e.playNext.apply(e,arguments)},_playerStartInit=this.player._startInit,_playerSwitchUrl=this.player.switchURL,_playerChangeDefinition=this.player.changeDefinition,this.player._startInit=this.playerStartInit.bind(this),this.player.switchURL=this.switchURL.bind(this),this.player.changeDefinition=this.changeDefinition.bind(this)}},{key:"getInitBitrate",value:function(){var e=this,t=this.player,r=this.config,n=this.playerConfig,i=null,a=t.definitionList;return a&&a.length>0&&(a.map((function(t){var r=Mp4Preloader.generateUniqueKey({vid:n.vid,definition:t.definition||"",vtype:n.vtype,codecType:n.codecType});t.cacheKey=r,r&&!i&&e.preloader&&e.preloader.hasItemSameVid(r)&&((i=t).type="preload")})),i&&n.userSelectDefinition&&r.focusUserDefinition&&(console.log("[Index] getInitBitrate","preloadDefinition: ".concat(i.definition," userSelectDefinition:").concat(n.userSelectDefinition)),n.userSelectDefinition!==i.definition&&(i=null)),!i&&this.bitRateAdapter&&(this.bitRateAdapter.speed=MP4$1.speed,(i=this.getDefinitonFromAdapter(a,n.userSelectDefinition))&&(i.type="bitRateAdapter"))),i&&i.url||(i="Array"===util$2.typeOf(n.url)&&n.url.length>0||"String"===util$2.typeOf(n.url)&&n.url?{url:n.url,definition:n.defaultDefinition,duration:n.duration||this.config.duration||0,bitrate:n.defaultBitrate||this._getBitrateByDefition(n.defaultDefinition),type:"default"}:a[a.length-1]),this.playerConfig.url=i.url,i.networkSpeed=MP4$1.speed,i.fileSize=util.getFileSize(i.bitrate,n.duration),t.curDefinition=i,i}},{key:"_setPlayerSrc",value:function(e){var t=this.player;this._removeVideoSource(),"Array"===util$2.typeOf(e)?(t.video.removeAttribute("src"),!t._detachSourceEvents&&e.forEach((function(e){t.video.appendChild(util$2.createDom("source","",{src:"".concat(e.src),type:"".concat(e.type||"")}))})),t._attachSourceEvents(t.video,e),t.play()):(t.video.src=e,t.play()),t.mp4MseFlag=!1,t.emit("playertypechange")}},{key:"_removeVideoSource",value:function(e){var t=this.player,r=(e=e||t.video).children;if(r.length>0)for(t._detachSourceEvents(e);r.length>0;)e.removeChild(r[0])}},{key:"_getBitrateByDefition",value:function(e){var t=this.playerConfig,r=0;if(!t.definition||!t.definition.list)return r;for(var n=0;n<t.definition.list.length;n++){var i=t.definition.list[n];i.definition===e&&(r=i.bitrate)}return r}},{key:"_getDefinitionItem",value:function(e){for(var t=this.playerConfig,r=0;r<t.definition.list.length;r++){var n=t.definition.list[r];if(n.definition===e)return n}return null}},{key:"_initAbrDefinition",value:function(){var e=this.player,t=this.playerConfig;if(t.definition.list.length>0&&(e.curDefinition||(e.curDefinition=t.definition.list[0]),e.curDefinition.vwidth||Object.assign(e.curDefinition,this._getDefinitionItem(e.curDefinition.definition)),this._abrService.updateAbrCacheData()),this._abrService&&this._abrService.isCurrentAutoDefi){var r=t.definition.list.length;e.curDefinition=t.definition.list[r-1]}for(var n=0;n<t.definition.list.length;n++){var i=t.definition.list[n];e.curDefinition.definition===i.definition?i.selected=!0:i.selected=!1}console.log("resourceReady",t.definition.list.concat()),this.player.emit("resourceReady",t.definition.list);var a=e.curDefinition.bitrate;if(!a)for(var o=0;o<t.definition.list.length;o++){var s=t.definition.list[o];s.definition===e.curDefinition.definition&&(a=s.bitrate)}this._abrService.updateBitrate(a)}},{key:"_initAbrService",value:(i=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(){var t,r;return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.playerConfig,(r=this.config).autoBitrateOpts&&r.autoBitrateOpts.isOpenAutoDefi){e.next=3;break}return e.abrupt("return");case 3:return this._abrService=new AbrService(this,this.abrSwitchURL),e.next=6,this._abrService.init({video:t.definition.list.concat()});case 6:this._initAbrDefinition();case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_initMp4Kernel",value:function(){var t=this;this.firstFrameTime.newplayer_initkernel=util.nowTime()-this.firstFrameTime.newplayer,this.log("[===========], initMp4Kernel,",util.nowTime());var r=this.playerConfig,n=this.config,i=new ProxyPromise;try{var a=this._defInited?null:this.getInitBitrate();if(this._defInited=!0,this.log("curDefinition",a),this.log("[_initMp4Kernel] ".concat(r.vid," curDefinition"),a),!this._handlerUrl(r.url))return i.reject(new Error("emptyUrl")),i;if(n.forceVideoPlay&&(this.codecType===CODEC_TYPE.H264||n.supportHevc))return this.useVideoLoad=!0,i.reject("forceVideoPlay"),i;var o=[];o.push(this._getLicense()),o.push(this._checkPreloader()),Promise.all(o).then((function(e){t.isDestroy&&i.reject(new Error("destroy"));var r=null;if(e&&e.length>0&&e[1]&&(r=e[1].data),r||!n.needPreloadCheck||t.codecType===CODEC_TYPE.H265&&!n.supportHevc)if(t._vtype&&"MP3"===t._vtype)t.useVideoLoad=!0,i.reject(new Error("vtype_not_MP4"));else{var o=n._mainURL;t._initMp4(o,r,{fileSize:a?a.fileSize:0}),t._initAbrService()}else t.useVideoLoad=!0,i.reject(new Error("no_preload"))})).catch((function(e){console.error(e),e.errorType="GET_LICENSE_ERROR",t.emit("error",e),t.changeState("LICENSE_ERROR",{d:a?a.definition:0}),i.reject(e)}))}catch(e){i.reject(e)}return i}},{key:"playerStartInit",value:function(e){var t=this;if(this.log("playerStartInit",this.player.hasStart),!this.isDestroy){if(!e||"__auto__"===e||"anytext"===e){var r=this.playerConfig,n=r.definition;if(n&&n.list&&n.list.length>0&&n.defaultDefinition&&(n.list.map((function(e){e.definition===n.defaultDefinition&&(r.url=e.url,t.player.curDefinition=e)})),!r.url||"__auto__"===e||"anytext"===e)){var i=n.list[0];e=i.url,r.url=i.url,this.player.curDefinition=i}}if(this.useVideoLoad)_playerStartInit.call(this.player,e);else{this.player.mp4MseFlag=!0,this.bufferEndTime=-1,this._tm=(new Date).getTime(),this._reset();var a=this.playerConfig.vid;this.preloader&&this.preloader.cancelPreloadByVid(a),this.changeState("PLAYER_START_INIT"),this._awPromise.then((function(){if(!t.isDestroy){t.changeState("AW_OK INIT_MP4_KERNEL");var r=t._initMp4Kernel();t._initPromise=r,t._addPendingPromise(t._initPromise),r.then((function(r){t.isDestroy||(t.log("[Index] _initMp4Kernel.then vid:".concat(a," isDestroy").concat(t.isDestroy),r,t.mse?t.mse.url:""),t.mse&&(e=t.mse.url),t.changeState("PLAY_INIT_OK"),t._bindEvents(),t._startProgress())})).catch((function(r){var n=!!t._initPromise&&t._initPromise.isBreak;if(!t.isDestroy&&!n)if(console.error("_initMp4Kernel.catch: ".concat(a," isDestroy:").concat(t.isDestroy," _initPromise.isBreak:").concat(n),r),-499897!==r.errorCode){var i=r;i.errorCode||((i=new Errors$1(t.player,{errorType:"runtime",errorTypeCode:ERROR_TYPES.runtime,errorCode:ERROR_CODES.other,vid:t.playerConfig.vid,errorMessage:null==r?void 0:r.message,mediaError:{code:ERROR_CODES.other,message:null==r?void 0:r.message}})).url=e),t.changeState("PLAY_INIT_CATCH",{c:i.errorCode,m:i.message}),t.player.vtype="MP4_1",t.player.emit("playCatch",t.player.vtype,i)}else t._emitExpireEvent(r)})).finally((function(){if(t._initPromise){var r=t._initPromise.isBreak;t._initPromise&&t._removePendingPromise(t._initPromise),t._initPromise=null,t._usePaused&&(t.playerConfig.autoplay=!1),t.codecType===CODEC_TYPE.H265&&"Array"===util$2.typeOf(e)&&(e=e[0].src),t.log("_initMp4Kernel.finally:isDestroy".concat(t.isDestroy," _initPromise.isBreak:").concat(r)),t.log("[===========], playerStartInit,",util.nowTime()),t.changeState("PLAY_INIT_FINALLY"),!t.isDestroy&&!r&&_playerStartInit.call(t.player,e)}}))}})).catch((function(r){t.log("_awPromise.error",r),t.changeState("PLAY_INIT_CATCH"),!t.isDestroy&&_playerStartInit.call(t.player,e)})),this._abrService&&this._abrService.isCurrentInAbr()&&(this._abrService.enable(),this._abrService.execute())}}}},{key:"playNext",value:function(e){var t=this.player;this._defInited=!1,t.resetState(),t._currentTime=0,t._duration=0,t.isPlaying=!1,this._useVideoLoad=!1,t.pause(),this._reset(),e.vtype&&(this._vtype=e.vtype.toUpperCase()),t.setConfig(e);var r=this.codecType;this.codecType=e.codecType?e.codecType.toLowerCase():CODEC_TYPE.H264,r!==this.codecType&&this.h265_h264_switch(this.playerConfig.mediaType||"video"),this.checkConfig(),this.initAwManager(),this.log("[Index] playNext",e),t.play(),this.emit("playnext")}},{key:"h265_h264_switch",value:function(e){this.log("h265_switch_h264");var t=this.player,r=util$2.createDom(e,"",this.getVideoConfig(this.playerConfig),"xgplayer-".concat(e,"-img"));this.removeVideo=t.video,r.muted=t.video.muted,r.volume=t.video.volume,t.video=r,t.attachVideoEvents(t.video)}},{key:"getVideoConfig",value:function(e){var t=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:2,mediaType:e.mediaType||"video"},e.videoConfig,e.videoAttributes);return e.loop&&(t.loop="loop"),t}},{key:"next",value:function(e){this.playNext(e)}},{key:"oldChangeDefinition",value:function(e,t){var r=this,n=this.config,i=this.player,a=this.playerConfig;i.emit(DEFINITION_CHANGE,{from:t,to:e}),i.emit(WAITING);var o=i.definitionList.filter((function(t){return t.definition===e.definition||t.definition===Number(e.definition)})),s=i.definitionList.filter((function(e){return e.definition===t.definition||e.definition===Number(t.definition)}));if(s.length>0&&(s[0].selected=!1),o.length>0){(e=o[0]).selected=!0,i.curDefinition=e,this.log("[oldChangeDefinition],currentTime,",i.currentTime,",from,",t,",to,",e);var l=i.currentTime,u=i.paused;this._changeDefState||(this._changeDefState={currentTime:l,paused:u},this.log("[oldChangeDefinition],currentTime,",i.currentTime,",pause,",u)),n.definition=e.definition,this.config.keyValue=e.keyValue,this.config.kid=e.kid,this.config.secretKey=e.secretKey,this.config.drm=e.drm,this.config.getLicenseUrl=e.getLicenseUrl,a.url=e.url,a.backupURL=e.backupURL,a.userSelectDefinition=e.definition,a.defaultDefinition=e.definition,n.focusUserDefinition=!0,i.currentTime=0,i.pause(),this._reset(),this._isMseInit=!1,this.eme=null,this._handlerUrl(e.url),this._changeDefineCanPlay&&i.off("canplay",this._changeDefineCanPlay),this._changeDefineCanPlay=function(){r.changeDefineCanPlay(l,u,t,e),r._changeDefineCanPlay=null},i.once("canplay",this._changeDefineCanPlay),this.player.video.load(),this.playerStartInit(a.url)}}},{key:"switchURL",value:function(e){if(this.useVideoLoad)_playerSwitchUrl.call(this.player,e);else{var t=this.player,r=this.playerConfig;this.config.keyValue=e.keyValue,r.url=e.url,r.backupURL=e.backupURL,t.currentTime=0,t.pause(),this.reset(),this._isMseInit=!1,this.eme=null,this._handlerUrl(e.url),t.video.removeAttribute("src"),this._removeVideoSource(),t.resetState()}}},{key:"_handlerUrl",value:function(e){var t,r=this.config,n=this.playerConfig;if(!e)return!1;var i=[];if("String"===util$2.typeOf(e))t=e,n.backupURL&&i.push(n.backupURL);else if("Array"===util$2.typeOf(e)&&e.length>0&&(t=e[0].src,e.length>1))for(var a=1;a<e.length;a++)i.push(util.extUrl(e[a].src,{__vid:n.vid}));return!(!t&&0===i.length)&&(r._mainURL=util.extUrl(t,{__vid:n.vid}),r._backupURL=i,!0)}},{key:"_firstFrameTime",value:function(){if(this.codecType===CODEC_TYPE.H264||this.config.supportHevc){if(this.firstFrameTime.new_loadeddata<0){this.firstFrameTime.loadst_loadeddata=util.nowTime()-this.loadstart,this.firstFrameTime.new_loadeddata=util.nowTime()-this.firstFrameTime.newplayer;var e={};for(var t in this.firstFrameTime)Object.prototype.hasOwnProperty.call(this.firstFrameTime,t)&&(this.log("======this.firstFrameTime======",t,", ",this.firstFrameTime[t]),e[t]=this.firstFrameTime[t])}}else if(this.codecType===CODEC_TYPE.H265){var r=this.player.video.getStats(),n=this.firstFrameTime.metaload,i=this.firstFrameTime.startMuxTime;this.firstFrameTime=r,this.firstFrameTime.metaload=n,this.firstFrameTime.startload_stmux=i,this.firstFrameTime.firstmux=this.mp4?this.mp4.firstFrameTime.firstmux:-1;for(var a=0;a<r.bootStats.length;a++)this.firstFrameTime[r.bootStats[a].action]=r.bootStats[a].dot;delete this.firstFrameTime.bootStats,this.log("======this.firstFrameTime===>>",JSON.stringify(this.firstFrameTime))}}},{key:"_bindEvents",value:function(){var e=this,t=this.config,r=this.player;this._isEventInit||(this.on("seeking",this._onSeeking),this.on("waiting",this._onWaiting),this.on("ended",this._onEnded),this.on("error",this._onVideoError),this.on("playing",this._onPlaying),this.on("detectGap",(function(){t.gapDegrade&&t.useEME&&(t.useEME=!1,e._replay())})),this.on("error",(function(t){e.changeState("video_error",{code:t.code,message:t.message,videoType:e.useVideoLoad})})),r.setEventsMiddleware({error:function(t,r){var n=t.originalEvent;e.changeState("video_error",{code:n.code,message:n.message,videoType:e.useVideoLoad}),e.log("error middleware",t,",useVideoLoad,",e.useVideoLoad),e.useVideoLoad&&r(t.eventName,n)}})),this._isEventInit=!0}},{key:"deleteVideo",value:function(){if(this.removeVideo){var e=this.removeVideo.parentNode;e&&e.removeChild(this.removeVideo),this.removeVideo=null,this.log("[_removeVideoSource]")}}},{key:"_unbindEvents",value:function(){this.off("seeking",this._onSeeking),this.off("waiting",this._onWaiting),this.off("ended",this._onEnded),this.off("playing",this._onPlaying),this._isEventInit=!1}},{key:"changeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._pTime||(this._pTime=util.nowTime());var r=util.nowTime()-this._pTime,n=util.nowTime()-this._sTime;this.log(">>>changeState[".concat(e,"]"),r,n,t),this.states.push({state:e,t1:r,t2:n,data:t}),this._pTime=util.nowTime();var i=util.nowTime()-this._pTime;t.state=e,i&&(t.t=i)}},{key:"checkIfCanPreload",value:function(){var e=this.player,t=this.useVideoLoad,r=this.config;if(r.isOpenPreload){var n=t?5:r.minBufferLength,i=e.currentTime+n;i=i>e.duration?e.duration:i;var a=(t?e.getBufferedRange(e.buffered):e.getBufferedRange(e.buffered2))[1]-i;e.currentTime>=n&&(a>0||Math.abs(a)<1)&&this.preloader&&this.preloader.checkCanPreloadNext()&&this.emit("PRELOAD_NEXT")}}},{key:"_getLicense",value:function(){var e=this,t=this.config,r=t.vid,n=t.kid,i=t.secretKey,a=t.keyValue,o=new ProxyPromise,s={method:"getLicense",success:0};if(n&&a){var l={clearKeys:{}};l.clearKeys[n]=a,this.config.drm=l,s.success=1,o.resolve(s)}else if(n||i){var u=getKeyValue(r,n,i,this);u.id="licensePromise",this._addPendingPromise(u),u.then((function(t){e._removePendingPromise(u),t.clearKeys?e.config.drm=t:e.config.keyValue=t,s.success=1,o.resolve(s)})).catch((function(t){e.log("licensePromise reject"),s.success=0,s.error=t,o.reject(s)}))}else s.success=0,o.resolve(s);return o}},{key:"softDecode",get:function(){var e,t;return"xg-video"===(null===(e=this.player)||void 0===e||null===(t=e.config)||void 0===t?void 0:t.mediaType)}},{key:"_initH265MseProxy",value:function(){this.player.video instanceof HTMLVideoElement&&this.h265_h264_switch(this.playerConfig.mediaType);var e=this.player.video;this.softDecode&&e.setPlayMode&&e.setPlayMode("VOD"),this.mseProxy=e,this.softDecode&&(this.player.forceDegradeToVideo=function(){},this.player.video.addEventListener("lowdecode",this._lowDecoder),this.player.video.addEventListener("error",this._onError))}},{key:"removeAndRejectInitPromise",value:function(e){this._initPromise&&(this._removePendingPromise(this._initPromise),this._initPromise.reject(e))}},{key:"_initMp4",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.firstFrameTime.initkernel_initmp4=util.nowTime()-this.firstFrameTime.newplayer-this.firstFrameTime.newplayer_initkernel;var i=this.config,a=this.player,o=this.playerConfig;this.mp4&&(this.mp4.off(MP4_EVENTS.META_READY,this._onMp4MetaReady),this.mp4.off(MP4_EVENTS.ERROR,this._onMp4Error),this.mp4.off(MP4_EVENTS.UPDATEEME,this._updateDrmConfig),this.mp4.off(MP4_EVENTS.TASK_PROGRESS,this._onMp4Progress),this.mp4.off(MP4_EVENTS.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.changeState("MP4_NEW",{}),this.mp4=new MP4$1(e,a.curDefinition.bitrate,{segmentDuration:i.segmentMinDuration,enableWorker:i.enableWorker,codecType:this.codecType,chunkSize:i.preloadSize,loadSize:800,duration:o.duration||0,fileSize:n.fileSize||0,playerId:this.playerId,vid:o.vid,useUrlRange:i.useUrlRange,retryCount:i.retryCount,retryDelay:i.retryDelay,onProcessMinLen:i.onProcessMinLen,supportHevc:i.supportHevc,reqOptions:i.reqOptions},this,null,r,this.config._backupURL,this.firstFrameTime,""),this.mp4.once(MP4_EVENTS.META_READY,this._onMp4MetaReady),this.mp4.on(MP4_EVENTS.ERROR,this._onMp4Error),this.mp4.on(MP4_EVENTS.UPDATEEME,this._updateDrmConfig),this.mp4.on(MP4_EVENTS.TASK_PROGRESS,this._onMp4Progress),this.mp4.on(MP4_EVENTS.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.on(MP4_EVENTS.CHANGE_URL,(function(e){t.player&&t.player.emit("initialUrl",{url:e})})),this.mp4.MP4Loader.on(REAL_TIME_SPEED_EVENT,(function(e){_realTimeSpeed=e.speed,t.debugInfo.speed||(t.debugInfo.speed=[]),t.debugInfo.speed.push(_realTimeSpeed),t.debugInfo.speed.length>10&&t.debugInfo.speed.shift(),t.emit(REAL_TIME_SPEED_EVENT,e)})),this.changeState("MP4_INIT",{}),this.emit("loadstart2"),this.mp4.init(r)}},{key:"_checkPreloader",value:function(){var e=this,t=this.playerConfig,r=new ProxyPromise,n={method:"checkPreloader",success:0,type:"error",cacheKey:""};this.changeState("CHECK_PRELOAD");var i=this.player.curDefinition,a=i.cacheKey?i.cacheKey:Mp4Preloader.generateUniqueKey({vid:t.vid,definition:i.definition||"",vtype:t.vtype,codecType:t.codecType});return n.cacheKey=a,this.preloader&&a?this.preloader.getPreLoadData(a).then((function(t){console.log(">>>>check Preloader result",a,t),t?(e.preLoadData=t,e.emit("PRELOAD_INFO",e.preLoadData),n.success=1,n.data=t,e.changeState("PRELOAD_OK",{l:e.preLoadData.byteLength,ck:a}),t.mediaSegList&&t.mediaSegList.length>0||t.buffer&&t.buffer.byteLength>0?e.hitpreload=!0:e.hitpreload=!1,r.resolve(n)):(e.preLoadData=null,e.changeState("PRELOAD_ERROR",{t:0}),n.success=0,n.error=new Error("none_preload"),r.resolve(n))})):(this.changeState("PRELOAD_ERROR",{t:2}),n.success=0,n.error=new Error("no_preloader"),r.resolve(n)),r}},{key:"_initEME",value:function(e,t){var r=this.player,n=this.config;n.useEME=!(!1===n.useEME||!n.supportHevc),this._updateDrmConfig(t),this.log("config.useEME: ",n.useEME);var i=n.drm;!this.eme&&i&&i.clearKeys&&n.useEME&&(this.eme=new EME(i),this.eme.setOptions('video/mp4; codecs="avc1.64001E"','audio/mp4; codecs="mp4a.40.2"'),this.eme.SetupEME(r.video))}},{key:"_initMse",value:(n=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function t(r){var n,i,a,o,s,l=this;return _regeneratorRuntime$4().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.playerConfig,!this.mse){t.next=5;break}return t.next=4,this.mse.unbindMedia();case 4:this.mse=null;case 5:n=this.mp4&&this.mp4.checkCodecH265(),i=!!r.videoCodec,a=!!r.audioCodec,o=i&&a?n?'video/mp4; codecs="hev1.1.6.L93.B0, mp4a.40.5"':'video/mp4; codecs="avc1.64001E, mp4a.40.5"':i?n?'video/mp4; codecs="hev1.1.6.L93.B0"':'video/mp4; codecs="avc1.64001E"':'video/mp4; codecs="mp4a.40.5"',s=_defineProperty$7({},MSE.VIDEO,{mimeType:"video/mp4",codec:o}),this.mse=new MSE,this.mse.bindMedia(this.player.video).then((function(t){l.changeState("MSE_OPEN"),l.firstFrameTime.initmse_sbopen=t.costtime,l._loadStartEventTime>0&&(l.firstFrameTime.mseopen=util.nowTime()-l._loadStartEventTime);var r=Object.keys(s);try{for(var n=0;n<r.length;n++){var i=r[n];l.mse.createSource(i,s[i].codec)}}catch(e){console.error("MSE error: ",e),l._errorHandler(e)}l.changeState("MSE_OPEN_DONE"),l._isMseInit=!0,l._onTimeUpdate()})),this.changeState("MSE_INIT");case 14:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"_appendInitSeg",value:function(e){var t=this;this.mp4&&this.mse&&(this.changeState("MSE_INITSEG"),this.log("[=======ready_append_init]",util.nowTime(),",isopen,",!!this.mse&&this.mse.isOpened),this.firstFrameTime.metaready_mseisopen=this.mse&&this.mse.ready?1:0,this.mse.append(MSE.VIDEO,e,{vid:this.playerConfig.vid,range:null,dataLen:e.byteLength,isinit:!0}).then((function(e){t.firstFrameTime.metaready_initsegend=e.costtime,t.log("appendInitSeg end ==>>>",e.context?e.context:null,", costTime,",e.costtime),t.changeState("MSE_INITSEG_OK",{costtime:e.costtime})})),this.mp4.useEME&&this.eme&&this.eme.emit("encrypted"))}},{key:"_checkMetaInfo",value:function(e){var t=null;return e?null:(t={errorCode:ERROR_CODES.metaError,errorMessage:"meta is null",errorType:"demux",errorTypeCode:ERROR_TYPES.demux},new Errors$1(this.player,_objectSpread2$4(_objectSpread2$4({},t),{},{vid:this.playerConfig.vid,mediaError:{code:t.errorCode,message:t.errorMessage}})))}},{key:"_stopProgress",value:function(){this._hasStartProgress=!1,this._requestTimer&&(this._requestTimer.stop(),this._requestTimer=null),this._bufferBreakTimer&&(clearTimeout(this._bufferBreakTimer),this._bufferBreakTimer=null,this._bufferBreakFlag=void 0)}},{key:"_bindNetworkStateChange",value:function(){window.addEventListener("online",this._onOnlineHandler),window.addEventListener("offline",this._onOfflineHandler)}},{key:"_unbindNetworkStateChange",value:function(){window.removeEventListener("online",this._onOnlineHandler),window.removeEventListener("offline",this._onOfflineHandler)}},{key:"_onSuperStart",value:function(e){var t=this,r=this.player;log$1("_onSuperStart:".concat(e),this.mse),r.video.src=e,this.once("canplay",(function(){r.play(),t.on("waiting",t._onWaiting)}))}},{key:"_appendBuffer",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=this.mse,o=this.playerConfig,s=o.vid;this.log("player appendBuffer start ==>>>",s,n.range,t.byteLength,", queueLen,",a&&a._queue[e]?a._queue[e].length:null),a.append(e,t,{vid:s,fragIndex:n.fragIndex,range:n.range,dataLen:t.byteLength,state:i}).then((function(e){if(r.log("player appendBuffer end ==>>>",e.context?e.context:null,", costTime,",e.costtime,", opt,",e.name,",bufferRange,",r.player.getBufferedRange()),r.firstFrameTime.loadst_loadeddata<0&&(r._firstSegState<0&&r._onTimeUpdate(),r.firstFrameTime.apcnt++,r.firstFrameTime.aplen+=e.context?e.context.dataLen:0,r.firstFrameTime.data_ap+=e.costtime,r.changeState("APPEND_DATA_OK",{costime:e.costtime,dataLen:e.context?e.context.dataLen:0})),r.mse&&n.state&&n.fragIndex===r.mp4.timeRange.length-1){var t=r.player.buffered;r.bufferEndTime=t.end(t.length-1),r._isEnded(),r.log("loaded ended !!!==>>>",n.range,", fragIndex,",n.fragIndex,", bufferEndTime,",r.bufferEndTime,",meta_duration,",r.mp4.meta.duration)}})).catch((function(e){if(console.log("[MSE error]",e),e&&r.mse.isFull()){var t=r.player.getBufferedRange(r.player.buffered2);r._checkRemoveSourceBuffer(t,r.player.currentTime,!0)}}))}},{key:"_loadData",value:(r=_asyncToGenerator$5(_regeneratorRuntime$4().mark((function e(){return _regeneratorRuntime$4().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.onLine){e.next=2;break}return e.abrupt("return");case 2:if(this.mp4&&this._isMseInit){e.next=5;break}return this.log("loadData, player.mp4 null",this._isMseInit),e.abrupt("return");case 5:return this.loadstart<0&&(this.loadstart=util.nowTime()),e.prev=6,e.next=9,this.mp4.load(this._curLoadSegmentIdx,this._loadDataSuccess);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.error("[Index] _loadData error",this.playerConfig.vid,e.t0);case 14:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(){return r.apply(this,arguments)})},{key:"getDataBitRate",value:function(e){var t=this.mp4,r=this.playerConfig;if(!t)return 0;for(var n=t.getDataBitRate(e),i=r.definition.list,a=0,o=0;o<i.length;o++)if(i[o].bitrate===n){a=i[o];break}return a}},{key:"_loadStuckCheck",value:function(){var e=this,t=this.config,r=this.playerConfig,n=this.player;t.disableBufferBreakCheck||(n.currentTime-(this._lastCurrentTime||0)>.1||n.paused?1!==this._bufferBreakFlag&&2!==this._bufferBreakFlag||(this.log(","),this._bufferBreakFlag=0,clearTimeout(this._bufferBreakTimer),this._bufferBreakFlag=null):this._bufferBreakFlag||(this._bufferBreakFlag=1,this.log("! ".concat(BUFFER_BREAK,"")),this._bufferBreakTimer=setTimeout((function(){e.isDestroy||(1===e._bufferBreakFlag&&(e._bufferBreakFlag=2,e.log("!!!"),e.emit("waittimeout"),e._errorHandler(new Errors$1(e.player,{errorType:"runtime",errorTypeCode:ERROR_TYPES.runtime,errorCode:ERROR_CODES.waitTimeout,errorMessage:"wait_timeout",vid:r.vid}))),e._bufferBreakTimer=null)}),BUFFER_BREAK)),this._lastCurrentTime=n.currentTime)}},{key:"_isInBuffer",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=!1,n=this.player.video.buffered,i=0;i<n.length;i++){var a=n.start(i)-t,o=n.end(i)+t;if(a<=e.startTime&&e.endTime<=o){r=!0;break}}return r}},{key:"_doubleCheckBuffer",value:function(e){var t=this.player;return!(e.startTime>t.currentTime)||(!t.video||!t.video.buffered||(1===t.video.buffered.length||this._isInBuffer(e,.2)))}},{key:"_onTimeUpdate",value:function(){var e=this,t=this.mse,r=this.mp4,n=this.player;if(r)if(this.useVideoLoad)this.checkIfCanPreload();else if(r){var i=r.timeRange;if(i&&!(i.length<1)&&1!==this._firstSegState){var a=n.getBufferedRange(n.buffered2);if((t||this.mseProxy)&&r&&r.canDownload){util.nowTime()-this._lastCheckTime>1e3&&(this._lastCheckTime=util.nowTime(),this._loadStuckCheck(),this._startUrlExpiredCheck(),this._checkRemoveSourceBuffer(a,n.currentTime));var o=n.paused?n.currentTime+this._minBufferLength:n.currentTime+this._maxBufferLength;a[1]-o<0&&i.every((function(t,r){if(t.downloaded){if(e._doubleCheckBuffer(t))return!0;t.downloaded=!1,t.isLoading=!1,e.log("onTimeUpdate, ".concat(r," download state error, no buffer, download again"))}if(t.endTime-t.startTime>1&&e._isInBuffer(t))return t.downloaded=!0,t.isLoading=!0,e.log("onTimeUpdate, ".concat(r," download segment, has buffer"),t.startTime,t.endTime),!0;t.startTime-n.currentTime<e._maxBufferLength&&(e._curLoadSegmentIdx=r,e.log("[onTimeUpdate],load index==>>>, ",r,",IdxTimeRange, ",t.startTime,"-",t.endTime,",buffEnd, ",a[1],",playCurTime,",n.currentTime,", bufferLen,",a[1]-n.currentTime,",bufferRangeList,",e.player.buffered2?e.player.buffered2.bufferedList:null),e._loadData())})),this.checkIfCanPreload(),this.playFlag&&!this._hasTriggerBufferThreshold&&this._startBufferCheck(),this._isEnded()}}}}},{key:"_reset",value:function(){for(var e in this.states=[],this.hitpreload=!1,this._sTime=util.nowTime(),this._usePaused=!1,this._firstSegState=-1,this.useVideoLoad=!1,this._isMseInit=!1,this.endofstream=!1,this._curLoadSegmentIdx=0,this.preLoadData=null,this.forPreloadTimeCache=null,this.playFlag=!1,this._waitAdjustTimeCnt=0,this._initPromise&&"pending"===this._initPromise.state&&this._initPromise.reject("DESTROYED"),clearTimeout(this.checkResumePlayTimer),this.checkResumePlayTimer=null,this._stopProgress(),this.mp4&&(this.mp4.off(MP4_EVENTS.META_READY,this._onMp4MetaReady),this.mp4.off(MP4_EVENTS.ERROR,this._onMp4Error),this.mp4.off(MP4_EVENTS.UPDATEEME,this._updateDrmConfig),this.mp4.off(MP4_EVENTS.TASK_PROGRESS,this._onMp4Progress),this.mp4.off(MP4_EVENTS.MOOV_REQ_PROGRESS,this._onMp4DataCallBack),this.mp4.destroy(),this.mp4=null),this.mse&&(this.mse.unbindMedia(),this.mse=null),this.mseProxy&&(this.player.video.removeEventListener("lowdecode",this._onDegrade),this.player.video.removeEventListener("error",this._onError)),this._unloadVideo(),this._cancelPendingPromises(),this._abrService&&(this._abrService.destroy(),this._abrService=null),this.firstFrameTime)Object.prototype.hasOwnProperty.call(this.firstFrameTime,e)&&(this.firstFrameTime[e]="apcnt"===e||"aplen"===e?0:"newplayer"===e?util.nowTime():-1);clearTimeout(this._waitInBufferTimer),this._waitInBufferTimer=null,this.loadstart=-1,this._loadStartEventTime=-1,this.startLoadData=-1}},{key:"removeErrorUrls",value:function(e,t,r){return-499897!==e.errorCode&&-499892!==e.errorCode||this._emitExpireEvent(e),r}},{key:"_errorHandler",value:function(e){var t=this.player,r=this.playerConfig,n=this.preLoadData;if(t){if(this.useVideoLoad)return console.log("useVideoLoad final error!!!!, ",r.vid,e),void this.emit("error",e);if("object"!==_typeof$3(e)){var i={};i.err=e,e=i}var a=t.paused;e.vid=r.vid,e.preloadHit=n&&n.byteLength>0?1:0,e.preloadCached=n?n.duration:0,e=new Errors$1(t,e),this.log("_errorHandle","preState is ".concat(a),e),!e.url&&(e.url=t.src),this.player.vtype="MP4_2",this.player.emit("playCatch",this.player.vtype,e),e.errd&&"object"===_typeof$3(e.errd)&&this.mp4&&(e.errd.url=this.mp4.url,e.url=this.mp4.url),e.codectype=this.codecType,this.emit("DATA_REPORT",e),this.mp4&&this.mp4.url&&this.removeErrorUrls(e,this.mp4.url,r.url),this.log("error task cancel"),this.mp4&&this.mp4.cancelLoading(),this._abrService&&this._abrService.disable(),this.mp4&&(this.mp4.canDownload=!1),this.mp4&&this.mp4.bufferCache&&this.mp4.bufferCache.clear(),this._startDegradedPlayback(e)}}},{key:"_startDegradedPlayback",value:function(e){var t=this;this.mp4&&(this.mp4.canDownload=!1);var r=this.player,n=this.playerConfig;this.endofstream=!1,this._currentTime=r.currentTime||0,this.player.pause(),this._reset(),this._replay=null,this.codecType===CODEC_TYPE.H265?(console.log("h265 err,degrade use 264 play",n.vid),this._onDegrade(e)):this.codecType===CODEC_TYPE.H264&&(this.config.drm?(this.config.drm&&Object.keys(this.config.drm).map((function(r){t.config.drm&&(e[r]=t.config.drm[r])})),console.log("final error !!!!, ",n.vid,e),this.emit("error",e)):(this.emit("H264_DEGRADE",e),this.useVideoLoad=!0,this._setPlayerSrc(n.url),this.once("canplay",(function(){t._currentTime&&(r.currentTime=t._currentTime),!r.paused&&r.play()}))))}},{key:"_startProgress",value:function(){var e=this;this._hasStartProgress||(this._stopProgress(),this._requestTimer=new Timer((function(){e._requestTimer&&e._onTimeUpdate()})),this._requestTimer.tickEvery(this._tickInSeconds),this._hasStartProgress=!0)}},{key:"_unloadVideo",value:function(){var e=this.player;try{this.log("unloadVideo src ".concat(e.video.src)),e.video&&e.video.src&&(e.video.removeAttribute("src"),e.video.load())}catch(error){this.log("unloadVideo error",error)}}},{key:"_addPendingPromise",value:function(e){this._pendingPromises.push(e)}},{key:"_removePendingPromise",value:function(e){this.log("removePendingPromise",e.id);var t=this._pendingPromises.indexOf(e);t>-1&&this._pendingPromises.splice(t,1)}},{key:"_cancelPendingPromises",value:function(){this._pendingPromises.length>0&&this._pendingPromises.forEach((function(e){e.reject(DESTROYED)})),this._pendingPromises=[]}},{key:"_onMediaExpired",value:function(){this._stopProgress(),this.emit(CUSTOM_EVENTS.MEDIA_EXPIRED)}},{key:"_onDestroyWasm",value:function(){this.awManager&&(this.awManager.destroy(),this.awManager=null)}},{key:"_isEnded",value:function(){var e=this.player,t=this.mp4,r=e.bufferedPoint,n=r?r.end:0;return!this.endofstream&&this.bufferEndTime>0&&this.mse&&this.bufferEndTime-e.currentTime<.5&&(this.log("[check player isEnded],deal mse.endOfStream, currentTime,",e.currentTime,", bufferend,",n,", duration,",t.meta.duration),this.endofstream=!0,this.mse.endOfStream()),!!(t&&t.meta&&t.meta.duration-e.currentTime<.5)&&(this._stopProgress(),this.log("[check player isEnded],stopProgress and endOfStream,currentTime, ",e.currentTime,", bufferend,",n,", duration,",t.meta.duration),this.mse&&this.mse.endOfStream(),!0)}},{key:"_clearMediaKeys",value:function(){var e=this.player;e.video&&"function"==typeof e.video.setMediaKeys&&e.video.setMediaKeys(null).catch((function(){}))}},{key:"_checkRemoveSourceBuffer",value:function(e,t,r,n){var i=this,a=this.mse,o=this.mp4,s=this.player;if(a&&o&&s&&(r&&(clearTimeout(this._removeBufferTimer),this._removeBufferTimer=null),e||(e=s.getBufferedRange(s.buffered2)),t||(t=s.currentTime),!(!r&&util.nowTime()-this._checkRemoveBufferLastTime<=this.config.removeBufferLen||this.endofstream)&&(this._checkRemoveBufferLastTime=util.nowTime(),e&&e[0]>=0&&(t-e[0]>this.config.removeBufferLen||a.isFull())))){var l=n?e[1]:t-(a.isFull()?0:15),u=o.getFragmentIdx(l);if(u>=0&&(n||o.timeRange[u].startTime<t)){var c=Math.floor(Math.min(o.timeRange[u].startTime,e[1]));e[0]<c?(this.log("[checkremoveSourceBuffer], remove range==>>>",e[0],c),a.remove(MSE.VIDEO,e[0],c)):a.isFull()&&!this._removeBufferTimer&&(this.log("[after 10s, go on checkremoveSourceBuffer], currentTime==>>>",t,", buffer start,",e[0]),this._removeBufferTimer=setTimeout((function(){i._checkRemoveSourceBuffer(null,null,!0)}),1e4))}}}},{key:"onMediaUpdate",value:function(e){var t=e.vid,r=e.kid,n=e.url,i=this.player,a=this.config;if(t===this.playerConfig.vid&&r===a.kid&&n){this.playerConfig.url=n,this._handlerUrl(n);var o=a._mainURL;return this.useVideoLoad?i.src=n:this.mp4&&this.mp4.update(o),!0}return!1}},{key:"enableAutoBuffer",value:function(e){var t=this;if(e){if(!this._allInitPromise)return void this.log("player destroyed!!");this._allInitPromise.then((function(){t.log("enableAutoBuffer true"),t._startProgress()}))}else this._stopProgress(),this.log("enableAutoBuffer false")}},{key:"bitRateAdapter",get:function(){return this.player&&this.player.plugins&&this.config.needAutoBitrate?this.player.plugins.bitrateselector:null}},{key:"getDefinitonFromAdapter",value:function(e,t){if(!this.bitRateAdapter)return null;var r=this.bitRateAdapter;return r.getSuitableBitrate?r.getSuitableBitrate(e,t):r.bitRateAdapter?r.bitRateAdapter.select(e):null}},{key:"addPreloader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.playerId=this.playerId,this.preloader?this.preloader.addPreloader(e,this.playerId,this.playerConfig.vid):this.log("preloader has destroyed")}},{key:"addPreloaderList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.preloader?this.preloader.addPreloaderList(e,this.playerId,this.playerConfig.vid):this.log("preloader has destroyed")}},{key:"changeUserSelectDefinition",value:function(e){this.preloader&&e&&this.preloader.changeUserSelectDefinition(e)}},{key:"log",value:function(e){for(var t=this.playerConfig,r=t&&t.vid?"[Index]".concat(t.vid," ").concat(e):"[Index] ".concat(e),n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];log$1.apply(void 0,[r].concat(i))}},{key:"_emitInitFail",value:function(e){this.log("initFail, reason:",e),this.emit(CUSTOM_EVENTS.INIT_FAIL,e)}},{key:"emitParseError",value:function(){this.log("parseError"),this.emit(CUSTOM_EVENTS.PARSE_ERROR)}},{key:"useVideoLoad",get:function(){return this._useVideoLoad},set:function(e){this._useVideoLoad=e}},{key:"ready",get:function(){return this._allInitPromise}},{key:"speed",get:function(){return parseInt(MP4$1.speed,10)}},{key:"version",get:function(){return version$1}},{key:"realTimeSpeed",get:function(){return _realTimeSpeed}},{key:"opQueueLen",get:function(){var e=this.mse&&this.mse._queue?this.mse._queue[MSE.VIDEO]:[];return e?e.length:0}},{key:"loadSegmentTimeRange",get:function(){if(!this.mp4)return[0,0,0,0];var e=this.mp4.timeRange;if(e&&e.length>0&&this._curLoadSegmentIdx&&this._curLoadSegmentIdx<e.length){var t=e[this._curLoadSegmentIdx];if(t.isLoading){var r=this.mp4.getFragRange(this._curLoadSegmentIdx);return[Number(t.startTime),Number(t.endTime)].concat(_toConsumableArray$4(r))}}return[0,0,0,0]}},{key:"preloadState",get:function(){return this.preloader&&this.preloader.loadingCount}},{key:"moovSize",get:function(){return 0}},{key:"isDestroy",get:function(){return!this.player}},{key:"cancelPreloadTask",value:function(){this.preloader&&this.preloader.cancelLoading(this.player.playerId)}},{key:"CDNUrl",get:function(){var e=this.playerConfig.url,t=document.createElement("a");return t.href=e,t.host}},{key:"abrInstance",get:function(){return this._abrService?this._abrService.abrInstance:null}},{key:"_handleUrlExpire",value:function(){var e=this,t=this.config,r=this.player,n=r.paused;(new Date).getTime()/1e3>=this.urlExpireTimestamp&&this.urlExpireTimestamp>0&&!n&&t.getServerTime&&(r.serverTimeDiffPromise=r.serverTimeDiffPromise||t.getServerTime().catch((function(){return 0})),r.serverTimeDiffPromise.then((function(t){if(t&&(r.serverTimeDiff=(new Date).getTime()/1e3-t),(new Date).getTime()/1e3>=e.urlExpireTimestamp+r.serverTimeDiff){e.urlExpireTimestamp=(new Date).getTime()/1e3+86400;var n=new NetWorkError("network",ERROR_CODES[403]);e._emitExpireEvent(n)}})))}},{key:"_emitExpireEvent",value:function(e){var t=this.player,r=(new Date).getTime()/1e3;this.emitExpireTimestamp?r-this.emitExpireTimestamp>300&&(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e)):(this.emitExpireTimestamp=r,t.emit("MEDIA_EXPIRED",e))}}],[{key:"registerPreloader",value:function(e,t){e.vtype=VTYPES.MP4,Mp4Preloader.BitRateAdapter=t,new Mp4Preloader(e,this)}},{key:"pluginName",get:function(){return"Mp4EncryptPlayer"}},{key:"defaultConfig",get:function(){return{onlyInit:!1,useWaterLevel:!1,maxBufferLength:10,minBufferLength:5,tickInSeconds:.2,getLicenseUrl:"",xhrSetup:{},retryCount:1,retryDelay:1e3,preloadCacheType:1,needPreloadRangeList:!1,cdnHost:"",cdnBucket:"",isEncrypt:!1,isOpenPreload:!0,needPreloadCheck:!1,preloadTime:0,preloadMaxCacheCount:0,needAutoBitrate:!0,keyValue:null,drm:null,switchBitRateWay:!1,enableWorker:!1,bufferThreshold:10,removeBufferLen:40,focusUserDefinition:!1,resumePlayWaterLevel:2,waitJampBufferMaxCnt:3,waitingInBufferTimeOut:5e3,h265Degrade:!1,forceVideoPlay:!1,segmentMinDuration:2,supportHevc:void 0,H264Config:null}}},{key:"speed",get:function(){return _realTimeSpeed}},{key:"realTimeSpeed",get:function(){return _realTimeSpeed}},{key:"version",get:function(){return version$1}}]),o}(BasePlugin);Mp4EncryptPlayer.isSupported=isSupported,Mp4EncryptPlayer.isEMESupported=isEMESupported,Mp4EncryptPlayer.isSupportedWithXgmse=isSupportedWithXgmse,Mp4EncryptPlayer.isMediaSourceSupported=isMediaSourceSupported,Mp4EncryptPlayer.isWebAssemblySupported=isWebAssemblySupported,Mp4EncryptPlayer.getPlayLicenses=getPlayLicenses,Mp4EncryptPlayer.CUSTOM_EVENTS=CUSTOM_EVENTS,Mp4EncryptPlayer.Mp4Preloader=Mp4Preloader;var EVENTS={MENU_REPORT:"MENU_REPORT",MENU_LOG:"MENU_LOG"},INFO_TYPES={VID:5,TYPE:10,CODECS:20,SPEED:30,BUFFER:40,PLAY_QUALITY:50,SCHEME:60,RESOLUTION:70,VIEWPORT:80,VOLUME:90,CDN:100,P2P:110,PLAYER_VERSION:120},LOG_TYPES={MENU:0,INTERACT:1,CONTEXTMENU:2},MENU_TYPES={STATS:0,REPORT:1},INTERACT_TYPES={CLOSE:0,COPY:1},CONTEXTMENU_TYPES={SHOW:0,HIDE:1},LOG_EVENTS={STATS:"STATS",REPORT:"REPORT",CLOSE:"CLOSE",COPY:"COPY",CONTEXTMENU_SHOW:"CONTEXTMENU_SHOW",CONTEXTMENU_HIDE:"CONTEXTMENU_HIDE"},events=Object.freeze(Object.defineProperty({__proto__:null,CONTEXTMENU_TYPES:CONTEXTMENU_TYPES,EVENTS:EVENTS,INFO_TYPES:INFO_TYPES,INTERACT_TYPES:INTERACT_TYPES,LOG_EVENTS:LOG_EVENTS,LOG_TYPES:LOG_TYPES,MENU_TYPES:MENU_TYPES},Symbol.toStringTag,{value:"Module"})),_cn,_en;function _createSuper$1(e){var t=_isNativeReflectConstruct$1();return function(){var r,n=_getPrototypeOf$7(e);if(t){var i=_getPrototypeOf$7(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn$7(this,r)}}function _isNativeReflectConstruct$1(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var LANG_CONFIGS={cn:(_cn={},_defineProperty$9(_cn,INFO_TYPES.VID,"VID"),_defineProperty$9(_cn,INFO_TYPES.TYPE,""),_defineProperty$9(_cn,INFO_TYPES.CODECS,""),_defineProperty$9(_cn,INFO_TYPES.SPEED,""),_defineProperty$9(_cn,INFO_TYPES.BUFFER,""),_defineProperty$9(_cn,INFO_TYPES.PLAY_QUALITY,""),_defineProperty$9(_cn,INFO_TYPES.SCHEME,""),_defineProperty$9(_cn,INFO_TYPES.RESOLUTION,""),_defineProperty$9(_cn,INFO_TYPES.VIEWPORT,""),_defineProperty$9(_cn,INFO_TYPES.VOLUME,""),_defineProperty$9(_cn,INFO_TYPES.CDN,"CDN"),_defineProperty$9(_cn,INFO_TYPES.P2P,"P2P"),_defineProperty$9(_cn,INFO_TYPES.PLAYER_VERSION,""),_cn),en:(_en={},_defineProperty$9(_en,INFO_TYPES.VID,"Video ID"),_defineProperty$9(_en,INFO_TYPES.TYPE,"Video Type"),_defineProperty$9(_en,INFO_TYPES.CODECS,"Codecs"),_defineProperty$9(_en,INFO_TYPES.SPEED,"Connection Speed"),_defineProperty$9(_en,INFO_TYPES.BUFFER,"Buffer Health"),_defineProperty$9(_en,INFO_TYPES.PLAY_QUALITY,"Dropped Frames"),_defineProperty$9(_en,INFO_TYPES.SCHEME,"Protocol"),_defineProperty$9(_en,INFO_TYPES.RESOLUTION,"Res"),_defineProperty$9(_en,INFO_TYPES.VIEWPORT,"Viewport"),_defineProperty$9(_en,INFO_TYPES.VOLUME,"Volume"),_defineProperty$9(_en,INFO_TYPES.CDN,"CDN"),_defineProperty$9(_en,INFO_TYPES.P2P,"P2P"),_defineProperty$9(_en,INFO_TYPES.PLAYER_VERSION,"Player Version"),_en)},MenuPlugin=function(e){_inherits$7(r,e);var t=_createSuper$1(r);function r(){return _classCallCheck$b(this,r),t.apply(this,arguments)}return _createClass$c(r,[{key:"afterCreate",value:function(){}},{key:"onPluginsReady",value:function(){var e=this.player.plugins.stats;this.menuInst=new Menu(this.player,this.config||{},e)}}],[{key:"pluginName",get:function(){return"MenuPlugin"}},{key:"defaultConfig",get:function(){return{enableDebug:!0}}}]),r}(BasePlugin),ReportIcon='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.71429 5C5.3198 5 5 5.3198 5 5.71429V14.2857C5 14.6802 5.3198 15 5.71429 15H14.2857C14.6802 15 15 14.6802 15 14.2857V10C15 9.44772 15.4477 9 16 9C16.5523 9 17 9.44772 17 10V14.2857C17 15.7848 15.7848 17 14.2857 17H5.71429C4.21523 17 3 15.7848 3 14.2857V5.71429C3 4.21523 4.21523 3 5.71429 3H10C10.5523 3 11 3.44772 11 4C11 4.55228 10.5523 5 10 5H5.71429Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M16.7071 3.29289C17.0976 3.68342 17.0976 4.31658 16.7071 4.70711L10.7071 10.7071C10.3166 11.0976 9.68342 11.0976 9.29289 10.7071C8.90237 10.3166 8.90237 9.68342 9.29289 9.29289L15.2929 3.29289C15.6834 2.90237 16.3166 2.90237 16.7071 3.29289Z" fill="currentColor"/></svg>',StatsIcon='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 10C9 9.44771 9.44771 9 10 9C10.5523 9 11 9.44772 11 10V13C11 13.5523 10.5523 14 10 14C9.44771 14 9 13.5523 9 13V10Z" fill="currentColor"/><path d="M10 6C9.44771 6 9 6.44772 9 7C9 7.55228 9.44771 8 10 8C10.5523 8 11 7.55228 11 7C11 6.44772 10.5523 6 10 6Z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10C18 14.4183 14.4183 18 10 18C5.58172 18 2 14.4183 2 10C2 5.58172 5.58172 2 10 2C14.4183 2 18 5.58172 18 10ZM10 16C13.3137 16 16 13.3137 16 10C16 6.68629 13.3137 4 10 4C6.68629 4 4 6.68629 4 10C4 13.3137 6.68629 16 10 16Z" fill="currentColor"/></svg>',CloseIcon$1='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.1231 4.08053C16.5136 4.47105 16.5136 5.10422 16.1231 5.49474L11.453 10.1648L16.1231 14.8349C16.5136 15.2254 16.5136 15.8586 16.1231 16.2491C15.7326 16.6397 15.0994 16.6397 14.7089 16.2491L10.0388 11.579L5.36873 16.2491C4.9782 16.6397 4.34504 16.6397 3.95451 16.2491C3.56399 15.8586 3.56399 15.2254 3.95451 14.8349L8.6246 10.1648L3.95451 5.49474C3.56399 5.10422 3.56399 4.47105 3.95451 4.08053C4.34504 3.69001 4.9782 3.69001 5.36873 4.08053L10.0388 8.75061L14.7089 4.08053C15.0994 3.69 15.7326 3.69 16.1231 4.08053Z" fill="currentColor"/></svg>',CopyIcon='<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 3C5.44772 3 5 3.44772 5 4C5 4.55228 5.44772 5 6 5H13.5C14.3284 5 15 5.67157 15 6.5V14C15 14.5523 15.4477 15 16 15C16.5523 15 17 14.5523 17 14V6.5C17 4.567 15.433 3 13.5 3H6ZM4 8H12V16H4L4 8ZM2 8C2 6.89543 2.89543 6 4 6H12C13.1046 6 14 6.89543 14 8V16C14 17.1046 13.1046 18 12 18H4C2.89543 18 2 17.1046 2 16V8ZM5.75 9.5C5.33579 9.5 5 9.83579 5 10.25C5 10.6642 5.33579 11 5.75 11H10.25C10.6642 11 11 10.6642 11 10.25C11 9.83579 10.6642 9.5 10.25 9.5H5.75ZM5 13.75C5 13.3358 5.33579 13 5.75 13H10.25C10.6642 13 11 13.3358 11 13.75C11 14.1642 10.6642 14.5 10.25 14.5H5.75C5.33579 14.5 5 14.1642 5 13.75Z" fill="currentColor"/></g></svg>',Menu=function(){function e(t,r,n){_classCallCheck$b(this,e),this.player=t,this.options=r||{},this.statsPlugin=n;var i={report:ReportIcon,stats:StatsIcon,close:CloseIcon$1,copy:CopyIcon},a=Object.assign({},i,this.options.icons);this.options.icons=a,this.playerInstance="dash_"+(new Date).getTime(),window[this.playerInstance]=this.player,this.menuItems=[{name:"",handler:this.showPanelInfo.bind(this),type:MENU_TYPES.STATS,icon:a.stats,eventName:LOG_EVENTS.STATS},{name:"",handler:this._handleReport.bind(this),type:MENU_TYPES.REPORT,icon:a.report,eventName:LOG_EVENTS.REPORT}],this.playerHandler=[{evt:"RESOLUTION_UPDATE",handler:this._resolutionUpdate.bind(this)},{evt:"menusegment",handler:this._recordLastSegment.bind(this)},{evt:"resourceReady",handler:this._startup.bind(this)},{evt:"canplay",handler:this._startup.bind(this)},{evt:"ended",handler:this.destroyDOM.bind(this)},{evt:"destroy",handler:this.destroy.bind(this)},{evt:"playertypechange",handler:this.destroyDOM.bind(this)},{evt:"codecsupdate",handler:this._codecsUpdate.bind(this)}];for(var o=0;o<this.playerHandler.length;o++){var s=this.playerHandler[o],l=s.evt,u=s.handler;this.player.on(l,u)}this.debugInfo={ua:navigator.userAgent,version:this.player.playerVersion},this._pollTimer=null,this.hasInitDOM=!1,this._cacheMap={},this.menuHandler=this._menuHandler.bind(this),this.munuHideHandler=this._munuHideHandler.bind(this),this.rootClickHandler=this._rootClickHandler.bind(this),this._initDatas()}return _createClass$c(e,[{key:"_reset",value:function(){this.hasInitDOM=!1,this._cacheMap={},this._lastSegment=null}},{key:"_noop",value:function(){}},{key:"_recordLastSegment",value:function(e){this._lastSegment=e}},{key:"_resolutionUpdate",value:function(e){if(!this._cacheUpdate(INFO_TYPES.RESOLUTION)){var t=this.infoItems[INFO_TYPES.RESOLUTION];e?(t.value=e,this.updateInfoItem(t)):(t.hide=!0,this.createPanelInfo())}}},{key:"_codecsUpdate",value:function(e){if(!this._cacheUpdate(INFO_TYPES.CODECS)){var t=this.infoItems[INFO_TYPES.CODECS];t.value=e,this.updateInfoItem(t)}}},{key:"_cacheUpdate",value:function(e){return!this.hasInitDOM&&(this._cacheMap[e]=!0,!0)}},{key:"_handleReport",value:function(){for(var e=this.player.video.readyState,t=this.player.video.buffered,r=[],n=0;n<t.length;n++){var i=t.start(n),a=t.end(n);r.push({start:i,end:a})}var o={readyState:e,curTime:this.player.video.currentTime,err:this.player.video.error||-1,buffer:r},s=Object.assign({debug_date:new Date,type:this.type},this.debugInfo,{videoInfo:o});this._lastSegment&&(s.segment=this._lastSegment),this.options.enableDebug&&this.statsPlugin&&(s.stats=this.statsPlugin.getStats()),this.player.emit(EVENTS.MENU_REPORT,s)}},{key:"_startup",value:function(){if(!this.hasInitDOM){this.type=this.player.currentFormat,this._initDatas(),this._initDOM();for(var e=Object.keys(this._cacheMap),t=0;t<e.length;t++){var r=e[t],n=this.infoItems[r];this.updateInfoItem(n,!0)}}}},{key:"_initDatas",value:function(){var e;this.parentNode=this.player.root,this._isPlayQualitySupported=this.player.video&&"function"==typeof this.player.video.getVideoPlaybackQuality;var t=this.player.playerType,r=LANG_CONFIGS.cn,n=this.options.lang||"cn";this.langConfig=this.options.langConfig||LANG_CONFIGS[n]||r,this.infoItems=(_defineProperty$9(e={},INFO_TYPES.VID,{name:"VID",value:this.player.config.vid,render:renderPlainText,hide:!this.player.config.vid,key:"vid"}),_defineProperty$9(e,INFO_TYPES.TYPE,{name:"",value:t,render:renderPlainText,key:"player_type"}),_defineProperty$9(e,INFO_TYPES.CODECS,{name:"",value:this.player.menuCodeType,render:renderPlainText,key:"menuCodeType",hide:!this.player.menuCodeType}),_defineProperty$9(e,INFO_TYPES.SPEED,{name:"",value:0,render:renderPlainText,posfix:" KB/s",hide:!this._isMenusHide("speed"),key:"speed"}),_defineProperty$9(e,INFO_TYPES.BUFFER,{name:"",value:0,render:renderPlainText,posfix:"s",key:"buffer"}),_defineProperty$9(e,INFO_TYPES.PLAY_QUALITY,{name:"",value:{droppedVideoFrames:0,totalVideoFrames:0},render:renderPlayQuality,hide:null===this.player.video.getVideoPlaybackQuality,key:"frames_info"}),_defineProperty$9(e,INFO_TYPES.SCHEME,{name:"",value:"HTTPS",render:renderPlainText,key:"scheme"}),_defineProperty$9(e,INFO_TYPES.CDN,{name:"CDN",value:this.player.CDNUrl?this.player.CDNUrl:"false",render:renderPlainText,hide:!this._isMenusHide("cdn"),key:"CDN"}),_defineProperty$9(e,INFO_TYPES.P2P,{name:"P2P",value:"false",render:renderPlainText,hide:!0,key:"p2p"}),_defineProperty$9(e,INFO_TYPES.RESOLUTION,{name:"",value:{width:0,height:0,fps:void 0},render:renderResolution,hide:!this._isMenusHide("resolution"),key:"resolution"}),_defineProperty$9(e,INFO_TYPES.VIEWPORT,{name:"",value:{width:0,height:0},render:renderResolution,key:"viewport"}),_defineProperty$9(e,INFO_TYPES.VOLUME,{name:"",value:(100*this.player.config.volume).toFixed(0)+"%",render:renderPlainText,key:"volume"}),_defineProperty$9(e,INFO_TYPES.PLAYER_VERSION,{name:"",value:this.player.playerVersion,render:renderPlainText,key:"player_version"}),e);for(var i=Object.keys(this.infoItems),a=0;a<i.length;a++){var o=i[a];this.infoItems[o].type=o}for(var s=this.options.infoItems||[],l=0;l<s.length;l++){var u=s[l];u.name&&u.type&&u.key?(u.render&&isFunction(u.render)||(u.render=renderPlainText),this.infoItems[u.type]=u):warn("".concat(u.name))}}},{key:"_isMenusHide",value:function(e){return!0===(this.player.supportMenus||{})[e]}},{key:"renderItemByType",value:function(e,t){var r=this.infoItems[e];r?(r.value=t,this._cacheUpdate(e)||this.updateInfoItem(r)):warn("".concat(e," item null"))}},{key:"_initDOM",value:function(){if(this.parentNode&&util$2){this.hasInitDOM=!0;var e=document.createDocumentFragment(),t=document.createElement("xg-menu");util$2.addClass(t,"xg-menu"),this.rightMenu=t;for(var r=this.menuItems.filter((function(e){return!e.hide})),n=0;n<r.length;n++)e.appendChild(this.createMenuItem(r[n]));t.appendChild(e),this.toggle(this.rightMenu,!1),this.parentNode.appendChild(t),this.parentNode.addEventListener("contextmenu",this.menuHandler,!1),document.addEventListener("click",this.munuHideHandler,!1),this.parentNode.addEventListener("click",this.rootClickHandler,!0),this.createPanelInfo(),this.bindEvents(),this.tick()}}},{key:"_menuHandler",value:function(e){if(e.preventDefault(),e.stopPropagation(),this.isPIPMode())return!1;var t=this.getOffset(),r=e.clientX-t.x+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY-t.y+document.body.scrollTop+document.documentElement.scrollTop,i=this.parentNode.clientWidth,a=this.parentNode.clientHeight;this.toggle(this.rightMenu,!0);var o=this.rightMenu.offsetWidth,s=this.rightMenu.offsetHeight,l=r+o>i?i-o:r,u=n+s>a?a-s:n;this.rightMenu.style.left=l+"px",this.rightMenu.style.top=u+"px",this.emitLog(LOG_TYPES.CONTEXTMENU,CONTEXTMENU_TYPES.SHOW,LOG_EVENTS.CONTEXTMENU_SHOW)}},{key:"getOffset",value:function(){for(var e=this.parentNode,t=0,r=0;e&&!Number.isNaN(e.offsetLeft)&&!Number.isNaN(e.offsetTop);)t+=e.offsetLeft-e.scrollLeft,r+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:r}}},{key:"_munuHideHandler",value:function(){this.rightMenu&&"block"===this.rightMenu.style.display&&this.emitLog(LOG_TYPES.CONTEXTMENU,CONTEXTMENU_TYPES.HIDE,LOG_EVENTS.CONTEXTMENU_HIDE),this.toggle(this.rightMenu,!1)}},{key:"_rootClickHandler",value:function(e){"block"===this.rightMenu.style.display&&e.target===this.player.video&&(e.stopPropagation(),e.preventDefault(),this._munuHideHandler())}},{key:"tick",value:function(){var e=this;this._pollTimer=setTimeout((function(){clearTimeout(e._pollTimer),e._poll(),e.tick(),e.isPIPMode()&&(e.toggle(e.rightMenu,!1),e.toggle(e.panelInfo,!1))}),500)}},{key:"_poll",value:function(){var e=this.bufferLength,t=this.infoItems[INFO_TYPES.BUFFER];if(t.value=e,this.updateInfoItem(t),this.player.video.getVideoPlaybackQuality){var r=this.player.video.getVideoPlaybackQuality(),n=this.infoItems[INFO_TYPES.PLAY_QUALITY];n.value={totalVideoFrames:r.totalVideoFrames,droppedVideoFrames:r.droppedVideoFrames},this.updateInfoItem(n)}var i=this.infoItems[INFO_TYPES.SPEED];if(!i.hide){var a=Math.floor(this.player.downloadSpeed);i.value=a,this.updateInfoItem(i)}}},{key:"bindEvents",value:function(){var e=this,t=this.player.video;this.handleVolumeChange=this._handleVolumeChange.bind(this),t.addEventListener("volumechange",this.handleVolumeChange);t.addEventListener("DOMNodeInserted",(function r(){t.removeEventListener("DOMNodeInserted",r),e._onWinElemSizeChange()})),this.onWinSizeChange=debounce$1(this._onWinElemSizeChange.bind(this),1e3,!1),window.addEventListener("resize",this.onWinSizeChange),e._onWinElemSizeChange()}},{key:"_onWinElemSizeChange",value:function(){if(this.player&&this.player.video){var e=this.player.video.getBoundingClientRect(),t=this.infoItems[INFO_TYPES.VIEWPORT];if(t.value={width:Math.floor(e.width),height:Math.floor(e.height)},this._cacheUpdate(INFO_TYPES.VIEWPORT))return;this.updateInfoItem(t)}}},{key:"_handleVolumeChange",value:function(){var e=this.infoItems[INFO_TYPES.VOLUME];e.value=(100*this.player.video.volume).toFixed(0)+"%",this._cacheUpdate(INFO_TYPES.VOLUME)||this.updateInfoItem(e)}},{key:"createMenuItem",value:function(e){var t=this,r=document.createElement("div");if(r.classList.add("v-menu-item"),e.clsName&&r.classList.add(e.clsName),e.icon){var n=document.createElement("div");util$2.addClass(n,"menu-item-icon"),n.innerHTML=e.icon,r.appendChild(n)}var i=document.createElement("div");return util$2.addClass(i,"menu-item-content"),i.textContent=e.name,r.appendChild(i),!1!==r.clickable&&r.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.toggle(t.rightMenu,!1),e.handler(),t.emitLog(LOG_TYPES.MENU,e.type,e.eventName)})),r}},{key:"createIconBtn",value:function(e,t,r,n){var i=document.createElement("div");return util$2.addClass(i,e),i.innerHTML=t+"<div class='svg-hover'>".concat(r,"</div>"),n.appendChild(i),i}},{key:"createPanelInfo",value:function(){var e=this,t=document.createElement("xg-panel-info");util$2.addClass(t,"xg-panel-info"),this.createIconBtn("xg-info-close xg-interact-icon",this.options.icons.close,"",t).addEventListener("click",(function(){e.toggle(t,!1),e.panelVisible=!1,e.emitLog(LOG_TYPES.INTERACT,INTERACT_TYPES.CLOSE,LOG_EVENTS.CLOSE)})),this.createIconBtn("xg-info-copy xg-interact-icon",this.options.icons.copy,"",t).addEventListener("click",(function(){for(var t=Object.values(e.infoItems).filter((function(e){return!e.hide})),r={},n=0;n<t.length;n++){var i=t[n],a=i.key,o=void 0;o=e.options.connectPrefix&&i.posfix?"".concat(i.value).concat(i.posfix):i.value,r[a]=o}e.options.enableDebug&&e.statsPlugin&&Object.assign(r,{stats:e.statsPlugin.getStats()}),e.copyToClipboard(JSON.stringify(r)),e.emitLog(LOG_TYPES.INTERACT,INTERACT_TYPES.COPY,LOG_EVENTS.COPY)}));var r=document.createElement("ul");util$2.addClass(r,"xg-panel-detail");for(var n=Object.values(this.infoItems).filter((function(e){return!e.hide})),i=document.createDocumentFragment(),a=0;a<n.length;a++){var o=this.createInfoItem(n[a]);i.appendChild(o)}r.appendChild(i),t.appendChild(r),this.panelInfo=t,this.player.root.appendChild(t)}},{key:"createInfoItem",value:function(e){var t=document.createElement("li");return e.elem=t,this.updateInfoItem(e),t}},{key:"showPanelInfo",value:function(){this.toggle(this.panelInfo,!0),this.panelVisible=!0;for(var e=Object.values(this.infoItems).filter((function(e){return!e.hide})),t=0;t<e.length;t++)this.updateInfoItem(e[t])}},{key:"copyToClipboard",value:function(e){var t=document.createElement("textarea");t.style.height="0px",t.style.width="1px",document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}},{key:"updateInfoItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.panelVisible||t){var r=e.elem;removeAllChildren(r);var n=document.createElement("label"),i=this.langConfig[e.type]||e.name;n.textContent=i+"",util$2.addClass(n,"xg-item-label"),r.appendChild(n);var a=document.createElement("span"),o=e.ctx||null,s=e.render.call(o,e.value);s instanceof Element?a.appendChild(s):a.textContent="".concat(s).concat(e.posfix?e.posfix:""),r.appendChild(a)}}},{key:"toggle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(e.style.display=t?"block":"none")}},{key:"bufferLength",get:function(){var e=this.player.getBufferedRange(),t=this.player.video.currentTime,r=e[1]-Math.max(e[0],t);return r=Math.max(0,r).toFixed(2),parseFloat(r)}},{key:"destroyDOM",value:function(){this.parentNode.removeEventListener("contextmenu",this.menuHandler),document.removeEventListener("click",this.munuHideHandler,!1),this.parentNode.removeEventListener("click",this.rootClickHandler,!0),this._reset(),this.removeElement(this.rightMenu),this.removeElement(this.panelInfo),this.rightMenu=null,this.panelInfo=null,this._pollTimer&&clearTimeout(this._pollTimer)}},{key:"destroy",value:function(){this.destroyDOM(),this.destroyEvents()}},{key:"destroyEvents",value:function(){for(var e=0;e<this.playerHandler.length;e++){var t=this.playerHandler[e],r=t.evt,n=t.handler;this.player.off(r,n)}window.removeEventListener("resize",this.onWinSizeChange)}},{key:"removeElement",value:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"isPIPMode",value:function(){return util$2.hasClass(this.parentNode,"xgplayer-pip-active")}},{key:"emitLog",value:function(e,t,r){this.player.emit(EVENTS.MENU_LOG,{logType:e,code:t,event:r})}}]),e}();function renderPlainText(e){return e}function renderPlayQuality(e){var t=e.droppedVideoFrames,r=e.totalVideoFrames,n=0;n=0===r?0:t/r*100;var i=document.createElement("span"),a=document.createElement("span");a.textContent=t,i.appendChild(a);var o=document.createElement("span");return o.textContent="/".concat(r,", ").concat(n.toFixed(2),"%"),i.appendChild(o),i}function renderResolution(e){var t=e.width,r=e.height,n=e.fps;return"".concat(t," * ").concat(r).concat(void 0!==n?" / ".concat(n,"fps"):"")}function removeAllChildren(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}function warn(e){console&&console.warn&&console.warn(e)}function isFunction(e){return"[object Function]"===Object.prototype.toString.call(e)}MenuPlugin.MenuEvents=events,MenuPlugin.Menu=Menu;var index$3="",ToastPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).toastNumber=0,n.toastMaps={},n}return _createClass$k(r,[{key:"beforePlayerInit",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"afterCreate",value:function(){}},{key:"destroy",value:function(){}},{key:"add",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.toastNumber+1;this.toastNumber=i;var a=this.renderToast(e,n,i);return this.root.appendChild(a),this.toastMaps[i]=a,setTimeout((function(){t.remove(i)}),r),i}},{key:"remove",value:function(e){var t=this.toastMaps[e];t&&(this.root.contains(t)&&this.root.removeChild(t),delete this.toastMaps[e])}},{key:"renderToast",value:function(e,t,r){var n=this,i=util$2.createDom("div","",void 0,"toast-container"),a=util$2.checkIsObject(e)?e:util$2.createDom("div",e,void 0,"toast-txt");if(i.appendChild(a),t){var o=util$2.createDom("span","",void 0,"toast-close-bt");o.addEventListener("click",(function(){n.remove(r)})),i.appendChild(o)}return i}},{key:"render",value:function(){return'<xg-sdk-toast class="xgplayer-sdk-toast"></xg-sdk-toast>'}}],[{key:"pluginName",get:function(){return"sdkToastPlugin"}},{key:"defaultConfig",get:function(){return{index:5}}}]),r}(Plugin),Hook=function(){function t(){_classCallCheck$j(this,t),this._hooks={},this._cache=[],this._hooksCache={}}return _createClass$k(t,[{key:"on",value:function(e,t){e&&t&&"function"==typeof t&&(this._hooks[e]||(this._hooks[e]=[]),this._hooks[e].push(t))}},{key:"once",value:function(e,t){var r=this;if(e&&t&&"function"==typeof t){this.on(e,(function n(i){t(i),r.off(e,n)}))}}},{key:"off",value:function(e,t){if(e&&this._hooks[e]&&this._hooks[e].length)if(t){var r=this._hooks[e].indexOf(t);-1!==r&&this._hooks[e].splice(r,1)}else this._hooks[e]=[]}},{key:"emit",value:function(e,t,r){if(r){if(!e)return;-1!==this._cache.indexOf(r)?this._emit(e,t):(this._hooksCache.hasOwnProperty(r)||(this._hooksCache[r]={}),this._hooksCache[r].hasOwnProperty(e)||(this._hooksCache[r][e]=[]),this._hooksCache[r][e].push(t))}else this._emit(e,t)}},{key:"_emit",value:function(t,r){t&&this._hooks[t]&&this._hooks[t].length&&_toConsumableArray$a(this._hooks[t]).forEach((function(t){try{t(r)}catch(e){}}))}},{key:"set",value:function(e){e&&-1===this._cache.indexOf(e)&&this._cache.push(e)}}]),t}(),isObject=function(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)},isNumber=function(e){return"number"==typeof e&&!isNaN(e)},isString=function(e){return"string"==typeof e},getIndex=(lastEventId2=+Date.now()+Number("".concat(Math.random()).slice(2,8)),function(){return lastEventId2+=1}),lastEventId2,decrypto=function(e,t,r){if("string"==typeof e&&"number"==typeof t&&"number"==typeof r){var n,i=[];r=r<=25?r:r%25;var a=String.fromCharCode(r+97);n=e.split(a);for(var o=0;o<n.length;o++){var s=parseInt(n[o],r);s=1*s^t;var l=String.fromCharCode(s);i.push(l)}return i.join("")}},decodeUrl=function(e){return decrypto(e,64,25)},beforePageUnload=function(e){!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",e,!1):window.addEventListener("beforeunload",e,!1)},parseURL=function(e){var t=document.createElement("a");return t.href=e,t},parseUrlQuery=function(t){var r={};try{var n=parseURL(t).search;(n=n.slice(1)).split("&").forEach((function(t){var n,i,a=t.split("=");a.length&&(n=a[0],i=a[1]);try{r[n]=decodeURIComponent(void 0===i?"":i)}catch(e){r[n]=i}}))}catch(e){}return r},hashCode=function(e){for(var t=0,r=0,n=(e+="").length,i=0;i<n;i++)((t=31*t+e.charCodeAt(r++))>0x7fffffffffff||t<-0x800000000000)&&(t&=0xffffffffffff);return t<0&&(t+=0x7ffffffffffff),t};function assign(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var defaultConverter={read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function init(t,r){function n(e,n,i){if("undefined"!=typeof document){"number"==typeof(i=assign({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var o in i)i[o]&&(a+="; "+o,!0!==i[o]&&(a+="="+i[o].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+a}}return Object.create({set:n,get:function(r){if("undefined"!=typeof document&&(!arguments.length||r)){for(var n=document.cookie?document.cookie.split("; "):[],i={},a=0;a<n.length;a++){var o=n[a].split("="),s=o.slice(1).join("=");try{var l=decodeURIComponent(o[0]);if(i[l]=t.read(s,l),r===l)break}catch(e){}}return r?i[r]:i}},remove:function(e,t){n(e,"",assign({},t,{expires:-1}))},withAttributes:function(e){return init(this.converter,assign({},this.attributes,e))},withConverter:function(e){return init(assign({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}var api=init(defaultConverter,{path:"/"}),_getCookie=function(t,r){try{return api.get(t,{domain:r||document.domain})}catch(e){return""}},_setCookie=function(t,r,n,i){try{var a=i||document.domain,o=+new Date+(n||6048e5);api.set(t,r,{expires:new Date(o),path:"/",domain:a})}catch(e){}},Memory=function(){function e(){_classCallCheck$j(this,e),this.cache={}}return _createClass$k(e,[{key:"setItem",value:function(e,t){this.cache[e]=t}},{key:"getItem",value:function(e){return this.cache[e]}},{key:"removeItem",value:function(e){this.cache[e]=void 0}},{key:"getCookie",value:function(e,t){return _getCookie(e,t)}},{key:"setCookie",value:function(e,t,r,n){_setCookie(e,t,r,n)}}]),e}();function isSupportLS(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}function isSupportSession(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(e){return!1}}var local={getItem:function(t){try{var r=localStorage.getItem(t),n=r;try{r&&"string"==typeof r&&(n=JSON.parse(r))}catch(e){}return n||{}}catch(e){}return{}},setItem:function(t,r){try{var n="string"==typeof r?r:JSON.stringify(r);localStorage.setItem(t,n)}catch(e){}},removeItem:function(t){try{localStorage.removeItem(t)}catch(e){}},getCookie:function(e,t){return _getCookie(e,t)},setCookie:function(e,t,r,n){_setCookie(e,t,r,n)},isSupportLS:isSupportLS()},session={getItem:function(t){try{var r=sessionStorage.getItem(t),n=r;try{r&&"string"==typeof r&&(n=JSON.parse(r))}catch(e){}return n||{}}catch(e){}return{}},setItem:function(t,r){try{var n="string"==typeof r?r:JSON.stringify(r);sessionStorage.setItem(t,n)}catch(e){}},removeItem:function(t){try{sessionStorage.removeItem(t)}catch(e){}},getCookie:function(e,t){return _getCookie(e,t)},setCookie:function(e,t,r,n){_setCookie(e,t,r,n)},isSupportSession:isSupportSession()},Storage=function(){function e(t,r){_classCallCheck$j(this,e),this._storage=r&&"session"===r?session:!t&&local.isSupportLS?local:new Memory}return _createClass$k(e,[{key:"getItem",value:function(e){return this._storage.getItem(e)}},{key:"setItem",value:function(e,t){this._storage.setItem(e,t)}},{key:"getCookie",value:function(e,t){return this._storage.getCookie(e,t)}},{key:"setCookie",value:function(e,t,r,n){this._storage.setCookie(e,t,r,n)}},{key:"removeItem",value:function(e){this._storage.removeItem(e)}}]),e}(),UTM=function(t,r,n,i){var a=new Storage(!1),o=new Storage(!1,"session"),s=t?"_tea_utm_cache_".concat(t):"_tea_utm_cache",l=t?"_$utm_from_url_".concat(t):"_$utm_from_url",u={},c=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],d={ad_id:Number(r.ad_id)||void 0,campaign_id:Number(r.campaign_id)||void 0,creative_id:Number(r.creative_id)||void 0,utm_source:r.utm_source,utm_medium:r.utm_medium,utm_campaign:r.utm_campaign,utm_term:r.utm_term,utm_content:r.utm_content,tr_shareuser:r.tr_shareuser,tr_admaster:r.tr_admaster,tr_param1:r.tr_param1,tr_param2:r.tr_param2,tr_param3:r.tr_param3,tr_param4:r.tr_param4};try{var h=!1;for(var f in d)d[f]&&(-1!==c.indexOf(f)?(u.hasOwnProperty("tracer_data")||(u.tracer_data={}),u.tracer_data[f]=d[f]):u[f]=d[f],h=!0);if(h)o.setItem(l,"1"),a.setCookie(s,JSON.stringify(u),i,n);else{var p=a.getCookie(s,n);p&&(u=JSON.parse(p))}o.getItem(l)&&(u.hasOwnProperty("tracer_data")||(u.tracer_data={}),u.tracer_data.$utm_from_url=1)}catch(e){return d}return u},Client=function(){function t(e,r,n){_classCallCheck$j(this,t),this.appid=e,this.domain=r,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=n}return _createClass$k(t,[{key:"init",value:function(){var e=window.navigator.userAgent,t=window.navigator.language,r=document.referrer,n=r?parseURL(r).hostname:"",i=parseUrlQuery(window.location.href),a=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=UTM(this.appid,i,this.domain,this.cookie_expire);var o=this.browser(),s=this.os();return{browser:o.browser,browser_version:o.browser_version,platform:a,os_name:s.os_name,os_version:s.os_version,userAgent:e,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:t,referrer:r,referrer_host:n,utm:this.utm,latest_data:this.last(r,n)}}},{key:"last",value:function(e,t){var r="",n="",i="",a=location.hostname,o=!1;if(e&&t&&a!==t){r=e,n=t,o=!0;var s=parseUrlQuery(e);s.keyword&&(i=s.keyword)}return{$latest_referrer:r,$latest_referrer_host:n,$latest_search_keyword:i,isLast:o}}},{key:"browser",value:function(){var e,t,r="",n="".concat(parseFloat(this.appVersion)),i=this.userAgent;return-1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(r="Microsoft Edge",-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),n=i.substring(e+5)):(e=i.indexOf("Edg"),n=i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",n=i.substring(e+5)):-1!==(e=i.indexOf("Lark"))?(r="Lark",n=i.substring(e+5,e+11)):-1!==(e=i.indexOf("MetaSr"))?(r="sougoubrowser",n=i.substring(e+7,e+10)):-1!==i.indexOf("MQQBrowser")||-1!==i.indexOf("QQBrowser")?(r="qqbrowser",-1!==i.indexOf("MQQBrowser")?(e=i.indexOf("MQQBrowser"),n=i.substring(e+11,e+15)):-1!==i.indexOf("QQBrowser")&&(e=i.indexOf("QQBrowser"),n=i.substring(e+10,e+17))):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("360"))?(r="360browser",n=i.substring(i.indexOf("Chrome")+7)):-1!==i.indexOf("baidubrowser")||-1!==i.indexOf("BIDUBrowser")?(-1!==i.indexOf("baidubrowser")?(e=i.indexOf("baidubrowser"),n=i.substring(e+13,e+16)):-1!==i.indexOf("BIDUBrowser")&&(e=i.indexOf("BIDUBrowser"),n=i.substring(e+12,e+15)),r="baidubrowser"):-1!==(e=i.indexOf("xiaomi"))?-1!==i.indexOf("openlanguagexiaomi")?(r="openlanguage xiaomi",n=i.substring(e+7,e+13)):(r="xiaomi",n=i.substring(e-7,e-1)):-1!==(e=i.indexOf("TTWebView"))?(r="TTWebView",n=i.substring(e+10,e+23)):(-1!==(e=i.indexOf("Chrome"))||-1!==(e=i.indexOf("Chrome")))&&(r="Chrome",n=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("QQ"))?(r="qqbrowser",n=i.substring(e+10,e+16)):-1!==(e=i.indexOf("Safari"))&&(r="Safari",n=i.substring(e+7),-1!==(e=i.indexOf("Version"))&&(n=i.substring(e+8))):-1!==(e=i.indexOf("Firefox"))?(r="Firefox",n=i.substring(e+8)):-1!==(e=i.indexOf("MicroMessenger"))?(r="weixin",n=i.substring(e+15,e+20)):-1!==(e=i.indexOf("QQ"))&&(r="qqbrowser",n=i.substring(e+3,e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:r,browser_version:n}}},{key:"os",value:function(){for(var e="",t="",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<r.length;n++){var i=r[n];if(i.r.test(this.userAgent)){"Mac OS X"===(e=i.s)&&this.isNewIpad()&&(e="iOS");break}}var a=function(e,t){var r=e.exec(t);return r&&r[1]?r[1]:""},o=function(e,t){var r=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:".concat(e,")"),"i").exec(t);return r?r.slice(1)[0]:""};/Windows/.test(e)&&(t=a(/Windows (.*)/,e),e="windows");var s,l;switch(e){case"Mac OS X":t=o("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":s=this.userAgent,(l=a(/Android ([\.\_\d]+)/,s))||(l=a(/Android\/([\.\_\d]+)/,s)),t=l,e="android";break;case"iOS":t=this.isNewIpad()?o("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(t=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?"".concat(t[1],".").concat(t[2],".").concat(0|t[3]):"",e="ios"}return{os_name:e,os_version:t}}},{key:"getDeviceModel",value:function(t){var r="";try{if("android"===t)navigator.userAgent.split(";").forEach((function(e){e.indexOf("Build/")>-1&&(r=e.slice(0,e.indexOf("Build/")))}));else if("ios"===t||"mac"===t||"windows"===t)if(this.isNewIpad())r="iPad";else{var n=navigator.userAgent.replace("Mozilla/5.0 (",""),i=n.indexOf(";");r=n.slice(0,i)}}catch(e){return r.trim()}return r.trim()}},{key:"isNewIpad",value:function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1}}]),t}(),LOG;LOG={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"};var AB_DOMAINS={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},LOG_URL=LOG,SDK_VERSION="5.0.29",SDK_USE_TYPE="npm",SDK_TYPE=SDK_USE_TYPE,Types=function(e){return e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready",e}(Types||{}),DebuggerMesssge$1=function(e){return e.DEBUGGER_MESSAGE="debugger-message",e.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",e.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",e.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",e.DEBUGGER_MESSAGE_EVENT="debugger-message-event",e.DEVTOOL_WEB_READY="devtool-web-ready",e}(DebuggerMesssge$1||{}),undef=void 0,date=new Date,timeZoneMin=date.getTimezoneOffset(),timezone=parseInt("".concat(-timeZoneMin/60),10),tz_offset=60*timeZoneMin,WEBID_URL="/webid",TOB_URL="/tobid",REPORT_URL="/list",COOKIE_EXPIRE=6048e5,ConfigManager=function(){function t(e,r){_classCallCheck$j(this,t),this.is_first_time=!0,this.configPersist=!1,this.initConfig=r,this.collect=e;var n=new Client(r.app_id,r.cookie_domain||"",r.cookie_expire||COOKIE_EXPIRE).init(),i="__tea_cache_first_".concat(r.app_id);this.configKey="__tea_cache_config_".concat(r.app_id),this.sessionStorage=new Storage(!1,"session"),this.localStorage=new Storage(!1,"local"),r.configPersist&&(this.configPersist=!0,this.storage=1===r.configPersist?this.sessionStorage:this.localStorage);var a=this.localStorage.getItem(i);a&&"1"===a?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(i,"1")),this.envInfo={user:{user_unique_id:undef,user_type:undef,user_id:undef,user_is_auth:undef,user_is_login:undef,device_id:undef,web_id:undef,ip_addr_id:undef,user_unique_id_type:undef},header:{app_id:undef,app_name:undef,app_install_id:undef,install_id:undef,app_package:undef,app_channel:undef,app_version:undef,os_name:n.os_name,os_version:n.os_version,device_model:n.device_model,ab_client:undef,traffic_type:undef,client_ip:undef,device_brand:undef,os_api:undef,access:undef,language:n.language,region:undef,app_language:undef,app_region:undef,ab_version:undef,creative_id:n.utm.creative_id,ad_id:n.utm.ad_id,campaign_id:n.utm.campaign_id,log_type:undef,rnd:undef,platform:n.platform,sdk_version:SDK_VERSION,sdk_lib:"js",province:undef,city:undef,timezone:timezone,tz_offset:tz_offset,tz_name:undef,sim_region:undef,carrier:undef,resolution:"".concat(n.screen_width,"x").concat(n.screen_height),browser:n.browser,browser_version:n.browser_version,referrer:n.referrer,referrer_host:n.referrer_host,width:n.screen_width,height:n.screen_height,screen_width:n.screen_width,screen_height:n.screen_height,utm_term:n.utm.utm_term,utm_content:n.utm.utm_content,utm_source:n.utm.utm_source,utm_medium:n.utm.utm_medium,utm_campaign:n.utm.utm_campaign,tracer_data:JSON.stringify(n.utm.tracer_data),custom:{},wechat_unionid:undef,wechat_openid:undef}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return _createClass$k(t,[{key:"initDomain",value:function(){var e=this.initConfig.channel_domain;if(e)this.domain=e;else{var t=this.initConfig.channel;this.domain=decodeUrl(LOG_URL[t])}}},{key:"setDomain",value:function(e){this.domain=e}},{key:"getDomain",value:function(){return this.domain}},{key:"setAbVersion",value:function(e){this.ab_version=e}},{key:"getAbVersion",value:function(){return this.ab_version}},{key:"setAbData",value:function(e){this.ab_data=e}},{key:"getAbData",value:function(){return this.ab_data||{}}},{key:"getUrl",value:function(e){var t="";switch(e){case"event":t=this.initConfig.report_url||REPORT_URL;break;case"webid":t=WEBID_URL;break;case"tobid":t=TOB_URL}var r="";return this.initConfig.caller&&(r="?sdk_version=".concat(SDK_VERSION,"&sdk_name=web&app_id=").concat(this.initConfig.app_id,"&caller=").concat(this.initConfig.caller)),"".concat(this.getDomain()).concat(t).concat(r)}},{key:"set",value:function(e){var t=this;Object.keys(e).forEach((function(r){if(void 0!==e[r]&&null!==e[r]||t.delete(r),"evtParams"===r)t.evtParams=_objectSpread2$c(_objectSpread2$c({},t.evtParams||{}),e.evtParams||{});else if("_staging_flag"===r)t.evtParams=_objectSpread2$c(_objectSpread2$c({},t.evtParams||{}),{},{_staging_flag:e._staging_flag});else if("reportErrorCallback"===r&&"function"==typeof e[r])t.reportErrorCallback=e[r];else{var n="",i="";if(r.indexOf(".")>-1){var a=r.split(".");n=a[0],i=a[1]}n?"user"===n||"header"===n?t.envInfo[n][i]=e[r]:t.envInfo.header.custom[i]=e[r]:t.envInfo.user.hasOwnProperty(r)?["user_type","ip_addr_id"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?Number(e[r]):e[r]:["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(r)>-1?t.envInfo.user[r]=e[r]?String(e[r]):e[r]:["user_is_auth","user_is_login"].indexOf(r)>-1?t.envInfo.user[r]=Boolean(e[r]):"device_id"===r&&(t.envInfo.user[r]=e[r]):t.envInfo.header.hasOwnProperty(r)?t.envInfo.header[r]=e[r]:t.envInfo.header.custom[r]=e[r]}}))}},{key:"get",value:function(t){try{return t?"evtParams"===t?this.evtParams:"reportErrorCallback"===t?this[t]:this.envInfo.user.hasOwnProperty(t)?this.envInfo.user[t]:this.envInfo.header.hasOwnProperty(t)?this.envInfo.header[t]:JSON.parse(JSON.stringify(this.envInfo[t])):JSON.parse(JSON.stringify(this.envInfo))}catch(e){console.log("get config stringify error "),this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}}},{key:"setStore",value:function(t){try{if(!this.configPersist)return;var r=this.storage.getItem(this.configKey)||{};if(r&&Object.keys(t).length){var n=Object.assign(t,r);this.storage.setItem(this.configKey,n)}}catch(e){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}}},{key:"getStore",value:function(){try{if(!this.configPersist)return null;var t=this.storage.getItem(this.configKey);return t&&Object.keys(t).length?t:null}catch(e){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message}),null}}},{key:"delete",value:function(t){try{if(!this.configPersist)return;var r=this.storage.getItem(this.configKey);r&&r.hasOwnProperty(t)&&(delete r[t],this.storage.setItem(this.configKey,r))}catch(e){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}}}]),t}(),Logger$1=function(){function e(t,r){_classCallCheck$j(this,e),this.isLog=r||!1,this.name=t||""}return _createClass$k(e,[{key:"info",value:function(e){this.isLog&&console.log("%c %s","color: yellow; background-color: black;","[instance: ".concat(this.name,"] ")+e)}},{key:"warn",value:function(e){this.isLog&&console.warn("[instance: ".concat(this.name,"] ")+e)}},{key:"error",value:function(e){this.isLog&&console.error("[instance: ".concat(this.name,"] ")+e)}},{key:"throw",value:function(e){throw this.error(this.name),new Error(e)}}]),e}(),AppBridge=function(){function t(e,r){_classCallCheck$j(this,t),this.collect=e,this.native=r}return _createClass$k(t,[{key:"bridgeInject",value:function(){try{return!!this.native&&(AppLogBridge?(console.log("AppLogBridge is injected"),!0):(console.log("AppLogBridge is not inject"),!1))}catch(e){return console.log("AppLogBridge is not inject"),!1}}},{key:"bridgeReady",value:function(){var t=this;return new Promise((function(r,n){try{t.bridgeInject()?AppLogBridge.hasStarted((function(e){console.log("AppLogBridge is started? : ".concat(e)),e?r(!0):n(!1)})):n(!1)}catch(e){console.log("AppLogBridge, error:".concat(JSON.stringify(e.stack))),n(!1)}}))}},{key:"setNativeAppId",value:function(t){try{AppLogBridge.setNativeAppId(JSON.stringify(t)),console.log("change bridge appid, event report with appid: ".concat(t))}catch(e){console.error("setNativeAppId error")}}},{key:"setConfig",value:function(t){var r=this;try{Object.keys(t).forEach((function(e){"user_unique_id"===e?r.setUserUniqueId(t[e]):t[e]?r.addHeaderInfo(e,t[e]):r.removeHeaderInfo(e)}))}catch(e){console.error("setConfig error")}}},{key:"setUserUniqueId",value:function(t){try{AppLogBridge.setUserUniqueId(t)}catch(e){console.error("setUserUniqueId error")}}},{key:"addHeaderInfo",value:function(t,r){try{AppLogBridge.addHeaderInfo(t,r)}catch(e){console.error("addHeaderInfo error")}}},{key:"setHeaderInfo",value:function(t){try{AppLogBridge.setHeaderInfo(JSON.stringify(t))}catch(e){console.error("setHeaderInfo error")}}},{key:"removeHeaderInfo",value:function(t){try{AppLogBridge.removeHeaderInfo(t)}catch(e){console.error("removeHeaderInfo error")}}},{key:"reportPv",value:function(e){this.onEventV3("predefine_pageview",e)}},{key:"onEventV3",value:function(t,r){try{AppLogBridge.onEventV3(t,r),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge",time:Date.now(),data:[{events:[{event:t,params:r}]}],code:200,status:"success"})}catch(e){console.error("onEventV3 error")}}},{key:"profileSet",value:function(e){try{AppLogBridge.profileSet(e)}catch(error){console.error("profileSet error")}}},{key:"profileSetOnce",value:function(e){try{AppLogBridge.profileSetOnce(e)}catch(error){console.error("profileSetOnce error")}}},{key:"profileIncrement",value:function(e){try{AppLogBridge.profileIncrement(e)}catch(error){console.error("profileIncrement error")}}},{key:"profileUnset",value:function(e){try{AppLogBridge.profileUnset(e)}catch(error){console.error("profileUnset error")}}},{key:"profileAppend",value:function(e){try{AppLogBridge.profileAppend(e)}catch(error){console.error("profileAppend error")}}}]),t}(),ERROR$1={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005};function fetch$1(t,r,n,i,a,o,s,l,u){try{var c=new XMLHttpRequest,d=l||"POST";c.open(d,"".concat(t),!0),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),s&&c.setRequestHeader("X-MCS-AppKey","".concat(s)),i&&(c.withCredentials=!0),c.onload=function(){if(a){var t=null;if(c.responseText){try{t=JSON.parse(c.responseText)}catch(e){t={}}a(t,r)}}},n&&(c.timeout=n,c.ontimeout=function(){o&&o(r,ERROR$1.TIMEOUT)}),c.onerror=function(){c.abort(),o&&o(r,ERROR$1.XHR_ON)},u?c.send(r):c.send(JSON.stringify(r))}catch(e){}}var GIF_URL="/gif",ERROR={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003,XHR_ON:500,RESPONSE:5001,TIMEOUT:5005},isSupportBeacon=function(){return!(!window.navigator||!window.navigator.sendBeacon)},encodePayload=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(t+="&".concat(r,"=").concat(encodeURIComponent(JSON.stringify(e[r]))));return t="&"===t[0]?t.slice(1):t},sendByImg=function(t,r,n,i){try{var a=t.match(/\/v\d\//),o="";o=a?a[0]:-1!==t.indexOf("/v1/")?"/v1/":"/v2/";var s=t.split(o)[0];if(!s)return void i(t,r,ERROR.NO_URL);r.forEach((function(e){var a=encodePayload(e),o=new Image(1,1);o.onload=function(){o=null,n&&n()},o.onerror=function(){o=null,i&&i(t,r,ERROR.IMG_ON)},o.src="".concat(s).concat(GIF_URL,"?").concat(a)}))}catch(e){i&&i(t,r,ERROR.IMG_CATCH,e.message)}},request=function(e,t,r,n,i,a,o,s){var l=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===l.indexOf("MSIE 8.0")&&-1===l.indexOf("MSIE 9.0")){if(o)return isSupportBeacon()?void(window.navigator.sendBeacon(e,JSON.stringify(t))?i():a(e,t,ERROR.BEACON_FALSE)):void sendByImg(e,t,i,a)}else sendByImg(e,t,i,a);fetch$1(e,t,r,n,i,a,"","",s)},EventCheck=function(){function e(t,r){_classCallCheck$j(this,e),this.collector=t,this.config=r,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=new RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return _createClass$k(e,[{key:"checkVerify",value:function(e){var t=this;if(!e||!e.length)return!1;var r=e[0];if(!r)return!1;var n=r.events,i=r.header;if(!n||!n.length)return!1;var a=!0;return n.forEach((function(e){t.checkEventName(e.event)||(a=!1,e.checkEvent=" $ or __"),t.checkEventParams(e.params)||(a=!1,e.checkParams=" $ or __")})),this.checkEventParams(i)||(a=!1),a}},{key:"checkEventName",value:function(e){return!!e&&this.calculate(e,"event")}},{key:"checkEventParams",value:function(e){var t=e;if("string"==typeof e&&(t=JSON.parse(t)),!Object.keys(t).length)return!0;for(var r in t)return!!this.calculate(r,"params")&&(!("string"==typeof t[r]&&t[r].length>1024)||(console.warn("params: ".concat(r," can not over 1024 byte, please check;")),!1));return!0}},{key:"calculate",value:function(e,t){return-1!==("event"===t?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(e)||(this.regStr.test(e)?!new RegExp("^\\$").test(e)&&!new RegExp("^__").test(e)||(console.warn("".concat("event"===t?"event":"params"," name: ").concat(e," can not start with $ or __, pleace check;")),!1):(console.warn("".concat("event"===t?"event":"params"," name: ").concat(e," is illegal, can not start with $ or __, pleace check;")),!1))}}]),e}(),Event$1=function(){function t(){_classCallCheck$j(this,t),this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return _createClass$k(t,[{key:"apply",value:function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=e.configManager,this.eventCheck=new EventCheck(e,t),this.cacheStorgae=new Storage(!0),this.localStorage=new Storage(!1),this.maxReport=t.max_report||10,this.reportTime=t.reportTime||30,this.timeout=t.timeout||1e5,this.enable_ttwebid=t.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_".concat(this.configManager.get("app_id")),this.beconKey="__tea_cache_events_becon_".concat(this.configManager.get("app_id")),this.abKey="__tea_sdk_ab_version_".concat(this.configManager.get("app_id")),this.collect.on(Types.Ready,(function(){r.reportAll(!1)})),this.collect.on(Types.ConfigDomain,(function(){r.reportUrl=r.configManager.getUrl("event")})),this.collect.on(Types.Event,(function(e){r.event(e)})),this.collect.on(Types.BeconEvent,(function(e){r.beconEvent(e)})),this.collect.on(Types.CleanEvents,(function(){r.reportAll(!1)})),this.linster()}},{key:"linster",value:function(){var e=this;window.addEventListener("unload",(function(){e.reportAll(!0)}),!1),beforePageUnload((function(){e.reportAll(!0)})),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e.reportAll(!0)}),!1)}},{key:"reportAll",value:function(e){this.report(e),this.reportBecon()}},{key:"event",value:function(t){var r=this;try{var n=this.cacheStorgae.getItem(this.eventKey)||[],i=[].concat(_toConsumableArray$a(t),_toConsumableArray$a(n));if(this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport)this.report(!1);else{var a=this.reportTime;this.reportTimeout=setTimeout((function(){r.report(!1),r.reportTimeout=null}),a)}}catch(e){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}}},{key:"beconEvent",value:function(e){var t=this.cacheStorgae.getItem(this.beconKey)||[],r=[].concat(_toConsumableArray$a(e),_toConsumableArray$a(t));this.cacheStorgae.setItem(this.beconKey,r),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(r)),!0))}},{key:"reportBecon",value:function(){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.beconKey)||[];e&&e.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))}}},{key:"report",value:function(e){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var t=this.cacheStorgae.getItem(this.eventKey)||[];t.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(t,e))}}},{key:"sliceEvent",value:function(e,t){if(e.length>this.eventLimit)for(var r=0;r<e.length;r+=this.eventLimit){var n;n=e.slice(r,r+this.eventLimit);var i=this.split(this.merge(n));this.send(i,t)}else{var a=this.split(this.merge(e));this.send(a,t)}}},{key:"merge",value:function(t,r){var n=this,i=this.configManager.get(),a=i.header,o=i.user;a.custom=JSON.stringify(a.custom);var s=this.configManager.get("evtParams"),l=this.configManager.get("user_unique_id_type"),u=t.map((function(t){try{Object.keys(s).length&&!r&&(t.params=_objectSpread2$c(_objectSpread2$c({},s),t.params)),l&&(t.params.$user_unique_id_type=l);var i=n.localStorage.getItem(n.abKey);return i&&i.uuid&&i.uuid===o.user_unique_id&&n.configManager.getAbVersion()&&(t.ab_sdk_version=n.configManager.getAbVersion()),t.session_id=n.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),t}catch(e){return n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message}),t}})),c=JSON.parse(JSON.stringify({events:u,user:o,header:a}));c.local_time=Math.floor(Date.now()/1e3),c.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0;var d=[];return d.push(c),d}},{key:"split",value:function(e){return e=e.map((function(e){var t=[];return t.push(e),t}))}},{key:"send",value:function(t,r){var n=this;t.length&&t.forEach((function(t){try{var i=JSON.parse(JSON.stringify(t));n.config.filter&&((i=n.config.filter(i))||console.warn("filter must return data !!")),n.collect.eventFilter&&i&&((i=n.collect.eventFilter(i))||console.warn("filterEvent api must return data !!"));var a=i||t;if(n.eventCheck.checkVerify(a),!a.length)return;n.collect.emit(Types.SubmitBefore,a),n.collect.emit(Types.SubmitVerify,a),request(n.reportUrl,a,n.timeout,n.enable_ttwebid,(function(e,t){e&&0!==e.e?(n.collect.emit(Types.SubmitError,{type:"f_data",eventData:t,errorCode:e.e,response:e}),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:a,code:e.e,failType:"",status:"fail"})):(n.collect.emit(Types.SubmitScuess,{eventData:t,res:e}),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:a,code:200,status:"success"}))}),(function(e,t){n.configManager.get("reportErrorCallback")(e,t),n.collect.emit(Types.SubmitError,{type:"f_net",eventData:e,errorCode:t}),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"",time:Date.now(),data:a,code:t,failType:"",status:"fail"})}),r,!1),n.collect.emit(Types.SubmitAfter,a)}catch(e){console.warn("something error, ".concat(JSON.stringify(e.stack))),n.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}}))}}]),t}(),b=function e(t){return t?(t^16*Math.random()>>t/4).toString(10):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},localWebId=function(){return b().replace(/-/g,"").slice(0,19)},Token=function(){function e(){_classCallCheck$j(this,e),this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return _createClass$k(e,[{key:"apply",value:function(e,t){var r=this;this.collect=e,this.config=t,this.configManager=this.collect.configManager,this.storage=new Storage(!1),this.tokenKey="__tea_cache_tokens_".concat(t.app_id),this.enable_ttwebid=t.enable_ttwebid,this.enableCustomWebid=t.enable_custom_webid,this.collect.on(Types.ConfigUuid,(function(e){r.setUuid(e)})),this.collect.on(Types.ConfigWebId,(function(e){r.setWebId(e)})),this.enableCookie=t.cross_subdomain,this.expiresTime=t.cookie_expire||6048e5,this.cookieDomain=t.cookie_domain||"",this.checkStorage()}},{key:"checkStorage",value:function(){var e=this;if(this.enableCookie){var t=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(Types.CustomWebId,(function(){e.tokenReady=!0,e.collect.emit(Types.TokenComplete)})):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()}},{key:"check",value:function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:localWebId(),user_unique_id:this.configManager.get("user_unique_id")||localWebId()}):this.remoteWebid()}},{key:"checkEnv",value:function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("miniProgram")||-1!==e.indexOf("MiniProgram")){var t=parseUrlQuery(window.location.href);return!(!t||!t.Web_ID)&&(this.complete({web_id:"".concat(t.Web_ID),user_unique_id:this.configManager.get("user_unique_id")||"".concat(t.Web_ID)}),!0)}return!1}},{key:"remoteWebid",value:function(){var e=this,t=this.configManager.getUrl("webid"),r={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK WEBID",logType:"fetch",level:"info",time:Date.now(),data:r}),fetch$1(t,r,3e3,!1,(function(t){t&&0===t.e?e.complete({web_id:e.configManager.get("web_id")||t.web_id,user_unique_id:e.configManager.get("user_unique_id")||t.web_id}):(e.collect.emit(Types.TokenError),console.warn("[]appid: ".concat(e.config.app_id," webid error, init error~"))),e.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"WEBID",logType:"fetch",level:"info",time:Date.now(),data:t})}),(function(){e.collect.emit(Types.TokenError),e.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"WEBID",logType:"fetch",level:"error",time:Date.now(),data:null}),console.warn("[]appid: ".concat(e.config.app_id,", get webid error, init error~"))}))}},{key:"complete",value:function(e){var t=e.web_id,r=e.user_unique_id;e.timestamp=Date.now(),this.collect.configManager.set({web_id:t,user_unique_id:r}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types.TokenComplete)}},{key:"completeTtWid",value:function(e){var t=e.user_unique_id||"",r=this.configManager.get("user_unique_id");(r||t)&&this.configManager.set({user_unique_id:r||t}),this.setStorage(e),this.tokenReady=!0,this.collect.emit(Types.TokenComplete)}},{key:"setUuid",value:function(e){if(e&&-1===["null","undefined","Null","None"].indexOf(e)){var t=String(e),r=this.configManager.get("user_unique_id"),n=this.cacheToken&&this.cacheToken.user_unique_id;if(t===r&&t===n)return;this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(Types.TokenChange,"uuid"),this.collect.emit(Types.SessionReset)}else this.clearUuid()}},{key:"clearUuid",value:function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(Types.TokenReset))}},{key:"setWebId",value:function(e){if(e&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==e&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?e:this.cacheToken.user_unique_id,this.cacheToken.web_id=e):(this.cacheToken={},this.cacheToken.web_id=e,this.cacheToken.user_unique_id=e),this.cacheToken.timestamp=Date.now();var t=this.configManager.get("web_id"),r=this.configManager.get("user_unique_id");r&&r!==t||(this.configManager.set({user_unique_id:e}),this.collect.emit(Types.TokenChange,"uuid")),t!==e&&(this.configManager.set({web_id:e}),this.collect.emit(Types.TokenChange,"webid")),this.setStorage(this.cacheToken)}}},{key:"setStorage",value:function(e){e._type_=this.enableCustomWebid?"custom":"default",delete e["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,e,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete e.web_id,this.storage.setItem(this.tokenKey,e))):this.storage.setItem(this.tokenKey,e),this.cacheToken=e}},{key:"getReady",value:function(){return this.tokenReady}},{key:"getTobId",value:function(){var e=this,t=this.configManager.getUrl("tobid");return new Promise((function(r){fetch$1(t,{app_id:e.config.app_id,user_unique_id:e.configManager.get("user_unique_id"),web_id:e.configManager.get("web_id"),user_unique_id_type:e.configManager.get("user_unique_id_type")},3e4,e.enable_ttwebid,(function(e){e&&0===e.e?r(e.tobid):r("")}),(function(){r("")}))}))}}]),e}(),sessionId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},Session=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,[{key:"apply",value:function(e,t){var r=this;this.collect=e,this.storage=new Storage(!1,"session"),this.sessionKey="__tea_session_id_".concat(t.app_id),this.expireTime=t.expireTime||18e5,this.disableSession=t.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(Types.SessionReset,(function(){r.resetSessionId()})),this.collect.on(Types.SessionResetTime,(function(){r.updateSessionIdTime()})))}},{key:"updateSessionIdTime",value:function(){var e=this.storage.getItem(this.sessionKey);if(e&&e.sessionId){var t=e.timestamp;Date.now()-t>this.expireTime?e={sessionId:sessionId(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime()}}},{key:"setSessionId",value:function(){var e=this,t=this.storage.getItem(this.sessionKey);t&&t.sessionId?t.timestamp=Date.now():t={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime)}},{key:"getSessionId",value:function(){var e=this.storage.getItem(this.sessionKey);return this.disableSession?"":e&&e.sessionId?e.sessionId:""}},{key:"resetExpTime",value:function(){var e=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval((function(){e.checkEXp()}),this.expireTime))}},{key:"resetSessionId",value:function(){var e={sessionId:sessionId(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,e)}},{key:"checkEXp",value:function(){var e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&(Date.now()-e.timestamp+30>=this.expireTime&&(e={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e)))}}]),e}(),AutoBase=function(e){var t=e.app_id,r=e.channel,n=e.onTokenReady,i="".concat(LOG_URL[r],"/webid"),a=new Storage(!1),o="__tea_cache_tokens_".concat(t),s=a.getItem(o);s&&s.web_id?n(s.web_id):request(i,{app_key:"",app_id:t,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,(function(e){if(e&&0===e.e){n(e.web_id);var t={web_id:e.web_id,user_unique_id:e.web_id,timestamp:Date.now()};a.setItem(o,t)}else n("")}),(function(){n("")}),!0)},Debugger=function(){function t(e,r){_classCallCheck$j(this,t),this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.collect=e,this.config=r,this.app_id=r.app_id,this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}return _createClass$k(t,[{key:"loadScript",value:function(t){try{var r=document.createElement("script");r.src=t,r.onerror=function(){console.log("load DevTool render fail")},r.onload=function(){console.log("load DevTool render success")},document.getElementsByTagName("body")[0].appendChild(r)}catch(e){console.log("devTool load fail, ".concat(e.message))}}},{key:"load",value:function(){try{this.loadBaseInfo(),this.loadHook();var t=parseUrlQuery(window.location.href);if(!t.open_devtool_web||parseInt(t.app_id)!==this.app_id)return;this.addLintener(),this.loadDebuggerModule(),this.loadDevTool()}catch(e){console.log("debug fail, ".concat(e.message))}}},{key:"loadDevTool",value:function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.js")}},{key:"loadBaseInfo",value:function(){var e=this;this.info=[{title:"",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,"":this.collect.configManager.getDomain(),"SDK":SDK_VERSION,"SDK":SDK_TYPE}},{title:"",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"SSID"}},{title:"",type:2,infoName:{"":this.collect.configManager.get("browser"),"":this.collect.configManager.get("browser_version"),"":this.collect.configManager.get("platform"),"":this.collect.configManager.get("device_model"),"":this.collect.configManager.get("os_name"),"":this.collect.configManager.get("os_version"),"":this.collect.configManager.get("os_version"),"":this.collect.configManager.get("referrer"),"":""}},{title:"",type:3,infoName:{"":!!this.config.autotrack,"":!!this.config.enable_stay_duration}},{title:"A/B",type:4,infoName:{"A/B":!!this.config.enable_ab_test}},{title:"",type:3,infoName:{"":!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(Types.Ready,(function(){e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id,e.info[2].infoName[""]=JSON.stringify(e.collect.configManager.get("custom")),e.config.enable_ab_test&&(e.info[4].infoName["VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName["A/B"]=e.config.ab_channel_domain||decodeUrl(AB_DOMAINS[e.config.channel]),e.info[4].infoName[""]=e.collect.configManager.getAbData()),e.config.Native&&(e.info[5].infoName[""]=!!e.collect.bridgeReport)}))}},{key:"loadHook",value:function(){var e=this;this.collect.on(DebuggerMesssge$1.DEBUGGER_MESSAGE,(function(t){switch(t.type){case DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK:var r={time:t.time,type:t.logType||"sdk",level:t.level,name:t.info,show:!0,levelShow:!0,needDesc:!!t.data};return t.data&&(r.desc={content:JSON.stringify(t.data)}),e.updateLog(r),t.secType&&"AB"===t.secType?(e.info[4].infoName["VID"]=e.collect.configManager.getAbVersion(),e.info[4].infoName[""]=e.collect.configManager.getAbData()):"USER"===t.secType&&(e.info[1].infoName.uuid=e.collect.configManager.get("user").user_unique_id,e.info[1].infoName.web_id=e.collect.configManager.get("user").web_id),void e.updateInfo();case DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT:if(t.data&&t.data.length){var n=t.data[0],i=n.events;if(!i.length)return;i.forEach((function(r){r.checkShow=!0,r.searchShow=!0,r.success=t.status,r.type=-1!==e.filterEvent.indexOf(r.event)?"sdk":"cus",r.type=e.collect.bridgeReport?"bridge":r.type,r.info="","fail"===t.status&&(r.info={message:"code: ".concat(t.code," msg: ").concat(t.failType)})})),e.updateEvent(n)}return}}))}},{key:"addLintener",value:function(){var e=this;window.addEventListener("message",(function(t){if(t&&t.data&&"devtool:web:ready"===t.data.type){if(e.devToolOrigin=t.origin,e.devToolReady=!0,e.sendAlready)return;console.log("inittttt"),e.sendData("devtool:web:init",{info:e.info,log:e.log,event:e.event}),e.sendAlready=!0}t&&t.data&&"devtool:web:ssid"===t.data.type&&e.collect.getToken((function(t){e.info[1].infoName.ssid=t.tobid,e.updateInfo()}))}))}},{key:"sendData",value:function(t,r){try{var n={type:t,payload:r};(window.opener||window.parent).postMessage(n,this.devToolOrigin)}catch(e){}}},{key:"updateInfo",value:function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)}},{key:"updateLog",value:function(e){this.devToolReady?this.sendData("devtool:web:log",e):this.log.push(e)}},{key:"updateEvent",value:function(e){this.devToolReady?this.sendData("devtool:web:event",e):this.event.push(e)}},{key:"loadDebuggerModule",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),e.appendChild(t);var r=document.createElement("div");r.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog</div>';var n=document.createElement("div");n.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(r),document.getElementsByTagName("body")[0].appendChild(n),document.getElementById("debugger-applog-web").addEventListener("click",(function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)}))}}]),t}(),_excluded=["web_id","user_unique_id"],_Collector=function(){function t(e){_classCallCheck$j(this,t),this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=e,this.hook=new Hook,this.remotePlugin=new Map,this.Types=Types,this.adapters.fetch=fetch$1,this.adapters.storage=Storage}return _createClass$k(t,[{key:"usePlugin",value:function(e,t,r){e&&(t?"string"==typeof t?this.remotePlugin.get(e)||this.remotePlugin.set(e,{src:t,call:r}):this.remotePlugin.get(e)||this.remotePlugin.set(e,{instance:t}):this.remotePlugin.get(e)||this.remotePlugin.set(e,"sdk"))}},{key:"init",value:function(r){var n=this;this.inited?console.warn("[instance: ".concat(this.name,"], every instance's api: init,  can be call only one time!")):r&&isObject(r)?r.app_id&&isNumber(r.app_id)?!r.app_key||isString(r.app_key)?(r.channel_domain||-1!==["cn","sg","va"].indexOf(r.channel)||(console.warn("channel must be `cn`, `sg`,`va` !!!"),r.channel="cn"),this.logger=new Logger$1(this.name,r.log),this.appBridge=new AppBridge(this,r.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new ConfigManager(this,r),this.debugger=new Debugger(this,r),this.initConfig=r,this.emit(Types.Init),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK INIT",data:r,level:"info",time:Date.now()}),r.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:r.app_id}),this.eventManager=new Event$1,this.tokenManager=new Token,this.sessionManager=new Session,Promise.all([new Promise((function(e){n.once(Types.TokenComplete,(function(){e(!0)}))})),new Promise((function(e){n.once(Types.Start,(function(){e(!0)}))}))]).then((function(){try{t.plugins.reduce((function(e,t){var r=t.plugin,i=t.options,a=Object.assign(n.initConfig,i),o=new r;return o.apply(n,a),e.push(o),e}),n.pluginInstances)}catch(e){console.log("load plugin error, ".concat(e.message)),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}n.sdkReady=!0,n.emit(Types.Ready),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),level:"info",data:n.configManager.get("user")}),n.logger.info("appid: ".concat(r.app_id,", userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.logger.info("appid: ".concat(r.app_id,", sdk is ready, version is ").concat(SDK_VERSION,", you can report now !!!")),r.disable_auto_pv&&(n.disableAutoPageView=!0);try{(r.enable_ab_test||r.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}n.pageView(),n.on(Types.TokenChange,(function(e){"webid"===e&&n.pageView(),n.logger.info("appid: ".concat(r.app_id," token change, new userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(Types.TokenReset,(function(){n.logger.info("appid: ".concat(r.app_id," token reset, new userInfo:").concat(JSON.stringify(n.configManager.get("user")))),n.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK ",time:Date.now(),secType:"USER",level:"info",data:n.configManager.get("user")})})),n.on(Types.RouteChange,(function(e){e.init||r.disable_route_report||n.pageView()}));try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(e){}})),this.tokenManager.apply(this,r),this.eventManager.apply(this,r),this.sessionManager.apply(this,r)),this.inited=!0):console.warn("app_key param is error, must be string, please check!"):console.warn("app_id param is error, must be number, please check!"):console.warn("init params error,please check")}},{key:"config",value:function(e){if(this.inited)if(e&&isObject(e))if(this.bridgeReport)this.appBridge.setConfig(e);else{e._staging_flag&&1===e._staging_flag&&(this.staging=!0),e.disable_auto_pv&&(this.disableAutoPageView=!0,delete e.disable_auto_pv);var t=_objectSpread2$c({},e);if(this.initConfig&&this.initConfig.configPersist){var r=this.configManager.getStore();r&&(t=Object.assign(r,e)),this.configManager.setStore(e)}var n=t;n.web_id,n.user_unique_id;var i=_objectWithoutProperties$5(n,_excluded);t.hasOwnProperty("web_id")&&this.emit(Types.ConfigWebId,t.web_id),t.hasOwnProperty("user_unique_id")&&this.emit(Types.ConfigUuid,t.user_unique_id),this.configManager.set(i),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK CONFIG",level:"info",time:Date.now(),data:t})}else console.warn("config params is error, please check");else console.warn("config must be use after function init")}},{key:"setDomain",value:function(e){this.configManager&&this.configManager.setDomain(e),this.emit(Types.ConfigDomain)}},{key:"getConfig",value:function(e){return this.configManager.get(e)}},{key:"send",value:function(){this.start()}},{key:"start",value:function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(Types.Start),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK START",level:"info",time:Date.now()}),this.bridgeReport&&(this.pageView(),this.emit(Types.Ready)))}},{key:"event",value:function(t,r){var n=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var i=[];Array.isArray(t)?t.forEach((function(e){i.push(n.processEvent(e[0],e[1]||{}))})):i.push(this.processEvent(t,r)),this.bridgeReport?i.forEach((function(e){var t=e.event,r=e.params;n.appBridge.onEventV3(t,JSON.stringify(r))})):i.length&&(this.emit(Types.Event,i),this.emit(Types.SessionResetTime))}catch(e){console.warn("something error, please check"),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message})}}},{key:"beconEvent",value:function(e,t){if(!this.initConfig||!this.initConfig.disable_track_event)if(Array.isArray(e))console.warn("beconEvent not support batch report, please check");else{var r=[];r.push(this.processEvent(e,t||{})),r.length&&(this.emit(Types.BeconEvent,r),this.emit(Types.SessionResetTime))}}},{key:"processEvent",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var n=/^event\./,i=t;n.test(t)&&(i=t.slice(6));var a,o=r;"object"!==_typeof$b(o)&&(o={}),o.profile?delete o.profile:o.event_index=getIndex(),o.local_ms?(a=o.local_ms,delete o.local_ms):a=+new Date;var s={event:i,params:o,local_time_ms:a,is_bav:this.initConfig&&this.initConfig.autotrack?1:0};return s}catch(e){return this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"",level:"error",time:Date.now(),data:e.message}),{event:t,params:r}}}},{key:"filterEvent",value:function(e){this.eventFilter=e}},{key:"on",value:function(e,t){this.hook.on(e,t)}},{key:"once",value:function(e,t){this.hook.once(e,t)}},{key:"off",value:function(e,t){this.hook.off(e,t)}},{key:"emit",value:function(e,t,r){this.hook.emit(e,t,r)}},{key:"set",value:function(e){this.hook.set(e)}},{key:"pageView",value:function(){this.disableAutoPageView||this.predefinePageView()}},{key:"predefinePageView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:"".concat(this.configManager.is_first_time)},r=_objectSpread2$c(_objectSpread2$c({},t),e);this.event("predefine_pageview",r)}},{key:"clearEventCache",value:function(){this.emit(Types.CleanEvents)}},{key:"setWebIDviaUnionID",value:function(e){if(e){var t=hashCode(e);this.config({web_id:"".concat(t),wechat_unionid:e}),this.emit(Types.CustomWebId)}}},{key:"setWebId",value:function(e){this.config({web_id:"".concat(e)})}},{key:"setWebIDviaOpenID",value:function(e){if(e){var t=hashCode(e);this.config({web_id:"".concat(t),wechat_openid:e}),this.emit(Types.CustomWebId)}}},{key:"setNativeAppId",value:function(e){this.bridgeReport&&this.appBridge.setNativeAppId(e)}},{key:"resetStayDuration",value:function(e,t,r){this.emit(Types.ResetStay,{url_path:e,title:t,url:r},Types.Stay)}},{key:"resetStayParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.emit(Types.SetStay,{url_path:e,title:t,url:r},Types.Stay)}},{key:"getToken",value:function(e,t){var r=this,n=!1,i=function(t){if(!n){n=!0;var i=r.configManager.get().user;return t&&(i.tobid=t,i["diss".split("").reverse().join("")]=t),e(_objectSpread2$c({},i))}},a=function(){r.tokenManager.getTobId().then((function(e){i(e)}))};this.sdkReady?a():(t&&setTimeout((function(){i()}),t),this.on(Types.Ready,(function(){a()})))}},{key:"profileSet",value:function(e){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(e)):this.emit(Types.ProfileSet,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileSet",level:"info",time:Date.now(),data:e})}},{key:"profileSetOnce",value:function(e){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(e)):this.emit(Types.ProfileSetOnce,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileSetOnce",level:"info",time:Date.now(),data:e})}},{key:"profileIncrement",value:function(e){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(e)):this.emit(Types.ProfileIncrement,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileIncrement",level:"info",time:Date.now(),data:e})}},{key:"profileUnset",value:function(e){this.bridgeReport?this.appBridge.profileUnset(e):this.emit(Types.ProfileUnset,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileUnset",level:"info",time:Date.now(),data:e})}},{key:"profileAppend",value:function(e){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(e)):this.emit(Types.ProfileAppend,e,Types.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK profileAppend",level:"info",time:Date.now(),data:e})}},{key:"setExternalAbVersion",value:function(e){this.emit(Types.AbExternalVersion,"string"==typeof e&&e?"".concat(e).trim():null,Types.Ab)}},{key:"getVar",value:function(e,t,r){this.emit(Types.AbVar,{name:e,defaultValue:t,callback:r},Types.Ab)}},{key:"getABconfig",value:function(e,t){this.emit(Types.AbConfig,{params:e,callback:t},Types.Ab)}},{key:"getAbSdkVersion",value:function(){return this.configManager.getAbVersion()}},{key:"onAbSdkVersionChange",value:function(e){var t=this;return this.emit(Types.AbVersionChangeOn,e,Types.Ab),function(){t.emit(Types.AbVersionChangeOff,e,Types.Ab)}}},{key:"offAbSdkVersionChange",value:function(e){this.emit(Types.AbVersionChangeOff,e,Types.Ab)}},{key:"openOverlayer",value:function(){this.emit(Types.AbOpenLayer,"",Types.Ab)}},{key:"closeOverlayer",value:function(){this.emit(Types.AbCloseLayer,"",Types.Ab)}},{key:"getAllVars",value:function(e){this.emit(Types.AbAllVars,e,Types.Ab)}},{key:"autoInitializationRangers",value:function(e){AutoBase(e)}},{key:"destoryInstace",value:function(){this.destroyInstance||(this.destroyInstance=!0,this.off(Types.TokenComplete))}}],[{key:"usePlugin",value:function(e,r,n){if(r){for(var i=!1,a=0,o=t.plugins.length;a<o;a++){if(t.plugins[a].name===r){t.plugins[a].plugin=e,t.plugins[a].options=n||{},i=!0;break}}i||t.plugins.push({name:r,plugin:e,options:n})}else t.plugins.push({plugin:e})}}]),t}(),Collector=_Collector;function ownKeys$1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2$1(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(r),!0).forEach((function(t){_defineProperty$2(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function asyncGeneratorStep$1(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator$1(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep$1(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep$1(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _defineProperties$2(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$2(e,t,r){return t&&_defineProperties$2(e.prototype,t),r&&_defineProperties$2(e,r),e}function _defineProperty$2(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}Collector.plugins=[];var runtime_1=createCommonjsModule((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(x){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),o=new I(n||[]);return a._invoke=function(e,t,r){var n=d;return function(i,a){if(n===f)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw a;return P()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=A(o,r);if(s){if(s===y)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var l=c(e,t,r);if("normal"===l.type){if(n=r.done?p:h,l.arg===y)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=p,r.method="throw",r.arg=l.arg)}}}(e,r,o),a}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(x){return{type:"throw",arg:x}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",y={};function m(){}function g(){}function v(){}var b={};b[a]=function(){return this};var _=Object.getPrototypeOf,E=_&&_(_(C([])));E&&E!==r&&n.call(E,a)&&(b=E);var T=v.prototype=m.prototype=Object.create(b);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function $(e,t){function r(i,a,o,s){var l=c(e[i],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"===_typeof$b(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,s)}))}s(l.arg)}var i;this._invoke=function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}}function A(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method))return y;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var i=c(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:P}}function P(){return{value:t,done:!0}}return g.prototype=T.constructor=v,v.constructor=g,g.displayName=l(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,s,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},S($.prototype),$.prototype[o]=function(){return this},e.AsyncIterator=$,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new $(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(T),l(T,s,"Generator"),T[a]=function(){return this},T.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=C,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}(e.exports);try{regeneratorRuntime=t}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(t)}})),device_id_key="xgplayer_device_id",user_id_key="xgplayer_user_id",getCookie=function(e){if(!document.cookie)return null;for(var t=document.cookie.split(";"),r=0,n=t.length;r<n;r++){var i=t[r];if(t[r].indexOf(e)>=0)return i.split("=")[1]||null}},genRandomID=function(e){return String(Math.floor(Math.random()*Math.pow(10,e)))},getDeviceID=function(){var e=getCookie(device_id_key);if(e)return e;var t=genRandomID(11);return document.cookie=device_id_key+"="+t+";max-age=31536000;path=/",t},getUserId=function(){var e=getCookie(user_id_key);if(e)return e;var t=genRandomID(12);return document.cookie=user_id_key+"="+t+";max-age=31536000;path=/",t},getLogId=function(){return genRandomID(12)};function getBrowser(){var e=navigator.userAgent.toLowerCase(),t={},r={IE:window.ActiveXObject||"ActiveXObject"in window,Chrome:e.indexOf("chrome")>-1&&e.indexOf("safari")>-1,Firefox:e.indexOf("firefox")>-1,Opera:e.indexOf("opera")>-1,Safari:e.indexOf("safari")>-1&&-1==e.indexOf("chrome"),Edge:e.indexOf("edge")>-1,QQBrowser:/qqbrowser/.test(e),WeixinBrowser:/MicroMessenger/i.test(e)};for(var n in r)if(r[n]){var i="";if("IE"===n)i=e.match(/(msie\s|trident.*rv:)([\w.]+)/)[2];else if("Chrome"===n){for(var a in navigator.mimeTypes)"application/360softmgrplugin"===navigator.mimeTypes[a].type&&(n="360");var o=e.match(/chrome\/([\d.]+)/);i=o?o[1]:"-1"}else if("Firefox"===n){var s=e.match(/firefox\/([\d.]+)/);i=s?s[1]:"-1"}else if("Opera"===n){var l=e.match(/opera\/([\d.]+)/);i=l?l[1]:"-1"}else if("Safari"===n){var u=e.match(/version\/([\d.]+)/);i=u?u[1]:"-1"}else if("Edge"===n){var c=e.match(/edge\/([\d.]+)/);i=c?c[1]:"-1"}else if("QQBrowser"===n){var d=e.match(/qqbrowser\/([\d.]+)/);i=d?d[1]:"-1"}t.type=n,t.versions=parseInt(i)}return t}var sniffer={get device(){return sniffer.os.isPc?"pc":"mobile"},get browser(){var e=getBrowser();return e.type+"_"+e.versions},get os(){var e=navigator.userAgent;navigator.platform.toLowerCase();var t=/(?:Windows Phone)/.test(e),r=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),i=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||i&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:o,isAndroid:n,isPc:!(o||n||r||a),isSymbian:r,isWindowsPhone:t,isFireFox:i}},get operation_os(){for(var e=navigator.userAgent,t=[{s:"windows",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1|Windows 8.1|Windows NT 6.3|Windows 8|Windows NT 6.2|Windows 7|Windows NT 6.1)/},{s:"android",r:/Android/},{s:"linux",r:/(Linux|X11)/},{s:"ios",r:/(iPhone|iPad|iPod)/},{s:"mac",r:/Mac OS X/},{s:"mac",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],r=0;r<t.length;r++){var n=t[r];if(n.r.test(e))return n.s}return"unknown"}};function getCurrentTime(){return(new Date).getTime()}function getPlayFormat(e){var t="unknown";return"string"!=typeof e?t:e.indexOf(".flv")>-1?"flv":e.indexOf(".m3u8")>-1?"m3u8":e.indexOf(".mp4")>-1?"mp4":e.indexOf(".sdp")>-1?"rts":t}function getPlayerCore(e){if(e.plugins){if(e.plugins.flv)return e.plugins.flv;if(e.plugins.hls)return e.plugins.hls;if(e.plugins.rts)return e.plugins.rts;if(e.plugins.flvlive)return e.plugins.flvlive;if(e.plugins.hlslive)return e.plugins.hlslive;if(e.plugins.hlsvod)return e.plugins.hlsvod;if(e.plugins.hlslivemobile)return e.plugins.hlslivemobile;if(e.plugins.flvlivemobile)return e.plugins.flvlivemobile}return e.newHls||e.newFlv||e.__core__||e.flv}function getDefaultOptions(e){return{device_id:e.device_id||getDeviceID(),user_id:e.user_id||getUserId(),error_report_stop:!!e.error_report_stop,project_key:e.project_key||"xigua_live",product_line:e.product_line||"live",onReport:e.onReport||function(){}}}function getDefaultLog(){return{start_play:{start_play_time:0,event_key:"start_play"},first_frame:{start:0,first_frame_view:0,event_key:"first_frame",first_sei_delay:0,ntp_sync:0,ntp_delta:0,ttfb:-1,ttdb:-1,ttfb_end:0},first_frame_failed:{code:void 0,msg:"",event_key:"first_frame_failed"},stall_start:{ready_state:-1,stall_start_time:0,event_key:"stall_start"},stalling:{event_key:"stalling"},stall:{reason:0,stall_start:0,stall_end:0,ready_state:0,event_key:"stall"},play_stop:{code:0,stop_time:0,drop_percent:0,is_stream_received:0,stall_count:0,stall_time:0,retry_count:0,duration:0,stall_count_per_100sec:0,stall_time_per_100sec:0,event_key:"play_stop",dns_parse_time:-1,redirect:-1,ttfb:-1,buffered:[],is_firstframe_received:0,meta:null},playing:{index:0,stall_count:0,stall_time:0,play_time:1e4,retry_count:0,is_last:0,video_buffer_time:0,audio_buffer_time:0,speed_switch_count:0,speed_switch_info:"none",download_speed:0,decode_fps:0,render_fps:0,drop_count:0,drop_percent:0,sei_source:"",sei_delay:0,ntp_sync:0,ntp_delta:0,event_key:"playing",stop_time:0,duration:0,stall_count_per_100sec:0,stall_time_per_100sec:0},play_error:{code:void 0,info:"",event_key:"play_error"},play_low_decode:{fps:-1,decode_fps:-1,bitrate:-1,url:-1,msg:"",event_key:"play_low_decode"},play_av_unsync:{aDts:-1,vDts:-1,frameLength:-1,currentTime:-1,duration:0,event_key:"play_av_unsync"},play_loadstream:{loadstream_url:"",event_key:"play_loadstream"},play_stream_loaded:{event_key:"play_stream_loaded"},play_metadata_loaded:{metadata_type:"",event_key:"play_metadata_loaded"},stream_exception:{event_key:"stream_exception"},pause:{event_key:"pause"},play_url_change:{event_key:"play_url_change"},source_opened:{event_key:"source_opened"},source_updateend:{event_key:"source_updateend"},play_result:{event_key:"play_result",result:0,threshold:15e3,is_threshold:0},degrade:{event_key:"degrade",payload:{}}}}function getCommonLog(e){var t=e.player,r=t.config.mediaType;return _objectSpread2$1({project_key:e.project_key,live_sdk_version:getPlayerCore(t)||t.hlsOps?"2":"-1",player_sdk_version:t.version,logger_version:"1.0.0-alpha.9",report_version:"5",product_line:e.product_line,user_id:e.user_id,device_id:e.device_id,logger_id:getLogId(),app_name:e.app_name,cdn_ip:e.cdn_ip,is_wasm:+(!!r&&"video"!==r),review_is_live:t.config.isLive?2:1,aid:e.aid,live_id:e.live_id||e.aid+"-"+e.user_id+"-"+Date.now(),is_preview:e.is_preview?1:0,codec_type:e.codec_type||"h264",width:Math.floor(t.config.width),height:Math.floor(t.config.height),browser:sniffer.browser,ua:navigator.userAgent,href:window.location.href,timestamp:0,logger_init_time:Date.now(),play_current_time:0,cdn_play_url:t.config.url&&t.config.url.startsWith("//")?window.location.protocol+t.config.url:t.config.url,play_format:getPlayFormat(t.config.url)},e.ext)}function Utf8ArrayToStr(e){var t,r,n,i,a,o;for(t="",n=e.length,r=0;r<n;)switch((i=e[r++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(i);break;case 12:case 13:a=e[r++],t+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=e[r++],o=e[r++],t+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&o)<<0)}return t}var getResourceTiming=function(e){var t=performance.getEntriesByType("resource").filter((function(t){return t.name===e}));if(t.length){var r=t[0],n=t[t.length-1];return{dns_parse_time:Number.parseInt(r.domainLookupEnd-r.domainLookupStart),redirect:Number.parseInt(r.redirectEnd-r.redirectStart),ttfb:Number.parseInt(n.responseStart-n.requestStart)}}return{dns_parse_time:-1,redirect:-1,ttfb:-1}},video_error={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},channelMapAppId={cn:7497,va:7997},Tea=new Collector("xglive"),Manage=function(){function e(e){var t=e.user_id,r=e.device_id,n=e.channel,i=void 0===n?"cn":n,a=e.channel_domain;if(!Tea.inited){var o={app_id:channelMapAppId[i],channel:i};a&&(o.channel_domain=a),Tea.init(o),Tea.start(),Tea.inited=!0}var s={};t&&(s.user_unique_id=t),r&&(s.device_id=r),Tea.config(s),this.logOptions=e,this._player=e.player}var t=e.prototype;return t.push=function(e){var t=this._player.config.url;this._player.video&&(e.play_current_time=this._player.currentTime),e.cdn_play_url=t&&t.startsWith("//")?window.location.protocol+t:t,e.play_format=getPlayFormat(t),e.timestamp=getCurrentTime(),this.send(e)},t.send=function(e){e.event_key&&(this.logOptions.onReport&&this.logOptions.onReport(e.event_key,e),Tea.event(e.event_key,_objectSpread2$1({},e)))},e}(),navgatorOnlineSupported=function(){return void 0!==navigator.onLine},navigatorConnectionType=function(){var e=navigator.connection;return e&&(e.effectiveType||e.type)},getNetStat=function(){return navgatorOnlineSupported()?navigator.onLine?navigatorConnectionType()||sniffer.device:"none":"unknown"},videoEvts=["play","playing","pause","ended","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","ratechange","volumechange","loadeddata"],isSafari=!1,LoggerControl=function(){function e(e){this.options=e,this.logger=new XgLiveLogger(e),this.restart=this.restart.bind(this),this.bindUrlChange(),isSafari=sniffer.browser.includes("Safari")}var t=e.prototype;return t.restart=function(e){this.destroy("string"!=typeof e&&Boolean(e)),this.logger=new XgLiveLogger(this.options),this.bindUrlChange(),this.logger.reportStartPlay(),this.logger.handlePlayerComlete()},t.bindUrlChange=function(){this.options&&this.options.player&&!this.options.manual_restart&&this.options.player.on("urlchange",this.restart)},t.setNTP=function(e){this.logger.setNTP(e)},t.updateExt=function(e){this.options.ext=Object.assign(this.options.ext||{},e),this.logger&&this.logger.updateExt(e)},t.destroy=function(e){this.logger.destroy(e),this.logger=null,this.options&&this.options.player&&!this.options.manual_restart&&this.options.player.off("urlchange",this.restart)},e}(),XgLiveLogger=function(){function t(e){if(!e.player)throw new Error("option player is necessary");this.options=Object.assign({},e,getDefaultOptions(e)),this._player=this.options.player,this._url=this._player.config.url,this.project_key=e.project_key||"xigua_live",this.product_line=e.product_line||"live",this.ntpDelta=this.options.ntp?Date.now()-this.options.ntp:0,this.inWaitingStart=0,this.errorNumber=0,this.tempDroppedFrameCount=0,this.tempTotalFrameCount=0;this.options.reportURL?this.options.reportURL:this.options.overseas||"https://log.isnssdk.com/video/v1/live_log/".replace("isnssdk","snssdk"),this._logmanager=new Manage(this.options),this.init(),this.started=!1,this.destroyed=!1,this.completed=!1,this.firstFrameViewed=!1,this.cacheRtcStats={}}var r=t.prototype;return r.setNTP=function(e){this.options&&(this.options.ntp=e,this.ntpDelta=Date.now()-this.options.ntp)},r.init=function(){this.bindCtx(),this.initLog(),this.initEvt()},r.bindCtx=function(){this.handlePlayerComlete=this.handlePlayerComlete.bind(this),this.handlePlayerPlaying=this.handlePlayerPlaying.bind(this),this.destroyFunc=this.destroyFunc.bind(this),this.handleUserLeave=this.handleUserLeave.bind(this),this.handlePlayerError=this.handlePlayerError.bind(this),this.handlePlayerReady=this.handlePlayerReady.bind(this),this.handlePlayerWaiting=this.handlePlayerWaiting.bind(this),this.handleAVUnsync=this.handleAVUnsync.bind(this),this.handlePlayerPause=this.handlePlayerPause.bind(this),this.handleTTFB=this.handleTTFB.bind(this),this.handleUrlChange=this.handleUrlChange.bind(this),this.handleKeyframe=this.handleKeyframe.bind(this),this.handleSourceOpen=this.handleSourceOpen.bind(this),this.handleBufferAppend=this.handleBufferAppend.bind(this),this.handleCoreEvent=this.handleCoreEvent.bind(this),this.handleDegrade=this.handleDegrade.bind(this)},r.initLog=function(){var e=this,t=this.options,r=t.player,n=void 0!==r.hlsOps;this.commonParams=_objectSpread2$1({os:sniffer.operation_os},getCommonLog(t)),this.log=Object.assign({},getDefaultLog());var i=this;for(var a in this.log){var o=function(t){Object.defineProperty(e.log[a],t,{get:function(){return null==this["_"+t]?i.commonParams[t]:this["_"+t]},set:function(e){this["_"+t]=e},enumerable:!0})};for(var s in this.commonParams)o(s);n&&Object.defineProperty(this.log[a],"m3u8",{get:function(){if(r.__core__){var e=r.__core__.m3u8Text;return e?e.slice(0,25e4):""}return""},enumerable:!0}),Object.defineProperty(this.log[a],"volume",{get:function(){if(r&&r.video)return r.volume||0},enumerable:!0}),Object.defineProperty(this.log[a],"access",{get:function(){return getNetStat()},enumerable:!0})}},r.updateExt=function(e){for(var t in this.log)for(var r in e)this.log[t][r]=e[r]},r.reportStartPlay=function(){this.started||(this.started=!0,this.log.start_play.start_play_time=this.log.start_play.timestamp=getCurrentTime(),this.logmanager.push(this.log.start_play,!0))},r.initWindowListener=function(){"pc"===sniffer.device?window.addEventListener("beforeunload",this.handleUserLeave):"mobile"===sniffer.device&&(window.addEventListener("beforeunload",this.handleUserLeave),window.addEventListener("pagehide",this.handleUserLeave))},r.removeWindowListener=function(){"pc"===sniffer.device?window.removeEventListener("beforeunload",this.handleUserLeave):"mobile"===sniffer.device&&(window.removeEventListener("beforeunload",this.handleUserLeave),window.removeEventListener("pagehide",this.handleUserLeave))},r.initEvt=function(){var e=this,t=this.player;videoEvts.forEach((function(t){e["handleVideo"+t+"Evt"]=function(){e["handleVideo"+t]&&e["handleVideo"+t]()},e.initWindowListener(),e.bindVideoEvt(t,e["handleVideo"+t+"Evt"])})),t.once("error",this.handlePlayerError),t.once("complete",this.handlePlayerComlete),t.once("playing",this.handlePlayerPlaying),t.once("timeupdate",this.handlePlayerPlaying),t.once("destroy",this.destroyFunc),t.on("ready",this.handlePlayerReady),t.on("waiting",this.handlePlayerWaiting),t.on("pause",this.handlePlayerPause),t.on("urlchange",this.handleUrlChange),t.once("sourceopen",this.handleSourceOpen),t.once("bufferappend",this.handleBufferAppend),t.on("core_event",this.handleCoreEvent),t.on("degrade",this.handleDegrade),this.hiJackPlayerStart()},r.handleCoreEvent=function(e){var t=e.eventName,r=e.headers,n=e.pts,i=e.type,a=e.meta,o=e.sei,s=e.decodeFps,l=e.url;switch(t){case"core.ttfb":this.handleTTFB(e);break;case"core.loadresponseheaders":var u=r.get("X-Server-Ip");void 0!==this.player.hlsOps&&(this.log.play_stop.review_ts_count+=1),u&&(this.commonParams.cdn_ip=u);break;case"core.loadretry":this.log.play_stop.retry_count++;break;case"core.keyframe":this.handleKeyframe(n);break;case"core.metadataparsed":this.handleMetaDataLoaded(i,a);break;case"core.sei":this.handleSEIParsed(o);break;case"core.lowdecode":this.commonParams.is_wasm&&(Object.assign(this.log.play_low_decode,e||{}),this.log.play_low_decode.decode_fps=s,this.log.play_low_decode.timestamp=getCurrentTime(),this.logmanager.push(this.log.play_low_decode,!0),this.commonParams.is_wasm=0);break;case"core.largeavgap":this.handleAVUnsync(e);break;case"core.loadstart":this.handlePlayerLoadStream(l);break;case"core.loadcomplete":this.handlePlayerLoadedStream();break;case"core.streamexception":this.handleStreamException(e)}},r.handleDegrade=function(e){this.log.degrade.payload=e,this.logmanager.push(this.log.degrade,!0)},r.hiJackPlayerStart=function(){var t=arguments,r=this;this.player._start=this.player.start;var n=this.player;n.start=function(){try{if(n._start)return n._start.apply(n,Array.prototype.slice.call(t,0))}catch(e){}r.destroyed||r.handlePlayerComlete()}},r.handleTTFB=function(e){var t=e||{},r=t.end,n=t.elapsed;this.log.first_frame.ttfb=n||-1,this.log.first_frame.ttfb_end=r||0},r.handleUrlChange=function(e){this.logmanager.push(Object.assign(this.log.play_url_change,{url:e,timestamp:getCurrentTime()}))},r.handleKeyframe=function(e){this.log.play_stop.is_firstframe_received=1,this.log.play_stop.firstframe_pts=e},r.handleSourceOpen=function(){this.log.source_opened.timestamp=getCurrentTime(),this.logmanager.push(this.log.source_opened)},r.handleBufferAppend=function(){this.log.source_updateend.timestamp=getCurrentTime(),this.logmanager.push(this.log.source_updateend)},r.handlePlayerPause=function(){this.log.pause.timestamp=getCurrentTime(),this.logmanager.push(this.log.pause,!0)},r.handlePlayerError=function(e){this.errorNumber=1;var t=e.errorType,r=e.errorCode;Object.assign(this.log.play_error,_objectSpread2$1({timestamp:getCurrentTime(),code:r||("parse"===t?31:21),info:e.message,detail:JSON.stringify(e)},this.videoSize)),this.logmanager.push(this.log.play_error,!0),this.destroyed||(0===this.log.first_frame.first_frame_view&&(Object.assign(this.log.first_frame_failed,{code:r||("parse"===t?31:21),msg:e.message}),void 0!==this.log.first_frame_failed.timestamp&&(this.log.first_frame_failed.timestamp=getCurrentTime()),this.logmanager.push(this.log.first_frame_failed,!0),this.log.play_result.is_threshold||(this.clearPlayResultTimer(),this.log.play_result.reason=e.message||"first frame failed",this.logmanager.push(this.log.play_result,!0))),this.options.error_report_stop?this.handleUserLeave():this.updatePlayStopParams())},r.handlePlayerLoadStream=function(e){if("string"==typeof e){var t=this.log.play_loadstream;t.timestamp=getCurrentTime(),t.loadstream_url=e,this.logmanager.push(t)}},r.handlePlayerLoadedStream=function(){var e=this.log.play_stream_loaded;e.timestamp=getCurrentTime(),this.logmanager.push(e)},r.handleSEIParsed=function(t){var r=this.log,n=r.playing,i=r.first_frame;if(100===t.code){var a=Utf8ArrayToStr(t.content);a=a.slice(a.indexOf("{"),a.lastIndexOf("}")+1);try{var o=JSON.parse(a),s=this.getPlayerBuffer()+this.ntpTime-o.ts;n.sei_delay=s,n.sei_source=o.source,n.ntp_sync=this.options.ntp?1:0,n.ntp_delta=this.ntp_delta,i.first_sei_delay=s,i.ntp_sync=this.options.ntp?1:0,i.ntp_delta=this.ntp_delta}catch(e){}}},r.handleMetaDataLoaded=function(e,t){this.log.play_stop.meta=this.log.play_stop.meta||{},e&&(this.log.play_stop.meta[e]=t),this.log.play_metadata_loaded.timestamp=getCurrentTime(),this.log.play_metadata_loaded.metadata_type=e,t&&(this.log.play_metadata_loaded.meta=t,this.log.play_metadata_loaded.codec=t.codec,this.commonParams.codec_type=t.codec),t||(this.log.play_metadata_loaded.meta=void 0,this.log.play_metadata_loaded.codec=void 0,"video"===e&&(this.commonParams.codec_type="unknown")),this.logmanager.push(this.log.play_metadata_loaded)},r.handleAVUnsync=function(e){Object.assign(this.log.play_av_unsync,e||{}),this.log.play_av_unsync.timestamp=getCurrentTime(),this.logmanager.push(this.log.play_av_unsync,!1)},r.handleStreamException=function(e){this.logmanager.push(Object.assign({},this.log.stream_exception,e))},r.handlePlayerComlete=function(){this.completed||(this.completed=!0,this.core=getPlayerCore(this.player),this.core&&(this.commonParams.live_sdk_version="2"),(this.player.config.autoplay||this.player.config.videoInit)&&this.reportStartPlay())},r.getPlayerBuffer=function(){var t=this.player.video.buffered;if(t){var r=Math.max(0,t.length-1);try{var n=Number.parseInt(1e3*(t.end(r)-this.player.video.currentTime));return this.log.playing.audio_buffer_time=this.log.playing.video_buffer_time=n,n}catch(e){return 0}}},r.getPlayerDownloadSpeed=function(){if(this.core&&this.core.core)return this.core.core.speedInfo().speed},r.getPlayerQuality=function(){var e=this.player.video;if(e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();this.log.playing.drop_count=t.droppedVideoFrames-this.tempDroppedFrameCount,this.log.playing.drop_percent=Number.parseFloat(this.tempTotalFrameCount/t.totalVideoFrames).toFixed(1),this.log.play_stop.drop_percent=Number.parseFloat(t.droppedVideoFrames/t.totalVideoFrames).toFixed(1),this.tempDroppedFrameCount=t.droppedVideoFrames,this.tempTotalFrameCount=t.totalVideoFrames}},r.getExtraStats=function(){var e=_asyncToGenerator$1(runtime_1.mark((function e(t,r){return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(isSafari||"undefined"!==window.InstallTrigger)return e();try{t.getStats((function(t){t.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,"ssrc"===e.type?(null!=t.googAccelerateRate&&(r.accelerate_rate=t.googAccelerateRate),"audio"===t.mediaType?(r.audio_jitter_buffer_ms=t.googJitterBufferMs,r.audio_rtt_ms=t.googRtt,r.expand_rate=t.googExpandRate):"video"===t.mediaType&&(r.video_rtt_ms=t.googRtt,r.video_codec_name=t.googCodecName)):"VideoBwe"===e.type&&(r.video_recv_retransmit_bps=t.googRetransmitBitrate)})),e()}))}catch(error){e()}})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),r.getRtcStats=function(){var e=_asyncToGenerator$1(runtime_1.mark((function e(t){var r,n,i,a,o=this;return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.player.plugins.rts&&this.player.plugins.rts.pc){e.next=3;break}return e.abrupt("return");case 3:return n={},e.next=6,r.getStats();case 6:return i=e.sent,a=t-this.log.playing.timestamp,i.forEach((function(e){var t=e.type,r=e.mediaType,i=e.bytesReceived,s=e.packetsReceived,l=e.audioLevel,u=e.concealmentEvents,c=e.remoteTimestamp,d=e.timestamp,h=e.framesDropped,f=e.framesPerSecond,p=e.keyFramesDecoded,y=e.totalDecodeTime,m=e.framesDecoded,g=e.firCount,v=e.frameHeight,b=e.frameWidth,_=e.framesReceived,E=e.jitterBufferDelay,T=e.jitterBufferEmittedCount,S=e.jitter,$=e.nackCount,A=e.packetsLost,w=e.pliCount,k=e.totalSamplesReceived,I=e.concealedSamples;switch(t){case"inbound-rtp":"audio"===r?(n.audio_bytes_received=i,n.audio_packets_lost=A,n.audio_packets_received=s,n.audio_volume=-10*Math.log10(Math.pow(l,2))*255,n.concealment_event=u,n.audio_fraction_lost=A/s,null!=o.cacheRtcStats.totalSamplesReceived&&(n.audio_dec_sample_rate=(k-o.cacheRtcStats.totalSamplesReceived)/a),o.cacheRtcStats.totalSamplesReceived=k,n.concealed_samples=I,n.total_samples_received=k):(n.frames_dropped_by_framebuffer=h,n.frame_buffer_out_interval=f,n.iframes_jitter_buffer_out=p,n.video_bytes_received=i,n.video_dec_elapse=1e3*y,n.video_decoded_delay_ms=n.video_dec_elapse/m,n.video_fir_count=g,n.video_fraction_lost=A/s,n.video_frame_height=v,n.video_frame_width=b,null!=o.cacheRtcStats.framesDecoded&&(n.video_framerate_decoder_output=(m-o.cacheRtcStats.framesDecoded)/a),o.cacheRtcStats.framesDecoded=m,null!=o.cacheRtcStats.framesReceived&&(n.video_framerate_recv=(_-o.cacheRtcStats.framesReceived)/a),o.cacheRtcStats.framesReceived=_,n.video_jb_min_delay=E/T*1e3,n.video_jitter=1e3*S,n.video_nack_count=$,n.video_packets_lost=A,n.video_packets_received=s,n.video_pli_count=w);break;case"remote-outbound-rtp":n.e2e_delay_ms=d-c}n.total_delay=n.e2e_delay_ms+n.video_decoded_delay_ms+n.video_jb_min_delay})),e.next=11,this.getExtraStats(r,n);case 11:this.log.playing.rtc_stats=n;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.reportPlaying=function(){var e=_asyncToGenerator$1(runtime_1.mark((function e(t){var r,n,i,a,o,s;return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.commonParams.is_wasm&&(this.commonParams.fps=this.player.video.fps,this.log.playing.render_fps=this.player.video.fps,this.log.playing.decode_fps=this.player.video.decodeFps),this.log.playing.index++,r=this.log.playing.timestamp,this.inWaitingStart&&this.inWaitingStart<getCurrentTime()&&(n=Math.min(this.options.playingInterval||this.log.playing.play_time,getCurrentTime()-Math.max(this.inWaitingStart,r))),this.getPlayerQuality(),this.getPlayerBuffer(),this.options.downloadSpeedInterval||(this.log.playing.current_speed=this.getPlayerDownloadSpeed()),i=getCurrentTime(),e.next=10,this.getRtcStats(i);case 10:a=i-r,o=(n>200?n:0)+this.log.playing.stall_time,s=(n>200?1:0)+this.log.playing.stall_count,this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=(n>this.options.aggregationDowngradeStallTime?n:0)+(this.log.playing.aggregation_downgrade_stall||0)),Object.assign(this.log.playing,_objectSpread2$1({timestamp:i,stop_time:i,duration:t?0:a/1e3,stall_time_per_100sec:o/a*100,stall_count_per_100sec:1e3*s/a*100,stall_count:s,stall_time:o,play_current_time:this.player.currentTime},this.videoSize)),this.logmanager.push(Object.assign({},this.log.playing,{play_time:t?0:a}),!0),this.log.playing.download_speed_array=[],this.log.playing.stall_time=0,this.log.playing.stall_count=0,this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r.handlePlayerPlaying=function(){var e=_asyncToGenerator$1(runtime_1.mark((function e(){var t,r=this;return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.player&&this.player.video.readyState<3)){e.next=2;break}return e.abrupt("return");case 2:return this.player.off("playing",this.handlePlayerPlaying),this.player.off("timeupdate",this.handlePlayerPlaying),e.next=6,this.reportPlaying(!0);case 6:this.clearPlayingInterval(),t=this.options.playingInterval||this.log.playing.play_time,this.intervalId=setInterval(_asyncToGenerator$1(runtime_1.mark((function e(){return runtime_1.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Math.abs(Date.now()-r.log.playing.timestamp-t)<100||Date.now()-r.log.playing.timestamp>=t)){e.next=3;break}return e.next=3,r.reportPlaying();case 3:case"end":return e.stop()}}),e)}))),1e3),this.clearStallTimer(),this.handleVideoplaying(),this.started||this.reportStartPlay(),this.saveBuffered();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.handlePlayerReady=function(){var e=this;this.log.start_play.start_play_time=getCurrentTime(),this.player.config.autoplay&&this.reportStartPlay(),this.options.playResultThreshold&&(this.log.play_result.threshold=this.options.playResultThreshold),this.clearPlayResultTimer(),this.playResultTimer=setTimeout((function(){e.log.play_result.is_threshold=1,e.logmanager.push(e.log.play_result,!0)}),this.log.play_result.threshold)},r.handlePlayerWaiting=function(){var e=this;!this.inWaitingStart&&this.log.first_frame.timestamp&&(this.log.stall.timestamp=this.inWaitingStart=this.log.stall.stall_start=getCurrentTime(),this.log.stall_start.ready_state=this.log.stall.ready_state=this.player.video.readyState,this.log.stall_start.timestamp=getCurrentTime(),this.log.stall_start.stall_start_time=getCurrentTime(),this.log.stall_start.video_buffer_time=this.player.video.readyState,this.log.stall_start.play_current_time=this.player.currentTime,this.log.stall.play_current_time=this.player.currentTime,this.log.stall_start.buffered=this.getBuffered(),this.log.stall.buffered=this.log.stall_start.buffered,this.log.stall.current_speed=this.getPlayerDownloadSpeed(),Object.assign(this.log.stall_start,this.videoSize),this.clearStallTimer(),this.stallStartTimer=setTimeout((function(){e.logmanager.push(e.log.stall_start,!0)}),205))},r.handleVideoseeking=function(){this.player&&this.player.video&&this.inWaitingStart&&this.player.video.duration<1/0&&(this.inWaitingStart=0,this.clearStallTimer())},r.handleVideoseeked=function(){this.player&&this.player.video&&this.inWaitingStart&&this.player.video.duration<1/0&&(this.inWaitingStart=0,this.log.play_stop.stall_count>0&&this.log.play_stop.stall_count--)},r.handleVideoplay=function(){this.reportStartPlay(),this.removeVideoEvt("play",this.handleVideoplay)},r.handleVideotimeupdate=function(){Math.abs(this.player.currentTime-this.log.stall_start.play_current_time)>.2&&this.stallEnd(),this.saveBuffered()},r.handleVideocanplay=function(){this.stallEnd(),this.reportFirstframe()},r.handleVideoplaying=function(){this.stallEnd(),this.log.play_stop.is_stream_received=1;var e=getCurrentTime();this.reportStartPlay(),this.log.first_frame.start=e},r.stallEnd=function(){this.clearStallTimer();var e=getCurrentTime();if(this.inWaitingStart){var t=e-this.inWaitingStart;t>200&&(this.log.play_stop.stall_count++,this.log.play_stop.stall_time+=e-this.inWaitingStart,this.log.playing.stall_time+=e-Math.max(this.inWaitingStart,this.log.playing.timestamp),this.log.stall.stall_end=e,this.log.stall.timestamp=getCurrentTime(),this.log.playing.stall_count++,Object.assign(this.log.stall,_objectSpread2$1({},this.videoSize)),this.logmanager.push(this.log.stall,!0)),this.options.aggregationDowngradeStallTime&&t>this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=(this.log.playing.aggregation_downgrade_stall||0)+(e-Math.max(this.inWaitingStart,this.log.playing.timestamp)))}this.inWaitingStart=0},r.handleVideoloadeddata=function(){this.reportFirstframe()},r.handleVideoratechange=function(){this.log.playing.speed_switch_count++,this.log.playing.speed_switch_info=this.player.video.playbackRate},r.handleVideoended=function(){this.clearPlayingInterval(),this.clearStallTimer(),Object.assign(this.log.playing,_objectSpread2$1({timestamp:getCurrentTime(),is_last:1},this.videoSize)),this.logmanager.push(this.log.playing)},r.handleVideoerror=function(){var e=this;this.errorNumber=1;var t=this.player.video.error;Object.assign(this.log.play_error,_objectSpread2$1(_objectSpread2$1({timestamp:getCurrentTime()},this.videoSize),t&&{code:t.code,info:t.message})),this.logmanager.push(this.log.play_error,!0),0!==e.log.first_frame.first_frame_view||e.log.first_frame_failed.code||t&&(e.log.first_frame_failed.code=t.code,e.log.first_frame_failed.msg=video_error[t.code],void 0!==e.log.first_frame_failed.timestamp&&(e.log.first_frame_failed.timestamp=getCurrentTime()),e.logmanager.push(e.log.first_frame_failed,!0),e.log.play_result.is_threshold||(e.log.play_result.reason=video_error[t.code]||"first frame failed",e.clearPlayResultTimer(),e.logmanager.push(e.log.play_result,!0))),e.options.error_report_stop?e.handleUserLeave():e.updatePlayStopParams()},r.handleVideopause=function(){this.stallEnd(),this.clearPlayingInterval(),this.clearStallTimer(),clearTimeout(this.collectDownloadSpeedTimer),this.player.once("playing",this.handlePlayerPlaying),this.player.once("timeupdate",this.handlePlayerPlaying)},r.destroyFunc=function(e){var t=this;this.destroyed||(e||this.handleUserLeave(),this.destroyed=!0,"pc"===sniffer.device?window.removeEventListener("beforeunload",this.handleUserLeave):"mobile"===sniffer.device&&window.removeEventListener("pagehide",this.handleUserLeave),videoEvts.forEach((function(e){t.removeVideoEvt(e,t["handleVideo"+e+"Evt"])})),this.player&&(this.player._start&&(this.player.start=this.player._start,delete this.player._start),this.player.off("destroy",this.destroyFunc),this.player.off("complete",this.handlePlayerComlete),this.player.off("playing",this.handlePlayerPlaying),this.player.off("timeupdate",this.handlePlayerPlaying),this.player.off("ready",this.handlePlayerReady),this.player.off("waiting",this.handlePlayerWaiting),this.player.off("largeavgap",this.handleAVUnsync),this.player.off("error",this.handlePlayerError),this.player.off("SEI_PARSED",this.handleSEIParsed),this.player.off("pause",this.handlePlayerPause),this.player.off("ttfb",this.handleTTFB),this.player.off("urlchange",this.handleUrlChange),this.player.off("isKeyframe",this.handleKeyframe),this.player.off("sourceopen",this.handleSourceOpen),this.player.off("bufferappend",this.handleBufferAppend),this.player.off("core_event",this.handleCoreEvent),this.player.off("degrade",this.handleDegrade),this.clearPlayingInterval(),this.clearStallTimer(),clearTimeout(this.collectDownloadSpeedTimer),this._player=null))},r.handleUserLeave=function(){!this.destroyed&&this.started&&(this.destroyed=!0,this.updatePlayStopParams(),this.reportPlayStop(),this.clearPlayingInterval(),this.clearStallTimer(),clearTimeout(this.collectDownloadSpeedTimer),this.removeWindowListener())},r.saveBuffered=function(){try{var e=this.getBuffered();e&&e.length&&(this.log.play_stop.buffered=e)}catch(error){}},r.getBuffered=function(){try{for(var e=[],t=this.player.video,r=0;r<t.buffered.length;r++)e.push([t.buffered.start(r),t.buffered.end(r)]);return e}catch(error){}},r.reportPlayStop=function(){this.log.play_stop.play_current_time=this.player.currentTime||this.log.playing.play_current_time,this.saveBuffered(),this.logmanager.push(this.log.play_stop,!0)},r.reportFirstframe=function(){if(!this.firstFrameViewed){this.firstFrameViewed=!0;var e=getCurrentTime();Object.assign(this.log.first_frame,_objectSpread2$1({first_frame_view:e-this.log.start_play.start_play_time||e,timestamp:e},this.videoSize)),this.log.first_frame.ttfb_end&&(this.log.first_frame.ttdb=e-this.log.first_frame.ttfb_end),this.logmanager.push(this.log.first_frame,!0),this.clearPlayResultTimer(),this.log.play_result.result=1,this.logmanager.push(this.log.play_result,!0),this.log.play_stop.is_stream_received=1}},r.updatePlayStopParams=function(){var e=getResourceTiming(this._url),t=getCurrentTime();this.playedTime=t-this.log.start_play.start_play_time;var r=this.log.play_stop;Object.assign(r,_objectSpread2$1({},0===r.stall_count&&{stall_time:0})),this.inWaitingStart&&t-this.inWaitingStart>200&&(r.stall_time+=t-this.inWaitingStart),this.inWaitingStart=0,Object.assign(r,_objectSpread2$1({stall_time_per_100sec:r.stall_time/this.playedTime*100,stall_count_per_100sec:1e3*r.stall_count/this.playedTime*100},e)),0===this.log.play_stop.stall_count_per_100sec&&(this.log.play_stop.stall_time_per_100sec=0),this.log.play_stop.stall_time_per_100sec>100||this.log.play_stop.stall_time_per_100sec<0||(this.log.playing.index?(Object.assign(this.log.playing,_objectSpread2$1({timestamp:getCurrentTime(),is_last:1},this.videoSize)),this.logmanager.push(this.log.playing,!0)):(this.log.play_stop.error_code=this.log.play_error.code,this.log.play_stop.error_info=this.log.play_error.info),t=getCurrentTime(),Object.assign(r,_objectSpread2$1({timestamp:t,stop_time:t,duration:this.playedTime/1e3,play_time:this.playedTime/1e3},this.videoSize)),0===this.errorNumber&&(r.play_time_on_no_frame=r.stop_time-this.log.start_play.start_play_time))},r.clearPlayingInterval=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},r.clearStallTimer=function(){clearTimeout(this.stallStartTimer)},r.clearPlayResultTimer=function(){clearTimeout(this.playResultTimer)},r.destroy=function(e){this.destroyFunc(!e)},r.bindVideoEvt=function(e,t){this.player&&this.player.video.addEventListener(e,t,!1)},r.removeVideoEvt=function(e,t){this.player&&this.player.video&&this.player.video.removeEventListener(e,t,!1)},r.send=function(e,t){this.logmanager.send(e,t)},_createClass$2(t,[{key:"videoSize",get:function(){return this.player?{width:this.player.video.videoWidth,height:this.player.video.videoHeight}:{width:0,height:0}}},{key:"player",get:function(){return this._player}},{key:"logmanager",get:function(){return this._logmanager}},{key:"ntpTime",get:function(){return Date.now()-this.ntpDelta}}]),t}(),LiveLogger=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"afterCreate",value:function(){var e,t,r=this;this.config.enable&&(this.config.appId?(this.openLog(),null===(e=this.player.plugins)||void 0===e||null===(t=e.sdkerrorplugin)||void 0===t||t.addErrDetail((function(){var e,t,n;if(r._liveLogger)return{label:"userId",value:null===(e=r._liveLogger)||void 0===e||null===(t=e.logger)||void 0===t||null===(n=t.options)||void 0===n?void 0:n.user_id}}))):console.info("not found appid, logger is closed"))}},{key:"startLog",value:function(){this._liveLogger=new LoggerControl({player:this.player,aid:this.config.appId,project_key:this.config.appId,app_name:this.config.appId,channel_domain:"//mcs.volceapplog.com"})}},{key:"closeLog",value:function(){this._liveLogger.destroy(),this._liveLogger=null}},{key:"openLog",value:function(){!this._liveLogger&&this.startLog()}}],[{key:"pluginName",get:function(){return"liveLogger"}},{key:"defaultConfig",get:function(){return{appId:"",enable:!0}}}]),r}(Plugin);function createSDKPreset(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,a=["default",getDefaultPreset(e)],o=i.configs,s=isEncryptPlay(null==o?void 0:o.getVideoByToken),l=getPluginConfig(o,"EncryptHlsPlugin"),u=!!l||"hls"===t&&s;return r?a.push(getMobilePreset(e,t,n,u,i)):a.push(getPCPreset(e,t,u,i)),a}function getDefaultPreset(e){var t=[ErrorPlugin,ToastPlugin];return e&&t.push(RefreshPlugin,LiveLogger,UnmutePlugin),_createClass$k((function e(){_classCallCheck$j(this,e),this.plugins=t,this.ignores=["error"]}))}function getMobilePreset(e,t,r,n,i){var a,o=["error","playbackRate"],s=i.configs,l=getPluginConfig(s,"EncryptHlsPlugin"),u=null==s||null===(a=s.autoBitrateOpts)||void 0===a?void 0:a.isOpenAutoDefi;null!=l&&l.playAuthToken||u||o.push("definition");var c=["time","playnext","progress","progresspreview","replay","playbackRate","discontinue","PlaybackRateMobilePlugin"],d=e?[MoreButtonPlugin,DanmuPlugin]:[MoreButtonPlugin];switch(t){case"flv":r&&d.push(FlvPlugin);break;case"hls":HlsPlugin.isSupported(!0)&&r&&d.push(HlsPlugin);break;case"rtm":d.push(RtmPlugin);break;case"dash":var h,f;if(s.url)d.push(ShakaJsPlugin);else null!=DASHPlugin&&null!==(h=DASHPlugin.encryptUtils)&&void 0!==h&&null!==(f=h.isSupported)&&void 0!==f&&f.call(h)&&d.push(DASHPlugin)}return _createClass$k((function r(){_classCallCheck$j(this,r),this.plugins=getPluginByConfig(t,n,i,d),this.ignores=e?[].concat(c,o):[].concat(o)}))}function getPCPreset(e,t,r,n){var i,a=["cssfullscreen"],o=["time","playnext","progress","progresspreview","replay","playbackRate","discontinue"],s=e?[MultilinePlugin,DanmuPlugin]:[],l=n.configs,u=getPluginConfig(l,"EncryptHlsPlugin"),c=null==l||null===(i=l.autoBitrateOpts)||void 0===i?void 0:i.isOpenAutoDefi;switch(null!=u&&u.playAuthToken||c||(a.push("definition"),s.push(DefinitionPlugin)),t){case"flv":s.push(FlvPlugin);break;case"hls":s.push(HlsPlugin);break;case"rtm":s.push(RtmPlugin);break;case"dash":l.url?s.push(ShakaJsPlugin):s.push(DASHPlugin)}return _createClass$k((function i(){_classCallCheck$j(this,i),this.plugins=getPluginByConfig(t,r,n,s),this.ignores=e?[].concat(o,a):[].concat(a)}))}function getPluginByConfig(e,t,r,n){var i,a=[],o=r.configs,s=r.options,l=isEncryptPlay(null==o?void 0:o.getVideoByToken);t&&(a.push(EncryptHlsPlugin),n=n.filter((function(e){return e!==HlsPlugin}))),getPluginConfig(s,"DASHPlugin")&&!n.includes(DASHPlugin)&&a.push(DASHPlugin),getPluginConfig(s,"vodLogOpts")&&a.push(xgVodLogger),o.enableContextmenu&&a.push(MenuPlugin),(o.enableMp4MSE||getPluginConfig(s,"Mp4EncryptPlayer")||"mp4"===e&&(l||null!=o&&null!==(i=o.autoBitrateOpts)&&void 0!==i&&i.isOpenAutoDefi||r.openSoftDecoding))&&a.push(Mp4EncryptPlayer),!n.includes(DanmuPlugin)&&getPluginConfig(s,"DanmuPlugin")&&a.push(DanmuPlugin);var u=a.filter((function(e){var t,r,n,i,a;return"encrypthlsplugin"===(null==e||null===(t=e.pluginName)||void 0===t?void 0:t.toLowerCase())?!(null==e||null===(n=e.isSupported)||void 0===n||!n.call(e))||(console.warn(" EncryptHlsPlugin "),!1):"dashplugin"!==(null==e||null===(r=e.pluginName)||void 0===r?void 0:r.toLowerCase())||(!(null==e||null===(i=e.encryptUtils)||void 0===i||null===(a=i.isSupported)||void 0===a||!a.call(i))||(console.warn(" DASHPlugin "),!1))}));return[].concat(_toConsumableArray$a(n),_toConsumableArray$a(u))}function danmuSettingsSVG$1(){return(new DOMParser).parseFromString('<svg width="22" height="19" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" opacity=".6"><path d="M-4-4h28v28H-4z"/><path d="M1 19a1 1 0 01-1-1V1a1 1 0 011-1h17.2a1 1 0 011 1v3.75h-.001l.001 1.475a.9.9 0 11-1.8 0V1.8H1.8v15.4h8.442l-.029.019h.296a.89.89 0 01.017 1.78h7.691L18.2 19H1z" fill="#FFF" fill-rule="nonzero"/><path d="M5.507 7.698L5.33 9.279h2.511c0 2.015-.075 3.362-.2 4.042-.151.68-.792 1.054-1.934 1.124-.327 0-.653-.023-1.005-.047l-.339-1.136c.327.035.678.059 1.03.059.628 0 .98-.188 1.067-.563.088-.374.138-1.183.138-2.424H4l.352-3.679h2.122V5.132H4.113V4.09h3.654v3.608h-2.26zm3.089-2.214h1.507A8.91 8.91 0 009.16 4.03l1.193-.375c.351.469.665.96.93 1.5l-.792.328h1.733a14.68 14.68 0 00.93-1.921l1.242.41a8.956 8.956 0 01-.854 1.51H15v4.933h-2.587v.902h2.446l-1.014 1.148h-1.432v2.097h-1.28v-2.097h-2.99v-1.148h2.99v-.902H8.595V5.484zm5.249 3.912v-.913h-1.432v.913h1.432zm-2.713 0v-.913H9.764v.913h1.368zm-1.368-1.92h1.368v-.961H9.764v.96zm2.65-.961v.96h1.43v-.96h-1.43z" fill="#FFF" fill-rule="nonzero"/><path d="M17.595 9.84l2.957 1.69a1.2 1.2 0 01.605 1.041v3.358c0 .43-.23.828-.605 1.041l-2.957 1.69a1.2 1.2 0 01-1.19 0l-2.957-1.69a1.2 1.2 0 01-.605-1.041V12.57c0-.43.23-.828.605-1.041l2.957-1.69a1.2 1.2 0 011.19 0zM17 12.47c-.994 0-1.8.797-1.8 1.781a1.79 1.79 0 001.8 1.781c.994 0 1.8-.797 1.8-1.781a1.79 1.79 0 00-1.8-1.781z" fill="#FFF"/></g></svg>',"image/svg+xml").firstChild}function fullscreenActiveSVG$1(){return(new DOMParser).parseFromString('<svg width="21" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.892 2h4.445v1.778H3.892v4.444H2.114V3.778C2.114 2.796 2.91 2 3.892 2zm4.445 16v-4.444c0-.982-.796-1.778-1.778-1.778H2.114v1.778h2.944L2.264 16.35a.9.9 0 001.272 1.273l2.988-2.987a.918.918 0 00.035-.037V18h1.778zm8-6.222v4.444h-4.445V18h4.445c.981 0 1.777-.796 1.777-1.778v-4.444h-1.777zM11.892 2v4.445c0 .981.796 1.777 1.778 1.777h4.444V6.445H15.17l2.568-2.568a.9.9 0 10-1.273-1.273L13.67 5.4V2h-1.778z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function fullscreenDefaultSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.778 2h4.444v1.778H3.778v4.444H2V3.778C2 2.796 2.796 2 3.778 2zM2 11.778v4.444C2 17.204 2.796 18 3.778 18h4.444v-1.778H4.823l2.313-2.313a.9.9 0 00-1.272-1.273l-2.086 2.086v-2.944H2zm14.222 0v4.444h-4.444V18h4.444c.982 0 1.778-.796 1.778-1.778v-4.444h-1.778zM18 8.222V3.778C18 2.796 17.204 2 16.222 2h-4.444v1.778h2.945l-2.587 2.586a.9.9 0 101.273 1.273l2.813-2.813v3.398H18z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function pauseSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="5.313" y="3.75" width="3.125" height="12.5" rx=".625" fill="#fff"/><rect x="11.563" y="3.75" width="3.125" height="12.5" rx=".625" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.121 8.299a2 2 0 010 3.402l-7.94 4.91c-1.332.825-3.051-.133-3.051-1.7V5.09c0-1.567 1.72-2.525 3.052-1.701l7.939 4.911z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playNextSVG$1(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.03 8.312a2 2 0 010 3.376l-7.642 4.858c-1.332.847-3.073-.11-3.073-1.687V5.14c0-1.577 1.741-2.534 3.073-1.687l7.642 4.858z" fill="#fff"/><path d="M13 3.5a.5.5 0 01.5-.5h1a.5.5 0 01.5.5v13a.5.5 0 01-.5.5h-1a.5.5 0 01-.5-.5v-13z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function replaySVG(){return(new DOMParser).parseFromString('<svg width="72" height="72" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg"><g fill="#FFF" fill-rule="evenodd"><circle fill-opacity=".3" cx="36" cy="36" r="36"/><path d="M40.167 32.667a.833.833 0 01-.834-.834v-1.666c0-.46.373-.834.834-.834h5.409a11.653 11.653 0 00-9.576-5c-6.443 0-11.667 5.224-11.667 11.667S29.557 47.667 36 47.667c5.285 0 9.749-3.514 11.183-8.333h3.445C49.112 46.014 43.138 51 36 51c-8.284 0-15-6.716-15-15 0-8.284 6.716-15 15-15 4.713 0 8.918 2.173 11.668 5.572l-.001-4.739c0-.46.373-.833.833-.833h1.667c.46 0 .833.373.833.833V31c0 .879-.68 1.598-1.542 1.662l-.125.005h-9.166z"/></g></svg>',"image/svg+xml").firstChild}function startPlaySVG(){return(new DOMParser).parseFromString('<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="60" height="60" rx="30" fill="#000" fill-opacity=".4"/><path d="M40.243 28.3a2 2 0 010 3.401L24.06 41.712c-1.332.825-3.052-.134-3.052-1.7V19.988c0-1.566 1.72-2.525 3.052-1.7l16.184 10.01z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function volumeLargeSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.867 2.5h.55c.44 0 .799.34.83.771l.003.062v13.334c0 .44-.34.799-.771.83l-.062.003h-.55a.833.833 0 01-.444-.128l-.064-.045-4.867-3.744a.831.831 0 01-.322-.59l-.003-.07V7.077c0-.235.099-.458.271-.615l.054-.045L9.36 2.673a.832.832 0 01.43-.17l.078-.003h.55-.55zm6.767 2.278A7.474 7.474 0 0118.75 10a7.477 7.477 0 01-2.128 5.234.4.4 0 01-.57-.004l-.587-.586a.442.442 0 01.005-.617A5.812 5.812 0 0017.083 10c0-1.557-.61-2.97-1.603-4.017a.442.442 0 01-.003-.615l.586-.586a.4.4 0 01.57-.004zM2.5 6.667c.23 0 .417.186.417.416v5.834c0 .23-.187.416-.417.416h-.833a.417.417 0 01-.417-.416V7.083c0-.23.187-.416.417-.416H2.5zm11.768.46A4.153 4.153 0 0115.417 10c0 1.12-.442 2.137-1.162 2.886a.388.388 0 01-.555-.007l-.577-.578c-.176-.176-.156-.467.009-.655A2.49 2.49 0 0013.75 10a2.49 2.49 0 00-.61-1.636c-.163-.188-.182-.477-.006-.653l.578-.578a.388.388 0 01.556-.006z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function volumeMutedSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.045 2.5h.55c.44 0 .8.34.831.771l.003.062v13.334c0 .44-.34.799-.771.83l-.063.003h-.55a.833.833 0 01-.443-.128l-.065-.045-4.866-3.744a.831.831 0 01-.323-.59l-.003-.07V7.077c0-.235.1-.458.272-.615l.054-.045 4.866-3.744a.832.832 0 01.43-.17l.078-.003h.55-.55zM2.68 6.667c.23 0 .416.186.416.416v5.834c0 .23-.186.416-.416.416h-.834a.417.417 0 01-.416-.416V7.083c0-.23.186-.416.416-.416h.834zm10.467.294a.417.417 0 01.59 0l1.767 1.768L17.27 6.96a.417.417 0 01.589 0l.59.59a.417.417 0 010 .589L16.68 9.908l1.768 1.767c.15.15.162.387.035.55l-.035.04-.589.589a.417.417 0 01-.59 0l-1.767-1.768-1.768 1.768a.417.417 0 01-.59 0l-.588-.59a.417.417 0 010-.589l1.767-1.768-1.767-1.767a.417.417 0 01-.035-.55l.035-.04.589-.589z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function volumeSmallSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.867 2.5h.55c.44 0 .799.34.83.771l.003.062v13.334c0 .44-.34.799-.771.83l-.062.003h-.55a.833.833 0 01-.444-.128l-.064-.045-4.867-3.744a.831.831 0 01-.322-.59l-.003-.07V7.077c0-.235.099-.458.271-.615l.054-.045L9.36 2.673a.832.832 0 01.43-.17l.078-.003h.55-.55zM2.5 6.667c.23 0 .417.186.417.416v5.834c0 .23-.187.416-.417.416h-.833a.417.417 0 01-.417-.416V7.083c0-.23.187-.416.417-.416H2.5zm11.768.46A4.153 4.153 0 0115.417 10c0 1.12-.442 2.137-1.162 2.886a.388.388 0 01-.555-.007l-.577-.578c-.176-.176-.156-.467.009-.655A2.49 2.49 0 0013.75 10a2.49 2.49 0 00-.61-1.636c-.163-.188-.182-.477-.006-.653l.578-.578a.388.388 0 01.556-.006z" fill="#fff"/></svg>',"image/svg+xml").firstChild}var iconsOption$1={startPlay:startPlaySVG,play:playSVG$1,pause:pauseSVG$1,fullscreen:fullscreenDefaultSVG$1,exitFullscreen:fullscreenActiveSVG$1,playNext:playNextSVG$1,replay:replaySVG,refresh:refreshSVG$1,danmuSetting:danmuSettingsSVG$1,openDanmu:Default,closeDanmu:danmuActiveSVG$1,volumeLarge:volumeLargeSVG,volumeMuted:volumeMutedSVG,volumeSmall:volumeSmallSVG},initOption$1={whitelist:[""],widescreen:!0,width:"100%",height:"100%",lang:"zh",fitVideoSize:!1,autoplay:!0,autoplayMuted:!0,inactive:2e3,playsinline:!0,keyShortcut:"off",closeVideoClick:!0,closeVideoDblclick:!0,closePlayerBlur:!1,closeControlsBlur:!1,closePlayVideoFocus:!0,leavePlayerTime:0,mini:!1,pip:{position:"controlsRight",index:2.5,showIcon:!0},volume:{index:2.6},miniscreen:{left:window.innerWidth-360,top:window.innerHeight-450},time:{index:3},icons:_objectSpread2$c({},iconsOption$1),flv:{retryCount:0},hls:{retryCount:0}},liveOption$1={isLive:!0,closeVideoClick:!0,preloadTime:8,start:{isShowPause:!1,isShowEnd:!1,mode:"hide",disableAnimate:!0},retry:{count:0}},vodOption$1={isLive:!1,closeVideoClick:!1,defaultPlaybackRate:1,closeVideoStopPropagation:!0,autoplay:!1,autoplayMuted:!1,playbackRate:[2,1.5,1.25,{rate:1,iconText:{zh:"",en:"Speed",jp:"Speed"}},.75,.5],start:{isShowPause:!0,isShowEnd:!1,mode:"hide",disableAnimate:!0},progresspreview:{isShowCoverPreview:!0},progress:{isPauseMoving:!0}};function createPlayerOption$1(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=_objectSpread2$c({},initOption$1),r=_objectSpread2$c({},e?liveOption$1:vodOption$1);return _objectSpread2$c(_objectSpread2$c({},t),r)}function danmuSVG(){return(new DOMParser).parseFromString('<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.746 12.444a1 1 0 00-.62.216L1.75 13.75V2.166c0-.23.187-.417.417-.417h11.666c.23 0 .417.187.417.417v6.687c.44.044.86.156 1.25.326V2.167c0-.92-.746-1.667-1.667-1.667H2.167C1.247.5.5 1.246.5 2.167V14.61a.833.833 0 001.35.653l1.71-1.354a1 1 0 01.621-.216h5.543a4.195 4.195 0 01-.02-1.25H3.745z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 4a.5.5 0 00-.5.5V5a.5.5 0 00.5.5h5A.5.5 0 0010 5v-.5a.5.5 0 00-.5-.5h-5zm2.333 4.167a.5.5 0 00-.5.5v.666a.5.5 0 00.5.5h4.292c.311-.266.662-.487 1.042-.653v-.513a.5.5 0 00-.5-.5H6.834zm-3 .5a.5.5 0 01.5-.5H5a.5.5 0 01.5.5v.666a.5.5 0 01-.5.5h-.667a.5.5 0 01-.5-.5v-.666z" fill="#fff"/><path d="M11 4.5a.5.5 0 01.5-.5h.5a.5.5 0 01.5.5V5a.5.5 0 01-.5.5h-.5A.5.5 0 0111 5v-.5z" fill="#fff"/><circle cx="13.833" cy="13" r="3.333" fill="#3370FF"/><path d="M15.591 12.011l-2.133 2.134-1.22-1.22" stroke="#fff" stroke-linecap="round" stroke-linejoin="round"/></svg>',"image/svg+xml").firstChild}function danmuActiveSVG(){return(new DOMParser).parseFromString('<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.746 12.444a1 1 0 00-.62.216L1.75 13.75V2.166c0-.23.187-.417.417-.417h11.666c.23 0 .417.187.417.417v6.687c.44.044.86.156 1.25.326V2.167c0-.92-.746-1.667-1.667-1.667H2.167C1.247.5.5 1.246.5 2.167V14.61a.833.833 0 001.35.653l1.71-1.354a1 1 0 01.621-.216h5.543a4.195 4.195 0 01-.02-1.25H3.745z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 4a.5.5 0 00-.5.5V5a.5.5 0 00.5.5h5A.5.5 0 0010 5v-.5a.5.5 0 00-.5-.5h-5zm2.333 4.167a.5.5 0 00-.5.5v.666a.5.5 0 00.5.5h4.292c.311-.266.662-.487 1.042-.653v-.513a.5.5 0 00-.5-.5H6.834zm-3 .5a.5.5 0 01.5-.5H5a.5.5 0 01.5.5v.666a.5.5 0 01-.5.5h-.667a.5.5 0 01-.5-.5v-.666z" fill="#fff"/><path d="M11 4.5a.5.5 0 01.5-.5h.5a.5.5 0 01.5.5V5a.5.5 0 01-.5.5h-.5A.5.5 0 0111 5v-.5z" fill="#fff"/><circle cx="13.833" cy="13" r="2.733" stroke="#fff" stroke-width="1.2"/><path fill="#fff" d="M12.833 10.77l3.473 3.472-1.063 1.064-3.474-3.473z"/></svg>',"image/svg+xml").firstChild}function danmuSettingsSVG(){return(new DOMParser).parseFromString('<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.746 12.444a1 1 0 00-.62.216L1.75 13.75V2.166c0-.23.187-.417.417-.417h11.666c.23 0 .417.187.417.417v6.687c.44.044.86.156 1.25.326V2.167c0-.92-.746-1.667-1.667-1.667H2.167C1.247.5.5 1.246.5 2.167V14.61a.833.833 0 001.35.653l1.71-1.354a1 1 0 01.621-.216h5.543a4.195 4.195 0 01-.02-1.25H3.745z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 4a.5.5 0 00-.5.5V5a.5.5 0 00.5.5h5A.5.5 0 0010 5v-.5a.5.5 0 00-.5-.5h-5zm2.333 4.167a.5.5 0 00-.5.5v.666a.5.5 0 00.5.5h4.292c.311-.266.662-.487 1.042-.653v-.513a.5.5 0 00-.5-.5H6.834zm-3 .5a.5.5 0 01.5-.5H5a.5.5 0 01.5.5v.666a.5.5 0 01-.5.5h-.667a.5.5 0 01-.5-.5v-.666z" fill="#fff"/><path d="M11 4.5a.5.5 0 01.5-.5h.5a.5.5 0 01.5.5V5a.5.5 0 01-.5.5h-.5A.5.5 0 0111 5v-.5z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.387 10.134a1 1 0 00-1 0l-1.887 1.09a1 1 0 00-.5.865v2.179a1 1 0 00.5.866l1.887 1.09a1 1 0 001 0l1.886-1.09a1 1 0 00.5-.866v-2.179a1 1 0 00-.5-.866l-1.886-1.089zm-.5 4.711a1.667 1.667 0 100-3.333 1.667 1.667 0 000 3.333z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function fullscreenActiveSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.5 8.333h-4.167c-.92 0-1.666-.746-1.666-1.666V2.5h1.666v4.167H17.5v1.666zM2.5 6.667v1.666h4.167c.92 0 1.666-.746 1.666-1.666V2.5H6.667v4.167H2.5zM2.5 13.333h4.167V17.5h1.666v-4.167c0-.92-.746-1.666-1.666-1.666H2.5v1.666zM13.333 17.5v-4.167H17.5v-1.666h-4.167c-.92 0-1.666.746-1.666 1.666V17.5h1.666z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function fullscreenDefaultSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.125 3a.375.375 0 00-.375.375v.75c0 .207.168.375.375.375H15.5v3.375c0 .207.168.375.375.375h.75A.375.375 0 0017 7.875v-4.5A.375.375 0 0016.625 3h-4.5zm0 12.5a.375.375 0 00-.375.375v.75c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-4.5a.375.375 0 00-.375-.375h-.75a.375.375 0 00-.375.375V15.5h-3.375zM3 3.375C3 3.168 3.168 3 3.375 3h4.5c.207 0 .375.168.375.375v.75a.375.375 0 01-.375.375H4.5v3.375a.375.375 0 01-.375.375h-.75A.375.375 0 013 7.875v-4.5zM7.875 15.5H4.5v-3.375a.375.375 0 00-.375-.375h-.75a.375.375 0 00-.375.375v4.5c0 .207.168.375.375.375h4.5a.375.375 0 00.375-.375v-.75a.375.375 0 00-.375-.375z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function pauseSVG(){return(new DOMParser).parseFromString('<svg style="\n    height: 18px;\n    width: 18px;\n" width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="7.438" y="5.25" width="4.375" height="17.5" rx=".875" fill="#fff"/><rect x="16.188" y="5.25" width="4.375" height="17.5" rx=".875" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playSVG(){return(new DOMParser).parseFromString('<svg style="\n    height: 18px;\n    width: 18px;\n" width="28" height="28" fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg"><path d="M19.77 11.619c1.768 1.094 1.768 3.668 0 4.762L8.653 23.257c-1.865 1.154-4.273-.188-4.273-2.381V7.125c0-2.194 2.408-3.536 4.273-2.382L19.77 11.62z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function playNextSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.77 4.124l8.358 5.07c.38.23.486.704.238 1.056a.807.807 0 01-.238.22L4.77 15.543c-.38.231-.889.132-1.137-.221a.723.723 0 01-.134-.417V4.762c0-.421.368-.762.822-.762.159 0 .316.042.449.124z" stroke="#fff" stroke-width="1.5"/><path d="M15.5 4.5A.5.5 0 0116 4h.5a.5.5 0 01.5.5v11a.5.5 0 01-.5.5H16a.5.5 0 01-.5-.5v-11z" fill="#fff"/></svg>',"image/svg+xml").firstChild}function refreshSVG(){return(new DOMParser).parseFromString('<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h18v18H0z"/><path d="M10.875 7.5a.375.375 0 01-.375-.375v-.75c0-.207.168-.375.375-.375h2.434a5.25 5.25 0 10.723 4.5h1.55a6.75 6.75 0 11-1.332-5.743V2.626c0-.207.168-.375.375-.375h.75c.207 0 .375.168.375.375V6.75a.75.75 0 01-.694.748L15 7.5h-4.125z" fill="#FFF"/></g></svg>',"image/svg+xml").firstChild}var iconsOption={startPlay:startPlaySVG,play:playSVG,pause:pauseSVG,fullscreen:fullscreenDefaultSVG,exitFullscreen:fullscreenActiveSVG,playNext:playNextSVG,replay:replaySVG,refresh:refreshSVG,danmuSetting:danmuSettingsSVG,openDanmu:danmuSVG,closeDanmu:danmuActiveSVG,volumeLarge:volumeLargeSVG,volumeMuted:volumeMutedSVG,volumeSmall:volumeSmallSVG};sniffer$1.os.isAndroid;var initOption={width:"100%",height:"100%",lang:"zh",playsinline:!0,closeVideoClick:!0,closeVideoTouch:!0,autoplay:!0,autoplayMuted:!0,whitelist:[""],"x5-video-player-type":"h5-page","x5-video-player-fullscreen":!1,"x5-video-orientation":"landscape|portrait",enterTips:{background:"linear-gradient(90deg,#000,#49e6d3,#49e6d3,#138afc,#000)"},retainPlay:!0,start:{isShowPause:!0,isShowEnd:!0,disableAnimate:!1},fullscreen:{useCssFullscreen:!1},plugins:[],time:{mode:"pc",index:2.5},controls:{mode:"flex"},danmusettings:{index:"2"},danmuicon:{index:"3"},cusPlaybackRatePlugin:{needCheck:!0,needPanel:!1},icons:_objectSpread2$c({},iconsOption),flv:{innerDegrade:1,retryCount:0},hls:{innerDegrade:1,retryCount:0}},liveOption={isLive:!0,closeVideoClick:!0,start:{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"},retry:{count:0},longwaiting:{duration:3e4},mobile:{gestureY:!1,gestureX:!1,disableActive:!0}},vodOption={isLive:!1,closeVideoClick:!1,autoplay:!1,autoplayMuted:!1,playbackRate:[2,1.5,1.25,{rate:1,iconText:"",en:"speed",jp:"speed"},.75,.5],defaultPlaybackRate:1,closeVideoStopPropagation:!0,mobile:{gestureY:!1},start:{isShowPause:!0,isShowEnd:!1,disableAnimate:!1,mode:"hide"}};function createPlayerOption(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=_objectSpread2$c({},initOption),r=_objectSpread2$c({},e?liveOption:vodOption);return _objectSpread2$c(_objectSpread2$c({},t),r)}var POSITIONS$7=Plugin.POSITIONS,extendPlugin=function(e){var t="mobile"===sniffer$1.device,r=e.pluginName,n=void 0===r?"ExtendPlugin".concat(Math.random().toString().slice(-5)):r,i=e.type,a=void 0===i?t?"inner":"normal":i,o=e.position,s=void 0===o?POSITIONS$7.CONTROLS_LEFT:o,l=e.icon,u=void 0===l?Default:l,c=e.index,d=void 0===c?1:c,h=e.hideAtFullScreen,f=void 0===h||h,p=e.tips,y=void 0===p?{jp:"custom",en:"custom",zh:"","zh-hk":""}:p;return function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r,[{key:"afterCreate",value:function(){var e;this.appendChild(".xgplayer-icon",this.icons[n]),this.initEvents(),f&&null!==(e=this.player)&&void 0!==e&&e.fullscreen&&this.handleFullScreenChange()}},{key:"registerIcons",value:function(){return _defineProperty$j({},n,{icon:u,class:"xgplayer-extendicon-svg"})}},{key:"updateIcons",value:function(e){var t=this.find(".xgplayer-icon");t&&(t.innerHTML=e)}},{key:"registerLanguageTexts",value:function(){return _defineProperty$j({},n,y)}},{key:"initEvents",value:function(){this.handleCallback=debounce$3(this.handleCallback.bind(this),200);var e,t="mobile"===sniffer$1.device?"touchend":"click";(this.bind(t,this.handleCallback),this.show(),f)&&(null===(e=this.player)||void 0===e||e.on(FULLSCREEN_CHANGE,this.handleFullScreenChange.bind(this)))}},{key:"handleFullScreenChange",value:function(){var e,t=this.player;null===(e=this.player)||void 0===e||e.changePluginsIcon(n,!(null!=t&&t.fullscreen))}},{key:"handleCallback",value:function(e){var t=this.player;t&&(e.preventDefault(),e.stopPropagation(),t.emit(PluginEvents.PLAYER_EXTEND_BUTTON,n))}},{key:"destroy",value:function(){var e;(this.unbind(["touchend","click"],this.handleCallback),f)&&(null===(e=this.player)||void 0===e||e.off(FULLSCREEN_CHANGE,this.handleFullScreenChange.bind(this)))}},{key:"render",value:function(){return'\n      <xg-icon class="xgplayer-extend-icon">\n        <div class="xgplayer-icon">\n        </div>\n        <div class="xg-tips" lang-key="'.concat(n,'">').concat(this.langText[n],"</div>\n      </xg-icon>\n      ")}}],[{key:"isExtendPlugin",get:function(){return!0}},{key:"type",get:function(){return a}},{key:"textTips",get:function(){return y}},{key:"pluginName",get:function(){return n}},{key:"defaultConfig",get:function(){return{position:s,index:d}}}]),r}(Plugin)},MobilePlayerPanel=function(){function e(t){var r,n;_classCallCheck$j(this,e);var i=t.config,a=t.root,o=t.player;this.config=i,this.parent=a,this.player=o,this.mode=null!==(r=null==i?void 0:i.mode)&&void 0!==r?r:PLAYER_MODE.INNER,this.isAutoChange=null!==(n=null==i?void 0:i.isAutoChange)&&void 0!==n&&n,this.initEvents(),this.renderPanel()}var t;return _createClass$k(e,[{key:"initEvents",value:function(){var e;this.isAutoChange&&(window.addEventListener("orientationchange",this.handleOrientationChange.bind(this)),null===(e=this.player)||void 0===e||e.on(FULLSCREEN_CHANGE,this.handleOrientationChange.bind(this)))}},{key:"handleOrientationChange",value:function(){var e,t,r,n=[90,-90,"90","-90"].includes(window.orientation);null!==(e=this.player)&&void 0!==e&&e.fullscreen&&n?this.changeMode(PLAYER_MODE.FULLSCREEN):this.changeMode(null!==(t=null===(r=this.config)||void 0===r?void 0:r.mode)&&void 0!==t?t:PLAYER_MODE.INNER)}},{key:"changeConfig",value:function(e){this.config=e}},{key:"changeMode",value:function(e){this.mode=e,this.player.emit(PluginEvents.PANEL_MODE_CHANGE,{mode:e}),this.destroy(),this.renderPanel()}},{key:"renderPanel",value:function(){var e="xg-mobile-panel panel-".concat(["normal","inner","fullscreen"][this.mode]);switch(this.root=util$2.createDom("div","",{},e),this.parent&&(this.parent.appendChild(this.root),this.hide()),this.bind("click",this.handleHide.bind(this)),this.mode){case PLAYER_MODE.NORMAL:var t=util$2.createDom("div","",{},"xg-mobile-panel-content");this.root.appendChild(t),this.container=t,t.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault()}));break;case PLAYER_MODE.INNER:this.container=this.root;break;case PLAYER_MODE.FULLSCREEN:var r=util$2.createDom("div","",{},"xg-mobile-panel-content");this.root.appendChild(r),this.container=r,r.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault()}))}}},{key:"showPanel",value:(t=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t){var r,n=this,i=arguments;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:"",i.length>2&&void 0!==i[2]&&i[2]&&util$2.addClass(t,"item-list-panel-content"),this.setTitle(r),!this.children){e.next=9;break}return e.next=7,this.hide();case 7:return setTimeout((function(){n.children=t,n.container&&(n.title&&n.container.appendChild(n.title),n.container.appendChild(t)),n.show()})),e.abrupt("return");case 9:this.children=t,this.container&&(this.title&&this.container.appendChild(this.title),this.container.appendChild(t)),this.show();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updatePanel",value:function(e){this.children&&util$2.hasClass(this.children,"item-list-panel-content")&&util$2.addClass(e,"item-list-panel-content"),this.children=e,this.container&&(this.container.innerHTML="",this.title&&this.container.appendChild(this.title),this.container.appendChild(e)),this.show()}},{key:"setTitle",value:function(e){e&&this.mode!==PLAYER_MODE.INNER?this.title?this.title.innerHTML=e:this.title=this.renderTitle(e):this.title=void 0}},{key:"renderTitle",value:function(e){return util$2.createDom("div",e,{},"xg-mobile-panel-title")}},{key:"show",value:function(){util$2.removeClass(this.root,"hide"),util$2.addClass(this.root,"active")}},{key:"hide",value:function(){util$2.removeClass(this.root,"active"),util$2.addClass(this.root,"hide"),this.container&&(this.container.innerHTML="")}},{key:"handleHide",value:function(e){e.stopPropagation(),e.preventDefault(),this.hide()}},{key:"bind",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"==typeof t&&this.root.addEventListener(e,t,r)}},{key:"destroy",value:function(){var e;this.parent&&this.root&&this.parent.removeChild(this.root),window.removeEventListener("orientationchange",this.handleOrientationChange.bind(this)),null===(e=this.player)||void 0===e||e.off(FULLSCREEN_CHANGE,this.handleOrientationChange.bind(this))}}]),e}(),TOB_PLAY_DOMAIN="//vod.volcengineapi.com",LICENSE_URL="https://webmedia.zijieapi.com/video/drm/v1/play_licenses",TOB_KEY_DOMAIN="https://kds.bytedance.com";function DefinitionIconSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M16 3.8001H4C3.55817 3.8001 3.2 4.15827 3.2 4.6001V12.6001C3.2 13.0419 3.55817 13.4001 4 13.4001H16C16.4418 13.4001 16.8 13.0419 16.8 12.6001V4.6001C16.8 4.15827 16.4418 3.8001 16 3.8001ZM4 2.6001C2.89543 2.6001 2 3.49553 2 4.6001V12.6001C2 13.7047 2.89543 14.6001 4 14.6001H16C17.1046 14.6001 18 13.7047 18 12.6001V4.6001C18 3.49553 17.1046 2.6001 16 2.6001H4ZM5.0249 6.24509V11.6001H5.9024V9.23009H8.6174V11.6001H9.4949V6.24509H8.6174V8.48009H5.9024V6.24509H5.0249ZM10.5474 6.24509V11.6001H12.5049C13.3749 11.6001 14.0274 11.3601 14.4774 10.8801C14.9049 10.4226 15.1224 9.77009 15.1224 8.92259C15.1224 8.06759 14.9049 7.41509 14.4774 6.96509C14.0274 6.48509 13.3749 6.24509 12.5049 6.24509H10.5474ZM11.4249 6.99509H12.3399C13.0074 6.99509 13.4949 7.14509 13.8024 7.45259C14.1024 7.75259 14.2524 8.24759 14.2524 8.92259C14.2524 9.58259 14.1024 10.0701 13.8024 10.3851C13.4949 10.6926 13.0074 10.8501 12.3399 10.8501H11.4249V6.99509ZM4.15 16.1001C3.79101 16.1001 3.5 16.3911 3.5 16.7501C3.5 17.1091 3.79101 17.4001 4.15 17.4001H15.85C16.209 17.4001 16.5 17.1091 16.5 16.7501C16.5 16.3911 16.209 16.1001 15.85 16.1001H4.15Z" fill="#ffffff"/>\n</svg>',"image/svg+xml").firstChild}var POSITIONS$6=Plugin.POSITIONS,DefinitionMobilePlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).playerData=null,n.playerData=e.player.config.playerData,n.dataMonitoring(),n}return _createClass$k(r,[{key:"dataMonitoring",value:function(){var e=this;this.playerData&&MyProxy$1.subscribeProperty(this.playerData.current,"definition",(function(t,r){if(t!==r&&e.player){var n=e.playerData.getCurrentUrl();e.player.changeDefinition({definition:r,url:n}),e.updatePanel(),e.player.emit(PluginEvents.INNER_DEFINITION_CHANGE,{from:t,to:r,url:n}),e.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:n,from:PluginEvents.INNER_DEFINITION_CHANGE}),setTimeout((function(){e.player.paused&&e.player.play()}),1e3)}}))}},{key:"registerIcons",value:function(){return{definition:{icon:DefinitionIconSVG,class:"xgplayer-definition-svg"}}}},{key:"registerLanguageTexts",value:function(){return{definition:{jp:"",en:"Definition",zh:"","zh-hk":""},definitionSelect:{jp:"",en:"Definition Choose",zh:"","zh-hk":""},switching:{jp:"",en:"Switching to",zh:"","zh-hk":""}}}},{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.definition),this.initEvents()}},{key:"afterPlayerInit",value:function(){}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this))}},{key:"handleButtonChange",value:function(){var e=this.renderItemList();this.renderPanel(e)}},{key:"renderItemList",value:function(){var e=this,t=this.playerData.current.lineId,r=this.playerData.getDefinitionListByLineId(t),n=util$2.createDom("div","",{},"definition-panel-content");return r.forEach((function(t){var r=e.renderItem(t);n.appendChild(r)})),n}},{key:"renderItem",value:function(e){var t=this,r=this.playerData.current.definition,n=util$2.createDom("div","",{},"panel-Item ".concat(r===e.definition?"select-in":""));return n.innerHTML=this.getShowText(this.i18n,e),n.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.showToast(e),t.playerData.current.definition=e.definition})),n}},{key:"getShowText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return e[t.definitionTextKey]||t.definitionTextKey||t.definition}},{key:"showToast",value:function(e){var t,r=null===(t=this.player)||void 0===t?void 0:t.getPlugin("sdkToastPlugin");if(r){var n=this.getShowText(this.i18n,e);r.add("".concat(this.langText.switching).concat(n,"..."),2e3,!0)}}},{key:"renderPanel",value:function(e){var t,r;null===(t=this.player)||void 0===t||null===(r=t.panel)||void 0===r||r.showPanel(e,this.langText.definitionSelect,!0)}},{key:"updatePanel",value:function(){var e,t,r=this.renderItemList();null===(e=this.player)||void 0===e||null===(t=e.panel)||void 0===t||t.updatePanel(r)}},{key:"destroy",value:function(){this.unbind(["click"],this.handleButtonChange.bind(this))}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-mobile-definition">\n      <div class="xgplayer-icon">\n      </div>\n    </xg-icon>\n    '}}],[{key:"pluginName",get:function(){return"DefinitionMobilePlugin"}},{key:"textTips",get:function(){return{jp:"",en:"Definition",zh:"","zh-hk":""}}},{key:"defaultConfig",get:function(){return{position:POSITIONS$6.CONTROLS_RIGHT,index:2.7}}}]),r}(Plugin);function LineIconSVG(){return(new DOMParser).parseFromString('<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M12.7123 1C11.85 1 11.1173 1.55472 10.8516 2.32675L4.94973 2.32675C3.16413 2.32675 1.71662 3.77427 1.71662 5.55987C1.71662 7.34547 3.16413 8.79298 4.94973 8.79298L11.0483 8.79298L11.1134 8.79418C11.9936 8.82748 12.697 9.55166 12.697 10.44C12.697 11.3497 11.9596 12.0871 11.05 12.0871H5.01323C4.67882 11.4781 4.03143 11.0654 3.28763 11.0654C2.20111 11.0654 1.32031 11.9462 1.32031 13.0327C1.32031 14.1192 2.20111 15 3.28763 15C4.14992 15 4.88264 14.4452 5.14834 13.6732H11.05C12.8356 13.6732 14.2831 12.2256 14.2831 10.44C14.2831 8.65444 12.8356 7.20693 11.05 7.20693L4.94973 7.20693C4.04009 7.20693 3.30267 6.46951 3.30267 5.55987C3.30267 4.65022 4.04009 3.91281 4.94973 3.91281L10.9866 3.91281C11.321 4.52183 11.9685 4.93464 12.7123 4.93464C13.7988 4.93464 14.6796 4.05384 14.6796 2.96732C14.6796 1.8808 13.7988 1 12.7123 1ZM12.7123 2.18954C12.2827 2.18954 11.9345 2.53777 11.9345 2.96732C11.9345 3.39688 12.2827 3.7451 12.7123 3.7451C13.1418 3.7451 13.4901 3.39688 13.4901 2.96732C13.4901 2.53777 13.1418 2.18954 12.7123 2.18954ZM2.50986 13.0327C2.50986 12.6031 2.85808 12.2549 3.28763 12.2549C3.71719 12.2549 4.06541 12.6031 4.06541 13.0327C4.06541 13.4622 3.71719 13.8105 3.28763 13.8105C2.85808 13.8105 2.50986 13.4622 2.50986 13.0327Z" fill="#FFFFFF"/>\n</svg>',"image/svg+xml").firstChild}var POSITIONS$5=Plugin.POSITIONS,LineMobilePlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).playerData=null,n.playerData=e.player.config.playerData,n.dataMonitoring(),n}return _createClass$k(r,[{key:"dataMonitoring",value:function(){var e=this;this.playerData&&MyProxy$1.subscribeProperty(this.playerData.current,"definition",(function(t,r){if(t!==r&&e.player){var n=e.playerData.getCurrentUrl();console.log(n),e.player.changeDefinition({definition:r,url:n}),e.updatePanel(),setTimeout((function(){e.player.paused&&e.player.play()}),1e3)}}))}},{key:"registerIcons",value:function(){return{line:{icon:LineIconSVG,class:"xgplayer-line-svg"}}}},{key:"registerLanguageTexts",value:function(){return{line:{jp:"",en:"Line",zh:"","zh-hk":""},lineSelect:{jp:"",en:"Line Choose",zh:"","zh-hk":""}}}},{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.line),this.initEvents()}},{key:"afterPlayerInit",value:function(){}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this))}},{key:"handleButtonChange",value:function(){var e=this.renderItemList();this.renderPanel(e)}},{key:"renderItemList",value:function(){var e=this,t=this.playerData.getLineList(),r=util$2.createDom("div","",{},"line-panel-content");return t.forEach((function(t){var n=e.renderItem(t);r.appendChild(n)})),r}},{key:"renderItem",value:function(e){var t=this,r=this.playerData.current.lineId,n=util$2.createDom("div","",{},"panel-Item ".concat(r===e.lineId?"select-in":""));return n.innerHTML=this.i18n[e.lineTextKey]||e.lineTextKey,n.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.player.emit(PluginEvents.LINE_CHANGE,{from:t.playerData.current.lineId,to:e.lineId}),t.playerData.current.lineId=e.lineId,t.player.emit(SDKEvents.PLAYER_REBUILD)})),n}},{key:"renderPanel",value:function(e){var t,r;null===(t=this.player)||void 0===t||null===(r=t.panel)||void 0===r||r.showPanel(e,this.langText.lineSelect,!0)}},{key:"updatePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player)||void 0===e||e.panel.updatePanel(t)}},{key:"destroy",value:function(){this.unbind(["click"],this.handleButtonChange.bind(this))}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-mobile-line">\n      <div class="xgplayer-icon">\n      </div>\n    </xg-icon>\n    '}}],[{key:"pluginName",get:function(){return"LineMobilePlugin"}},{key:"textTips",get:function(){return{jp:"",en:"Line",zh:"","zh-hk":""}}},{key:"defaultConfig",get:function(){return{position:POSITIONS$5.CONTROLS_RIGHT,index:2.8}}}]),r}(Plugin);function RateIconSVG(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M14.6879 3.64579C14.7387 3.60575 14.7387 3.52868 14.6879 3.48864L13.3089 2.40296C13.2433 2.35132 13.147 2.39805 13.147 2.48153V4.6529C13.147 4.73639 13.2433 4.78312 13.3089 4.73147L14.6879 3.64579ZM4 2.61914H11.3001V3.91914H4C3.6134 3.91914 3.3 4.23254 3.3 4.61914V15.6191C3.3 16.0057 3.6134 16.3191 4 16.3191H16C16.3866 16.3191 16.7 16.0057 16.7 15.6191V6.75253H18V15.6191C18 16.7237 17.1046 17.6191 16 17.6191H4C2.89543 17.6191 2 16.7237 2 15.6191V4.61914C2 3.51457 2.89543 2.61914 4 2.61914ZM17.7879 3.48864C17.8388 3.52868 17.8388 3.60575 17.7879 3.64579L16.4089 4.73147C16.3433 4.78312 16.2471 4.73639 16.2471 4.6529V2.48153C16.2471 2.39805 16.3433 2.35132 16.4089 2.40296L17.7879 3.48864ZM6.82584 7.37256C6.26886 7.37256 5.82039 7.56063 5.48042 7.93677C5.14768 8.29121 4.98131 8.75415 4.97408 9.33282H5.82039C5.83485 8.92775 5.92166 8.61671 6.08079 8.41418C6.23993 8.19717 6.47863 8.08867 6.7969 8.08867C7.09347 8.08867 7.31771 8.15377 7.46961 8.29121C7.61428 8.42864 7.69385 8.63841 7.69385 8.92052C7.69385 9.20986 7.57811 9.48473 7.35388 9.7379C7.20921 9.8898 6.97774 10.0851 6.645 10.3166C6.04462 10.7289 5.64679 11.0471 5.45872 11.2642C5.11151 11.6548 4.94514 12.1105 4.94514 12.6385H8.54739V11.8935H6.00122C6.11696 11.6331 6.43523 11.3293 6.96327 10.982C7.46961 10.6421 7.83128 10.3672 8.03382 10.1502C8.36656 9.7813 8.54016 9.37622 8.54016 8.92775C8.54016 8.46481 8.38102 8.09591 8.06275 7.80657C7.73725 7.51723 7.32494 7.37256 6.82584 7.37256ZM9.90445 11.5463C9.74532 11.5463 9.60788 11.5969 9.50661 11.7126C9.39088 11.8211 9.34025 11.9586 9.34025 12.1177C9.34025 12.2768 9.39088 12.407 9.50661 12.5228C9.60788 12.624 9.74532 12.6819 9.90445 12.6819C10.0636 12.6819 10.1938 12.624 10.3095 12.5228C10.418 12.407 10.4759 12.2768 10.4759 12.1177C10.4759 11.9586 10.418 11.8211 10.3095 11.7126C10.1938 11.5969 10.0636 11.5463 9.90445 11.5463ZM11.665 8.12484C11.9977 7.6185 12.4679 7.37256 13.0755 7.37256C13.6759 7.37256 14.1461 7.6185 14.486 8.12484C14.8043 8.60225 14.9635 9.24602 14.9635 10.0562C14.9635 10.8663 14.8043 11.5101 14.486 11.9875C14.1461 12.4866 13.6759 12.7398 13.0755 12.7398C12.4679 12.7398 11.9977 12.4866 11.665 11.9875C11.3467 11.5101 11.1876 10.8663 11.1876 10.0562C11.1876 9.24602 11.3467 8.60225 11.665 8.12484ZM13.9435 8.77585C13.7699 8.31291 13.4806 8.08867 13.0755 8.08867C12.6632 8.08867 12.3739 8.31291 12.2075 8.77585C12.0918 9.08689 12.0339 9.51366 12.0339 10.0562C12.0339 10.5914 12.0918 11.0182 12.2075 11.3365C12.3739 11.7922 12.6632 12.0237 13.0755 12.0237C13.4806 12.0237 13.7699 11.7922 13.9435 11.3365C14.0593 11.0182 14.1171 10.5914 14.1171 10.0562C14.1171 9.51366 14.0593 9.08689 13.9435 8.77585Z" fill="#ffffff"/>\n</svg>',"image/svg+xml").firstChild}var POSITIONS$4=Plugin.POSITIONS,PlaybackRateMobilePlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).playerData=null,n.state={currentRate:1,isSupport:!0},n.playerData=e.player.config.playerData,n}return _createClass$k(r,[{key:"registerIcons",value:function(){return{playbackRate:{icon:RateIconSVG,class:"xgplayer-rate-svg"}}}},{key:"registerLanguageTexts",value:function(){return{rate:{jp:"",en:"PlaybackRate",zh:"","zh-hk":""},rateSelect:{jp:"",en:"PlaybackRate",zh:"","zh-hk":""}}}},{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.playbackRate),this.initEvents()}},{key:"afterPlayerInit",value:function(){}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this))}},{key:"handleButtonChange",value:function(){var e=this.renderItemList();this.renderPanel(e)}},{key:"renderItemList",value:function(){var e=this,t=util$2.createDom("div","",{},"playbackRate-panel-content");return this.config.list.forEach((function(r){var n=e.renderItem(r);t.appendChild(n)})),t}},{key:"renderItem",value:function(e){var t=this,r=isObject$V(e)?e:{textKey:e+"X",value:e},n=util$2.createDom("div","",{},"panel-Item ".concat(this.state.currentRate===r.value?"select-in":""));return n.innerHTML=this.i18n[r.textKey]||r.textKey,n.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),t.emit(RATE_CHANGE,{from:t.player.playbackRate,to:r.value}),t.state.currentRate=r.value,t.player.playbackRate=r.value,t.updatePanel()})),n}},{key:"renderPanel",value:function(e){var t,r;null===(t=this.player)||void 0===t||null===(r=t.panel)||void 0===r||r.showPanel(e,this.langText.rateSelect,!0)}},{key:"updatePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player)||void 0===e||e.panel.updatePanel(t)}},{key:"destroy",value:function(){this.unbind(["click"],this.handleButtonChange.bind(this))}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-mobile-playBackRate">\n      <div class="xgplayer-icon">\n      </div>\n    </xg-icon>\n    '}}],[{key:"pluginName",get:function(){return"PlaybackRateMobilePlugin"}},{key:"textTips",get:function(){return{jp:"",en:"PlaybackRate",zh:"","zh-hk":""}}},{key:"defaultConfig",get:function(){return{position:POSITIONS$4.CONTROLS_RIGHT,index:2.9,list:[2,1.5,1.25,1,.75,.5],default:1}}}]),r}(Plugin),SdkPlugin=function(){function e(t){_classCallCheck$j(this,e),this.__args=null,this.sdk=null,this.playerData=null,this.player=null,this._emitter=null,this.beforeCreate&&"function"==typeof this.beforeCreate&&this.beforeCreate(),this.__args=t,this.pluginName="",this.__init(t)}return _createClass$k(e,[{key:"beforeCreate",value:function(){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerCreate",value:function(){}},{key:"afterPlayerCreate",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(t){var r=this;e.defineGetterOrSetter(this,{sdk:{get:function(){return t.sdk},configurable:!0},player:{get:function(){return t.sdk.getPlayerInstance()},configurable:!0},playerData:{get:function(){return t.sdk.playerData},configurable:!0},pluginName:{get:function(){return t.pluginName?t.pluginName.toLowerCase():r.constructor.pluginName.toLowerCase()},configurable:!0},_emitter:{get:function(){return t.sdk._emitter},configurable:!0}})}},{key:"__destroy",value:function(){var e=this,t=this.sdk,r=this.pluginName;this.destroy&&"function"==typeof this.destroy&&this.destroy(),["sdk","player","playerData","pluginName","_emitter"].map((function(t){Object.defineProperty(e,t,{writable:!0})})),Object.keys(this).map((function(t){e[t]=null,delete e[t]})),Object.setPrototypeOf&&Object.setPrototypeOf(this,null),delete t._sdkPlugins[r]}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var r in t)Object.defineProperty(e,r,t[r])}},{key:"pluginName",get:function(){return"pluginName"}}]),e}(),dist=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$b(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t,r){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,r){var n=r(12)("wks"),i=r(13),a=r(0).Symbol,o="function"==typeof a;(e.exports=function(e){return n[e]||(n[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=n},function(e,t,r){var n=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=n)},function(e,t,r){var n=r(4);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){var n="function"==typeof Symbol&&"symbol"==_typeof$b(Symbol.iterator)?function(e){return _typeof$b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$b(e)};e.exports=function(e){return"object"===(void 0===e?"undefined":n(e))?null!==e:"function"==typeof e}},function(e,t,r){var n=r(6);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){e.exports=!r(15)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,r){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,r){var n=r(3),i=r(26),a=r(27),o=Object.defineProperty;t.f=r(7)?Object.defineProperty:function(e,t,r){if(n(e),t=a(t,!0),n(r),i)try{return o(e,t,r)}catch(s){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){e.exports=!1},function(e,t,r){var n=r(8),i=r(1)("toStringTag"),a="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Object(e),i))?r:a?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,r){var n=r(2),i=r(0),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:r(10)?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,r){var n=r(9),i=r(28);e.exports=r(7)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,r){var n=r(4),i=r(0).document,a=n(i)&&n(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){var n=r(0),i=r(14),a=r(18),o=r(13)("src"),s=r(29),l=(""+s).split("toString");r(2).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,r,s){var u="function"==typeof r;u&&(a(r,"name")||i(r,"name",t)),e[t]!==r&&(u&&(a(r,o)||i(r,o,e[t]?""+e[t]:l.join(String(t)))),e===n?e[t]=r:s?e[t]?e[t]=r:i(e,t,r):(delete e[t],i(e,t,r)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[o]||s.call(this)}))},function(e,t,r){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,r){e.exports={}},function(e,t,r){var n,i,a,o=r(5),s=r(38),l=r(39),u=r(16),c=r(0),d=c.process,h=c.setImmediate,f=c.clearImmediate,p=c.MessageChannel,y=c.Dispatch,m=0,g={},v=function(){var e=+this;if(g.hasOwnProperty(e)){var t=g[e];delete g[e],t()}},b=function(e){v.call(e.data)};h&&f||(h=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return g[++m]=function(){s("function"==typeof e?e:Function(e),t)},n(m),m},f=function(e){delete g[e]},"process"==r(8)(d)?n=function(e){d.nextTick(o(v,e,1))}:y&&y.now?n=function(e){y.now(o(v,e,1))}:p?(a=(i=new p).port2,i.port1.onmessage=b,n=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(n=function(e){c.postMessage(e+"","*")},c.addEventListener("message",b,!1)):n="onreadystatechange"in u("script")?function(e){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),v.call(e)}}:function(e){setTimeout(o(v,e,1),0)}),e.exports={set:h,clear:f}},function(e,t,r){var n=r(6);function i(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)}e.exports.f=function(e){return new i(e)}},function(e,t,r){e.exports=r(23)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r(24);var n,i=(n=r(48))&&n.__esModule?n:{default:n};t.default={url:i.default},e.exports=t.default},function(e,t,r){var n,i,a,o,s=r(10),l=r(0),u=r(5),c=r(11),d=r(25),h=r(4),f=r(6),p=r(30),y=r(31),m=r(37),g=r(20).set,v=r(40)(),b=r(21),_=r(41),E=r(42),T=r(43),S=l.TypeError,$=l.process,A=$&&$.versions,w=A&&A.v8||"",k=l.Promise,I="process"==c($),C=function(){},P=i=b.f,x=!!function(){try{var e=k.resolve(1),t=(e.constructor={})[r(1)("species")]=function(e){e(C,C)};return(I||"function"==typeof PromiseRejectionEvent)&&e.then(C)instanceof t&&0!==w.indexOf("6.6")&&-1===E.indexOf("Chrome/66")}catch(n){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},O=function(e,t){if(!e._n){e._n=!0;var r=e._c;v((function(){for(var n=e._v,i=1==e._s,a=0,o=function(t){var r,a,o,s=i?t.ok:t.fail,l=t.resolve,u=t.reject,c=t.domain;try{s?(i||(2==e._h&&M(e),e._h=1),!0===s?r=n:(c&&c.enter(),r=s(n),c&&(c.exit(),o=!0)),r===t.promise?u(S("Promise-chain cycle")):(a=R(r))?a.call(r,l,u):l(r)):u(n)}catch(d){c&&!o&&c.exit(),u(d)}};r.length>a;)o(r[a++]);e._c=[],e._n=!1,t&&!e._h&&L(e)}))}},L=function(e){g.call(l,(function(){var t,r,n,i=e._v,a=D(e);if(a&&(t=_((function(){I?$.emit("unhandledRejection",i,e):(r=l.onunhandledrejection)?r({promise:e,reason:i}):(n=l.console)&&n.error&&n.error("Unhandled promise rejection",i)})),e._h=I||D(e)?2:1),e._a=void 0,a&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},M=function(e){g.call(l,(function(){var t;I?$.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})}))},N=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),O(t,!0))},G=function e(t){var r,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw S("Promise can't be resolved itself");(r=R(t))?v((function(){var i={_w:n,_d:!1};try{r.call(t,u(e,i,1),u(N,i,1))}catch(a){N.call(i,a)}})):(n._v=t,n._s=1,O(n,!1))}catch(i){N.call({_w:n,_d:!1},i)}}};x||(k=function(e){p(this,k,"Promise","_h"),f(e),n.call(this);try{e(u(G,this,1),u(N,this,1))}catch(t){N.call(this,t)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(44)(k.prototype,{then:function(e,t){var r=P(m(this,k));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=I?$.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&O(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new n;this.promise=e,this.resolve=u(G,e,1),this.reject=u(N,e,1)},b.f=P=function(e){return e===k||e===o?new a(e):i(e)}),d(d.G+d.W+d.F*!x,{Promise:k}),r(45)(k,"Promise"),r(46)("Promise"),o=r(2).Promise,d(d.S+d.F*!x,"Promise",{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(s||!x),"Promise",{resolve:function(e){return T(s&&this===o?k:this,e)}}),d(d.S+d.F*!(x&&r(47)((function(e){k.all(e).catch(C)}))),"Promise",{all:function(e){var t=this,r=P(t),n=r.resolve,i=r.reject,a=_((function(){var r=[],a=0,o=1;y(e,!1,(function(e){var s=a++,l=!1;r.push(void 0),o++,t.resolve(e).then((function(e){l||(l=!0,r[s]=e,--o||n(r))}),i)})),--o||n(r)}));return a.e&&i(a.v),r.promise},race:function(e){var t=this,r=P(t),n=r.reject,i=_((function(){y(e,!1,(function(e){t.resolve(e).then(r.resolve,n)}))}));return i.e&&n(i.v),r.promise}})},function(e,t,r){var n=r(0),i=r(2),a=r(14),o=r(17),s=r(5),l=function e(t,r,l){var u,c,d,h,f=t&e.F,p=t&e.G,y=t&e.P,m=t&e.B,g=p?n:t&e.S?n[r]||(n[r]={}):(n[r]||{}).prototype,v=p?i:i[r]||(i[r]={}),b=v.prototype||(v.prototype={});for(u in p&&(l=r),l)d=((c=!f&&g&&void 0!==g[u])?g:l)[u],h=m&&c?s(d,n):y&&"function"==typeof d?s(Function.call,d):d,g&&o(g,u,d,t&e.U),v[u]!=d&&a(v,u,h),y&&b[u]!=d&&(b[u]=d)};n.core=i,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,r){e.exports=!r(7)&&!r(15)((function(){return 7!=Object.defineProperty(r(16)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(4);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){e.exports=r(12)("native-function-to-string",Function.toString)},function(e,t,r){e.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},function(e,t,r){var n=r(5),i=r(32),a=r(33),o=r(3),s=r(34),l=r(36),u={},c={},d=e.exports=function(e,t,r,d,h){var f,p,y,m,g=h?function(){return e}:l(e),v=n(r,d,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(a(g)){for(f=s(e.length);f>b;b++)if((m=t?v(o(p=e[b])[0],p[1]):v(e[b]))===u||m===c)return m}else for(y=g.call(e);!(p=y.next()).done;)if((m=i(y,v,p.value,t))===u||m===c)return m};d.BREAK=u,d.RETURN=c},function(e,t,r){var n=r(3);e.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(o){var a=e.return;throw void 0!==a&&n(a.call(e)),o}}},function(e,t,r){var n=r(19),i=r(1)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(n.Array===e||a[i]===e)}},function(e,t,r){var n=r(35),i=Math.min;e.exports=function(e){return e>0?i(n(e),9007199254740991):0}},function(e,t,r){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,r){var n=r(11),i=r(1)("iterator"),a=r(19);e.exports=r(2).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||a[n(e)]}},function(e,t,r){var n=r(3),i=r(6),a=r(1)("species");e.exports=function(e,t){var r,o=n(e).constructor;return void 0===o||null==(r=n(o)[a])?t:i(r)}},function(e,t,r){e.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},function(e,t,r){var n=r(0).document;e.exports=n&&n.documentElement},function(e,t,r){var n=r(0),i=r(20).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,l="process"==r(8)(o);e.exports=function(){var e,t,r,u=function(){var n,i;for(l&&(n=o.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(a){throw e?r():t=void 0,a}}t=void 0,n&&n.enter()};if(l)r=function(){o.nextTick(u)};else if(!a||n.navigator&&n.navigator.standalone)if(s&&s.resolve){var c=s.resolve(void 0);r=function(){c.then(u)}}else r=function(){i.call(n,u)};else{var d=!0,h=document.createTextNode("");new a(u).observe(h,{characterData:!0}),r=function(){h.data=d=!d}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},function(e,t,r){e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},function(e,t,r){var n=r(0).navigator;e.exports=n&&n.userAgent||""},function(e,t,r){var n=r(3),i=r(4),a=r(21);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=a.f(e);return(0,r.resolve)(t),r.promise}},function(e,t,r){var n=r(17);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t,r){var n=r(9).f,i=r(18),a=r(1)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){var n=r(0),i=r(9),a=r(7),o=r(1)("species");e.exports=function(e){var t=n[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(1)("iterator"),i=!1;try{var a=[7][n]();a.return=function(){i=!0},Array.from(a,(function(){throw 2}))}catch(o){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:r=!0}},a[n]=function(){return o},e(a)}catch(s){}return r}},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==_typeof$b(Symbol.iterator)?function(e){return _typeof$b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$b(e)};t.default=function(e,t,r){if(e&&t){var i=void 0;try{i=(0,a.getUri)(e,t,r)}catch(s){return Promise.reject(s.message)}return new o.default({type:"json",method:"GET",url:i}).then((function(e){return e&&e.response?"string"==typeof e.response?JSON.parse(e.response).Result:"object"===n(e.response)?e.response.Result:e.response:e}))}return Promise.reject("vid, host and token can't be empty")};var i,a=r(49),o=(i=r(51))&&i.__esModule?i:{default:i};e.exports=t.default},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getUri=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{e=JSON.parse((0,n.decode)(e))}catch(s){throw new Error("base64 decode error: "+s.message)}var i=[];for(var a in r)i.push(a+"="+r[a]);var o=(/^http/.test(t)?t:"//"+t)+"?"+e.GetPlayInfoToken+"&ssl=true";return i.length>0&&(o+="&"+i.join("&")),o};var n=r(50)},function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.decode=function(e){var t,r,n,i,a,o,s,l=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];for(o=e.length,a=0,s="";a<o;){do{t=l[255&e.charCodeAt(a++)]}while(a<o&&-1===t);if(-1===t)break;do{r=l[255&e.charCodeAt(a++)]}while(a<o&&-1===r);if(-1===r)break;s+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(a++)))return s;n=l[n]}while(a<o&&-1===n);if(-1===n)break;s+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(i=255&e.charCodeAt(a++)))return s;i=l[i]}while(a<o&&-1===i);if(-1===i)break;s+=String.fromCharCode((3&n)<<6|i)}return s}},function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.url,i=t.method,a=void 0===i?"GET":i,o=(t.type,t.data),s=void 0===o?{}:o,l=t.headers,u=void 0===l?{}:l;return n(this,e),new Promise((function(e,t){var n=new window.XMLHttpRequest,i=a.toUpperCase(),o=[];for(var l in s)o.push(l+"="+s[l]);if("GET"!==i)throw new Error("xhr "+i+" is not supported");for(var c in n.open(i,""+r,!0),n.responseType="",u)n.setRequestHeader(c,""+u[c]);n.send(),n.onload=function(){200===n.status||206===n.status?e(n):t(n)},n.onerror=function(){t(n)},n.ontimeout=function(){t(n)}}))},e.exports=t.default}]),AuthToken=function(e){_inherits$g(i,e);var t,r,n=_createSuper$j(i);function i(e){var t;return _classCallCheck$j(this,i),(t=n.call(this,e)).isPlayByToken=!1,t.isEncrypt=!1,t.config=null,t.getPlayInfoByAuthToken=function(){var e=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t){var r,n,i,a,o,s,l,u,c,d,h,f=this;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.playAuthToken,n=t.playDomain,i=t.reqParams,a=void 0===i?{}:i,o=t.definitionMap,s=t.needThumbs,l=void 0!==s&&s,u=t.needBarrageMask,c=void 0!==u&&u,!r){e.next=5;break}return d=n||TOB_PLAY_DOMAIN,h=_objectSpread2$c(_objectSpread2$c({},a),{},{NeedThumbs:l?1:0,NeedBarrageMask:c?1:0}),e.abrupt("return",new Promise((function(e,t){dist.url(r,d,h).then((function(t){var r=t.Data||t,n=r.Status,i=r.PlayInfoList,a=void 0===i?[]:i,s=r.PosterUrl,l=r.Vid,u=r.Duration,c=r.BarrageMaskUrl,d=r.ThumbInfoList,h=void 0===d?[]:d;if(n===VIDEO_STATUS_TYPE.VALID&&a.length){var f=a.map((function(e){return _objectSpread2$c(_objectSpread2$c({vid:l,lineId:1,lineName:"1",url:e.MainPlayUrl,streamType:e.Format,backUrlList:[e.BackupPlayUrl],bitrate:e.Bitrate,size:e.Size,kid:e.PlayAuthId,vwidth:e.Width,vheight:e.Height,codec:e.Codec,getLicenseUrl:LICENSE_URL},e),getDefinitionInfo(e,o))})).sort((function(e,t){return t.Bitrate&&e.Bitrate?t.Bitrate-e.Bitrate:-1}));e({playList:f,poster:s,vid:l,duration:u,dashOpts:t.Data?t:{Data:t},thumbs:h,barrageMaskUrl:c})}else e({playList:[],poster:s,vid:l,duration:u,dashOpts:t.Data?t:{Data:t},thumbs:h,barrageMaskUrl:c}),console.error("HAS NO VIDEO INFORMATION CORRECTLY, PLEASE CHECK THE TOKEN.")})).catch((function(e){var r,n;null===(r=f._emitter)||void 0===r||r.emit(PluginEvents.GET_PLAY_URL_ERR,e);var i={errorType:"token",errorCode:1100,errorMessage:"get play url error by playAuthToken, please check playAuthToken",ext:{},originError:e};null===(n=f.sdk)||void 0===n||n.delayError.push(i);try{100006===get$4(JSON.parse(e.response),"ResponseMetadata.Error.CodeN")&&(console.error("playAuthToken is expired, please check or update your playAuthToken"),f.sdk.emit(SDKEvents.TOKEN_EXPIRED,e))}catch(a){console.log(a)}t()}))})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.init(),t}return _createClass$k(i,[{key:"beforePlayerCreate",value:(r=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(){return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPlayByToken){e.next=3;break}return e.next=3,this.getConfig();case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getConfig",value:(t=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(){var t,r,n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!isTokenExpired(this.tokenInfo)){e.next=8;break}return console.error("playAuthToken is expired, please check or update your playAuthToken"),this.sdk.emit(SDKEvents.TOKEN_EXPIRED,{type:"playAuthToken",token:this.tokenInfo}),a={errorType:"token",errorCode:1101,errorMessage:"playAuthToken has expired",ext:{token:this.tokenInfo,config:this.config},originError:void 0},null===(i=this.sdk)||void 0===i||i.delayError.push(a),e.abrupt("return");case 8:if(!this.keyTokenInfo){e.next=16;break}if(!isTokenExpired(this.keyTokenInfo)){e.next=16;break}return console.error("keyToken is expired, please check or update your keyToken"),this.sdk.emit(SDKEvents.TOKEN_EXPIRED,{type:"keyToken",token:this.keyTokenInfo}),s={errorType:"token",errorCode:1102,errorMessage:"keyToken for hls encrypt play has expired",ext:{token:this.keyTokenInfo,config:this.config},originError:void 0},null===(o=this.sdk)||void 0===o||o.delayError.push(s),e.abrupt("return");case 16:return l=(null===(t=this.tokenInfo)||void 0===t?void 0:t.Format)||"mp4",this.playerData.codec=(null===(r=this.tokenInfo)||void 0===r||null===(n=r.Codec)||void 0===n?void 0:n.toLowerCase())||CodecType.H264,e.next=20,this.getPlayInfoByAuthToken(this.config);case 20:if(e.t0=e.sent,e.t0){e.next=23;break}e.t0={};case 23:u=e.t0,c=u.playList,d=u.poster,h=u.vid,f=u.dashOpts,p=u.thumbs,y=u.barrageMaskUrl,this.playerData.options.vid=h,this.config.needPoster&&(this.playerData.options.poster=d),this.config.needThumbs&&p.length>0&&this.getThumbnailConfig(p),this.config.needBarrageMask&&y&&this.getBarrageMaskUrl(y),c.length>0?("hls"===l&&this.isEncrypt&&this.getEncryptHlsConfig({vid:h,playList:c}),("dash"===l||this.playerData.configs.DASHPlugin)&&this.getDashPluginConfig(h,f),m=this.playerData.configs,g=m.autoBitrateOpts,v=m.Mp4EncryptPlayer,b=m.enableMp4MSE,("mp4"===l&&this.isEncrypt||"mp4"===l&&null!=g&&g.isOpenAutoDefi||v||b)&&this.getMp4EncryptConfig({vid:h,playList:c}),this.playerData.playList=c,this.playerData.initCurrent(this.playerData.playList[0])):console.error("got no video by playAuthToken"),e.next=40;break;case 37:e.prev=37,e.t1=e.catch(0),console.error(e.t1);case 40:case"end":return e.stop()}}),e,this,[[0,37]])}))),function(){return t.apply(this,arguments)})},{key:"getEncryptHlsConfig",value:function(e){var t=e||{},r=t.playList,n=t.vid,i=this.config,a=i.playDomain,o=i.keyToken,s=i.getKeyType,l=i.keyDomain,u=_objectSpread2$c({},this.playerData.configs.EncryptHlsPlugin||{});this.playerData.options.EncryptHlsPlugin=_objectSpread2$c(o?{keyToken:o,playDomain:a||TOB_PLAY_DOMAIN,getKeyType:s||"TOP",keyDomain:l||TOB_KEY_DOMAIN}:{vid:n,kid:null==r?void 0:r[0].kid,getLicenseUrl:LICENSE_URL},u)}},{key:"getThumbnailConfig",value:function(e){var t=e[0],r=_objectSpread2$c({},this.playerData.configs.thumbnail||{});this.playerData.options.thumbnail=_objectSpread2$c({pic_num:t.CaptureNum,urls:t.StoreUrls,width:t.CellWidth,height:t.CellHeight,col:t.ImgXLen,row:t.ImgYLen},r)}},{key:"getBarrageMaskUrl",value:function(e){var t,r,n=_objectSpread2$c({},(null===(t=this.playerData.configs)||void 0===t||null===(r=t.DanmuPlugin)||void 0===r?void 0:r.maskConfig)||{});this.playerData.configs.DanmuPlugin?(this.playerData.options.DanmuPlugin.active=!0,this.playerData.options.DanmuPlugin.maskActive=!0,this.playerData.options.DanmuPlugin.maskConfig=_objectSpread2$c({maskUrl:e},n)):this.playerData.options.DanmuPlugin={active:!0,maskActive:!0,maskConfig:_objectSpread2$c({maskUrl:e},n)}}},{key:"getDashPluginConfig",value:function(e,t){var r,n=_objectSpread2$c({},(null===(r=this.playerData.configs)||void 0===r?void 0:r.DASHPlugin)||{});this.playerData.options.DASHPlugin=_objectSpread2$c({getLicenseUrl:LICENSE_URL,playInfoType:"TOP",vid:e,dashOpts:t,defaultFormat:"dash",definitionText:this.config.definitionMap},n)}},{key:"getMp4EncryptConfig",value:function(e){var t,r=e.playList,n=e.vid,i=_objectSpread2$c({},(null===(t=this.playerData.configs)||void 0===t?void 0:t.Mp4EncryptPlayer)||{});this.playerData.options.Mp4EncryptPlayer=_objectSpread2$c(_objectSpread2$c({vid:n,bitrate:null==r?void 0:r[0].Bitrate},this.isEncrypt?{isEncrypt:!0,kid:r[0].kid,getLicenseUrl:LICENSE_URL}:{}),i)}},{key:"init",value:function(){var e=this.playerData.configs.getVideoByToken,t=void 0===e?{}:e;this.initConfig(t)}},{key:"initConfig",value:function(e){if(this.isPlayByToken=!!e.playAuthToken,this.isPlayByToken&&(this.config=e,this.isEncrypt=isEncryptPlay(e),this.tokenInfo=parseToken(e.playAuthToken),e.keyToken)){var t=isBase64(e.keyToken)?window.atob(e.keyToken):e.keyToken;this.keyTokenInfo=getQueryParams(t)}}},{key:"switchAuthToken",value:function(e){return this.initConfig(e),this.getConfig()}}],[{key:"pluginName",get:function(){return"AuthToken"}}]),i}(SdkPlugin);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var lengthOfArrayLike$2=lengthOfArrayLike$K,arrayToReversed$1=function(e,t){for(var r=lengthOfArrayLike$2(e),n=new t(r),i=0;i<r;i++)n[i]=e[r-i-1];return n},arrayToReversed=arrayToReversed$1,ArrayBufferViewCore$3=arrayBufferViewCore$1,aTypedArray$2=ArrayBufferViewCore$3.aTypedArray,exportTypedArrayMethod$2=ArrayBufferViewCore$3.exportTypedArrayMethod,getTypedArrayConstructor$2=ArrayBufferViewCore$3.getTypedArrayConstructor;exportTypedArrayMethod$2("toReversed",(function(){return arrayToReversed(aTypedArray$2(this),getTypedArrayConstructor$2(this))}));var ArrayBufferViewCore$2=arrayBufferViewCore$1,uncurryThis$3=functionUncurryThis$1,aCallable=aCallable$p,arrayFromConstructorAndList=arrayFromConstructorAndList$6,aTypedArray$1=ArrayBufferViewCore$2.aTypedArray,getTypedArrayConstructor$1=ArrayBufferViewCore$2.getTypedArrayConstructor,exportTypedArrayMethod$1=ArrayBufferViewCore$2.exportTypedArrayMethod,sort=uncurryThis$3(ArrayBufferViewCore$2.TypedArrayPrototype.sort);exportTypedArrayMethod$1("toSorted",(function(e){void 0!==e&&aCallable(e);var t=aTypedArray$1(this),r=arrayFromConstructorAndList(getTypedArrayConstructor$1(t),t);return sort(r,e)}));var lengthOfArrayLike$1=lengthOfArrayLike$K,toIntegerOrInfinity$2=toIntegerOrInfinity$v,$RangeError=RangeError,arrayWith$1=function(e,t,r,n){var i=lengthOfArrayLike$1(e),a=toIntegerOrInfinity$2(r),o=a<0?i+a:a;if(o>=i||o<0)throw $RangeError("Incorrect index");for(var s=new t(i),l=0;l<i;l++)s[l]=l===o?n:e[l];return s},arrayWith=arrayWith$1,ArrayBufferViewCore$1=arrayBufferViewCore$1,isBigIntArray=isBigIntArray$5,toIntegerOrInfinity$1=toIntegerOrInfinity$v,toBigInt=toBigInt$7,aTypedArray=ArrayBufferViewCore$1.aTypedArray,getTypedArrayConstructor=ArrayBufferViewCore$1.getTypedArrayConstructor,exportTypedArrayMethod=ArrayBufferViewCore$1.exportTypedArrayMethod,PROPER_ORDER=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(error){return 8===error}}();exportTypedArrayMethod("with",{with:function(e,t){var r=aTypedArray(this),n=toIntegerOrInfinity$1(e),i=isBigIntArray(r)?toBigInt(t):+t;return arrayWith(r,getTypedArrayConstructor(r),n,i)}}.with,!PROPER_ORDER);var $$c=_export$1,uncurryThis$2=functionUncurryThis$1,requireObjectCoercible$1=requireObjectCoercible$p,toIntegerOrInfinity=toIntegerOrInfinity$v,toString$2=toString$O,stringSlice=uncurryThis$2("".slice),max=Math.max,min=Math.min,FORCED=!"".substr||"b"!=="ab".substr(-1);$$c({target:"String",proto:!0,forced:FORCED},{substr:function(e,t){var r,n,i=toString$2(requireObjectCoercible$1(this)),a=i.length,o=toIntegerOrInfinity(e);return o===1/0&&(o=0),o<0&&(o=max(a+o,0)),(r=void 0===t?a:toIntegerOrInfinity(t))<=0||r===1/0||o>=(n=min(o+r,a))?"":stringSlice(i,o,n)}});var $$b=_export$1,lastIndexOf=arrayLastIndexOf$1;$$b({target:"Array",proto:!0,forced:lastIndexOf!==[].lastIndexOf},{lastIndexOf:lastIndexOf});var $$a=_export$1,toObject=toObject$D,lengthOfArrayLike=lengthOfArrayLike$K,setArrayLength=arraySetLength$1,deletePropertyOrThrow=deletePropertyOrThrow$9,doesNotExceedSafeInteger=doesNotExceedSafeInteger$9,INCORRECT_RESULT=1!==[].unshift(0),SILENT_ON_NON_WRITABLE_LENGTH=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(error){return error instanceof TypeError}}();$$a({target:"Array",proto:!0,arity:1,forced:INCORRECT_RESULT||SILENT_ON_NON_WRITABLE_LENGTH},{unshift:function(e){var t=toObject(this),r=lengthOfArrayLike(t),n=arguments.length;if(n){doesNotExceedSafeInteger(r+n);for(var i=r;i--;){var a=i+n;i in t?t[a]=t[i]:deletePropertyOrThrow(t,a)}for(var o=0;o<n;o++)t[o]=arguments[o]}return setArrayLength(t,r+n)}});var $$9=_export$1,copyWithin=arrayCopyWithin$1,addToUnscopables$1=addToUnscopables$a;$$9({target:"Array",proto:!0},{copyWithin:copyWithin}),addToUnscopables$1("copyWithin");var uncurryThis$1=functionUncurryThis$1,requireObjectCoercible=requireObjectCoercible$p,toString$1=toString$O,quot=/"/g,replace$1=uncurryThis$1("".replace),createHtml=function(e,t,r,n){var i=toString$1(requireObjectCoercible(e)),a="<"+t;return""!==r&&(a+=" "+r+'="'+replace$1(toString$1(n),quot,"&quot;")+'"'),a+">"+i+"</"+t+">"},fails$3=fails$1Q,stringHtmlForced=function(e){return fails$3((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))},$$8=_export$1,createHTML=createHtml,forcedStringHTMLMethod=stringHtmlForced;$$8({target:"String",proto:!0,forced:forcedStringHTMLMethod("link")},{link:function(e){return createHTML(this,"a","href",e)}});var $$7=_export$1,ArrayBufferViewCore=arrayBufferViewCore$1,NATIVE_ARRAY_BUFFER_VIEWS=ArrayBufferViewCore.NATIVE_ARRAY_BUFFER_VIEWS;$$7({target:"ArrayBuffer",stat:!0,forced:!NATIVE_ARRAY_BUFFER_VIEWS},{isView:ArrayBufferViewCore.isView});for(var itoc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ctoi$1={},index$2=0;index$2<66;index$2++)ctoi$1[itoc.charAt(index$2)]=index$2;var base64Map={itoc:itoc,ctoi:ctoi$1},$$6=_export$1,getBuiltIn$3=getBuiltIn$A,uncurryThis=functionUncurryThis$1,fails$2=fails$1Q,toString=toString$O,hasOwn$2=hasOwnProperty_1$1,validateArgumentsLength=validateArgumentsLength$c,ctoi=base64Map.ctoi,disallowed=/[^\d+/a-z]/i,whitespaces=/[\t\n\f\r ]+/g,finalEq=/[=]+$/,$atob=getBuiltIn$3("atob"),fromCharCode=String.fromCharCode,charAt=uncurryThis("".charAt),replace=uncurryThis("".replace),exec=uncurryThis(disallowed.exec),NO_SPACES_IGNORE=fails$2((function(){return""!==$atob(" ")})),NO_ENCODING_CHECK=!fails$2((function(){$atob("a")})),NO_ARG_RECEIVING_CHECK=!NO_SPACES_IGNORE&&!NO_ENCODING_CHECK&&!fails$2((function(){$atob()})),WRONG_ARITY=!NO_SPACES_IGNORE&&!NO_ENCODING_CHECK&&1!==$atob.length;$$6({global:!0,enumerable:!0,forced:NO_SPACES_IGNORE||NO_ENCODING_CHECK||NO_ARG_RECEIVING_CHECK||WRONG_ARITY},{atob:function(e){if(validateArgumentsLength(arguments.length,1),NO_ARG_RECEIVING_CHECK||WRONG_ARITY)return $atob(e);var t,r,n=replace(toString(e),whitespaces,""),i="",a=0,o=0;if(n.length%4==0&&(n=replace(n,finalEq,"")),n.length%4==1||exec(disallowed,n))throw new(getBuiltIn$3("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;t=charAt(n,a++);)hasOwn$2(ctoi,t)&&(r=o%4?64*r+ctoi[t]:ctoi[t],o++%4&&(i+=fromCharCode(255&r>>(-2*o&6))));return i}});var IS_NODE=engineIsNode$1,tryNodeRequire$1=function(e){try{if(IS_NODE)return Function('return require("'+e+'")')()}catch(error){}},domExceptionConstants={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}},$$5=_export$1,tryNodeRequire=tryNodeRequire$1,getBuiltIn$2=getBuiltIn$A,fails$1=fails$1Q,create=objectCreate$2,createPropertyDescriptor$1=createPropertyDescriptor$k,defineProperty$1=objectDefineProperty$1.f,defineBuiltIn=defineBuiltIn$D,defineBuiltInAccessor=defineBuiltInAccessor$8,hasOwn$1=hasOwnProperty_1$1,anInstance$1=anInstance$h,anObject=anObject$L,errorToString=errorToString$2,normalizeStringArgument$1=normalizeStringArgument$4,DOMExceptionConstants$1=domExceptionConstants,clearErrorStack$1=errorStackClear,InternalStateModule=internalState$1,DESCRIPTORS$1=descriptors$1,DOM_EXCEPTION$2="DOMException",DATA_CLONE_ERR="DATA_CLONE_ERR",Error$2=getBuiltIn$2("Error"),NativeDOMException$1=getBuiltIn$2(DOM_EXCEPTION$2)||function(){try{(new(getBuiltIn$2("MessageChannel")||tryNodeRequire("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(error){if(error.name==DATA_CLONE_ERR&&25==error.code)return error.constructor}}(),NativeDOMExceptionPrototype=NativeDOMException$1&&NativeDOMException$1.prototype,ErrorPrototype=Error$2.prototype,setInternalState=InternalStateModule.set,getInternalState=InternalStateModule.getterFor(DOM_EXCEPTION$2),HAS_STACK="stack"in Error$2(DOM_EXCEPTION$2),codeFor=function(e){return hasOwn$1(DOMExceptionConstants$1,e)&&DOMExceptionConstants$1[e].m?DOMExceptionConstants$1[e].c:0},$DOMException$1=function(){anInstance$1(this,DOMExceptionPrototype$1);var e=arguments.length,t=normalizeStringArgument$1(e<1?void 0:arguments[0]),r=normalizeStringArgument$1(e<2?void 0:arguments[1],"Error"),n=codeFor(r);if(setInternalState(this,{type:DOM_EXCEPTION$2,name:r,message:t,code:n}),DESCRIPTORS$1||(this.name=r,this.message=t,this.code=n),HAS_STACK){var i=Error$2(t);i.name=DOM_EXCEPTION$2,defineProperty$1(this,"stack",createPropertyDescriptor$1(1,clearErrorStack$1(i.stack,1)))}},DOMExceptionPrototype$1=$DOMException$1.prototype=create(ErrorPrototype),createGetterDescriptor=function(e){return{enumerable:!0,configurable:!0,get:e}},getterFor=function(e){return createGetterDescriptor((function(){return getInternalState(this)[e]}))};DESCRIPTORS$1&&(defineBuiltInAccessor(DOMExceptionPrototype$1,"code",getterFor("code")),defineBuiltInAccessor(DOMExceptionPrototype$1,"message",getterFor("message")),defineBuiltInAccessor(DOMExceptionPrototype$1,"name",getterFor("name"))),defineProperty$1(DOMExceptionPrototype$1,"constructor",createPropertyDescriptor$1(1,$DOMException$1));var INCORRECT_CONSTRUCTOR=fails$1((function(){return!(new NativeDOMException$1 instanceof Error$2)})),INCORRECT_TO_STRING=INCORRECT_CONSTRUCTOR||fails$1((function(){return ErrorPrototype.toString!==errorToString||"2: 1"!==String(new NativeDOMException$1(1,2))})),INCORRECT_CODE=INCORRECT_CONSTRUCTOR||fails$1((function(){return 25!==new NativeDOMException$1(1,"DataCloneError").code}));INCORRECT_CONSTRUCTOR||25!==NativeDOMException$1[DATA_CLONE_ERR]||NativeDOMExceptionPrototype[DATA_CLONE_ERR];var FORCED_CONSTRUCTOR$1=INCORRECT_CONSTRUCTOR;$$5({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR$1},{DOMException:FORCED_CONSTRUCTOR$1?$DOMException$1:NativeDOMException$1});var PolyfilledDOMException$1=getBuiltIn$2(DOM_EXCEPTION$2),PolyfilledDOMExceptionPrototype$1=PolyfilledDOMException$1.prototype;for(var key$1 in INCORRECT_TO_STRING&&NativeDOMException$1===PolyfilledDOMException$1&&defineBuiltIn(PolyfilledDOMExceptionPrototype$1,"toString",errorToString),INCORRECT_CODE&&DESCRIPTORS$1&&NativeDOMException$1===PolyfilledDOMException$1&&defineBuiltInAccessor(PolyfilledDOMExceptionPrototype$1,"code",createGetterDescriptor((function(){return codeFor(anObject(this).name)}))),DOMExceptionConstants$1)if(hasOwn$1(DOMExceptionConstants$1,key$1)){var constant$1=DOMExceptionConstants$1[key$1],constantName$1=constant$1.s,descriptor$1=createPropertyDescriptor$1(6,constant$1.c);hasOwn$1(PolyfilledDOMException$1,constantName$1)||defineProperty$1(PolyfilledDOMException$1,constantName$1,descriptor$1),hasOwn$1(PolyfilledDOMExceptionPrototype$1,constantName$1)||defineProperty$1(PolyfilledDOMExceptionPrototype$1,constantName$1,descriptor$1)}var $$4=_export$1,global$1=global$1v,getBuiltIn$1=getBuiltIn$A,createPropertyDescriptor=createPropertyDescriptor$k,defineProperty=objectDefineProperty$1.f,hasOwn=hasOwnProperty_1$1,anInstance=anInstance$h,inheritIfRequired=inheritIfRequired$b,normalizeStringArgument=normalizeStringArgument$4,DOMExceptionConstants=domExceptionConstants,clearErrorStack=errorStackClear,DESCRIPTORS=descriptors$1,DOM_EXCEPTION$1="DOMException",Error$1=getBuiltIn$1("Error"),NativeDOMException=getBuiltIn$1(DOM_EXCEPTION$1),$DOMException=function(){anInstance(this,DOMExceptionPrototype);var e=arguments.length,t=normalizeStringArgument(e<1?void 0:arguments[0]),r=normalizeStringArgument(e<2?void 0:arguments[1],"Error"),n=new NativeDOMException(t,r),i=Error$1(t);return i.name=DOM_EXCEPTION$1,defineProperty(n,"stack",createPropertyDescriptor(1,clearErrorStack(i.stack,1))),inheritIfRequired(n,this,$DOMException),n},DOMExceptionPrototype=$DOMException.prototype=NativeDOMException.prototype,ERROR_HAS_STACK="stack"in Error$1(DOM_EXCEPTION$1),DOM_EXCEPTION_HAS_STACK="stack"in new NativeDOMException(1,2),descriptor=NativeDOMException&&DESCRIPTORS&&Object.getOwnPropertyDescriptor(global$1,DOM_EXCEPTION$1),BUGGY_DESCRIPTOR=!(!descriptor||descriptor.writable&&descriptor.configurable),FORCED_CONSTRUCTOR=ERROR_HAS_STACK&&!BUGGY_DESCRIPTOR&&!DOM_EXCEPTION_HAS_STACK;$$4({global:!0,constructor:!0,forced:FORCED_CONSTRUCTOR},{DOMException:FORCED_CONSTRUCTOR?$DOMException:NativeDOMException});var PolyfilledDOMException=getBuiltIn$1(DOM_EXCEPTION$1),PolyfilledDOMExceptionPrototype=PolyfilledDOMException.prototype;if(PolyfilledDOMExceptionPrototype.constructor!==PolyfilledDOMException)for(var key in defineProperty(PolyfilledDOMExceptionPrototype,"constructor",createPropertyDescriptor(1,PolyfilledDOMException)),DOMExceptionConstants)if(hasOwn(DOMExceptionConstants,key)){var constant=DOMExceptionConstants[key],constantName=constant.s;hasOwn(PolyfilledDOMException,constantName)||defineProperty(PolyfilledDOMException,constantName,createPropertyDescriptor(6,constant.c))}var getBuiltIn=getBuiltIn$A,setToStringTag=setToStringTag$k,DOM_EXCEPTION="DOMException";setToStringTag(getBuiltIn(DOM_EXCEPTION),DOM_EXCEPTION);var abrAlgo=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(r){var n,i,a=void 0!==(r=r||{})?r:{};a.ready=new Promise((function(e,t){n=e,i=t})),Object.getOwnPropertyDescriptor(a.ready,"_getPredictedBitrate")||(Object.defineProperty(a.ready,"_getPredictedBitrate",{configurable:!0,get:function(){ee("You are getting _getPredictedBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_getPredictedBitrate",{configurable:!0,set:function(){ee("You are setting _getPredictedBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateMediaInfo")||(Object.defineProperty(a.ready,"_updateMediaInfo",{configurable:!0,get:function(){ee("You are getting _updateMediaInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateMediaInfo",{configurable:!0,set:function(){ee("You are setting _updateMediaInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateBufferInfo")||(Object.defineProperty(a.ready,"_updateBufferInfo",{configurable:!0,get:function(){ee("You are getting _updateBufferInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateBufferInfo",{configurable:!0,set:function(){ee("You are setting _updateBufferInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateSwitchInfo")||(Object.defineProperty(a.ready,"_updateSwitchInfo",{configurable:!0,get:function(){ee("You are getting _updateSwitchInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateSwitchInfo",{configurable:!0,set:function(){ee("You are setting _updateSwitchInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updateDeviceInfo")||(Object.defineProperty(a.ready,"_updateDeviceInfo",{configurable:!0,get:function(){ee("You are getting _updateDeviceInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updateDeviceInfo",{configurable:!0,set:function(){ee("You are setting _updateDeviceInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_parseMPD")||(Object.defineProperty(a.ready,"_parseMPD",{configurable:!0,get:function(){ee("You are getting _parseMPD on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_parseMPD",{configurable:!0,set:function(){ee("You are setting _parseMPD on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_getPreloadBitrate")||(Object.defineProperty(a.ready,"_getPreloadBitrate",{configurable:!0,get:function(){ee("You are getting _getPreloadBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_getPreloadBitrate",{configurable:!0,set:function(){ee("You are setting _getPreloadBitrate on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updatePreloadSupplier")||(Object.defineProperty(a.ready,"_updatePreloadSupplier",{configurable:!0,get:function(){ee("You are getting _updatePreloadSupplier on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updatePreloadSupplier",{configurable:!0,set:function(){ee("You are setting _updatePreloadSupplier on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_updatePreloadInfo")||(Object.defineProperty(a.ready,"_updatePreloadInfo",{configurable:!0,get:function(){ee("You are getting _updatePreloadInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_updatePreloadInfo",{configurable:!0,set:function(){ee("You are setting _updatePreloadInfo on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_setDebugModel")||(Object.defineProperty(a.ready,"_setDebugModel",{configurable:!0,get:function(){ee("You are getting _setDebugModel on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_setDebugModel",{configurable:!0,set:function(){ee("You are setting _setDebugModel on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"_free")||(Object.defineProperty(a.ready,"_free",{configurable:!0,get:function(){ee("You are getting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"_free",{configurable:!0,set:function(){ee("You are setting _free on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"___stdio_exit")||(Object.defineProperty(a.ready,"___stdio_exit",{configurable:!0,get:function(){ee("You are getting ___stdio_exit on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"___stdio_exit",{configurable:!0,set:function(){ee("You are setting ___stdio_exit on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}})),Object.getOwnPropertyDescriptor(a.ready,"onRuntimeInitialized")||(Object.defineProperty(a.ready,"onRuntimeInitialized",{configurable:!0,get:function(){ee("You are getting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}),Object.defineProperty(a.ready,"onRuntimeInitialized",{configurable:!0,set:function(){ee("You are setting onRuntimeInitialized on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")}}));var o=Object.assign({},a);if(a.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -s ENVIRONMENT=web or -s ENVIRONMENT=node)");var s,l,u="";if("undefined"!=typeof document&&document.currentScript&&(u=document.currentScript.src),t&&(u=t),u=0!==u.indexOf("blob:")?u.substr(0,u.replace(/[?#].*/,"").lastIndexOf("/")+1):"","object"!=("undefined"==typeof window?"undefined":_typeof(window))&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");s=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(n){var r=ke(e);if(r)return function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n>255&&(S(!1,"Character code "+n+" ("+String.fromCharCode(n)+")  at offset "+r+" not in 0x00-0xFF."),n&=255),t.push(String.fromCharCode(n))}return t.join("")}(r);throw n}},l=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response)t(n.response);else{var i=ke(e);i?t(i.buffer):r()}},n.onerror=r,n.send(null)};var c,d=a.print||console.log.bind(console),h=a.printErr||console.warn.bind(console);function f(e){f.shown||(f.shown={}),f.shown[e]||(f.shown[e]=1,h(e))}function p(e,t){Object.getOwnPropertyDescriptor(a,e)||Object.defineProperty(a,e,{configurable:!0,get:function(){ee("Module."+e+" has been replaced with plain "+t+" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}})}function y(e,t){var r="'"+e+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";return t&&(r+=". Alternatively, forcing filesystem support (-s FORCE_FILESYSTEM=1) can export this for you"),r}function m(e,t){Object.getOwnPropertyDescriptor(a,e)||Object.defineProperty(a,e,{configurable:!0,get:function(){ee(y(e,t))}})}function g(e,t){Object.getOwnPropertyDescriptor(a,e)||(a[e]=function(){return ee(y(e,t))})}Object.assign(a,o),o=null,c="fetchSettings",Object.getOwnPropertyDescriptor(a,c)&&ee("`Module."+c+"` was supplied but `"+c+"` not included in INCOMING_MODULE_JS_API"),a.arguments&&a.arguments,p("arguments","arguments_"),a.thisProgram&&a.thisProgram,p("thisProgram","thisProgram"),a.quit&&a.quit,p("quit","quit_"),S(void 0===a.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),S(void 0===a.read,"Module.read option was removed (modify read_ in JS)"),S(void 0===a.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),S(void 0===a.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),S(void 0===a.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),S(void 0===a.TOTAL_MEMORY,"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),p("read","read_"),p("readAsync","readAsync"),p("readBinary","readBinary"),p("setWindowTitle","setWindowTitle"),S(!0,"worker environment detected but not enabled at build time.  Add 'worker' to `-s ENVIRONMENT` to enable."),S(!0,"node environment detected but not enabled at build time.  Add 'node' to `-s ENVIRONMENT` to enable."),S(!0,"shell environment detected but not enabled at build time.  Add 'shell' to `-s ENVIRONMENT` to enable.");var v,b=0;a.wasmBinary&&(v=a.wasmBinary),p("wasmBinary","wasmBinary"),a.noExitRuntime,p("noExitRuntime","noExitRuntime");var _,E={Memory:function(e){this.buffer=new ArrayBuffer(65536*e.initial)},Module:function(e){},Instance:function(e,t){this.exports=function(e){for(var t,r=new Uint8Array(123),n=25;n>=0;--n)r[48+n]=52+n,r[65+n]=n,r[97+n]=26+n;function i(e,t,n){for(var i,a,o=0,s=t,l=n.length,u=t+(3*l>>2)-("="==n[l-2])-("="==n[l-1]);o<l;o+=4)i=r[n.charCodeAt(o+1)],a=r[n.charCodeAt(o+2)],e[s++]=r[n.charCodeAt(o)]<<2|i>>4,s<u&&(e[s++]=i<<4|a>>2),s<u&&(e[s++]=a<<6|r[n.charCodeAt(o+3)])}r[43]=62,r[47]=63;var a=new ArrayBuffer(16),o=new Int32Array(a),s=new Float64Array(a);function l(e){return o[e]}function u(e,t){o[e]=t}function c(){return s[0]}function d(e){s[0]=e}return function(e){var r=e.memory,n=r.buffer;r.grow=function(e){e|=0;var i=0|si(),l=i+e|0;if(i<l&&l<65536){var u=new ArrayBuffer(g(l,65536));new Int8Array(u).set(a),a=new Int8Array(u),o=new Int16Array(u),s=new Int32Array(u),h=new Uint8Array(u),f=new Uint16Array(u),p=new Uint32Array(u),y=new Float32Array(u),m=new Float64Array(u),n=u,r.buffer=n,t=h}return i};var a=new Int8Array(n),o=new Int16Array(n),s=new Int32Array(n),h=new Uint8Array(n),f=new Uint16Array(n),p=new Uint32Array(n),y=new Float32Array(n),m=new Float64Array(n),g=Math.imul,v=Math.fround,b=Math.abs,_=Math.clz32,E=Math.min,T=Math.floor,S=Math.ceil,$=e.abort,A=e.gettimeofday,w=e.__assert_fail,k=e.__cxa_allocate_exception,I=e.__cxa_throw,C=e.emscripten_memcpy_big,P=e.fd_write,x=e.emscripten_resize_heap,R=e.fd_read,O=e.fd_close,L=e.abort,D=e.setTempRet0,M=e.fd_seek,N=20800,G=0,V=0,U=0;function Z(e){var t,r=0,n=0,i=0,a=0,o=0,l=0,u=0,c=0,d=0,f=0,y=0,m=0;N=t=N-16|0;e:{t:{r:{n:{i:{a:{o:{s:{l:{u:{c:{if((e|=0)>>>0<=244){if(3&(r=(a=s[2763])>>>(n=(l=e>>>0<11?16:e+11&-8)>>>3|0)|0)){e=(o=s[(r=(i=n+(1&(-1^r))|0)<<3)+11100>>2])+8|0,(0|(n=s[o+8>>2]))!=(0|(r=r+11092|0))?(s[n+12>>2]=r,s[r+8>>2]=n):(y=11052,m=tr(i)&a,s[y>>2]=m),r=i<<3,s[o+4>>2]=3|r,s[(r=r+o|0)+4>>2]=1|s[r+4>>2];break e}if((f=s[2765])>>>0>=l>>>0)break c;if(r){n=e=(r=(0-(e=(0-(e=2<<n)|e)&r<<n)&e)-1|0)>>>12&16,n|=e=(r=r>>>e|0)>>>5&8,n|=e=(r=r>>>e|0)>>>2&4,d=s[(e=(n=((n|=e=(r=r>>>e|0)>>>1&2)|(e=(r=r>>>e|0)>>>1&1))+(r>>>e|0)|0)<<3)+11100>>2],(0|(r=s[d+8>>2]))!=(0|(e=e+11092|0))?(s[r+12>>2]=e,s[e+8>>2]=r):(a=tr(n)&a,s[2763]=a),e=d+8|0,s[d+4>>2]=3|l,o=(r=n<<3)-l|0,s[(i=l+d|0)+4>>2]=1|o,s[r+d>>2]=o,f&&(n=11092+((r=f>>>3|0)<<3)|0,d=s[2768],(r=1<<r)&a?r=s[n+8>>2]:(s[2763]=r|a,r=n),s[n+8>>2]=d,s[r+12>>2]=d,s[d+12>>2]=n,s[d+8>>2]=r),s[2768]=i,s[2765]=o;break e}if(!(u=s[2764]))break c;for(n=e=(r=(0-u&u)-1|0)>>>12&16,n|=e=(r=r>>>e|0)>>>5&8,n|=e=(r=r>>>e|0)>>>2&4,r=s[11356+(((n|=e=(r=r>>>e|0)>>>1&2)|(e=(r=r>>>e|0)>>>1&1))+(r>>>e|0)<<2)>>2],i=(-8&s[r+4>>2])-l|0,n=r;(e=s[n+16>>2])||(e=s[n+20>>2]);)i=(o=(n=(-8&s[e+4>>2])-l|0)>>>0<i>>>0)?n:i,r=o?e:r,n=e;if(c=s[r+24>>2],(0|(o=s[r+12>>2]))!=(0|r)){e=s[r+8>>2],s[e+12>>2]=o,s[o+8>>2]=e;break t}if(!(e=s[(n=r+20|0)>>2])){if(!(e=s[r+16>>2]))break u;n=r+16|0}for(;d=n,o=e,(e=s[(n=e+20|0)>>2])||(n=o+16|0,e=s[o+16>>2]););s[d>>2]=0;break t}if(l=-1,!(e>>>0>4294967231)&&(l=-8&(e=e+11|0),c=s[2764])){i=0-l|0,a=0,l>>>0<256||(a=31,l>>>0>16777215||(e=e>>>8|0,e<<=d=e+1048320>>>16&8,a=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|d)|0)<<1|l>>>e+21&1)|0));d:{h:{if(n=s[11356+(a<<2)>>2])for(e=0,r=l<<(31==(0|a)?0:25-(a>>>1|0)|0);;){if(!((d=(u=-8&s[n+4>>2])-l|0)>>>0>=i>>>0)&&(i=d,o=n,(0|l)==(0|u))){i=0,e=n;break h}if(d=s[n+20>>2],n=s[16+((r>>>29&4)+n|0)>>2],e=d?(0|d)==(0|n)?e:d:e,r<<=1,!n)break}else e=0;if(!(e|o)){if(o=0,!(e=(0-(e=2<<a)|e)&c))break c;n=e=(r=(e&0-e)-1|0)>>>12&16,n|=e=(r=r>>>e|0)>>>5&8,n|=e=(r=r>>>e|0)>>>2&4,e=s[11356+(((n|=e=(r=r>>>e|0)>>>1&2)|(e=(r=r>>>e|0)>>>1&1))+(r>>>e|0)<<2)>>2]}if(!e)break d}for(;i=(n=(r=(-8&s[e+4>>2])-l|0)>>>0<i>>>0)?r:i,o=n?e:o,e=(r=s[e+16>>2])||s[e+20>>2];);}if(!(!o|s[2765]-l>>>0<=i>>>0)){if(a=s[o+24>>2],(0|o)!=(0|(r=s[o+12>>2]))){e=s[o+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;break r}if(!(e=s[(n=o+20|0)>>2])){if(!(e=s[o+16>>2]))break l;n=o+16|0}for(;d=n,r=e,(e=s[(n=e+20|0)>>2])||(n=r+16|0,e=s[r+16>>2]););s[d>>2]=0;break r}}}if((n=s[2765])>>>0>=l>>>0){i=s[2768],(r=n-l|0)>>>0>=16?(s[2765]=r,e=i+l|0,s[2768]=e,s[e+4>>2]=1|r,s[n+i>>2]=r,s[i+4>>2]=3|l):(s[2768]=0,s[2765]=0,s[i+4>>2]=3|n,s[(e=n+i|0)+4>>2]=1|s[e+4>>2]),e=i+8|0;break e}if((c=s[2766])>>>0>l>>>0){r=c-l|0,s[2766]=r,e=(n=s[2769])+l|0,s[2769]=e,s[e+4>>2]=1|r,s[n+4>>2]=3|l,e=n+8|0;break e}if(e=0,u=l+47|0,s[2881]?n=s[2883]:(s[2884]=-1,s[2885]=-1,s[2882]=4096,s[2883]=4096,s[2881]=t+12&-16^1431655768,s[2886]=0,s[2874]=0,n=4096),(n=(d=u+n|0)&(o=0-n|0))>>>0<=l>>>0)break e;if((i=s[2873])&&(a=(r=s[2871])+n|0)>>>0>i>>>0|r>>>0>=a>>>0)break e;if(4&h[11496])break a;c:{d:{if(i=s[2769])for(e=11500;;){if((r=s[e>>2])>>>0<=i>>>0&i>>>0<r+s[e+4>>2]>>>0)break d;if(!(e=s[e+8>>2]))break}if(-1==(0|(r=Qe(0))))break o;if(a=n,(e=(i=s[2882])-1|0)&r&&(a=(n-r|0)+(e+r&0-i)|0),a>>>0<=l>>>0|a>>>0>2147483646)break o;if((i=s[2873])&&i>>>0<(o=(e=s[2871])+a|0)>>>0|e>>>0>=o>>>0)break o;if((0|r)!=(0|(e=Qe(a))))break c;break i}if((a=o&d-c)>>>0>2147483646)break o;if((0|(r=Qe(a)))==(s[e>>2]+s[e+4>>2]|0))break s;e=r}if(!(-1==(0|e)|l+48>>>0<=a>>>0)){if((r=(r=s[2883])+(u-a|0)&0-r)>>>0>2147483646){r=e;break i}if(-1!=(0|Qe(r))){a=r+a|0,r=e;break i}Qe(0-a|0);break o}if(r=e,-1!=(0|e))break i;break o}o=0;break t}r=0;break r}if(-1!=(0|r))break i}s[2874]=4|s[2874]}if(n>>>0>2147483646)break n;if(-1==(0|(r=Qe(n)))|-1==(0|(e=Qe(0)))|e>>>0<=r>>>0)break n;if((a=e-r|0)>>>0<=l+40>>>0)break n}e=s[2871]+a|0,s[2871]=e,e>>>0>p[2872]&&(s[2872]=e);i:{a:{o:{if(u=s[2769]){for(e=11500;;){if(((i=s[e>>2])+(n=s[e+4>>2])|0)==(0|r))break o;if(!(e=s[e+8>>2]))break}break a}for((e=s[2767])>>>0<=r>>>0&&e||(s[2767]=r),e=0,s[2876]=a,s[2875]=r,s[2771]=-1,s[2772]=s[2881],s[2878]=0;n=(i=e<<3)+11092|0,s[i+11100>>2]=n,s[i+11104>>2]=n,32!=(0|(e=e+1|0)););n=(i=a-40|0)-(e=r+8&7?-8-r&7:0)|0,s[2766]=n,e=e+r|0,s[2769]=e,s[e+4>>2]=1|n,s[4+(r+i|0)>>2]=40,s[2770]=s[2885];break i}if(!(8&h[e+12|0]|i>>>0>u>>>0|r>>>0<=u>>>0)){s[e+4>>2]=n+a,n=(e=u+8&7?-8-u&7:0)+u|0,s[2769]=n,e=(r=s[2766]+a|0)-e|0,s[2766]=e,s[n+4>>2]=1|e,s[4+(r+u|0)>>2]=40,s[2770]=s[2885];break i}}p[2767]>r>>>0&&(s[2767]=r),n=r+a|0,e=11500;a:{o:{s:{l:{u:{c:{for(;;){if((0|n)!=s[e>>2]){if(e=s[e+8>>2])continue;break c}break}if(!(8&h[e+12|0]))break u}for(e=11500;;){if((n=s[e>>2])>>>0<=u>>>0&&(o=n+s[e+4>>2]|0)>>>0>u>>>0)break l;e=s[e+8>>2]}}if(s[e>>2]=r,s[e+4>>2]=s[e+4>>2]+a,s[(d=(r+8&7?-8-r&7:0)+r|0)+4>>2]=3|l,l=(a=n+(n+8&7?-8-n&7:0)|0)-(c=l+d|0)|0,(0|a)==(0|u)){s[2769]=c,e=s[2766]+l|0,s[2766]=e,s[c+4>>2]=1|e;break o}if(s[2768]==(0|a)){s[2768]=c,e=s[2765]+l|0,s[2765]=e,s[c+4>>2]=1|e,s[e+c>>2]=e;break o}if(1==(3&(e=s[a+4>>2]))){o=-8&e;u:if(e>>>0<=255){if(n=s[a+8>>2],e=e>>>3|0,(0|(r=s[a+12>>2]))==(0|n)){y=11052,m=s[2763]&tr(e),s[y>>2]=m;break u}s[n+12>>2]=r,s[r+8>>2]=n}else{if(u=s[a+24>>2],(0|a)==(0|(r=s[a+12>>2])))if((i=s[(e=a+20|0)>>2])||(i=s[(e=a+16|0)>>2])){for(;n=e,(i=s[(e=(r=i)+20|0)>>2])||(e=r+16|0,i=s[r+16>>2]););s[n>>2]=0}else r=0;else e=s[a+8>>2],s[e+12>>2]=r,s[r+8>>2]=e;if(u){n=s[a+28>>2];c:{if(s[(e=11356+(n<<2)|0)>>2]==(0|a)){if(s[e>>2]=r,r)break c;y=11056,m=s[2764]&tr(n),s[y>>2]=m;break u}if(s[u+(s[u+16>>2]==(0|a)?16:20)>>2]=r,!r)break u}s[r+24>>2]=u,(e=s[a+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[a+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}}l=o+l|0,a=a+o|0}if(s[a+4>>2]=-2&s[a+4>>2],s[c+4>>2]=1|l,s[l+c>>2]=l,l>>>0<=255){r=11092+((e=l>>>3|0)<<3)|0,(n=s[2763])&(e=1<<e)?e=s[r+8>>2]:(s[2763]=e|n,e=r),s[r+8>>2]=c,s[e+12>>2]=c,s[c+12>>2]=r,s[c+8>>2]=e;break o}if(e=31,l>>>0<=16777215&&(e=l>>>8|0,e<<=i=e+1048320>>>16&8,e=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|i)|0)<<1|l>>>e+21&1)|0),s[c+28>>2]=e,s[c+16>>2]=0,s[c+20>>2]=0,i=11356+(e<<2)|0,(n=s[2764])&(r=1<<e)){for(e=l<<(31==(0|e)?0:25-(e>>>1|0)|0),r=s[i>>2];;){if(n=r,(-8&s[r+4>>2])==(0|l))break s;if(r=e>>>29|0,e<<=1,!(r=s[(i=n+(4&r)|0)+16>>2]))break}s[i+16>>2]=c,s[c+24>>2]=n}else s[2764]=r|n,s[i>>2]=c,s[c+24>>2]=i;s[c+12>>2]=c,s[c+8>>2]=c;break o}for(n=(i=a-40|0)-(e=r+8&7?-8-r&7:0)|0,s[2766]=n,e=e+r|0,s[2769]=e,s[e+4>>2]=1|n,s[4+(r+i|0)>>2]=40,s[2770]=s[2885],s[(n=(e=(o+(o-39&7?39-o&7:0)|0)-47|0)>>>0<u+16>>>0?u:e)+4>>2]=27,e=s[2878],s[n+16>>2]=s[2877],s[n+20>>2]=e,e=s[2876],s[n+8>>2]=s[2875],s[n+12>>2]=e,s[2877]=n+8,s[2876]=a,s[2875]=r,s[2878]=0,e=n+24|0;s[e+4>>2]=7,r=e+8|0,e=e+4|0,r>>>0<o>>>0;);if((0|n)==(0|u))break i;if(s[n+4>>2]=-2&s[n+4>>2],o=n-u|0,s[u+4>>2]=1|o,s[n>>2]=o,o>>>0<=255){r=11092+((e=o>>>3|0)<<3)|0,(n=s[2763])&(e=1<<e)?e=s[r+8>>2]:(s[2763]=e|n,e=r),s[r+8>>2]=u,s[e+12>>2]=u,s[u+12>>2]=r,s[u+8>>2]=e;break i}if(e=31,s[u+16>>2]=0,s[u+20>>2]=0,o>>>0<=16777215&&(e=o>>>8|0,e<<=i=e+1048320>>>16&8,e=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|i)|0)<<1|o>>>e+21&1)|0),s[u+28>>2]=e,i=11356+(e<<2)|0,(n=s[2764])&(r=1<<e)){for(e=o<<(31==(0|e)?0:25-(e>>>1|0)|0),r=s[i>>2];;){if(n=r,(0|o)==(-8&s[r+4>>2]))break a;if(r=e>>>29|0,e<<=1,!(r=s[(i=n+(4&r)|0)+16>>2]))break}s[i+16>>2]=u,s[u+24>>2]=n}else s[2764]=r|n,s[i>>2]=u,s[u+24>>2]=i;s[u+12>>2]=u,s[u+8>>2]=u;break i}e=s[n+8>>2],s[e+12>>2]=c,s[n+8>>2]=c,s[c+24>>2]=0,s[c+12>>2]=n,s[c+8>>2]=e}e=d+8|0;break e}e=s[n+8>>2],s[e+12>>2]=u,s[n+8>>2]=u,s[u+24>>2]=0,s[u+12>>2]=n,s[u+8>>2]=e}if(!((e=s[2766])>>>0<=l>>>0)){r=e-l|0,s[2766]=r,e=(n=s[2769])+l|0,s[2769]=e,s[e+4>>2]=1|r,s[n+4>>2]=3|l,e=n+8|0;break e}}s[2720]=48,e=0;break e}r:if(a){n=s[o+28>>2];n:{if(s[(e=11356+(n<<2)|0)>>2]==(0|o)){if(s[e>>2]=r,r)break n;c=tr(n)&c,s[2764]=c;break r}if(s[a+(s[a+16>>2]==(0|o)?16:20)>>2]=r,!r)break r}s[r+24>>2]=a,(e=s[o+16>>2])&&(s[r+16>>2]=e,s[e+24>>2]=r),(e=s[o+20>>2])&&(s[r+20>>2]=e,s[e+24>>2]=r)}r:if(i>>>0<=15)e=i+l|0,s[o+4>>2]=3|e,s[(e=e+o|0)+4>>2]=1|s[e+4>>2];else if(s[o+4>>2]=3|l,s[(a=o+l|0)+4>>2]=1|i,s[a+i>>2]=i,i>>>0<=255)r=11092+((e=i>>>3|0)<<3)|0,(n=s[2763])&(e=1<<e)?e=s[r+8>>2]:(s[2763]=e|n,e=r),s[r+8>>2]=a,s[e+12>>2]=a,s[a+12>>2]=r,s[a+8>>2]=e;else{e=31,i>>>0<=16777215&&(e=i>>>8|0,e<<=d=e+1048320>>>16&8,e=28+((e=((e<<=n=e+520192>>>16&4)<<(r=e+245760>>>16&2)>>>15|0)-(r|n|d)|0)<<1|i>>>e+21&1)|0),s[a+28>>2]=e,s[a+16>>2]=0,s[a+20>>2]=0,r=11356+(e<<2)|0;n:{if((n=1<<e)&c){for(e=i<<(31==(0|e)?0:25-(e>>>1|0)|0),n=s[r>>2];;){if((-8&s[(r=n)+4>>2])==(0|i))break n;if(n=e>>>29|0,e<<=1,!(n=s[(d=(4&n)+r|0)+16>>2]))break}s[d+16>>2]=a}else s[2764]=n|c,s[r>>2]=a;s[a+24>>2]=r,s[a+12>>2]=a,s[a+8>>2]=a;break r}e=s[r+8>>2],s[e+12>>2]=a,s[r+8>>2]=a,s[a+24>>2]=0,s[a+12>>2]=r,s[a+8>>2]=e}e=o+8|0;break e}t:if(c){n=s[r+28>>2];r:{if(s[(e=11356+(n<<2)|0)>>2]==(0|r)){if(s[e>>2]=o,o)break r;y=11056,m=tr(n)&u,s[y>>2]=m;break t}if(s[c+(s[c+16>>2]==(0|r)?16:20)>>2]=o,!o)break t}s[o+24>>2]=c,(e=s[r+16>>2])&&(s[o+16>>2]=e,s[e+24>>2]=o),(e=s[r+20>>2])&&(s[o+20>>2]=e,s[e+24>>2]=o)}i>>>0<=15?(e=i+l|0,s[r+4>>2]=3|e,s[(e=e+r|0)+4>>2]=1|s[e+4>>2]):(s[r+4>>2]=3|l,s[(o=r+l|0)+4>>2]=1|i,s[i+o>>2]=i,f&&(n=11092+((e=f>>>3|0)<<3)|0,d=s[2768],(e=1<<e)&a?e=s[n+8>>2]:(s[2763]=e|a,e=n),s[n+8>>2]=d,s[e+12>>2]=d,s[d+12>>2]=n,s[d+8>>2]=e),s[2768]=o,s[2765]=i),e=r+8|0}return N=t+16|0,0|e}function B(e,t,r){var n,i,a,l=0,u=0,c=0,d=0,h=0,f=0,p=0,y=0,v=0,b=0,_=0,E=0;e:{t:{r:{n:{if((0|(l=Sn(t)))<=109){if(34==(0|l))break n;if(91==(0|l))break t;if(102!=(0|l))break e;i:{a:{if(102==(0|Sn(t))){if(pr(t),!(ir(t,97)&&ir(t,108)&&ir(t,115)&&ir(t,101)&&pt(r,0))){if(r=3,$n(e))break a;bn(e,r,Mr(t)),$n(e)}break i}w(2582,1472,883,1933),$()}w(2472,1472,891,1933),$()}return}if(123==(0|l))break r;if(116!=(0|l)){if(110!=(0|l))break e;i:{a:{if(110==(0|Sn(t))){if(pr(t),ir(t,117)&&ir(t,108)&&ir(t,108))Dt(be(r+32|0));else{if($n(e))break a;bn(e,3,Mr(t)),$n(e)}break i}w(2565,1472,857,1367),$()}w(2472,1472,865,1367),$()}return}i:{a:{if(116==(0|Sn(t))){if(pr(t),!(ir(t,114)&&ir(t,117)&&ir(t,101)&&pt(r,1))){if(r=3,$n(e))break a;bn(e,r,Mr(t)),$n(e)}break i}w(2548,1472,870,1815),$()}w(2472,1472,878,1815),$()}return}return void Y(e,t,r,0)}r:{n:{if(123==(0|Sn(t))){if(pr(t),Xe(be(r+32|0),3),it(t),$n(e))break r;if(ir(t,125))break n;for(;;){i:{a:{o:{s:{if(34!=(0|Sn(t))){if($n(e))break s;if(bn(e,4,Mr(t)),$n(e))break r}if(Y(e,t,r,1),$n(e))break r;if(it(t),$n(e))break r;if(!ir(t,58)){if($n(e))break o;if(bn(e,5,Mr(t)),$n(e))break r}if(it(t),$n(e))break r;if(B(e,t,r),$n(e))break r;if(it(t),$n(e))break r;if(c=c+1|0,44==(0|(d=Sn(t))))break a;if(125==(0|d)&&(pr(t),Pe(r,c)))break r;if($n(e))break i;if(bn(e,6,Mr(t)),!$n(e))continue;break r}w(2472,1472,758,1128),$()}w(2472,1472,767,1128),$()}if(pr(t),it(t),!$n(e))continue;break r}break}w(2472,1472,792,1128),$()}w(2531,1472,741,1128),$()}Pe(r,0)}return}t:{r:{n:{if(91==(0|Sn(t))){if(pr(t),Xe(be(r+32|0),4),it(t),$n(e))break t;if(ir(t,93))break r;if(B(e,t,r),$n(e))break t;for(;;){if(it(t),$n(e))break t;c=c+1|0;i:{if(ir(t,44)){if(it(t),!$n(e))break i;break t}if(ir(t,93)&&Je(r,c))break t;if($n(e))break n;if(bn(e,7,Mr(t)),$n(e))break t}if(B(e,t,r),$n(e))break}break t}w(2599,1472,809,1024),$()}w(2472,1472,842,1024),$()}Je(r,0)}return}N=n=N-32|0,l=n+8|0,i=Pt(n+16|0,t),s[l>>2]=i,a=gn(l),t=nr(l,45);e:{t:{r:{n:{i:{a:{o:{s:if(48!=(0|mn(l)))l:{u:{if(!((0|mn(l))<49||(0|mn(l))>57)){h=yn(l)-48|0,f=mn(l);c:{if(!t){if((0|f)>47)break c;break l}if((0|f)<48)break l;for(;;){if((0|mn(l))>57)break s;if(!(h>>>0<214748364)){if(214748364!=(0|h))break u;if(!((0|mn(l))<=56)){h=214748364;break u}}if(c=c+1|0,h=(yn(l)+g(h,10)|0)-48|0,!((0|mn(l))>47))break}break s}for(;;){if((0|mn(l))>57)break s;if(!(h>>>0<429496729)){if(429496729!=(0|h))break u;if(!((0|mn(l))<=53)){h=429496729;break u}}if(c=c+1|0,h=(yn(l)+g(h,10)|0)-48|0,!((0|mn(l))>47))break}break s}if(!$n(e)){if(bn(e,3,gn(l)),$n(e))break o;break s}w(2472,1472,1538,1166),$()}d=h,f=mn(l);u:{c:{if(!t){if(b=1,(0|f)<=47)break s;for(;;){if((0|mn(l))>57)break s;if(!(429496729==(0|u)&d>>>0<2576980377|u>>>0<429496729)){if(-1717986919!=(0|d)|429496729!=(0|u))break c;if(!((0|mn(l))<=53)){d=-1717986919,u=429496729;break c}}if(d=Ne(d,u,10,0),_=(u=U)+1|0,f=u,u=(d=d+(u=yn(l)-48|0)|0)>>>0<u>>>0?_:f,c=c+1|0,!((0|mn(l))>47))break}break u}if(b=1,(0|f)<48)break s;for(;;){if((0|mn(l))>57)break s;if(!(214748364==(0|u)&d>>>0<3435973836|u>>>0<214748364)){if(-858993460!=(0|d)|214748364!=(0|u))break c;if(!((0|mn(l))<=56)){d=-858993460,u=214748364;break c}}if(d=Ne(d,u,10,0),_=(u=U)+1|0,f=u,u=(d=d+(u=yn(l)-48|0)|0)>>>0<u>>>0?_:f,c=c+1|0,!((0|mn(l))>47))break}break u}if(p=+(d>>>0)+4294967296*+(u>>>0),y=1,!((0|mn(l))<48))for(;;){if((0|mn(l))>57)break u;if(p=10*p+ +(yn(l)-48|0),!((0|mn(l))>47))break}}}else yn(l);s:if(nr(l,46)){if(!((0|mn(l))>=48&&(0|mn(l))<58)){if($n(e))break a;if(bn(e,14,gn(l)),$n(e))break o}if(!y){d=b?d:h,u=b?u:0;l:if(!((0|mn(l))<48))for(;;){if((0|mn(l))>57|u>>>0>2097151)break l;if(d=Ne(d,u,10,0),f=c,y=(c=U)+1|0,u=c,c=f+(0!=((u=(d=d+(c=yn(l)-48|0)|0)>>>0<c>>>0?y:u)|d))|0,v=v-1|0,!((0|mn(l))>47))break}p=+(d>>>0)+4294967296*+(u>>>0)}if((0|mn(l))<48)y=1;else for(y=1;;){if((0|mn(l))>57)break s;if(f=yn(l),(0|c)>16||(v=v-1|0,(p=10*p+ +(f-48|0))>0&&(c=c+1|0)),!((0|mn(l))>47))break}}if(nr(l,101)||(c=0,nr(l,69))){nr(l,43)||(E=nr(l,45));s:if((0|mn(l))<48||(0|mn(l))>57){if($n(e))break r;if(bn(e,15,gn(l)),c=0,$n(e))break o}else{if(c=yn(l)-48|0,E){if((0|v)>0)break i;if((0|mn(l))<48)break s;for(f=(v+2147483639|0)/10|0;;){if((0|mn(l))>57)break s;l:if(!((0|f)>=(0|(c=(yn(l)+g(c,10)|0)-48|0))||(0|mn(l))<48))for(;;){if((0|mn(l))>57)break l;if(yn(l),!((0|mn(l))>47))break}if(!((0|mn(l))>47))break}break s}if((0|mn(l))<48)break s;for(f=308-v|0;;){if((0|mn(l))>57)break s;if((0|f)<(0|(c=(yn(l)+g(c,10)|0)-48|0))){if($n(e))break n;if(bn(e,13,a),$n(e))break o}if(!((0|mn(l))>47))break}}p=y?p:+((b?d:h)>>>0)+4294967296*+((b?u:0)>>>0),y=1,c=E?0-c|0:c}if(l=c,y){if((p=(0|(d=l+v|0))<=-309?Rt(Rt(p,-308),d+308|0):Rt(p,d))>17976931348623157e292){if($n(e))break t;if(bn(e,13,a),$n(e))break o}e=be(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,m[e>>3]=t?-p:p,o[e+18>>1]=534}else if(b){if(t){e=be(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,h=0-d|0,s[e>>2]=h,t=0-((0!=(0|d))+u|0)|0,s[e+4>>2]=t,o[e+18>>1]=150;s:{if((0|t)>0|(0|t)>=0){if(r=t?406:470,o[e+18>>1]=r,!t&h>>>0>2147483647|t)break s;r|=32}else if(r=182,-1==(0|t)&h>>>0<2147483648|-1!=(0|t))break s;o[e+18>>1]=r}break o}e=be(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[e>>2]=d,s[e+4>>2]=u,t=(0|u)>0|(0|u)>=0?406:278,o[e+18>>1]=t,u||(o[e+18>>1]=64|t,!u&d>>>0>2147483647|u||(o[e+18>>1]=96|t))}else t?(e=be(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,t=0-h|0,s[e>>2]=t,s[e+4>>2]=t>>31,o[e+18>>1]=(0|t)>=0?502:182):(e=be(r+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[e>>2]=h,s[e+4>>2]=0,o[e+18>>1]=(0|h)>=0?502:470)}Ft(i),N=n+32|0;break e}w(2472,1472,1581,1166),$()}w(2219,1472,1645,1166),$()}w(2472,1472,1661,1166),$()}w(2472,1472,1666,1166),$()}w(2472,1472,1713,1166),$()}}function F(e,t,r,n,i){var l,u,c,d=0,f=0,p=0,y=0,v=0,b=0,_=0,E=0,T=0,S=0,$=0,A=0,w=0,k=0,I=0,C=0;N=l=N-80|0,s[l+76>>2]=t,c=l+55|0,u=l+56|0,t=0;e:{t:{r:{n:{i:for(;;){if((2147483647-_|0)<(0|t))break n;_=t+_|0;a:{o:{s:{if(b=s[l+76>>2],d=h[0|(t=b)])for(;;){l:{u:if(d&=255){if(37!=(0|d))break l;for(d=t;;){if(37!=h[t+1|0])break u;if(f=t+2|0,s[l+76>>2]=f,d=d+1|0,p=h[t+2|0],t=f,37!=(0|p))break}}else d=t;if((0|(t=d-b|0))>(0|(k=2147483647-_|0)))break n;if(e&&fe(e,b,t),(0|d)!=(0|b))continue i;S=-1,d=1,f=!vn(a[s[l+76>>2]+1|0]),t=s[l+76>>2],f|36!=h[t+2|0]||(S=a[t+1|0]-48|0,w=1,d=3),t=d+t|0,s[l+76>>2]=t,E=0;u:if((f=(y=a[0|t])-32|0)>>>0>31)d=t;else if(d=t,75913&(p=1<<f))for(;;){if(d=t+1|0,s[l+76>>2]=d,E|=p,(f=(y=a[t+1|0])-32|0)>>>0>=32)break u;if(t=d,!(75913&(p=1<<f)))break}u:if(42!=(0|y)){if((0|(T=Me(l+76|0)))<0)break n;t=s[l+76>>2]}else{if(vn(a[d+1|0])&&(t=s[l+76>>2],36==h[t+2|0]))s[((a[t+1|0]<<2)+i|0)-192>>2]=10,T=s[((a[t+1|0]<<3)+n|0)-384>>2],w=1,t=t+3|0;else{if(w)break s;w=0,T=0,e&&(t=s[r>>2],s[r>>2]=t+4,T=s[t>>2]),t=s[l+76>>2]+1|0}if(s[l+76>>2]=t,(0|T)>=0)break u;T=0-T|0,E|=8192}if(d=0,p=-1,$=0,46==h[0|t])if(42!=h[t+1|0])s[l+76>>2]=t+1,p=Me(l+76|0),t=s[l+76>>2],$=1;else{if(vn(a[t+2|0])&&(t=s[l+76>>2],36==h[t+3|0]))s[((a[t+2|0]<<2)+i|0)-192>>2]=10,p=s[((a[t+2|0]<<3)+n|0)-384>>2],t=t+4|0;else{if(w)break s;e?(t=s[r>>2],s[r>>2]=t+4,p=s[t>>2]):p=0,t=s[l+76>>2]+2|0}s[l+76>>2]=t,$=(-1^p)>>>31|0}for(;;){if(A=d,v=28,a[0|t]-123>>>0<4294967238)break r;if(y=t+1|0,s[l+76>>2]=y,d=a[0|t],t=y,!((d=h[7711+(d+g(A,58)|0)|0])-1>>>0<8))break}u:{c:{if(27!=(0|d)){if(!d)break r;if((0|S)>=0){s[(S<<2)+i>>2]=d,d=s[(t=(S<<3)+n|0)+4>>2],s[l+64>>2]=s[t>>2],s[l+68>>2]=d;break c}if(!e)break a;ee(l- -64|0,d,r),y=s[l+76>>2];break u}if((0|S)>=0)break r}if(t=0,!e)continue i}f=-65537&E,d=8192&E?f:E,E=0,S=1035,v=u;u:{c:{d:{h:{f:{p:{y:{m:{g:{v:{b:{_:{E:{T:{S:{$:switch(t=a[y-1|0],(t=A&&3==(15&t)?-33&t:t)-88|0){case 11:break u;case 9:case 13:case 14:case 15:break c;case 27:break y;case 12:case 17:break v;case 23:break b;case 0:case 32:break _;case 24:break E;case 22:break T;case 29:break S;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 10:case 16:case 18:case 19:case 20:case 21:case 25:case 26:case 28:case 30:case 31:break o;default:break $}$:switch(t-65|0){case 0:case 4:case 5:case 6:break c;case 2:break f;case 1:case 3:break o;default:break $}if(83==(0|t))break p;break o}y=s[l+64>>2],f=s[l+68>>2],S=1035;break g}t=0;T:switch(255&A){case 0:case 1:case 6:s[s[l+64>>2]>>2]=_;continue i;case 2:d=s[l+64>>2],s[d>>2]=_,s[d+4>>2]=_>>31;continue i;case 3:o[s[l+64>>2]>>1]=_;continue i;case 4:a[s[l+64>>2]]=_;continue i;case 7:break T;default:continue i}d=s[l+64>>2],s[d>>2]=_,s[d+4>>2]=_>>31;continue i}p=p>>>0>8?p:8,d|=8,t=120}if(b=u,I=32&t,(y=s[l+64>>2])|(f=s[l+68>>2]))for(;a[0|(b=b-1|0)]=I|h[8240+(15&y)|0],C=!f&y>>>0>15|0!=(0|f),A=f,f=f>>>4|0,y=(15&A)<<28|y>>>4,C;);if(!(8&d)|!(s[l+64>>2]|s[l+68>>2]))break m;S=1035+(t>>>4|0)|0,E=2;break m}if(t=u,(y=s[l+64>>2])|(f=s[l+68>>2]))for(;a[0|(t=t-1|0)]=7&y|48,A=!f&y>>>0>7|0!=(0|f),b=f,f=f>>>3|0,y=(7&b)<<29|y>>>3,A;);if(b=t,!(8&d))break m;p=(0|(t=u-b|0))<(0|p)?p:t+1|0;break m}f=t=s[l+68>>2],y=s[l+64>>2],(0|t)<0?(f=0-(f+(0!=(0|y))|0)|0,y=0-y|0,s[l+64>>2]=y,s[l+68>>2]=f,E=1,S=1035):2048&d?(E=1,S=1036):S=(E=1&d)?1037:1035}b=Ie(y,f,u)}if((0|p)<0&&$)break n;if(d=$?-65537&d:d,!(0!=((f=s[l+64>>2])|(t=s[l+68>>2]))|p)){b=u,p=0;break o}p=(0|(t=!(t|f)+(u-b|0)|0))<(0|p)?p:t;break o}y=0!=(0|(v=$=p>>>0<2147483647?p:2147483647));y:{m:{g:{v:if(!(!(3&(t=d=b=(t=s[l+64>>2])||2278))|!v))for(;;){if(!h[0|t])break g;if(y=0!=(0|(v=v-1|0)),!(3&(t=t+1|0)))break v;if(!v)break}if(!y)break m}g:if(!(!h[0|t]|v>>>0<4))for(;;){if((-1^(y=s[t>>2]))&y-16843009&-2139062144)break g;if(t=t+4|0,!((v=v-4|0)>>>0>3))break}if(v)for(;;){if(!h[0|t])break y;if(t=t+1|0,!(v=v-1|0))break}}t=0}if(v=(t=t?t-d|0:$)+b|0,(0|p)>=0){d=f,p=t;break o}if(d=f,p=t,h[0|v])break n;break o}if(p){v=s[l+64>>2];break h}t=0,Be(e,32,T,0,d);break d}s[l+12>>2]=0,s[l+8>>2]=s[l+64>>2],v=l+8|0,s[l+64>>2]=v,p=-1}t=0;h:{for(;;){if(!(f=s[v>>2]))break h;if(!((b=(0|(f=ue(l+4|0,f)))<0)|f>>>0>p-t>>>0)){if(v=v+4|0,p>>>0>(t=t+f|0)>>>0)continue;break h}break}if(b)break t}if(v=61,(0|t)<0)break r;if(Be(e,32,T,t,d),t)for(p=0,v=s[l+64>>2];;){if(!(f=s[v>>2]))break d;if((p=(f=ue(l+4|0,f))+p|0)>>>0>t>>>0)break d;if(fe(e,l+4|0,f),v=v+4|0,!(t>>>0>p>>>0))break}else t=0}Be(e,32,T,t,8192^d),t=(0|t)<(0|T)?T:t;continue i}if((0|p)<0&&$)break n;if(v=61,(0|(t=0|oi[7](e,m[l+64>>3],T,p,d,t)))>=0)continue i;break r}a[l+55|0]=s[l+64>>2],p=1,b=c,d=f;break o}f=t+1|0,s[l+76>>2]=f,d=h[t+1|0],t=f}if(e)break e;if(!w)break a;for(t=1;;){if(e=s[(t<<2)+i>>2]){if(ee((t<<3)+n|0,e,r),_=1,10!=(0|(t=t+1|0)))continue;break e}break}if(_=1,t>>>0>=10)break e;for(;;){if(s[(t<<2)+i>>2])break s;if(10==(0|(t=t+1|0)))break}break e}v=28;break r}if((0|(p=(0|p)>(0|(y=v-b|0))?p:y))>(2147483647-E|0))break n;if(v=61,(0|k)<(0|(t=(0|(f=p+E|0))<(0|T)?T:f)))break r;Be(e,32,t,f,d),fe(e,S,E),Be(e,48,t,f,65536^d),Be(e,48,p,y,0),fe(e,b,y),Be(e,32,t,f,8192^d);continue}break}_=0;break e}v=61}s[2720]=v}_=-1}return N=l+80|0,_}function j(e){var t=0,r=0,n=0,i=0,a=0,o=0,l=0,u=0,c=0;e:if(e|=0){a=(n=e-8|0)+(e=-8&(t=s[e-4>>2]))|0;t:if(!(1&t)){if(!(3&t))break e;if((n=n-(t=s[n>>2])|0)>>>0<p[2767])break e;if(e=e+t|0,s[2768]==(0|n)){if(3==(3&(t=s[a+4>>2])))return s[2765]=e,s[a+4>>2]=-2&t,s[n+4>>2]=1|e,void(s[e+n>>2]=e)}else{if(t>>>0<=255){if(i=s[n+8>>2],t=t>>>3|0,(0|(r=s[n+12>>2]))==(0|i)){u=11052,c=s[2763]&tr(t),s[u>>2]=c;break t}s[i+12>>2]=r,s[r+8>>2]=i;break t}if(l=s[n+24>>2],(0|n)==(0|(t=s[n+12>>2])))if((r=s[(i=n+20|0)>>2])||(r=s[(i=n+16|0)>>2])){for(;o=i,(r=s[(i=(t=r)+20|0)>>2])||(i=t+16|0,r=s[t+16>>2]););s[o>>2]=0}else t=0;else r=s[n+8>>2],s[r+12>>2]=t,s[t+8>>2]=r;if(!l)break t;i=s[n+28>>2];r:{if(s[(r=11356+(i<<2)|0)>>2]==(0|n)){if(s[r>>2]=t,t)break r;u=11056,c=s[2764]&tr(i),s[u>>2]=c;break t}if(s[l+(s[l+16>>2]==(0|n)?16:20)>>2]=t,!t)break t}if(s[t+24>>2]=l,(r=s[n+16>>2])&&(s[t+16>>2]=r,s[r+24>>2]=t),!(r=s[n+20>>2]))break t;s[t+20>>2]=r,s[r+24>>2]=t}}if(!(n>>>0>=a>>>0)&&1&(t=s[a+4>>2])){t:{if(!(2&t)){if(s[2769]==(0|a)){if(s[2769]=n,e=s[2766]+e|0,s[2766]=e,s[n+4>>2]=1|e,s[2768]!=(0|n))break e;return s[2765]=0,void(s[2768]=0)}if(s[2768]==(0|a))return s[2768]=n,e=s[2765]+e|0,s[2765]=e,s[n+4>>2]=1|e,void(s[e+n>>2]=e);e=(-8&t)+e|0;r:if(t>>>0<=255){if(i=s[a+8>>2],t=t>>>3|0,(0|(r=s[a+12>>2]))==(0|i)){u=11052,c=s[2763]&tr(t),s[u>>2]=c;break r}s[i+12>>2]=r,s[r+8>>2]=i}else{if(l=s[a+24>>2],(0|a)==(0|(t=s[a+12>>2])))if((r=s[(i=a+20|0)>>2])||(r=s[(i=a+16|0)>>2])){for(;o=i,(r=s[(i=(t=r)+20|0)>>2])||(i=t+16|0,r=s[t+16>>2]););s[o>>2]=0}else t=0;else r=s[a+8>>2],s[r+12>>2]=t,s[t+8>>2]=r;if(l){i=s[a+28>>2];n:{if(s[(r=11356+(i<<2)|0)>>2]==(0|a)){if(s[r>>2]=t,t)break n;u=11056,c=s[2764]&tr(i),s[u>>2]=c;break r}if(s[l+(s[l+16>>2]==(0|a)?16:20)>>2]=t,!t)break r}s[t+24>>2]=l,(r=s[a+16>>2])&&(s[t+16>>2]=r,s[r+24>>2]=t),(r=s[a+20>>2])&&(s[t+20>>2]=r,s[r+24>>2]=t)}}if(s[n+4>>2]=1|e,s[e+n>>2]=e,s[2768]!=(0|n))break t;return void(s[2765]=e)}s[a+4>>2]=-2&t,s[n+4>>2]=1|e,s[e+n>>2]=e}if(e>>>0<=255)return t=11092+((e=e>>>3|0)<<3)|0,(r=s[2763])&(e=1<<e)?e=s[t+8>>2]:(s[2763]=e|r,e=t),s[t+8>>2]=n,s[e+12>>2]=n,s[n+12>>2]=t,void(s[n+8>>2]=e);i=31,s[n+16>>2]=0,s[n+20>>2]=0,e>>>0<=16777215&&(t=e>>>8|0,t<<=o=t+1048320>>>16&8,i=28+((t=((t<<=i=t+520192>>>16&4)<<(r=t+245760>>>16&2)>>>15|0)-(r|i|o)|0)<<1|e>>>t+21&1)|0),s[n+28>>2]=i,o=11356+(i<<2)|0;t:{r:{if((r=s[2764])&(t=1<<i)){for(i=e<<(31==(0|i)?0:25-(i>>>1|0)|0),t=s[o>>2];;){if(r=t,(-8&s[t+4>>2])==(0|e))break r;if(t=i>>>29|0,i<<=1,!(t=s[(o=r+(4&t)|0)+16>>2]))break}s[o+16>>2]=n,s[n+24>>2]=r}else s[2764]=t|r,s[o>>2]=n,s[n+24>>2]=o;s[n+12>>2]=n,s[n+8>>2]=n;break t}e=s[r+8>>2],s[e+12>>2]=n,s[r+8>>2]=n,s[n+24>>2]=0,s[n+12>>2]=r,s[n+8>>2]=e}e=s[2771]-1|0,s[2771]=e||-1}}}function W(e,t){var r,n=0,i=0,a=0,o=0,l=0,u=0,c=0;r=e+t|0;e:{t:if(!(1&(n=s[e+4>>2]))){if(!(3&n))break e;t=(n=s[e>>2])+t|0;r:{if((0|(e=e-n|0))!=s[2768]){if(n>>>0<=255){if(a=s[e+8>>2],n=n>>>3|0,(0|(i=s[e+12>>2]))!=(0|a))break r;u=11052,c=s[2763]&tr(n),s[u>>2]=c;break t}if(l=s[e+24>>2],(0|(n=s[e+12>>2]))==(0|e))if((i=s[(a=e+20|0)>>2])||(i=s[(a=e+16|0)>>2])){for(;o=a,(i=s[(a=(n=i)+20|0)>>2])||(a=n+16|0,i=s[n+16>>2]););s[o>>2]=0}else n=0;else i=s[e+8>>2],s[i+12>>2]=n,s[n+8>>2]=i;if(!l)break t;a=s[e+28>>2];n:{if(s[(i=11356+(a<<2)|0)>>2]==(0|e)){if(s[i>>2]=n,n)break n;u=11056,c=s[2764]&tr(a),s[u>>2]=c;break t}if(s[l+(s[l+16>>2]==(0|e)?16:20)>>2]=n,!n)break t}if(s[n+24>>2]=l,(i=s[e+16>>2])&&(s[n+16>>2]=i,s[i+24>>2]=n),!(i=s[e+20>>2]))break t;s[n+20>>2]=i,s[i+24>>2]=n;break t}if(3!=(3&(n=s[r+4>>2])))break t;return s[2765]=t,s[r+4>>2]=-2&n,s[e+4>>2]=1|t,void(s[r>>2]=t)}s[a+12>>2]=i,s[i+8>>2]=a}t:{if(!(2&(n=s[r+4>>2]))){if(s[2769]==(0|r)){if(s[2769]=e,t=s[2766]+t|0,s[2766]=t,s[e+4>>2]=1|t,s[2768]!=(0|e))break e;return s[2765]=0,void(s[2768]=0)}if(s[2768]==(0|r))return s[2768]=e,t=s[2765]+t|0,s[2765]=t,s[e+4>>2]=1|t,void(s[e+t>>2]=t);t=(-8&n)+t|0;r:if(n>>>0<=255){if(a=s[r+8>>2],n=n>>>3|0,(0|(i=s[r+12>>2]))==(0|a)){u=11052,c=s[2763]&tr(n),s[u>>2]=c;break r}s[a+12>>2]=i,s[i+8>>2]=a}else{if(l=s[r+24>>2],(0|r)==(0|(n=s[r+12>>2])))if((a=s[(i=r+20|0)>>2])||(a=s[(i=r+16|0)>>2])){for(;o=i,(a=s[(i=(n=a)+20|0)>>2])||(i=n+16|0,a=s[n+16>>2]););s[o>>2]=0}else n=0;else i=s[r+8>>2],s[i+12>>2]=n,s[n+8>>2]=i;if(l){a=s[r+28>>2];n:{if(s[(i=11356+(a<<2)|0)>>2]==(0|r)){if(s[i>>2]=n,n)break n;u=11056,c=s[2764]&tr(a),s[u>>2]=c;break r}if(s[l+(s[l+16>>2]==(0|r)?16:20)>>2]=n,!n)break r}s[n+24>>2]=l,(i=s[r+16>>2])&&(s[n+16>>2]=i,s[i+24>>2]=n),(i=s[r+20>>2])&&(s[n+20>>2]=i,s[i+24>>2]=n)}}if(s[e+4>>2]=1|t,s[e+t>>2]=t,s[2768]!=(0|e))break t;return void(s[2765]=t)}s[r+4>>2]=-2&n,s[e+4>>2]=1|t,s[e+t>>2]=t}if(t>>>0<=255)return n=11092+((t=t>>>3|0)<<3)|0,(i=s[2763])&(t=1<<t)?t=s[n+8>>2]:(s[2763]=t|i,t=n),s[n+8>>2]=e,s[t+12>>2]=e,s[e+12>>2]=n,void(s[e+8>>2]=t);a=31,s[e+16>>2]=0,s[e+20>>2]=0,t>>>0<=16777215&&(n=t>>>8|0,n<<=o=n+1048320>>>16&8,a=28+((n=((n<<=a=n+520192>>>16&4)<<(i=n+245760>>>16&2)>>>15|0)-(i|a|o)|0)<<1|t>>>n+21&1)|0),s[e+28>>2]=a,o=11356+(a<<2)|0;t:{if((i=s[2764])&(n=1<<a)){for(a=t<<(31==(0|a)?0:25-(a>>>1|0)|0),n=s[o>>2];;){if(i=n,(-8&s[n+4>>2])==(0|t))break t;if(n=a>>>29|0,a<<=1,!(n=s[(o=i+(4&n)|0)+16>>2]))break}s[o+16>>2]=e,s[e+24>>2]=i}else s[2764]=n|i,s[o>>2]=e,s[e+24>>2]=o;return s[e+12>>2]=e,void(s[e+8>>2]=e)}t=s[i+8>>2],s[t+12>>2]=e,s[i+8>>2]=e,s[e+24>>2]=0,s[e+12>>2]=i,s[e+8>>2]=t}}function X(){var e=0,t=0,r=0,n=0,i=0;return 1&a[9832]||(s[2280]=0,s[2281]=0,s[2286]=0,s[2287]=0,s[2284]=-1,s[2285]=-1,s[2292]=-1,s[2293]=-1,s[2296]=0,s[2297]=0,s[2303]=0,s[2304]=0,s[2302]=1061158912,s[2300]=1045220557,s[2301]=1053609165,s[2315]=-1,s[2316]=-1,s[2282]=0,s[2283]=0,s[2288]=0,s[2289]=0,s[2290]=0,s[2291]=0,s[2294]=-1,s[2295]=-1,s[2298]=0,s[2299]=0,s[2305]=0,s[2306]=0,s[2307]=0,s[2308]=0,s[2317]=-1,s[2318]=-1,s[2321]=0,s[2322]=0,s[2319]=0,s[2320]=0,s[2328]=0,s[2329]=-1082130432,s[2330]=-1082130432,s[2331]=-1082130432,s[2332]=1065353216,s[2333]=1091567616,s[2334]=1073741824,s[2325]=1065353216,s[2323]=16842753,a[9296]=0,ne(9344,0,48),s[2358]=0,s[2359]=1076887552,s[2356]=0,s[2357]=1078067200,s[2354]=0,s[2355]=1077542912,It(9528),It(9540),It(9552),e=hn(9568),nt(9640),nt(9652),It(9672),It(9684),It(9696),It(9716),t=It(9728),r=It(9740),n=It(9752),i=It(9764),It(9776),It(9800),s[2380]=0,s[2381]=0,s[2378]=0,s[2379]=0,s[2376]=0,s[2377]=0,Cn(9528),Cn(9540),In(9552),s[e>>2]=0,s[2396]=0,s[2397]=0,s[2394]=0,s[2395]=0,Cn(9592),s[2404]=0,s[2405]=0,s[2402]=0,In(t),In(n),In(i),In(r),s[2447]=-1,s[2448]=0,s[2449]=0,Qr(9800),s[2457]=0,s[2453]=-1,s[2454]=-1,s[2455]=-1,s[2456]=2,s[2280]=0,s[2281]=0,s[2308]=0,s[2286]=0,s[2287]=0,s[2282]=0,s[2283]=0,s[2288]=0,s[2289]=0,ne(9344,0,48),s[2305]=0,s[2306]=0,s[2298]=0,s[2299]=0,o[4646]=1,s[2290]=0,s[2291]=0,s[2292]=0,s[2293]=0,s[2376]=0,s[2377]=0,s[2378]=0,s[2379]=0,s[2380]=0,s[2381]=0,Cn(9528),Cn(9540),In(9552),In(9728),In(9764),s[2417]=5,Cn(9696),s[2416]=0,Cn(9672),Cn(9684),s[2428]=5,Cn(9716),s[2427]=0,wt(9640),At(9652),s[2352]=0,s[2353]=1076887552,s[2350]=0,s[2351]=1077805056,s[2348]=0,s[2349]=1077149696,s[2326]=1084227584,s[2327]=1084227584,s[2300]=1045220557,s[2301]=1053609165,s[2313]=4,s[2314]=2,s[2311]=12,s[2312]=5,s[2374]=0,s[2375]=1075314688,s[2372]=0,s[2373]=1077936128,s[2370]=-687194767,s[2371]=-1077055325,s[2368]=1717986918,s[2369]=1072064102,s[2366]=0,s[2367]=1071644672,s[2364]=0,s[2365]=1072168960,s[2362]=0,s[2363]=1073217536,s[2360]=-858993459,s[2361]=1072483532,s[2328]=1086324736,s[2309]=10,s[2310]=10,s[2302]=1061158912,s[2303]=0,s[2296]=0,s[2297]=0,a[9832]=1),9120}function H(e,t){var r,n,i=0,a=0,o=0,l=0,u=0,c=0,d=0,h=0,f=0,p=0,y=0,m=0,g=0;if(n=Pr(e),r=s[e+8>>2],kr(e),t){if(r)if(t>>>0>=4294967232)s[2720]=48,a=0;else{u=t>>>0<11?16:t+11&-8,o=-8&(h=s[(l=r-8|0)+4>>2]);e:if(3&h){c=o+l|0;t:if(o>>>0>=u>>>0){if((a=o-u|0)>>>0<16)break t;s[l+4>>2]=1&h|u|2,s[(i=l+u|0)+4>>2]=3|a,s[c+4>>2]=1|s[c+4>>2],W(i,a)}else if(s[2769]!=(0|c))if(s[2768]!=(0|c)){if(2&(a=s[c+4>>2]))break e;if((f=o+(-8&a)|0)>>>0<u>>>0)break e;y=f-u|0;r:if(a>>>0<=255){if(d=s[c+8>>2],i=a>>>3|0,(0|(a=s[c+12>>2]))==(0|d)){m=11052,g=s[2763]&tr(i),s[m>>2]=g;break r}s[d+12>>2]=a,s[a+8>>2]=d}else{if(p=s[c+24>>2],(0|c)==(0|(o=s[c+12>>2])))if((i=s[(d=c+20|0)>>2])||(i=s[(d=c+16|0)>>2])){for(;a=d,o=i,(i=s[(d=i+20|0)>>2])||(d=o+16|0,i=s[o+16>>2]););s[a>>2]=0}else o=0;else i=s[c+8>>2],s[i+12>>2]=o,s[o+8>>2]=i;if(p){a=s[c+28>>2];n:{if(s[(i=11356+(a<<2)|0)>>2]==(0|c)){if(s[i>>2]=o,o)break n;m=11056,g=s[2764]&tr(a),s[m>>2]=g;break r}if(s[(s[p+16>>2]==(0|c)?16:20)+p>>2]=o,!o)break r}s[o+24>>2]=p,(i=s[c+16>>2])&&(s[o+16>>2]=i,s[i+24>>2]=o),(i=s[c+20>>2])&&(s[o+20>>2]=i,s[i+24>>2]=o)}}y>>>0<=15?(s[l+4>>2]=1&h|f|2,s[(i=l+f|0)+4>>2]=1|s[i+4>>2]):(s[l+4>>2]=1&h|u|2,s[(a=l+u|0)+4>>2]=3|y,s[(i=l+f|0)+4>>2]=1|s[i+4>>2],W(a,y))}else{if((a=o+s[2765]|0)>>>0<u>>>0)break e;(i=a-u|0)>>>0>=16?(s[l+4>>2]=1&h|u|2,s[(d=l+u|0)+4>>2]=1|i,s[(a=a+l|0)>>2]=i,s[a+4>>2]=-2&s[a+4>>2]):(s[l+4>>2]=a|1&h|2,s[(i=a+l|0)+4>>2]=1|s[i+4>>2],i=0),s[2768]=d,s[2765]=i}else{if((d=o+s[2766]|0)>>>0<=u>>>0)break e;s[l+4>>2]=1&h|u|2,i=d-u|0,s[(a=l+u|0)+4>>2]=1|i,s[2766]=i,s[2769]=a}i=l}else{if(u>>>0<256)break e;if(o>>>0>=u+4>>>0&&(i=l,o-u>>>0<=s[2883]<<1>>>0))break e;i=0}a=i+8|0,i||(a=0,(l=Z(t))&&(J(l,r,t>>>0>(i=(3&(i=s[r-4>>2])?-4:-8)+(-8&i)|0)>>>0?i:t),j(r),a=l))}else a=Z(t);i=a}else j(r),i=0;s[e+8>>2]=i,s[e+16>>2]=t+i,s[e+12>>2]=i+n}function K(e,t,r){var n=0,i=0,a=0,o=0,l=0,u=0;e:for(;;){o=t-4|0;t:for(;;){for(n=e;;){r:{n:{i:{a:{o:{s:{l:{u:{c:switch(0|(i=(e=t-n|0)>>2)){case 5:break l;case 4:break u;case 2:break c;case 0:case 1:break r;case 3:break o;default:break s}if(!zr(e=t-4|0,n))break r;return void kt(n,e)}return void at(n,n+4|0,n+8|0,t-4|0)}return void Ye(n,n+4|0,n+8|0,n+12|0,t-4|0)}if((0|e)<=123){for(i=t,N=o=N-16|0,Ve(n,n+4|0,r=n+8|0),t=n+12|0;(0|t)!=(0|i);){if(zr(t,r)){for(s[o+12>>2]=s[t>>2],e=t;;){if(a=e,e=r,s[a>>2]=s[e>>2],(0|e)!=(0|n)){if(zr(o+12|0,r=e-4|0))continue}else e=n;break}s[e>>2]=s[o+12>>2]}r=t,t=t+4|0}return void(N=o+16|0)}if(a=((0|i)/2<<2)+n|0,l=e>>>0>=3997?Ye(n,(e=(0|i)/4<<2)+n|0,a,e+a|0,o):Ve(n,a,o),e=o,!zr(n,a)){for(;;){if((0|n)==(0|(e=e-4|0))){if(i=n+4|0,zr(n,o))break i;for(;;){if((0|i)==(0|o))break r;if(zr(n,i)){kt(i,o),i=i+4|0;break i}i=i+4|0}}if(zr(e,a))break}kt(n,e),l=l+1|0}if((i=n+4|0)>>>0>=e>>>0)break a;for(;;)if(u=i,i=i+4|0,!zr(u,a)){for(;!zr(e=e-4|0,a););if(e>>>0<u>>>0){i=u;break a}kt(u,e),a=(0|a)==(0|u)?e:a,l=l+1|0}}Ve(n,n+4|0,t-4|0);break r}if((0|i)!=(0|a)&&zr(a,i)&&(kt(i,a),l=l+1|0),!l){if(u=oe(n,i),oe(e=i+4|0,t)){if(t=i,e=n,!u)continue e;break r}if(a=2,u)break n}if((i-n|0)<(t-i|0)){K(n,i,r),e=i+4|0;continue t}K(i+4|0,t,r),t=i,e=n;continue e}if((0|(a=o))==(0|i))break r;for(;;)if(i=(e=i)+4|0,zr(n,e)){for(;zr(n,a=a-4|0););if(!(e>>>0<a>>>0))break;kt(e,a)}a=4}switch(n=e,a-2|0){case 0:continue t;case 2:continue;default:break r}}break}break}break}}function Y(e,t,r,n){var i,a,o=0,l=0,u=0;if(N=a=N-32|0,34==(0|Sn(i=Pt(a+16|0,t)))){pr(i),s[(o=a+8|0)+4>>2]=0,s[o>>2]=e;e:{t:{r:{n:{i:{a:{for(;;){o:{s:{if(92!=(0|(t=Sn(i)))){if(34!=(255&t))break s;pr(i),pe(o,0);break e}if(l=Mr(i),pr(i),t=Sn(i),u=h[5024+(255&t)|0]){pr(i),pe(o,u<<24>>24);continue}if(117==(0|t)){if(pr(i),t=Ee(e,i,l),$n(e))break o;if(55296==(-1024&t)){if(!ir(i,92)||!ir(i,117)){if($n(e))break a;if(bn(e,9,l),$n(e))break o}if(u=Ee(e,i,l),$n(e))break o;if(u-57344>>>0<=4294966271){if($n(e))break i;if(bn(e,9,l),$n(e))break o}t=65536+(u-56320|(t<<10)-56623104)|0}l:{u:{if(!(t>>>0<=127))if(t>>>0<=2047)pe(o,t>>>6|-64),t=63&t|-128;else if(t>>>0<=65535)pe(o,t>>>12|-32),pe(o,t>>>6&63|-128),t=63&t|-128;else{if(t>>>0>=1114112)break u;pe(o,t>>>18|-16),pe(o,t>>>12&63|-128),pe(o,t>>>6&63|-128),t=63&t|-128}pe(o,t<<24>>24);break l}w(2162,1443,115,2041),$()}continue}if($n(e))break n;if(bn(e,10,l),!$n(e))continue;break o}if(!(t>>>0<=31)){Mr(i),pe(o,pr(i));continue}if(l=$n(e),t){if(l)break t;if(bn(e,12,Mr(i)),!$n(e))continue}else{if(l)break r;if(bn(e,11,Mr(i)),!$n(e))continue}}break}break e}w(2472,1472,1029,1335),$()}w(2472,1472,1033,1335),$()}w(2472,1472,1039,1335),$()}w(2472,1472,1048,1335),$()}w(2472,1472,1050,1335),$()}return $n(e)||(t=s[o+4>>2]-1|0,l=s[o+4>>2],Pr(o=s[o>>2])>>>0<l>>>0&&(w(2420,1498,139,1210),$()),u=o,o=s[o+12>>2]-l|0,s[u+12>>2]=o,he(r,o,t)),Ft(i),void(N=a+32|0)}w(2616,1472,963,1576),$(),w(2472,1472,985,1576),$()}function z(e,t){var r,n,i,a,l,u,c=0,d=0;N=a=N-16|0,s[(c=a+8|0)+4>>2]=t,s[c>>2]=t,N=n=N+-64|0,r=n+24|0,Fr(i=e+32|0)?(t=s[i>>2])||(w(2122,1498,173,1153),$()):t=0,Ot(r,t,256),en(d=r+24|0),s[r+32>>2]=2,l=ln(n+16|0,e),N=t=N-16|0,Br(d,0,0),u=ln(t+8|0,r),it(c);e:{t:{r:if(!$n(r)){n:{if(!Sn(c)){if(d=1,!$n(r))break n;w(2472,1472,571,1921),$()}if(B(r,c,e),$n(r))break r;if(it(c),$n(r))break r;if(!Sn(c))break r;if(d=2,$n(r))break t}bn(r,d,Mr(c)),$n(r)}c=s[r+28>>2],s[n+8>>2]=s[r+24>>2],s[n+12>>2]=c,sn(s[u>>2]),N=t+16|0;break e}w(2472,1472,583,1921),$()}t=s[n+12>>2],s[e+56>>2]=s[n+8>>2],s[e+60>>2]=t,t=Fr(e+56|0),s[n+4>>2]=0,s[n>>2]=t?0:3;e:{t:{if(s[n>>2]|1&s[n+4>>2]){if(24!=(0|Pr(i)))break t;(0|(t=gt(i,1)))!=(0|e)&&(c=s[t+4>>2],s[e>>2]=s[t>>2],s[e+4>>2]=c,c=s[t+20>>2],s[e+16>>2]=s[t+16>>2],s[e+20>>2]=c,c=s[t+12>>2],s[e+8>>2]=s[t+8>>2],s[e+12>>2]=c,o[t+18>>1]=0)}sn(t=s[l>>2]+32|0),s[t+12>>2]!=s[t+8>>2]?H(t,Pr(t)):(j(s[t+8>>2]),s[t+16>>2]=0,s[t+8>>2]=0,s[t+12>>2]=0),vr(r),N=n- -64|0;break e}w(2285,1415,2344,1355),$()}return N=a+16|0,e}function J(e,t,r){var n,i=0,o=0;if(r>>>0>=512)return C(0|e,0|t,0|r),e;n=e+r|0;e:if(3&(e^t))if(n>>>0<4)r=e;else if((i=n-4|0)>>>0<e>>>0)r=e;else for(r=e;a[0|r]=h[0|t],a[r+1|0]=h[t+1|0],a[r+2|0]=h[t+2|0],a[r+3|0]=h[t+3|0],t=t+4|0,i>>>0>=(r=r+4|0)>>>0;);else{t:if(3&e)if(r)for(r=e;;){if(a[0|r]=h[0|t],t=t+1|0,!(3&(r=r+1|0)))break t;if(!(r>>>0<n>>>0))break}else r=e;else r=e;if(!((i=-4&n)>>>0<64||(o=i+-64|0)>>>0<r>>>0))for(;s[r>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],s[r+8>>2]=s[t+8>>2],s[r+12>>2]=s[t+12>>2],s[r+16>>2]=s[t+16>>2],s[r+20>>2]=s[t+20>>2],s[r+24>>2]=s[t+24>>2],s[r+28>>2]=s[t+28>>2],s[r+32>>2]=s[t+32>>2],s[r+36>>2]=s[t+36>>2],s[r+40>>2]=s[t+40>>2],s[r+44>>2]=s[t+44>>2],s[r+48>>2]=s[t+48>>2],s[r+52>>2]=s[t+52>>2],s[r+56>>2]=s[t+56>>2],s[r+60>>2]=s[t+60>>2],t=t- -64|0,o>>>0>=(r=r- -64|0)>>>0;);if(r>>>0>=i>>>0)break e;for(;s[r>>2]=s[t>>2],t=t+4|0,i>>>0>(r=r+4|0)>>>0;);}if(r>>>0<n>>>0)for(;a[0|r]=h[0|t],t=t+1|0,(0|n)!=(0|(r=r+1|0)););return e}function Q(e,t,r){var n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0;n=e;e:{t:{r:{n:{i:{a:{o:{s:{l:{u:{if(t){if(!r)break u;break l}e=(n>>>0)/(r>>>0)|0,U=0;break e}if(!n)break s;break o}if(!(r-1&r))break a;i=0-(o=(_(r)+33|0)-_(t)|0)|0;break n}e=(t>>>0)/0|0,U=0;break e}if((e=32-_(t)|0)>>>0<31)break i;break r}if(1==(0|r))break t;r=31&(e=r?31-_(r-1^r)|0:32),(63&e)>>>0>=32?(e=0,t=t>>>r|0):(e=t>>>r|0,t=((1<<r)-1&t)<<32-r|n>>>r),U=e,e=t;break e}o=e+1|0,i=63-e|0}if(a=31&(e=63&o),e>>>0>=32?(e=0,s=t>>>a|0):(e=t>>>a|0,s=((1<<a)-1&t)<<32-a|n>>>a),a=e,i=31&(e=63&i),e>>>0>=32?(e=n<<i,n=0):(e=(1<<i)-1&n>>>32-i|t<<i,n<<=i),t=e,o)for(d=-1!=(0|(i=r-1|0))?0:-1;s=(e=s<<1|t>>>31)-(u=r&(l=d-((a=a<<1|s>>>31)+(e>>>0>i>>>0)|0)>>31))|0,a=a-(e>>>0<u>>>0)|0,t=t<<1|n>>>31,n=c|n<<1,c=1&l,o=o-1|0;);U=t<<1|n>>>31,e=c|n<<1;break e}n=0,t=0}U=t,e=n}return e}function q(e,t,r){var n,i=0,a=0,o=0,l=0,u=0;N=n=N-16|0;e:{if(on(t)){if(!Zr(r))break e;on(t)||(w(2461,1415,1246,1296),$()),ln(e,s[t+8>>2]),Mt(i=n+8|0,t);t:if(Yr(e,i))for(;;){a=s[e>>2];r:{n:{if(Zr(r)){if(!Zr(a))break n;if((0|(o=$t(r)))==(0|$t(a))){if(i=1,(0|(l=xt(r)))==(0|(a=xt(a))))break r;i:{a:{o:{if(o>>>0>=4){if(3&(a|l))break o;for(;;){if(s[l>>2]!=s[a>>2])break o;if(a=a+4|0,l=l+4|0,!((o=o-4|0)>>>0>3))break}}if(!o)break a}for(;;){if((0|(i=h[0|l]))==(0|(u=h[0|a]))){if(a=a+1|0,l=l+1|0,o=o-1|0)continue;break a}break}i=i-u|0;break i}i=0}i=!i}else i=0;break r}w(2520,1415,2171,1377),$()}w(2500,1415,2172,1377),$()}if(i)break t;if(s[e>>2]=s[e>>2]+48,Mt(i=n+8|0,t),!Yr(e,i))break}return void(N=n+16|0)}w(2461,1415,1334,1178),$()}w(2515,1415,1335,1178),$()}function ee(e,t,r){e:switch(t-9|0){case 0:return t=s[r>>2],s[r>>2]=t+4,void(s[e>>2]=s[t>>2]);case 6:return t=s[r>>2],s[r>>2]=t+4,t=o[t>>1],s[e>>2]=t,void(s[e+4>>2]=t>>31);case 7:return t=s[r>>2],s[r>>2]=t+4,s[e>>2]=f[t>>1],void(s[e+4>>2]=0);case 8:return t=s[r>>2],s[r>>2]=t+4,t=a[0|t],s[e>>2]=t,void(s[e+4>>2]=t>>31);case 9:return t=s[r>>2],s[r>>2]=t+4,s[e>>2]=h[0|t],void(s[e+4>>2]=0);case 16:return t=s[r>>2]+7&-8,s[r>>2]=t+8,void(m[e>>3]=m[t>>3]);case 17:oi[8](e,r);default:return;case 1:case 4:case 14:return t=s[r>>2],s[r>>2]=t+4,t=s[t>>2],s[e>>2]=t,void(s[e+4>>2]=t>>31);case 2:case 5:case 11:case 15:return t=s[r>>2],s[r>>2]=t+4,s[e>>2]=s[t>>2],void(s[e+4>>2]=0);case 3:case 10:case 12:case 13:break e}t=s[r>>2]+7&-8,s[r>>2]=t+8,r=s[t+4>>2],s[e>>2]=s[t>>2],s[e+4>>2]=r}function te(e,t,r){var n,i=0,a=0,o=0,l=0;N=n=N-32|0,s[e+16>>2]=0,s[e>>2]=-1,s[e+4>>2]=-1,s[e+8>>2]=-1,s[e+12>>2]=2;e:{t:switch(0|r){case 0:i=dt(t,3);break e;case 1:o=dt(t,2),a=-1;r:if(!(s[t+544>>2]<2))for(l=t+576|0,i=1;;){if(.5*+s[t+668>>2]>+s[lr(l,i)>>2]&&(a=s[lr(l,i)>>2],i>>>0>2))break r;if(!((0|(i=i+1|0))<s[t+544>>2]))break}i=(0|a)<(0|o)?o:a;break e;default:break t}i=dt(t,3)}s[e>>2]=i,a=de(t,s[t+140>>2],s[t+144>>2]),s[t+108>>2]=a,(0|a)>0&&(i=ge(t,i,a),s[e>>2]=i),1!=(0|(o=s[t+672>>2]))?(a=5e3,s[e+4>>2]=5e3,e=-1):(s[e+16>>2]=1,s[e+8>>2]=1024e3,a=-1,e=1024e3),l=s[t+668>>2],s[n+24>>2]=1,s[n+20>>2]=e,s[n+16>>2]=a,s[n+12>>2]=i,s[n+8>>2]=o,s[n+4>>2]=l,s[n>>2]=r,se(t,3459,n),N=n+32|0}function re(e,t,r){var n=0,i=0;e:if((0|e)!=(0|t)){if(t-(i=e+r|0)>>>0<=0-(r<<1)>>>0)return void J(e,t,r);if(n=3&(e^t),e>>>0<t>>>0){if(!n){if(3&e)for(;;){if(!r)break e;if(a[0|e]=h[0|t],t=t+1|0,r=r-1|0,!(3&(e=e+1|0)))break}if(!(r>>>0<=3))for(;s[e>>2]=s[t>>2],t=t+4|0,e=e+4|0,(r=r-4|0)>>>0>3;);}if(r)for(;a[0|e]=h[0|t],e=e+1|0,t=t+1|0,r=r-1|0;);}else{if(!n){if(3&i)for(;;){if(!r)break e;if(a[0|(n=(r=r-1|0)+e|0)]=h[t+r|0],!(3&n))break}if(!(r>>>0<=3))for(;s[(r=r-4|0)+e>>2]=s[t+r>>2],r>>>0>3;);}if(!r)break e;for(;a[(r=r-1|0)+e|0]=h[t+r|0],r;);}}}function ne(e,t,r){var n=0,i=0,o=0;if(r&&(a[0|e]=t,a[(i=e+r|0)-1|0]=t,!(r>>>0<3||(a[e+2|0]=t,a[e+1|0]=t,a[i-3|0]=t,a[i-2|0]=t,r>>>0<7||(a[e+3|0]=t,a[i-4|0]=t,r>>>0<9||(o=(i=0-e&3)+e|0,n=g(255&t,16843009),s[o>>2]=n,s[(r=(t=r-i&-4)+o|0)-4>>2]=n,t>>>0<9||(s[o+8>>2]=n,s[o+4>>2]=n,s[r-8>>2]=n,s[r-12>>2]=n,t>>>0<25||(s[o+24>>2]=n,s[o+20>>2]=n,s[o+16>>2]=n,s[o+12>>2]=n,s[r-16>>2]=n,s[r-20>>2]=n,s[r-24>>2]=n,s[r-28>>2]=n,(r=(r=t)-(t=4&o|24)|0)>>>0<32))))))))for(n=Ne(n,0,1,1),i=U,t=t+o|0;s[t+24>>2]=n,s[t+28>>2]=i,s[t+16>>2]=n,s[t+20>>2]=i,s[t+8>>2]=n,s[t+12>>2]=i,s[t>>2]=n,s[t+4>>2]=i,t=t+32|0,(r=r-32|0)>>>0>31;);return e}function ie(e,t){var r,n,i,a,o,l=0,u=0,c=0,d=0;if(s[e+4>>2]!=s[Xn(e)>>2])return N=u=N-16|0,l=Zt(u,e,1),cn(Xn(e),s[l+4>>2],t),s[l+4>>2]=s[l+4>>2]+4,Hr(l),void(N=u+16|0);if(N=r=N-32|0,i=Xn(e),u=ze(e,Lr(e)+1|0),c=Lr(e),N=n=N-16|0,s[n+12>>2]=0,dn((l=r+8|0)+12|0,i),u&&(d=hr(s[l+16>>2],u)),s[l>>2]=d,c=(c<<2)+d|0,s[l+8>>2]=c,s[l+4>>2]=c,a=Fn(l),o=(u<<2)+d|0,s[a>>2]=o,N=n+16|0,cn(i,s[l+8>>2],t),s[l+8>>2]=s[l+8>>2]+4,wn(e),t=l+4|0,er(Xn(e),s[e>>2],s[e+4>>2],t),kt(e,t),kt(e+4|0,l+8|0),kt(Xn(e),Fn(l)),s[l>>2]=s[l+4>>2],Gn(e,Lr(e)),(0|(e=s[l+4>>2]))!=s[l+8>>2])for(;s[l+8>>2]=s[l+8>>2]-4,(0|e)!=s[l+8>>2];);s[l>>2]&&j(e=s[l>>2]),N=r+32|0}function ae(e,t,r,n){var i=0;s[n+8>>2]=t,s[n>>2]=0,s[n+4>>2]=0,s[r>>2]=n,s[s[e>>2]>>2]&&(s[e>>2]=s[s[e>>2]>>2]),r=(0|(n=s[Wn(e)>>2]))==(0|(t=s[r>>2])),a[t+12|0]=r;e:if(!r)for(;;){if(h[s[t+8>>2]+12|0])break e;i=xr(s[t+8>>2]),r=s[t+8>>2];t:{if(i){if(!(!(r=s[s[r+8>>2]+4>>2])|h[r+12|0]))break t;xr(t)||et(t=s[t+8>>2]),t=s[t+8>>2],a[t+12|0]=1,t=s[t+8>>2],a[t+12|0]=0,qe(t);break e}if(!(r=s[s[r+8>>2]>>2])|h[r+12|0]){xr(t)&&qe(t=s[t+8>>2]),t=s[t+8>>2],a[t+12|0]=1,t=s[t+8>>2],a[t+12|0]=0,et(t);break e}}if(t=s[t+8>>2],a[t+12|0]=1,t=s[t+8>>2],a[t+12|0]=(0|t)==(0|n),a[r+12|0]=1,(0|t)==(0|n))break}e=Xn(e),s[e>>2]=s[e>>2]+1}function oe(e,t){var r,n=0,i=0,a=0,o=0,l=0,u=0;N=r=N-16|0,o=1;e:{t:switch(t-e>>2){case 2:if(!zr(t=t-4|0,e))break e;kt(e,t);break e;case 3:Ve(e,e+4|0,t-4|0);break e;case 4:at(e,e+4|0,e+8|0,t-4|0);break e;case 5:Ye(e,e+4|0,e+8|0,e+12|0,t-4|0);break e;case 0:case 1:break e;default:break t}for(Ve(e,e+4|0,a=e+8|0),n=e+12|0;;){if((0|t)==(0|n))break e;t:{if(zr(n,a)){for(s[r+12>>2]=s[n>>2],i=n;;){if(u=i,i=a,s[u>>2]=s[i>>2],(0|e)!=(0|i)){if(zr(r+12|0,a=i-4|0))continue}else i=e;break}if(s[i>>2]=s[r+12>>2],8==(0|(l=l+1|0)))break t}a=n,n=n+4|0;continue}break}o=(n+4|0)==(0|t)}return N=r+16|0,o}function se(e,t,r){var n,i=0,a=0;if(N=n=N-16|0,h[e+174|0]){if(s[n+12>>2]=r,N=i=N-208|0,s[i+204>>2]=r,ne(e=i+160|0,0,40),s[i+200>>2]=s[i+204>>2],!((0|F(0,t,i+200|0,i+80|0,e))<0)){e=s[2183]>=0,r=s[2164],s[2182]<=0&&(s[2164]=-33&r);e:{t:{if(s[2176]){if(s[2168])break t}else s[2176]=80,s[2171]=0,s[2168]=0,s[2169]=0,a=s[2175],s[2175]=i;if(We(8656))break e}F(8656,t,i+200|0,i+80|0,i+160|0)}a&&(oi[s[2173]](8656,0,0),s[2176]=0,s[2175]=a,s[2171]=0,s[2168]=0,s[2169]=0),s[2164]=s[2164]|32&r}N=i+208|0}N=n+16|0}function le(e,t){var r=0,n=0,i=0;if((0|e)!=(0|t)){if(!qr(e))return qr(t)?(i=$r(t),t=mr(t),N=r=N-16|0,t>>>0<=10?(Un(e,t),nn(e,i,t),a[r+15|0]=0,Mn(e+t|0,r+15|0)):me(e,10,t-10|0,e=h[e+11|0],e,t,i),void(N=r+16|0)):(s[e+8>>2]=s[t+8>>2],r=s[t+4>>2],s[e>>2]=s[t>>2],void(s[e+4>>2]=r));i=$r(t),t=mr(t),N=r=N-16|0,(n=Rr(e))>>>0>t>>>0?(n=s[e>>2],Vn(e,t),nn(n,i,t),a[r+15|0]=0,Mn(t+n|0,r+15|0)):me(e,n-1|0,1+(t-n|0)|0,e=s[e+4>>2],e,t,i),N=r+16|0}}function ue(e,t){if(!e)return 0;e:{t:{if(e){if(t>>>0<=127)break t;if(s[s[2757]>>2]){if(t>>>0<=2047){a[e+1|0]=63&t|128,a[0|e]=t>>>6|192,e=2;break e}if(!(57344!=(-8192&t)&t>>>0>=55296)){a[e+2|0]=63&t|128,a[0|e]=t>>>12|224,a[e+1|0]=t>>>6&63|128,e=3;break e}if(t-65536>>>0<=1048575){a[e+3|0]=63&t|128,a[0|e]=t>>>18|240,a[e+2|0]=t>>>6&63|128,a[e+1|0]=t>>>12&63|128,e=4;break e}}else if(57216==(-128&t))break t;s[2720]=25,e=-1}else e=1;break e}a[0|e]=t,e=1}return e}function ce(e){var t,r=0,n=0,i=0,a=0;if(Or(t=e+608|0))for(e=0;r=Ur(t,e),(0|(i=s[r+4>>2]))>=0&(r=s[r>>2])>>>0>=2|(0|i)>0?(r=Ur(t,e),i=s[r>>2],r=s[r+4>>2]):(i=1,r=0),a+=1/(+(i>>>0)+4294967296*+(0|r)),e=e+1|0,Or(t)>>>0>e>>>0;);return Or(t)&&(n=+(Or(t)>>>0)/a),b(n)<0x8000000000000000?(U=b(n)>=1?~~(n>0?E(T(2.3283064365386963e-10*n),4294967295):S(2.3283064365386963e-10*(n-+(~~n>>>0>>>0))))>>>0:0,~~n>>>0):(U=-2147483648,0)}function de(e,t,r){var n,i=0,a=0,o=0,l=0,u=0,c=0,d=0;N=n=N-16|0,a=-1;e:if(!((0|t)<=0|(0|r)<=0)){if(s[e+544>>2]>0){for(o=(0|t)>(0|r)?t:r,l=(0|t)<(0|r)?t:r,u=e+576|0,c=e+564|0,d=e+552|0,r=0;;){if(t=s[lr(d,r)>>2],i=lr(c,r),a=-1,(0|t)<=0)break e;if((0|(i=s[i>>2]))<=0)break e;if(a=lr(u,r),(0|((0|t)<(0|i)?t:i))>=(0|l)|(0|((0|t)>(0|i)?t:i))>=(0|o)||!((0|(r=r+1|0))<s[e+544>>2]))break}a=s[a>>2]}s[n>>2]=a,se(e,3607,n)}return N=n+16|0,a}function he(e,t,r){var n,i,l,u=0;return u=be(e+32|0),i=ur(e),N=n=N-16|0,s[u>>2]=0,s[u+4>>2]=0,s[u+16>>2]=0,s[u+20>>2]=0,s[u+8>>2]=0,s[u+12>>2]=0,s[(e=n+8|0)+4>>2]=r,s[e>>2]=t||5280,!r|t||(w(1064,1415,401,1617),$()),p[e+4>>2]<18?(o[u+18>>1]=7173,Dn(u,s[e+4>>2])):(o[u+18>>1]=3077,s[u>>2]=s[e+4>>2],jn(t=u,u=ye(i,s[e+4>>2]+1|0))),l=J(u,s[e>>2],s[e+4>>2])+s[e+4>>2]|0,0,a[0|l]=0,N=n+16|0,1}function fe(e,t,r){var n=0,i=0,a=0;if(!(32&h[0|e]))e:{n=t;t:{if(!(e=s[(t=e)+16>>2])){if(We(t))break t;e=s[t+16>>2]}if(e-(a=s[t+20>>2])>>>0<r>>>0){oi[s[t+36>>2]](t,n,r);break e}r:if(!(s[t+80>>2]<0)){for(e=r;;){if(i=e,!e)break r;if(10==h[n+(e=i-1|0)|0])break}if(oi[s[t+36>>2]](t,n,i)>>>0<i>>>0)break t;n=n+i|0,r=r-i|0,a=s[t+20>>2]}J(a,n,r),s[t+20>>2]=s[t+20>>2]+r}}}function pe(e,t){var r,n=0,i=0;r=s[e>>2],(s[r+16>>2]-s[r+12>>2]|0)<=0&&(s[r+8>>2]?n=((n=kr(r))+1>>>1|0)+n|0:(s[r>>2]||(n=vt(1),s[r+4>>2]=n,s[r>>2]=n),n=s[r+20>>2]),H(r,n>>>0>(i=Pr(r)+1|0)>>>0?n:i));e:{t:{if(n=s[r+12>>2]){if((s[r+16>>2]-n|0)<=0)break t;s[r+12>>2]=n+1;break e}w(2133,1498,130,2030),$()}w(2323,1498,131,2030),$()}a[0|n]=t,s[e+4>>2]=s[e+4>>2]+1}function ye(e,t){var r=0,n=0,i=0,a=0;e:if(t){if(n=t+7&-8,!((t=s[e>>2])&&(i=n+(r=s[t+4>>2])|0)>>>0<=p[t>>2])){if(r=(t=s[e+4>>2])>>>0>n>>>0?t:n,s[e+12>>2]||(t=vt(1),s[e+16>>2]=t,s[e+12>>2]=t),(t=(t=r+16|0)?Z(t):0)&&(s[t+4>>2]=0,s[t>>2]=r,s[t+8>>2]=s[e>>2],s[e>>2]=t),!t)break e;t=s[e>>2],i=n+(r=s[t+4>>2])|0}s[t+4>>2]=i,a=16+(t+r|0)|0}return a}function me(e,t,r,n,i,o,l){var u,c=0,d=0;if(N=u=N-16|0,(-1^t)-17>>>0>=r>>>0)return c=$r(e),t>>>0<2147483623?(s[u+8>>2]=t<<1,s[u+12>>2]=t+r,r=Lt(s[zt(u+12|0,u+8|0)>>2])):r=-18,r=vt(d=r+1|0),o&&nn(r,l,o),l=n-i|0,(0|n)!=(0|i)&&nn(r+o|0,i+c|0,l),10!=(0|t)&&j(c),Yn(e,r),Wr(e,d),Vn(t=e,e=o+l|0),a[u+7|0]=0,Mn(e+r|0,u+7|0),void(N=u+16|0);ni(),$()}function ge(e,t,r){var n,i=0,a=0,o=0,l=0;N=n=N-16|0,o=t;e:if(!((0|r)<=0|(0|t)<=(0|r)||(a=1,s[e+544>>2]<=0||(0|(i=s[lr(l=e+576|0,0)>>2]))>(0|r))))for(;;){if(o=i,s[e+544>>2]<=(0|a))break e;if(i=lr(l,a),a=a+1|0,!((0|(i=s[i>>2]))<=(0|r)))break}return s[n+8>>2]=o,s[n+4>>2]=r,s[n>>2]=t,se(e,3827,n),N=n+16|0,o}function ve(e,t,r,n){a[e+53|0]=1;e:if(s[e+4>>2]==(0|r)){a[e+52|0]=1;t:{if(!(r=s[e+16>>2])){if(s[e+36>>2]=1,s[e+24>>2]=n,s[e+16>>2]=t,1!=(0|n))break e;if(1==s[e+48>>2])break t;break e}if((0|t)==(0|r)){if(2==(0|(r=s[e+24>>2]))&&(s[e+24>>2]=n,r=n),1!=s[e+48>>2])break e;if(1==(0|r))break t;break e}s[e+36>>2]=s[e+36>>2]+1}a[e+54|0]=1}}function be(e){var t=0,r=0;(s[e+16>>2]-s[e+12>>2]|0)<24&&(s[e+8>>2]?t=((t=kr(e))+1>>>1|0)+t|0:(s[e>>2]||(t=vt(1),s[e+4>>2]=t,s[e>>2]=t),t=s[e+20>>2]),H(e,t>>>0>(r=Pr(e)+24|0)>>>0?t:r));e:{t:{if(t=s[e+12>>2]){if((s[e+16>>2]-t|0)<24)break t;s[e+12>>2]=t+24;break e}w(2133,1498,130,2030),$()}w(2323,1498,131,2030),$()}return t}function _e(e,t){var r,n,i;return N=i=(N=n=(N=r=N-16|0)-16|0)-32|0,Ct(i,t),q(n,e,Le(i+8|0,i)),N=i+32|0,s[(t=n+8|0)>>2]=s[n>>2],N=n+16|0,s[r+8>>2]=s[t>>2],N=t=N-16|0,on(e)||(w(2461,1415,1243,2048),$()),e=s[ln(t+8|0,s[e+8>>2]+g(s[e>>2],48)|0)>>2],N=t+16|0,s[r>>2]=e,e=Yr(r+8|0,r),N=r+16|0,e}function Ee(e,t,r){for(var n=0,i=0,a=0;;){e:{n=(i=Sn(t))+(n<<4)|0;t:if((i-48&255)>>>0<=9)n=n-48|0;else if((i-65&255)>>>0<=5)n=n-55|0;else if((i-97&255)>>>0<=5)n=n-87|0;else{if(!$n(e)){if(bn(e,8,r),!$n(e))break t;n=0;break e}w(2472,1472,919,2203),$()}if(pr(t),4!=(0|(a=a+1|0)))continue}break}return n}function Te(e,t,r){var n=0,i=0,a=0;n=pn(e),i=Wn(e);e:{if(n){t:{for(;;){r:{if(zr(r,a=n+16|0)){if(!s[n>>2])break e}else{if(!zr(a,r))break t;if(i=n+4|0,!s[n+4>>2])break r;n=i}i=n,n=s[n>>2];continue}break}return s[t>>2]=n,i}return s[t>>2]=n,i}n=Wn(e)}return s[t>>2]=n,n}function Se(e){var t=0,r=0,n=0;e:{if(3&(t=e))for(;;){if(!h[0|t])break e;if(!(3&(t=t+1|0)))break}for(;r=t,t=t+4|0,!((-1^(n=s[r>>2]))&n-16843009&-2139062144););if(!(255&n))return r-e|0;for(;n=h[r+1|0],r=t=r+1|0,n;);}return t-e|0}function $e(e,t){var r,n=0,i=0;if(s[e+4>>2]!=s[Xn(e)>>2])return N=i=N-16|0,n=ar(i,e),fn(Xn(e),s[n+4>>2],t),s[n+4>>2]=s[n+4>>2]+8,Hr(n),void(N=i+16|0);N=i=N-32|0,r=n=Xn(e),n=Oe(i+8|0,we(e,Or(e)+1|0),Or(e),n),fn(r,s[n+8>>2],t),s[n+8>>2]=s[n+8>>2]+8,st(e,n),rt(n),N=i+32|0}function Ae(e,t,r){var n=0;if(!r)return s[e+4>>2]==s[t+4>>2];if((0|e)==(0|t))return 1;r=s[e+4>>2],e=h[0|r],t=s[t+4>>2];e:if(!(!e|(0|(n=h[0|t]))!=(0|e)))for(;;){if(n=h[t+1|0],!(e=h[r+1|0]))break e;if(t=t+1|0,r=r+1|0,(0|e)!=(0|n))break}return(0|e)==(0|n)}function we(e,t){var r,n,i=0;if(N=r=N-16|0,s[r+12>>2]=t,N=n=N-16|0,s[n+12>>2]=536870911,s[n+8>>2]=2147483647,i=s[Yt(n+12|0,n+8|0)>>2],N=n+16|0,t>>>0<=i>>>0)return(e=Ir(e))>>>0<i>>>1>>>0&&(s[r+8>>2]=e<<1,i=s[zt(r+8|0,r+12|0)>>2]),N=r+16|0,i;Jn(),$()}function ke(e,t){var r,n,i,o=0,s=0;return N=i=N-16|0,r=Se(t),N=n=N-16|0,r>>>0<=4294967279?(r>>>0<=10?(Un(e,r),o=e):(Yn(e,o=vt(s=Lt(r)+1|0)),Wr(e,s),Vn(e,r)),nn(o,t,r),a[n+15|0]=0,Mn(r+o|0,n+15|0),N=n+16|0):(ni(),$()),N=i+16|0,e}function Ie(e,t,r){var n=0,i=0,o=0;if(t)for(;i=Ne(n=Q(e,t,10),o=U,10,0),a[0|(r=r-1|0)]=e-i|48,i=t>>>0>9,e=n,t=o,i;);else n=e;if(n)for(;e=(n>>>0)/10|0,a[0|(r=r-1|0)]=n-g(e,10)|48,t=n>>>0>9,n=e,t;);return r}function Ce(e){var t,r,n=0,i=0,a=0,o=0,s=0,l=0,u=0;if(!((0|(r=Or(t=e+644|0)))<=1)){for(e=n=r-1|0;i=e-1|0,a=+(0|e),o=(m[Ur(t,e)>>3]-m[Ur(t,i)>>3])*a+o,s+=a,l=e>>>0>1,e=i,l;);(0|r)<=1||(u=o/(s*+(0|n)))}return u}function Pe(e,t){var r=0,n=0,i=0;return r=e+32|0,n=g(t,48),Pr(r)>>>0<n>>>0&&(w(2420,1498,139,1210),$()),n=s[r+12>>2]-n|0,s[r+12>>2]=n,r=Gt(r),e=ur(e),o[r+18>>1]=3,t?(jn(r,i=ye(i=e,e=g(t,48))),J(i,n,e)):jn(r,0),s[r>>2]=t,s[r+4>>2]=t,1}function xe(e,t){var r,n,i=0;r=Se(t),N=n=N-16|0,(i=qr(e)?Rr(e)-1|0:10)>>>0>=r>>>0?(i=$r(e),r&&re(i,t,r),a[n+15|0]=0,Mn(r+i|0,n+15|0),qr(e)?Vn(e,r):Un(e,r)):me(e,i,r-i|0,e=mr(e),e,r,t),N=n+16|0}function Re(e,t){var r,n,i=0;if(d(+e),r=0|l(1),n=0|l(0),2047!=(0|(i=r>>>20&2047))){if(!i)return 0==e?i=0:(e=Re(0x10000000000000000*e,t),i=s[t>>2]+-64|0),s[t>>2]=i,e;s[t>>2]=i-1022,u(0,0|n),u(1,-2146435073&r|1071644672),e=+c()}return e}function Oe(e,t,r,n){var i,a,o,l=0;return N=i=N-16|0,s[i+12>>2]=0,dn(e+12|0,n),t&&(t>>>0>536870911&&(Fe(1742),$()),l=vt(t<<3)),s[e>>2]=l,r=(r<<3)+l|0,s[e+8>>2]=r,s[e+4>>2]=r,a=Fn(e),o=(t<<3)+l|0,s[a>>2]=o,N=i+16|0,e}function Le(e,t){var r,n;return N=n=N-16|0,s[e>>2]=0,s[e+4>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[(r=n+8|0)>>2]=s[t>>2],s[r+4>>2]=s[t+4>>2],o[e+18>>1]=1029,jn(e,s[r>>2]),s[e>>2]=s[r+4>>2],N=n+16|0,e}function De(e){var t,r=0,n=0;if(t=s[e+28>>2]){e:if(r=s[t>>2]){for(;;){if(s[t+8>>2]!=(0|r)){if(n=s[r+8>>2],j(r),s[t>>2]=n,r=n)continue;break e}break}s[r+4>>2]=0}(r=s[t+16>>2])&&j(r),j(t)}vr(e+32|0)}function Me(e){var t=0,r=0,n=0;if(!vn(a[s[e>>2]]))return 0;for(;n=s[e>>2],t=-1,r>>>0<=214748364&&(t=a[0|n]-48|0,t=(2147483647-(r=g(r,10))|0)<(0|t)?-1:t+r|0),s[e>>2]=n+1,r=t,vn(a[n+1|0]););return t}function Ne(e,t,r,n){var i,a,o,s,l=0,u=0;return s=g(l=r>>>16|0,u=e>>>16|0),l=(65535&(u=((o=g(i=65535&r,a=65535&e))>>>16|0)+g(u,i)|0))+g(l,a)|0,U=(g(t,r)+s|0)+g(e,n)+(u>>>16)+(l>>>16)|0,65535&o|l<<16}function Ge(e,t,r){var n;if(!(n=s[e+16>>2]))return s[e+36>>2]=1,s[e+24>>2]=r,void(s[e+16>>2]=t);e:{if((0|t)==(0|n)){if(2!=s[e+24>>2])break e;return void(s[e+24>>2]=r)}a[e+54|0]=1,s[e+24>>2]=2,s[e+36>>2]=s[e+36>>2]+1}}function Ve(e,t,r){var n,i=0;i=zr(t,e),n=zr(r,t);e:{if(i){if(n)return kt(e,r),1;if(kt(e,t),i=1,!zr(r,t))break e;kt(t,r)}else{if(i=0,!n)break e;if(kt(t,r),i=1,!zr(t,e))break e;kt(e,t)}i=2}return i}function Ue(e){var t=0;return Dt(e),s[e+28>>2]=0,s[e+24>>2]=0,Ot(e+32|0,0,1024),en(e+56|0),s[e+24>>2]||(t=vt(20),s[t+16>>2]=0,s[t+12>>2]=0,s[t+8>>2]=0,s[t+4>>2]=65536,s[t>>2]=0,s[e+28>>2]=t,s[e+24>>2]=t),e}function Ze(e,t){var r,n,i;return N=r=N-32|0,Ct(r,t),i=Le(r+8|0,r),N=t=N-16|0,q(n=t+8|0,e,i),Mt(t,e),Yr(n,t)?(N=t+16|0,e=s[t+8>>2]+24|0):(w(1927,1415,1218,2143),$()),N=r+32|0,e}function Be(e,t,r,n,i){var a;if(N=a=N-256|0,!(73728&i|(0|r)<=(0|n))){if(ne(a,255&t,(n=(r=r-n|0)>>>0<256)?r:256),!n)for(;fe(e,a,256),(r=r-256|0)>>>0>255;);fe(e,a,r)}N=a+256|0}function Fe(e){var t,r,n,i,a;t=0|k(8),s[t>>2]=8492,s[t>>2]=8536,n=vt((r=Se(e))+13|0),s[n+8>>2]=0,s[n+4>>2]=r,s[n>>2]=r,i=t,a=J(n+12|0,e,r+1|0),s[i+4>>2]=a,s[t>>2]=8584,I(0|t,8616,2),$()}function je(){var e,t,r=0,n=0;return N=r=N-16|0,A(r+8|0,0),n=s[r+12>>2],N=r+16|0,r=Ne(r=s[r+8>>2],r>>31,1e3,0),t=U,n=r+(e=Q(n,n>>31,1e3))|0,r=U+t|0,U=r=n>>>0<e>>>0?r+1|0:r,n}function We(e){var t=0;return t=s[e+72>>2],s[e+72>>2]=t-1|t,8&(t=s[e>>2])?(s[e>>2]=32|t,-1):(s[e+4>>2]=0,s[e+8>>2]=0,t=s[e+44>>2],s[e+28>>2]=t,s[e+20>>2]=t,s[e+16>>2]=t+s[e+48>>2],0)}function Xe(e,t){if(s[e>>2]=0,s[e+4>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,t>>>0<7)return o[e+18>>1]=f[5282+(t<<1)>>1],void(5==(0|t)&&Dn(e,0));w(1968,1415,714,1825),$()}function He(e){var t=0,r=0;e&&(s[e+20>>2]!=s[e+28>>2]&&oi[s[e+36>>2]](e,0,0),(0|(t=s[e+4>>2]))!=(0|(r=s[e+8>>2]))&&(t=t-r|0,oi[s[e+40>>2]](e,t,t>>31,1)))}function Ke(e,t){var r,n,i,a;N=r=N-16|0,s[r+8>>2]=t,i=r,a=_n(e),s[i>>2]=a,n=rr((t=s[e>>2]+(s[r+8>>2]-s[r>>2]>>3<<3)|0)+8|0,s[e+4>>2],t),Or(e),bt(e,n),Kn(e),Wt(t),N=r+16|0}function Ye(e,t,r,n,i){var a=0;if(a=at(e,t,r,n),zr(i,n)){if(kt(n,i),!zr(n,r))return a+1|0;if(kt(r,n),!zr(r,t))return a+2|0;if(kt(t,r),!zr(t,e))return a+3|0;kt(e,t),a=a+4|0}return a}function ze(e,t){var r;if(N=r=N-16|0,s[r+12>>2]=t,t>>>0<=(t=ft(e))>>>0)return(e=Cr(e))>>>0<t>>>1>>>0&&(s[r+8>>2]=e<<1,t=s[zt(r+8|0,r+12|0)>>2]),N=r+16|0,t;Jn(),$()}function Je(e,t){var r,n=0,i=0;return r=gt(n=e+32|0,t),n=Gt(n),e=ur(e),o[n+18>>1]=4,t?(jn(n,i=ye(i=e,e=g(t,24))),J(i,r,e)):jn(n,0),s[n>>2]=t,s[n+4>>2]=t,1}function Qe(e){var t,r;return(e=(t=s[2201])+(r=e+3&-4)|0)>>>0<=t>>>0&&r||e>>>0>si()<<16>>>0&&!(0|x(0|e))?(s[2720]=48,-1):(s[2201]=e,t)}function qe(e){var t,r=0;t=s[e>>2],r=s[t+4>>2],s[e>>2]=r,r&&jn(r,e),s[t+8>>2]=s[e+8>>2],r=xr(e)?s[e+8>>2]:s[e+8>>2]+4|0,s[r>>2]=t,s[t+4>>2]=e,jn(e,t)}function et(e){var t,r=0;t=s[e+4>>2],r=s[t>>2],s[e+4>>2]=r,r&&jn(r,e),s[t+8>>2]=s[e+8>>2],r=xr(e)?s[e+8>>2]:s[e+8>>2]+4|0,s[r>>2]=t,s[t>>2]=e,jn(e,t)}function tt(e,t){var r,n,i=0;N=r=N-32|0,n=i=Xn(e),i=Oe(r+8|0,we(e,Or(e)+1|0),Or(e),i),yr(n,s[i+8>>2],t),s[i+8>>2]=s[i+8>>2]+8,st(e,i),rt(i),N=r+32|0}function rt(e){var t=0;if((0|(t=s[e+4>>2]))!=s[e+8>>2])for(;s[e+8>>2]=s[e+8>>2]-8,(0|t)!=s[e+8>>2];);s[e>>2]&&j(t=s[e>>2])}function nt(e){var t,r,n,i;N=t=(N=r=N-16|0)-16|0,s[e+4>>2]=0,s[t+12>>2]=0,En(e+8|0,t+12|0),n=e,i=Wn(e),s[n>>2]=i,N=t+16|0,N=r+16|0}function it(e){var t,r=0;for(N=t=N-16|0,e=Pt(t,e);!((r=(255&Sn(e))-9|0)>>>0>23|!(1<<r&8388627));)pr(e);Ft(e),N=t+16|0}function at(e,t,r,n){var i=0;if(i=Ve(e,t,r),zr(n,r)){if(kt(r,n),!zr(r,t))return i+1|0;if(kt(t,r),!zr(t,e))return i+2|0;kt(e,t),i=i+3|0}return i}function ot(e,t){var r;if(Lr(r=e+576|0))for(e=0;;){if(s[lr(r,e)>>2]==(0|t))return e;if(e=e+1|0,!(Lr(r)>>>0>e>>>0))break}return 0}function st(e,t){var r;An(e),r=t+4|0,er(Xn(e),s[e>>2],s[e+4>>2],r),kt(e,r),kt(e+4|0,t+8|0),kt(Xn(e),Fn(t)),s[t>>2]=s[t+4>>2],Or(e),Ir(e),Ir(e)}function lt(e,t,r,n){var i;N=i=N-16|0,n=Zt(i,e,n),(0|(e=r-t|0))>0&&(J(s[n+4>>2],t,e),s[n+4>>2]=e+s[n+4>>2]),Hr(n),N=i+16|0}function ut(e,t){e:{if(an(e)){if(p[e>>2]<=t>>>0)break e;return s[e+8>>2]+g(t,24)|0}w(2451,1415,1668,2143),$()}w(1721,1415,1669,2143),$()}function ct(e,t){var r,n,i;ft(e)>>>0<t>>>0&&(Jn(),$()),r=hr(Xn(e),t),s[e>>2]=r,s[e+4>>2]=r,n=Xn(e),i=(t<<2)+r|0,s[n>>2]=i,Gn(e)}function dt(e,t){var r;return Lr(r=e+576|0)?(e=s[e+544>>2]<=(0|t)?Lr(r)-1|0:(0|t)>0?t:0,s[Kr(r,e)>>2]):0}function ht(e){var t;s[e+4>>2],t=s[e>>2],s[e+4>>2]=t}function ft(e){var t;return N=t=N-16|0,s[t+12>>2]=1073741823,s[t+8>>2]=2147483647,e=s[Yt(t+12|0,t+8|0)>>2],N=t+16|0,e}function pt(e,t){return e=be(e+32|0),s[e+16>>2]=0,s[e+20>>2]=0,s[e>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,o[e+18>>1]=t?10:9,1}function yt(e){var t,r;return N=r=(N=t=N-16|0)-16|0,e=s[ln(r+8|0,Wn(e))>>2],N=r+16|0,e=s[ln(t+8|0,e)>>2],N=t+16|0,e}function mt(e,t,r){var n;return N=n=N-16|0,s[n+12>>2]=t,En(e,n+12|0),t=s[r+4>>2],s[e+4>>2]=s[r>>2],s[e+8>>2]=t,N=n+16|0,e}function gt(e,t){var r;return t=g(t,24),Pr(e)>>>0<t>>>0&&(w(2420,1498,139,1210),$()),r=e,e=s[e+12>>2]-t|0,s[r+12>>2]=e,e}function vt(e){var t=0;e=e||1;e:{for(;;){if(t=Z(e))break e;if(!(t=s[3148]))break;oi[0|t]()}L(),$()}return t}function bt(e,t){s[e+4>>2],s[e+4>>2]=t}function _t(e,t){s[e+4>>2],s[e+4>>2]=t}function Et(e){var t,r;return s[(e|=0)>>2]=8536,t=s[e+4>>2]-12|0,r=s[t+8>>2]-1|0,s[t+8>>2]=r,(0|r)<0&&j(t),0|e}function Tt(e,t){var r,n;N=n=N-16|0,r=ar(n,e),yr(Xn(e),s[r+4>>2],t),s[r+4>>2]=s[r+4>>2]+8,Hr(r),N=n+16|0}function St(e,t){var r;return N=r=N-16|0,s[r+8>>2]=s[e>>2],s[r>>2]=s[t>>2],e=Yr(r+8|0,r),N=r+16|0,e}function $t(e){if(Zr(e))return 16&h[e+19|0]?17-a[e+17|0]|0:s[e>>2];w(2520,1415,1857,1389),$()}function At(e){var t=0,r=0;Jt(e,pn(e)),t=Xn(e),r=0,s[t>>2]=r,t=e,r=Wn(e),s[t>>2]=r,t=Wn(e),r=0,s[t>>2]=r}function wt(e){var t=0,r=0;jt(e,pn(e)),t=Xn(e),r=0,s[t>>2]=r,t=e,r=Wn(e),s[t>>2]=r,t=Wn(e),r=0,s[t>>2]=r}function kt(e,t){var r;N=r=N-16|0,s[r+12>>2]=s[e>>2],s[e>>2]=s[t>>2],s[t>>2]=s[r+12>>2],N=r+16|0}function It(e){var t;return N=t=N-16|0,s[e>>2]=0,s[e+4>>2]=0,s[t+12>>2]=0,ei(e+8|0),N=t+16|0,e}function Ct(e,t){var r,n;s[e>>2]=t,t||(w(2232,1415,413,1308),$()),r=e,n=Se(t),s[r+4>>2]=n}function Pt(e,t){var r,n;return r=s[t+4>>2],n=s[t>>2],s[e+8>>2]=t,s[e>>2]=n,s[e+4>>2]=r,e}function xt(e){if(Zr(e))return 16&h[e+19|0]||(e=s[e+8>>2]),e;w(2520,1415,1852,1566),$()}function Rt(e,t){if((0|t)>=-308){if((0|t)>=0)return Bt(t)*e;e/=Bt(0-t|0)}else e=0;return e}function Ot(e,t,r){s[e+4>>2]=0,s[e+8>>2]=0,s[e>>2]=t,s[e+20>>2]=r,s[e+12>>2]=0,s[e+16>>2]=0}function Lt(e){var t=0;return e=e>>>0>=11?11==(0|(e=(t=e+16&-16)-1|0))?t:e:10}function Dt(e){s[e>>2]=0,s[e+4>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0}function Mt(e,t){on(t)||(w(2461,1415,1249,2048),$()),ln(e,s[t+8>>2]+g(s[t>>2],48)|0)}function Nt(e){var t;N=t=N-16|0,s[e>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,N=t+16|0}function Gt(e){return Pr(e)>>>0<=23&&(w(2397,1498,146,1206),$()),s[e+12>>2]-24|0}function Vt(e){var t;return N=t=N-16|0,e=s[ln(t+8|0,_n(e))>>2],N=t+16|0,e}function Ut(e){var t;return N=t=N-16|0,e=s[ln(t+8|0,rn(e))>>2],N=t+16|0,e}function Zt(e,t,r){return s[e>>2]=t,t=s[t+4>>2],s[e+4>>2]=t,s[e+8>>2]=t+(r<<2),e}function Bt(e){return e>>>0>=309&&(w(2184,1532,48,2213),$()),m[5296+(e<<3)>>3]}function Ft(e){var t,r;r=s[e+4>>2],t=s[e+8>>2],s[t>>2]=s[e>>2],s[t+4>>2]=r}function jt(e,t){t&&(jt(e,s[t>>2]),jt(e,s[t+4>>2]),qn(t+16|0),j(t))}function Wt(e){var t;return N=t=N-16|0,e=s[ln(t+8|0,e)>>2],N=t+16|0,e}function Xt(e){var t;return N=t=N-16|0,Yn(t+8|0,e),N=t+16|0,s[t+8>>2]}function Ht(e){var t;return N=t=N-16|0,s[t+8>>2]=e,N=t+16|0,s[t+8>>2]}function Kt(e){return 32&h[e+18|0]||(w(1588,1415,1816,1114),$()),s[e>>2]}function Yt(e,t){var r,n;return N=r=N-16|0,n=Jr(t,e),N=r+16|0,n?t:e}function zt(e,t){var r,n;return N=r=N-16|0,n=Jr(e,t),N=r+16|0,n?t:e}function Jt(e,t){t&&(Jt(e,s[t>>2]),Jt(e,s[t+4>>2]),ti(t+16|0),j(t))}function Qt(e){var t=0;An(e),s[e>>2]&&(Zn(e),t=s[e>>2],Ir(e),j(t))}function qt(e){var t=0;wn(e),s[e>>2]&&(Bn(e),t=s[e>>2],Cr(e),j(t))}function er(e,t,r,n){e=r-t|0,r=s[n>>2]-e|0,s[n>>2]=r,(0|e)>0&&J(r,t,e)}function tr(e){var t;return(-1>>>(t=31&e)&-2)<<t|(-1<<(e=0-e&31)&-2)>>>e}function rr(e,t,r){var n;return n=t-e|0,(0|e)!=(0|t)&&re(r,e,n),r+n|0}function nr(e,t){var r;return(0|(r=mn(e)))==(0|t)&&yn(e),(0|t)==(0|r)}function ir(e,t){var r;return(0|(r=Sn(e)))==(0|t)&&pr(e),(0|t)==(0|r)}function ar(e,t){return s[e>>2]=t,t=s[t+4>>2],s[e+4>>2]=t,s[e+8>>2]=t+8,e}function or(e,t){var r;N=r=N-16|0,K(Ht(e),Ht(t),r+8|0),N=r+16|0}function sr(e,t,r){1==s[e+28>>2]|s[e+4>>2]!=(0|t)||(s[e+28>>2]=r)}function lr(e,t){return Lr(e)>>>0<=t>>>0&&(ri(),$()),s[e>>2]+(t<<2)|0}function ur(e){return(e=s[e+24>>2])||(w(2122,1415,2492,1153),$()),e}function cr(e){return an(e)||(w(2451,1415,1642,1810),$()),s[e>>2]}function dr(e,t){s[e+4>>2]==s[Xn(e)>>2]?tt(e,t):Tt(e,t)}function hr(e,t){return t>>>0>1073741823&&(Fe(1742),$()),vt(t<<2)}function fr(e,t){p[e+4>>2]<p[Xn(e)>>2]?Tt(e,t):tt(e,t)}function pr(e){var t;return t=e,e=s[e>>2],s[t>>2]=e+1,a[0|e]}function yr(e,t,r){e=s[r+4>>2],s[t>>2]=s[r>>2],s[t+4>>2]=e}function mr(e){return qr(e)?s[e+4>>2]:h[e+11|0]}function gr(e){var t=0;qr(e)&&(t=s[e>>2],Rr(e),j(t))}function vr(e){j(s[e+8>>2]),(e=s[e+4>>2])&&j(e)}function br(e){var t;return t=s[e>>2],s[e>>2]=0,t}function _r(e,t,r){s[e>>2]=s[t>>2],a[e+4|0]=h[0|r]}function Er(e){return(s[Xn(e)>>2]-s[e>>2]|0)/48|0}function Tr(e){return Ar(e)||(ri(),$()),s[e>>2]}function Sr(e){return e?(s[2720]=e,-1):0}function $r(e){return qr(e)?s[e>>2]:e}function Ar(e){return(s[e+4>>2]-s[e>>2]|0)/48|0}function wr(e,t){return a[e+4|0]=0,s[e>>2]=t,e}function kr(e){return s[e+16>>2]-s[e+8>>2]|0}function Ir(e){return s[Xn(e)>>2]-s[e>>2]>>3}function Cr(e){return s[Xn(e)>>2]-s[e>>2]>>2}function Pr(e){return s[e+12>>2]-s[e+8>>2]|0}function xr(e){return s[s[e+8>>2]>>2]==(0|e)}function Rr(e){return 2147483647&s[e+8>>2]}function Or(e){return s[e+4>>2]-s[e>>2]>>3}function Lr(e){return s[e+4>>2]-s[e>>2]>>2}function Dr(e,t){return s[e>>2]=s[t>>2],e}function Mr(e){return s[e>>2]-s[e+4>>2]|0}function Nr(e){return s[e>>2]=s[e>>2]+8,e}function Gr(e){return s[e>>2]=s[e>>2]-4,e}function Vr(e){return s[e>>2]=s[e>>2]-8,e}function Ur(e,t){return s[e>>2]+(t<<3)|0}function Zr(e){return(4&h[e+19|0])>>>2|0}function Br(e,t,r){s[e+4>>2]=r,s[e>>2]=t}function Fr(e){return 0!=s[(e|=0)>>2]|0}function jr(e){return Nt(e),Nt(e+24|0),e}function Wr(e,t){s[e+8>>2]=-2147483648|t}function Xr(e){return Nt(e),Nt(e+32|0),e}function Hr(e){s[s[e>>2]+4>>2]=s[e+4>>2]}function Kr(e,t){return s[e>>2]+(t<<2)|0}function Yr(e,t){return s[e>>2]!=s[t>>2]}function zr(e,t){return s[e>>2]<s[t>>2]}function Jr(e,t){return p[e>>2]<p[t>>2]}function Qr(e){Ar(e),ht(e),Er(e),Ar(e)}function qr(e){return h[e+11|0]>>>7|0}function en(e){s[e>>2]=0,s[e+4>>2]=0}function tn(e,t){Lr(e),_t(e,t),zn(e)}function rn(e){return Wt(s[e+4>>2])}function nn(e,t,r){r&&J(e,t,r)}function an(e){return 4==f[e+18>>1]}function on(e){return 3==f[e+18>>1]}function sn(e){s[e+12>>2]=s[e+8>>2]}function ln(e,t){return s[e>>2]=t,e}function un(e){return s[e>>2]+16|0}function cn(e,t,r){s[t>>2]=s[r>>2]}function dn(e,t){ei(e),Yn(e+4|0,t)}function hn(e){return It(e+24|0),e}function fn(e,t,r){m[t>>3]=m[r>>3]}function pn(e){return s[Wn(e)>>2]}function yn(e){return pr(s[e>>2])}function mn(e){return Sn(s[e>>2])}function gn(e){return Mr(s[e>>2])}function vn(e){return e-48>>>0<10}function bn(e,t,r){Br(e+24|0,t,r)}function _n(e){return Wt(s[e>>2])}function En(e,t){s[e>>2]=s[t>>2]}function Tn(e){Er(e),Ar(e),Er(e)}function Sn(e){return a[s[e>>2]]}function $n(e){return Fr(e+24|0)}function An(e){Ir(e),Or(e),Ir(e)}function wn(e){Cr(e),Lr(e),Cr(e)}function kn(e){return Fr(e+56|0)}function In(e){Or(e),Zn(e),Kn(e)}function Cn(e){Lr(e),Bn(e),zn(e)}function Pn(){V=20800,G=12608}function xn(e){gr(e+24|0),gr(e)}function Rn(e){gr(e+32|0),gr(e)}function On(e,t){return Ze(e,t)}function Ln(e){return 0|(e|=0)}function Dn(e,t){a[e+17|0]=17-t}function Mn(e,t){a[0|e]=h[0|t]}function Nn(e,t,r){J(t,r,48)}function Gn(e,t){Cr(e),Cr(e)}function Vn(e,t){s[e+4>>2]=t}function Un(e,t){a[e+11|0]=t}function Zn(e){bt(e,s[e>>2])}function Bn(e){_t(e,s[e>>2])}function Fn(e){return e+12|0}function jn(e,t){s[e+8>>2]=t}function Wn(e){return e+4|0}function Xn(e){return e+8|0}function Hn(e){j(e|=0)}function Kn(e){Ir(e),Or(e)}function Yn(e,t){s[e>>2]=t}function zn(e){Cr(e),Lr(e)}function Jn(){Fe(1146),$()}function Qn(e){qt(e+24|0)}function qn(e){Rn(e+4|0)}function ei(e){s[e>>2]=0}function ti(e){xn(e+4|0)}function ri(){ni(),$()}function ni(){L(),$()}function ii(e){}i(t=h,1024,"UGFyc2VBcnJheQAtKyAgIDBYMHgALTBYKzBYIDBYLTB4KzB4IDB4AHN0ciAhPSAwIHx8IGxlbiA9PSAwdQBBbGdvcml0aG1CQUJCd2l0aFN0YWxsRXZlbnQAR2V0SW50AGhlaWdodABQYXJzZU9iamVjdABpdGVtcwB2ZWN0b3IAR2V0QWxsb2NhdG9yAFBhcnNlTnVtYmVyAEZpbmRNZW1iZXIAQWxnb3JpdGhtU3RhcnR1cABUb3AAUG9wAHN0YXRlX2luZm8Ac3RkOjpleGNlcHRpb24Adl9hZGFwdGF0aW9uAGFfYWRhcHRhdGlvbgBzZWdtZW50X2R1cmF0aW9uAHNldF9kdXJhdGlvbgBNZW1iZXJCZWdpbgBOb3ROdWxsU3RyTGVuAG5hbgBpdGVtX251bQBQYXJzZVN0cmluZ1RvU3RyZWFtAFBhcnNlU3RyZWFtAFBhcnNlTnVsbABTdHJpbmdFcXVhbABHZXRTdHJpbmdMZW5ndGgAYmFuZHdpZHRoAC4vbGlicy9yYXBpZGpzb24vZG9jdW1lbnQuaAAuL2xpYnMvcmFwaWRqc29uL2VuY29kaW5ncy5oAC4vbGlicy9yYXBpZGpzb24vcmVhZGVyLmgALi9saWJzL3JhcGlkanNvbi9pbnRlcm5hbC9zdGFjay5oAC4vbGlicy9yYXBpZGpzb24vaW50ZXJuYWwvcG93MTAuaABHZXRTdHJpbmcAUGFyc2VTdHJpbmcAZGF0YV8uZi5mbGFncyAmIGtJbnRGbGFnAGluZgBHZW5lcmljU3RyaW5nUmVmAHNldF9zaXplAGNvbnRlbnRfdG90YWxfc2l6ZQBjdXJyZW50X2NvbnRlbnRfZG93bmxvYWRfc2l6ZQBjdXJyZW50X2hlYWRlcl9kb3dubG9hZF9zaXplAGluZGV4IDwgZGF0YV8uYS5zaXplAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUAU2l6ZQBQYXJzZVRydWUAR2VuZXJpY1ZhbHVlAGNvbnRlbnRfZG93bmxvYWRfc3RhdGUAaGVhZGVyX2Rvd25sb2FkX3N0YXRlAHN0cmVhbV9iaXRyYXRlAGZyYW1lX3JhdGUAc2FtcGxlX3JhdGUAUGFyc2UAZmFsc2UAUGFyc2VGYWxzZQBwcmVsb2FkX3R5cGUAbWVkaWFfdHlwZQB0eXBlID49IGtOdWxsVHlwZSAmJiB0eXBlIDw9IGtOdW1iZXJUeXBlAHN0YXJ0X3RpbWUAR2V0RG91YmxlAFB1c2hVbnNhZmUARW5jb2RlAE1lbWJlckVuZABzdHJlYW1faWQAW1NlbGVjdG9yTG9nXSBbJXNdIGNoYW5nZSBxdWFsaXR5IGZyb20gJWQgLT4gJWQAY29kZWMAYWxsb2NhdG9yXwBzdGFja1RvcF8Ab3BlcmF0b3JbXQBOQU4ASU5GAGNvZGVwb2ludCA8PSAweDEwRkZGRgBuID49IDAgJiYgbiA8PSAzMDgAUGFyc2VIZXg0AFBvdzEwAGV4cEZyYWMgPD0gMABzdHIgIT0gMAAoZGF0YV8uZi5mbGFncyAmIGtVaW50NjRGbGFnKSAhPSAwAC4AKG51bGwpAHN0YWNrXy5HZXRTaXplKCkgPT0gc2l6ZW9mKFZhbHVlVHlwZSkAc3RhdGljX2Nhc3Q8c3RkOjpwdHJkaWZmX3Q+KHNpemVvZihUKSAqIGNvdW50KSA8PSAoc3RhY2tFbmRfIC0gc3RhY2tUb3BfKQBHZXRTaXplKCkgPj0gc2l6ZW9mKFQpAEdldFNpemUoKSA+PSBjb3VudCAqIHNpemVvZihUKQBJc0FycmF5KCkASXNPYmplY3QoKQAhSGFzUGFyc2VFcnJvcigpAElzTnVtYmVyKCkAcmhzLklzU3RyaW5nKCkAbmFtZS5Jc1N0cmluZygpAGlzLlBlZWsoKSA9PSAneycAaXMuUGVlaygpID09ICd0JwBpcy5QZWVrKCkgPT0gJ24nAGlzLlBlZWsoKSA9PSAnZicAaXMuUGVlaygpID09ICdbJwBzLlBlZWsoKSA9PSAnXCInACVkIABbU2VsZWN0b3JMb2ddIFN1cHBvcnQgYml0cmF0ZTogAFtTZWxlY3RvckxvZ10gdmlkZW9fc3RyZWFtIHN0cmVhbV9pZDolcyBzZWdtZW50X2R1cmF0aW9uOiVkIGJhbmR3aWR0aDolZCB3aWR0aDolZCBoZWlnaHQ6JWQgZnJhbWVyYXRlOiUuMmYgY29kZWM6JXMKAFtTZWxlY3RvckxvZ10gYXVkaW9fc3RyZWFtIHN0cmVhbV9pZDolcyBzZWdtZW50X2R1cmF0aW9uOiVkIGJhbmR3aWR0aDolZCBzYW1wbGVfcmF0ZTolZCBjb2RlYzolcwoAW1NlbGVjdG9yTG9nXSBQcmVsb2FkIGluZm8gaXM6ICVzCgBbU2VsZWN0b3JMb2ddIE1QRCBpbmZvIGlzOiAlcwoAW1NlbGVjdG9yTG9nXSBbJXNdIHRocmVzaG9sZCBoaWdoOiUuMmxmIGxvdzolLjJsZiBodXJyeTolLjJsZgoAW1NlbGVjdG9yTG9nXSBkZXZpY2VfaW5mbyBzY3JlZW5fd2lkdGg6JWQgc2NyZWVuX2hlaWdodDolZCBkZXZpY2VfcGl4ZWxfcmF0aW86JS4yZiBzY3JlZW5fZnBzOiUuMmYKAFtTZWxlY3RvckxvZ10gWyVzXSBzdGFydHVwX2luZm8gdGltZTolbGx1IGRvd25sb2FkX3NwZWVkOiVsbGQgcHJlZGljdGVkX2JhbmR3aWR0aDolbGxkIGJpdHJhdGU6JWQgY3VycmVudF9iaXRyYXRlOiVkIGJ1ZmZlcl9sZW5ndGg6JS4yZiBwcmVkaWN0ZWRfZXJyb3I6JS4yZiBtYXhfZXJyb3I6JS4yZiBzZWVrX2FjdGlvbjolZCBwbGF5X3Bvc2l0aW9uOiVsbGQgaGFzX3N0YXJ0OiVkIHN0YXJ0dXBfZGVjaXNpb25fY291bnQ6JWQKAFtTZWxlY3RvckxvZ10gdmlkZW9fbWVkaWFfaW5mbyBzZWdtZW50X2R1cmF0aW9uOiVkIGJpdHJhdGU6JWQgd2lkdGg6JWQgaGVpZ2h0OiVkIGJpdHJhdGVfbGV2ZWxzOiVkCgBbU2VsZWN0b3JMb2ddIFtQcmVsb2FkZXJdIG1ldGhvZDolZCBkb3dubG9hZF9zcGVlZDogJWQsIG1lZGlhX2Zvcm1hdDogJWQgcHJlbG9hZF9iaXRyYXRlOiVkIHByZWxvYWRfZHVyYXRpb246JWQgcHJlbG9hZF9zaXplOiVkIGNvbnNpZGVyX3NjcmVlbjolZAoAW1NlbGVjdG9yTG9nXSBbZmluZE1heEJpdHJhdGU0U2NyZWVuXSBTZXQgQUJSIG1heCBiaXRyYXRlIGZvciBzY3JlZW46JWQKAFtTZWxlY3RvckxvZ10gW3NlZWsgYWN0aW9uXSBub3dfY2hlY2tfdGltZTolbGxkIHNlZWtfYWN0aW9uOiVkIGVuYWJsZV9zZWVrX3N0YWJsZV9tb2RlbDolZAoAW1NlbGVjdG9yTG9nXSBQcmVsb2FkIGluZm8gaXRlbV9udW06JWQsIGl0ZW1zX3NpemU6JWQKAFtTZWxlY3RvckxvZ10gW2FkanVzdEJpdHJhdGVdIEFCUiBwcmVkaWN0IGJpdHJhdGU6JWQgYWRqdXN0IG1heCBiaXRyYXRlOiVkIHRvICVkCgBbU2VsZWN0b3JMb2ddIFtQcmVsb2FkZXJdIG1ldGhvZDolZCBkb3dubG9hZF9zcGVlZDogJWQsIG1lZGlhX2Zvcm1hdDogJWQKAFtTZWxlY3RvckxvZ10gW1ByZWxvYWRlcl0gZG93bmxvYWRfc3BlZWQ6ICVkLCBtZWRpYV9mb3JtYXQ6ICVkCgBbU2VsZWN0b3JMb2ddIFN0YXJ0dXAgdXNlIHByZWxvYWQgaXRlbSBhdCBiaXRyYXRlOiAlZAoAW1NlbGVjdG9yTG9nXSBbJXNdIG5vd19jaGVja190aW1lOiVsbGQsIGJ1ZmZlcl9sZW5ndGg6JS4ybGYvJS4yZiwgcGxheV9zcGVlZDolLjJmLCBjdXJyZW50X2JpdHJhdGU6JWQsIHByZWRpY3RfYml0cmF0ZTolZCwgYmFuZHdpZHRoOiVsbGQsIHByZWRpY3RlZF9iYW5kd2lkdGg6JWxsZCwgc2VnbWVudF9kdXJhdGlvbjolZCwgc3RhbGxfY291bnQ6JWQsIHNlZWtfYWN0aW9uOiVkLCBzZWVrX3N0YXlfdGltZTolLjJmLCBwbGF5X3Bvc2l0aW9uOiVsbGQsIGxhc3Rfc2Vla19jaGVja190aW1lOiVsbGQsIHN0YWxsX2V2ZW50OiVkLCBzdGFsbF9ldmVudF9jb3VudDolZC8lZCwgcW9lX3ZhbHVlOiUuMmYgKCUuMmYgJS4yZiAlLjJmKSAoJWQtPiVkKQoAW1NlbGVjdG9yTG9nXSBbRVJST1JdIFByZWxvYWQgaW5mbyBwYXJzZSBlcnJvciEKAFtTZWxlY3RvckxvZ10gW0VSUk9SXSBObyB2X2FkYXB0YXRpb24gaW4gTVBEIQoAW1NlbGVjdG9yTG9nXSBbRVJST1JdIE5vIGFfYWRhcHRhdGlvbiBpbiBNUEQhCgBbU2VsZWN0b3JMb2ddIFtzZWVrIGFjdGlvbl0gbm93X2NoZWNrX3RpbWU6JWxsZCBsYXN0X3NlZWtfY2hlY2tfdGltZTolbGxkIHNlZWtfYWN0aW9uOiVkIGhhbmcgdXAhISEhCgBbU2VsZWN0b3JMb2ddIFtFUlJPUl0gUHJlbG9hZCBpbmZvIGl0ZW1zIGVycm9yICEhIQoAW1NlbGVjdG9yTG9nXSBbRVJST1JdIFByZWxvYWQgaW5mbyBzdGF0ZSBlcnJvciAhISEKAFtTZWxlY3RvckxvZ10gW0VSUk9SXSB2X2FkYXB0YXRpb24gcGFyc2UgZXJyb3IgISEhCgBbU2VsZWN0b3JMb2ddIFtFUlJPUl0gYV9hZGFwdGF0aW9uIHBhcnNlIGVycm9yICEhIQoAW1NlbGVjdG9yTG9nXSBtT3BlbmVkVGltZTogJWxsZCwgbU1ldGhvZDogJWQsIG1CdWZmZXI6ICUuMmxmLyUuMmYgbURvd25sb2FkU3BlZWQ6JWxsZCAK"),i(t,5058,"Ig=="),i(t,5071,"Lw=="),i(t,5116,"XAAAAAAACAAAAAwAAAAAAAAACgAAAA0ACQ=="),i(t,5284,"CQAKAAMABAAFHPYDAAAAAAAA8D8AAAAAAAAkQAAAAAAAAFlAAAAAAABAj0AAAAAAAIjDQAAAAAAAavhAAAAAAICELkEAAAAA0BJjQQAAAACE15dBAAAAAGXNzUEAAAAgX6ACQgAAAOh2SDdCAAAAopQabUIAAEDlnDCiQgAAkB7EvNZCAAA0JvVrDEMAgOA3ecNBQwCg2IVXNHZDAMhOZ23Bq0MAPZFg5FjhQ0CMtXgdrxVEUO/i1uQaS0SS1U0Gz/CARPZK4ccCLbVEtJ3ZeUN46kSRAigsKosgRTUDMrf0rVRFAoT+5HHZiUWBEh8v5yfARSHX5vrgMfRF6oygOVk+KUYksAiI741fRhduBbW1uJNGnMlGIuOmyEYDfNjqm9D+RoJNx3JhQjNH4yB5z/kSaEcbaVdDuBeeR7GhFirTztJHHUqc9IeCB0ilXMPxKWM9SOcZGjf6XXJIYaDgxHj1pkh5yBj21rLcSEx9z1nG7xFJnlxD8LdrRknGM1TspQZ8SVygtLMnhLFJc8ihoDHl5UmPOsoIfl4bSppkfsUOG1FKwP3ddtJhhUowfZUUR7q6Sj5u3WxstPBKzskUiIfhJEtB/Blq6RlaS6k9UOIxUJBLE03kWj5kxEtXYJ3xTX35S224BG6h3C9MRPPC5OTpY0wVsPMdXuSYTBuccKV1Hc9MkWFmh2lyA031+T/pA084TXL4j+PEYm5NR/s5Drv9ok0ZesjRKb3XTZ+YOkZ0rA1OZJ/kq8iLQk49x93Wui53Tgw5lYxp+qxOp0Pd94Ec4k6RlNR1oqMWT7W5SROLTExPERQO7NavgU8WmRGnzBu2T1v/1dC/outPmb+F4rdFIVB/LyfbJZdVUF/78FHv/IpQG502kxXewFBiRAT4mhX1UHtVBbYBWypRbVXDEeF4YFHIKjRWGZeUUXo1wavfvMlRbMFYywsWAFLH8S6+jhs0Ujmuum1yImlSx1kpCQ9rn1Id2Lll6aLTUiROKL+jiwhTrWHyroyuPlMMfVftFy1zU09crehd+KdTY7PYYnX23VMecMddCboSVCVMObWLaEdULp+Hoq5CfVR9w5QlrUmyVFz0+W4Y3OZUc3G4ih6THFXoRrMW89tRVaIYYNzvUoZVyh5406vnu1U/Eytky3DxVQ7YNT3+zCVWEk6DzD1AW1bLENKfJgiRVv6UxkcwSsVWPTq4Wbyc+lZmJBO49aEwV4DtFyZzymRX4Oid7w/9mVeMscL1KT7QV+9dM3O0TQRYazUAkCFhOVjFQgD0ablvWLspgDji06NYKjSgxtrI2Fg1QUh4EfsOWcEoLevqXENZ8XL4pSU0eFmtj3YPL0GuWcwZqmm96OJZP6AUxOyiF1pPyBn1p4tNWjIdMPlId4JafiR8NxsVt1qeLVsFYtrsWoL8WEN9CCJbozsvlJyKVluMCju5Qy2MW5fmxFNKnMFbPSC26FwD9ltNqOMiNIQrXDBJzpWgMmFcfNtBu0h/lVxbUhLqGt/KXHlzS9JwywBdV1DeBk3+NF1t5JVI4D1qXcSuXS2sZqBddRq1OFeA1F0SYeIGbaAJXqt8TSREBEBe1ttgLVUFdF7MErl4qgapXn9X5xZVSN9er5ZQLjWNE19bvOR5gnBIX3LrXRijjH5fJ7M67+UXs1/xXwlr393nX+23y0VX1R1g9FKfi1alUmCxJ4curE6HYJ3xKDpXIr1gApdZhHY18mDD/G8l1MImYfT7yy6Jc1xheH0/vTXIkWHWXI8sQzrGYQw0s/fTyPthhwDQeoRdMWKpAISZ5bRlYtQA5f8eIptihCDvX1P10GKl6Oo3qDIFY8+i5UVSfzpjwYWva5OPcGMyZ5tGeLOkY/5AQlhW4Nljn2gp9zUsEGTGwvN0QzdEZHizMFIURXlkVuC8ZlmWr2Q2DDbg973jZEOPQ9h1rRhlFHNUTtPYTmXsx/QQhEeDZej5MRVlGbhlYXh+Wr4f7mU9C4/41tMiZgzOsrbMiFdmj4Ff5P9qjWb5sLvu32LCZjidauqX+/ZmhkQF5X26LGfUSiOvjvRhZ4kd7FqycZZn6ySn8R4OzGcTdwhX04gBaNeUyiwI6zVoDTr9N8pla2hIRP5inh+haFrVvfuFZ9VosUqtemfBCmmvTqys4LhAaVpi19cY53Rp8TrNDd8gqmnWRKBoi1TgaQxWyEKuaRRqj2t60xmESWpzBllIIOV/agikNy0077NqCo2FOAHr6GpM8KaGwSUfazBWKPSYd1Nru2syMX9ViGuqBn/93mq+aypkb17LAvNrNT0LNn7DJ2yCDI7DXbRdbNHHOJq6kJJsxvnGQOk0x2w3uPiQIwL9bCNzmzpWITJt609CyaupZm3m45K7FlScbXDOOzWOtNFtDMKKwrEhBm6Pci0zHqo7bpln/N9SSnFuf4H7l+ecpW7fYfp9IQTbbix9vO6U4hBvdpxrKjobRW+Ugwa1CGJ6bz0SJHFFfbBvzBZtzZac5G9/XMiAvMMZcM85fdBVGlBwQ4icROsghHBUqsMVJim5cOmUNJtvc+9wEd0AwSWoI3FWFEExL5JYcWtZkf26to5x49d63jQyw3HcjRkWwv73cVPxn5ty/i1y1PZDoQe/YnKJ9JSJyW6Xcqsx+ut7Ss1yC198c41OAnPNdlvQMOI2c4FUcgS9mmxz0HTHIrbgoXMEUnmr41jWc4amV5Yc7wt0FMj23XF1QXQYenRVztJ1dJ6Y0eqBR6t0Y//CMrEM4XQ8v3N/3U8VdQuvUN/Uo0p1Z22SC2WmgHXACHdO/s+0dfHKFOL9A+p11v5MrX5CIHaMPqBYHlNUdi9OyO7lZ4l2u2F6at/Bv3YVfYyiK9nzdlqcL4t2zyh3cIP7LVQDX3cmMr2cFGKTd7B+7MOZOsh3XJ7nNEBJ/nf5whAhyO0yeLjzVCk6qWd4pTCqs4iTnXhnXkpwNXzSeAH2XMxCGwd5gjN0fxPiPHkxoKgvTA1yeT3IkjufkKZ5TXp3Csc03HlwrIpm/KAReoxXLYA7CUZ6b604YIqLe3plbCN8Njexen9HLBsEheV6Xln3IUXmGnvblzo1689Qe9I9iQLmA4V7Ro0rg99EuntMOPuxC2vwe18Gep7OhSR89ocYRkKnWXz6VM9riQiQfDgqw8arCsR8x/RzuFYN+Xz48ZBmrFAvfTuXGsBrkmN9Cj0hsAZ3mH1MjClcyJTOfbD3mTn9HAN+nHUAiDzkN34DkwCqS91tfuJbQEpPqqJ+2nLQHONU136QjwTkGyoNf7rZgm5ROkJ/KZAjyuXIdn8zdKw8H3usf6DI64XzzOF/AAAAAAAAAAAZAAoAGRkZAAAAAAUAAAAAAAAJAAAAAAsAAAAAAAAAABkAEQoZGRkDCgcAAQAJCxgAAAkGCwAACwAGGQAAABkZGQ=="),i(t,7857,"DgAAAAAAAAAAGQAKDRkZGQANAAACAAkOAAAACQAOAAAO"),i(t,7915,"DA=="),i(t,7927,"EwAAAAATAAAAAAkMAAAAAAAMAAAM"),i(t,7973,"EA=="),i(t,7985,"DwAAAAQPAAAAAAkQAAAAAAAQAAAQ"),i(t,8031,"Eg=="),i(t,8043,"EQAAAAARAAAAAAkSAAAAAAASAAASAAAaAAAAGhoa"),i(t,8098,"GgAAABoaGgAAAAAAAAk="),i(t,8147,"FA=="),i(t,8159,"FwAAAAAXAAAAAAkUAAAAAAAUAAAU"),i(t,8205,"Fg=="),i(t,8217,"FQAAAAAVAAAAAAkWAAAAAAAWAAAWAAAwMTIzNDU2Nzg5QUJDREVGTjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAAAA0CAAAEAgAADEIQAATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAAAA0CAAAHAgAABkIAAAAAAAAJQgAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAAAAAAAAYIQAADAAAABQAAAAOAAAADwAAABAAAAAVAAAAFgAAABcAAABOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UAAAAA0CAAAPAgAACUIAAAAAAAAEghAAAYAAAAGQAAABoAAABTdDlleGNlcHRpb24AAAAAqCAAADghAAAAAAAAdCEAAAIAAAAbAAAAHAAAAFN0MTFsb2dpY19lcnJvcgDQIAAAZCEAAEghAAAAAAAAqCEAAAIAAAAdAAAAHAAAAFN0MTJsZW5ndGhfZXJyb3IAAAAA0CAAAJQhAAB0IQAAU3Q5dHlwZV9pbmZvAAAAAKggAAC0IQ=="),i(t,8656,"BQ=="),i(t,8668,"BA=="),i(t,8692,"BQAAAAYAAAB4JgAAAAQ="),i(t,8716,"AQ=="),i(t,8732,"/////wo="),i(t,8800,"0CEAAEBRAAAJ"),i(t,8820,"CQ=="),i(t,8840,"CgAAAAAAAAALAAAAKC0AAAAE"),i(t,8884,"/////w=="),i(t,8952,"aCIAAAAAAAAF"),i(t,8972,"CQ=="),i(t,8996,"BQAAAAsAAAAwMQ=="),i(t,9020,"Ag=="),i(t,9036,"//////////8="),i(t,9105,"Iw==");var ai,oi=((ai=[null,function(e){e|=0,Cn(9528),Cn(9540),In(9552),In(9728),In(9752),In(9764),In(9740),Tn(9800),s[2450]&&(ht(9800),e=s[2450],Er(9800),j(e)),qt(9776),Qt(9764),Qt(9752),Qt(9740),Qt(9728),qt(9716),qt(9696),qt(9684),qt(9672),Jt(9652,pn(9652)),jt(9640,pn(9640)),Qn(9568),Qt(9552),qt(9540),qt(9528)},Et,Fr,function(e){return 0},function(e,t,r){t|=0,r|=0;var n,i=0,a=0,o=0,l=0,u=0,c=0;N=n=N-32|0,i=s[28+(e|=0)>>2],s[n+16>>2]=i,a=s[e+20>>2],s[n+28>>2]=r,s[n+24>>2]=t,t=a-i|0,s[n+20>>2]=t,i=t+r|0,c=2;e:{t:{t=n+16|0;r:{if(!Sr(0|P(s[e+60>>2],0|t,2,n+12|0)))for(;;){if((0|(a=s[n+12>>2]))==(0|i))break r;if((0|a)<0)break t;if(o=a-((l=(o=s[t+4>>2])>>>0<a>>>0)?o:0)|0,s[(u=(l<<3)+t|0)>>2]=o+s[u>>2],s[(u=(l?12:4)+t|0)>>2]=s[u>>2]-o,i=i-a|0,t=l?t+8|0:t,c=c-l|0,Sr(0|P(s[e+60>>2],0|t,0|c,n+12|0)))break}if(-1!=(0|i))break t}t=s[e+44>>2],s[e+28>>2]=t,s[e+20>>2]=t,s[e+16>>2]=t+s[e+48>>2],e=r;break e}s[e+28>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e>>2]=32|s[e>>2],e=0,2!=(0|c)&&(e=r-s[t+4>>2]|0)}return N=n+32|0,0|e},function(e,t,r,n){return U=0,0},function(e,t,r,n,i,o){e|=0,t=+t,r|=0,n|=0,i|=0,o|=0;var u,c=0,f=0,p=0,y=0,m=0,v=0,_=0,E=0,T=0,S=0,$=0,A=0,w=0,k=0,I=0,C=0,P=0,x=0;N=u=N-560|0,s[u+44>>2]=0,d(+t),c=0|l(1),l(0),(0|c)<0?(A=1,I=1045,d(+(t=-t)),c=0|l(1),l(0)):2048&i?(A=1,I=1048):(I=(A=1&i)?1051:1046,x=!A);e:if(2146435072!=(2146435072&c)){k=u+16|0;t:{r:{n:{if(t=Re(t,u+44|0),0!=(t+=t)){if(c=s[u+44>>2],s[u+44>>2]=c-1,97!=(0|($=32|o)))break n;break t}if(97==(0|($=32|o)))break t;m=s[u+44>>2],v=(0|n)<0?6:n;break r}m=c-29|0,s[u+44>>2]=m,t*=268435456,v=(0|n)<0?6:n}for(f=T=(0|m)<0?u+48|0:u+336|0;n=t<4294967296&t>=0?~~t>>>0:0,s[f>>2]=n,f=f+4|0,0!=(t=1e9*(t-+(n>>>0))););if((0|m)<=0)n=m,c=f,y=T;else for(y=T,n=m;;){if(n=(0|n)<29?n:29,!(y>>>0>(c=f-4|0)>>>0)){for(p=0;E=s[c>>2],_=31&n,C=p,(63&n)>>>0>=32?(p=E<<_,E=0):(p=(1<<_)-1&E>>>32-_,E<<=_),p=p+P|0,E=Ne(p=Q(_=C+E|0,p=_>>>0<E>>>0?p+1|0:p,1e9),U,1e9,0),s[c>>2]=_-E,y>>>0<=(c=c-4|0)>>>0;);p&&(s[(y=y-4|0)>>2]=p)}for(;y>>>0<(c=f)>>>0&&!s[(f=c-4|0)>>2];);if(n=s[u+44>>2]-n|0,s[u+44>>2]=n,f=c,!((0|n)>0))break}if((0|n)<0)for(w=1+((v+25>>>0)/9|0)|0,_=102==(0|$);;){if(p=(0|(n=0-n|0))<9?n:9,c>>>0<=y>>>0)f=s[y>>2];else{for(E=1e9>>>p|0,P=-1<<p^-1,n=0,f=y;C=n,n=s[f>>2],s[f>>2]=C+(n>>>p|0),n=g(E,n&P),(f=f+4|0)>>>0<c>>>0;);f=s[y>>2],n&&(s[c>>2]=n,c=c+4|0)}if(n=p+s[u+44>>2]|0,s[u+44>>2]=n,y=(!f<<2)+y|0,c=c-(f=_?T:y)>>2>(0|w)?f+(w<<2)|0:c,!((0|n)<0))break}if(n=0,!(c>>>0<=y>>>0||(n=g(T-y>>2,9),f=10,(p=s[y>>2])>>>0<10)))for(;n=n+1|0,p>>>0>=(f=g(f,10))>>>0;);if((0|(f=(v-(102==(0|$)?0:n)|0)-(103==(0|$)&0!=(0|v))|0))<(g(c-T>>2,9)-9|0)){if(m=((((0|m)<0?4:292)+u|0)+((_=(0|(p=f+9216|0))/9|0)<<2)|0)-4048|0,f=10,(0|(p=p-g(_,9)|0))<=7)for(;f=g(f,10),8!=(0|(p=p+1|0)););if(!(!(p=(_=s[m>>2])-g(f,w=(_>>>0)/(f>>>0)|0)|0)&(0|(E=m+4|0))==(0|c))&&(!(1&w)&&(t=9007199254740992,!(1&a[m-4|0])|1e9!=(0|f)|y>>>0>=m>>>0)||(t=9007199254740994),S=(0|c)==(0|E)?1:1.5,S=p>>>0<(E=f>>>1|0)>>>0?.5:(0|E)==(0|p)?S:1.5,45!=h[0|I]|x||(S=-S,t=-t),p=_-p|0,s[m>>2]=p,t+S!=t)){if(n=f+p|0,s[m>>2]=n,n>>>0>=1e9)for(;s[m>>2]=0,(m=m-4|0)>>>0<y>>>0&&(s[(y=y-4|0)>>2]=0),n=s[m>>2]+1|0,s[m>>2]=n,n>>>0>999999999;);if(n=g(T-y>>2,9),f=10,!((p=s[y>>2])>>>0<10))for(;n=n+1|0,p>>>0>=(f=g(f,10))>>>0;);}c=c>>>0>(f=m+4|0)>>>0?f:c}for(;f=c,!(p=c>>>0<=y>>>0)&&!s[(c=f-4|0)>>2];);if(103==(0|$)){if(v=((m=(0|(c=v||1))>(0|n)&(0|n)>-5)?-1^n:-1)+c|0,o=(m?-1:-2)+o|0,!(m=8&i)){if(c=-9,!p&&(_=s[f-4>>2])&&(p=10,c=0,!((_>>>0)%10|0))){for(;m=c,c=c+1|0,!((_>>>0)%((p=g(p,10))>>>0)|0););c=-1^m}p=g(f-T>>2,9),70!=(-33&o)?(m=0,v=(0|(c=(0|(c=((n+p|0)+c|0)-9|0))>0?c:0))>(0|v)?v:c):(m=0,v=(0|(c=(0|(c=(c+p|0)-9|0))>0?c:0))>(0|v)?v:c)}}else m=8&i;if(p=-1,(0|(($=m|v)?2147483645:2147483646))<(0|v))break e;if(_=1+((0!=(0|$))+v|0)|0,70!=(0|(E=-33&o))){if((k-(c=Ie(((c=n>>31)^n)-c|0,0,k))|0)<=1)for(;a[0|(c=c-1|0)]=48,(k-c|0)<2;);if(a[0|(w=c-2|0)]=o,a[c-1|0]=(0|n)<0?45:43,(0|(c=k-w|0))>(2147483647-_|0))break e}else{if((2147483647-_|0)<(0|n))break e;c=(0|n)>0?n:0}if((0|(n=c+_|0))>(2147483647^A))break e;Be(e,32,r,o=n+A|0,i),fe(e,I,A),Be(e,48,r,o,65536^i);r:{n:{i:{if(70==(0|E)){for(n=8|(c=u+16|0),m=9|c,y=p=y>>>0>T>>>0?T:y;;){c=Ie(s[y>>2],0,m);a:if((0|p)==(0|y))(0|c)==(0|m)&&(a[u+24|0]=48,c=n);else{if(u+16>>>0>=c>>>0)break a;for(;a[0|(c=c-1|0)]=48,u+16>>>0<c>>>0;);}if(fe(e,c,m-c|0),!(T>>>0>=(y=y+4|0)>>>0))break}if($&&fe(e,2276,1),(0|v)<=0|f>>>0<=y>>>0)break i;for(;;){if((c=Ie(s[y>>2],0,m))>>>0>u+16>>>0)for(;a[0|(c=c-1|0)]=48,u+16>>>0<c>>>0;);if(fe(e,c,(0|v)<9?v:9),c=v-9|0,f>>>0<=(y=y+4|0)>>>0)break n;if(n=(0|v)>9,v=c,!n)break}break n}a:if(!((0|v)<0))for(p=f>>>0>y>>>0?f:y+4|0,n=8|(c=u+16|0),T=9|c,f=y;;){(0|T)==(0|(c=Ie(s[f>>2],0,T)))&&(a[u+24|0]=48,c=n);o:if((0|f)==(0|y))fe(e,c,1),c=c+1|0,m|v&&fe(e,2276,1);else{if(u+16>>>0>=c>>>0)break o;for(;a[0|(c=c-1|0)]=48,u+16>>>0<c>>>0;);}if(fe(e,C=c,(0|(c=T-c|0))>(0|v)?v:c),v=v-c|0,p>>>0<=(f=f+4|0)>>>0)break a;if(!((0|v)>=0))break}Be(e,48,v+18|0,18,0),fe(e,w,k-w|0);break r}c=v}Be(e,48,c+9|0,9,0)}Be(e,32,r,o,8192^i),p=(0|r)<(0|o)?o:r;break e}if(v=(o<<26>>31&9)+I|0,!(n>>>0>11)){for(c=12-n|0,S=16;S*=16,c=c-1|0;);t=45!=h[0|v]?t+S-S:-(S+(-t-S))}for((0|k)==(0|(c=Ie(((c=(f=s[u+44>>2])>>31)^f)-c|0,0,k)))&&(a[u+15|0]=48,c=u+15|0),m=2|A,y=32&o,f=s[u+44>>2],a[0|(T=c-2|0)]=o+15,a[c-1|0]=(0|f)<0?45:43,p=8&i,f=u+16|0;o=f,c=b(t)<2147483648?~~t:-2147483648,a[0|f]=y|h[c+8240|0],!(p|(0|n)>0)&0==(t=16*(t-+(0|c)))|1!=((f=o+1|0)-(u+16|0)|0)||(a[o+1|0]=46,f=o+2|0),0!=t;);p=-1,(2147483645-(o=(_=k-T|0)+m|0)|0)<(0|n)||(Be(e,32,r,n=(c=!n||((y=f-(u+16|0)|0)-2|0)>=(0|n)?y=f-(u+16|0)|0:n+2|0)+o|0,i),fe(e,v,m),Be(e,48,r,n,65536^i),fe(e,u+16|0,y),Be(e,48,c-y|0,0,0),fe(e,T,_),Be(e,32,r,n,8192^i),p=(0|r)<(0|n)?n:r)}else Be(e,32,r,n=A+3|0,-65537&i),fe(e,I,A),o&=32,fe(e,t!=t?o?1322:2154:o?1613:2158,3),Be(e,32,r,n,8192^i),p=(0|r)<(0|n)?n:r;return N=u+560|0,0|p},function(e,t){e|=0;var r,n,i,a,o,l=0,d=0,h=0,f=0,p=0,y=0,g=0,v=0,b=0,_=0,E=0;d=t|=0,t=s[t>>2]+7&-8,s[d>>2]=t+16,i=e,v=s[(e=t)>>2],t=s[e+4>>2],n=h=s[e+12>>2],N=r=N-32|0;e:if((0|(l=(h&=2147483647)-1006698496|0))==(0|(f=h-1140785152|0))&(d=s[e+8>>2])>>>0<d>>>0|l>>>0<f>>>0){if(l=(e=d)<<4|t>>>28,h=d=n<<4|e>>>28,t=e=268435455&t,134217728==(0|e)&0!=(0|v)|e>>>0>134217728){e=h+1073741824|0,e=(t=l+1|0)?e:e+1|0,l=t;break e}if(e=h+1073741824|0,134217728^t|v)break e;e=(t=1&l)>>>0>(l=h=t+l|0)>>>0?e+1|0:e}else(!d&2147418112==(0|h)?!(t|v):h>>>0<2147418112)?(l=0,e=2146435072,h>>>0>1140785151||(e=0,(_=h>>>16|0)>>>0<15249||(l=v,e=t,h=f=65535&n|65536,b=d,p=d,64&(g=_-15233|0)?(f=l,l=31&(d=g+-64|0),(63&d)>>>0>=32?(e=f<<l,p=0):(e=(1<<l)-1&f>>>32-l|e<<l,p=f<<l),f=e,l=0,e=0):g&&(y=31&(d=g),(63&d)>>>0>=32?(d=p<<y,p=0):(d=(1<<y)-1&p>>>32-y|f<<y,p<<=y),f=d,E=p,p=l,y=31&(d=64-g|0),(63&d)>>>0>=32?(d=0,p=e>>>y|0):(d=e>>>y|0,p=((1<<y)-1&e)<<32-y|p>>>y),p|=E,f|=d,y=31&g,(63&g)>>>0>=32?(d=l<<y,l=0):(d=(1<<y)-1&l>>>32-y|e<<y,l<<=y),e=d),s[r+16>>2]=l,s[r+20>>2]=e,s[r+24>>2]=p,s[r+28>>2]=f,64&(d=15361-_|0)?(t=b,f=31&(e=d+-64|0),(63&e)>>>0>=32?(d=0,v=h>>>f|0):(d=h>>>f|0,v=((1<<f)-1&h)<<32-f|t>>>f),t=d,b=0,h=0):d&&(f=b,l=31&(e=64-d|0),(63&e)>>>0>=32?(e=f<<l,l=0):(e=(1<<l)-1&f>>>32-l|h<<l,l=f<<l),f=e,p=l,l=v,g=31&(e=d),(63&e)>>>0>=32?(d=0,t=t>>>g|0):(d=t>>>g|0,t=((1<<g)-1&t)<<32-g|l>>>g),v=p|t,t=d|f,d=b,f=31&e,(63&e)>>>0>=32?(e=0,b=h>>>f|0):(e=h>>>f|0,b=((1<<f)-1&h)<<32-f|d>>>f),h=e),s[r>>2]=v,s[r+4>>2]=t,s[r+8>>2]=b,s[r+12>>2]=h,l=(t=s[r+8>>2])<<4|(h=s[r+4>>2])>>>28,e=s[r+12>>2]<<4|t>>>28,134217728==(0|(h&=268435455))&0!=(0|(t=s[r>>2]|0!=(s[r+16>>2]|s[r+24>>2]|s[r+20>>2]|s[r+28>>2])))|h>>>0>134217728?(e=(t=l+1|0)?e:e+1|0,l=t):134217728^h|t||(e=(t=l+(1&l)|0)>>>0<l>>>0?e+1|0:e,l=t)))):(l=(e=d)<<4|t>>>28,e=524287&(d=n<<4|e>>>28)|2146959360);N=r+32|0,u(0,0|l),u(1,-2147483648&n|e),a=i,o=+c(),m[a>>3]=o},function(e){return 0|O(s[60+(e|=0)>>2])},function(e,t,r){e|=0,t|=0,r|=0;var n,i=0,o=0,l=0;N=n=N-32|0,s[n+16>>2]=t,i=s[e+48>>2],s[n+20>>2]=r-(0!=(0|i)),l=s[e+44>>2],s[n+28>>2]=i,s[n+24>>2]=l;e:{t:{if(Sr(0|R(s[e+60>>2],n+16|0,2,n+12|0)))t=32;else{if((0|(i=s[n+12>>2]))>0)break t;t=i?32:16}s[e>>2]=t|s[e>>2];break e}(l=s[n+20>>2])>>>0>=i>>>0?o=i:(o=s[e+44>>2],s[e+4>>2]=o,s[e+8>>2]=o+(i-l|0),s[e+48>>2]&&(s[e+4>>2]=o+1,a[(t+r|0)-1|0]=h[0|o]),o=r)}return N=n+32|0,0|o},function(e,t,r,n){var i;return t|=0,r|=0,n|=0,N=i=N-16|0,e=Sr(0|M(s[60+(e|=0)>>2],0|t,0|r,255&n,i+8|0)),N=i+16|0,U=e?-1:s[i+12>>2],0|(e?-1:s[i+8>>2])},Ln,Hn,ii,ii,function(e,t,r){r|=0;var n,i=0,a=0,o=0,l=0;if(N=n=N+-64|0,i=1,!Ae(e|=0,t|=0,0)&&(i=0,t)){N=i=N+-64|0,a=s[t>>2],o=s[a-4>>2],l=s[a-8>>2],s[i+20>>2]=0,s[i+16>>2]=8292,s[i+12>>2]=t,s[i+8>>2]=8340,a=0,ne(i+24|0,0,39),t=t+l|0;e:if(Ae(o,8340,0))s[i+56>>2]=1,oi[s[s[o>>2]+20>>2]](o,i+8|0,t,t,1,0),a=1==s[i+32>>2]?t:0;else{oi[s[s[o>>2]+24>>2]](o,i+8|0,t,1,0);t:switch(s[i+44>>2]){case 0:a=1==s[i+48>>2]&&1==s[i+36>>2]&&1==s[i+40>>2]?s[i+28>>2]:0;break e;case 1:break t;default:break e}1!=s[i+32>>2]&&s[i+48>>2]|1!=s[i+36>>2]|1!=s[i+40>>2]||(a=s[i+24>>2])}N=i- -64|0,i=0,a&&(ne(4|(t=n+8|0),0,52),s[n+56>>2]=1,s[n+20>>2]=-1,s[n+16>>2]=e,s[n+8>>2]=a,oi[s[s[a>>2]+28>>2]](a,t,s[r>>2],1),1==(0|(e=s[n+32>>2]))&&(s[r>>2]=s[n+24>>2]),i=1==(0|e))}return N=n- -64|0,0|i},function(e,t,r,n,i,a){r|=0,n|=0,i|=0,a|=0,Ae(e|=0,s[8+(t|=0)>>2],a)&&ve(t,r,n,i)},function(e,t,r,n,i){if(r|=0,n|=0,i|=0,Ae(e|=0,s[8+(t|=0)>>2],i))sr(t,r,n);else e:if(Ae(e,s[t>>2],i)){if(!(s[t+16>>2]!=(0|r)&s[t+20>>2]!=(0|r))){if(1!=(0|n))break e;return void(s[t+32>>2]=1)}s[t+20>>2]=r,s[t+32>>2]=n,s[t+40>>2]=s[t+40>>2]+1,1!=s[t+36>>2]|2!=s[t+24>>2]||(a[t+54|0]=1),s[t+44>>2]=4}},function(e,t,r,n){r|=0,n|=0,Ae(e|=0,s[8+(t|=0)>>2],0)&&Ge(t,r,n)},Hn,function(e,t,r,n,i,a){r|=0,n|=0,i|=0,a|=0,Ae(e|=0,s[8+(t|=0)>>2],a)?ve(t,r,n,i):(e=s[e+8>>2],oi[s[s[e>>2]+20>>2]](e,t,r,n,i,a))},function(e,t,r,n,i){if(r|=0,n|=0,i|=0,Ae(e|=0,s[8+(t|=0)>>2],i))sr(t,r,n);else e:{if(Ae(e,s[t>>2],i)){if(!(s[t+16>>2]!=(0|r)&s[t+20>>2]!=(0|r))){if(1!=(0|n))break e;return void(s[t+32>>2]=1)}s[t+32>>2]=n;t:if(4!=s[t+44>>2]){if(o[t+52>>1]=0,e=s[e+8>>2],oi[s[s[e>>2]+20>>2]](e,t,r,r,1,i),h[t+53|0]){if(s[t+44>>2]=3,!h[t+52|0])break t;break e}s[t+44>>2]=4}if(s[t+20>>2]=r,s[t+40>>2]=s[t+40>>2]+1,1!=s[t+36>>2]|2!=s[t+24>>2])break e;return void(a[t+54|0]=1)}e=s[e+8>>2],oi[s[s[e>>2]+24>>2]](e,t,r,n,i)}},function(e,t,r,n){r|=0,n|=0,Ae(e|=0,s[8+(t|=0)>>2],0)?Ge(t,r,n):(e=s[e+8>>2],oi[s[s[e>>2]+28>>2]](e,t,r,n))},Ln,Hn,function(e){return 1225},function(e){j(Et(e|=0))},function(e){return s[4+(e|=0)>>2]},function(e){Et(e|=0),j(e)}]).set=function(e,t){this[e]=t},ai.get=function(e){return this[e]},ai);function si(){return n.byteLength/65536|0}return{__wasm_call_ctors:function(){Pn(),s[2757]=10916,s[2739]=42},malloc:Z,parseMPD:function(e){e|=0;var t,r,n,i=0,o=0,l=0,u=0,c=0,d=0,g=0,_=0,E=0,T=0,S=0,A=0,k=0,I=0,C=0,P=0,x=v(0),R=0,O=0;r=X(),N=t=N-240|0,wt(c=r+520|0),At(n=r+532|0),T=e,s[t+112>>2]=e,se(r,2919,t+112|0);e:if(!kn(z(S=Ue(t+176|0),e))&&_e(S,1240)){if(an(E=Ze(S,1240))){if(cr(E))for(A=t+160|0,C=t+148|0;;){if(!(_e(e=ut(E,_),2058)&&_e(e,1266)&&_e(e,1405)&&_e(e,1898)&&_e(e,1409)&&_e(e,1121)&&_e(e,2116))){se(r,4820,0);break e}o=Xr(i=t+128|0),xe(i,xt(On(e,2058))),g=+(0|Kt(On(e,1266)))/1e3,i=b(g)<2147483648?~~g:-2147483648,s[t+152>>2]=i,R=t,O=Kt(On(e,1405)),s[R+148>>2]=O,R=t,O=Kt(On(e,1409)),s[R+140>>2]=O,R=t,O=Kt(On(e,1121)),s[R+144>>2]=O;t:{r:{if(i=On(e,1898),(16&h[i+18|0])>>>4|0){if(512&(l=f[i+18>>1])){g=m[i>>3];break t}if(32&l){g=+s[i>>2];break t}if(64&l){g=+p[i>>2];break t}if(128&l){g=+p[i>>2]+4294967296*+s[i+4>>2];break t}if(!(256&l))break r;g=+p[i>>2]+4294967296*+p[i+4>>2];break t}w(2489,1415,1825,2020),$()}w(2241,1415,1830,2020),$()}if(y[t+156>>2]=g,xe(A,xt(On(e,2116))),N=d=N-32|0,R=d,O=Xt(C),s[R+16>>2]=O,N=e=N-32|0,k=Te(c,e+28|0,C),i=s[k>>2],a[e+27|0]=0,i||(N=u=N-16|0,i=Wn(c),P=mt(l=e+8|0,vt(64),wr(u+8|0,i)),I=s[P>>2]+16|0,N=i=N-16|0,s[i+8>>2]=s[d+16>>2],s[I>>2]=s[s[i+8>>2]>>2],Xr(ne(I+4|0,0,44)),N=i+16|0,R=Wn(P),O=1,a[R+4|0]=O,N=u+16|0,ae(c,s[e+28>>2],k,s[l>>2]),i=br(l),a[e+27|0]=1,u=s[l>>2],s[l>>2]=0,u&&(h[Wn(l)+4|0]&&qn(u+16|0),u&&j(u))),_r(l=d+24|0,ln(e+8|0,i),e+27|0),N=e+32|0,e=un(l),N=d+32|0,le(e=e+4|0,o),s[e+28>>2]=s[o+28>>2],i=s[o+24>>2],s[e+20>>2]=s[o+20>>2],s[e+24>>2]=i,i=s[o+16>>2],s[e+12>>2]=s[o+12>>2],s[e+16>>2]=i,le(e+32|0,o+32|0),e=$r(t+128|0),i=s[t+152>>2],l=s[t+148>>2],d=s[t+140>>2],u=s[t+144>>2],x=y[t+156>>2],R=t,O=$r(A),s[R+96>>2]=O,m[t+88>>3]=x,s[t+80>>2]=u,s[t+76>>2]=d,s[t+72>>2]=l,s[t+68>>2]=i,s[t+64>>2]=e,se(r,2669,t- -64|0),Rn(o),_=_+1|0,!(cr(E)>>>0>_>>>0))break}if(s[r+548>>2]=5,Cn(l=r+576|0),s[r+544>>2]=0,Cn(d=r+552|0),Cn(u=r+564|0),N=o=(N=e=N-16|0)-16|0,i=s[ln(o+8|0,s[c>>2])>>2],N=o+16|0,o=s[ln(e+8|0,i)>>2],N=e+16|0,s[(i=t+128|0)>>2]=o,R=t,O=yt(c),s[R+120>>2]=O,Yr(i,t+120|0))for(;;){if(R=r,O=s[un(i)+28>>2],s[R+548>>2]=O,ie(l,un(i)+24|0),s[r+544>>2]=s[r+544>>2]+1,ie(d,un(i)+16|0),ie(u,un(i)+20|0),e=s[r+548>>2],o=s[un(i)+24>>2],_=s[un(i)+16>>2],E=s[un(i)+20>>2],s[t+48>>2]=s[r+544>>2],s[t+44>>2]=E,s[t+40>>2]=_,s[t+36>>2]=o,s[t+32>>2]=e,se(r,3359,t+32|0),e=s[i>>2],o=s[e+4>>2])for(e=o;o=e,e=s[e>>2];);else{if(!xr(e))for(;!xr(e=s[e+8>>2]););o=s[e+8>>2]}if(s[i>>2]=o,R=t,O=yt(c),s[R+120>>2]=O,!Yr(i,t+120|0))break}}if(!kn(z(S,T))&&_e(S,1253)){if(an(d=Ze(S,1253))){if(cr(d))for(C=r+596|0,E=t+152|0,u=t+140|0,_=0;;){if(!(_e(e=ut(d,_),2058)&&_e(e,1266)&&_e(e,1405)&&_e(e,1909)&&_e(e,2116))){se(r,4872,0);break e}if(T=jr(o=t+128|0),xe(o,xt(On(e,2058))),g=+(0|Kt(On(e,1266)))/1e3,o=b(g)<2147483648?~~g:-2147483648,s[t+144>>2]=o,R=t,O=Kt(On(e,1405)),s[R+140>>2]=O,R=t,O=Kt(On(e,1909)),s[R+148>>2]=O,xe(E,xt(On(e,2116))),N=c=N-32|0,R=c,O=Xt(u),s[R+16>>2]=O,N=e=N-32|0,I=Te(n,e+28|0,u),i=s[I>>2],a[e+27|0]=0,i||(N=l=N-16|0,i=Wn(n),k=mt(o=e+8|0,vt(56),wr(l+8|0,i)),A=s[k>>2]+16|0,N=i=N-16|0,s[i+8>>2]=s[c+16>>2],s[A>>2]=s[s[i+8>>2]>>2],jr(ne(A+4|0,0,36)),N=i+16|0,R=Wn(k),O=1,a[R+4|0]=O,N=l+16|0,ae(n,s[e+28>>2],I,s[o>>2]),i=br(o),a[e+27|0]=1,l=s[o>>2],s[o>>2]=0,l&&(h[Wn(o)+4|0]&&ti(l+16|0),l&&j(l))),_r(o=c+24|0,ln(e+8|0,i),e+27|0),N=e+32|0,e=un(o),N=c+32|0,le(e=e+4|0,T),s[e+20>>2]=s[T+20>>2],o=s[T+16>>2],s[e+12>>2]=s[T+12>>2],s[e+16>>2]=o,le(e+24|0,T+24|0),s[r+592>>2]=s[t+144>>2],ie(C,u),s[r+588>>2]=s[r+588>>2]+1,e=$r(t+128|0),o=s[t+144>>2],i=s[t+140>>2],c=s[t+148>>2],R=t,O=$r(E),s[R+16>>2]=O,s[t+12>>2]=c,s[t+8>>2]=i,s[t+4>>2]=o,s[t>>2]=e,se(r,2786,t),xn(T),_=_+1|0,!(cr(d)>>>0>_>>>0))break}or(_n(e=r+596|0),rn(e))}}else se(r,4567,0)}else se(r,4520,0);De(S),N=t+240|0},updatePreloadInfo:function(e){e|=0;var t,r,n,i=0,a=0,o=0,l=0,u=0,c=0,d=0,h=0,f=0,p=0,y=0,m=0;n=X(),N=r=N-144|0,s[n+676>>2]=0,Qr(t=n+680|0),s[r+16>>2]=e,se(n,2884,r+16|0);e:if(!kn(z(u=Ue(r+80|0),e))&&_e(u,1326)&&_e(u,1140)){y=n,m=Kt(Ze(u,1326)),s[y+676>>2]=m;t:{if(an(d=Ze(u,1140))&&cr(d))for(;;){if(a=4716,!_e(e=ut(d,h),1957))break t;if(!_e(e,1944))break t;if(!_e(e,1883))break t;if(!_e(e,2009))break t;if(!_e(e,1643))break t;if(!_e(e,1214))break t;if(y=r,m=Kt(On(e,1957)),s[y+32>>2]=m,y=r,m=Kt(On(e,1944)),s[y+36>>2]=m,y=r,m=Kt(On(e,1883)),s[y+40>>2]=m,y=r,m=Kt(On(e,2009)),s[y+44>>2]=m,y=r,m=Kt(On(e,1643)),s[y+52>>2]=m,a=4768,!_e(e=On(e,1214),1283))break t;if(!_e(e,1634))break t;if(!_e(e,1692))break t;if(!_e(e,1662))break t;if(!_e(e,1861))break t;if(!_e(e,1838))break t;if(y=r,m=Kt(On(e,1283)),s[y+56>>2]=m,y=r,m=Kt(On(e,1634)),s[y+60>>2]=m,y=r,m=Kt(On(e,1692)),s[y+64>>2]=m,y=r,m=Kt(On(e,1662)),s[y+68>>2]=m,y=r,m=Kt(On(e,1861)),s[y+72>>2]=m,y=r,m=Kt(On(e,1838)),s[y+76>>2]=m,c=r+32|0,s[t+4>>2]==s[Xn(t)>>2]){if(N=f=N-32|0,p=Xn(t),i=f+8|0,l=Ar(t)+1|0,N=e=N-16|0,s[e+12>>2]=l,N=o=N-16|0,s[o+12>>2]=89478485,s[o+8>>2]=2147483647,a=s[Yt(o+12|0,o+8|0)>>2],N=o+16|0,a>>>0>=l>>>0?((o=Er(t))>>>0<a>>>1>>>0&&(s[e+8>>2]=o<<1,a=s[zt(e+8|0,e+12|0)>>2]),N=e+16|0,e=a):(Jn(),$()),l=Ar(t),a=0,N=o=N-16|0,s[o+12>>2]=0,dn(i+12|0,p),e&&(e>>>0>89478485&&(Fe(1742),$()),a=vt(g(e,48))),s[i>>2]=a,l=g(l,48)+a|0,s[i+8>>2]=l,s[i+4>>2]=l,y=Fn(i),m=g(e,48)+a|0,s[y>>2]=m,N=o+16|0,Nn(p,s[i+8>>2],c),s[i+8>>2]=s[i+8>>2]+48,Tn(t),e=i+4|0,c=s[t>>2],a=s[t+4>>2]-c|0,o=s[e>>2]+g((0|a)/-48|0,48)|0,s[e>>2]=o,(0|a)>0&&J(o,c,a),kt(t,e),kt(t+4|0,i+8|0),kt(Xn(t),Fn(i)),s[i>>2]=s[i+4>>2],Ar(t),Er(t),Er(t),(0|(e=s[i+4>>2]))!=s[i+8>>2])for(;s[i+8>>2]=s[i+8>>2]-48,(0|e)!=s[i+8>>2];);s[i>>2]&&j(e=s[i>>2]),N=f+32|0}else N=e=N-16|0,s[e>>2]=t,a=s[t+4>>2],s[e+4>>2]=a,s[e+8>>2]=a+48,Nn(Xn(t),s[e+4>>2],c),s[e+4>>2]=s[e+4>>2]+48,Hr(e),N=e+16|0;if(h=h+1|0,!(cr(d)>>>0>h>>>0))break}e=s[n+676>>2],y=r,m=Ar(t),s[y+4>>2]=m,s[r>>2]=e,se(n,3772,r);break e}se(n,a,0)}else se(n,4471,0);De(u),N=r+144|0},updateDeviceInfo:function(e,t,r,n){e|=0,t|=0,r=v(r),n=v(n);var i,a,o=0;i=X(),N=a=N-32|0,(0|e)<=0|(0|t)<=0||(s[i+152>>2]=t,s[i+148>>2]=e,s[i+144>>2]=t,s[i+140>>2]=e,(o=+r)>2.01?s[i+196>>2]=1073741824:o<.01?s[i+196>>2]=1065353216:y[i+196>>2]=r),n>v(0)&&(y[i+200>>2]=n),m[a+16>>3]=n,s[a+4>>2]=t,s[a>>2]=e,m[a+8>>3]=r,se(i,3013,a),N=a+32|0},updateMediaInfo:function(e,t,r,n){e|=0,t|=0,r=+r,n=+n;var i,a,o,l=0,u=0,c=0,d=0,h=0,f=0;if(N=i=N-96|0,a=hn(i+56|0),o=It(i+40|0),m[a+16>>3]=n,m[a+8>>3]=r,s[a>>2]=t,(0|t)>0)for(;ie(o,(l<<2)+e|0),(0|(l=l+1|0))!=(0|t););if(or(_n(o),rn(o)),(0|(e=a+24|0))!=(0|o)){N=t=N-16|0,l=(c=s[o+4>>2])-(u=s[o>>2])>>2;e:if(Cr(e)>>>0>=l>>>0){if(Lr(e)>>>0<l>>>0){s[t+12>>2]=u,d=Lr(e),s[t+12>>2]=s[t+12>>2]+(d<<2),rr(u,s[t+12>>2],s[e>>2]),lt(e,s[t+12>>2],c,l-Lr(e)|0);break e}tn(e,rr(u,c,s[e>>2]))}else s[e>>2]&&(Cn(e),d=s[e>>2],Cr(e),j(d),h=Xn(e),f=0,s[h>>2]=f,s[e>>2]=0,s[e+4>>2]=0),ct(e,ze(e,l)),lt(e,u,c,l);N=t+16|0}if(e=X(),t=s[a+4>>2],s[i>>2]=s[a>>2],s[i+4>>2]=t,t=s[a+20>>2],s[i+16>>2]=s[a+16>>2],s[i+20>>2]=t,t=s[a+12>>2],s[i+8>>2]=s[a+8>>2],s[i+12>>2]=t,t=a+24|0,N=l=(N=c=N-16|0)-16|0,s[(u=i+24|0)>>2]=0,s[u+4>>2]=0,s[l+12>>2]=0,ei(u+8|0),N=l+16|0,(l=Lr(t))&&(ct(u,l),lt(u,s[t>>2],s[t+4>>2],l)),l=0,N=t=(N=c+16|0)-16|0,se(e,2637,0),m[e+456>>3]=m[i+8>>3],m[e+464>>3]=m[i+16>>3],s[e+448>>2]=s[i>>2],Cn(u=e+472|0),Lr(c=i+24|0))for(;ie(u,Kr(c,l)),h=t,f=s[Kr(u,l)>>2],s[h>>2]=f,se(e,2633,t),l=l+1|0,Lr(c)>>>0>l>>>0;);se(e,5010,0),s[e+248>>2]=0,s[e+252>>2]=0,s[e+240>>2]=0,s[e+244>>2]=0,s[e+232>>2]=0,s[e+236>>2]=0,s[e+224>>2]=0,s[e+228>>2]=0,N=t+16|0,Qn(i),qt(o),Qn(a),N=i+96|0},updateBufferInfo:function(e,t,r,n,i,a,o,l,u){e=v(e),t=v(t),r=v(r),n=v(n),i=v(i),a|=0,o|=0,l=v(l),u|=0;var c,d,h=0,f=0,p=0;N=c=N-128|0,h=X(),y[c+104>>2]=t,y[c+112>>2]=+v(b(e))<=1e-6?v(1):e,a=(d=g(a,8e3))>>31,s[c+120>>2]=d,s[c+124>>2]=a,s[c+56>>2]=d,s[c+60>>2]=a,y[c+108>>2]=r,a=s[c+108>>2],s[c+40>>2]=s[c+104>>2],s[c+44>>2]=a,a=s[c+116>>2],s[c+48>>2]=s[c+112>>2],s[c+52>>2]=a,y[c+100>>2]=i,y[c+96>>2]=n,a=s[c+100>>2],s[c+32>>2]=s[c+96>>2],s[c+36>>2]=a,e=y[c+48>>2],+v(b(e))<=1e-6&&(s[c+48>>2]=1065353216,e=v(1)),m[h+224>>3]=y[c+32>>2],m[h+232>>3]=y[c+36>>2],y[h+76>>2]=y[c+40>>2],t=y[c+44>>2],y[h+72>>2]=t,m[h+288>>3]=v(t*y[h+80>>2]),m[h+272>>3]=v(t*y[h+84>>2]),m[h+280>>3]=v(t*y[h+88>>2]),m[h+376>>3]=+t/20*3,a=s[c+60>>2],s[h+24>>2]=s[c+56>>2],s[h+28>>2]=a,y[h+180>>2]=e,a=X(),s[c+80>>2]=o,y[c+88>>2]=l,s[c+72>>2]=-1,s[c+76>>2]=-1,s[c+8>>2]=-1,s[c+12>>2]=-1,s[c+84>>2]=u,o=s[c+84>>2],s[c+16>>2]=s[c+80>>2],s[c+20>>2]=o,o=s[c+92>>2],s[c+24>>2]=s[c+88>>2],s[c+28>>2]=o,s[c+64>>2]=-1,o=s[c+68>>2],s[c>>2]=s[c+64>>2],s[c+4>>2]=o,N=u=N-16|0,s[a+92>>2]=s[c+16>>2],e=y[c+24>>2],v(b(e))<v(0x8000000000000000)?(h=v(b(e))>=v(1)?~~(e>v(0)?v(E(v(T(v(e*v(2.3283064365386963e-10)))),v(4294967296))):v(S(v(v(e-v(~~e>>>0>>>0))*v(2.3283064365386963e-10)))))>>>0:0,o=~~e>>>0):(h=-2147483648,o=0),s[a+64>>2]=o,s[a+68>>2]=h,s[a+96>>2]=s[c+20>>2],ie(o=a+656|0,a+96|0),Lr(o)>>>0>=61&&(f=u,p=_n(o),s[f+8>>2]=p,h=s[Dr(u,u+8|0)>>2],N=a=N-16|0,s[a+8>>2]=h,f=a,p=_n(o),s[f>>2]=p,tn(o,rr((h=s[o>>2]+(s[a+8>>2]-s[a>>2]>>2<<2)|0)+4|0,s[o+4>>2],h)),Wt(h),N=a+16|0),N=u+16|0,N=c+128|0},updateSwitchInfo:function(e,t,r,n,i,o){e|=0,t|=0,r=v(r),n|=0,i=v(i),o=v(o);var l,u,c,d=v(0);N=u=N-80|0,l=X(),y[u+76>>2]=o,y[u+72>>2]=i,s[u+68>>2]=1061158912,s[u+60>>2]=1045220557,s[u+64>>2]=1053609165,y[u+56>>2]=r,a[u+52|0]=n,s[u+48>>2]=50,s[(n=u)+40>>2]=e,s[n+44>>2]=t,n=J(n,n+40|0,40),r=y[n+20>>2],+v(b(r))<=1e-6&&(s[n+20>>2]=1045220557,r=v(.20000000298023224)),i=y[n+24>>2],+v(b(i))<=1e-6&&(s[n+24>>2]=1053609165,i=v(.4000000059604645)),o=y[n+28>>2],+v(b(o))<=1e-6&&(s[n+28>>2]=1061158912,o=v(.75)),d=y[n+16>>2],+v(b(d))<=1e-6&&(s[n+16>>2]=1084227584,d=v(5)),e=s[n+4>>2],s[l+32>>2]=s[n>>2],s[l+36>>2]=e,e=t=s[n+8>>2],s[l+40>>2]=e,s[l+44>>2]=e>>31,e=h[n+12|0],s[l+188>>2]=1084227584,a[l+174|0]=e,y[l+184>>2]=d,d=v(0|t),m[l+288>>3]=v(r*d),y[l+88>>2]=o,y[l+84>>2]=i,y[l+80>>2]=r,m[l+280>>3]=v(o*d),c=+v(i*d),m[l+272>>3]=c,s[l+132>>2]=4,s[l+136>>2]=2,s[l+124>>2]=12,s[l+128>>2]=5,m[l+376>>3]=+(0|t)/20*3,s[l+360>>2]=-687194767,s[l+364>>2]=-1077055325,s[l+336>>2]=-1717986918,s[l+340>>2]=1072273817,s[l+328>>2]=858993459,s[l+332>>2]=1072902963,s[l+320>>2]=-858993459,s[l+324>>2]=1072483532,s[l+116>>2]=10,s[l+120>>2]=10,a[l+173|0]=0,m[l+368>>3]=c+12,s[l+64>>2]=0,s[l+68>>2]=0,s[l+92>>2]=0,N=n+80|0},updatePreloadSupplier:function(e,t){var r,n,i;e|=0,t|=0,N=r=N-16|0,n=X(),s[r+12>>2]=t,s[r+8>>2]=g(e,8e3),e=s[r+12>>2],s[r>>2]=s[r+8>>2],s[r+4>>2]=e,N=e=N-16|0,t=s[r>>2],s[n+668>>2]=t,i=s[r+4>>2],s[n+672>>2]=i,s[e+4>>2]=i,s[e>>2]=t,se(n,3983,e),N=e+16|0,N=r+16|0},getPredictedBitrate:function(e,t){e|=0,t|=0;var r,n=0,i=0,o=0,l=0,u=0,c=0,d=v(0),f=0,_=0,$=v(0),A=0,w=0,k=0,I=0,C=v(0),P=v(0),x=0,R=0,O=0,L=0,D=0,M=0,G=v(0),V=v(0),Z=v(0),B=0,F=0,j=0,W=0,H=0,K=0,Y=0,z=0,J=0,Q=0,q=0;if(n=X(),N=r=N-48|0,i=je(),l=s[n+36>>2],o=s[n+32>>2],s[n+8>>2]=i-o,s[n+12>>2]=U-((i>>>0<o>>>0)+l|0),c=m[n+256>>3],d=y[n+72>>2],u=s[n+28>>2],s[(i=r)+32>>2]=s[n+24>>2],s[i+36>>2]=u,m[i+24>>3]=d,m[i+16>>3]=c,s[i+8>>2]=t,s[i>>2]=o,s[i+4>>2]=l,se(n,4924,i),d=y[n+196>>2],$=v(d*v(s[n+148>>2])),t=v(b($))<v(2147483648)?~~$:-2147483648,s[n+140>>2]=t,d=v(d*v(s[n+152>>2])),t=v(b(d))<v(2147483648)?~~d:-2147483648,s[n+144>>2]=t,N=t=N-160|0,f=ke(t+144|0,1189),i=je(),o=s[n+32>>2],l=U-(s[n+36>>2]+(o>>>0>i>>>0)|0)|0,o=i-o|0,s[n+8>>2]=o,s[n+12>>2]=l,i=-1,(_=o>>>0<(u=g(s[n+548>>2],1e3)-2e3|0)>>>0)&(0|l)<=(0|(o=u>>31))|(0|o)>(0|l)){if(Ar(i=n+680|0)&&-1!=s[Tr(i)+44>>2]&&-1!=(0|(i=s[Tr(i)+8>>2])))s[t+96>>2]=i,se(n,4047,t+96|0);else{if(o=-1,(0|(u=s[n+544>>2]))<=0)l=-1;else{i=0;e:{for(;;){if((0|e)>=0){l=s[lr(n+576|0,0)>>2],u=s[n+544>>2];break e}if((0|(i=i+1|0))==(0|u))break}l=-1}if(!((0|u)<2))for(u=n+576|0,w=(0|e)<0,i=1;w||m[n+336>>3]*+s[n+24>>2]>+s[lr(u,i)>>2]&&(o=s[lr(u,i)>>2]),(0|(i=i+1|0))<s[n+544>>2];);}i=(0|o)>(0|l)?o:l}i=h[n+176|0]&&s[n+168>>2]>1?e:i,l=de(n,s[n+140>>2],s[n+144>>2]),s[n+108>>2]=l,(0|l)>0&&(i=ge(n,i,l)),s[n+100>>2]=e,m[n+256>>3]=m[n+232>>3],$e(l=n+644|0,n+256|0),Or(l)>>>0>p[n+120>>2]&&(J=t,Q=_n(l),s[J+128>>2]=Q,Ke(l,s[Dr(t+136|0,t+128|0)>>2])),J=n,q=Ce(n),m[J+264>>3]=q,s[t+128>>2]=e,s[t+132>>2]=e>>31,fr(l=n+620|0,t+128|0),Or(l)>>>0>s[n+116>>2]<<1>>>0&&(J=t,Q=_n(l),s[J+128>>2]=Q,Ke(l,s[Dr(t+120|0,t+128|0)>>2])),(o=s[n+24>>2])>>>0<40001&(0|(l=s[n+28>>2]))<=0|(0|l)<0||(d=v(v(+(o>>>0)+4294967296*+(0|l))/y[n+180>>2]),v(b(d))<v(0x8000000000000000)?(o=v(b(d))>=v(1)?~~(d>v(0)?v(E(v(T(v(d*v(2.3283064365386963e-10)))),v(4294967296))):v(S(v(v(d-v(~~d>>>0>>>0))*v(2.3283064365386963e-10)))))>>>0:0,l=~~d>>>0):(o=-2147483648,l=0),s[t+128>>2]=l,s[t+132>>2]=o,dr(l=n+608|0,t+128|0),Or(l)>>>0<=p[n+124>>2]||(J=t,Q=_n(l),s[J+112>>2]=Q,Ke(l,s[Dr(t+104|0,t+112|0)>>2]))),l=$r(f),o=je(),u=s[n+24>>2],w=s[n+28>>2],_=s[n+48>>2],k=s[n+52>>2],c=m[n+256>>3],A=s[n+92>>2],L=s[n+64>>2],D=s[n+68>>2],M=h[n+176|0],s[t+84>>2]=s[n+168>>2],s[t+80>>2]=M,s[t+72>>2]=L,s[t+76>>2]=D,s[t- -64>>2]=A,s[t+56>>2]=0,s[t+60>>2]=0,s[t+48>>2]=0,s[t+52>>2]=0,m[t+40>>3]=c,s[t+36>>2]=e,s[t+32>>2]=i,s[t+24>>2]=_,s[t+28>>2]=k,s[t+16>>2]=u,s[t+20>>2]=w,s[t+8>>2]=o,s[t+12>>2]=U,s[t>>2]=l,se(n,3113,t)}if(gr(f),N=t+160|0,t=i,-1==(0|i)){if(i=0,N=o=N-336|0,w=ke(o+320|0,1086),l=je(),t=e,s[n+100>>2]=e,m[n+256>>3]=m[n+232>>3],e=s[n+32>>2],u=U-(s[n+36>>2]+(e>>>0>l>>>0)|0)|0,s[n+8>>2]=l-e,s[n+12>>2]=u,$e(e=n+644|0,n+256|0),Or(e)>>>0>p[n+120>>2]&&(J=o,Q=_n(e),s[J+304>>2]=Q,Ke(e,s[Dr(o+312|0,o+304|0)>>2])),J=n,q=Ce(n),m[J+264>>3]=q,m[n+256>>3]<.1&&(s[n+156>>2]=s[n+156>>2]+1),1==s[n+96>>2]&&(s[n+160>>2]=s[n+160>>2]+1),N=e=N-16|0,J=e,Q=Ut(u=n+656|0),s[J+8>>2]=Q,J=e,Q=Vt(u),s[J>>2]=Q,St(e+8|0,e))for(;N=l=N-16|0,f=e+8|0,s[l+8>>2]=s[f>>2],_=s[Gr(l+8|0)>>2],N=l+16|0,l=s[_>>2],Gr(f),J=e,Q=Vt(u),s[J>>2]=Q,i=(1==(0|l))+i|0,St(f,e););if(N=e+16|0,s[n+164>>2]=i,s[o+304>>2]=t,k=t>>31,s[o+308>>2]=k,fr(f=n+620|0,o+304|0),Or(f)>>>0>s[n+116>>2]<<1>>>0&&(J=o,Q=_n(f),s[J+304>>2]=Q,Ke(f,s[Dr(o+296|0,o+304|0)>>2])),(i=s[n+24>>2])>>>0<40001&(0|(e=s[n+28>>2]))<=0|(0|e)<0||(d=v(v(+(i>>>0)+4294967296*+(0|e))/y[n+180>>2]),v(b(d))<v(0x8000000000000000)?(i=v(b(d))>=v(1)?~~(d>v(0)?v(E(v(T(v(d*v(2.3283064365386963e-10)))),v(4294967296))):v(S(v(v(d-v(~~d>>>0>>>0))*v(2.3283064365386963e-10)))))>>>0:0,e=~~d>>>0):(i=-2147483648,e=0),s[o+304>>2]=e,s[o+308>>2]=i,dr(e=n+608|0,o+304|0),Or(e)>>>0<=p[n+124>>2]||(J=o,Q=_n(e),s[J+288>>2]=Q,Ke(e,s[Dr(o+280|0,o+288|0)>>2]))),s[o+304>>2]=0,s[o+308>>2]=0,-1!=(s[n+56>>2]&s[n+60>>2])&&Or(e=n+608|0)){if(e=Ur(e,Or(e)-1|0),i=s[e>>2],A=s[e+4>>2],l=s[n+56>>2],e=s[n+60>>2]-(A+(i>>>0>l>>>0)|0)|0,l=l-i|0,l^=u=e>>31,m[o+304>>3]=(+(l-u>>>0)+4294967296*+((e^u)-((l>>>0<u>>>0)+u|0)|0))/(+(i>>>0)+4294967296*+(0|A)),$e(e=n+632|0,o+304|0),Or(e)>>>0>p[n+128>>2]&&(J=o,Q=_n(e),s[J+288>>2]=Q,Ke(e,s[Dr(o+272|0,o+288|0)>>2])),i=_n(e),l=rn(e),N=e=N-32|0,s[e+16>>2]=l,s[e+24>>2]=i,Yr(e+24|0,e+16|0)&&(s[e>>2]=s[e+24>>2],Yr(Nr(e),e+16|0)))for(;m[s[e+24>>2]>>3]<m[s[e>>2]>>3]&&(s[e+24>>2]=s[e>>2]),Yr(Nr(e),e+16|0););N=e+32|0,s[o+288>>2]=s[e+24>>2],c=m[s[o+288>>2]>>3],c=(+(ce(n)>>>0)+4294967296*+(0|U))/(c+1),b(c)<0x8000000000000000?(i=b(c)>=1?~~(c>0?E(T(2.3283064365386963e-10*c),4294967295):S(2.3283064365386963e-10*(c-+(~~c>>>0>>>0))))>>>0:0,e=~~c>>>0):(i=-2147483648,e=0),s[n+48>>2]=e,s[n+52>>2]=i}else J=n,Q=ce(n),s[J+48>>2]=Q,s[n+52>>2]=U,$e(n+632|0,o+304|0),e=s[n+48>>2],i=s[n+52>>2];s[n+56>>2]=e,s[n+60>>2]=i,(i=s[n+92>>2])&&(e=s[n+12>>2],l=s[n+8>>2],s[n+16>>2]=l,s[n+20>>2]=e,s[o+252>>2]=1,s[o+248>>2]=i,s[o+240>>2]=l,s[o+244>>2]=e,se(n,3680,o+240|0));e:{t:if(!(e=s[n+16>>2])&(0|(i=s[n+20>>2]))<=0|(0|i)<0||!(+((l=s[n+8>>2])-e>>>0)+4294967296*+((u=s[n+12>>2])-((e>>>0>l>>>0)+i|0)|0)<8e3)){h[n+172|0]&&(a[n+172|0]=0),c=m[n+312>>3],e=s[n+164>>2],x=m[n+304>>3],R=m[n+296>>3],i=$r(w),O=21-(O=21-c)/(c=+(0|e)+1),m[o+232>>3]=O,R=31-(31-R)/c,m[o+224>>3]=R,s[o+208>>2]=i,x=41-(41-x)/c,m[o+216>>3]=x,se(n,2950,o+208|0);r:{n:{i:{if((c=m[n+256>>3])<O){if(e=s[n+544>>2]<=0,c=m[n+336>>3]*+s[n+48>>2],l=b(c)<2147483648?~~c:-2147483648,e)break i;if(e=0,(0|l)<s[lr(u=n+576|0,0)>>2])break i;for(;;){if(i=s[lr(u,e)>>2],(0|(e=e+1|0))>=s[n+544>>2])break n;if(!((0|l)>=s[lr(u,e)>>2]))break}break n}l=s[n+48>>2],i=s[n+52>>2];a:{if(c<R){if(e=t,l>>>0<1001&(0|i)<=0|(0|i)<0)break e;if(c=m[n+320>>3]*(+(l>>>0)+4294967296*+(0|i)),!(b(c)<2147483648))break a;i=~~c;break r}if(e=t,!(c>=x)|l>>>0<1001&(0|i)<=0|(0|i)<0|s[n+544>>2]<=0)break e;for(i=n+576|0,e=0;;){if((0|t)<s[lr(i,e)>>2]){e=s[lr(i,e)>>2],l=i=s[n+48>>2],u=e,i=(_=e>>>0<i>>>0)&(0|(i=s[n+52>>2]))>=(0|(e>>=31))|(0|e)<(0|i)?l:u;break r}if(!((0|(e=e+1|0))<s[n+544>>2]))break}break t}i=-2147483648;break r}i=l}if((0|i)>(0|(e=t)))break e}if(e=t,-1==(0|i))break e;if(s[n+544>>2]<=0)l=-1;else for(_=n+576|0,e=2147483647,l=-1;(0|(u=((u=(A=i-s[lr(_,I)>>2]|0)>>31)^A)-u|0))<(0|e)&&(l=s[lr(_,I)>>2],e=u),(0|(I=I+1|0))<s[n+544>>2];);if((0|t)>=(0|(e=l)))break e;if(!Or(f))break e;J=o,Q=Ut(f),s[J+288>>2]=Q,J=o,Q=Vt(f),s[J+264>>2]=Q,i=0;r:if(St(o+288|0,o+264|0))for(;;){if(N=l=N-16|0,s[l+8>>2]=s[o+288>>2],u=s[Vr(l+8|0)>>2],N=l+16|0,(0|t)!=s[u>>2]|(0|k)!=s[u+4>>2])break r;if(Vr(l=o+288|0),J=o,Q=Vt(f),s[J+264>>2]=Q,i=i+1|0,!St(l,o+264|0))break}if(!(s[n+132>>2]>(0|i)||+s[n+548>>2]>=m[n+256>>3]/+y[n+180>>2]))break e}else s[o+192>>2]=s[n+92>>2],s[o+184>>2]=e,s[o+188>>2]=i,s[o+176>>2]=l,s[o+180>>2]=u,se(n,4614,o+176|0);e=t}i=de(n,s[n+140>>2],s[n+144>>2]),s[n+108>>2]=i,(0|i)>0&&(e=ge(n,e,i)),(0|(u=ot(n,t)))<=(0|(l=ot(n,e)))|(u-l|0)<3?i=l:(e=dt(n,i=u-2|0),f=$r(w),s[o+168>>2]=i,s[o+164>>2]=l,s[o+160>>2]=f,se(n,2068,o+160|0)),l=$r(w),f=s[n+548>>2],I=s[n+8>>2],_=s[n+12>>2],d=y[n+72>>2],$=y[n+180>>2],C=y[n+188>>2],P=y[n+204>>2],G=y[n+208>>2],V=y[n+212>>2],Z=y[n+216>>2],c=m[n+256>>3],k=s[n+24>>2],A=s[n+28>>2],L=s[n+48>>2],D=s[n+52>>2],M=s[n+156>>2],B=s[n+92>>2],F=s[n+64>>2],j=s[n+68>>2],W=s[n+20>>2],H=s[n+16>>2],K=s[n+96>>2],Y=s[n+164>>2],z=s[n+160>>2],s[o+156>>2]=i,s[o+152>>2]=u,s[o+112>>2]=z,s[o+108>>2]=Y,s[o+104>>2]=K,s[o+96>>2]=H,s[o+100>>2]=W,s[o+88>>2]=F,s[o+92>>2]=j,s[o+72>>2]=B,s[o+68>>2]=M,s[o- -64>>2]=f,s[o+56>>2]=L,s[o+60>>2]=D,s[o+48>>2]=k,s[o+52>>2]=A,s[o+44>>2]=e,s[o+40>>2]=t,m[o+16>>3]=c,m[o+144>>3]=Z,m[o+136>>3]=V,m[o+128>>3]=G,m[o+120>>3]=P,m[o+80>>3]=C,m[o+32>>3]=$,m[o+24>>3]=d,s[o+8>>2]=I,s[o+12>>2]=_,s[o>>2]=l,se(n,4102,o),s[n+104>>2]=e,t=s[n+12>>2],s[n>>2]=s[n+8>>2],s[n+4>>2]=t,m[n+248>>3]=m[n+232>>3],m[n+240>>3]=m[n+224>>3],gr(w),N=o+336|0,t=e}return N=r+48|0,e=X(),d=v(+p[e+48>>2]+4294967296*+s[e+52>>2]),$=y[X()+204>>2],C=y[X()+208>>2],P=v(y[X()+212>>2]*v(100)),n=v(b(P))<v(2147483648)?~~P:-2147483648,P=y[X()+216>>2],e=vt(28),s[e+20>>2]=n,C=v(C*v(100)),i=v(b(C))<v(2147483648)?~~C:-2147483648,s[e+16>>2]=i,$=v($*v(100)),i=v(b($))<v(2147483648)?~~$:-2147483648,s[e+12>>2]=i,i=v(b(d))<v(2147483648)?~~d:-2147483648,s[e+8>>2]=i,s[e+4>>2]=0,s[e>>2]=t,d=v(P*v(100)),t=v(b(d))<v(2147483648)?~~d:-2147483648,s[e+24>>2]=t,0|e},getPreloadBitrate:function(e){var t,r,n,i,a;return e|=0,N=t=N-32|0,n=X(),N=r=N-48|0,s[t+24>>2]=0,s[t+8>>2]=-1,s[t+12>>2]=-1,s[t+16>>2]=-1,s[t+20>>2]=2,i=s[n+672>>2],a=s[n+668>>2],s[r>>2]=e,s[r+4>>2]=a,s[r+8>>2]=i,se(n,3909,r),te(r+24|0,n,e||0),s[t+24>>2]=s[r+40>>2],e=s[r+36>>2],s[t+16>>2]=s[r+32>>2],s[t+20>>2]=e,e=s[r+28>>2],s[t+8>>2]=s[r+24>>2],s[t+12>>2]=e,N=r+48|0,e=vt(20),s[e>>2]=s[t+8>>2],s[e+4>>2]=s[t+12>>2],s[e+8>>2]=s[t+24>>2],s[e+12>>2]=s[t+16>>2],s[e+16>>2]=s[t+20>>2],N=t+32|0,0|e},setDebugModel:function(e){var t,r;e|=0,t=X(),r=e,a[t+174|0]=r},__indirect_function_table:oi,free:j,__errno_location:function(){return 10880},__stdio_exit:function(){var e=0;if(e=s[2719])for(;He(e),e=s[e+56>>2];);He(s[2238]),He(s[2200]),He(s[2276])},emscripten_stack_init:Pn,emscripten_stack_get_free:function(){return N-G|0},emscripten_stack_get_base:function(){return 0|V},emscripten_stack_get_end:function(){return 0|G},stackSave:function(){return 0|N},stackRestore:function(e){N=e|=0},stackAlloc:function(e){return N=e=N-(e|=0)&-16,0|e},dynCall_jiji:function(e,t,r,n,i){return t|=0,r|=0,n|=0,i|=0,e=0|oi[0|(e|=0)](t,r,n,i),D(0|U),0|e}}}(e)}(Ie)},instantiate:function(e,t){return{then:function(t){var r=new E.Module(e);return t({instance:new E.Instance(r)}),{catch:function(){}}}}},RuntimeError:Error};v=[],"object"!=_typeof(E)&&ee("no native wasm support detected");var T=!1;function S(e,t){e||ee("Assertion failed"+(t?": "+t:""))}function $(e,t,r,n,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var r=1+(e.length<<2);L(e,t=Me(r),r)}return t},array:function(e){var t=Me(e.length);return M(e,t),t}};var s=function(e){var t=a["_"+e];return S(t,"Cannot call unknown function "+e+", make sure it is exported"),t}(e),l=[],u=0;if(S("array"!==t,'Return type should not be "array".'),n)for(var c=0;c<n.length;c++){var d=o[r[c]];d?(0===u&&(u=Le()),l[c]=d(n[c])):l[c]=n[c]}var h,f=s.apply(null,l);return h=f,0!==u&&De(u),f=function(e){return"string"===t?R(e):"boolean"===t?Boolean(e):e}(h),f}var A,w,k,I,C,P="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function x(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&P)return P.decode(e.subarray(t,i));for(var a="";t<i;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if(224==(240&o)?o=(15&o)<<12|s<<6|l:(240!=(248&o)&&f("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),o=(7&o)<<18|s<<12|l<<6|63&e[t++]),o<65536)a+=String.fromCharCode(o);else{var u=o-65536;a+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else a+=String.fromCharCode((31&o)<<6|s)}else a+=String.fromCharCode(o)}return a}function R(e,t){return e?x(k,e,t):""}function O(e,t,r,n){if(!(n>0))return 0;for(var i=r,a=r+n-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(r>=a)break;t[r++]=s}else if(s<=2047){if(r+1>=a)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=a)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=a)break;s>1114111&&f("Invalid Unicode code point 0x"+s.toString(16)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}function L(e,t,r){return S("number"==typeof r,"stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),O(e,k,t,r)}function D(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}function M(e,t){S(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),w.set(e,t)}function N(e){A=e,a.HEAP8=w=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=I=new Int32Array(e),a.HEAPU8=k=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=C=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var G=8192;a.TOTAL_STACK&&S(G===a.TOTAL_STACK,"the stack size can no longer be determined at runtime");var V,U=a.INITIAL_MEMORY||65536;function Z(){var e=Oe();S(0==(3&e)),I[e>>2]=34821223,I[e+4>>2]=2310721022,I[0]=1668509029}function B(){if(!T){var e=Oe(),t=C[e>>2],r=C[e+4>>2];34821223==t&&2310721022==r||ee("Stack overflow! Stack cookie has been overwritten, expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+r.toString(16)+" 0x"+t.toString(16)),1668509029!==I[0]&&ee("Runtime error: The application has corrupted its heap memory area (address zero)!")}}p("INITIAL_MEMORY","INITIAL_MEMORY"),S(U>=G,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+U+"! (TOTAL_STACK="+"8192)"),S("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,"JS engine does not provide full typed array support"),(_=a.wasmMemory?a.wasmMemory:new E.Memory({initial:U/65536,maximum:32768}))&&(A=_.buffer),S((U=A.byteLength)%65536==0),N(A),function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian! (Run with -s SUPPORT_BIG_ENDIAN=1 to bypass)"}();var F=[],j=[],W=[],X=!1;S(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),S(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var H=0,K=null,Y=null,z={};function J(e){for(var t=e;;){if(!z[e])return e;e=t+Math.random()}}function Q(e){H++,a.monitorRunDependencies&&a.monitorRunDependencies(H),e?(S(!z[e]),z[e]=1,null===K&&"undefined"!=typeof setInterval&&(K=setInterval((function(){if(T)return clearInterval(K),void(K=null);var e=!1;for(var t in z)e||(e=!0,h("still waiting on run dependencies:")),h("dependency: "+t);e&&h("(end of list)")}),1e4))):h("warning: run dependency added without ID")}function q(e){if(H--,a.monitorRunDependencies&&a.monitorRunDependencies(H),e?(S(z[e]),delete z[e]):h("warning: run dependency removed without ID"),0==H&&(null!==K&&(clearInterval(K),K=null),Y)){var t=Y;Y=null,t()}}function ee(e){a.onAbort&&a.onAbort(e),h(e="Aborted("+e+")"),T=!0;var t=new E.RuntimeError(e);throw i(t),t}a.preloadedImages={},a.preloadedAudios={};var te,re,ne,ie,ae="data:application/octet-stream;base64,";function oe(e){return e.startsWith(ae)}function se(e,t){return function(){var r=e,n=t;return t||(n=a.asm),S(X,"native function `"+r+"` called before runtime initialization"),S(!0,"native function `"+r+"` called after runtime exit (use NO_EXIT_RUNTIME to keep it alive after main() exits)"),n[e]||S(n[e],"exported native function `"+r+"` not found"),n[e].apply(null,arguments)}}function le(e){try{if(e==te&&v)return new Uint8Array(v);var t=ke(e);if(t)return t;throw"both async and sync fetching of the wasm failed"}catch(r){ee(r)}}function ue(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?de(r)():de(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(a)}}function ce(e){return e.replace(/\b_Z[\w\d_]+/g,(function(e){var t,r=(t=e,f("warning: build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),t);return e===r?e:r+" ["+e+"]"}))}function de(e){return V.get(e)}function he(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){I[this.ptr+4>>2]=e},this.get_type=function(){return I[this.ptr+4>>2]},this.set_destructor=function(e){I[this.ptr+8>>2]=e},this.get_destructor=function(){return I[this.ptr+8>>2]},this.set_refcount=function(e){I[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,w[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=w[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,w[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=w[this.ptr+13>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=I[this.ptr>>2];I[this.ptr>>2]=e+1},this.release_ref=function(){var e=I[this.ptr>>2];return I[this.ptr>>2]=e-1,S(e>0),1===e}}function fe(t){try{return _.grow(t-A.byteLength+65535>>>16),N(_.buffer),1}catch(e){h("emscripten_realloc_buffer: Attempted to grow heap from "+A.byteLength+" bytes to "+t+" bytes, but got error: "+e)}}oe(te="index.wasm")||(re=te,te=a.locateFile?a.locateFile(re,u):u+re);var pe={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=pe.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=pe.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=pe.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return pe.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return pe.normalize(e.join("/"))},join2:function(e,t){return pe.normalize(e+"/"+t)}};var ye={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:_e.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t="/"===n.charAt(0)}return(t?"/":"")+(e=pe.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."},relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=ye.resolve(e).substr(1),t=ye.resolve(t).substr(1);for(var n=r(e.split("/")),i=r(t.split("/")),a=Math.min(n.length,i.length),o=a,s=0;s<a;s++)if(n[s]!==i[s]){o=s;break}var l=[];for(s=o;s<n.length;s++)l.push("..");return(l=l.concat(i.slice(o))).join("/")}},me={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){me.ttys[e]={input:[],output:[],ops:t},_e.registerDevice(e,me.stream_ops)},stream_ops:{open:function(e){var t=me.ttys[e.node.rdev];if(!t)throw new _e.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(t,r,n,i,a){if(!t.tty||!t.tty.ops.get_char)throw new _e.ErrnoError(60);for(var o=0,s=0;s<i;s++){var l;try{l=t.tty.ops.get_char(t.tty)}catch(e){throw new _e.ErrnoError(29)}if(void 0===l&&0===o)throw new _e.ErrnoError(6);if(null==l)break;o++,r[n+s]=l}return o&&(t.node.timestamp=Date.now()),o},write:function(t,r,n,i,a){if(!t.tty||!t.tty.ops.put_char)throw new _e.ErrnoError(60);try{for(var o=0;o<i;o++)t.tty.ops.put_char(t.tty,r[n+o])}catch(e){throw new _e.ErrnoError(29)}return i&&(t.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=Ae(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(d(x(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(d(x(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(h(x(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(h(x(e.output,0)),e.output=[])}}};var ge={ops_table:null,mount:function(e){return ge.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(_e.isBlkdev(r)||_e.isFIFO(r))throw new _e.ErrnoError(63);ge.ops_table||(ge.ops_table={dir:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr,lookup:ge.node_ops.lookup,mknod:ge.node_ops.mknod,rename:ge.node_ops.rename,unlink:ge.node_ops.unlink,rmdir:ge.node_ops.rmdir,readdir:ge.node_ops.readdir,symlink:ge.node_ops.symlink},stream:{llseek:ge.stream_ops.llseek}},file:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr},stream:{llseek:ge.stream_ops.llseek,read:ge.stream_ops.read,write:ge.stream_ops.write,allocate:ge.stream_ops.allocate,mmap:ge.stream_ops.mmap,msync:ge.stream_ops.msync}},link:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr,readlink:ge.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr},stream:_e.chrdev_stream_ops}});var i=_e.createNode(e,t,r,n);return _e.isDir(i.mode)?(i.node_ops=ge.ops_table.dir.node,i.stream_ops=ge.ops_table.dir.stream,i.contents={}):_e.isFile(i.mode)?(i.node_ops=ge.ops_table.file.node,i.stream_ops=ge.ops_table.file.stream,i.usedBytes=0,i.contents=null):_e.isLink(i.mode)?(i.node_ops=ge.ops_table.link.node,i.stream_ops=ge.ops_table.link.stream):_e.isChrdev(i.mode)&&(i.node_ops=ge.ops_table.chrdev.node,i.stream_ops=ge.ops_table.chrdev.stream),i.timestamp=Date.now(),e&&(e.contents[t]=i,e.timestamp=i.timestamp),i},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=_e.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,_e.isDir(e.mode)?t.size=4096:_e.isFile(e.mode)?t.size=e.usedBytes:_e.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&ge.resizeFileStorage(e,t.size)},lookup:function(e,t){throw _e.genericErrors[44]},mknod:function(e,t,r,n){return ge.createNode(e,t,r,n)},rename:function(t,r,n){if(_e.isDir(t.mode)){var i;try{i=_e.lookupNode(r,n)}catch(e){}if(i)for(var a in i.contents)throw new _e.ErrnoError(55)}delete t.parent.contents[t.name],t.parent.timestamp=Date.now(),t.name=n,r.contents[n]=t,r.timestamp=t.parent.timestamp,t.parent=r},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var r=_e.lookupNode(e,t);for(var n in r.contents)throw new _e.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=ge.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!_e.isLink(e.mode))throw new _e.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,i){var a=e.node.contents;if(i>=e.node.usedBytes)return 0;var o=Math.min(e.node.usedBytes-i,n);if(S(o>=0),o>8&&a.subarray)t.set(a.subarray(i,i+o),r);else for(var s=0;s<o;s++)t[r+s]=a[i+s];return o},write:function(e,t,r,n,i,a){if(S(!(t instanceof ArrayBuffer)),t.buffer===w.buffer&&(a=!1),!n)return 0;var o=e.node;if(o.timestamp=Date.now(),t.subarray&&(!o.contents||o.contents.subarray)){if(a)return S(0===i,"canOwn must imply no weird position inside the file"),o.contents=t.subarray(r,r+n),o.usedBytes=n,n;if(0===o.usedBytes&&0===i)return o.contents=t.slice(r,r+n),o.usedBytes=n,n;if(i+n<=o.usedBytes)return o.contents.set(t.subarray(r,r+n),i),n}if(ge.expandFileStorage(o,i+n),o.contents.subarray&&t.subarray)o.contents.set(t.subarray(r,r+n),i);else for(var s=0;s<n;s++)o.contents[i+s]=t[r+s];return o.usedBytes=Math.max(o.usedBytes,i+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&_e.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new _e.ErrnoError(28);return n},allocate:function(e,t,r){ge.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,i,a){if(0!==t)throw new _e.ErrnoError(28);if(!_e.isFile(e.node.mode))throw new _e.ErrnoError(43);var o,s,l=e.node.contents;if(2&a||l.buffer!==A){if((n>0||n+r<l.length)&&(l=l.subarray?l.subarray(n,n+r):Array.prototype.slice.call(l,n,n+r)),s=!0,!(o=void ee("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")))throw new _e.ErrnoError(48);w.set(l,o)}else s=!1,o=l.byteOffset;return{ptr:o,allocated:s}},msync:function(e,t,r,n,i){if(!_e.isFile(e.node.mode))throw new _e.ErrnoError(43);return 2&i||ge.stream_ops.write(e,t,0,n,r,!1),0}}};var ve={0:"Success",1:"Arg list too long",2:"Permission denied",3:"Address already in use",4:"Address not available",5:"Address family not supported by protocol family",6:"No more processes",7:"Socket already connected",8:"Bad file number",9:"Trying to read unreadable message",10:"Mount device busy",11:"Operation canceled",12:"No children",13:"Connection aborted",14:"Connection refused",15:"Connection reset by peer",16:"File locking deadlock error",17:"Destination address required",18:"Math arg out of domain of func",19:"Quota exceeded",20:"File exists",21:"Bad address",22:"File too large",23:"Host is unreachable",24:"Identifier removed",25:"Illegal byte sequence",26:"Connection already in progress",27:"Interrupted system call",28:"Invalid argument",29:"I/O error",30:"Socket is already connected",31:"Is a directory",32:"Too many symbolic links",33:"Too many open files",34:"Too many links",35:"Message too long",36:"Multihop attempted",37:"File or path name too long",38:"Network interface is not configured",39:"Connection reset by network",40:"Network is unreachable",41:"Too many open files in system",42:"No buffer space available",43:"No such device",44:"No such file or directory",45:"Exec format error",46:"No record locks available",47:"The link has been severed",48:"Not enough core",49:"No message of desired type",50:"Protocol not available",51:"No space left on device",52:"Function not implemented",53:"Socket is not connected",54:"Not a directory",55:"Directory not empty",56:"State not recoverable",57:"Socket operation on non-socket",59:"Not a typewriter",60:"No such device or address",61:"Value too large for defined data type",62:"Previous owner died",63:"Not super-user",64:"Broken pipe",65:"Protocol error",66:"Unknown protocol",67:"Protocol wrong type for socket",68:"Math result not representable",69:"Read only file system",70:"Illegal seek",71:"No such process",72:"Stale file handle",73:"Connection timed out",74:"Text file busy",75:"Cross-device link",100:"Device not a stream",101:"Bad font file fmt",102:"Invalid slot",103:"Invalid request code",104:"No anode",105:"Block device required",106:"Channel number out of range",107:"Level 3 halted",108:"Level 3 reset",109:"Link number out of range",110:"Protocol driver not attached",111:"No CSI structure available",112:"Level 2 halted",113:"Invalid exchange",114:"Invalid request descriptor",115:"Exchange full",116:"No data (for no delay io)",117:"Timer expired",118:"Out of streams resources",119:"Machine is not on the network",120:"Package not installed",121:"The object is remote",122:"Advertise error",123:"Srmount error",124:"Communication error on send",125:"Cross mount point (not really error)",126:"Given log. name not unique",127:"f.d. invalid for this operation",128:"Remote address changed",129:"Can   access a needed shared lib",130:"Accessing a corrupted shared lib",131:".lib section in a.out corrupted",132:"Attempting to link in too many libs",133:"Attempting to exec a shared library",135:"Streams pipe error",136:"Too many users",137:"Socket type not supported",138:"Not supported",139:"Protocol family not supported",140:"Can't send after socket shutdown",141:"Too many references",142:"Host is down",148:"No medium (in tape drive)",156:"Level 2 not synchronized"},be={},_e={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e=ye.resolve(_e.cwd(),e)))return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};if((t=Object.assign(r,t)).recurse_count>8)throw new _e.ErrnoError(32);for(var n=pe.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),i=_e.root,a="/",o=0;o<n.length;o++){var s=o===n.length-1;if(s&&t.parent)break;if(i=_e.lookupNode(i,n[o]),a=pe.join2(a,n[o]),_e.isMountpoint(i)&&(!s||s&&t.follow_mount)&&(i=i.mounted.root),!s||t.follow)for(var l=0;_e.isLink(i.mode);){var u=_e.readlink(a);a=ye.resolve(pe.dirname(a),u);var c=_e.lookupPath(a,{recurse_count:t.recurse_count+1});if(i=c.node,l++>40)throw new _e.ErrnoError(32)}}return{path:a,node:i}},getPath:function(e){for(var t;;){if(_e.isRoot(e)){var r=e.mount.mountpoint;return t?"/"!==r[r.length-1]?r+"/"+t:r+t:r}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%_e.nameTable.length},hashAddNode:function(e){var t=_e.hashName(e.parent.id,e.name);e.name_next=_e.nameTable[t],_e.nameTable[t]=e},hashRemoveNode:function(e){var t=_e.hashName(e.parent.id,e.name);if(_e.nameTable[t]===e)_e.nameTable[t]=e.name_next;else for(var r=_e.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:function(e,t){var r=_e.mayLookup(e);if(r)throw new _e.ErrnoError(r,e);for(var n=_e.hashName(e.id,t),i=_e.nameTable[n];i;i=i.name_next){var a=i.name;if(i.parent.id===e.id&&a===t)return i}return _e.lookup(e,t)},createNode:function(e,t,r,n){S("object"==_typeof(e));var i=new _e.FSNode(e,t,r,n);return _e.hashAddNode(i),i},destroyNode:function(e){_e.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=_e.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return _e.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2},mayLookup:function(e){var t=_e.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(t,r){try{_e.lookupNode(t,r);return 20}catch(e){}return _e.nodePermissions(t,"wx")},mayDelete:function(t,r,n){var i;try{i=_e.lookupNode(t,r)}catch(e){return e.errno}var a=_e.nodePermissions(t,"wx");if(a)return a;if(n){if(!_e.isDir(i.mode))return 54;if(_e.isRoot(i)||_e.getPath(i)===_e.cwd())return 10}else if(_e.isDir(i.mode))return 31;return 0},mayOpen:function(e,t){return e?_e.isLink(e.mode)?32:_e.isDir(e.mode)&&("r"!==_e.flagsToPermissionString(t)||512&t)?31:_e.nodePermissions(e,_e.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_e.MAX_OPEN_FDS,r=e;r<=t;r++)if(!_e.streams[r])return r;throw new _e.ErrnoError(33)},getStream:function(e){return _e.streams[e]},createStream:function(e,t,r){_e.FSStream||(_e.FSStream=function(){},_e.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}}),e=Object.assign(new _e.FSStream,e);var n=_e.nextfd(t,r);return e.fd=n,_e.streams[n]=e,e},closeStream:function(e){_e.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=_e.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new _e.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){_e.devices[e]={stream_ops:t}},getDevice:function(e){return _e.devices[e]},getMounts:function(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),_e.syncFSRequests++,_e.syncFSRequests>1&&h("warning: "+_e.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=_e.getMounts(_e.root.mount),n=0;function i(e){return S(_e.syncFSRequests>0),_e.syncFSRequests--,t(e)}function a(e){if(e)return a.errored?void 0:(a.errored=!0,i(e));++n>=r.length&&i(null)}r.forEach((function(t){if(!t.type.syncfs)return a(null);t.type.syncfs(t,e,a)}))},mount:function(e,t,r){if("string"==typeof e)throw e;var n,i="/"===r,a=!r;if(i&&_e.root)throw new _e.ErrnoError(10);if(!i&&!a){var o=_e.lookupPath(r,{follow_mount:!1});if(r=o.path,n=o.node,_e.isMountpoint(n))throw new _e.ErrnoError(10);if(!_e.isDir(n.mode))throw new _e.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},l=e.mount(s);return l.mount=s,s.root=l,i?_e.root=l:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),l},unmount:function(e){var t=_e.lookupPath(e,{follow_mount:!1});if(!_e.isMountpoint(t.node))throw new _e.ErrnoError(28);var r=t.node,n=r.mounted,i=_e.getMounts(n);Object.keys(_e.nameTable).forEach((function(e){for(var t=_e.nameTable[e];t;){var r=t.name_next;i.includes(t.mount)&&_e.destroyNode(t),t=r}})),r.mounted=null;var a=r.mount.mounts.indexOf(n);S(-1!==a),r.mount.mounts.splice(a,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,r){var n=_e.lookupPath(e,{parent:!0}).node,i=pe.basename(e);if(!i||"."===i||".."===i)throw new _e.ErrnoError(28);var a=_e.mayCreate(n,i);if(a)throw new _e.ErrnoError(a);if(!n.node_ops.mknod)throw new _e.ErrnoError(63);return n.node_ops.mknod(n,i,t,r)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,_e.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,_e.mknod(e,t,0)},mkdirTree:function(t,r){for(var n=t.split("/"),i="",a=0;a<n.length;++a)if(n[a]){i+="/"+n[a];try{_e.mkdir(i,r)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,r){return void 0===r&&(r=t,t=438),t|=8192,_e.mknod(e,t,r)},symlink:function(e,t){if(!ye.resolve(e))throw new _e.ErrnoError(44);var r=_e.lookupPath(t,{parent:!0}).node;if(!r)throw new _e.ErrnoError(44);var n=pe.basename(t),i=_e.mayCreate(r,n);if(i)throw new _e.ErrnoError(i);if(!r.node_ops.symlink)throw new _e.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:function(t,r){var n,i,a=pe.dirname(t),o=pe.dirname(r),s=pe.basename(t),l=pe.basename(r);if(n=_e.lookupPath(t,{parent:!0}).node,i=_e.lookupPath(r,{parent:!0}).node,!n||!i)throw new _e.ErrnoError(44);if(n.mount!==i.mount)throw new _e.ErrnoError(75);var u,c=_e.lookupNode(n,s),d=ye.relative(t,o);if("."!==d.charAt(0))throw new _e.ErrnoError(28);if("."!==(d=ye.relative(r,a)).charAt(0))throw new _e.ErrnoError(55);try{u=_e.lookupNode(i,l)}catch(e){}if(c!==u){var h=_e.isDir(c.mode),f=_e.mayDelete(n,s,h);if(f)throw new _e.ErrnoError(f);if(f=u?_e.mayDelete(i,l,h):_e.mayCreate(i,l))throw new _e.ErrnoError(f);if(!n.node_ops.rename)throw new _e.ErrnoError(63);if(_e.isMountpoint(c)||u&&_e.isMountpoint(u))throw new _e.ErrnoError(10);if(i!==n&&(f=_e.nodePermissions(n,"w")))throw new _e.ErrnoError(f);_e.hashRemoveNode(c);try{n.node_ops.rename(c,i,l)}catch(e){throw e}finally{_e.hashAddNode(c)}}},rmdir:function(e){var t=_e.lookupPath(e,{parent:!0}).node,r=pe.basename(e),n=_e.lookupNode(t,r),i=_e.mayDelete(t,r,!0);if(i)throw new _e.ErrnoError(i);if(!t.node_ops.rmdir)throw new _e.ErrnoError(63);if(_e.isMountpoint(n))throw new _e.ErrnoError(10);t.node_ops.rmdir(t,r),_e.destroyNode(n)},readdir:function(e){var t=_e.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new _e.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=_e.lookupPath(e,{parent:!0}).node;if(!t)throw new _e.ErrnoError(44);var r=pe.basename(e),n=_e.lookupNode(t,r),i=_e.mayDelete(t,r,!1);if(i)throw new _e.ErrnoError(i);if(!t.node_ops.unlink)throw new _e.ErrnoError(63);if(_e.isMountpoint(n))throw new _e.ErrnoError(10);t.node_ops.unlink(t,r),_e.destroyNode(n)},readlink:function(e){var t=_e.lookupPath(e).node;if(!t)throw new _e.ErrnoError(44);if(!t.node_ops.readlink)throw new _e.ErrnoError(28);return ye.resolve(_e.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var r=_e.lookupPath(e,{follow:!t}).node;if(!r)throw new _e.ErrnoError(44);if(!r.node_ops.getattr)throw new _e.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(e){return _e.stat(e,!0)},chmod:function(e,t,r){var n;"string"==typeof e?n=_e.lookupPath(e,{follow:!r}).node:n=e;if(!n.node_ops.setattr)throw new _e.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:function(e,t){_e.chmod(e,t,!0)},fchmod:function(e,t){var r=_e.getStream(e);if(!r)throw new _e.ErrnoError(8);_e.chmod(r.node,t)},chown:function(e,t,r,n){var i;"string"==typeof e?i=_e.lookupPath(e,{follow:!n}).node:i=e;if(!i.node_ops.setattr)throw new _e.ErrnoError(63);i.node_ops.setattr(i,{timestamp:Date.now()})},lchown:function(e,t,r){_e.chown(e,t,r,!0)},fchown:function(e,t,r){var n=_e.getStream(e);if(!n)throw new _e.ErrnoError(8);_e.chown(n.node,t,r)},truncate:function(e,t){if(t<0)throw new _e.ErrnoError(28);var r;"string"==typeof e?r=_e.lookupPath(e,{follow:!0}).node:r=e;if(!r.node_ops.setattr)throw new _e.ErrnoError(63);if(_e.isDir(r.mode))throw new _e.ErrnoError(31);if(!_e.isFile(r.mode))throw new _e.ErrnoError(28);var n=_e.nodePermissions(r,"w");if(n)throw new _e.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var r=_e.getStream(e);if(!r)throw new _e.ErrnoError(8);if(0==(2097155&r.flags))throw new _e.ErrnoError(28);_e.truncate(r.node,t)},utime:function(e,t,r){var n=_e.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:function(t,r,n,i,o){if(""===t)throw new _e.ErrnoError(44);var s;if(n=void 0===n?438:n,n=64&(r="string"==typeof r?_e.modeStringToFlags(r):r)?4095&n|32768:0,"object"==_typeof(t))s=t;else{t=pe.normalize(t);try{s=_e.lookupPath(t,{follow:!(131072&r)}).node}catch(e){}}var l=!1;if(64&r)if(s){if(128&r)throw new _e.ErrnoError(20)}else s=_e.mknod(t,n,0),l=!0;if(!s)throw new _e.ErrnoError(44);if(_e.isChrdev(s.mode)&&(r&=-513),65536&r&&!_e.isDir(s.mode))throw new _e.ErrnoError(54);if(!l){var u=_e.mayOpen(s,r);if(u)throw new _e.ErrnoError(u)}512&r&&_e.truncate(s,0),r&=-131713;var c=_e.createStream({node:s,path:_e.getPath(s),flags:r,seekable:!0,position:0,stream_ops:s.stream_ops,ungotten:[],error:!1},i,o);return c.stream_ops.open&&c.stream_ops.open(c),!a.logReadFiles||1&r||(_e.readFiles||(_e.readFiles={}),t in _e.readFiles||(_e.readFiles[t]=1)),c},close:function(t){if(_e.isClosed(t))throw new _e.ErrnoError(8);t.getdents&&(t.getdents=null);try{t.stream_ops.close&&t.stream_ops.close(t)}catch(e){throw e}finally{_e.closeStream(t.fd)}t.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,r){if(_e.isClosed(e))throw new _e.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new _e.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new _e.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:function(e,t,r,n,i){if(n<0||i<0)throw new _e.ErrnoError(28);if(_e.isClosed(e))throw new _e.ErrnoError(8);if(1==(2097155&e.flags))throw new _e.ErrnoError(8);if(_e.isDir(e.node.mode))throw new _e.ErrnoError(31);if(!e.stream_ops.read)throw new _e.ErrnoError(28);var a=void 0!==i;if(a){if(!e.seekable)throw new _e.ErrnoError(70)}else i=e.position;var o=e.stream_ops.read(e,t,r,n,i);return a||(e.position+=o),o},write:function(e,t,r,n,i,a){if(n<0||i<0)throw new _e.ErrnoError(28);if(_e.isClosed(e))throw new _e.ErrnoError(8);if(0==(2097155&e.flags))throw new _e.ErrnoError(8);if(_e.isDir(e.node.mode))throw new _e.ErrnoError(31);if(!e.stream_ops.write)throw new _e.ErrnoError(28);e.seekable&&1024&e.flags&&_e.llseek(e,0,2);var o=void 0!==i;if(o){if(!e.seekable)throw new _e.ErrnoError(70)}else i=e.position;var s=e.stream_ops.write(e,t,r,n,i,a);return o||(e.position+=s),s},allocate:function(e,t,r){if(_e.isClosed(e))throw new _e.ErrnoError(8);if(t<0||r<=0)throw new _e.ErrnoError(28);if(0==(2097155&e.flags))throw new _e.ErrnoError(8);if(!_e.isFile(e.node.mode)&&!_e.isDir(e.node.mode))throw new _e.ErrnoError(43);if(!e.stream_ops.allocate)throw new _e.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:function(e,t,r,n,i,a){if(0!=(2&i)&&0==(2&a)&&2!=(2097155&e.flags))throw new _e.ErrnoError(2);if(1==(2097155&e.flags))throw new _e.ErrnoError(2);if(!e.stream_ops.mmap)throw new _e.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,i,a)},msync:function(e,t,r,n,i){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,i):0},munmap:function(e){return 0},ioctl:function(e,t,r){if(!e.stream_ops.ioctl)throw new _e.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r.flags=r.flags||0,r.encoding=r.encoding||"binary","utf8"!==r.encoding&&"binary"!==r.encoding)throw new Error('Invalid encoding type "'+r.encoding+'"');var n=_e.open(e,r.flags),i=_e.stat(e),a=i.size,o=new Uint8Array(a);return _e.read(n,o,0,a,0),"utf8"===r.encoding?t=x(o,0):"binary"===r.encoding&&(t=o),_e.close(n),t},writeFile:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.flags=r.flags||577;var n=_e.open(e,r.flags,r.mode);if("string"==typeof t){var i=new Uint8Array(D(t)+1),a=O(t,i,0,i.length);_e.write(n,i,0,a,void 0,r.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");_e.write(n,t,0,t.byteLength,void 0,r.canOwn)}_e.close(n)},cwd:function(){return _e.currentPath},chdir:function(e){var t=_e.lookupPath(e,{follow:!0});if(null===t.node)throw new _e.ErrnoError(44);if(!_e.isDir(t.node.mode))throw new _e.ErrnoError(54);var r=_e.nodePermissions(t.node,"x");if(r)throw new _e.ErrnoError(r);_e.currentPath=t.path},createDefaultDirectories:function(){_e.mkdir("/tmp"),_e.mkdir("/home"),_e.mkdir("/home/web_user")},createDefaultDevices:function(){_e.mkdir("/dev"),_e.registerDevice(_e.makedev(1,3),{read:function(){return 0},write:function(e,t,r,n,i){return n}}),_e.mkdev("/dev/null",_e.makedev(1,3)),me.register(_e.makedev(5,0),me.default_tty_ops),me.register(_e.makedev(6,0),me.default_tty1_ops),_e.mkdev("/dev/tty",_e.makedev(5,0)),_e.mkdev("/dev/tty1",_e.makedev(6,0));var e=function(){if("object"==("undefined"==typeof crypto?"undefined":_typeof(crypto))&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){ee("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: function(array) { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")}}();_e.createDevice("/dev","random",e),_e.createDevice("/dev","urandom",e),_e.mkdir("/dev/shm"),_e.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){_e.mkdir("/proc");var e=_e.mkdir("/proc/self");_e.mkdir("/proc/self/fd"),_e.mount({mount:function(){var t=_e.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var r=+t,n=_e.getStream(r);if(!n)throw new _e.ErrnoError(8);var i={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return n.path}}};return i.parent=i,i}},t}},{},"/proc/self/fd")},createStandardStreams:function(){a.stdin?_e.createDevice("/dev","stdin",a.stdin):_e.symlink("/dev/tty","/dev/stdin"),a.stdout?_e.createDevice("/dev","stdout",null,a.stdout):_e.symlink("/dev/tty","/dev/stdout"),a.stderr?_e.createDevice("/dev","stderr",null,a.stderr):_e.symlink("/dev/tty1","/dev/stderr");var e=_e.open("/dev/stdin",0),t=_e.open("/dev/stdout",1),r=_e.open("/dev/stderr",1);S(0===e.fd,"invalid handle for stdin ("+e.fd+")"),S(1===t.fd,"invalid handle for stdout ("+t.fd+")"),S(2===r.fd,"invalid handle for stderr ("+r.fd+")")},ensureErrnoError:function(){_e.ErrnoError||(_e.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){for(var t in this.errno=e,be)if(be[t]===e){this.code=t;break}},this.setErrno(e),this.message=ve[e],this.stack&&(Object.defineProperty(this,"stack",{value:(new Error).stack,writable:!0}),this.stack=ce(this.stack))},_e.ErrnoError.prototype=new Error,_e.ErrnoError.prototype.constructor=_e.ErrnoError,[44].forEach((function(e){_e.genericErrors[e]=new _e.ErrnoError(e),_e.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){_e.ensureErrnoError(),_e.nameTable=new Array(4096),_e.mount(ge,{},"/"),_e.createDefaultDirectories(),_e.createDefaultDevices(),_e.createSpecialDirectories(),_e.filesystems={MEMFS:ge}},init:function(e,t,r){S(!_e.init.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),_e.init.initialized=!0,_e.ensureErrnoError(),a.stdin=e||a.stdin,a.stdout=t||a.stdout,a.stderr=r||a.stderr,_e.createStandardStreams()},quit:function(){_e.init.initialized=!1,Pe();for(var e=0;e<_e.streams.length;e++){var t=_e.streams[e];t&&_e.close(t)}},getMode:function(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r},findObject:function(e,t){var r=_e.analyzePath(e,t);return r.exists?r.object:null},analyzePath:function(t,r){try{t=(i=_e.lookupPath(t,{follow:!r})).path}catch(e){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=_e.lookupPath(t,{parent:!0});n.parentExists=!0,n.parentPath=i.path,n.parentObject=i.node,n.name=pe.basename(t),i=_e.lookupPath(t,{follow:!r}),n.exists=!0,n.path=i.path,n.object=i.node,n.name=i.node.name,n.isRoot="/"===i.path}catch(e){n.error=e.errno}return n},createPath:function(t,r,n,i){t="string"==typeof t?t:_e.getPath(t);for(var a=r.split("/").reverse();a.length;){var o=a.pop();if(o){var s=pe.join2(t,o);try{_e.mkdir(s)}catch(e){}t=s}}return s},createFile:function(e,t,r,n,i){var a=pe.join2("string"==typeof e?e:_e.getPath(e),t),o=_e.getMode(n,i);return _e.create(a,o)},createDataFile:function(e,t,r,n,i,a){var o=t;e&&(e="string"==typeof e?e:_e.getPath(e),o=t?pe.join2(e,t):e);var s=_e.getMode(n,i),l=_e.create(o,s);if(r){if("string"==typeof r){for(var u=new Array(r.length),c=0,d=r.length;c<d;++c)u[c]=r.charCodeAt(c);r=u}_e.chmod(l,146|s);var h=_e.open(l,577);_e.write(h,r,0,r.length,0,a),_e.close(h),_e.chmod(l,s)}return l},createDevice:function(t,r,n,i){var a=pe.join2("string"==typeof t?t:_e.getPath(t),r),o=_e.getMode(!!n,!!i);_e.createDevice.major||(_e.createDevice.major=64);var s=_e.makedev(_e.createDevice.major++,0);return _e.registerDevice(s,{open:function(e){e.seekable=!1},close:function(e){i&&i.buffer&&i.buffer.length&&i(10)},read:function(t,r,i,a,o){for(var s=0,l=0;l<a;l++){var u;try{u=n()}catch(e){throw new _e.ErrnoError(29)}if(void 0===u&&0===s)throw new _e.ErrnoError(6);if(null==u)break;s++,r[i+l]=u}return s&&(t.node.timestamp=Date.now()),s},write:function(t,r,n,a,o){for(var s=0;s<a;s++)try{i(r[n+s])}catch(e){throw new _e.ErrnoError(29)}return a&&(t.node.timestamp=Date.now()),s}}),_e.mkdev(a,o,s)},forceLoadFile:function(t){if(t.isDevice||t.isFolder||t.link||t.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!s)throw new Error("Cannot load without read() or XMLHttpRequest.");try{t.contents=Ae(s(t.url),!0),t.usedBytes=t.contents.length}catch(e){throw new _e.ErrnoError(29)}},createLazyFile:function(e,t,r,n,i){function a(){this.lengthKnown=!1,this.chunks=[]}if(a.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,r=e/this.chunkSize|0;return this.getter(r)[t]}},a.prototype.setDataGetter=function(e){this.getter=e},a.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",r,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+r+". Status: "+e.status);var t,n=Number(e.getResponseHeader("Content-length")),i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,a=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,o=1048576;i||(o=n);var s=this;s.setDataGetter((function(e){var t=e*o,i=(e+1)*o-1;if(i=Math.min(i,n-1),void 0===s.chunks[e]&&(s.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>n-1)throw new Error("only "+n+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",r,!1),n!==o&&i.setRequestHeader("Range","bytes="+e+"-"+t),i.responseType="arraybuffer",i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+r+". Status: "+i.status);return void 0!==i.response?new Uint8Array(i.response||[]):Ae(i.responseText||"",!0)}(t,i)),void 0===s.chunks[e])throw new Error("doXHR failed!");return s.chunks[e]})),!a&&n||(o=n=1,n=this.getter(0).length,o=n,d("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=o,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var o={isDevice:!1,url:r},s=_e.createFile(e,t,o,n,i);o.contents?s.contents=o.contents:o.url&&(s.contents=null,s.url=o.url),Object.defineProperties(s,{usedBytes:{get:function(){return this.contents.length}}});var l={};return Object.keys(s.stream_ops).forEach((function(e){var t=s.stream_ops[e];l[e]=function(){return _e.forceLoadFile(s),t.apply(null,arguments)}})),l.read=function(e,t,r,n,i){_e.forceLoadFile(s);var a=e.node.contents;if(i>=a.length)return 0;var o=Math.min(a.length-i,n);if(S(o>=0),a.slice)for(var l=0;l<o;l++)t[r+l]=a[i+l];else for(l=0;l<o;l++)t[r+l]=a.get(i+l);return o},s.stream_ops=l,s},createPreloadedFile:function(e,t,r,n,i,a,o,s,u,c){var d=t?ye.resolve(pe.join2(e,t)):e,h=J("cp "+d);function f(r){function l(r){c&&c(),s||_e.createDataFile(e,t,r,n,i,u),a&&a(),q(h)}Browser.handledByPreloadPlugin(r,d,l,(function(){o&&o(),q(h)}))||l(r)}Q(h),"string"==typeof r?function(e,t,r,n){var i=n?"":J("al "+e);l(e,(function(r){S(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),i&&q(i)}),(function(t){if(!r)throw'Loading data file "'+e+'" failed.';r()})),i&&Q(i)}(r,(function(e){return f(e)}),o):f(r)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(t,r,n){r=r||function(){},n=n||function(){};var i=_e.indexedDB();try{var a=i.open(_e.DB_NAME(),_e.DB_VERSION)}catch(e){return n(e)}a.onupgradeneeded=function(){d("creating db"),a.result.createObjectStore(_e.DB_STORE_NAME)},a.onsuccess=function(){var e=a.result.transaction([_e.DB_STORE_NAME],"readwrite"),i=e.objectStore(_e.DB_STORE_NAME),o=0,s=0,l=t.length;function u(){0==s?r():n()}t.forEach((function(e){var t=i.put(_e.analyzePath(e).object.contents,e);t.onsuccess=function(){++o+s==l&&u()},t.onerror=function(){s++,o+s==l&&u()}})),e.onerror=n},a.onerror=n},loadFilesFromDB:function(t,r,n){r=r||function(){},n=n||function(){};var i=_e.indexedDB();try{var a=i.open(_e.DB_NAME(),_e.DB_VERSION)}catch(e){return n(e)}a.onupgradeneeded=n,a.onsuccess=function(){var i=a.result;try{var o=i.transaction([_e.DB_STORE_NAME],"readonly")}catch(e){return void n(e)}var s=o.objectStore(_e.DB_STORE_NAME),l=0,u=0,c=t.length;function d(){0==u?r():n()}t.forEach((function(e){var t=s.get(e);t.onsuccess=function(){_e.analyzePath(e).exists&&_e.unlink(e),_e.createDataFile(pe.dirname(e),pe.basename(e),t.result,!0,!0,!0),++l+u==c&&d()},t.onerror=function(){u++,l+u==c&&d()}})),o.onerror=n},a.onerror=n},absolutePath:function(){ee("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder:function(){ee("FS.createFolder has been removed; use FS.mkdir instead")},createLink:function(){ee("FS.createLink has been removed; use FS.symlink instead")},joinPath:function(){ee("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc:function(){ee("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath:function(){ee("FS.standardizePath has been removed; use PATH.normalize instead")}},Ee={DEFAULT_POLLMASK:5,calculateAt:function(e,t,r){if("/"===t[0])return t;var n;if(-100===e)n=_e.cwd();else{var i=_e.getStream(e);if(!i)throw new _e.ErrnoError(8);n=i.path}if(0==t.length){if(!r)throw new _e.ErrnoError(44);return n}return pe.join2(n,t)},doStat:function(t,r,n){try{var i=t(r)}catch(e){if(e&&e.node&&pe.normalize(r)!==pe.normalize(_e.getPath(e.node)))return-54;throw e}return I[n>>2]=i.dev,I[n+4>>2]=0,I[n+8>>2]=i.ino,I[n+12>>2]=i.mode,I[n+16>>2]=i.nlink,I[n+20>>2]=i.uid,I[n+24>>2]=i.gid,I[n+28>>2]=i.rdev,I[n+32>>2]=0,ie=[i.size>>>0,(ne=i.size,+Math.abs(ne)>=1?ne>0?(0|Math.min(+Math.floor(ne/4294967296),4294967295))>>>0:~~+Math.ceil((ne-+(~~ne>>>0))/4294967296)>>>0:0)],I[n+40>>2]=ie[0],I[n+44>>2]=ie[1],I[n+48>>2]=4096,I[n+52>>2]=i.blocks,I[n+56>>2]=i.atime.getTime()/1e3|0,I[n+60>>2]=0,I[n+64>>2]=i.mtime.getTime()/1e3|0,I[n+68>>2]=0,I[n+72>>2]=i.ctime.getTime()/1e3|0,I[n+76>>2]=0,ie=[i.ino>>>0,(ne=i.ino,+Math.abs(ne)>=1?ne>0?(0|Math.min(+Math.floor(ne/4294967296),4294967295))>>>0:~~+Math.ceil((ne-+(~~ne>>>0))/4294967296)>>>0:0)],I[n+80>>2]=ie[0],I[n+84>>2]=ie[1],0},doMsync:function(e,t,r,n,i){var a=k.slice(e,e+r);_e.msync(t,a,i,r,n)},doMkdir:function(e,t){return"/"===(e=pe.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),_e.mkdir(e,t,0),0},doMknod:function(e,t,r){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return _e.mknod(e,t,r),0},doReadlink:function(e,t,r){if(r<=0)return-28;var n=_e.readlink(e),i=Math.min(r,D(n)),a=w[t+i];return L(n,t,r+1),w[t+i]=a,i},doAccess:function(e,t){if(-8&t)return-28;var r=_e.lookupPath(e,{follow:!0}).node;if(!r)return-44;var n="";return 4&t&&(n+="r"),2&t&&(n+="w"),1&t&&(n+="x"),n&&_e.nodePermissions(r,n)?-2:0},doDup:function(e,t,r){var n=_e.getStream(r);return n&&_e.close(n),_e.open(e,t,0,r,r).fd},doReadv:function(e,t,r,n){for(var i=0,a=0;a<r;a++){var o=I[t+8*a>>2],s=I[t+(8*a+4)>>2],l=_e.read(e,w,o,s,n);if(l<0)return-1;if(i+=l,l<s)break}return i},doWritev:function(e,t,r,n){for(var i=0,a=0;a<r;a++){var o=I[t+8*a>>2],s=I[t+(8*a+4)>>2],l=_e.write(e,w,o,s,n);if(l<0)return-1;i+=l}return i},varargs:void 0,get:function(){return S(null!=Ee.varargs),Ee.varargs+=4,I[Ee.varargs-4>>2]},getStr:function(e){return R(e)},getStreamFromFD:function(e){var t=_e.getStream(e);if(!t)throw new _e.ErrnoError(8);return t},get64:function(e,t){return S(e>=0?0===t:-1===t),e}};var Te=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=_e.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},Se=365,$e=146;function Ae(e,t,r){var n=r>0?r:D(e)+1,i=new Array(n),a=O(e,i,0,i.length);return t&&(i.length=a),i}Object.defineProperties(Te.prototype,{read:{get:function(){return(this.mode&Se)===Se},set:function(e){e?this.mode|=Se:this.mode&=-366}},write:{get:function(){return(this.mode&$e)===$e},set:function(e){e?this.mode|=$e:this.mode&=-147}},isFolder:{get:function(){return _e.isDir(this.mode)}},isDevice:{get:function(){return _e.isChrdev(this.mode)}}}),_e.FSNode=Te,_e.staticInit(),be={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135};var we="function"==typeof atob?atob:function(e){var t,r,n,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=s.indexOf(e.charAt(u++))<<2|(i=s.indexOf(e.charAt(u++)))>>4,r=(15&i)<<4|(a=s.indexOf(e.charAt(u++)))>>2,n=(3&a)<<6|(o=s.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(r)),64!==o&&(l+=String.fromCharCode(n))}while(u<e.length);return l};function ke(e){if(oe(e))return function(e){try{for(var t=we(e),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(ae.length))}var Ie={__assert_fail:function(e,t,r,n){ee("Assertion failed: "+R(e)+", at: "+[t?R(t):"unknown filename",r,n?R(n):"unknown function"])},__cxa_allocate_exception:function(e){return Ce(e+16)+16},__cxa_throw:function(e,t,r){throw new he(e).init(t,r),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s NO_DISABLE_EXCEPTION_CATCHING or -s EXCEPTION_CATCHING_ALLOWED=[..] to catch."},abort:function(){ee("native code called abort()")},emscripten_memcpy_big:function(e,t,r){k.copyWithin(e,t,t+r)},emscripten_resize_heap:function(e){var t=k.length;S((e>>>=0)>t);var r=2147483648;if(e>r)return h("Cannot enlarge memory, asked to go up to "+e+" bytes, but the limit is "+"2147483648 bytes!"),!1;for(var n,i,a=1;a<=4;a*=2){var o=t*(1+.2/a);o=Math.min(o,e+100663296);var s=Math.min(r,(n=Math.max(e,o))+((i=65536)-n%i)%i);if(fe(s))return h("Warning: Enlarging memory arrays, this is not fast! "+[t,s]),!0}return h("Failed to grow the heap from "+t+" bytes to "+s+" bytes, not enough memory!"),!1},fd_close:function(t){try{var r=Ee.getStreamFromFD(t);return _e.close(r),0}catch(e){if(void 0===_e||!(e instanceof _e.ErrnoError))throw e;return e.errno}},fd_read:function(t,r,n,i){try{var a=Ee.getStreamFromFD(t),o=Ee.doReadv(a,r,n);return I[i>>2]=o,0}catch(e){if(void 0===_e||!(e instanceof _e.ErrnoError))throw e;return e.errno}},fd_seek:function(t,r,n,i,a){try{var o=Ee.getStreamFromFD(t),s=4294967296*n+(r>>>0),l=9007199254740992;return s<=-l||s>=l?-61:(_e.llseek(o,s,i),ie=[o.position>>>0,(ne=o.position,+Math.abs(ne)>=1?ne>0?(0|Math.min(+Math.floor(ne/4294967296),4294967295))>>>0:~~+Math.ceil((ne-+(~~ne>>>0))/4294967296)>>>0:0)],I[a>>2]=ie[0],I[a+4>>2]=ie[1],o.getdents&&0===s&&0===i&&(o.getdents=null),0)}catch(e){if(void 0===_e||!(e instanceof _e.ErrnoError))throw e;return e.errno}},fd_write:function(t,r,n,i){try{var a=Ee.getStreamFromFD(t),o=Ee.doWritev(a,r,n);return I[i>>2]=o,0}catch(e){if(void 0===_e||!(e instanceof _e.ErrnoError))throw e;return e.errno}},getTempRet0:function(){return b},gettimeofday:function(e){var t=Date.now();return I[e>>2]=t/1e3|0,I[e+4>>2]=t%1e3*1e3|0,0},memory:_,setTempRet0:function(e){b=e}};!function(){var t={env:Ie,wasi_snapshot_preview1:Ie};function r(e,t){var r,n=e.exports;a.asm=n,S(V=a.asm.__indirect_function_table,"table not found in wasm exports"),r=a.asm.__wasm_call_ctors,j.unshift(r),q("wasm-instantiate")}Q("wasm-instantiate");var n=a;function o(e){S(a===n,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),n=null,r(e.instance)}function s(e){return(v||"function"!=typeof fetch?Promise.resolve().then((function(){return le(te)})):fetch(te,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+te+"'";return e.arrayBuffer()})).catch((function(){return le(te)}))).then((function(e){return E.instantiate(e,t)})).then((function(e){return e})).then(e,(function(e){h("failed to asynchronously prepare wasm: "+e),te.startsWith("file://")&&h("warning: Loading from a file URI ("+te+") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing"),ee(e)}))}if(a.instantiateWasm)try{return a.instantiateWasm(t,r)}catch(e){return h("Module.instantiateWasm callback failed with error: "+e),!1}(v||"function"!=typeof E.instantiateStreaming||oe(te)||"function"!=typeof fetch?s(o):fetch(te,{credentials:"same-origin"}).then((function(e){return E.instantiateStreaming(e,t).then(o,(function(e){return h("wasm streaming compile failed: "+e),h("falling back to ArrayBuffer instantiation"),s(o)}))}))).catch(i)}(),a.___wasm_call_ctors=se("__wasm_call_ctors");var Ce=a._malloc=se("malloc");a._parseMPD=se("parseMPD"),a._updatePreloadInfo=se("updatePreloadInfo"),a._updateDeviceInfo=se("updateDeviceInfo"),a._updateMediaInfo=se("updateMediaInfo"),a._updateBufferInfo=se("updateBufferInfo"),a._updateSwitchInfo=se("updateSwitchInfo"),a._updatePreloadSupplier=se("updatePreloadSupplier"),a._getPredictedBitrate=se("getPredictedBitrate"),a._getPreloadBitrate=se("getPreloadBitrate"),a._setDebugModel=se("setDebugModel"),a._free=se("free"),a.___errno_location=se("__errno_location");var Pe=a.___stdio_exit=se("__stdio_exit"),xe=a._emscripten_stack_init=function(){return(xe=a._emscripten_stack_init=a.asm.emscripten_stack_init).apply(null,arguments)};a._emscripten_stack_get_free=function(){return(a._emscripten_stack_get_free=a.asm.emscripten_stack_get_free).apply(null,arguments)},a._emscripten_stack_get_base=function(){return(a._emscripten_stack_get_base=a.asm.emscripten_stack_get_base).apply(null,arguments)};var Re,Oe=a._emscripten_stack_get_end=function(){return(Oe=a._emscripten_stack_get_end=a.asm.emscripten_stack_get_end).apply(null,arguments)},Le=a.stackSave=se("stackSave"),De=a.stackRestore=se("stackRestore"),Me=a.stackAlloc=se("stackAlloc");function Ne(e){function t(){Re||(Re=!0,a.calledRun=!0,T||(B(),S(!X),X=!0,a.noFSInit||_e.init.initialized||_e.init(),_e.ignorePermissions=!1,ue(j),n(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),S(!a._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(B(),a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),W.unshift(e);var e;ue(W)}()))}H>0||(xe(),Z(),function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),F.unshift(e);var e;ue(F)}(),H>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),t()}),1)):t(),B()))}if(a.dynCall_jiji=se("dynCall_jiji"),g("intArrayFromString",!1),g("intArrayToString",!1),a.ccall=$,a.cwrap=function(e,t,r,n){return function(){return $(e,t,r,arguments)}},g("setValue",!1),g("getValue",!1),g("allocate",!1),g("UTF8ArrayToString",!1),g("UTF8ToString",!1),g("stringToUTF8Array",!1),g("stringToUTF8",!1),g("lengthBytesUTF8",!1),g("stackTrace",!1),g("addOnPreRun",!1),g("addOnInit",!1),g("addOnPreMain",!1),g("addOnExit",!1),g("addOnPostRun",!1),g("writeStringToMemory",!1),a.writeArrayToMemory=M,g("writeAsciiToMemory",!1),g("addRunDependency",!0),g("removeRunDependency",!0),g("FS_createFolder",!1),g("FS_createPath",!0),g("FS_createDataFile",!0),g("FS_createPreloadedFile",!0),g("FS_createLazyFile",!0),g("FS_createLink",!1),g("FS_createDevice",!0),g("FS_unlink",!0),g("getLEB",!1),g("getFunctionTables",!1),g("alignFunctionTables",!1),g("registerFunctions",!1),g("addFunction",!1),g("removeFunction",!1),g("getFuncWrapper",!1),g("prettyPrint",!1),g("dynCall",!1),g("getCompilerSetting",!1),a.print=d,g("printErr",!1),g("getTempRet0",!1),g("setTempRet0",!1),g("callMain",!1),g("abort",!1),g("keepRuntimeAlive",!1),g("zeroMemory",!1),g("stringToNewUTF8",!1),g("emscripten_realloc_buffer",!1),g("ENV",!1),g("withStackSave",!1),g("ERRNO_CODES",!1),g("ERRNO_MESSAGES",!1),g("setErrNo",!1),g("inetPton4",!1),g("inetNtop4",!1),g("inetPton6",!1),g("inetNtop6",!1),g("readSockaddr",!1),g("writeSockaddr",!1),g("DNS",!1),g("getHostByName",!1),g("Protocols",!1),g("Sockets",!1),g("getRandomDevice",!1),g("traverseStack",!1),g("convertFrameToPC",!1),g("UNWIND_CACHE",!1),g("saveInUnwindCache",!1),g("convertPCtoSourceLocation",!1),g("readAsmConstArgsArray",!1),g("readAsmConstArgs",!1),g("mainThreadEM_ASM",!1),g("jstoi_q",!1),g("jstoi_s",!1),g("getExecutableName",!1),g("listenOnce",!1),g("autoResumeAudioContext",!1),g("dynCallLegacy",!1),g("getDynCaller",!1),g("dynCall",!1),g("callRuntimeCallbacks",!1),g("setWasmTableEntry",!1),g("getWasmTableEntry",!1),g("handleException",!1),g("runtimeKeepalivePush",!1),g("runtimeKeepalivePop",!1),g("callUserCallback",!1),g("maybeExit",!1),g("safeSetTimeout",!1),g("asmjsMangle",!1),g("asyncLoad",!1),g("alignMemory",!1),g("mmapAlloc",!1),g("reallyNegative",!1),g("unSign",!1),g("reSign",!1),g("formatString",!1),g("PATH",!1),g("PATH_FS",!1),g("SYSCALLS",!1),g("getSocketFromFD",!1),g("getSocketAddress",!1),g("JSEvents",!1),g("registerKeyEventCallback",!1),g("specialHTMLTargets",!1),g("maybeCStringToJsString",!1),g("findEventTarget",!1),g("findCanvasEventTarget",!1),g("getBoundingClientRect",!1),g("fillMouseEventData",!1),g("registerMouseEventCallback",!1),g("registerWheelEventCallback",!1),g("registerUiEventCallback",!1),g("registerFocusEventCallback",!1),g("fillDeviceOrientationEventData",!1),g("registerDeviceOrientationEventCallback",!1),g("fillDeviceMotionEventData",!1),g("registerDeviceMotionEventCallback",!1),g("screenOrientation",!1),g("fillOrientationChangeEventData",!1),g("registerOrientationChangeEventCallback",!1),g("fillFullscreenChangeEventData",!1),g("registerFullscreenChangeEventCallback",!1),g("registerRestoreOldStyle",!1),g("hideEverythingExceptGivenElement",!1),g("restoreHiddenElements",!1),g("setLetterbox",!1),g("currentFullscreenStrategy",!1),g("restoreOldWindowedStyle",!1),g("softFullscreenResizeWebGLRenderTarget",!1),g("doRequestFullscreen",!1),g("fillPointerlockChangeEventData",!1),g("registerPointerlockChangeEventCallback",!1),g("registerPointerlockErrorEventCallback",!1),g("requestPointerLock",!1),g("fillVisibilityChangeEventData",!1),g("registerVisibilityChangeEventCallback",!1),g("registerTouchEventCallback",!1),g("fillGamepadEventData",!1),g("registerGamepadEventCallback",!1),g("registerBeforeUnloadEventCallback",!1),g("fillBatteryEventData",!1),g("battery",!1),g("registerBatteryEventCallback",!1),g("setCanvasElementSize",!1),g("getCanvasElementSize",!1),g("demangle",!1),g("demangleAll",!1),g("jsStackTrace",!1),g("stackTrace",!1),g("getEnvStrings",!1),g("checkWasiClock",!1),g("writeI53ToI64",!1),g("writeI53ToI64Clamped",!1),g("writeI53ToI64Signaling",!1),g("writeI53ToU64Clamped",!1),g("writeI53ToU64Signaling",!1),g("readI53FromI64",!1),g("readI53FromU64",!1),g("convertI32PairToI53",!1),g("convertU32PairToI53",!1),g("setImmediateWrapped",!1),g("clearImmediateWrapped",!1),g("polyfillSetImmediate",!1),g("uncaughtExceptionCount",!1),g("exceptionLast",!1),g("exceptionCaught",!1),g("ExceptionInfo",!1),g("CatchInfo",!1),g("exception_addRef",!1),g("exception_decRef",!1),g("Browser",!1),g("funcWrappers",!1),g("getFuncWrapper",!1),g("setMainLoop",!1),g("wget",!1),g("FS",!1),g("MEMFS",!1),g("TTY",!1),g("PIPEFS",!1),g("SOCKFS",!1),g("_setNetworkCallback",!1),g("tempFixedLengthArray",!1),g("miniTempWebGLFloatBuffers",!1),g("heapObjectForWebGLType",!1),g("heapAccessShiftForWebGLHeap",!1),g("GL",!1),g("emscriptenWebGLGet",!1),g("computeUnpackAlignedImageSize",!1),g("emscriptenWebGLGetTexPixelData",!1),g("emscriptenWebGLGetUniform",!1),g("webglGetUniformLocation",!1),g("webglPrepareUniformLocationsBeforeFirstUse",!1),g("webglGetLeftBracePos",!1),g("emscriptenWebGLGetVertexAttrib",!1),g("writeGLArray",!1),g("AL",!1),g("SDL_unicode",!1),g("SDL_ttfContext",!1),g("SDL_audio",!1),g("SDL",!1),g("SDL_gfx",!1),g("GLUT",!1),g("EGL",!1),g("GLFW_Window",!1),g("GLFW",!1),g("GLEW",!1),g("IDBStore",!1),g("runAndAbortIfError",!1),g("warnOnce",!1),g("stackSave",!1),g("stackRestore",!1),g("stackAlloc",!1),g("AsciiToString",!1),g("stringToAscii",!1),g("UTF16ToString",!1),g("stringToUTF16",!1),g("lengthBytesUTF16",!1),g("UTF32ToString",!1),g("stringToUTF32",!1),g("lengthBytesUTF32",!1),g("allocateUTF8",!1),g("allocateUTF8OnStack",!1),a.writeStackCookie=Z,a.checkStackCookie=B,g("intArrayFromBase64",!1),g("tryParseAsDataURI",!1),m("ALLOC_NORMAL",!1),m("ALLOC_STACK",!1),Y=function e(){Re||Ne(),Re||(Y=e)},a.run=Ne,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return Ne(),r.ready}}(),Abr=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).isOpenAutoDefi=!1,n.config=null,n.init(),n}return _createClass$k(r,[{key:"init",value:function(){var e=this.playerData.options.autoBitrateOpts;this.config=e;var t=null==e?void 0:e.isOpenAutoDefi;if(util$2.checkIsObject(e)&&t){this.isOpenAutoDefi=t;var r=_objectSpread2$c({module:abrAlgo},e||{});if(this.isEnableMp4EncryptPlugin()){var n=this.playerData.options.Mp4EncryptPlayer||{};this.playerData.options.Mp4EncryptPlayer=_objectSpread2$c({autoBitrateOpts:r},n)}if(this.isEnableDashPlugin()){var i=this.playerData.options.DASHPlugin||{};this.playerData.options.DASHPlugin=_objectSpread2$c({autoBitrateOpts:r},i)}}}},{key:"afterPlayerCreate",value:function(){this.isOpenAutoDefi&&this.abrMonitor()}},{key:"isEnableMp4EncryptPlugin",value:function(){var e,t=this.playerData.getCurrentStreamType(),r=isEncryptPlay(null===(e=this.playerData.config)||void 0===e?void 0:e.getVideoByToken),n=this.playerData.options,i=n.autoBitrateOpts,a=n.Mp4EncryptPlayer,o=n.enableMp4MSE;return"mp4"===t&&r||"mp4"===t&&(null==i?void 0:i.isOpenAutoDefi)||a||o}},{key:"isEnableDashPlugin",value:function(){return"dash"===this.playerData.getCurrentStreamType()||this.playerData.options.DASHPlugin}},{key:"abrMonitor",value:function(){var e=this;this.player.on("ABR_AUTO_DESC_CHANGE",(function(t,r,n,i){var a=e.player.root.querySelector(".xgplayer-definition [url='__auto__']");a&&(a.innerHTML=r?t+"".concat(r?"(".concat(r,")"):""):t)}))}}],[{key:"pluginName",get:function(){return"Abr"}}]),r}(SdkPlugin),sdkPluginManager={init:function(e){var t;e&&(null!==(t=e.playerData)&&void 0!==t&&t.isLive?e.sdkPlugins=[]:e.sdkPlugins=[AuthToken,Abr],e._sdkPlugins={})},registerPlugin:function(e,t){if(e&&t){var r=null,n=null;e.plugin&&"function"==typeof e.plugin?(r=e.plugin,n=e.options):(r=e,n={}),n.sdk=t;var i=n.pluginName||r.pluginName;if(!i)throw new Error("The property pluginName is necessary");var a=t._sdkPlugins;try{a[i.toLowerCase()]&&this.unRegister(i);var o=new r(n);return a[i.toLowerCase()]=o,a[i.toLowerCase()].func=r,o&&"function"==typeof o.afterCreate&&o.afterCreate(),o}catch(s){console.error(s)}}},unRegister:function(e,t){if(e&&t){e=e.toLowerCase();try{var r=t._sdkPlugins[e];r&&(r.pluginName&&r.__destroy(),delete t._sdkPlugins[e])}catch(n){console.error(n)}}},beforePlayerCreate:function(t){if(t){t._sdkPlugins||this.init(t);for(var r=t._sdkPlugins,n=[],i=0,a=Object.keys(r);i<a.length;i++){var o=a[i];if(r[o]&&r[o].beforePlayerCreate)try{var s=r[o].beforePlayerCreate();n.push(retPromise$1(s))}catch(e){throw n.push(retPromise$1(null)),e}}return new Promise((function(e){Promise.all([].concat(n)).then((function(){e(null)})).catch((function(t){console.error(t),e(null)}))}))}},afterPlayerCreate:function(t){if(t)for(var r=t._sdkPlugins,n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];if(r[a]&&r[a].beforePlayerCreate)try{r[a].afterPlayerCreate()}catch(e){throw e}}},destroy:function(e){if(e){for(var t=e._sdkPlugins,r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];this.unRegister(i,e)}delete e._sdkPlugins}}};const name="@volcengine/veplayer",version="1.3.5",main="dist/index.min.js",module$1="dist/index.min.js",typings="dist/index.d.ts",sideEffects=["*.css","*.less"],files=["dist"],scripts={"test:e2e":"echo 'test'",lint:"npx lint-staged",dev:"libd dev demo","dev:vod":"libd dev demo/vod","dev:hth":"libd dev fixtures/hth",build:"libd build",release:"libd release",doc:"docg",changelog:"libd changelog -s"},author="",license="BSD-3-Clause",devDependencies={"@byted/docg":"^0.5.1","@byted/docg-plugin-sdkhub":"^0.1.5","@byted/libd":"^1.1.13","@commitlint/cli":"^16.2.1","@commitlint/config-conventional":"^16.2.1","@types/lodash":"^4.14.178","@typescript-eslint/eslint-plugin":"^5.12.0","@typescript-eslint/parser":"^5.12.0","cross-env":"^7.0.3",eslint:"^8.9.0","eslint-config-prettier":"^6.7.0","eslint-plugin-jest":"^23.20.0","eslint-plugin-prettier":"^3.1.0","git-cz":"^4.7.6",husky:"^8.0.1",less:"^4.1.2","lint-staged":"^11.1.2","node-fetch":"2.6.2","postcss-less":"^6.0.0",prettier:"^2.2.1",shelljs:"^0.8.5",stylelint:"^14.5.2","stylelint-config-standard":"^24.0.0","stylelint-prettier":"^2.0.0",typescript:"^4.5.5"},dependencies={"@byted/danmu-mask":"^0.3.4","@byted/streamprobe":"^1.0.0","@byted/xgplayer-app-logger":"^0.11.8","@byted/xgplayer-encrypt":"3.0.45","@byted/xgplayer-encrypt-hls":"4.0.3","@byted/xgplayer-encrypt-mp4":"3.0.0-alpha.36-7","@byted/xgplayer-live-logger":"1.0.0-alpha.9","@byted/xgplayer-rts":"0.1.0","@byted/xgplayer-vod-abralgo":"^1.0.3","@byted/xgplayer-vod-menu":"3.0.3","@byted/xgplayer-xgvideo":"0.1.15","danmu.js":"^0.6.3",dayjs:"^1.11.6","dom-helpers":"^5.2.1",eventemitter3:"^4.0.7","js-cookie":"^3.0.1","lodash-es":"^4.17.21","proxy-polyfill":"^0.3.2",semver:"^7.3.7",xgplayer:"3.0.0-next.38-0","xgplayer-flv":"3.0.0-next.15","xgplayer-hls":"3.0.0-next.28","xgplayer-service":"^0.4.2","xgplayer-shaka":"^3.0.0-alpha.1","xgplayer-subtitles":"^1.0.22"},publishConfig={tag:"latest"};var pkgJson={name:name,version:version,main:main,module:module$1,typings:typings,sideEffects:sideEffects,files:files,scripts:scripts,author:author,license:license,devDependencies:devDependencies,dependencies:dependencies,"lint-staged":{"*.{less}":'stylelint --fix "src/**/*.less" --custom-syntax postcss-less',"*.{js,jsx,ts,tsx}":["eslint --fix"]},publishConfig:publishConfig};function concatBuffer(e){var t=e.reduce((function(e,t){return e+t.byteLength}),0),r=new Uint8Array(t),n=0;return e.forEach((function(e){r.set(e,n),n+=e.byteLength})),r}function timeFixed(e,t){return parseFloat(null==e?void 0:e.toFixed(t||4))}var __defProp$6=Object.defineProperty,__defNormalProp$6=function(e,t,r){return t in e?__defProp$6(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField$6=function(e,t,r){return __defNormalProp$6(e,"symbol"!==_typeof$b(t)?t+"":t,r),r},PACKET_TYPE={SCRIPT:"ScriptData",SEQUENCE:"Sequence_Header",RAW:"RawData"},AUDIO_RATE=[5500,11e3,22e3,44e3],AUDIO_CODEC_TYPE={AAC:"aac",PCMA:"pcma",PCMU:"pcmu"},VIDEO_CODEC_TYPE={AVC:"avc",HEVC:"bytevc1"},FlvTagView=function(){function e(t){var r=this;_classCallCheck$j(this,e),__publicField$6(this,"type",0),__publicField$6(this,"tagSize",0),__publicField$6(this,"timestamp",0),__publicField$6(this,"duration",0),__publicField$6(this,"header",null),__publicField$6(this,"body",null),__publicField$6(this,"bodyView",null),__publicField$6(this,"tailsize",null),Object.keys(t).forEach((function(e){r[e]=t[e]}))}return _createClass$k(e,[{key:"streamType",get:function(){switch(this.type){case 18:return"scriptData";case 9:return"video";case 8:return"audio"}}},{key:"packetType",get:function(){var e;return null==(e=this.bodyView)?void 0:e.packetType}},{key:"frameType",get:function(){var e;return null==(e=this.bodyView)?void 0:e.frameType},set:function(e){this.bodyView.frameType=e}},{key:"dts",get:function(){return this.timestamp}},{key:"pts",get:function(){var e;return((null==(e=this.bodyView)?void 0:e.cts)||0)+this.timestamp}},{key:"ptsTime",get:function(){return this.pts?timeFixed(this.pts/1e3):0}},{key:"dtsTime",get:function(){return this.dts?timeFixed(this.dts/1e3):0}},{key:"sampleView",get:function(){var e,t,r;if("Sequence_Header"!==(null==(e=this.bodyView)?void 0:e.packetType)&&18!==this.type)return{dts:this.timestamp,pts:((null==(t=this.bodyView)?void 0:t.cts)||0)+this.timestamp,data:this._getSampleData(),units:null==(r=this.bodyView)?void 0:r.units}}},{key:"size",get:function(){var e,t;return null==(t=null==(e=this.sampleView)?void 0:e.data)?void 0:t.length}},{key:"data",get:function(){return this._getSampleData()}},{key:"nalTypes",get:function(){var e,t;return null==(t=null==(e=this.bodyView)?void 0:e.units)?void 0:t.map((function(e){return e.type}))}},{key:"nalSizes",get:function(){var e,t;return null==(t=null==(e=this.bodyView)?void 0:e.units)?void 0:t.map((function(e){return e.unit.length}))}},{key:"keyframe",get:function(){return"I"===this.frameType}},{key:"isSample",get:function(){return"scriptData"!==this.streamType&&"Sequence_Header"!==this.packetType}},{key:"isVideo",get:function(){return this.isSample&&"video"===this.streamType}},{key:"isAudio",get:function(){return this.isSample&&"audio"===this.streamType}},{key:"isSqHeader",get:function(){return"Sequence_Header"===this.packetType}},{key:"timescale",get:function(){return 1e3}},{key:"isHevc",get:function(){var e;return"bytevc1"===(null==(e=this.bodyView)?void 0:e.codecType)}},{key:"_getSampleData",value:function(){var e;if("audio"===this.streamType)return this.bodyView.sample;var t=(null==(e=this.bodyView)?void 0:e.units.filter((function(e){return!e.isSei})))||[],r=t.reduce((function(e,t){return e+(t.unit.byteLength+4)}),0),n=new Uint8Array(r),i=0;return t.forEach((function(e){n.set([0,0,0,1],i),i+=4,n.set(e.unit,i),i+=e.unit.byteLength})),n}}]),e}(),UTF8=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,null,[{key:"decode",value:function(t){for(var r=[],n=t,i=0,a=t.length;i<a;)if(n[i]<128)r.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(e._checkContinuation(n,i,1)){var o=(31&n[i])<<6|63&n[i+1];if(o>=128){r.push(String.fromCharCode(65535&o)),i+=2;continue}}}else if(n[i]<240){if(e._checkContinuation(n,i,2)){var s=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(s>=2048&&55296!=(63488&s)){r.push(String.fromCharCode(65535&s)),i+=3;continue}}}else if(n[i]<248&&e._checkContinuation(n,i,3)){var l=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(l>65536&&l<1114112){l-=65536,r.push(String.fromCharCode(l>>>10|55296)),r.push(String.fromCharCode(1023&l|56320)),i+=4;continue}}r.push(String.fromCharCode(65533)),++i}return r.join("")}},{key:"_checkContinuation",value:function(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return!1;return!0}return!1}}]),e}(),AMF=function(){function t(){_classCallCheck$j(this,t)}return _createClass$k(t,null,[{key:"parse",value:function(r){if(!(r.length<3)){var n={},i=t._parseValue(new DataView(r.buffer,r.byteOffset,r.byteLength));try{var a=t._parseValue(new DataView(r.buffer,r.byteOffset+i.size,r.byteLength-i.size));n[i.data]=a.data}catch(e){}return n}}},{key:"_parseValue",value:function(e){var r,n=e.byteLength,i=1,a=!1;switch(e.getUint8(0)){case 0:r=e.getFloat64(1),i+=8;break;case 1:r=!!e.getUint8(1),i+=1;break;case 2:var o=t._parseString(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i));r=o.data,i+=o.size;break;case 3:r={};var s=0;for(9==(16777215&e.getUint32(n-4))&&(s=3);i<n-4;){var l=t._parseObject(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i-s)),u=l.size,c=l.data;if(l.isEnd)break;r[c.name]=c.value,i+=u}if(i<=n-3)9===(16777215&e.getUint32(i-1))&&(i+=3);break;case 8:r={},i+=4;var d=0;for(9==(16777215&e.getUint32(n-4))&&(d=3);i<n-8;){var h=t._parseObject(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i-d)),f=h.size,p=h.data;if(h.isEnd)break;r[p.name]=p.value,i+=f}if(i<=n-3)9===(16777215&e.getUint32(i-1))&&(i+=3);break;case 9:r=void 0,i=1,a=!0;break;case 10:r=[];var y=e.getUint32(1);i+=4;for(var m=0;m<y;m++){var g=t._parseValue(new DataView(e.buffer,e.byteOffset+i,e.byteLength-i)),v=g.data,b=g.size;r.push(v),i+=b}break;case 11:var _=e.getFloat64(i)+6e4*e.getInt16(i+8);r=new Date(_),i+=10;break;case 12:var E=e.getUint32(1);i+=4,r="",E>0&&(r=UTF8.decode(new Uint8Array(e.buffer,e.byteOffset+i,E))),i+=E;break;default:i=n}return{data:r,size:i,isEnd:a}}},{key:"_parseString",value:function(e){var t=e.getUint16(0),r="";return t>0&&(r=UTF8.decode(new Uint8Array(e.buffer,e.byteOffset+2,t))),{data:r,size:2+t}}},{key:"_parseObject",value:function(e){if(!(e.byteLength<3)){var r=t._parseString(e),n=t._parseValue(new DataView(e.buffer,e.byteOffset+r.size,e.byteLength-r.size));return{data:{name:r.data,value:n.data},size:r.size+n.size,isEnd:n.isEnd}}}}]),t}(),isBrowser="undefined"!=typeof window,ua=isBrowser&&navigator.userAgent.toLocaleLowerCase();isBrowser&&/^((?!chrome|android).)*safari/.test(ua);var isFirefox=isBrowser&&ua.includes("firefox"),isAndroid=isBrowser&&ua.includes("android"),__defProp$5=Object.defineProperty,__defNormalProp$5=function(e,t,r){return t in e?__defProp$5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField$5=function(e,t,r){return __defNormalProp$5(e,"symbol"!==_typeof$b(t)?t+"":t,r),r},_AAC=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,null,[{key:"parseADTS",value:function(t,r){for(var n=t.length,i=0;i+2<n&&(255!==t[i]||240!=(246&t[i+1]));)i++;if(!(i>=n)){var a=i,o=[],s=(60&t[i+2])>>>2,l=e.FREQ[s];if(!l)throw new Error("Invalid sampling index: ".concat(s));for(var u,c,d=1+((192&t[i+2])>>>6),h=(1&t[i+2])<<2|(192&t[i+3])>>>6,f=e._getConfig(s,h,d),p=f.config,y=f.codec,m=0,g=e.getFrameDuration(l);i+7<n;)if(255===t[i]&&240==(246&t[i+1])){if(n-i<(c=(3&t[i+3])<<11|t[i+4]<<3|(224&t[i+5])>>5))break;u=2*(1&~t[i+1]);var v=timeFixed(r+m*g);o.push({pts:v,dts:v,ptsTime:timeFixed(v/9e4),dtsTime:timeFixed(v/9e4),data:t.subarray(i+7+u,i+c)}),m++,i+=c}else i++;return{skip:a,remaining:i>=n?void 0:t.subarray(i),frames:o,nbFrame:o.length,samplingFrequencyIndex:s,sampleRate:l,objectType:d,channelCount:h,codec:y,config:p,originCodec:"mp4a.40.".concat(d)}}}},{key:"parseAudioSpecificConfig",value:function(t){if(t.length){var r=t[0]>>>3,n=(7&t[0])<<1|t[1]>>>7,i=(120&t[1])>>>3,a=e.FREQ[n];if(!a)throw new Error("Invalid sampling index: ".concat(n));var o=e._getConfig(n,i,r);return{samplingFrequencyIndex:n,sampleRate:a,objectType:r,channelCount:i,config:o.config,codec:o.codec,originCodec:"mp4a.40.".concat(r)}}}},{key:"getFrameDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return 1024*t/e}},{key:"_getConfig",value:function(e,t,r){var n,i,a=[];return isFirefox?e>=6?(n=5,i=e-3):(n=2,i=e):isAndroid?(n=2,i=e):(n=r,i=e,e>=6?i=e-3:1===t&&(n=2,i=e)),a[0]=n<<3,a[0]|=(14&e)>>1,a[1]=(1&e)<<7,a[1]|=t<<3,5===n&&(a[1]|=(14&i)>>1,a[2]=(1&i)<<7,a[2]|=8,a[3]=0),{config:a,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}(),AAC=_AAC;__publicField$5(AAC,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var __defProp$4=Object.defineProperty,__defNormalProp$4=function(e,t,r){return t in e?__defProp$4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField$4=function(e,t,r){return __defNormalProp$4(e,"symbol"!==_typeof$b(t)?t+"":t,r),r},ExpGolomb=function(){function e(t){if(_classCallCheck$j(this,e),__publicField$4(this,"_bytesAvailable"),__publicField$4(this,"_bitsAvailable",0),__publicField$4(this,"_word",0),!t)throw new Error("ExpGolomb data params is required");this._data=t,this._bytesAvailable=t.byteLength,this._bytesAvailable&&this._loadWord()}return _createClass$k(e,[{key:"_loadWord",value:function(){var e=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(0===t)throw new Error("No bytes available");var r=new Uint8Array(4);r.set(this._data.subarray(e,e+t)),this._word=new DataView(r.buffer).getUint32(0),this._bitsAvailable=8*t,this._bytesAvailable-=t}},{key:"skipBits",value:function(e){if(this._bitsAvailable>e)this._word<<=e,this._bitsAvailable-=e;else{e-=this._bitsAvailable;var t=Math.floor(e/8);e-=8*t,this._bytesAvailable-=t,this._loadWord(),this._word<<=e,this._bitsAvailable-=e}}},{key:"readBits",value:function(e){if(e>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,e),r=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),(t=e-t)>0&&this._bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this._bitsAvailable;++e)if(0!=(this._word&2147483648>>>e))return this._word<<=e,this._bitsAvailable-=e,e;return this._loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}},{key:"firstMbInSlice",value:function(){return this.readUByte(),this.readUEG()}}]),e}();function readBig32(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e[t]<<24>>>0)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]||0)}function getFrameTypeFor264(e){var t=new ExpGolomb(e).readSliceType();return 2===t||4===t||7===t||9===t?"I":0===t||3===t||5===t||8===t?"P":1===t||6===t?"B":void 0}var NALu=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,null,[{key:"parseAnnexB",value:function(e){for(var t=e.length,r=2,n=0;null!==e[r]&&1!==e[r];)r++;if((n=++r+2)>=t)return[];for(var i=[];n<t;)switch(e[n]){case 0:if(0!==e[n-1]){n+=2;break}if(0!==e[n-2]){n++;break}r!==n-2&&i.push(e.subarray(r,n-2));do{n++}while(1!==e[n]&&n<t);n=(r=n+1)+2;break;case 1:if(0!==e[n-1]||0!==e[n-2]){n+=3;break}r!==n-2&&i.push(e.subarray(r,n-2)),n=(r=n+1)+2;break;default:n+=3}return r<t&&i.push(e.subarray(r)),i}},{key:"parseNalu",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(!(e.length<4)){for(var r,n=e.length,i=[],a=0;a+t<n;)if(r=readBig32(e,a),3===t&&(r>>>=8),a+=t,r){if(a+r>n)break;i.push(e.subarray(a,a+r)),a+=r}return i}}},{key:"parseNaluType",value:function(e,t){return null==e?void 0:e.map((function(e){var r=t?e[0]>>>1&63:31&e[0],n=t&&(39===r||40===r),i={type:r,unit:e,isSei:n=n||!t&&6===r};switch(r){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!t&&5!==r||t&&5===r)break;i.frameType="I"}return t||1!==r||(i.frameType=getFrameTypeFor264(e)),!t||0!==r&&1!==r||(i.frameType="P"),!t&&r<=5&&(i.firstMbInSlice=new ExpGolomb(e).firstMbInSlice()),t&&r<=21&&(i.firstMbInSlice=128==(128&e[2])),i}))}},{key:"parseSEI",value:function(e){for(var t=e.length,r=1,n=0,i=0,a="";255===e[r];)n+=255,r++;for(n+=e[r++];255===e[r];)i+=255,r++;if(i+=e[r++],5===n&&t>r+16)for(var o=0;o<16;o++)a+=e[r].toString(16),r++;return{payload:e.subarray(r),type:n,size:i,uuid:a}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(!r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a}}]),e}(),AVC=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(t){if(!(t.length<7)){for(var r,n,i=1+(3&t[4]),a=[],o=[],s=6,l=31&t[5],u=0;u<l;u++)if(n=t[s]<<8|t[s+1],s+=2,n){var c=t.subarray(s,s+n);s+=n,a.push(c),r||(r=e.parseSPS(NALu.removeEPB(c)))}var d,h=t[s];s++;for(var f=0;f<h;f++)d=t[s]<<8|t[s+1],s+=2,d&&(o.push(t.subarray(s,s+d)),s+=d);return{sps:r,spsArr:a,ppsArr:o,nalUnitSize:i}}}},{key:"parseSPS",value:function(e){var t=new ExpGolomb(e);t.readUByte();var r=t.readUByte(),n=t.readUByte(),i=t.readUByte();t.skipUEG();var a=420;if(100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r){var o=t.readUEG();if(o<=3&&(a=[0,420,422,444][o]),3===o&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var s=3!==o?8:12,l=0;l<s;l++)t.readBool()&&(l<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var u=t.readUEG();if(0===u)t.readUEG();else if(1===u){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var c=t.readUEG(),d=0;d<c;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var h=t.readUEG(),f=t.readUEG(),p=t.readBits(1);0===p&&t.skipBits(1),t.skipBits(1);var y,m,g,v,b,_=0,E=0,T=0,S=0;if(t.readBool()&&(_=t.readUEG(),E=t.readUEG(),T=t.readUEG(),S=t.readUEG()),t.readBool()){if(t.readBool())switch(t.readUByte()){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:y=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()]}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var $=t.readBits(32),A=t.readBits(32);m=t.readBool(),b=(g=A)/(v=2*$)}}for(var w=e.subarray(1,4),k="avc1.",I=0;I<3;I++){var C=w[I].toString(16);C.length<2&&(C="0".concat(C)),k+=C}return{codec:k,profileIdc:r,profileCompatibility:n,levelIdc:i,chromaFormat:a,width:Math.ceil(16*(h+1)-2*(_+E)),height:(2-p)*(f+1)*16-(p?2:4)*(T+S),sarRatio:y,fpsNum:g,fpsDen:v,fps:b,fixedFrame:m}}}]),e}(),HEVC=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){if(!(t.length<23)){for(var r,n,i,a,o=1+(3&t[21]),s=[],l=[],u=[],c=23,d=t[22],h=0;h<d;h++){n=63&t[c],i=t[c+1]<<8|t[c+2],c+=3;for(var f=0;f<i;f++)if(a=t[c]<<8|t[c+1],c+=2,a){switch(n){case 32:u.push(t.subarray(c,c+a));break;case 33:var p=t.subarray(c,c+a);r||(r=e.parseSPS(NALu.removeEPB(p))),s.push(p);break;case 34:l.push(t.subarray(c,c+a))}c+=a}}return{sps:r,spsArr:s,ppsArr:l,vpsArr:u,nalUnitSize:o}}}},{key:"parseSPS",value:function(e){var t=new ExpGolomb(e);t.readUByte(),t.readUByte(),t.readBits(4);var r=t.readBits(3);t.readBits(1);var n=this._parseProfileTierLevel(t,r);t.readUEG();var i=t.readUEG(),a=420;i<=3&&(a=[0,420,422,444][i]);var o=0;3===i&&(o=t.readBits(1));var s,l,u,c,d=t.readUEG(),h=t.readUEG(),f=t.readBits(1);(1===f&&(s=t.readUEG(),l=t.readUEG(),u=t.readUEG(),c=t.readUEG()),1===f)&&(d-=(1!==i&&2!==i||0!==o?1:2)*(l+s),h-=(1===i&&0===o?2:1)*(c+u));return{codec:"hev1.1.6.L93.B0",width:d,height:h,chromaFormat:a,bitDepthLumaMinus8:t.readUEG(),bitDepthChromaMinus8:t.readUEG(),generalProfileSpace:n.generalProfileSpace,generalTierFlag:n.generalTierFlag,generalProfileIdc:n.generalProfileIdc,generalLevelIdc:n.generalLevelIdc}}},{key:"_parseProfileTierLevel",value:function(e,t){var r,n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;a&&(r=e.readBits(2),n=e.readBits(1),i=e.readBits(5)),e.readBits(32),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(16),e.readBits(16),e.readBits(12);for(var o=e.readUByte(),s=[],l=[],u=0;u<t;u++)s[u]=e.readBits(1),l[u]=e.readBits(1);t>0&&e.readBits(2*(8-t));for(var c=0;c<t;c++)0!==s[c]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==l[c]&&e.readBits(8);return{generalProfileSpace:r,generalTierFlag:n,generalProfileIdc:i,generalLevelIdc:o}}}]),e}();function addRelativeTime(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.items.filter((function(e){return e.isSample&&e.isVideo}))[0],n=e.items.filter((function(e){return e.isSample&&e.isAudio}))[0],i=Math.min((null==n?void 0:n.dtsTime)||0,(null==r?void 0:r.dtsTime)||0);return i-=t,e.items.forEach((function(e){e.time=timeFixed(e.dtsTime-i)})),e}function getRates(e){var t=e.items.filter((function(e){return e.isVideo})),r=[],n=-1,i={},a={};return t.forEach((function(e,o){(e.keyframe||o===t.length-1)&&(n=-1===n?e.time:n,r.push({time:e.time,value:timeFixed(e.time-n)}),n=e.time);var s=Math.ceil(e.time+1e-5);i[s]?i[s]++:i[s]=1,a[s]?a[s]+=8*e.size:a[s]=8*e.size})),{bitRates:_adapter(a),gops:r.filter((function(e){return e.value})),frameRates:_adapter(i)}}function _adapter(e){return Object.keys(e).map((function(t){return{time:Number(t),value:e[t]}}))}function topThreeFrameSize(e){var t=e.slice().filter((function(e){return e.isSample})).sort((function(e,t){return e.time>t.time?1:-1})).slice(0,3).reduce((function(e,t){return e+t.size}),0);return t>1e3?timeFixed(t/1e3)+"KB":t+"B"}function avgBitrate(e){return e.reduce((function(e,t){return e+t.size}),0)/e.reduce((function(e,t){return e+t.duration}),0)*8e3}function getProfile(e){if(null==e?void 0:e.profileIdc)switch(e.profileIdc){case 66:return"66(Baseline)";case 77:return"77(Main)";case 100:return"100(High)"}}var __defProp$3=Object.defineProperty,__defNormalProp$3=function(e,t,r){return t in e?__defProp$3(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField$3=function(e,t,r){return __defNormalProp$3(e,"symbol"!==_typeof$b(t)?t+"":t,r),r},Flv$1=function(){function e(){_classCallCheck$j(this,e),__publicField$3(this,"_nalUnitSize",0),__publicField$3(this,"_lastAudio",null),__publicField$3(this,"_lastVideo",null),__publicField$3(this,"_videoStartDts",-1),__publicField$3(this,"_audioStartDts",-1)}return _createClass$k(e,[{key:"parse",value:function(e){for(var t=e.byteLength,r=e.subarray(0,13),n=13,i=_objectSpread2$c(_objectSpread2$c({header:r},this._parseHeader(r)),{},{items:[]});n+11<t;){var a=e.subarray(n,n+11),o=a[1]<<16|a[2]<<8|a[3],s=n+11+o;if(s>t)break;var l=e.subarray(n+11,s),u=new FlvTagView(_objectSpread2$c({tagSize:11+o+4,header:a,body:l,tailsize:e.subarray(s,s+4)},this._parseTag(a,l)));u.isAudio&&(this._lastAudio&&(this._lastAudio.duration=u.dts-this._lastAudio.dts),this._lastAudio=u),u.isVideo&&(this._lastVideo&&(this._lastVideo.duration=u.dts-this._lastVideo.dts),this._lastVideo=u),i.items.push(u),n=s+4}var c=addRelativeTime(i);return c.rates=getRates(c),this._addMetadataToFirstKeyFrame(c),c}},{key:"getSnapshoot",value:function(t,r){var n,i=t.items.filter((function(e){return 8===e.type}))[0],a=t.items.filter((function(e){return 9===e.type}))[0],o=i&&i.bodyView||i,s=a&&a.bodyView||a,l=t.items.filter((function(e){return e.isVideo})).length,u=this._getNbFrame(t,"I"),c=this._getNbFrame(t,"P"),d=this._getNbFrame(t,"B"),h=0;if(null==r?void 0:r.gopCacheBuffer){var f=(new e).parse(r.gopCacheBuffer).items.filter((function(e){return e.isVideo})),p=null==(n=f[f.length-1])?void 0:n.time;p&&(h=p-r.take/1e3)}return{rates:t.rates,audio:o?Object.assign({},o,this._getExt(t,"audio")):null,video:s?Object.assign({},s,this._getExt(t,"video"),{topThreeFrameSize:topThreeFrameSize(t.items),gopCache:timeFixed(h),profile:getProfile(s.sps),iFrames:u,pFrames:c,bFrames:d,iPercent:timeFixed(u/l*100),pPercent:timeFixed(c/l*100),bPercent:timeFixed(d/l*100)}):null}}},{key:"_addMetadataToFirstKeyFrame",value:function(e){var t,r=e.items.filter((function(e){return 9===e.type}))[0];if(r&&(null==(t=r.bodyView)?void 0:t.sps)){var n=e.items.filter((function(e){return e.isVideo&&e.keyframe}))[0];n&&(n.bodyView.sps=r.bodyView.sps,n.bodyView.vpsArr=r.bodyView.vpsArr,n.bodyView.spsArr=r.bodyView.spsArr,n.bodyView.ppsArr=r.bodyView.ppsArr)}}},{key:"_getExt",value:function(e,t){var r,n=e.items.filter((function(e){return e.streamType===t&&e.isSample})),i=e.items.filter((function(e){var r;return e.streamType===t&&(null==(r=e.bodyView)?void 0:r.packetType)===PACKET_TYPE.SEQUENCE}))[0];if(!n.length)return 0;var a=n[0],o=n[n.length-1],s=0;return"audio"===t&&(s=i&&1024/(null==(r=i.bodyView)?void 0:r.sampleRate)*1e3),"video"===t&&(s=a.duration),{avgBits:avgBitrate(n),startDts:n[0].dts,duration:(o.timestamp-a.timestamp)/1e3,refDuration:s,frameLength:n.length}}},{key:"_getNbFrame",value:function(e,t){return e.items.filter((function(e){return e.isVideo&&e.frameType===t})).length}},{key:"_parseHeader",value:function(e){return{hasAudio:!!(e[4]>>2&1),hasVideo:!!(1&e[4])}}},{key:"_parseTag",value:function(e,t){var r,n=31&e[0],i=(e[7]<<24>>>0)+(e[4]<<16)+(e[5]<<8)+e[6];switch(n){case 18:r=Object.assign({packetType:PACKET_TYPE.SCRIPT},AMF.parse(t));break;case 9:r=this._parseVideo(t,i);break;case 8:r=this._parseAudio(t,i)}return{type:n,timestamp:i,bodyView:r}}},{key:"_parseAudio",value:function(e){if(e.length){var t=(240&e[0])>>>4;if(10===t||7===t||8===t){if(10!==t){var r=(12&e[0])>>2,n=(2&e[0])>>1,i=1&e[0];return _objectSpread2$c({format:t,sampleRate:AUDIO_RATE[r],sampleSize:n?2:1,channelCount:i+1},this._parseG711(e))}return this._parseAac(e,t)}console.warn("Unsupported sound format: ".concat(t))}}},{key:"_parseG711",value:function(e,t){return{codecType:7===t?AUDIO_CODEC_TYPE.PCMA:AUDIO_CODEC_TYPE.PCMU,sampleRate:8e3,sample:e.subarray(1),packetType:PACKET_TYPE.RAW}}},{key:"_parseAac",value:function(e,t){if(0===e[1]){var r=e.subarray(2);return _objectSpread2$c(_objectSpread2$c({},AAC.parseAudioSpecificConfig(r)),{},{format:t,timescale:1e3,codecType:AUDIO_CODEC_TYPE.AAC,packetType:PACKET_TYPE.SEQUENCE,sequenceData:[r],frameType:"A"})}if(1===e[1])return{sample:e.subarray(2),format:t,codecType:AUDIO_CODEC_TYPE.AAC,packetType:PACKET_TYPE.RAW,frameType:"A"}}},{key:"_parseVideo",value:function(e,t){if(!(e.length<6)){var r=(240&e[0])>>>4,n=15&e[0];if(7===n||12===n){var i=12===n,a=e[1],o=(e[2]<<16|e[3]<<8|e[4])<<8>>8;if(0===a){var s=e.subarray(5),l=i?HEVC.parseHEVCDecoderConfigurationRecord(s):AVC.parseAVCDecoderConfigurationRecord(s);return this._nalUnitSize=l.nalUnitSize,_objectSpread2$c({codecId:n,codecType:i?VIDEO_CODEC_TYPE.HEVC:VIDEO_CODEC_TYPE.AVC,packetType:PACKET_TYPE.SEQUENCE,timescale:1e3,sequenceData:[s]},l)}if(1===a){var u=NALu.parseNalu(e.subarray(5),this._nalUnitSize);if(!u||!u.length)return;var c={dts:t,cts:o,units:u=NALu.parseNaluType(u,i)};return 1===r&&(c.keyframe=!0),u.forEach((function(e){var t=e.type,r=e.unit,n=e.frameType;switch(t){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!i&&5!==t||i&&5===t)break;c.keyframe=!0,c.frameType="I";break;case 6:case 39:case 40:if(!i&&6!==t||i&&6===t)break;c.seis?c.seis.push(NALu.parseSEI(NALu.removeEPB(r))):c.seis=[NALu.parseSEI(NALu.removeEPB(r))];break;case 32:if(!i)break;c.vpsArr?c.vpsArr.push(r):c.vpsArr=[r];break;case 7:case 33:if(!i&&7!==t||i&&7===t)break;c.spsArr?c.spsArr.push(r):c.spsArr=[r];var a=NALu.removeEPB(r);c.sps=i?HEVC.parseSPS(a):AVC.parseSPS(a);break;case 8:case 34:if(!i&&8!==t||i&&8===t)break;c.ppsArr?c.ppsArr.push(r):c.ppsArr=[r];break;case 1:case 0:c.frameType=n}})),_objectSpread2$c({codecId:n,codecType:i?VIDEO_CODEC_TYPE.HEVC:VIDEO_CODEC_TYPE.AVC,packetType:PACKET_TYPE.RAW},c)}}else console.warn("Unsupported codecId: ".concat(n))}}}]),e}();function tsProbe(e){for(var t=Math.min(1e3,e.byteLength-564),r=0;r<t;r++)if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;return-1}function getBoxType(e,t){return[e[t],e[t+1],e[t+2],e[t+3]].map((function(e){return String.fromCharCode(e)})).join("")}var __defProp$2=Object.defineProperty,__defNormalProp$2=function(e,t,r){return t in e?__defProp$2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField$2=function(e,t,r){return __defNormalProp$2(e,"symbol"!==_typeof$b(t)?t+"":t,r),r},PacketHeaderView=_createClass$k((function e(t){var r=t.startIndictor,n=t.packetType,i=t.pid,a=t.afc;_classCallCheck$j(this,e),__publicField$2(this,"startIndictor",0),__publicField$2(this,"pid",0),__publicField$2(this,"afc",0),__publicField$2(this,"eleInfo",null),__publicField$2(this,"packetType",""),this.startIndictor=r,this.packetType=n,this.pid=i,this.afc=a})),TsPacketView=function(){function e(t){var r=t.header,n=t.headerObject,i=t.body,a=t.eleInfo,o=t.bodyView,s=t.headerView;_classCallCheck$j(this,e),__publicField$2(this,"header",null),__publicField$2(this,"headerView",null),__publicField$2(this,"body",null),__publicField$2(this,"bodyView",null),__publicField$2(this,"eleInfo",null),__publicField$2(this,"duration",0),this.header=r,this.headerView=s||new PacketHeaderView(n),this.eleInfo=a,this.body=i,this.bodyView=o}return _createClass$k(e,[{key:"type",get:function(){var e;return null==(e=this.headerView)?void 0:e.packetType}},{key:"streamType",get:function(){return this.eleInfo?this.eleInfo[this.headerView.pid]:""}},{key:"packetType",get:function(){var e;return null==(e=this.headerView)?void 0:e.packetType}},{key:"frameType",get:function(){var e;return null==(e=this.bodyView)?void 0:e.frameType}},{key:"pts",get:function(){var e;return null==(e=this.bodyView)?void 0:e.pts}},{key:"ptsTime",get:function(){return this.pts?timeFixed(this.pts/9e4):0}},{key:"dtsTime",get:function(){return this.dts?timeFixed(this.dts/9e4):0}},{key:"dts",get:function(){var e;return null==(e=this.bodyView)?void 0:e.dts}},{key:"keyframe",get:function(){return"I"===this.frameType}},{key:"nalTypes",get:function(){var e,t;return null==(t=null==(e=this.bodyView)?void 0:e.units)?void 0:t.map((function(e){return e.type}))}},{key:"nalSizes",get:function(){var e,t;return null==(t=null==(e=this.bodyView)?void 0:e.units)?void 0:t.map((function(e){return e.unit.length}))}},{key:"isSample",get:function(){return"PES"===this.packetType}},{key:"timescale",get:function(){return 9e4}},{key:"isHevc",get:function(){var e,t;return"bytevc1"===(null==(t=null==(e=this.eleInfo)?void 0:e.video)?void 0:t.codecType)}},{key:"sampleView",get:function(){var e;if("PES"===this.type)return{dts:this.dts,pts:this.pts,units:null==(e=this.bodyView)?void 0:e.units,data:this._getSampleData()}}},{key:"data",get:function(){return this._getSampleData()}},{key:"size",get:function(){var e,t;return null==(t=null==(e=this.sampleView)?void 0:e.data)?void 0:t.length}},{key:"isVideo",get:function(){return this.isSample&&"video"===this.streamType}},{key:"isAudio",get:function(){return this.isSample&&"audio"===this.streamType}},{key:"_getSampleData",value:function(){var e;if("audio"===this.streamType)return this.bodyView.data;var t=(null==(e=this.bodyView)?void 0:e.units.filter((function(e){return!e.isSei&&!e.isDivision})))||[],r=t.reduce((function(e,t){return e+(t.unit.byteLength+4)}),0),n=new Uint8Array(r),i=0;return t.forEach((function(e){n.set([0,0,0,1],i),i+=4,n.set(e.unit,i),i+=e.unit.byteLength})),n}}]),e}(),TsParser=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,[{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=tsProbe(e);if(-1===r)throw new Error("invalid ts file");var n=e.byteLength;n-=(n-r)%188;for(var i,a=[],o=[],s=[],l=0,u=r;u<n;){var c=e.subarray(u,u+188),d=c.subarray(0,4),h=this._parseTsHeader(c.subarray(0,4));u+=188;var f=void 0,p=void 0,y=4,m="";switch((null==h?void 0:h.afc)>1&&(y+=1+Math.min(c[y],183)),h.pid){case 0:y+=1+c[y],f=c.subarray(y),m="PAT",p={pmtId:l=this._parsePAT(f)};break;default:if(h.pid===l){y+=1+c[y],f=c.subarray(y),p=i=this._parsePMT(f),m="PMT";break}if(!i||!i[h.pid])continue;f=c.subarray(y),m="PES"}if(h.packetType=m,"PES"===m){var g="video"===i[h.pid]?o:s;h.startIndictor&&g.length&&(a.push(new TsPacketView(_objectSpread2$c(_objectSpread2$c({},this._concatPesChunk(g)),{},{eleInfo:i}))),g="video"===i[h.pid]?o=[]:s=[]),g.push({header:d,headerObject:h,body:f})}else a.push(new TsPacketView({header:d,headerObject:h,body:f,eleInfo:i,bodyView:p}))}o.length&&(a.push(new TsPacketView(_objectSpread2$c(_objectSpread2$c({},this._concatPesChunk(o)),{},{eleInfo:i}))),o=[]),s.length&&(a.push(new TsPacketView(_objectSpread2$c(_objectSpread2$c({},this._concatPesChunk(s)),{},{eleInfo:i}))),s=[]);var v={items:this._parsePES(a)},b=addRelativeTime(v,t);return b.rates=getRates(b),b}},{key:"getSnapshoot",value:function(e){var t,r,n,i=e.items,a=e.rates,o=i.filter((function(e){return"video"===e.streamType})),s=i.filter((function(e){return"audio"===e.streamType})),l=i.find((function(e){return"PMT"===e.type})),u=o[0],c=s[0],d=o.length,h=this._getNbFrame(o,"I"),f=this._getNbFrame(o,"P"),p=this._getNbFrame(o,"B"),y={rates:a,video:u?Object.assign({},null==u?void 0:u.bodyView,{codecType:u.eleInfo.video.codecType,frameLength:d,topThreeFrameSize:topThreeFrameSize(i),avgBits:avgBitrate(o),profile:getProfile(null==(t=null==u?void 0:u.bodyView)?void 0:t.sps),iFrames:h,pFrames:f,bFrames:p,iPercent:timeFixed(h/d*100),pPercent:timeFixed(f/d*100),bPercent:timeFixed(p/d*100),timescale:9e4},this._getDuration(o,"video")):null,audio:c?Object.assign({},null==c?void 0:c.bodyView,{codecType:c.eleInfo.audio.codecType,frameLength:s.length,timescale:9e4,avgBits:avgBitrate(s)},this._getDuration(s,"audio")):null};return l&&(null==(r=l.bodyView)?void 0:r.noSupported)&&(y.noSupported=null==(n=l.bodyView)?void 0:n.noSupported),y}},{key:"getRates",value:function(e){return getRates(e)}},{key:"_getDuration",value:function(e,t){var r,n=e[0],i=e[e.length-1],a=0;return"audio"===t&&(a=1024/(null==(r=n.bodyView)?void 0:r.sampleRate)*1e3),"video"===t&&(a=n.duration),{duration:(i.pts-n.pts)/9e4,refDuration:a}}},{key:"_getNbKeyFrame",value:function(e){return e.filter((function(e){var t;return null==(t=e.bodyView)?void 0:t.keyframe})).length}},{key:"_getNbFrame",value:function(e,t){return e.filter((function(e){return e.frameType===t})).length}},{key:"_parseTsHeader",value:function(e){if(71===e[0]){var t={};return t.startIndictor=(64&e[1])>>6,t.pid=((31&e[1])<<8)+e[2],t.afc=(48&e[3])>>4,t}return null}},{key:"_parsePAT",value:function(e){return(31&e[10])<<8|e[11]}},{key:"_parsePMT",value:function(e){var t=0,r=3+((15&e[1])<<8|e[2])-4;e[3],e[4],t=t+11+((15&e[10])<<8|e[11])+1;for(var n,i={video:null,audio:null,noSupported:0};t<r;){n=e[t];var a=(31&e[t+1])<<8|e[t+2];switch(n){case 27:case 36:i.video={elePid:a,streamType:n,codecType:27===n?"avc":"bytevc1"},i[a]="video";break;case 15:i.audio={elePid:a,streamType:n,codecType:"aac"},i[a]="audio";break;default:i.noSupported=n,console.warn("unsupported streamType,",n)}t+=5+((15&e[t+3])<<8|e[t+4])}return i}},{key:"_concatPesChunk",value:function(e){var t=e.reduce((function(e,t){return e+t.body.byteLength}),0),r=new Uint8Array(t),n=0;return e.forEach((function(e){var t=e.body;r.set(t,n),n+=t.byteLength})),_objectSpread2$c(_objectSpread2$c({},e[0]),{},{body:r,packetType:"PES"})}},{key:"_parsePES",value:function(e){var t=this,r=[];return e.forEach((function(e,n){if(e.isSample){var i=e,a=t._parsePESInternal(i.body)||{},o=a.data,s=a.pts,l=a.dts;if(o){if(e.isVideo&&(i.bodyView=t._parseVideoFrame(o,s,l,"bytevc1"===i.eleInfo.video.codecType),t._lastVideo&&(t._lastVideo.duration=1e3*(e.dtsTime-t._lastVideo.dtsTime)),t._lastVideo=i),e.isAudio){var u=AAC.parseADTS(o,s),c=u.frames;return delete u.frames,void(null==c||c.forEach((function(e){var n=new TsPacketView(Object.assign({},i,{bodyView:_objectSpread2$c(_objectSpread2$c(_objectSpread2$c({},u),e),{},{frameType:"A"})}));r.push(n),t._lastAudio&&(t._lastAudio.duration=1e3*(n.dtsTime-t._lastAudio.dtsTime)),t._lastAudio=n})))}r.push(e)}}else r.push(e)})),r}},{key:"_parsePESInternal",value:function(e){var t=e[8];if(!(0===t||e.length<t+9)&&1===(e[0]<<16|e[1]<<8|e[2])){var r=(e[4]<<8)+e[5];if(!(r&&r>e.length-6)){var n,i,a=e[7];return 192&a&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&a?n-(i=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(n=i):i=n),i=i||n,{data:e.subarray(9+t),pts:n,dts:i}}}}},{key:"_parseVideoFrame",value:function(e,t,r,n){var i=NALu.parseAnnexB(e);if(i.length){var a={units:i=NALu.parseNaluType(i,n),pts:t,dts:r};return i.forEach((function(e){var t=e.unit,r=e.type,i=e.frameType;switch(r){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!n&&5!==r||n&&5===r)break;a.keyframe=!0,a.frameType="I";break;case 6:case 39:case 40:if(!n&&6!==r||n&&6===r)break;a.seis?a.seis.push(NALu.parseSEI(NALu.removeEPB(t))):a.seis=[NALu.parseSEI(NALu.removeEPB(t))];break;case 32:if(!n)break;a.vpsArr?a.vpsArr.push(t):a.vpsArr=[t];break;case 7:case 33:if(!n&&7!==r||n&&7===r)break;a.spsArr?a.spsArr.push(t):a.spsArr=[t];var o=NALu.removeEPB(t);a.sps=n?HEVC.parseSPS(o):AVC.parseSPS(o);break;case 8:case 34:if(!n&&8!==r||n&&8===r)break;a.ppsArr?a.ppsArr.push(t):a.ppsArr=[t];break;case 9:case 35:break;case 0:case 1:a.frameType=i}})),a}}}]),e}(),ByteReader=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck$j(this,e),this._offset=r,this._buffer=t,this._length=t.byteLength}return _createClass$k(e,[{key:"offset",get:function(){return this._offset},set:function(e){this._offset=e}},{key:"forward",value:function(e){this._offset+=e}},{key:"subarray",value:function(e){return e?this._buffer.subarray(this._offset,this._offset+e):this._buffer.subarray(this._offset,e)}},{key:"slice",value:function(e){for(var t=this._offset,r=this._buffer,n=[],i=0;i<e;i++)n.push(r[t+i]);return new Uint8Array(n)}},{key:"readU8",value:function(){return this._buffer[this._offset]}},{key:"readU16",value:function(){var e=this._offset,t=this._buffer;return t[e]<<8|t[e+1]}},{key:"readU24",value:function(){var e=this._offset,t=this._buffer;return t[e]<<16|t[e+1]<<8|t[e+12]}},{key:"readU32",value:function(){var e=this._offset,t=this._buffer;return t[e]*(1<<24)+65536*t[e+1]+256*t[e+2]+t[e+3]}},{key:"read32",value:function(){var e=this._offset,t=this._buffer;return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}}]),e}(),__defProp$1=Object.defineProperty,__defNormalProp$1=function(e,t,r){return t in e?__defProp$1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField$1=function(e,t,r){return __defNormalProp$1(e,"symbol"!==_typeof$b(t)?t+"":t,r),r},Mp4View=function(){function e(t,r,n,i,a,o,s,l,u,c){_classCallCheck$j(this,e),__publicField$1(this,"dts",0),__publicField$1(this,"pts",0),__publicField$1(this,"units",null),__publicField$1(this,"timescale",0),__publicField$1(this,"offset",0),__publicField$1(this,"duration",0),__publicField$1(this,"data",null),__publicField$1(this,"size",0),__publicField$1(this,"streamType",""),__publicField$1(this,"_frameType",""),__publicField$1(this,"isHevc",!1),this.dts=t,this.pts=r,this.units=n,this.timescale=i,this.offset=a,this.data=o,this.size=s,this.duration=l,this.streamType=u,this.isHevc=c}return _createClass$k(e,[{key:"isSample",get:function(){return!0}},{key:"dtsTime",get:function(){return this.dts/this.timescale}},{key:"ptsTime",get:function(){return this.pts/this.timescale}},{key:"frameType",get:function(){var e;return"audio"===this.streamType?"A":this._frameType||(null==(e=this.units)?void 0:e.map((function(e){return e.frameType})).filter(Boolean)[0])},set:function(e){this._frameType=e}},{key:"nalTypes",get:function(){var e;return null==(e=this.units)?void 0:e.map((function(e){return e.type}))}},{key:"nalSizes",get:function(){var e;return null==(e=this.units)?void 0:e.map((function(e){return e.unit.length}))}},{key:"keyframe",get:function(){return"I"===this.frameType}},{key:"isVideo",get:function(){return"video"===this.streamType}},{key:"isAudio",get:function(){return"audio"===this.streamType}}]),e}(),BOX_TYPE_DESC={ftyp:"file type and compatibility",free:"free box",moov:"container for all metadata",mvhd:"movie header,overall declarations",trak:"container for an individual track or stream",tkhd:"track header,overall information about the track",tref:"track reference container",mdia:"container for the media information in a track",mdhd:"media header,oervall information about the media",hdlr:"declares the media type",minf:"media information container",vmhd:"video media header",smhd:"sound media header",dinf:"data information box",stbl:"sample table box",stsd:"sample descriptions(codec types, etc)",stts:"decoding time to sample",ctts:"compostion time to sample",cslg:"compostion to decode timeline mapping",stsc:"sample to chunk",stsz:"sample size",stco:"chunk offset",stss:"sync sample table",sdtp:"independent abd disposable samples",sbgp:"sample to group",mvex:"movid extends box",moof:"movie fragment",mfhd:"movie fragment header",traf:"track fragment",tfhd:"track fragment header",trun:"track fragment run",tfdt:"track fragment decode time",mdat:"media data",meta:"metadata",avc1:"h264 codec info box",hev1:"hevc codec info box"};function parseSampleFlag(e,t){return{isLeading:(12&e[t])>>2,dependsOn:3&e[t],isDenpendedOn:(192&e[t+1])>>6,hasRedundancy:(48&e[t+1])>>4,padding:(14&e[t+1])>>1,nonSync:1&e[t+1],degradationPriority:e[t+2]<<8|e[t+3]}}function parseTfFlags(e){var t=_slicedToArray$7(e,3),r=t[1],n=t[2];return{dataOffsetPresent:!!(1&n),firstSampleFlagsPresent:!!(4&n),sampleDurationPresent:!!(1&r),sampleSizePresent:!!((2&r)>>1),sampleFlagsPresent:!!((4&r)>>2),sampleCompositionTimeOffsetPresent:!!((8&r)>>3)}}function _getBoxType(e,t){return[e[t],e[t+1],e[t+2],e[t+3]].map((function(e){return String.fromCharCode(e)})).join("")}function splitBox(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=[],n=0;n<e.byteLength;){var i=e[n]*(1<<24)+65536*e[n+1]+256*e[n+2]+e[n+3];if(1===i){var a=_getBoxType(e,n+4);if("mdat"===a){var o=new DataView(e.buffer),s=o.getUint32(n+8)*Math.pow(2,32)+o.getUint32(n+12);console.log("".concat(a,": largesize=").concat(s)),i=s}}if(i){var l=e.subarray(n,n+i),u=_getBoxType(l,4);r.push({size:i,length:l.byteLength,start:n+t,type:u,sizetypeRepresent:l.subarray(0,8).slice(),body:l.subarray(8),typeDes:BOX_TYPE_DESC[u]||""}),n+=i}else n+=4}return r}function findBox(e,t,r){if(e)for(var n=0;n<e.length;n++){var i=e[n];if(i.type===t){if(!r)return i;if(r(i))return i}if(i.bodyView instanceof Array){var a=findBox(i.bodyView,t,r);if(a){if(!r)return a;if(r(a))return a}}}}function _getTrack(e,t){return findBox(e,"trak",(function(e){var r=findBox(e.bodyView,"hdlr");return r&&r.bodyView.handlerType===t}))}function extractMp4Samples(e,t,r){var n,i,a,o,s,l,u,c,d,h,f,p,y,m=_getTrack(e,t);if(!m)return null;var g=findBox(m.bodyView,"stbl"),v=findBox(m.bodyView,"mdhd")||{},b=(null==(i=null==(n=g.bodyView.filter((function(e){return"stts"===e.type}))[0])?void 0:n.bodyView)?void 0:i.entries)||[];null==(o=null==(a=g.bodyView.filter((function(e){return"stss"===e.type}))[0])?void 0:a.bodyView)||o.entries;var _=(null==(l=null==(s=g.bodyView.filter((function(e){return"ctts"===e.type}))[0])?void 0:s.bodyView)?void 0:l.entries)||[],E=(null==(c=null==(u=g.bodyView.filter((function(e){return"stsc"===e.type}))[0])?void 0:u.bodyView)?void 0:c.entries)||[],T=(null==(h=null==(d=g.bodyView.filter((function(e){return"stsz"===e.type}))[0])?void 0:d.bodyView)?void 0:h.entries)||[],S=(null==(p=null==(f=g.bodyView.filter((function(e){return"stco"===e.type}))[0])?void 0:f.bodyView)?void 0:p.entries)||[],$=!!findBox(g.bodyView,"hvcC"),A="vide"===t;if(!E.length||!S.length||!T.length)return[];for(var w,k=v.bodyView,I=k.timescale,C=void 0===I?1:I,P=k.duration,x=T.length,R=S.length,O=1,L=0,D=[],M=_assemblyTimestamp(x,b,_);O<=R;){var N=E[L];(null==N?void 0:N.firstChunk)!==O?(D.push(Object.assign({},w,{firstChunk:O,offset:S[O-1]})),O++):(D.push(_objectSpread2$c(_objectSpread2$c({},N),{},{offset:S[O-1]})),w=N,O++,L++)}var G=T.map((function(e,t){var n=D[0],i=n.offset;n.offset+=e,n.samplesPreChunk--,n.samplesPreChunk||D.shift();var a=M[t],o=r.subarray(i,i+e);if(A){var s=NALu.parseNalu(o);return new Mp4View(a.dts,a.pts,NALu.parseNaluType(s,$),C,i,o,e,0,"video",$)}return new Mp4View(a.dts,a.pts,null,C,i,o,e,0,"audio")}));G.reduce((function(e,t){return e?(e.duration=(t.dts-e.dts)/C*1e3,t):t}),null);var V=null==(y=findBox(null==m?void 0:m.bodyView,"vide"===t?$?"hvcC":"avcC":"mp4a"))?void 0:y.bodyView;return _objectSpread2$c(_objectSpread2$c(_objectSpread2$c({samples:G,iFrames:G.filter((function(e){return"I"===e.frameType})).length,pFrames:G.filter((function(e){return"P"===e.frameType})).length,bFrames:G.filter((function(e){return"B"===e.frameType})).length},v.bodyView),{},{frameLength:x,duration:P/C,timescale:C},V),null==V?void 0:V.ests)}function _assemblyTimestamp(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=0,i=0,a=0,o=0,s=0,l=[];for(t=t.map((function(e){return _objectSpread2$c({},e)})),r=r.map((function(e){return _objectSpread2$c({},e)}));a<e;){var u=t[n],c=r[i];u.sampleCount&&(o+=u.sampleDelta),u.sampleCount--,u.sampleCount||n++,c&&(s=c.sampleOffset,c.sampleCount--,c.sampleCount||i++),l.push({dts:o,pts:o+s}),a++}return l}function _getTrackInfo(e){var t,r,n,i,a=_getTrack(e,"vide"),o=_getTrack(e,"soun"),s=findBox(null==a?void 0:a.bodyView,"tkhd"),l=findBox(null==o?void 0:o.bodyView,"tkhd"),u=findBox(null==a?void 0:a.bodyView,"mdhd"),c=findBox(null==o?void 0:o.bodyView,"mdhd"),d=findBox(null==a?void 0:a.bodyView,"avcC")||findBox(null==a?void 0:a.bodyView,"hvcC"),h=findBox(null==o?void 0:o.bodyView,"mp4a"),f=o?_objectSpread2$c(_objectSpread2$c(_objectSpread2$c({type:"audio",trackId:null==(r=l.bodyView)?void 0:r.trackId},c.bodyView),null==h?void 0:h.bodyView),null==(n=null==h?void 0:h.bodyView)?void 0:n.ests):null,p=a?_objectSpread2$c(_objectSpread2$c({type:"video",trackId:null==(i=s.bodyView)?void 0:i.trackId},null==u?void 0:u.bodyView),null==d?void 0:d.bodyView):null;return _defineProperty$j(t={},(null==f?void 0:f.trackId)||0,f),_defineProperty$j(t,(null==p?void 0:p.trackId)||0,p),t}function extractFmp4Samples(e,t){var r=_getTrackInfo(e),n=e.findIndex((function(e){return"moof"===e.type}));if(-1===n)return!1;r.lastVdts=-1,r.lastAdts=-1;for(var i=n;i<e.length&&"moof"===e[i].type;i+=2){var a=e[i];e[i+1].bodyView=_moofMdatPair(a,t,r)}return!0}function _moofMdatPair(e,t,r){return e.bodyView.filter((function(e){return"traf"===e.type})).map((function(e){var t=findBox(e.bodyView,"tfhd"),n=findBox(e.bodyView,"tfdt"),i=findBox(e.bodyView,"trun");if(t&&i){var a=t.bodyView.trackId;return _objectSpread2$c({trackId:a,baseDataOffset:t.bodyView.baseDataOffset,defaultSampleDuration:t.bodyView.defaultSampleDuration,defaultSampleSize:t.bodyView.defaultSampleSize,baseMediaDecodeTime:n.bodyView.baseMediaDecodeTime,dataOffset:i.bodyView.dataOffset,samples:i.bodyView.samples,sampleCount:i.bodyView.sampleCount},r[a])}})).filter(Boolean).map((function(e){var r=e.baseDataOffset,n=e.defaultSampleDuration,i=void 0===n?0:n,a=e.defaultSampleSize,o=void 0===a?0:a,s=e.dataOffset,l=e.baseMediaDecodeTime,u=void 0===l?0:l,c=e.samples,d=e.sps,h=e.timescale,f=e.type,p=r+s,y=0;return e.samples=c.map((function(e){var r=t.subarray(p,p+e.size);y+=e.duration||i;var n=u+y;if("video"===f){var a="hev1.1.6.L93.B0"===(null==d?void 0:d.codec),s=NALu.parseNalu(r);return p+=e.size,new Mp4View(n,n+(e.ctOffset||0),NALu.parseNaluType(s,a),h,p,r,e.size||o,(e.duration||i)/h*1e3,"video",a)}return p+=e.size,new Mp4View(n,n+(e.ctOffset||0),null,h,p,r,e.size||o,(e.duration||i)/h*1e3,"audio")})),e.frameLength=e.samples.length,e.duration=y/h,e.iFrames=e.samples.filter((function(e){return"I"===e.frameType})).length,e.pFrames=e.samples.filter((function(e){return"P"===e.frameType})).length,e.bFrames=e.samples.filter((function(e){return"B"===e.frameType})).length,e}))}function avc1(e){var t=e.body,r=e.start,n=new ByteReader(t);return 16,4,50,n.forward(78),splitBox(n.subarray(),r+78+8)}function avcC$1(e){var t=e.body,r={spsArr:[],ppsArr:[]},n=new ByteReader(t);r.configVersion=t[0],r.avcProfile=t[1],r.profileComptibility=t[2],r.avcLevel=t[3],n.forward(4),n.forward(1);var i=31&n.slice(1);n.forward(1);for(var a=0;a<i;a++){var o=n.readU16();n.forward(2),r.spsArr.push(n.subarray(o)),n.forward(o)}var s=n.slice(1);n.forward(1);for(var l=0;l<s;l++){var u=n.readU16();n.forward(2),r.ppsArr.push(n.subarray(u)),n.forward(u)}return r}function avcC(e){var t=e.body;if(!(t.length<23)){t[21];for(var r,n,i,a=[],o=[],s=[],l=23,u=t[22],c=0;c<u;c++){r=63&t[l],n=t[l+1]<<8|t[l+2],l+=3;for(var d=0;d<n;d++)if(i=t[l]<<8|t[l+1],l+=2,i){switch(r){case 32:s.push(t.subarray(l,l+i));break;case 33:a.push(t.subarray(l,l+i));break;case 34:o.push(t.subarray(l,l+i))}l+=i}}return{spsArr:a,ppsArr:o,vpsArr:s}}}function btrt(e){var t=e.body,r=new ByteReader(t),n=r.readU32();r.forward(4);var i=r.readU32();return r.forward(4),{bufferSizeDB:n,maxBitrate:i,avgBitrate:r.readU32()}}function cslg(e){var t,r,n,i,a=e.body,o=new ByteReader(a);return o.forward(4),t=o.read32(),o.forward(4),r=o.read32(),o.forward(4),n=o.read32(),o.forward(4),i=o.read32(),o.forward(4),{compositionToDTSShift:t,leastDecodeToDisplayDelta:r,greatestDecodeToDisplayDelta:n,compositionStartTime:i,compositionEndTime:o.read32()}}function ftyp(e){var t=e.body,r=e.length,n=new ByteReader(t),i={compatible:[]};i.major=getBoxType(t,0),n.forward(4),i.version=n.readU32(),n.forward(4);for(var a=n.offset;a<r-8;)i.compatible.push(getBoxType(t,a)),a+=4;return i}function hdlr(e){return{handlerType:getBoxType(e.body,8)}}var MAX_UINT32_COUNT$2=Math.pow(2,32);function mdhd(e){var t=e.body,r={},n=new ByteReader(t),i=t[0];return n.forward(4),1===i?(n.forward(16),r.timescale=n.readU32(),n.forward(4),r.duration=n.readU32()*MAX_UINT32_COUNT$2,n.forward(4),r.duration+=n.readU32()):(n.forward(8),r.timescale=n.readU32(),n.forward(4),r.duration=n.readU32()),r}function mehd(e){var t,r=e.body,n=new ByteReader(r);if(n.forward(4),1===r[0]){var i=n.readU32();n.forward(4),t=i*(1<<30)*2+n.readU32()}else t=n.readU32();return{fragDuration:t}}function mfhd(e){var t=e.body,r=new ByteReader(t);return r.forward(4),{seqNumber:r.readU32()}}var MPEG4DescriptorParser=function(){var e=[];e[3]="ES_Descriptor",e[4]="DecoderConfigDescriptor",e[5]="DecoderSpecificInfo",e[6]="SLConfigDescriptor",this.getDescriptorName=function(t){return e[t]};var t=this,r={};return this.parseOneDescriptor=function(t){var n,i,a=0,o=t.readU8();for(t.forward(1),i=t.readU8(),t.forward(1);128&i;)a=(127&i)<<7,i=t.readU8(),t.forward(1);return a+=127&i,(n=e[o]?new r[e[o]](a):new r.Descriptor(a)).parse(t),n},r.Descriptor=function(e,t){this.tag=e,this.size=t,this.descs=[]},r.Descriptor.prototype.parse=function(e){this.data=e.slice(this.size),e.forward(this.size)},r.Descriptor.prototype.findDescriptor=function(e){for(var t=0;t<this.descs.length;t++)if(this.descs[t].tag===e)return this.descs[t];return null},r.Descriptor.prototype.parseRemainingDescriptors=function(e){for(var r=e.offset;e.offset<r+this.size;){var n=t.parseOneDescriptor(e);this.descs.push(n)}},r.ES_Descriptor=function(e){r.Descriptor.call(this,3,e)},r.ES_Descriptor.prototype=new r.Descriptor,r.ES_Descriptor.prototype.parse=function(e){if(this.ES_ID=e.readU16(),e.forward(2),this.flags=e.readU8(),e.forward(1),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=e.readU16(),e.forward(2),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags){var t=e.readU8();e.forward(1),this.URL=Array.from(e.slice(t)).map((function(e){return String.fromCharCode(e)})),e.forward(t),this.size-=t+1}else this.URL="";32&this.flags?(this.OCR_ES_ID=e.readU16(),e.forward(2),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(e)},r.ES_Descriptor.prototype.getOTI=function(e){var t=this.findDescriptor(4);return t?t.oti:0},r.ES_Descriptor.prototype.getAudioConfig=function(e){var t=this.findDescriptor(4);if(!t)return null;var r=t.findDescriptor(5);if(r&&r.data){var n=(248&r.data[0])>>3;return 31===n&&r.data.length>=2&&(n=32+((7&r.data[0])<<3)+((224&r.data[1])>>5)),n}return null},r.DecoderConfigDescriptor=function(e){r.Descriptor.call(this,4,e)},r.DecoderConfigDescriptor.prototype=new r.Descriptor,r.DecoderConfigDescriptor.prototype.parse=function(e){this.oti=e.readU8(),e.forward(1),this.streamType=e.readU8(),e.forward(1),this.bufferSize=e.readU24(),e.forward(3),this.maxBitrate=e.readU32(),e.forward(4),this.avgBitrate=e.readU32(),e.forward(4),this.size-=13,this.parseRemainingDescriptors(e)},r.DecoderSpecificInfo=function(e){r.Descriptor.call(this,5,e)},r.DecoderSpecificInfo.prototype=new r.Descriptor,r.SLConfigDescriptor=function(e){r.Descriptor.call(this,6,e)},r.SLConfigDescriptor.prototype=new r.Descriptor,this};function _adapterEstsInfo(e){var t,r=e.descs.find((function(e){return 4===e.tag}));r&&(t=r.descs.find((function(e){return 5===e.tag})));var n=Object.assign({},r);return delete n.descs,n.config=(null==t?void 0:t.data.length)?Array.from(null==t?void 0:t.data):[],n}function mp4a(e){var t=e.body,r=t.slice(28),n=(new MPEG4DescriptorParser).parseOneDescriptor(new ByteReader(r.slice(12),0)),i=(null==n?void 0:n.getAudioConfig)&&n.getAudioConfig();return{channelCount:t[17],samplesize:t[19],sampleRate:t[24]<<8|t[25],objectType:i,codec:"mp4a.40."+i,ests:_adapterEstsInfo(n)}}function mvhd(e){var t=e.body,r=new ByteReader(t),n={};return r.forward(4),n.createTime=r.readU32(),r.forward(4),n.modifyTime=r.readU32(),r.forward(4),n.timescale=r.readU32(),r.forward(4),n.duration=r.readU32(),r.forward(4),n.rate=r.readU32(),r.forward(4),r.forward(2),r.forward(70),n.nextTrackId=r.readU32(),n}function _bytesToHex(e){return e.map((function(e){return e.toString(16)})).join("")}function _bytesToStr(e){return e.map((function(e){return String.fromCharCode(e)})).join("")}function pssh(e){var t=e.body,r={},n=t[0],i=new ByteReader(t);if(i.forward(4),r.systemId=_bytesToHex(i.slice(16)),i.forward(16),n>0){var a=i.readU32();r.kids=[];var o=0;for(i.forward(4);o<a;)r.kids.push(_bytesToHex(i.slice(16))),i.forward(16),o++}var s=i.readU32();return i.forward(4),r.dataSize=s,r.data=i.slice(s),r.dataToBase64=btoa(_bytesToStr(r.data)),r}function sdtp(e,t){var r=e.body,n=new ByteReader(r);n.forward(4);for(var i,a,o,s,l=[],u=0;u<t;u++){var c=n.readU8();i=(192&c)>>6,a=(48&c)>>4,o=(12&c)>>2,s=3&c,l.push({isLeading:i,dependsOn:a,isDenpendedOn:o,hasRedundancy:s}),n.forward(1)}return{entries:l}}function stco(e){var t=e.body,r=new ByteReader(t);r.forward(4);var n=r.readU32(),i=[];r.forward(4);for(var a=0;a<n;a++){var o=r.readU32();i.push(o),r.forward(4)}return{entries:i,count:i.length}}function stsc(e){var t=e.body,r=new ByteReader(t);r.forward(4);var n=[],i=r.readU32();r.forward(4);for(var a=0;a<i;a++){var o=r.readU32();r.forward(4);var s=r.readU32();r.forward(4);var l=r.readU32();r.forward(4),n.push({firstChunk:o,samplesPreChunk:s,sampleDesIndex:l})}return{entries:n,count:n.length}}function ctts(e){var t=e.body,r=new ByteReader(t);r.forward(4);var n=r.readU32(),i=[];r.forward(4);for(var a=0;a<n;a++){var o=r.readU32();r.forward(4);var s=r.readU32();r.forward(4),i.push({sampleCount:o,sampleOffset:s})}return{entries:i,count:i.length}}function stss(e){var t=e.body,r=new ByteReader(t);r.forward(4);var n=[],i=r.readU32();r.forward(4);for(var a=0;a<i;a++){var o=r.readU32();n.push(o),r.forward(4)}return{entries:n,count:n.length}}function stsz(e){var t=e.body,r=new ByteReader(t);r.forward(4);var n=[],i=r.readU32();r.forward(4);var a=r.readU32();if(r.forward(4),0===i)for(var o=0;o<a;o++){var s=r.readU32();n.push(s),r.forward(4)}else console.warn("parse stsz, sample size not equal 0");return{entries:n,count:n.length}}function stts(e){var t=e.body,r=new ByteReader(t);r.forward(4);var n=r.readU32(),i=[];r.forward(4);for(var a=0;a<n;a++){var o=r.readU32();r.forward(4);var s=r.readU32();r.forward(4),i.push({sampleCount:o,sampleDelta:s})}return{entries:i,count:i.length}}var MAX_UINT32_COUNT$1=Math.pow(2,32);function tfdt(e){var t=e.body,r=new ByteReader(t),n=0;return r.forward(4),1===t[0]?(n=r.readU32()*MAX_UINT32_COUNT$1,r.forward(4),n+=r.readU32()):n=r.readU32(),{baseMediaDecodeTime:n}}function tfhd(e){var t=e.body,r=new ByteReader(t);r.forward(1);var n=r.slice(3),i=n[0]<<16|n[1]<<8|n[2],a={flags:n},o={baseDataOffsetPresent:!!(1&i),sampleDescriptionIndexPresent:!!(2&i),defaultSampleDurationPresent:!!(8&i),defaultSampleSizePresent:!!(16&i),defaultSampleFlagsPresent:!!(32&i),durationIsEmpty:!!(65536&i),defaultBaseIsMoof:!!(131072&i)};if(a.tfFlags=o,r.forward(3),a.trackId=r.readU32(),o.baseDataOffsetPresent){r.forward(4);var s=r.readU32();r.forward(4);var l=r.readU32();a.baseDataOffset=s<<32|l}else a.baseDataOffset=0,console.warn("base data offset not detected in tfhd");return o.sampleDescriptionIndexPresent&&(r.forward(4),a.sampleDescriptionIndex=r.readU32()),o.defaultSampleDurationPresent&&(r.forward(4),a.defaultSampleDuration=r.readU32()),o.defaultSampleSizePresent&&(r.forward(4),a.defaultSampleSize=r.readU32()),o.defaultSampleFlagsPresent&&(r.forward(4),a.defaultSampleFlags=r.readU32()),a}var MAX_UINT32_COUNT=Math.pow(2,32);function tkhd(e){var t=e.body,r=new ByteReader(t,4),n={},i=r.readU8();n.version=i,1===i?r.forward(16):r.forward(8),n.trackId=r.readU32(),r.forward(4),1===i?(n.duration=r.readU32()*MAX_UINT32_COUNT,r.forward(4),n.duration+=r.readU32()):n.duration=r.readU32();var a=t.byteLength;return a-=8,r.offset=a,n.width=r.readU32()>>16,r.forward(4),n.height=r.readU32()>>16,n}function trex(e){var t=e.body,r={},n=new ByteReader(t);return n.forward(4),r.trackId=n.readU32(),n.forward(4),r.defaultSdescriptionIndex=n.readU32(),n.forward(4),r.defaultSampleDuration=n.readU32(),n.forward(4),r.defaultSampleSize=n.readU32(),n.forward(4),r.defaultSampleFlags=parseSampleFlag(t,n.offset),r}function trun(e){var t=e.body,r={samples:[]},n=new ByteReader(t);r.version=n.readU8(),n.forward(1),r.flags=n.slice(3);var i=parseTfFlags(r.flags),a=i.dataOffsetPresent,o=i.firstSampleFlagsPresent,s=i.sampleDurationPresent,l=i.sampleSizePresent,u=i.sampleFlagsPresent,c=i.sampleCompositionTimeOffsetPresent;r.trFlags=i,n.forward(3),r.sampleCount=n.readU32(),n.forward(4),a&&(r.dataOffset=n.readU32(),n.forward(4)),o&&(r.firstSampleFlags=parseSampleFlag(t,n.offset),n.forward(4));for(var d=0;d<r.sampleCount;){var h={};s&&(h.duration=n.readU32(),n.forward(4)),l&&(h.size=n.readU32(),n.forward(4)),u&&(h.flags=parseSampleFlag(t,n.offset),n.forward(4)),c&&(h.ctOffset=n.readU32(),n.forward(4)),r.samples.push(h),d++}return r}function stsd(e){var t=e.body,r=e.start,n=new ByteReader(t);n.forward(4);var i=n.readU32();return n.forward(4),{entryCount:i,childData:splitBox(n.subarray(),r+8+8)}}function mp4Parser(e){var t=splitBox(e instanceof ArrayBuffer?new Uint8Array(e):e,0);if(_parseChildrenRecursion(t),!extractFmp4Samples(t,e)){var r=findBox(t,"mdat");r&&(r.bodyView=[_objectSpread2$c({type:"video"},extractMp4Samples(t,"vide",e)),_objectSpread2$c({type:"audio"},extractMp4Samples(t,"soun",e))].filter((function(e){return!!e.samples})))}return t}function _parseChildrenRecursion(e){var t=0;e.forEach((function(e){switch(e.type){case"ftyp":case"styp":e.bodyView=ftyp(e);break;case"moov":case"trak":case"mvex":case"mdia":case"minf":case"dinf":case"moof":case"traf":case"stbl":e.bodyView=splitBox(e.body,e.start+8),_parseChildrenRecursion(e.bodyView);break;case"stsd":var r=stsd(e),n=r.entryCount,i=r.childData;e.entryCount=n,e.bodyView=i,_parseChildrenRecursion(e.bodyView);break;case"mvhd":e.bodyView=mvhd(e);break;case"tkhd":e.bodyView=tkhd(e);break;case"mehd":e.bodyView=mehd(e);break;case"mdhd":e.bodyView=mdhd(e);break;case"hdlr":e.bodyView=hdlr(e);break;case"trex":e.bodyView=trex(e);break;case"trun":e.bodyView=trun(e),t=e.bodyView.samples.length;break;case"tfdt":e.bodyView=tfdt(e);break;case"avc1":case"hvc1":case"hev1":e.bodyView=avc1(e),_parseChildrenRecursion(e.bodyView);break;case"mp4a":e.bodyView=mp4a(e),e.bodyView&&(e.bodyView.codecType="aac");break;case"avcC":e.bodyView=avcC$1(e);var a=e.bodyView;if(a.codecType="avc",!(null==a?void 0:a.sps)){var o=a.spsArr[0],s=NALu.removeEPB(o);a.sps=AVC.parseSPS(s)}break;case"hvcC":e.bodyView=avcC(e);var l=e.bodyView;if(l.codecType="bytevc1",!(null==l?void 0:l.sps)){var u=l.spsArr[0],c=NALu.removeEPB(u);l.sps=HEVC.parseSPS(c)}break;case"btrt":e.bodyView=btrt(e);break;case"stts":e.bodyView=stts(e),e.bodyView.entries.length&&(t=e.bodyView.entries[0].sampleCount);break;case"ctts":e.bodyView=ctts(e);break;case"cslg":e.bodyView=cslg(e);break;case"stss":e.bodyView=stss(e);break;case"stsz":e.bodyView=stsz(e);break;case"stsc":e.bodyView=stsc(e);break;case"stco":e.bodyView=stco(e);break;case"sdtp":e.bodyView=sdtp(e,t);break;case"mfhd":e.bodyView=mfhd(e);break;case"tfhd":e.bodyView=tfhd(e);break;case"pssh":e.bodyView=pssh(e)}}))}function getSnapshoot(t){var r,n,i,a,o,s=t.filter((function(e){return"mdat"===e.type}));if(!s.length){var l=_getTrack(t,"vide"),u=_getTrack(t,"soun"),c=null==(r=findBox(null==l?void 0:l.bodyView,"mdhd"))?void 0:r.bodyView,d=(null==(n=findBox(null==l?void 0:l.bodyView,"avcC"))?void 0:n.bodyView)||(null==(i=findBox(null==l?void 0:l.bodyView,"hvcC"))?void 0:i.bodyView),h=null==(a=findBox(null==u?void 0:u.bodyView,"mdhd"))?void 0:a.bodyView,f=null==(o=findBox(null==u?void 0:u.bodyView,"mp4a"))?void 0:o.bodyView;try{return{video:_objectSpread2$c(_objectSpread2$c({},c),{},{duration:(null==c?void 0:c.duration)/c.timescale},d),audio:_objectSpread2$c(_objectSpread2$c(_objectSpread2$c({},h),{},{duration:(null==h?void 0:h.duration)/h.timescale},f),f.ests)}}catch(e){}return{}}var p=s.map((function(e){return e.bodyView})).reduce((function(e,t){return e=e.concat(t)}),[]).reduce((function(e,t){var r,n=t.type,i=t.frameLength,a=t.iFrames,o=t.pFrames,s=t.bFrames,l=t.duration;return e[n]?(e[n].frameLength+=i,e[n].iFrames+=a,e[n].pFrames+=o,e[n].bFrames+=s,e[n].duration+=l,e):(e[n]=Object.assign({},t),e[n].refDuration||(e[n].refDuration=null==(r=t.samples[0])?void 0:r.duration),e)}),{}),y=p.video;if(y){var m=y.frameLength,g=y.iFrames,v=y.pFrames,b=y.bFrames;y.iPercent=timeFixed(g/m*100),y.pPercent=timeFixed(v/m*100),y.bPercent=timeFixed(b/m*100)}return p}var Mp4Parser=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,[{key:"parse",value:function(e){return mp4Parser(e)}},{key:"parseV2",value:function(e,t){var r,n,i,a,o,s,l=e.filter((function(e){return"mdat"===e.type})),u=[],c=null==(n=null==(r=l[0])?void 0:r.bodyView)?void 0:n.filter((function(e){return"video"===e.type}))[0],d=null==(a=null==(i=l[0])?void 0:i.bodyView)?void 0:a.filter((function(e){return"audio"===e.type}))[0],h=Math.min((null==(o=null==d?void 0:d.samples[0])?void 0:o.dtsTime)||0,(null==(s=null==c?void 0:c.samples[0])?void 0:s.dtsTime)||0);l.forEach((function(e){e.bodyView.forEach((function(e){e.samples.forEach((function(e){e.time=timeFixed(e.dtsTime-h),u.push(e)}))}))}));var f={items:u.sort((function(e,t){return e.time>t.time?1:-1}))};return this._addMetadataToFirstKeyFrame(c),f.rates=getRates(f),f}},{key:"getSnapshoot",value:function(e){return getSnapshoot(e)}},{key:"_addMetadataToFirstKeyFrame",value:function(e){if(e){var t=e.samples.filter((function(e){return e.keyframe}))[0];t&&(t.sps=e.sps,t.vpsArr=e.vpsArr,t.spsArr=e.spsArr,t.ppsArr=e.ppsArr)}}}]),e}(),__defProp=Object.defineProperty,__defNormalProp=function(e,t,r){return t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},__publicField=function(e,t,r){return __defNormalProp(e,"symbol"!==_typeof$b(t)?t+"":t,r),r},Net=function(){function t(e){var r=this;_classCallCheck$j(this,t),__publicField(this,"_opts",null),__publicField(this,"_controller",null),__publicField(this,"_reader",null),__publicField(this,"_loading",!1),__publicField(this,"_chunks",[]),__publicField(this,"_readStream",(function(e,t){var n=0;r._reader=e.getReader();var i=r._chunks;return function e(){var a;return null==(a=r._reader)?void 0:a.read().then((function(r){var a=r.value,o=r.done;return i.push(a),t(n,a),o?Promise.resolve(concatBuffer(i.filter(Boolean))):(n+=a.byteLength,e())}))}()})),this._opts=e}return _createClass$k(t,[{key:"request",value:function(){var e=this,t=this._opts,r=t.url,n=t.onProgress,i=t.contentType,a=void 0===i?"ArrayBuffer":i,o=t.loadTimeout,s=void 0===o?5e3:o,l=t.headers;return this._controller=new AbortController,Promise.race([fetch(r,{signal:this._controller.signal,headers:l}),new Promise((function(t,r){setTimeout((function(){var t;e._loading||(r({code:0,message:"timeout"}),null==(t=e._controller)||t.abort())}),s)}))]).then((function(t){return t.ok&&t.status>=200&&t.status<300?(e._loading=!0,t):Promise.reject({code:t.status,message:t.statusText})})).then((function(t){switch(a){case"TEXT":return t.text();case"JSON":return t.json();case"ArrayBuffer":return n?e._readStream(t.clone().body,n):t.arrayBuffer()}})).catch((function(t){if(e._loading=!1,"AbortError"!==t.name)return Promise.reject({code:t.code||0,message:t.message})}))}},{key:"cancel",value:function(){var t,r;try{null==(t=this._reader)||t.cancel(),null==(r=this._controller)||r.abort(),this._reader=null,this._controller=null}catch(e){}}}]),t}(),Flv=function(){function e(){_classCallCheck$j(this,e)}var t;return _createClass$k(e,[{key:"parse",value:(t=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t,r){var n,i,a,o,s,l,u,c=this;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],this._loader=new Net(_objectSpread2$c(_objectSpread2$c({url:t},r),{},{onProgress:function(e,t){s.push(t),e>r.probeSize&&c._loader.cancel()}})),e.next=4,this._loader.request();case 4:return l=(new Flv$1).parse(concatBuffer(s)),u=null==(n=l.items.filter((function(e){return 9===e.type}))[0])?void 0:n.bodyView,e.abrupt("return",{codec:null==u?void 0:u.codecType,codecStr:null==(i=u.sps)?void 0:i.codec,width:null==(a=null==u?void 0:u.sps)?void 0:a.width,height:null==(o=null==u?void 0:u.sps)?void 0:o.height});case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),vparser_min={exports:{}};function loadM3u8(e){return _loadM3u.apply(this,arguments)}function _loadM3u(){return _loadM3u=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t){var r,n,i,a,o=arguments;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},n=new Net(_objectSpread2$c(_objectSpread2$c({url:t},r),{},{contentType:"TEXT"})),e.next=4,n.request();case 4:return i=e.sent,a=vparser_min.exports.m3u8Parser(i,t,(function(e,t){if(!e.url||!/^\//.test(e.url))return t;var r=e.url,n=t.segments[t.segments.length-1];return n.url=n.url.split("/").slice(0,3).join("/")+r,t})),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),_loadM3u.apply(this,arguments)}!function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==_typeof$b(e)&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){return(i="function"==typeof Symbol&&"symbol"==_typeof$b(Symbol.iterator)?function(e){return _typeof$b(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof$b(e)})(e)}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.r(t),r.d(t,"m3u8Parser",(function(){return d})),r.d(t,"mpdParser",(function(){return m}));var o=/EXT(?:-X-)?([^:]+):?(.*)$/,s=/([^,="]+)((="[^"]+")|(=[^,]+))*/g;function l(e){return e.split("-").reduce((function(e,t){return e+(e?t.charAt(0)+t.slice(1).toLowerCase():t.toLowerCase())}),"")}function u(e){if(!/^#EXT/.test(e)&&/^\s*#/.test(e))return null;var t,r,u=o.exec(e);return u?(t=l(u[1]),r=function(e){if(!e)return null;var t=e.match(s).map((function(e){return function(e){var t=e.trim().replace("=","|").split("|");if(2==t.length)return a({},l(t[0]),t[1].replace(/("|')/g,""));var r=parseFloat(t[0]);return Number.isNaN(r)?t[0]:r}(e)}));return 1===t.length?t[0]:0===t.filter((function(e){return"object"===i(e)})).length?t:t.reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e,{},t)}),{})}(u[2])):(t="url",r=e),a({},t,r)}function c(e,t){if(/^https?/.test(e)||/^data:/.test(e)||/^sdk:/.test(e))return e;for(t=t.split("/").slice(0,-1),e=e.split("/");e.length;){var r=e.shift();-1==t.indexOf(r)&&t.push(r)}return t.join("/")}var d=function(e,t,r){if(!e||!t)return{error:1,msg:"invalid input"};var n,i=e.split("\n").filter(Boolean).map((function(e){return u(e.trim())})).filter(Boolean);if(!i.length)return{error:1,msg:"invalid m3u8"};n=0!==i.filter((function(e){return!!e.streamInf})).length?{master:!0,m3u8Url:t,levels:[],medias:[]}:{master:!1,m3u8Url:t,duration:0,startSN:0,endSN:0,segments:[],live:!0};try{n=function(e,t,r){for(var n=t.master,i=e.length,a=0,o=0,s=0,l=0,u=0,d=-1,h=0;h<i;h++){var f=e[h];for(var p in f){var y=f[p];switch(y&&y.uri&&(y.url=c(y.uri,t.m3u8Url)),p){case"inf":var m={start:o,end:o+(Array.isArray(y)?y[0]:y),cc:a,sn:s+l};d>=0&&(m.keyIndex=d),l++,o=m.end,t.segments.push(m);break;case"start":o=y;break;case"discontinuity":a++;break;case"mediaSequence":s=y;break;case"streamInf":u++,y.levelId=u,t.levels.push(y);break;case"media":t.medias.push(y);break;case"endlist":t.live=!1;break;case"key":d++,t.key?t.key.push(y):t.key=[y];break;case"url":var g=n?t.levels:t.segments;if(!g.length)throw new Error("invalid m3u8");n?g[u-1].url=c(y,t.m3u8Url):g[l-1].url=c(y,t.m3u8Url);break;default:y&&(t[p]=y)}}r&&(t=r(f,t))}return n||(t.startSN=s,t.endSN=s+l-1,t.duration=o),t}(i,n,r)}catch(a){return{error:1,msg:a.message}}return n},h=/\s*(<\/?[^>]+>)/,f=/\s*(?:<\/?([^\s>]+))?\s*([^>]+)*(?:\/?>)?/,p=/\s*([^=]+)="([^"]+)"/g;function y(e,t){for(var r,n,i,a=[],o=e.length,s=0;s<o;s++)if((r=e[s]).closed)if(n=a.pop(),"pureValue"!==r.tagName){if(n&&n.tagName===r.tagName?i=a.pop():(i=n,n=r),!i){a.push(n);break}var l=n,u=l.tagName,c=l.attrs,d=i.attrs[u];t&&(c=t(u,c)),i.attrs[u]=d?Array.isArray(d)?d.concat(c):[d,c]:c,a.push(i)}else n.attrs?n.attrs.value=r.attrs.value:n.attrs=r.attrs,a.push(n);else a.push(r);var h,f,p,y=a[0];return y?"undefined"!=y.tagName?(h={},f=y.tagName,p=y.attrs,f in h?Object.defineProperty(h,f,{value:p,enumerable:!0,configurable:!0,writable:!0}):h[f]=p,h):y.tagName:null}var m=function(e,t){if(!e)return{error:1,msg:"invalid input"};try{return y(e.split(h).filter(Boolean).map((function(e){return function(e){var t,r=e.match(f),n={},i=(t=r&&r[1])?t.split("_").reduce((function(e,t){return e?e+=t.charAt(0).toUpperCase()+t.slice(1):e=t.charAt(0).toLowerCase()+t.slice(1)}),""):"";if(r&&r[1]&&r[2]){for(var a,o={};null!=(a=p.exec(r[2]));)o[a[1]]=a[2];return"?xml"===i?null:(n.tagName=i,n.attrs=o,n.closed=/\/$/.test(r[2]),n)}return r?/^<\//.test(r[0])?(n.tagName=i,n.closed=!0,n):/^</.test(r[0])?(n.tagName=i,n.attrs={},n):(n.tagName="pureValue",n.attrs={value:r[2]},n.closed=!0,n):null}(e)})).filter(Boolean),t)}catch(r){return{error:1,msg:r.message}}}}])}(vparser_min);var Hls=function(){function e(){_classCallCheck$j(this,e)}var t;return _createClass$k(e,[{key:"parse",value:(t=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h,f,p;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,loadM3u8(t,r);case 2:if(!(u=e.sent).master){e.next=7;break}return e.next=6,loadM3u8(u.levels[0].url);case 6:u=e.sent;case 7:if(null==u?void 0:u.segments.length){e.next=9;break}throw new Error("invalid m3u8");case 9:return c=[],d=new Net(_objectSpread2$c(_objectSpread2$c({url:u.segments[0].url},r),{},{onProgress:function(e,t){c.push(t),e>r.probeSize&&d.cancel()}})),e.next=13,d.request();case 13:return h=(new TsParser).parse(new Uint8Array(concatBuffer(c))),f=h.items.filter((function(e){return"PMT"===e.packetType}))[0],p=null==(n=h.items.filter((function(e){return"PES"===e.packetType&&e.isVideo&&e.keyframe}))[0])?void 0:n.bodyView,e.abrupt("return",{codec:null==(a=null==(i=null==f?void 0:f.bodyView)?void 0:i.video)?void 0:a.codecType,codecStr:null==(o=p.sps)?void 0:o.codec,width:null==(s=null==p?void 0:p.sps)?void 0:s.width,height:null==(l=null==p?void 0:p.sps)?void 0:l.height});case 17:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),Mp4=function(){function e(){_classCallCheck$j(this,e)}var t;return _createClass$k(e,[{key:"parse",value:(t=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t,r){var n,i,a,o,s,l,u,c,d,h,f,p,y,m;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Net(_objectSpread2$c(_objectSpread2$c({url:t},r),{},{contentType:"ArrayBuffer",headers:{Range:"bytes=0-1499"}})),s=[],e.next=4,o.request();case 4:return l=e.sent,u=new Uint8Array(l),c=(new Mp4Parser).parse(u),d=c.find((function(e){return"mdat"===e.type})),(h=c.find((function(e){return"moov"===e.type})))?(s.push(h.start),s.push(h.start+h.size)):d&&s.push(d.start+d.size),o=new Net(_objectSpread2$c(_objectSpread2$c({url:t},r),{},{contentType:"ArrayBuffer",headers:{Range:"bytes=".concat(s[0],"-").concat(s[1]||"")}})),e.next=13,o.request();case 13:return f=e.sent,p=new Mp4Parser,y=p.parse(f),m=p.getSnapshoot(y).video,e.abrupt("return",{codec:null==m?void 0:m.codecType,codecStr:null==(n=m.sps)?void 0:n.codec,width:null==(i=null==m?void 0:m.sps)?void 0:i.width,height:null==(a=null==m?void 0:m.sps)?void 0:a.height});case 18:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),Lite=function(){function e(){_classCallCheck$j(this,e)}return _createClass$k(e,[{key:"parseUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,probeSize:8e4};return/flv/.test(e)?(new Flv).parse(e,t):/m3u8?/.test(e)?(new Hls).parse(e,t):(new Mp4).parse(e,t)}}]),e}();function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty$1(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _regeneratorRuntime(){_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(I){l=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof h?t:h,o=Object.create(a.prototype),s=new A(i||[]);return n(o,"_invoke",{value:E(e,r,s)}),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(I){return{type:"throw",arg:I}}}e.wrap=u;var d={};function h(){}function f(){}function p(){}var y={};l(y,a,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(w([])));g&&g!==t&&r.call(g,a)&&(y=g);var v=p.prototype=h.prototype=Object.create(y);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function i(n,a,o,s){var l=c(e[n],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==_typeof$b(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var a;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=T(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=c(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function T(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function w(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=p,n(v,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:f,configurable:!0}),f.displayName=l(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},b(_.prototype),l(_.prototype,o,(function(){return this})),e.AsyncIterator=_,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new _(u(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(v),l(v,s,"Generator"),l(v,a,(function(){return this})),l(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),$(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;$(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:w(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function asyncGeneratorStep(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(error){return void r(error)}s.done?t(l):Promise.resolve(l).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,n,i,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck$1(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass$1(e,t,r){return t&&_defineProperties$1(e.prototype,t),r&&_defineProperties$1(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof$b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=_superPropBase(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},_get.apply(this,arguments)}function _slicedToArray$1(e,t){return _arrayWithHoles$1(e)||_iterableToArrayLimit$1(e,t)||_unsupportedIterableToArray$1(e,t)||_nonIterableRest$1()}function _toConsumableArray$1(e){return _arrayWithoutHoles$1(e)||_iterableToArray$1(e)||_unsupportedIterableToArray$1(e)||_nonIterableSpread$1()}function _arrayWithoutHoles$1(e){if(Array.isArray(e))return _arrayLikeToArray$1(e)}function _arrayWithHoles$1(e){if(Array.isArray(e))return e}function _iterableToArray$1(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit$1(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest$1(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var $$3=_export$1,fails=fails$1Q,getOwnPropertyNames=objectGetOwnPropertyNamesExternal.f,FAILS_ON_PRIMITIVES=fails((function(){return!Object.getOwnPropertyNames(1)}));$$3({target:"Object",stat:!0,forced:FAILS_ON_PRIMITIVES},{getOwnPropertyNames:getOwnPropertyNames});var $$2=_export$1,parseFloat$1=numberParseFloat;$$2({target:"Number",stat:!0,forced:Number.parseFloat!=parseFloat$1},{parseFloat:parseFloat$1});var $$1=_export$1,fill=arrayFill$3,addToUnscopables=addToUnscopables$a;$$1({target:"Array",proto:!0},{fill:fill}),addToUnscopables("fill");var webm="data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4="data:video/mp4;base64, AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw",oldIOS=function(){return"undefined"!=typeof navigator&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream},nativeWakeLock=function(){return"wakeLock"in navigator},NoSleep=function(){function e(){var t=this;_classCallCheck$1(this,e),this.enabled=!1,nativeWakeLock()?(this._wakeLock=null,this.handleVisibilityChange=function(){null!==t._wakeLock&&t.visible&&t.enable()},document.addEventListener("visibilitychange",this.handleVisibilityChange),document.addEventListener("fullscreenchange",this.handleVisibilityChange)):oldIOS()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"mp4",mp4),this._addSourceToVideo(this.noSleepVideo,"webm",webm),this.noSleepVideo.addEventListener("loadedmetadata",(function(){t.noSleepVideo&&(t.noSleepVideo.duration<=1?t.noSleepVideo.setAttribute("loop",""):(t.onTimeupdate=function(){t.noSleepVideo.currentTime>.5&&(t.noSleepVideo.currentTime=Math.random())},t.noSleepVideo.addEventListener("timeupdate",t.onTimeupdate)))})))}return _createClass$1(e,[{key:"_addSourceToVideo",value:function(e,t,r){var n=document.createElement("source");n.src=r,n.type="video/".concat(t),e.appendChild(n)}},{key:"visible",get:function(){return"visible"===document.visibilityState}},{key:"isEnabled",get:function(){return this.enabled}},{key:"enable",value:function(){var e,t=this;if(nativeWakeLock()&&this.visible)return navigator.wakeLock.request("screen").then((function(e){t._wakeLock=e,t.enabled=!0,t._wakeLock.addEventListener("release",(function(){}))})).catch((function(){t.enabled=!1}));if(oldIOS())return this.disable(),console.warn("\n        NoSleep enabled for older iOS devices. This can interrupt\n        active or long-running network requests from completing successfully.\n        See https://github.com/richtr/NoSleep.js/issues/15 for more details.\n      "),this.noSleepTimer=window.setInterval((function(){document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))}),15e3),this.enabled=!0,Promise.resolve();if(null!==(e=this.noSleepVideo)&&void 0!==e&&e.paused){var r=this.noSleepVideo.play();return r&&r.then((function(e){return t.enabled=!0,e})).catch((function(e){console.log("noSleep: ",e.message),t.enabled=!1}))}}},{key:"disable",value:function(){nativeWakeLock()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):oldIOS()?this.noSleepTimer&&(console.warn("\n          NoSleep now disabled for older iOS devices.\n        "),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}},{key:"toPlay",value:function(){if(this.noSleepVideo&&this.noSleepVideo.paused){var e=performance.now();this.lastTs||(this.lastTs=e),e-this.lastTs>1e4&&(this.enable(),this.lastTs=e)}}},{key:"destroy",value:function(){this.disable(),this.handleVisibilityChange&&(document.removeEventListener("visibilitychange",this.handleVisibilityChange),document.removeEventListener("fullscreenchange",this.handleVisibilityChange)),this.onTimeupdate&&this.noSleepVideo.removeEventListener("timeupdate",this.onTimeupdate),this.noSleepVideo=null}}]),e}(),ele;function initBgSilenceAudio(){if(!document.querySelector("#hackAudioPP")){var e=document.createElement("div");e.innerHTML="<audio id='hackAudioPP'></audio>",document.body.appendChild(e);var t=e.children.item(0);t.controls=!1,t.preload="auto",t.innerHTML="<source src=".concat("data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",' type="audio/mpeg"></source>'),t.muted=!0,t.loop=!0,t.play().catch((function(){}))}}function playSlienceAudio(){var e=ele||(ele=document.querySelector("#hackAudioPP"));e?!1===e.paused&&!1===e.muted||(e.muted=!1,e.play().catch((function(e){console.log("bgAudio: ",e.message)}))):initBgSilenceAudio()}function pauseSlienceAudio(){var e=ele||(ele=document.querySelector("#hackAudioPP"));e&&e.pause()}var DevLogger=function(){function t(){var r=this;_classCallCheck$1(this,t);try{var n=/xgd=(\d)/.exec(document.cookie);this._status=!!n,this._level=n&&n[1]}catch(e){this._status=!1}["group","groupEnd","log","warn","error"].forEach((function(e){r[e]=function(t,n,i,a,o,s,l,u,c,d){var h;if(r._status){var f=t,p=[n,i,a,o,s,l,u,c,d].filter((function(e){return void 0!==e}));(h=console)[e].apply(h,["["+f+"]:"].concat(_toConsumableArray$1(p)))}}}))}return _createClass$1(t,[{key:"enable",get:function(){return this._status}},{key:"long",get:function(){return"2"===this._level}}]),t}(),logger=new DevLogger;function debounce(e,t){var r=Date.now(),n=null,i=!0;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var l=Date.now();i&&(r=Date.now(),i=!1,e.apply(void 0,o)),l-r>t?(r=l,e.apply(void 0,o)):(n&&window.clearTimeout(n),n=setTimeout((function(){e.apply(void 0,o)}),t))}}function getAvcc(e,t){if(e&&t){var r=new Uint8Array(e.byteLength+t.byteLength+11);r[0]=1,r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=255,r[5]=225;var n=6;return r.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),n),n+=2,r.set(e,n),r[n+=e.byteLength]=1,n++,r.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),n),n+=2,r.set(t,n),r}}function promiseDelayed(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.resolve=e,r.reject=t,r}var EleName="xg-video",simdCanused=!1;try{simdCanused=WebAssembly&&WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))}catch(e){}var decodeCapacity={preloadDecoder:!1,reuseWasmDecoder:!0,reuseMseForAudio:!1,preciseSeek:0,h264WithWebcodec:!0,lowDecodeThreshold:100,wasmFallbackToAsm:!1,audioWithMse:!0,canUseThreadMode:!1,disabledWhenErrorOccur:!0,disabledDuration:43200,evaluateVVCount:0,disabledByLowdecodePrecent:.5,maxDecodeOnceWasm:simdCanused?6:8,maxDecodeOnceFirstTime:8,maxDecodeOnceWebcodec:20};function getEleName(){return EleName}function setEleName(e){EleName=e}function setDecodeCapacity(e){decodeCapacity=Object.assign({},decodeCapacity,e)}function getDecodeCapacaity(){return decodeCapacity}function getDecoderUrls(){var e="undefined"!=typeof customElements&&customElements.get(EleName);return e?{H264_DECODER_URL:e.h264Url,ASM_H264_DECODER_URL:e.h264AsmUrl,H265_DECODER_URL:e.h265Url,H265_THREAD_DECODER_URL:e.h265ThreadUrl,H265_SIMD_DECODER_URL:e.h265SimdUrl,ASM_H265_DECODER_URL:e.h265AsmUrl}:{}}function simdSupported(){if("undefined"==typeof customElements)return!1;var e=customElements.get(EleName);return simdCanused&&!(null==e||!e.h265SimdUrl)}function threadSupported(){if("undefined"==typeof customElements)return!1;var e=customElements.get(EleName);return!!window.SharedArrayBuffer&&!(null==e||!e.h265ThreadUrl)}var _softDecodeSupport=!1;try{var _localStorage,_localStorage$getItem;_softDecodeSupport="1"===(null===(_localStorage=localStorage)||void 0===_localStorage||null===(_localStorage$getItem=_localStorage.getItem)||void 0===_localStorage$getItem?void 0:_localStorage$getItem.call(_localStorage,"_sds"))}catch(e){}function softDecodeSupported(){if("undefined"==typeof customElements)return!1;if(_softDecodeSupport)return!0;var t=!1,r=!1;try{var n=new(window.AudioContext||window.webkitAudioContext);n.close(),n=null,t=!0}catch(e){}try{for(var i=document.createElement("canvas"),a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],o=0;o<a.length;o++){var s=i.getContext(a[o]);if(s){s=null,i=null,r=!0;break}}_softDecodeSupport=t&&r&&!!WebAssembly,localStorage.setItem("_sds",_softDecodeSupport?1:0)}catch(e){}return _softDecodeSupport}function getDeviceCapacity(){return{simd:simdCanused,thread:threadSupported(),nbCpu:navigator.hardwareConcurrency}}var vv=0,lowdecodeVV=0,lowdecodePercent=0,disabledHevc=!1;function updateVV(){vv++}function getVV(){return vv}function updateLowdecodeVV(){lowdecodeVV++}function getLowdecodeVV(){return lowdecodeVV}function getLowdecodePercent(){return lowdecodePercent}function _getDisabledByEvaluateVV(){return!!disabledHevc||0!==getDecodeCapacaity().evaluateVVCount&&(vv===getDecodeCapacaity().evaluateVVCount&&(lowdecodePercent=lowdecodeVV/vv),lowdecodePercent>=getDecodeCapacaity().disabledByLowdecodePrecent&&(disabledHevc=!0),disabledHevc)}function persistenceDisabledStatus(e){localStorage.setItem("xgv_dis",e),2===e&&localStorage.setItem("xgv_dist",(new Date).getTime())}function getDisabledStatus(){if(!0===_getDisabledByEvaluateVV())return!0;var e=localStorage.getItem("xgv_dis");if(!e)return!1;if("1"===e)return!0;if("2"===e){var t=localStorage.getItem("xgv_dist")||0;if(t=Number(t),((new Date).getTime()-t)/1e3<getDecodeCapacaity().disabledDuration)return!0;cleanDisabledStatus()}}function cleanDisabledStatus(){localStorage.removeItem("xgv_dist"),localStorage.removeItem("xgv_dis")}var VIDEO_EVENTS={WAITING:0,CANPLAY:1,PLAY:2,PLAYING:3,PAUSE:4,SEEKING:5,SEEKED:6,LOADEDDATA:7,LOADEDMETADATA:8,TIMEUPDATE:9,DURATION_CHANGE:10,VOLUME_CHANGE:11,PROGRESS:12,ERROR:13,ENDED:14,RESIZE:15,LOADSTART:16,DECODE_FPS:17,LOW_DECODE:18,LARGE_AV_GAP:19,FIRST_FRAME:20},VIDEO_EVENTS_ARR=["waiting","canplay","play","playing","pause","seeking","seeked","loadeddata","loadedmetadata","timeupdate","durationchange","volumechange","progress","error","ended","resize","loadstart","decodefps","lowdecode","largeavgap","firstframe"],Events={AUDIO:{AUDIO_READY:"audio_ready",AUDIO_NOT_ALLOWED_AUTOPLAY:"audio_not_allowed_autoplay",AUDIO_WAITING:"audio_waiting",AUDIO_SYNC_DTS:"audio_sync_dts"},VIDEO:{VIDEO_DECODER_INIT:"video_decode_init",VIDEO_READY:"video_ready",VIDEO_WAITING:"video_waiting",AUTO_RUN:"auto_run",DECODE_LOW_FPS:"decode_low_fps",UPDATE_VIDEO_FILLTYPE:"update_video_filltype",UPDATE_VIDEO_COVER_POSITION:"update_video_cover_position"},TIMELINE:{PLAY_EVENT:"play_event",SET_METADATA:"set_metadata",APPEND_CHUNKS:"append_chunks",START_RENDER:"start_render",DO_PLAY:"do_play",DO_PAUSE:"do_pause",DO_SEEK:"do_seek",SET_PLAYBACKRATE:"set_playbackrate",SYNC_DTS:"sync_dts",RESET_BASE_DTS:"reset_base_dts",UPDATE_VOLUME:"update_volume",SINGLE_TRACK:"single_track",DESTROY:"destroy",READY:"ready",UPDATE_GL_OPTIONS:"update_gl_options",SET_VIDEO_DURATION:"set_video_duration",SET_PLAY_MODE:"set_play_mode",UPDATE_CAPABILITY_LEVEL:"update_capability_level",INNER_DEGRADE:"inner_degrade",ADJUST_SEEK_TIME:"adjust_seek_time",CHASE_FRAME:"chase_frame",END_OF_STREAM:"end_of_stream",UPDATE_SEGMENT_END:"update_segment_end"},VIDEO_EVENTS:VIDEO_EVENTS,DECODE_EVENTS:{INIT:"init",READY:"decoderready",REMUX:"remux",INIT_FAILED:"initfailed",DATAREADY:"dataReady",PLAY_FAILED:"playfailed",FRAGMENT_END:"fragmentEnd",APPEND_VIDEO:"appendVideo",FIRST_FRAME:"firstFrame",DECODED:"decoded",RENDE_END:"rendeEnd",CHASE_VIDEO_FRAME:"chaseVideoFrame",CHASE_VIDEO_FRAME_END:"chaseVideoFrameEnd",CHASE_AUDIO_FRAME:"chaseAudioFrame",INIT_SEGMENT:"initSegment",MEDIA_SEGMENT:"mediaSegment",FRAME_MAX_COUNY:"frameMaxCount",FRAME_MIN_COUNY:"frameMinCount"}},BaseRender=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck$1(this,r),(i=t.call(this))._config=e,i._parent=n,i._meta=null,i._ready=!1,i._isLive=!0,i._innerDegrade=!1,i._singleTrack=-1,i}return _createClass$1(r,[{key:"analyse",get:function(){return this._parent.analyse}},{key:"isLive",get:function(){return this._isLive}},{key:"innerDegrade",get:function(){return this._innerDegrade}},{key:"noAudio",get:function(){return 1===this._singleTrack||2===this._singleTrack}},{key:"noVideo",get:function(){return 3===this._singleTrack}},{key:"duration",get:function(){return this._timeRange.duration},set:function(e){this._timeRange&&(this._timeRange.duration=e)}},{key:"_bindEvents",value:function(){var e=this;this._parent.on(Events.TIMELINE.APPEND_CHUNKS,this._appendChunk.bind(this)),this._parent.on(Events.TIMELINE.RESET_BASE_DTS,this._resetDts.bind(this)),this._parent.on(Events.TIMELINE.START_RENDER,this._startRender.bind(this)),this._parent.on(Events.TIMELINE.DO_PLAY,this._doPlay.bind(this)),this._parent.on(Events.TIMELINE.DO_PAUSE,this._doPause.bind(this)),this._parent.on(Events.TIMELINE.DO_SEEK,this._doSeek.bind(this)),this._parent.on(Events.TIMELINE.DESTROY,this._destroy.bind(this)),this._parent.on(Events.TIMELINE.CHASE_FRAME,this._doChaseFrame.bind(this)),this._parent.on(Events.TIMELINE.SINGLE_TRACK,(function(t){e._singleTrack=t})),this._parent.on(Events.TIMELINE.SET_PLAY_MODE,(function(t){e._isLive="LIVE"===t})),this._parent.on(Events.TIMELINE.INNER_DEGRADE,(function(){e._innerDegrade=!0})),this._parent.on(Events.TIMELINE.SET_VIDEO_DURATION,(function(t){e.duration=t}))}}]),r}(EventEmitter$1),TOLERANCE$2=.5,AudioTimeRange=function(){function e(t){_classCallCheck$1(this,e),this.TAG="AudioTimeRange",this._parent=t,this._buffers=[],this._duration=0,this._baseDts=0,this._lastBuffer=null}return _createClass$1(e,[{key:"isLive",get:function(){return this._parent.isLive}},{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"buffered",get:function(){var e=this;if(this.isLive)return{length:this._duration?1:0,start:function(){return 0},end:function(){return e._duration}};var t=this._mergeBufferRanges();return{length:t.length,start:function(e){var r=t[e];return r?r.start:0},end:function(e){var r=t[e];return r?r.end:1/0}}}},{key:"resetDts",value:function(e){this._baseDts=e}},{key:"_transitionSamples",value:function(e){for(var t=e.numberOfChannels,r=e.length,n=512,i=0;i<t;i++){for(var a=e.getChannelData(i),o=0;o<n;o++)a[o]=a[o]*o/n;for(var s=r-n;s<r;s++)a[s]=a[s]*(r-s)/n}}},{key:"append",value:function(e,t,r,n){-1===this._baseDts&&(this._baseDts=r),this._transitionSamples(e);var i=(r-this._baseDts)/1e3,a=i+t,o={start:i,end:a,startDts:r,source:e,duration:t,delay:n};if(logger.log(this.TAG,"add new buffer range, startDts:".concat(r,", [").concat(o.start," , ").concat(o.end,"]")),!this._buffers.filter((function(e){return e.start===i})).length)return this._buffers.push(o),this.isLive&&(this._duration=a),o.start;console.error("")}},{key:"deletePassed",value:function(e){return this._buffers=this._buffers.filter((function(t){return t.start>=e})),this._buffers[0]}},{key:"canSeek",value:function(e){var t=this._buffers[this._buffers.length-1];return!!t&&!(t.start<e)}},{key:"_mergeBufferRanges",value:function(){var e=this._buffers.slice().sort((function(e,t){return e.start>t.start?1:-1})),t=e.length,r=[];if(!t)return r;for(var n={start:e[0].start,end:e[0].end},i=1;i<t;i++){var a=e[i];Math.abs(n.end-a.start)<TOLERANCE$2?n.end=a.end:(r.push(n),n={start:a.start,end:a.end})}return r.push(n),r}},{key:"getBuffer",value:function(e){if(this.isLive)return this._buffers.shift();var t=this._buffers.filter((function(t){return t.start<e+TOLERANCE$2&&t.end>e+TOLERANCE$2}))[0];return logger.log(this.TAG,"get audio buffer , currentTime:".concat(e," ,buffer:[").concat(t&&t.start," , ").concat(t&&t.end,"]")),0!==e||t?t:this._buffers[0]}},{key:"hasBuffer",value:function(){var e;return!(null===(e=this._buffers)||void 0===e||!e.length)}}]),e}(),Alaw2lpcm=[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,624,592,944,912,1008,976,816,784,880,848],Ulaw2lpcm=[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0],silenceFrame=new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);function _doubleCheckSampleRateIndex(e,t){var r=(7&e[0])<<1|e[1]>>>7;return r!==t?r:t}function _constructAdtsHeader(e,t){var r=e.sampleRateIndex,n=e.channelCount;r=_doubleCheckSampleRateIndex(e.config,r);var i=new Uint8Array(7);i[0]=255,i[1]=240,i[1]=1|i[1],i[2]=64,i[2]=i[2]|60&r<<2,i[2]=i[2]|1&n>>2,i[3]=192&n<<6;var a=t.byteLength+7;return i[3]=i[3]|3&a>>11,i[4]=255&a>>3,i[5]=224&a<<5,i[5]=31|i[5],i[6]=252,i}function packageAACToAdts(e,t){var r=new Uint8Array(t.data.byteLength+7),n=_constructAdtsHeader(e,t.data);return r.set(n),r.set(t.data,7),r}function concatAdts(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,n=0,i=e.length;n<i;n++)t&&n%t==0||(r+=e[n].byteLength);for(var a=new Uint8Array(r),o=0,s=0,l=e.length;s<l;s++)t&&s%t==0||(a.set(e[s],o),o+=e[s].byteLength);return a}function _decodeAlaw(e){for(var t=new Uint8Array(2*e.length),r=0,n=0;r<e.length;){var i=Alaw2lpcm[e[r]];if(void 0===i)throw new Error("can not decode g711 alaw data!");t[n]=255&i,t[n+1]=i>>8,r+=1,n+=2}return t}function _decodeUlaw(e){for(var t=new Uint8Array(2*e.length),r=0,n=0;r<e.length;){var i=Ulaw2lpcm[e[r]];if(void 0===i)throw new Error("can not decode g711 ulaw data!");t[n]=255&i,t[n+1]=i>>8,r+=1,n+=2}return t}function decodeG711(e,t){if("g7110a"===t)return _decodeAlaw(e);if("g7110m"===t)return _decodeUlaw(e);throw new Error("no supported format=".concat(t," for g711"))}function _getSampleCount(e,t,r){return e/t/r}function _uint16ToFloat32(e){return e>=32768?-(65536-e)/32768:e/32767}function createAudioBufferFromPcm(e,t,r,n,i){for(var a=_getSampleCount(t.byteLength,r,i),o=e.createBuffer(r,a,n),s=new DataView(t),l=0;l<r;l++)for(var u=o.getChannelData(l),c=void 0,d=0;d<a;d++)c=s.getUint16(d*(2*r)+2*l,!0),u[d]=_uint16ToFloat32(c);return{audioBuffer:o,duration:a/n}}function checkRefillFrame(e){var t=e[0].dts,r=e.filter((function(e){return e.dts===t})).length;if(!(r<=1))for(var n=0;n<r;n++)e[n].data=silenceFrame}var AudioHelper={decodeG711:decodeG711,createAudioBufferFromPcm:createAudioBufferFromPcm,packageAACToAdts:packageAACToAdts,concatAdts:concatAdts,checkRefillFrame:checkRefillFrame},MEDIA_ERR_DECODE$1=3,ERROR_MSG={INIT_AUDIO_ERR:"create new AudioContext error",DECODE_ERR:"audio data decode error"},AudioRender=function(t){_inherits(a,t);var r,n,i=_createSuper(a);function a(e,t){var r;return _classCallCheck$1(this,a),_defineProperty$1(_assertThisInitialized(r=i.call(this,e,t)),"doPause",r._doPause),r.TAG="AudioRender",r._timeRange=new AudioTimeRange(_assertThisInitialized(r)),r._lastTimeLineTime=0,r._sampleQueue=[],r._source=null,r._audioCanAutoplay=!0,r._lastBuffer=null,r._inDecoding=!1,r._endOfStream=!1,r._delay=0,r._isSourceBufferEnd=-1,r._onSourceBufferEnded=r._onSourceBufferEnded.bind(_assertThisInitialized(r)),r._initAudioCtx(e.volume||.6),r._bindEvents(),r}return _createClass$1(a,[{key:"baseDts",get:function(){return this._timeRange._baseDts}},{key:"currentTime",get:function(){return this._audioCtx?this._lastTimeLineTime+this._audioCtx.currentTime:0}},{key:"preloadTime",get:function(){return this.isLive?1:0}},{key:"timescale",get:function(){return 1e3}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"ctxState",get:function(){return this._audioCtx.state}},{key:"audioCanAutoplay",get:function(){return this._audioCanAutoplay}},{key:"resume",value:function(){if(this._audioCtx&&"suspended"===this._audioCtx.state)return this._audioCtx.resume().catch((function(e){}))}},{key:"canSeek",value:function(e){return this._timeRange.canSeek(e)}},{key:"_assembleErr",value:function(e){var t=new Error(e);return t.code=MEDIA_ERR_DECODE$1,t}},{key:"_emitTimelineEvents",value:function(e,t,r){var n,i;null===(n=this._parent)||void 0===n||null===(i=n.emit)||void 0===i||i.call(n,e,t,r)}},{key:"_initAudioCtx",value:function(e){var t=this;logger.log(this.TAG,"init audioCtx");var r=window.AudioContext||window.webkitAudioContext;return this._audioCtx=new r,this._audioCtx?(this._gainNode=this._audioCtx.createGain(),this._gainNode.gain.value=e,this._gainNode.connect(this._audioCtx.destination),this._audioCanAutoplay="running"===this._audioCtx.state,logger.log(this.TAG,"webAudio state:",this._audioCtx.state),initBgSilenceAudio(),this._bindAudioCtxEvent(),this._audioCtx.suspend()):(logger.warn(this.TAG,"create webaudio error!"),void setTimeout((function(){t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,t._assembleErr(ERROR_MSG.INIT_AUDIO_ERR))})))}},{key:"_bindAudioCtxEvent",value:function(){var e=this;this._onStateChange=function(){e._audioCtx&&"running"===e._audioCtx.state&&e._ready&&e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PLAYING)},this._audioCtx.addEventListener("statechange",this._onStateChange)}},{key:"_bindEvents",value:function(){var e=this;_get(_getPrototypeOf(a.prototype),"_bindEvents",this).call(this),this._parent.on(Events.DECODE_EVENTS.CHASE_AUDIO_FRAME,this._doChaseFrame.bind(this)),this._parent.on(Events.TIMELINE.UPDATE_VOLUME,(function(t){e._gainNode&&(e._gainNode.gain.value=Number.isFinite(t)?t:1,e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.VOLUME_CHANGE))})),this._parent.on(Events.TIMELINE.END_OF_STREAM,(function(){var t;e._endOfStream=!0,e.noAudio||null!==(t=e._timeRange)&&void 0!==t&&t.hasBuffer()||null==e||e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ENDED)}))}},{key:"_appendChunk",value:function(e,t){if(!this.noAudio){this._meta||(this._meta=t,logger.warn(this.TAG,"audio set metadata",this._meta));var r=t.samples;if(r.length)if(this._sampleQueue=this._sampleQueue.concat(r),t.samples=[],"aac"===this._meta.codecType){if(this._inDecoding)return;this._decodeAACWrapper()}else this._decodeG711()}}},{key:"_resetDts",value:function(e,t){"video"!==t&&this._timeRange.resetDts(e)}},{key:"_doPlay",value:function(){this.noAudio||this._parent.seeking||(this._source||!this.currentTime?this.resume():this._startRender())}},{key:"_doPause",value:function(){this.noAudio||this._audioCtx.suspend()}},{key:"_reInitAudioCtx",value:function(e){var t=this;if(this._lastTimeLineTime=e,this._lastBuffer=null,this._lastAudioBufferInfo=null,this._delay=0,!this._ready||!this._audioCtx.currentTime)return Promise.resolve();var r=this._gainNode.gain.value;return this._audioCtx.close().then((function(){return t._audioCtx.removeEventListener("statechange",t._onStateChange),t._audioCtx=null,t._source&&t._source.removeEventListener("ended",t._onSourceBufferEnded),t._source=null,t._initAudioCtx(r)}))}},{key:"_doSeek",value:function(e){var t=this;this._reInitAudioCtx(e).then((function(){t._getAudioBuffer(!0)})).catch((function(e){}))}},{key:"_doChaseFrame",value:function(e){var t=this,r=e.position,n=this._timeRange.deletePassed(r);n&&(logger.log(this.TAG,"_doChaseFrame","startTime:",n.start,"buffeLength:",this.buffered.end(0)-n.start),this._reInitAudioCtx(n.start).then((function(){t._startRender(),t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.TIMEUPDATE)})).catch((function(e){})))}},{key:"_decodeAACWrapper",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,i,a,o,s,l,u,c;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._sampleQueue.length,r=this._sampleQueue[0],n=this._sampleQueue[t-1],!((i=(n.dts-r.dts)/this.timescale)<1)){e.next=6;break}return e.abrupt("return");case 6:for(a=parseInt(i/3-1)||1,o=parseInt(t/a),s=[],l=0;l<a;l++)l<a-1?s.push(this._sampleQueue.slice(l*o,(l+1)*o)):s.push(this._sampleQueue.slice(l*o));return this._sampleQueue=[],this._inDecoding=!0,e.prev=12,e.next=15,this._decodeCycle(s);case 15:this._isLive||(u=this._timeRange._buffers,(c=u[u.length-1])&&this._emitTimelineEvents(Events.TIMELINE.UPDATE_SEGMENT_END,c.end)),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(12),this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,this._assembleErr("ERROR_MSG.DECODE_ERR:".concat(e.t0&&e.t0.message)));case 21:this._inDecoding=!1;case 22:case"end":return e.stop()}}),e,this,[[12,18]])}))),function(){return n.apply(this,arguments)})},{key:"_decodeCycle",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.shift()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._decodeAAC(r);case 5:return e.next=7,this._decodeCycle(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_decodeAAC",value:function(e){var t=this,r=e[0],n=0;AudioHelper.checkRefillFrame(e);var i=e.map((function(e){return AudioHelper.packageAACToAdts(t._meta,e)})),a=AudioHelper.concatAdts(i,0);return new Promise((function(e,i){var o=t._audioCtx.decodeAudioData(a.buffer,(function(i){if(t._timeRange){if(t._lastAudioBufferInfo&&t.isLive){var a=t._lastAudioBufferInfo,o=a.dts+a.duration;(n=r.dts-o)>1&&(t._timeRange._duration+=n/1e3,logger.log(t.TAG,"_decodeAAC","audio data dts is not continue, last end dts:",o,",now start Dts:",r.dts,"delay:",n))}t._lastAudioBufferInfo={duration:Math.floor(1e3*i.duration),dts:r.dts};var s=t._timeRange.append(i,i.duration,r.dts,n/1e3);if(!t._ready){var l=Math.abs(s+i.duration-t.currentTime)<.5;(t.isLive||!l)&&(t._ready=!0,logger.log(t.TAG,"_decodeAAC","set ready true start=",s),t.emit(Events.AUDIO.AUDIO_READY,s))}t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PROGRESS),t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.DURATION_CHANGE),e()}}),i);o.catch&&o.catch(i)}))}},{key:"_decodeG711",value:function(){var t=this._sampleQueue.length,r=this._sampleQueue[0];if(!((this._sampleQueue[t-1].dts-r.dts)/this.timescale<.5)){var n=this._sampleQueue.reduce((function(e,t){return e+=t.data.byteLength}),0),i=new Uint8Array(n),a=0,o=0;this._sampleQueue.forEach((function(e,t){0===t&&(a=e.dts),i.set(e.data,o),o+=e.data.byteLength})),this._sampleQueue=[];try{var s=this._meta,l=s.codecType,u=s.channelCount,c=s.sampleSize,d=s.sampleRate,h=AudioHelper.decodeG711(i,l),f=AudioHelper.createAudioBufferFromPcm(this._audioCtx,h.buffer,u,d,c/8),p=f.audioBuffer,y=f.duration,m=this._timeRange.append(p,y,a,0);this._ready||(this._ready=!0,logger.log(this.TAG,"_decodeG711","set ready true"),this.emit(Events.AUDIO.AUDIO_READY,m)),this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PROGRESS),this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.DURATION_CHANGE)}catch(e){this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,this._assembleErr("ERROR_MSG.DECODE_ERR:".concat(e&&e.message)))}}}},{key:"_onSourceBufferEnded",value:function(){this._isSourceBufferEnd=!0,logger.long&&logger.log(this.TAG,"source play end! currentTime:".concat(this.currentTime," , duration:").concat(this.duration)),this._startRender()}},{key:"_ajustSeekTime",value:function(e){var t=this._timeRange.getBuffer(e,0);t&&(logger.log(this.TAG,"ajust seek time to:",t.start),this._lastTimeLineTime=t.start)}},{key:"_getAudioBuffer",value:function(e){var t=this;if(this._timeRange){var r=this._timeRange.getBuffer(this._lastBuffer?this._lastBuffer.end:this.currentTime,0);return r?e?(this._ajustSeekTime(r.start),void this.emit(Events.AUDIO.AUDIO_READY)):r:(this._endOfStream||!this._isLive)&&this.currentTime-this.duration>-.5?(this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.TIMEUPDATE),void this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ENDED)):(this._ready=!1,this._audioCtx.suspend(),this.emit(Events.AUDIO.AUDIO_WAITING),void(e&&(this._onAudioReady||(this._onAudioReady=function(e){t._ajustSeekTime(e)}),this.removeListener(Events.AUDIO.AUDIO_READY,this._onAudioReady),this.once(Events.AUDIO.AUDIO_READY,this._onAudioReady))))}}},{key:"_startRender",value:function(t){if(!this.noAudio){if("video"===t&&this.isLive&&this._ready&&!this._isSourceBufferEnd)return console.log(this.TAG,"_startRender, audio currentTime",this.currentTime,"from:",t,"_isSourceBufferEnd:",this._isSourceBufferEnd,"ready:",this._ready),void this._doPlay();var r=this._getAudioBuffer();if(r){"suspended"===this._audioCtx.state&&(this._audioCtx.resume().catch((function(e){})),playSlienceAudio()),this._lastBuffer=r,this._source=null;var n=this._audioCtx.createBufferSource();n.buffer=r.source,n.loop=!1,this._source=n,n.addEventListener("ended",this._onSourceBufferEnded),n.connect(this._gainNode),r.delay&&r.delay>.001&&(this._delay+=r.delay),this.startDts=r.startDts;try{this._isSourceBufferEnd=!1,n.start()}catch(e){}r.startDts&&this._emitTimelineEvents(Events.TIMELINE.SYNC_DTS,r.startDts)}}}},{key:"_destroy",value:function(){logger.log(this.TAG,"destroy audio..."),this._source&&this._source.removeEventListener("ended",this._onSourceBufferEnded),this._audioCtx&&"closed"!==this.ctxState&&this._audioCtx.close(),this._audioCtx=null,this._sampleQueue=null,this._timeRange=null,this._parent=null,this.removeAllListeners()}}]),a}(BaseRender);function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(l){s=!0,i=l}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var TrackType={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},VideoCodecType={AVC:"avc",HEVC:"hevc"};function concatUint8Array(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=t.filter(Boolean);var n=new Uint8Array(t.reduce((function(e,t){return e+t.byteLength}),0)),i=0;return t.forEach((function(e){n.set(e,i),i+=e.byteLength})),n}function parse(e){if(!Array.isArray(e)){for(var t=[],r="",n=0;n<e.length;n++)n%2&&(r=e[n-1]+e[n],t.push(parseInt(r,16)),r="");return t}return e.map((function(e){return parseInt(e,16)}))}function Concat(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];n.forEach((function(e){t+=e.length}));var a=new e(t),o=0;return n.forEach((function(e){a.set(e,o),o+=e.length})),a}var Buffer=function(){function e(){_classCallCheck(this,e),this.buffer=new Uint8Array(0)}return _createClass(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){t?e.buffer=Concat(Uint8Array,e.buffer,t):window.console.warn(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}(),UINT32_MAX=Math.pow(2,32)-1,MP4=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"box",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=8+(r=r.filter(Boolean)).reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return r.forEach((function(e){a.set(e,o),o+=e.byteLength})),a}},{key:"ftyp",value:function(t){return t.find((function(e){return e.type===TrackType.VIDEO&&e.codecType===VideoCodecType.HEVC}))?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return concatUint8Array(e.ftyp(t),e.moov(t))}},{key:"pssh",value:function(t){var r=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],parse(t.kid),[0,0,0,0]));return e.box(e.types.pssh,r)}},{key:"moov",value:function(t){if(t[0].useEME&&(t[0].encv||t[0].enca)){t[0].pssh||(t[0].pssh={kid:t[0].kid});var r=this.pssh(t[0].pssh);return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale),e.mvex(t)].concat(_toConsumableArray(t.map((function(t){return e.trak(t)}))),[r]))}return e.box.apply(e,[e.types.moov,e.mvhd(t[0].mvhdDurtion||t[0].duration,t[0].mvhdTimecale||t[0].timescale)].concat(_toConsumableArray(t.map((function(t){return e.trak(t)}))),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return n}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.tkhdDuration||0,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]));return a}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4,n=e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]));return n}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===TrackType.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){var r=[];return t&&t.ext&&t.ext.stss&&r.push(e.stss(t.ext.stss.entries)),e.box(e.types.stbl,e.stsd(t),e.STTS,r[0],e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){var r;return r="audio"===t.type?t.useEME&&t.enca?e.enca(t):e.mp4a(t):t.useEME&&t.encv?e.encv(t):e.avc1hev1(t),e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),r)}},{key:"enca",value:function(t){var r=t.enca.channelCount,n=t.enca.sampleRate,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,n>>8&255,255&n,0,0]),a=e.esds(t.config),o=e.sinf(t.enca);return e.box(e.types.enca,i,a,o)}},{key:"encv",value:function(t){var r,n,i=t.sps.length>0?t.sps[0]:[],a=t.pps.length>0?t.pps[0]:[],o=t.width,s=t.height,l=t.sarRatio[0],u=t.sarRatio[1],c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,s>>8&255,255&s,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d=new Uint8Array((r=(n=[1,i[1],i[2],i[3],255,225,i.length>>>8&255,255&i.length]).concat.apply(n,_toConsumableArray(i)).concat([1,a.length>>>8&255,255&a.length])).concat.apply(r,_toConsumableArray(a))),h=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),f=e.sinf(t.encv),p=new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u]);return e.box(e.types.encv,c,e.box(e.types.avcC,d),e.box(e.types.btrt,h),f,e.box(e.types.pasp,p))}},{key:"schi",value:function(t){var r=new Uint8Array([]),n=e.tenc(t);return e.box(e.types.schi,r,n)}},{key:"tenc",value:function(t){var r=new Uint8Array([0,0,0,0,0,0,255&t.default_IsEncrypted,255&t.default_IV_size].concat(parse(t.default_KID)));return e.box(e.types.tenc,r)}},{key:"sinf",value:function(t){var r=new Uint8Array([]),n=new Uint8Array([t.data_format.charCodeAt(0),t.data_format.charCodeAt(1),t.data_format.charCodeAt(2),t.data_format.charCodeAt(3)]),i=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),a=e.schi(t);return e.box(e.types.sinf,r,e.box(e.types.frma,n),e.box(e.types.schm,i),a)}},{key:"avc1hev1",value:function(t){var r=t.codecType===VideoCodecType.HEVC,n=r?e.types.hvc1:e.types.avc1,i=r?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return r?a.push(e.box(e.types.fiel,new Uint8Array([1,0]))):t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[n].concat(a))}},{key:"avcC",value:function(t){var r,n,i,a=[],o=[];return t.sps.forEach((function(e){i=e.byteLength,a.push(i>>>8&255),a.push(255&i),a.push.apply(a,_toConsumableArray(e))})),t.pps.forEach((function(e){i=e.byteLength,o.push(i>>>8&255),o.push(255&i),o.push.apply(o,_toConsumableArray(e))})),e.box(e.types.avcC,new Uint8Array((r=(n=[1,a[3],a[4],a[5],255,224|t.sps.length]).concat.apply(n,a).concat([t.pps.length])).concat.apply(r,o)))}},{key:"hvcC",value:function(t){var r=t.hvcC;if(r instanceof ArrayBuffer||r instanceof Uint8Array)return r;var n,i=t.vps,a=t.sps,o=t.pps;if(r){var s=r.generalProfileCompatibilityFlags,l=r.generalConstraintIndicatorFlags,u=(i.length&&1)+(a.length&&1)+(o.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,s>>>24,s>>>16,s>>>8,s,l[0],l[1],l[2],l[3],l[4],l[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,u];var c=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,_toConsumableArray(e))};i.length&&(n.push(160,0,i.length),i.forEach(c)),a.length&&(n.push(161,0,a.length),a.forEach(c)),o.length&&(n.push(162,0,o.length),o.forEach(c))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var r=_slicedToArray(t,2),n=r[0],i=r[1];return e.box(e.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var r=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+r,0,0,0,4,15+r,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([r]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat(_toConsumableArray(t.map((function(t){return e.trex(t.id)})))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trex1",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]))}},{key:"trex2",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]))}},{key:"moof",value:function(t){return e.box.apply(e,[e.types.moof,e.mfhd(t[0].samples?t[0].samples[0].gopId:0)].concat(_toConsumableArray(t.map((function(t){return e.traf(t)})))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){var r=e.tfhd(t.id),n=e.tfdt(t,t.baseMediaDecodeTime),i=0;if(t.isVideo&&t.videoSenc&&t.videoSenc.forEach((function(e){i+=8,e.subsamples&&e.subsamples.length&&(i+=2,i+=6*e.subsamples.length)})),t.videoSencLength=i,t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)){if(t.isVideoEncryption){if(t.isVideo){var a=e.saiz(t),o=e.saio(t),s=e.trun1(t),l=e.senc(t);return e.box(e.types.traf,r,n,a,o,s,l)}if(t.isAudioEncryption){var u=e.sbgp(),c=e.saiz(t),d=e.saio(t),h=e.senc(t),f=e.trun1(t);return e.box(e.types.traf,r,n,u,c,d,h,f)}var p=e.sbgp(),y=e.trun1(t);return e.box(e.types.traf,r,n,p,y)}if(t.isVideo){var m=e.trun1(t);return e.box(e.types.traf,r,n,m)}var g=e.sbgp(),v=e.saiz(t),b=e.saio(t),_=e.senc(t),E=e.trun1(t);return e.box(e.types.traf,r,n,g,v,b,_,E)}var T=e.sdtp(t);return e.box(e.types.traf,r,n,T,e.trun(t.samples,T.byteLength+76))}},{key:"sdtp",value:function(t){var r=new Buffer;return t.samples.forEach((function(e){r.write(new Uint8Array(t.isVideo?[e.keyframe?32:16]:[16]))})),e.box(e.types.sdtp,this.extension(0,0),r.buffer)}},{key:"trun1",value:function(t){var r=new Buffer,n=Buffer.writeUint32(t.samples.length),i=null;if(t.isVideo){var a=t.videoSencLength;i=Buffer.writeUint32(16*t.samples.length+a+149),!t.isVideoEncryption&&t.isAudioEncryption&&(i=Buffer.writeUint32(16*t.samples.length+92))}else{var o=12*t.samples.length+124;t.isAudioEncryption&&(o=12*t.samples.length+8*t.audioSenc.length+177),i=Buffer.writeUint32(o)}return t.samples.forEach((function(e){r.write(Buffer.writeUint32(e.duration)),r.write(Buffer.writeUint32(e.size)),r.write(Buffer.writeUint32(e.keyframe?33554432:65536)),t.isVideo&&r.write(Buffer.writeUint32(e.cts?e.cts:0))})),e.box(e.types.trun,this.extension(0,t.flags),n,i,r.buffer)}},{key:"senc",value:function(t){var r=new Buffer,n=t.samples.length,i=t.isVideo?16:8,a=t.isVideo?2:0,o=[],s=0;return t.isVideo?(o=t.videoSenc,s=t.videoSencLength):o=t.audioSenc,s=s||i*n,r.write(Buffer.writeUint32(16+s),e.types.senc,this.extension(0,a)),r.write(Buffer.writeUint32(n)),o.forEach((function(e){for(var t=0;t<e.InitializationVector.length;t++)r.write(new Uint8Array([e.InitializationVector[t]]));e.subsamples&&e.subsamples.length&&(r.write(Buffer.writeUint16(e.subsamples.length)),e.subsamples.forEach((function(e){r.write(Buffer.writeUint16(e.BytesOfClearData)),r.write(Buffer.writeUint32(e.BytesOfProtectedData))})))})),r.buffer}},{key:"saio",value:function(t){var r=12*t.samples.length+141;!t.isVideo&&t.isAudioEncryption&&(r=149);var n=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saio,n)}},{key:"saiz",value:function(t){var r=t.samples.length,n=new Uint8Array([0,0,0,0,16,r>>24&255,r>>16&255,r>>8&255,255&r]);return e.box(e.types.saiz,n)}},{key:"sbgp",value:function(){var t=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return e.box(e.types.sbgp,this.extension(0,0),t)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t,r){var n=Math.floor(r/(UINT32_MAX+1)),i=Math.floor(r%(UINT32_MAX+1));return t.useEME&&(t.isVideoEncryption||t.isAudioEncryption)?e.box(e.types.tfdt,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])):e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i]))}},{key:"trun",value:function(t,r){var n=t.length,i=12+16*n;r+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<n;o++){var s=t[o],l=s.duration,u=s.size,c=s.flag,d=void 0===c?{}:c,h=s.cts,f=void 0===h?0:h;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,d.isLeading<<2|(null===d.dependsOn||void 0===d.dependsOn?1:d.dependsOn),d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|(null===d.isNonSyncSample||void 0===d.isNonSyncSample?1:d.isNonSyncSample),61440&d.degradationPriority,15&d.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat(_toConsumableArray(t.map((function(t){return e.trackMP4(t)})))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===TrackType.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var r=t.ext,n=[e.stsd(t),e.stts(r.stts),e.stsc(r.stsc),e.stsz(r.stsz),e.stco(r.stco)];return r.stss.length&&n.push(e.stss(r.stss)),r.ctts.length&&n.push(e.ctts(r.ctts)),e.box.apply(e,[e.types.stbl].concat(n))}},{key:"stts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.stts,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsc",value:function(t){var r=t.length,n=new Uint8Array(12*r),i=0;return t.forEach((function(e){var t=e.firstChunk,r=e.samplesPerChunk,a=e.sampleDescIndex;n.set([t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12})),e.box(e.types.stsc,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stsz",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stsz,concatUint8Array(new Uint8Array([0,0,0,0,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stco",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stco,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"stss",value:function(t){var r=t.length,n=new Uint8Array(4*r),i=0;return t.forEach((function(e){n.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4})),e.box(e.types.stss,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"ctts",value:function(t){var r=t.length,n=new Uint8Array(8*r),i=0;return t.forEach((function(e){var t=e.value,r=e.count;n.set([r>>24,r>>16&255,r>>8&255,255&r,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8})),e.box(e.types.ctts,concatUint8Array(new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]),n))}},{key:"styp",value:function(){return e.box(e.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(t){var r=t.timescale,n=t.samples[0].duration,i=n*t.samples.length,a=t.samples[0].sampleOffset*n,o=8;t.samples.forEach((function(e){o+=e.size}));var s=0;if(t.isVideo){var l,u=0;t.videoSenc&&(l=t.videoSenc),t.isVideo&&l.forEach((function(e){u+=8,e.subsamples&&e.subsamples.length&&(u+=2,u+=6*e.subsamples.length)})),t.videoSencLength=u,s=o+141+16*t.samples.length+u,t.useEME&&t.isAudioEncryption&&!t.isVideoEncryption&&(s=o+16*t.samples.length+84)}else s=o+116+12*t.samples.length,t.useEME&&t.isAudioEncryption&&(s=o+169+12*t.samples.length+8*t.audioSenc.length);var c=new Uint8Array([0,0,0,0,0,0,0,255&t.id,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,1,0,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i,144,0,0,0]);return e.box(e.types.sidx,c)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();_defineProperty(MP4,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce((function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e}),Object.create(null))),_defineProperty(MP4,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),_defineProperty(MP4,"FTYPAVC1",MP4.box(MP4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),_defineProperty(MP4,"FTYPHEV1",MP4.box(MP4.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),_defineProperty(MP4,"DINF",MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),_defineProperty(MP4,"VMHD",MP4.box(MP4.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),_defineProperty(MP4,"SMHD",MP4.box(MP4.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),_defineProperty(MP4,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),_defineProperty(MP4,"STTS",MP4.box(MP4.types.stts,MP4.StblTable)),_defineProperty(MP4,"STSC",MP4.box(MP4.types.stsc,MP4.StblTable)),_defineProperty(MP4,"STSZ",MP4.box(MP4.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),_defineProperty(MP4,"STCO",MP4.box(MP4.types.stco,MP4.StblTable));var Logger=function(){function e(t,r){_classCallCheck(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),e.disabled=r}return _createClass(e,[{key:"debug",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).debug.apply(t,[this._prefix].concat(n))}}},{key:"log",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).log.apply(t,[this._prefix].concat(n))}}},{key:"warn",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).warn.apply(t,[this._prefix].concat(n))}}},{key:"error",value:function(){var t;if(!e.disabled){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];(t=console).error.apply(t,[this._prefix].concat(n))}}},{key:"table",value:function(){var t;e.disabled||(console.group(this._prefix),(t=console).table.apply(t,arguments),console.groupEnd())}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();_defineProperty(Logger,"disabled",!0);var FMP4Remuxer=function(){function e(t,r,n){_classCallCheck(this,e),this.videoTrack=t,this.audioTrack=r;var i=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=i&&Number(i[1])<50,this.log=new Logger("FMP4Remuxer",!n||!n.openLog||!n.openLog)}return _createClass(e,[{key:"remux",value:function(){var e,t,r,n,i,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.videoTrack,l=this.audioTrack,u=s.exist(),c=l.exist(),d=[];return a&&(o&&o.initMerge?(u&&d.push(this.videoTrack),c&&d.push(this.audioTrack),r=MP4.initSegment(d)):(u&&(e=MP4.initSegment([this.videoTrack])),c&&(t=MP4.initSegment([this.audioTrack])))),u&&s.hasSample()&&(n=this._remuxVideo()),c&&l.hasSample()&&(i=this._remuxAudio()),s.samples=[],l.samples=[],{initSegment:r,videoInitSegment:e,audioInitSegment:t,videoSegment:n,audioSegment:i}}},{key:"_remuxVideo",value:function(){var e=this.videoTrack;this.forceFirstIDR&&(e.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=e.samples,r=0;t.forEach((function(e){r+=e.units.reduce((function(e,t){return e+t.byteLength}),0),r+=4*e.units.length}));for(var n,i=new Uint8Array(r),a=new DataView(i.buffer),o=function(e,r,o,s){s=t[e];var l=0;s.units.forEach((function(e){a.setUint32(o,e.byteLength),o+=4,i.set(e,o),o+=e.byteLength,l+=4+e.byteLength})),s.size=l,u=o,n=s},s=0,l=t.length,u=0;s<l;s++)o(s,0,u,n);var c=MP4.mdat(i);return concatUint8Array(MP4.moof([e]),c)}},{key:"_remuxAudio",value:function(){var e=this.audioTrack,t=new Uint8Array(e.samples.reduce((function(e,t){return e+t.size}),0));e.samples.reduce((function(e,r){return t.set(r.data,e),e+r.size}),0);var r=MP4.mdat(t);return concatUint8Array(MP4.moof([e]),r)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),e}(),MP4Remuxer=function(){function e(t,r){_classCallCheck(this,e),this.videoTrack=t,this.audioTrack=r}return _createClass(e,[{key:"remux",value:function(e,t){this.videoTrack=e||this.videoTrack,this.audioTrack=t||this.audioTrack;var r,n,i=(null==e?void 0:e.exist())&&(null==e?void 0:e.hasSample()),a=(null==t?void 0:t.exist())&&(null==t?void 0:t.hasSample());return i&&a?r=this._remuxMix(e,t):i?r=this._remuxTrack(e):a&&(n=this._remuxTrack(t)),e&&(e.samples=[]),t&&(t.samples=[]),{videoSegment:r,audioSegment:n}}},{key:"_remuxMix",value:function(e,t){var r=MP4.ftyp([e,t]),n=this._remuxData(e,r.byteLength+8),i=n.mdatData,a=n.chunkOffset,o=this._remuxData(t,a).mdatData,s=MP4.mdat(concatUint8Array(i,o)),l=MP4.moovMP4([e,t]);return e.ext=void 0,t.ext=void 0,e.samples=[],t.samples=[],concatUint8Array(r,s,l)}},{key:"_remuxTrack",value:function(e){var t=MP4.ftyp([e]),r=this._remuxData(e,t.byteLength+8).mdatData,n=MP4.mdat(r),i=MP4.moovMP4([e]);return e.ext=void 0,e.samples=[],concatUint8Array(t,n,i)}},{key:"_remuxData",value:function(e,t){var r=e.type===TrackType.VIDEO,n=e.samples,i=0;r?n.forEach((function(e){i+=e.units.reduce((function(e,t){return e+t.byteLength}),0),i+=4*e.units.length})):i=n.reduce((function(e,t){return e+t.size}),0);for(var a,o=new Uint8Array(i),s=new DataView(o.buffer),l=e.ext={stts:[],stsc:[],stsz:[],stco:[],stss:[],ctts:[]},u=0,c=0,d=n.length,h=0;h<d;h++){c+=(a=n[h]).duration;var f=r?0:a.size;r?a.units.forEach((function(e){s.setUint32(u,e.byteLength),u+=4,o.set(e,u),u+=e.byteLength,f+=4+e.byteLength})):(o.set(a.data,u),u+=f),a.size=f,l.stsz.push(f),r&&this._fillCttsSamples(l.ctts,a.cts),this._fillSttsSamples(l.stts,a,n[h+1]),this._fillStcoSamples(l.stco,h,1,t),t+=f,r&&a.keyframe&&l.stss.push(h+1)}return e.duration=c,this._fillStscSamples(l.stsc,d,1),{mdatData:o,chunkOffset:t}}},{key:"_fillSttsSamples",value:function(e,t,r){var n=e[e.length-1];r?n&&n.value===t.duration?n.count++:e.push({value:t.duration,count:1}):n?n.count++:e.push({value:40,count:1})}},{key:"_fillCttsSamples",value:function(e,t){var r=e[e.length-1];r&&r.value===t?r.count++:e.push({value:t,count:1})}},{key:"_fillStcoSamples",value:function(e,t,r,n){t%r||e.push(n)}},{key:"_fillStscSamples",value:function(e,t,r){if(t<=r)e.push({firstChunk:1,samplesPerChunk:t,sampleDescIndex:1});else{var n=Math.floor(t/r),i=t%r;e.push({firstChunk:1,samplesPerChunk:r,sampleDescIndex:1}),i&&e.push({firstChunk:n+1,samplesPerChunk:i,sampleDescIndex:1})}}}]),e}(),AUDIO_ERROR_SUBCODE=3,CODEC_MAP={"mp4a.40.5":1,"mp4a.40.2":2},JUMP_GAP_STEP=.05,MediaCache=function(){function e(){_classCallCheck$1(this,e),_defineProperty$1(this,"_queue",[]),"undefined"!=typeof document&&(this._tempMedia=document.createElement("video"))}return _createClass$1(e,[{key:"tempMedia",get:function(){return this._tempMedia}},{key:"hasCached",get:function(){return-1!==this._queue.findIndex((function(e){return 1===e.codec}))&&-1!==this._queue.findIndex((function(e){return 2===e.codec}))}},{key:"getCachedMedia",value:function(e){var t=this._queue.findIndex((function(t){return t.codec===e}));return-1!==t?this._queue.splice(t,1)[0]:null}},{key:"cacheMedia",value:function(e){var t=e.codec,r=e.media,n=e.mse,i=CODEC_MAP[t];if(this._queue=this._queue.filter((function(e){var t;return e.mse&&!e.mse.isOpened&&e.mse.unbindMedia(),null===(t=e.mse)||void 0===t?void 0:t.isOpened})),!t||this._queue.filter((function(e){return e.codec===i})).length>2)return null==n||n.endOfStream(),void(null==n||n.unbindMedia());this._queue.push({codec:i,media:r,mse:n})}}]),e}(),mediaCache=new MediaCache,AudioMseRender=function(t){_inherits(o,t);var r,n,i,a=_createSuper(o);function o(t,r){var n;return _classCallCheck$1(this,o),_defineProperty$1(_assertThisInitialized(n=a.call(this,t,r)),"_media",void 0),_defineProperty$1(_assertThisInitialized(n),"_isTempMedia",!1),_defineProperty$1(_assertThisInitialized(n),"_mse",void 0),_defineProperty$1(_assertThisInitialized(n),"_remuxer",null),_defineProperty$1(_assertThisInitialized(n),"_codec",""),_defineProperty$1(_assertThisInitialized(n),"_sourceCreated",!1),_defineProperty$1(_assertThisInitialized(n),"_needInitSegment",!0),_defineProperty$1(_assertThisInitialized(n),"_seekNoSideEffect",!1),_defineProperty$1(_assertThisInitialized(n),"_startRendered",!1),_defineProperty$1(_assertThisInitialized(n),"_firstTimeAppendedBuffer",!1),_defineProperty$1(_assertThisInitialized(n),"_sampleQueue",[]),_defineProperty$1(_assertThisInitialized(n),"_inProcessing",!1),_defineProperty$1(_assertThisInitialized(n),"_duration",0),_defineProperty$1(_assertThisInitialized(n),"_mediaCache",mediaCache),_defineProperty$1(_assertThisInitialized(n),"_resetDts",(function(){})),_defineProperty$1(_assertThisInitialized(n),"_onCanplay",(function(){n._ready||(n._ready=!0,n.emit(Events.AUDIO.AUDIO_READY))})),_defineProperty$1(_assertThisInitialized(n),"_onPlaying",(function(){n._parent.ready&&(n._audioCanAutoplay=!0,n._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PLAYING))})),_defineProperty$1(_assertThisInitialized(n),"_onWaiting",(function(){if(!n._seekNoSideEffect){try{for(var t,r=n._media.buffered,i=n._media.currentTime,a=0,o=0,s=r.length;o<s;o++)r.start(o)<i&&r.end(o)>i&&(a=r.end(o)-i);if(Math.abs(a)>.5)return;if(Math.abs(n._media.duration-n._media.currentTime)<.3)return n._reuseMse||n._mse.endOfStream(),void(null===(t=_assertThisInitialized(n))||void 0===t||t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ENDED))}catch(e){}n._ready=!1,n.emit(Events.AUDIO.AUDIO_WAITING)}})),_defineProperty$1(_assertThisInitialized(n),"_onSeeked",(function(){n._seekNoSideEffect||n._isLive?n._seekNoSideEffect=!1:(logger.log(n.TAG,"seeked"),n._ready||(n._media.pause(),n._ready=!0,n.emit(Events.AUDIO.AUDIO_READY)))})),_defineProperty$1(_assertThisInitialized(n),"_onProgress",(function(){if(n._media.readyState<=1){var e=n._getBufferGap();e>0&&e<1&&(n._media.currentTime+=e+JUMP_GAP_STEP,logger.warn(n.TAG,"progress, gap=",e))}n._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PROGRESS),n._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.DURATION_CHANGE)})),_defineProperty$1(_assertThisInitialized(n),"_onEnded",(function(){var e;logger.log(n.TAG,"ended!"),null===(e=_assertThisInitialized(n))||void 0===e||e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ENDED)})),_defineProperty$1(_assertThisInitialized(n),"_onOnceProgress",(function(){if(n._media.buffered.length){var e=n._media.buffered.start(0);e&&(n._media.currentTime=e+JUMP_GAP_STEP,logger.log(n.TAG,"start gap:",e)),n._media.removeEventListener("progress",n._onOnceProgress)}})),_defineProperty$1(_assertThisInitialized(n),"_onError",(function(){var e;n._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,n._assembleErr("audio error: ".concat(null===(e=n._media.error)||void 0===e?void 0:e.message),AUDIO_ERROR_SUBCODE))})),_defineProperty$1(_assertThisInitialized(n),"_appendChunk",(function(e,t){if(!n.noAudio&&t.samples.length){if(n._codec||(2!==t.objectType&&5!==t.objectType?n._codec="mp4a.40.5":n._codec=t.codec,n._isTempMedia&&n._switchMedia(n._codec)),t.samples.forEach((function(e){e.baseMediaDecodeTime=t.baseMediaDecodeTime,n._sampleQueue.push(e)})),t.samples=[],!n._meta)return n._meta=_objectSpread2(_objectSpread2({},t),{},{exist:function(){return!0},hasSample:function(){return!0},samples:[]}),logger.warn(n.TAG,"audio set metadata",n._meta),void n._doAppendWrapper();n._meta.sampleRate!==t.sampleRate&&(logger.warn(n.TAG,"discontinue: ".concat(n._meta.sampleRate," -> ").concat(t.sampleRate)),n._needInitSegment=!0,Object.keys(t).forEach((function(e){n._meta[e]=t[e]}))),!n._inProcessing&&n._sampleQueue.length&&n._doAppendWrapper()}})),_defineProperty$1(_assertThisInitialized(n),"_doAppend",function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,i,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._remuxer||(n._remuxer=new FMP4Remuxer({samples:[],exist:function(){return!1}},t)),r=t.samples,n._sourceCreated){e.next=12;break}return n.analyse.addAudioMseOpenStart(),e.next=6,n._mse.open();case 6:n._sourceCreated=!0,logger.log(n.TAG,"video/mp4;codecs=".concat(n._codec)),n._mse.createSource(t.type,"video/mp4;codecs=".concat(n._codec)),n.analyse.addAudioMseOpend(),logger.log(n.TAG,"sb created!"),n._checkAutoPlay();case 12:if(i=n._remuxer.remux(n._needInitSegment),!n._needInitSegment||i.audioInitSegment){e.next=15;break}return e.abrupt("return");case 15:return n._needInitSegment=!1,a=[],i.audioInitSegment&&a.push(n._mse.append(t.type,i.audioInitSegment)),i.audioSegment&&a.push(n._mse.append(t.type,i.audioSegment)),e.abrupt("return",Promise.all(a).then((function(){return r[r.length-1].dts/1e3})).then((function(){n._firstTimeAppendedBuffer||(n._firstTimeAppendedBuffer=!0,n.analyse.addAudioFirstTimeAppended())})));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty$1(_assertThisInitialized(n),"_doPlay",(function(){n._media.play().catch((function(){}))})),_defineProperty$1(_assertThisInitialized(n),"_doPause",(function(){n._media.pause()})),_defineProperty$1(_assertThisInitialized(n),"_doSeek",(function(e){n._ready=!1,n._media.currentTime=e})),_defineProperty$1(_assertThisInitialized(n),"_doChaseFrame",(function(e){var t=e.position;n._seekNoSideEffect=!0,n._media.currentTime=t})),_defineProperty$1(_assertThisInitialized(n),"_startRender",(function(){logger.log(n.TAG,"start render"),n._startRendered=!0,n._media.play().catch((function(){}))})),n.TAG="AudioMseRender",n._reuseMse=getDecodeCapacaity().reuseMseForAudio,n._initMedia(),n}return _createClass$1(o,[{key:"isMse",get:function(){return!0}},{key:"media",get:function(){return this._media}},{key:"currentTime",get:function(){return this._media.currentTime}},{key:"buffered",get:function(){return this._media.buffered}},{key:"duration",get:function(){return Number.isNaN(this._media.duration)?1/0:this._media.duration},set:function(e){this._duration=e,this._updateDuration(e)}},{key:"audioCanAutoplay",get:function(){return this._audioCanAutoplay||this.noAudio}},{key:"_initMedia",value:function(){if(!this._reuseMse||!mediaCache.hasCached)return logger.log(this.TAG,"init media and mse directly"),this._media=document.createElement("video"),this._media.autoplay=!0,this._mse=new MSE$2,this._bindEvents(),this._bindMediaEvents(),void this._mse.bindMedia(this._media);logger.log(this.TAG,"bind media temporary"),this._media=mediaCache.tempMedia,this._bindEvents(),this._isTempMedia=!0}},{key:"_switchMedia",value:function(e){var t=this._media,r=mediaCache.getCachedMedia(CODEC_MAP[e]);r?(logger.warn(this.TAG,"switch to cached media for audio play! codec=".concat(e)),this._media=r.media,this._mse=r.mse,this._bindMediaEvents(),this._updateDuration(this._duration),this._media.currentTime=JUMP_GAP_STEP,this._sourceCreated=!0,this._audioCanAutoplay=!0,this.analyse.addAudioMseOpend()):this._initMedia(),this._media.volume=t.volume,this._media.playbackRate=t.playbackRate,this._isTempMedia=!1}},{key:"_getBufferGap",value:function(){for(var e=this.buffered,t=0,r=e.length;t<r;t++)if(!(e.end(t)<this.currentTime))return e.start(t)-this.currentTime;return 0}},{key:"canSeek",value:function(){return!0}},{key:"resume",value:function(){return this._media.play()}},{key:"pause",value:function(){return this._media.pause()}},{key:"seekNoSideEffect",value:function(e){this._doChaseFrame(e)}},{key:"dump",value:function(){}},{key:"_emitTimelineEvents",value:function(e,t,r){var n,i;null===(n=this._parent)||void 0===n||null===(i=n.emit)||void 0===i||i.call(n,e,t,r)}},{key:"_assembleErr",value:function(e,t){var r=new Error(e);return r.code=3,r.subCode=t,r}},{key:"_bindEvents",value:function(){var e=this;_get(_getPrototypeOf(o.prototype),"_bindEvents",this).call(this),this._parent.on(Events.DECODE_EVENTS.CHASE_AUDIO_FRAME,this._doChaseFrame),this._parent.on(Events.TIMELINE.UPDATE_VOLUME,(function(t){e._media.volume=t,e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.VOLUME_CHANGE)})),this._parent.on(Events.TIMELINE.END_OF_STREAM,(function(){var t;e.reuseMseForAudio||(null===(t=e._mse)||void 0===t||t.endOfStream())})),this._parent.on(Events.TIMELINE.SET_PLAYBACKRATE,(function(t){logger.log(e.TAG,"change playbackrate, ",t),e._media.playbackRate=t}))}},{key:"_bindMediaEvents",value:function(){this._media.addEventListener("canplay",this._onCanplay),this._media.addEventListener("playing",this._onPlaying),this._media.addEventListener("waiting",this._onWaiting),this._media.addEventListener("seeked",this._onSeeked),this._media.addEventListener("progress",this._onProgress),this._media.addEventListener("ended",this._onEnded),this._media.addEventListener("progress",this._onOnceProgress),this._media.addEventListener("error",this._onError)}},{key:"_updateDuration",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._mse){e.next=7;break}if(this._mse.isOpened){e.next=4;break}return e.next=4,this._mse.open();case 4:return e.next=6,this._mse.updateDuration(t);case 6:logger.log(this.TAG,"update duration",t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_doAppendWrapper",value:(n=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._meta.samples=this._sampleQueue.slice(),this._meta.baseMediaDecodeTime=this._meta.samples[0].baseMediaDecodeTime,this._sampleQueue=[],e.prev=3,this._inProcessing=!0,e.next=7,this._doAppend(this._meta);case 7:if(t=e.sent,this.isLive&&this._emitTimelineEvents(Events.TIMELINE.UPDATE_SEGMENT_END,t),this._inProcessing=!1,!this._sampleQueue.length){e.next=13;break}return e.next=13,this._doAppendWrapper();case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,this._assembleErr("audio error: ".concat(null===e.t0||void 0===e.t0?void 0:e.t0.message),AUDIO_ERROR_SUBCODE));case 18:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return n.apply(this,arguments)})},{key:"_checkAutoPlay",value:function(){var e=this;this._media.addEventListener("canplay",(function t(){var r=e._media.volume;e._media.volume=Math.min(r,.1);var n=e._media.play();(n=n.then?n:Promise.reject()).then((function(){logger.log(e.TAG,"auto play by checkAutoPlay!"),e._audioCanAutoplay=!0})).catch((function(){logger.warn(e.TAG,"cant auto play!"),e._audioCanAutoplay=!1,e.emit(Events.AUDIO.AUDIO_NOT_ALLOWED_AUTOPLAY)})).finally((function(){e._media.volume=r,e._startRendered||(e._media.pause(),logger.log(e.TAG,"auto paused by checkAutoPlay!")),e._media.removeEventListener("canplay",t)}))}))}},{key:"_destroy",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(logger.log(this.TAG,"destroy audio render"),this._remuxer=null,this.removeAllListeners(),this._media.removeEventListener("canplay",this._onCanplay),this._media.removeEventListener("playing",this._onPlaying),this._media.removeEventListener("waiting",this._onWaiting),this._media.removeEventListener("seeked",this._onSeeked),this._media.removeEventListener("progress",this._onProgress),this._media.removeEventListener("ended",this._onEnded),this._media.removeEventListener("progress",this._onOnceProgress),this._media.removeEventListener("error",this._onError),this._reuseMse){e.next=17;break}return null===(t=this._mse)||void 0===t||t.endOfStream(),e.next=15,null===(r=this._mse)||void 0===r?void 0:r.unbindMedia();case 15:e.next=20;break;case 17:null===(n=this._mse)||void 0===n||n.clearAllBuffer(),mediaCache.cacheMedia({codec:this._codec,media:this._media,mse:this._mse}),logger.log(this.TAG,"cache media for audio play, codec=",this._codec);case 20:this._meta&&(this._meta.duration=0),this._mse=null,this._media=null;case 23:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}],[{key:"isSupported",value:function(){return getDecodeCapacaity().audioWithMse&&!!window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="mp4a.40.5"')}}]),o}(BaseRender),TOLERANCE$1=.1,MAX_TOLERANCE=1,VideoTimeRange=function(){function e(t){_classCallCheck$1(this,e),this.TAG="VideoTimeRange",this._parent=t,this._baseDts=0,this._lastDuration=0,this._duration=0,this._bitrate=0,this._totalSize=0,this._buffers=[],this._currentFrameQueue=[],this._frameIndexInQueue=0,this._delayEstimateList=[],this._keyframeQueue=[]}return _createClass$1(e,[{key:"isLive",get:function(){return this._parent.isLive}},{key:"baseDts",get:function(){return this._baseDts}},{key:"duration",get:function(){return this._duration},set:function(e){this._duration=e}},{key:"buffered",get:function(){var e=this;if(this.isLive)return{length:this._duration?1:0,start:function(){return 0},end:function(){return e._duration}};var t=this._mergeBufferRanges();return{length:t.length,start:function(e){var r=t[e];return r?r.start:0},end:function(e){var r=t[e];return r?r.end:1/0}}}},{key:"bufferStart",get:function(){var e;return(null===(e=this._buffers[0])||void 0===e?void 0:e.start)||0}},{key:"frameLength",get:function(){return this._currentFrameQueue.length}},{key:"keyFrameLength",get:function(){return this._keyframeQueue.length}},{key:"totalSize",get:function(){return this._totalSize}},{key:"bitrate",get:function(){return this._bitrate},set:function(e){this._bitrate=e}},{key:"lastDuration",get:function(){return this._lastDuration}},{key:"frames",get:function(){return this._currentFrameQueue}},{key:"getCurrentTime",value:function(e){return this._lastDuration+(e-this._baseDts)/1e3}},{key:"resetDts",value:function(e){this._baseDts=e}},{key:"_mergeBufferRanges",value:function(){var e=this._buffers.sort((function(e,t){return e.start>t.start?1:-1})),t=e.length,r=[];if(!t)return r;for(var n={start:e[0].start,end:e[0].end},i=1;i<t;i++){var a=e[i];Math.abs(n.end-a.start)<TOLERANCE$1?n.end=a.end:(r.push(n),n={start:a.start,end:a.end})}return r.push(n),r}},{key:"_caclBaseDts",value:function(e){-1===this._baseDts&&e&&(this._baseDts=e.dts,logger.log(this.TAG,"set baseDts: ",this._baseDts,"frame len:",this._currentFrameQueue.length))}},{key:"_updateDuration",value:function(e){for(var t=e.length,r=e[t-1],n=0;n<t;n++){var i=e[n];if(i&&i.options&&i.options.meta){var a=e[n-1]||this._currentFrameQueue[this._currentFrameQueue.length-1];a?this._lastDuration+=(a.dts-this._baseDts)/1e3:this._lastDuration=this._duration,logger.log(this.TAG,"updateBaseDts,record lastDuration:",this._lastDuration),this._baseDts=i.dts;break}}r&&(this._duration=(r.dts-this._baseDts)/1e3+this._lastDuration)}},{key:"_estimateBitRate",value:function(e){var t=e.length;if(t<=2){if(this._delayEstimateList=this._delayEstimateList.concat(e),(t=this._delayEstimateList.length)<=30)return;e=this._delayEstimateList,this._delayEstimateList=[]}for(var r=0,n=0;n<t;n++){var i=e[n];r+=i.data?i.data.length:i.units.reduce((function(e,t){return e+t.byteLength}),0)}this._totalSize+=r;var a=r/(e[t-1].dts-e[0].dts);this._bitrate=parseInt(8e3*a)}},{key:"_beforeAppendVodBuffer",value:function(e){var t=this;if(e.length){for(var r=[],n=[],i=0,a=e.length;i<a;i++)e[i].keyframe&&(r.push(n),n=[]),n.push(e[i]);n.length&&r.push(n),r.forEach((function(e){return t._appendVodBuffer(e)}))}}},{key:"_appendVodBuffer",value:function(e){if(e.length){var t=e[0],r=e[e.length-1],n=(t.dts-this._baseDts)/1e3,i=(r.dts-this._baseDts)/1e3;logger.enable&&logger.log(this.TAG,"add new buffer range [".concat(n," , ").concat(i,"]")),this._buffers.filter((function(e){return n>=e.start&&i<=e.end})).length||(this._buffers.push({start:n,end:i,duartion:i-n,frames:e.slice()}),this._buffers.sort((function(e,t){return e.start>t.start?1:-1})),this._afterAppendVodBuffer())}}},{key:"_afterAppendVodBuffer",value:function(){if(this._buffers.filter((function(e){var t;return!(null!==(t=e.frames[0])&&void 0!==t&&t.keyframe)})).length){for(var e=this._buffers,t=this._buffers.length,r=[],n=this._buffers[0],i=1;i<t;i++){var a;null!==(a=e[i].frames[0])&&void 0!==a&&a.keyframe?(r.push(n),n=e[i]):(n.frames=n.frames.concat(e[i].frames),n.end=e[i].end,n.duartion=n.end-n.start)}r.push(n),this._buffers=r}}},{key:"_recordKeyframes",value:function(e){var t=this;e.forEach((function(e){if(e.keyframe){var r=(e.dts-t._baseDts)/1e3;t._keyframeQueue.push({position:r,frame:e})}})),this._keyframeQueue=this._keyframeQueue.sort((function(e,t){return e.position>t.position?1:-1})),this.isLive&&this._keyframeQueue.length>40&&this._keyframeQueue.splice(0,20)}},{key:"toAnnexBNalu",value:function(e){e.forEach((function(e){var t=e.units;if(t){var r=t.reduce((function(e,t){return e+4+t.byteLength}),0),n=new Uint8Array(r),i=0;t.forEach((function(e){n.set([0,0,0,1],i),i+=4,n.set(e,i),i+=e.byteLength})),e.units=null,e.data=n}}))}},{key:"append",value:function(e,t,r){r&&this.toAnnexBNalu(e),this._caclBaseDts(e[0]),t&&this._updateDuration(e),this._estimateBitRate(e),this._recordKeyframes(e),this.isLive?this._currentFrameQueue=this._currentFrameQueue.concat(e):this._beforeAppendVodBuffer(e)}},{key:"updateSegmentEnd",value:function(e){var t=this._buffers[this._buffers.length-1];t&&(Math.abs(t.end-e)<.5||(t.end=e,t.duartion=e-t.start,logger.log(this.TAG,"video data lack, reset end:",e)))}},{key:"getFrame",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.isLive)return this._currentFrameQueue.shift();if(!(e=this._currentFrameQueue[this._frameIndexInQueue])){if(!(e=this._currentFrameQueue[--this._frameIndexInQueue]))return;var r=this.switchBuffer((e.dts-this._baseDts)/1e3,this._frameIndexInQueue++,t);if(!r)return;return this.getFrame(++t)}return this._frameIndexInQueue++,e}},{key:"getFramesForPreciseSeek",value:function(e){return this._currentFrameQueue.filter((function(t){return t.dts<=e}))}},{key:"updateFrameIndexForPreciseSeek",value:function(e){this._frameIndexInQueue=e}},{key:"switchBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(r>=20)){e=e||this.bufferStart;var n=this._buffers.filter((function(t){return t.start<e+TOLERANCE$1&&t.end>=e+TOLERANCE$1}))[0];if(!n){var i=this._buffers.find((function(t){return t.start>=e}));return i&&i.start-e<MAX_TOLERANCE?(this._currentFrameQueue=i.frames.slice(0),this._frameIndexInQueue=0,i):void 0}return n.frames[0].dts>=e?(this._currentFrameQueue=n.frames.slice(0),this._frameIndexInQueue=0,logger.log(this.TAG,"switch video buffer, time:".concat(e," , buffer:[").concat(n.start," , ").concat(n.end,"], index=0")),n):n.frames.length>t?(this._currentFrameQueue=n.frames.slice(0),logger.log(this.TAG,"switch video buffer, in the same gop and more frame got, time:".concat(e," , buffer:[").concat(n.start," , ").concat(n.end,"], index=").concat(t)),n):void logger.log(this.TAG,"switch video buffer, in the same gop and no more frame got, time:".concat(e," , buffer:[").concat(n.start," , ").concat(n.end,"], index=").concat(t))}}},{key:"getSeekStartPosition",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(this._keyframeQueue.forEach((function(r){r.position<=e&&(t=r)})),t)return e-t.position<r?t:void 0}},{key:"nextFrame",value:function(){return this._currentFrameQueue[0]}},{key:"deletePassed",value:function(e){this._currentFrameQueue=this._currentFrameQueue.filter((function(t){return t.dts>=e}))}},{key:"getDtsOfTime",value:function(e){var t=e-this._lastDuration;return this._baseDts+1e3*t}},{key:"clean",value:function(){this._currentFrameQueue=[]}},{key:"destroy",value:function(){this._currentFrameQueue=[],this._buffers=[]}}]),e}();function _checkClose(e){var t;(null===(t=e.buffer)||void 0===t?void 0:t.close)&&e.buffer.close()}var FrameQueue=function(){function e(t){_classCallCheck$1(this,e),this.TAG="FrameQueue",this._parent=t,this._lastGopId=0,this._frames=[]}return _createClass$1(e,[{key:"currentTimeDts",get:function(){return this._parent.preciseVideoDts}},{key:"length",get:function(){return this._frames.length}},{key:"frames",get:function(){return this._frames}},{key:"append",value:function(e){e.info?this._frames.push(e):_checkClose(e)}},{key:"appendVodFrame",value:function(e){this._frames.push(e)}},{key:"nextFrame",value:function(){var e=this._frames.length;return 1===this._parent.noAudio&&e>3&&(this._frames=this._frames.slice(e-2)),this._frames[0]}},{key:"shift",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._frames.shift();return this.deletePassed(e),t}},{key:"deletePassed",value:function(e){this._frames=this._frames.filter((function(t){return!!(t.info&&t.info.dts>e)||(_checkClose(t),!1)}))}},{key:"empty",value:function(){this._frames.forEach((function(e){return _checkClose(e)})),this._frames=[]}},{key:"destroy",value:function(){this.empty(),this._lastGopId=0}}]),e}(),FrameRenderCache=function(){function e(){_classCallCheck$1(this,e),_defineProperty$1(this,"_queue",[]),_defineProperty$1(this,"TAG","FrameRenderCache")}return _createClass$1(e,[{key:"cacheCvs",value:function(e){this._queue.push(e),logger.log(this.TAG,"cache canvas!")}},{key:"getCachedCvs",value:function(){var e=this._queue.pop();return e&&logger.log(this.TAG,"get cached canvas!"),e}}]),e}(),frameRenderCache=new FrameRenderCache,FrameRender=function(){function t(e,r){_classCallCheck$1(this,t),this.TAG="FrameRender",this.configs=Object.assign({},e),this.parent=r,this.canvas=this.configs.canvas,this.canvas.glInstance=this,this.meta=Object.assign({},this.configs.meta),this.frameRenderCache=frameRenderCache,this._initMeta(),this._initContextGL(),this.contextGL&&(this._initProgram(),this._initBuffers(),this._initTextures())}return _createClass$1(t,[{key:"_initMeta",value:function(){this.chroma=this.meta.chromaFormat,this.height=this.meta.height,this.width=this.meta.width,this.canvas.width===this.meta.width&&this.canvas.height===this.meta.height||(this.canvas.width=this.meta.width,this.canvas.height=this.meta.height,this.parent.emitResizeEvent())}},{key:"_initContextGL",value:function(){if("2d"!==this.configs.type){for(var t=this.canvas,r=null,n=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=0;!r&&i<n.length;){var a=n[i];try{r=t.getContext(a,this.configs.glCtxOptions),logger.log("FrameRender","use=",a,this.configs.glCtxOptions);break}catch(e){r=null}r&&"function"==typeof r.getParameter||(r=null),++i}this.contextGL=r}else this.ctx=this.canvas.getContext("2d")}},{key:"_initProgram",value:function(){var e=this.contextGL,t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n"),n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(n));var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(i));var a=e.createProgram();e.attachShader(a,n),e.attachShader(a,i),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||console.log("Program failed to compile: "+e.getProgramInfoLog(a)),e.useProgram(a);var o=e.getUniformLocation(a,"YUV2RGB");e.uniformMatrix4fv(o,!1,[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1]),this.shaderProgram=a}},{key:"_initBuffers",value:function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var a=e.getAttribLocation(t,"texturePos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),this.texturePosBuffer=i;var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=o;var l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var u=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(u),e.vertexAttribPointer(u,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=l}},{key:"_initTextures",value:function(){var e=this.contextGL,t=this.shaderProgram,r=this._initTexture(),n=e.getUniformLocation(t,"ySampler");e.uniform1i(n,0),this.yTextureRef=r;var i=this._initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=i;var o=this._initTexture(),s=e.getUniformLocation(t,"vSampler");e.uniform1i(s,2),this.vTextureRef=o,e.pixelStorei(e.UNPACK_ALIGNMENT,1)}},{key:"_initTexture",value:function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},{key:"_drawPictureGL",value:function(e,t,r,n,i){var a=n*r,o=i*r/2;444!==this.chroma&&422!==this.chroma||(o*=2);var s={yData:(e=new Uint8Array(e)).subarray(0,a),uData:e.subarray(a,a+o),vData:e.subarray(a+o,a+o+o)};this._drawPictureGL420(s,t,r,n,i)}},{key:"_drawPictureGL420",value:function(e,t,r,n,i){var a=this.contextGL,o=this.texturePosBuffer,s=this.uTexturePosBuffer,l=this.vTexturePosBuffer,u=this.yTextureRef,c=this.uTextureRef,d=this.vTextureRef,h=e.yData,f=e.uData,p=e.vData,y=n,m=r,g=i,v=r/2;422!==this.chroma&&444!==this.chroma||(v=r);var b=i,_=v,E=this.canvas.width/this.width,T=this.canvas.height/this.height,S=0,$=0,A=this.canvas.width,w=this.canvas.height;E<T?(w=this.height*this.canvas.width/this.width,$=parseInt((this.canvas.height-this.height*this.canvas.width/this.width)/2)):(A=this.width*this.canvas.height/this.height,S=parseInt((this.canvas.width-this.width*this.canvas.height/this.height)/2)),a.viewport(S,$,A,w);var k=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,o),a.bufferData(a.ARRAY_BUFFER,k,a.DYNAMIC_DRAW);var I=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,s),a.bufferData(a.ARRAY_BUFFER,I,a.DYNAMIC_DRAW);var C=new Float32Array([1,0,0,0,1,1,0,1]);a.bindBuffer(a.ARRAY_BUFFER,l),a.bufferData(a.ARRAY_BUFFER,C,a.DYNAMIC_DRAW),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,u),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,y,m,0,a.LUMINANCE,a.UNSIGNED_BYTE,h),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,g,v,0,a.LUMINANCE,a.UNSIGNED_BYTE,f),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,d),a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE,b,_,0,a.LUMINANCE,a.UNSIGNED_BYTE,p),a.drawArrays(a.TRIANGLE_STRIP,0,4)}},{key:"_drawPicture2d",value:function(e){if(e&&this.canvas){this.ctx||(this.ctx=this.canvas.getContext("2d"));var t=e.displayWidth||e.width,r=e.displayHeight||e.height;this.canvas.height===r&&this.canvas.width===t||(this.canvas.height=r,this.canvas.width=t);try{this.ctx.drawImage(e.dom||e,0,0,t,r)}catch(error){console.error(this.TAG,"_drawPicture2d",e,e.dom,error,error.message)}}}},{key:"_resize",value:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.parent.emitResizeEvent())}},{key:"render",value:function(e,t,r,n,i){this._resize(t,r),this.contextGL?this._drawPictureGL(e,t,r,n,i):this._drawPicture2d(e)}},{key:"resetMeta",value:function(e){this.meta=Object.assign({},e)}},{key:"updateBind",value:function(e,t){this.parent=e,this.resetMeta(t)}},{key:"destroy",value:function(e){this.parent=null,this.canvas.style.display="none",e&&(this.contextGL&&this.contextGL.clear(this.contextGL.DEPTH_BUFFER_BIT|this.contextGL.COLOR_BUFFER_BIT),frameRenderCache.cacheCvs(this.canvas))}}]),t}(),MAX_QUEUE_LENGTH=5,DecodeEstimate=function(){function e(t){_classCallCheck$1(this,e),_defineProperty$1(this,"_lowDecodeThreshold",getDecodeCapacaity().lowDecodeThreshold/MAX_QUEUE_LENGTH),this.TAG="DecodeEstimate",this._needEstimate=!0,this._parent=t,this._lastDecodeDot=0,this._lastDecodeCost=0,this._lastFrameDts=0,this._dtsDeltas=[],this._decodeCosts=[],this._lowDecodeQueue=[],this._fps=0,this._decodeFps=0,this._gopLength=0,this._webcodec=!1}return _createClass$1(e,[{key:"fps",get:function(){return this._fps}},{key:"decodeFps",get:function(){return this._decodeFps}},{key:"decodeCost",get:function(){return this._lastDecodeCost}},{key:"gopLength",get:function(){return this._gopLength}},{key:"webcodec",set:function(e){this._webcodec=e}},{key:"updateGopCount",value:function(){this._gopLength++}},{key:"needEstimateFps",value:function(){this._needEstimate=!0}},{key:"addDecodeInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dts:0};this._estimateDecodeFps(e),this._estimateFps(e)}},{key:"resetDecodeDot",value:function(e){this._lastDecodeDot=e||0}},{key:"reset",value:function(){this._decodeCosts=[],this._lowDecodeQueue=[]}},{key:"_estimateFps",value:function(e){if(this._needEstimate)if(this._lastFrameDts){var t=e.dts-this._lastFrameDts;if(this._lastFrameDts=e.dts,!(Math.abs(t)>200)){this._dtsDeltas.push(t);var r=this._dtsDeltas.length;r<MAX_QUEUE_LENGTH||(this._fps=Math.ceil(1e3/this._avg(this._dtsDeltas,r)),logger.log(this.TAG,"estimate fps:",this._fps),this._needEstimate=!1)}}else this._lastFrameDts=e.dts}},{key:"_estimateDecodeFps",value:function(e){if(this._lastDecodeDot){var t=performance.now(),r=t-this._lastDecodeDot;this._lastDecodeDot=t,e.cost=r,this._lastDecodeCost=r,this._decodeCosts.push(r);var n=this._decodeCosts.length;if(!(n<MAX_QUEUE_LENGTH)){var i=this._avg(this._decodeCosts,n);this._decodeFps=Math.floor(1e3/i),this._decodeCosts=[],this._lowDecodeDetect()}}else this._lastDecodeDot=performance.now()}},{key:"_avg",value:function(e,t){var r=e.reduce((function(e,t){return e+=t}),0);return Math.floor(r/t)||1}},{key:"_lowDecodeDetect",value:function(){this._decodeFps?(this._decodeFps<this._fps*this._parent.playbackRate+(this.webcodec?0:3)?this._lowDecodeQueue.push(this._decodeFps):this._lowDecodeQueue.pop(),this._lowDecodeQueue.length>this._lowDecodeThreshold&&(this._lowDecodeQueue=[],logger.log(this.TAG,","),this._parent.emit(Events.VIDEO.DECODE_LOW_FPS))):this._parent.emit(Events.VIDEO.DECODE_LOW_FPS)}}]),e}(),shell="\n    var timer;\n\n    function initTimer (interval) {\n      destroy()\n      clearInterval(timer);\n      timer = setInterval(() => {\n          self.postMessage({type: 'NEXT_TICK'});\n      }, interval)\n    }\n\n    function destroy () {\n      clearInterval(timer);\n    }\n\n    self.onmessage = function (e) {\n      var {type,interval} = e.data;\n      switch (type) {\n          case 'START':\n            initTimer(interval);\n            break;\n          case 'DESTROY':\n            destroy();\n            break;\n      }\n    }\n",timerWorkerCache=[],TickTimer=function(){function e(t){var r=this;_classCallCheck$1(this,e),_defineProperty$1(this,"_doTask",(function(){var e;null===(e=r._task)||void 0===e||e.call(r)})),this._task=t;var n=new Blob([shell],{type:"application/javascript"});this._worker=timerWorkerCache.pop()||new Worker(URL.createObjectURL(n)),this._bindEvent()}return _createClass$1(e,[{key:"_bindEvent",value:function(){this._worker.addEventListener("message",this._doTask)}},{key:"start",value:function(e){(e=parseInt(e))<10&&(e=10),e>60?e=60:e>25&&(e=25),this._worker.postMessage({type:"START",interval:e})}},{key:"stop",value:function(){this._worker.postMessage({type:"DESTROY"})}},{key:"destroy",value:function(){this._worker&&(this._worker.postMessage({type:"DESTROY"}),this._worker.removeEventListener("message",this._doTask),timerWorkerCache.push(this._worker),logger.log("TickTimer","unbind timer event"),this._worker=null,this._task=null)}}]),e}(),HAVE_NOTHING=0,HAVE_METADATA=1,HAVE_CURRENT_DATA=2,HAVE_FUTURE_DATA=3,HAVE_ENOUGH_DATA=4,MEDIA_ERR_DECODE=3,VideoBaseRender=function(e){_inherits(r,e);var t=_createSuper(r);function r(e,n){var i;return _classCallCheck$1(this,r),(i=t.call(this,e,n))._timeRange=new VideoTimeRange(_assertThisInitialized(i)),i._decodeEstimate=new DecodeEstimate(_assertThisInitialized(i)),i._frameQueue=new FrameQueue(_assertThisInitialized(i)),i._lastTimeupdate=0,i._renderCost=0,i._canAutoPlay=!0,i._videoDecode=!1,i._inSeeking=!1,i._frameRender=null,i._configuration=null,i._render=i._render.bind(_assertThisInitialized(i)),i._tickTimer=new TickTimer(i._render),i._initCanvas(e),i._bindEvents(),i}return _createClass$1(r,[{key:"canAutoPlay",get:function(){return this._canAutoPlay}},{key:"canvas",get:function(){return this._canvas}},{key:"timescale",get:function(){return 1e3}},{key:"fps",get:function(){return this._decodeEstimate.fps||this._meta&&this._meta.fpsNum/this._meta.fpsDen||24}},{key:"decodeFps",get:function(){return this._decodeEstimate.decodeFps}},{key:"decodeCost",get:function(){return this._decodeEstimate.decodeCost}},{key:"renderCost",get:function(){return this._renderCost}},{key:"totalSize",get:function(){return this._timeRange.totalSize}},{key:"bitrate",get:function(){return this._timeRange.bitrate},set:function(e){this._timeRange.bitrate=e}},{key:"gopLength",get:function(){return this._decodeEstimate.gopLength}},{key:"is540p",get:function(){return this._canvas.height<720}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"inSeeking",get:function(){return this._inSeeking}},{key:"interval",get:function(){return Math.floor(1e3/this.fps/this.playbackRate)}},{key:"playbackRate",get:function(){return this._playbackRate||1}},{key:"baseDts",get:function(){return this._timeRange.baseDts}},{key:"currentTime",get:function(){return this._timeRange.getCurrentTime(this.preciseVideoDts)}},{key:"timelinePosition",get:function(){return this._parent.timelinePosition}},{key:"lastTimelinePosition",get:function(){return this._lastTimelinePosition||0},set:function(e){this._lastTimelinePosition=e}},{key:"audioSyncDts",get:function(){return this._audioDts||this.baseDts},set:function(e){this._audioDts=e}},{key:"preciseVideoDts",get:function(){return this.audioSyncDts+Math.floor(1e3*(this.timelinePosition-this.lastTimelinePosition))}},{key:"readyState",get:function(){var e=this._frameQueue.length||(this.currentTime?1:0);return e?e>=8?HAVE_ENOUGH_DATA:e>=4?HAVE_FUTURE_DATA:e>=2?HAVE_CURRENT_DATA:HAVE_METADATA:HAVE_NOTHING}},{key:"isHevc",get:function(){return!("hev1.1.6.L93.B0"!==(this._meta||{}).codec)}},{key:"videoDecode",get:function(){return this._videoDecode}},{key:"decoderMode",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.decoderMode}},{key:"configuration",get:function(){var e,t;return this._configuration||(this._configuration=this._meta.configuration||getAvcc(null===(e=this._meta)||void 0===e?void 0:e.sps[0],null===(t=this._meta)||void 0===t?void 0:t.pps[0])),this._configuration},set:function(e){this._configuration=e.configuration||getAvcc(e.sps[0],e.pps[0])}},{key:"setSeekingStatus",value:function(e){this._inSeeking=e}},{key:"getDtsOfTime",value:function(e){return this._timeRange.getDtsOfTime(e)}},{key:"updateReady",value:function(){this._whenReady()}},{key:"forceRender",value:function(){this._render(!0)}},{key:"getSeekStartPosition",value:function(e,t){return this._timeRange.getSeekStartPosition(e,t)}},{key:"canSeek",value:function(){throw new Error("need override by children")}},{key:"emitResizeEvent",value:function(){null==this||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.RESIZE)}},{key:"_assembleErr",value:function(e,t){var r=new Error(e);return r.code=MEDIA_ERR_DECODE,r.subCode=t,r}},{key:"_emitTimelineEvents",value:function(e,t,r){var n;null===(n=this._parent)||void 0===n||n.emit(e,t,r)}},{key:"_initCanvas",value:function(e){e.canvas?this._canvas=e.canvas:this._canvas=frameRenderCache.getCachedCvs()||document.createElement("canvas"),this._canvas.style.margin="auto",this._canvas.style.position="absolute",this._canvas.style.pointerEvents="none"}},{key:"_bindEvents",value:function(){var e=this;_get(_getPrototypeOf(r.prototype),"_bindEvents",this).call(this);var t=function(t){var r=t.width,n=t.height,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e._canvas,s=o.width,l=o.height,u=n*s/l,c=r*l/s,d=r-u,h=n-c,f=d*i+"px",p=h*a+"px";e._canvas.style.left=f,e._canvas.style.top=p,logger.warn(e.TAG,"cvsWidth=".concat(s,", cvsHeight=").concat(l,", scaleCvsWidth=").concat(u,", scaleCvsHeight=").concat(c)),logger.warn(e.TAG,"cover position: deltaX=".concat(d,", deltaY=").concat(h,", width=").concat(r,", height=").concat(n,", pX=").concat(f,", pY=").concat(p))};this._parent.on(Events.VIDEO.UPDATE_VIDEO_FILLTYPE,(function(r,n){var i=n.width,a=n.height,o=e._canvas,s=o.width,l=o.height,u=!i||i/a>s/l;if(logger.warn(e.TAG,"UPDATE_VIDEO_FILLTYPE isGapX =",u,"type =",r,s,l,i,a),e._canvas.style.maxWidth="initial",e._canvas.style.maxHeight="initial","cover"===r)return u?(e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.height="auto",e._canvas.style.width="100%",void t({width:i,height:a},0,.5)):(e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.width="auto",e._canvas.style.height="100%",void t({width:i,height:a},.5,0));if("fill"===r)return e._canvas.style.width="100%",void(e._canvas.style.height="100%");(e._canvas.style.top=0,e._canvas.style.bottom=0,e._canvas.style.left=0,e._canvas.style.right=0,e._canvas.style.maxWidth="100%",e._canvas.style.maxHeight="100%",e._canvas.style.width="initial",e._canvas.style.height="initial",s<i&&l<a)&&(s/i>l/a?e._canvas.style.width="100%":e._canvas.style.height="100%")})),this._parent.on(Events.VIDEO.UPDATE_VIDEO_COVER_POSITION,t),this._parent.on(Events.TIMELINE.SYNC_DTS,(function(t){var r,n=e._frameQueue.nextFrame(),i=n&&n.info&&n.info.dts;if(e.lastTimelinePosition=e.timelinePosition,e.noAudio){var a=e._timeRange.nextFrame();t=t||i||a&&a.dts||0}if(e.audioSyncDts=t,i&&i-t>500&&e._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.LARGE_AV_GAP,{aDts:t,vDts:i,frameLength:e._frameQueue.length,currentTime:e._parent.currentTime,duration:e._parent.duration}),logger.log(e.TAG,"audio current buffer play finish, next buffer dts=",t,"currentTime:",e._parent.currentTime,"preciseVideoDts:",e.preciseVideoDts,"next video frame dts:",i,"frame length:",e._frameQueue.length),!(e._isLive||null!==(r=e._parent)&&void 0!==r&&r.seeking)){var o=e._timeRange.nextFrame();if(o){var s=(o.dts-o.baseDts)/1e3;e._parent.currentTime-s>1&&(logger.warn(e.TAG,"!"),e.ajustSeekTime(e._parent.currentTime))}}})),this._parent.on(Events.TIMELINE.UPDATE_GL_OPTIONS,(function(t){e._config.glCtxOptions=t})),this._parent.on(Events.TIMELINE.UPDATE_SEGMENT_END,this._updateSegmentEnd.bind(this)),this.on(Events.VIDEO.AUTO_RUN,this._startRender.bind(this)),this._parent.on(Events.TIMELINE.SET_PLAYBACKRATE,(function(t){e._playbackRate=t,e._startRender()}))}},{key:"ajustSeekTime",value:function(){throw new Error("need override by children")}},{key:"_resetDts",value:function(e,t){"audio"!==t&&this._timeRange.resetDts(e)}},{key:"_setMetadata",value:function(e,t){if("audio"!==e){logger.warn(this.TAG,"video set metadata"),this._meta=t;var r=t&&t.frameRate&&t.frameRate.fps;r?logger.log(this.TAG,"detect fps:",r):logger.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder()}}},{key:"_initDecoder",value:function(){throw new Error("need override by children")}},{key:"_whenDecoderReady",value:function(){throw new Error("need override by children")}},{key:"_appendChunk",value:function(){throw new Error("need override by children")}},{key:"_startDecode",value:function(){throw new Error("need override by children")}},{key:"_receiveFrame",value:function(e,t){if(this._parent&&this._timeRange){var r=e.info||{};if(this._decodeEstimate.addDecodeInfo(r),!this._isLive&&((r.output||r.keyframe)&&(this.setSeekingStatus(!1),logger.warn(this.TAG,"set seeking status=",!1)),this.inSeeking))return logger.log(this.TAG,"drop frame"),void _checkClose(e);this._isLive?this._frameQueue.append(e):this._frameQueue.appendVodFrame(e),t&&t(),this._ready||this.readyState>=HAVE_METADATA&&this._whenReady()}}},{key:"_startRender",value:function(){logger.log(this.TAG,"start render"),this._tickTimer.start(this.interval)}},{key:"_render",value:function(){throw new Error("need override by children")}},{key:"_updateSegmentEnd",value:function(){throw new Error("need override by children")}},{key:"_whenReady",value:function(){this._ready=!0,this.emit(Events.VIDEO.VIDEO_READY),this.noAudio&&this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PLAYING)}},{key:"_doPlay",value:function(){this._tickTimer.start()}},{key:"_doPause",value:function(){this._tickTimer.stop()}},{key:"_doSeek",value:function(){this._ready=!1,this._frameQueue.destroy()}},{key:"_doChaseFrame",value:function(){throw new Error("need override by children")}},{key:"destroy",value:function(e){var t,r,n,i;null===(t=this._tickTimer)||void 0===t||t.destroy(),null===(r=this._timeRange)||void 0===r||r.destroy(),null===(n=this._frameQueue)||void 0===n||n.destroy(),null===(i=this._frameRender)||void 0===i||i.destroy(e),this._tickTimer=null,this._canvas=null,this._timeRange=null,this._frameQueue=null,this._frameRender=null,this._decodeEstimate=null,this._parent=null,this.removeAllListeners()}}]),r}(BaseRender),DEFAULT_PLAYBACKRATE=2,CANVAS_COUNT=45,FRAME_DURATION=25,MAX_VIDEO_HEIGHT=720,MAX_FPS=30,MIN_FPS=15,VideoDecoder=function(t){_inherits(n,t);var r=_createSuper(n);function n(e){var t;return _classCallCheck$1(this,n),(t=r.call(this)).TAG="VideoDecoder",t._video=t._createVideo(),t._IsInDecoding=!1,t._fps=0,t._framId=null,t._screenShotNum=0,t._allPicNum=0,t._currentBlob=null,t._basePTS=0,t._totleTime=0,t._isVideoONRun=!0,t.firstEmit=!1,t.ptsArray=[],t._currentCanvasHeight=0,t._canvasList=[],t._realFrameDuration=FRAME_DURATION,t._maxVideoHeight=e.maxVideoHeight||MAX_VIDEO_HEIGHT,t._minFPSTime=0,t._maxFPSTime=0,t._playFailed=!1,t._isPhoneSafari=!1,t._createCanvasList(),t._bindEvents(),t}return _createClass$1(n,[{key:"_createCanvasList",value:function(){this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d",{alpha:!1});for(var e=0;e<CANVAS_COUNT;e++){var t=this._createCanvas(),r=t.dom,n=t.ctx;this._canvasList.push({dom:r,ctx:n})}}},{key:"_createCanvas",value:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return{dom:e,ctx:t}}},{key:"_createVideo",value:function(){var e=document.createElement("video");return e.setAttribute("muted",!0),e.setAttribute("autoplay",!0),e.setAttribute("controls",!0),e.setAttribute("webkit-playsinline",!0),e.setAttribute("playsinline",!0),e.setAttribute("x5-video-player-type","h5"),e.setAttribute("x5-video-player-type","h5-page"),e.style.position="absolute",e}},{key:"_initVideo",value:function(t,r){if(t.blobUrl&&void 0!==t.dts){var n=t.blobUrl;this._currentBlob=n,this._basePTS=t.dts,this._currentDuration=t.duration;try{logger.log(this.TAG,"_initVideo, basePTS:",t.dts),this._setVideoSrc(n,r),this._video.paused&&this._videoPlay("_initVideo")}catch(e){console.error(this.TAG,"_initVideo, load error",e)}}else console.error(this.TAG,"_initVideo","input info is error, blobUrl:",t.blobUrl,"dts:",t.dts)}},{key:"_setVideoSrc",value:function(t,r){try{var n=this._video;n.src=t,n.load(),n.playbackRate=DEFAULT_PLAYBACKRATE}catch(e){console.error(this.TAG,"_setVideoSrc",e)}}},{key:"_videoPlay",value:function(e){var t=this,r=this._video;if(logger.log(this.TAG,"_videoPlay, video is pause:",r.paused,e),r&&r.paused){var n=r.play();void 0!==n&&n.then((function(){t._playFailed=!1,logger.log(t.TAG,"_videoPlay success")})).catch((function(e){console.error(t.TAG,"_videoPlay failed,",e.message),t._playFailed=!0,t.emit(Events.DECODE_EVENTS.PLAY_FAILED,t.firstEmit)}))}}},{key:"_removeEvents",value:function(){var e=this._video;e.removeEventListener("playing",this._onPlaying.bind(this)),e.removeEventListener("ended",this._onEnded.bind(this)),e.removeEventListener("error",this._onError.bind(this)),e.removeEventListener("loadeddata",this._onLoadeddata.bind(this)),e.removeEventListener("timeupdate",this._onTimeUpdate.bind(this))}},{key:"_bindEvents",value:function(){var e=this,t=this._video;t?(document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),t.addEventListener("playing",this._onPlaying.bind(this)),t.addEventListener("ended",this._onEnded.bind(this)),t.addEventListener("error",this._onError.bind(this)),t.addEventListener("loadeddata",this._onLoadeddata.bind(this)),t.addEventListener("timeupdate",this._onTimeUpdate.bind(this)),t.addEventListener("pause",(function(){logger.log("on pause, currentTime, duration:",e._vCurrentTime,e._vDuration)})),this.on("outputresolutionchange",this._onChange.bind(this)),this.on("fpsreduce",(function(t){e._adaptFrameDuration(t)}))):console.error(this.TAG,"_bindEvents")}},{key:"_onTimeUpdate",value:function(){this._lastCurrentTime=this._vCurrentTime}},{key:"_onVisibilityChange",value:function(){this._isVideoONRun="visible"===document.visibilityState}},{key:"_onChange",value:function(e,t){this._width=e,this._height=t}},{key:"_onPlaying",value:function(){this._IsInDecoding&&(console.warn(this.TAG,"_onPlaying","last video not correct end"),this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null)),logger.log(this.TAG,"_onPlaying, video duration:",this._vDuration,"currentTime:",this._vCurrentTime,"_lastPts:",this._lastPts),this._isInDecoding=!0,this._lastCurrentTime=this._vCurrentTime,this.ptsArray=[],this.playingTime||(this.playingTime=!0),this._getFrame()}},{key:"_onEnded",value:function(e,t){logger.log(this.TAG,"_onEnded","current fmp4 duration is:",this._vDuration,"_isInDecoding:",this._isInDecoding,"_lastPts:",this._lastPts,"_realFrameDuration:",this._realFrameDuration,"from:",t),this._isInDecoding&&(this._isInDecoding=!1,this._lastMp4Duration=Math.min(this._vDuration,this._vCurrentTime),this._framId&&(logger.log(this.TAG,"_onEnded","cancelAnimationFrame"),window.cancelAnimationFrame(this._framId),this._framId=null),this._decodeFPS=parseInt(this._screenShotNum/(this._vDuration/1e3)),this.emit("fps",this._screenShotNum,this._totleTime,this._vDuration,this._metaFPS,{height:this._currentCanvasHeight,relHeight:this._video.videoHeight}),logger.log("_timePerFrame",this._totleTime/this._screenShotNum),this._timePerFrame=this._totleTime/this._screenShotNum,this._screenShotNum=0,this._allPicNum=0,this._totleTime=0,this._currentBlob&&(URL.revokeObjectURL(this._currentBlob),this._currentBlob=null,this._basePTS=0),this.emit(Events.DECODE_EVENTS.FRAGMENT_END,this._decodeFPS,this._video.duration))}},{key:"_onError",value:function(){this._isInDecoding=!1;var e=this._video;console.error("video error:",e.error.code,e.error.message),this.emit("error",e.error,this.firstEmit)}},{key:"_onLoadeddata",value:function(){var e=this,t=this._video;t.currentTime=.001,this.firstEmit||(this._playFailed?(t.style.visibility="hidden",this.emit(Events.DECODE_EVENTS.APPEND_VIDEO,t),setTimeout((function(){logger.log(e.TAG,"onloadeddata, setTimeout firstEmit:",e.firstEmit),e._getFirstFrame()}),40)):(logger.log(this.TAG,"onloadeddata, firstEmit:",this.firstEmit),this._getFirstFrame()))}},{key:"_getFirstFrame",value:function(){this.firstTime=Date.now();var e=this._vCurrentTime,t=this._basePTS+e,r=this._getImageData(t).imageData;this.firstEmit=!0,this.emit(Events.DECODE_EVENTS.FIRST_FRAME,r,t)}},{key:"_getFrame",value:function(){var t=this._video,r=t.videoWidth,n=t.videoHeight;if(this._allPicNum++,this._isInDecoding){if(r||n){var i=this._vCurrentTime,a=this._basePTS+i;if(this.ptsArray.push(a),this._lastCurrentTime&&this._lastCurrentTime===this._vDuration&&(logger.log(this.TAG,"_getFrame, video ended, lastCurrentTime",this._lastCurrentTime,"duration:",this._vDuration,"isInDecoding:",this._isInDecoding),this._onEnded(null,"getFrame")),this._lastPts&&a<=this._lastPts)return void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)));if(this._lastPts&&a-this._lastPts<this._realFrameDuration)return void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)));this._screenShotNum++;var o,s=null,l=Date.now();try{s=(o=this._getImageData(a)).imageData}catch(e){console.error(e,o,this._canvasList.length)}this._lastPts=a;var u=Date.now()-l;return this._totleTime+=u,this.emit(Events.DECODE_EVENTS.DECODED,s,a),void(this._framId=window.requestAnimationFrame(this._getFrame.bind(this)))}this._framId=window.requestAnimationFrame(this._getFrame.bind(this))}else this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null)}},{key:"_getImageData",value:function(){var t,r=this._video,n=r.videoWidth,i=r.videoHeight,a=n,o=i;this._width&&this._height&&(a=this._width,o=this._height),o>this._maxVideoHeight&&(o=this._maxVideoHeight,a=parseInt(o*(n/i))),(t=this._canvasList.shift())||(console.warn(this.TAG,"_getImageData, _canvansList length is 0"),t=this._createCanvas()),t.width=a,t.height=o;var s=t.dom,l=t.ctx;if(this._currentCanvasHeight=o,!s)return{imageData:t};s.width!==a&&(s.width=a,s.height=o);try{i&&n&&a&&o&&l.drawImage(r,0,0,n,i,0,0,a,o)}catch(e){console.error(this.TAG,"_getImageData, drawImage:",e)}return{imageData:t}}},{key:"_adaptFrameDuration",value:function(e){e<MIN_FPS?this._minFPSTime++:this._minFPSTime=0,e>MAX_FPS?this._maxFPSTime++:this._maxFPSTime=0,this._minFPSTime>0&&this._decodeFPS<MIN_FPS&&(this._realFrameDuration-=this._timePerFrame,this._realFrameDuration<15&&(this._realFrameDuration=15),this._minFPSTime=0),this._maxFPSTime>0&&this._decodeFPS>MAX_FPS&&(this._realFrameDuration+=this._timePerFrame,this._maxFPSTime=0)}},{key:"_vDuration",get:function(){return parseInt(1e3*this._video.duration)}},{key:"_vCurrentTime",get:function(){return parseInt(1e3*this._video.currentTime)}},{key:"_reset",value:function(){this._isInDecoding=!1,this._lastPts=0,this._screenShotNum=0,this._allPicNum=0,this._totleTime=0}},{key:"reStartDecode",value:function(){this._video.pause(),this._reset();var e=this._currentBlob,t=this._basePTS;this._framId&&(window.cancelAnimationFrame(this._framId),this._framId=null),this._initVideo({blobUrl:e,dts:t})}},{key:"doSeek",value:function(e){if(this._isInDecoding){if(e<=0)return;var t=this._vCurrentTime/1e3+e>=this._vDuration/1e3?this._vDuration/1e3:this._vCurrentTime/1e3+1;console.error("doSeek",t),this._video.currentTime=t}}},{key:"pause",value:function(){this._isInDecoding&&this._video.pause()}},{key:"play",value:function(){if(this._isInDecoding&&this._video.paused)return logger.log("video play",this._vCurrentTime),this._video.play()}},{key:"startDecode",value:function(e,t,r){this._initVideo(e,r),this._metaFPS=t}},{key:"stopDecode",value:function(){this._video.paused||(this._video.pause(),this._reset())}},{key:"canPlayType",value:function(e){return this._video.canPlayType(e)}},{key:"destroy",value:function(){this._isInDecoding=!1,window.cancelAnimationFrame(this._framId),this._video.pause(),this._removeEvents()}},{key:"videoWidth",get:function(){return this._video?this._video.videoWidth:0}},{key:"videoHeight",get:function(){return this._video?this._video.videoHeight:0}}]),n}(EventEmitter$1),MAX_FRAMESIZE=40,MIN_FRAMESIZE=25,DEFAULT_FPS=20,LEVELS=[{base:720,level:1},{base:540,level:2},{base:360,level:3},{base:280,level:4}],VideoDecoderController=function(t){_inherits(n,t);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck$1(this,n),(i=r.call(this)).TAG="VideoDecoderController",i._decoder=new VideoDecoder(e),i._remux=new MP4Remuxer,i._bindEvents(),i._isInit=!1,i._isDataReady=!1,i._ready=!1,i._blobURLList=[],i._isInDecoding=!1,i._mediaSegmentReady=!1,i._parent=t,i._isDecodePause=!1,i._playSuccess=!0,i._isVideoOnRun=!0,i._startDts=0,i._fDuration=0,i._minFPSTime=0,i._lastPts=0,i._frameLengthPerFragment=0,i._gopBufferLength=0,i._maxGopDuration=0,i._minGopDuration=0,i._currentLevel=-1,i._endLevel=e.endLevel||2,i.currentFragmentDuration=0,i._handleKeyFrameVideo=i._handleKeyFrameVideo.bind(_assertThisInitialized(i)),i}return _createClass$1(n,[{key:"_bindEvents",value:function(){var e=this;document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._decoder.on(Events.DECODE_EVENTS.APPEND_VIDEO,this._onAppendVideo.bind(this)),this._decoder.on(Events.DECODE_EVENTS.PLAY_FAILED,this._onPlayFailed.bind(this)),this._decoder.on("error",this._onError.bind(this)),this._decoder.on(Events.DECODE_EVENTS.DECODED,this._onDecoded.bind(this)),this._decoder.on(Events.DECODE_EVENTS.FIRST_FRAME,this._onFirstFrame.bind(this)),this._decoder.on(Events.DECODE_EVENTS.FRAGMENT_END,this._onFragmentEnd.bind(this)),this._decoder.on("fps",(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=[e._metaFPS].concat(r,[e._frameLengthPerFragment]);e.emit.apply(e,["fps"].concat(_toConsumableArray$1(i)))})),this.on("keyFrame",this._handleKeyFrameVideo)}},{key:"_onRemuxed",value:function(e){var t={blobUrl:this._createBlobURL(e),dts:this.currentFragmentDts,duration:this.currentFragmentDuration,frameDuration:Math.floor(1e3/this._metaFPS)};this._recordGopDuration(this.currentFragmentDuration),this._pushBlob(t),logger.log(this.TAG,"_onRemuxed","maxgopduration:",this._maxGopDuration,"_gopBufferLength:",this._gopBufferLength),!this._isDataReady&&this._gopBufferLength>=this._maxGopDuration&&this._checkDataReady()}},{key:"_onPlayFailed",value:function(e){this._isInDecoding=!1,this._parent.emit(Events.DECODE_EVENTS.PLAY_FAILED,e)}},{key:"_onAppendVideo",value:function(e){this._parent.emit(Events.DECODE_EVENTS.APPEND_VIDEO,e)}},{key:"_onVisibilityChange",value:function(){this._isVideoOnRun="visible"===document.visibilityState}},{key:"_onDecoded",value:function(e,t){this._frameLengthPerFragment++;var r=this._buildFrameInfo(e,t);this._parent.emit(Events.DECODE_EVENTS.DECODED,r),this._lastPts=t}},{key:"_onFirstFrame",value:function(e,t){var r=this._buildFrameInfo(e,t);this._parent.emit(Events.DECODE_EVENTS.FIRST_FRAME,r)}},{key:"_onFragmentEnd",value:function(e,t){var r=this;logger.log(this.TAG,"_onFragmentEnd ,_isDecodePause:",this._isDecodePause,"decodeFPS:",e),e&&this._reduceResolution(e),this._isInDecoding=!1,this._inDecodeId=-1,this._currentInfo=null,this._frameLengthPerFragment=0,this._getBlobLength()&&!this._isDecodePause?this.startDecode():this.loadNextHandle=setInterval((function(){r._getBlobLength()&&!r._isDecodePause&&r._isVideoOnRun&&!r._isInDecoding&&(logger.log(r.TAG,"_onFragmentEnd, setInterval start next mp4 decode"),r.startDecode(),clearInterval(r.loadNextHandle))}))}},{key:"_onError",value:function(e,t){this._isInDecoding=!1,this._parent.emit("error",e,t)}},{key:"_checkReady",value:function(){this._isDataReady&&this._isInit&&(this.ready=!0,logger.log(this.TAG,"checkReady trigger ready"),this._parent.emit(Events.DECODE_EVENTS.READY))}},{key:"_checkDataReady",value:function(){this._isDataReady=!0,this._checkReady()}},{key:"_reduceResolution",value:function(e){if(logger.log(this.TAG,"_reduceResolution","currentLevel:",this._currentLevel,"endLevel:",this._endLevel),this._videoHeight>720&&(logger.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS"),this._parent.emit(Events.VIDEO.DECODE_LOW_FPS)),e&&e<DEFAULT_FPS?(this._minFPSTime++,this._decoder.emit("fpsreduce",e)):this._minFPSTime=0,this._currentLevel>=this._endLevel)return logger.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS",this._currentLevel,this._endLevel),void this._parent.emit(Events.VIDEO.DECODE_LOW_FPS);if(this._minFPSTime>2){var t,r=this._videoWidth,n=this._videoHeight;if(t=this._findLevel(n,this._currentLevel)){if(this._currentLevel=t.level,4===this._currentLevel)return logger.log(this.TAG,"_reduceResolution","trigger DECODE_LOW_FPS, _currentLevel: ",this._currentLevel),void this._parent.emit(Events.VIDEO.DECODE_LOW_FPS);this.width=t.base*(r/n),this.height=t.base,this._decoder.emit("outputresolutionchange",this.width,this.height)}this._minFPSTime=0}}},{key:"_findLevel",value:function(e,t){return LEVELS.find((function(r){return r.base<e&&r.level>t}))}},{key:"_buildFrameInfo",value:function(t,r){try{var n=t.width,i=t.height;return{msg:"DECODED",width:n,height:i,buffer:t,yLinesize:n,uvLinesize:n/2,info:{baseDts:void 0,dts:r,gopId:0,isGop:void 0,key:!1,pts:r},type:"rgb"}}catch(e){logger.log(this.TAG,e)}}},{key:"_pushBlob",value:function(e){logger.log("push blob",e.dts,e.duration),e&&e.duration&&(this._gopBufferLength+=e.duration),this._blobURLList.push(e)}},{key:"_shiftBlob",value:function(){var e=this._blobURLList.shift();return e&&e.duration&&(this._gopBufferLength-=e.duration),e}},{key:"_filterBlob",value:function(e){var t=this;this._blobURLList=this._blobURLList.filter((function(r){return r.dts<e&&(URL.revokeObjectURL(r.blobUrl),r.duration&&(t._gopBufferLength-=r.duration)),r.dts>=e}))}},{key:"_emptyBlobList",value:function(){this._blobURLList=[],this._gopBufferLength=0}},{key:"_getBlobLength",value:function(){return this._blobURLList.length}},{key:"_handleKeyFrameVideo",value:function(t){try{var r=this._parent._timeRange.frames||[];if(this._parent._timeRange.clean(),!r.length)return;var n=r[0].dts,i=r[r.length-1].dts,a=n-this.endDts;logger.log(this.TAG,"_handleKeyFrameVideo","startDts:",n,"endDts:",i,"samples length:",r.length),this.endDts&&a>Math.floor(1e3/this._metaFPS)+1&&logger.log(this.TAG,"_handleKeyFrame, keyFrame dts:",n,"sample length:",r.length,"endDts:",i,"delay:",a);var o=i-n;if(this._fDuration||(this._fDuration=o),o<1500)return void logger.log(this.TAG,"_handleKeyFrame gopDuration :",o,"sample length:",r.length,"gopStartDts:",n,"gopEndDts:",i);if(this.firstDts||(this.firstDts=r[0].dts),this.currentFragmentDts=r[0].dts,this.currentFragmentDuration=this._getFragmentDuration(r),this.endDts=i,this.currentFragmentDts<this._startDts)return console.warn(this.TAG,"_handleKeyFrameVideo","currentFragmentDts < this._startDts",this.currentFragmentDts,this._startDts),void(r=[]);this.startRemux(r),r=[]}catch(e){console.error(this.TAG,"_handleKeyFrameVideo",e)}}},{key:"_getFragmentDuration",value:function(e){var t=0,r=0;return e[0].keyframe||console.error(this.TAG,"_getFragmentDuration","gop firstFrame is not keyframe"),e.forEach((function(n,i){n.keyframe&&i&&(t+=e[i-1].dts-e[r].dts,r=i)})),t+=e[e.length-1].dts-e[r].dts}},{key:"_createBlobURL",value:function(e){if(e){var t=new window.Blob([e.buffer],{type:"video/mp4"});return window.URL.createObjectURL(t)}}},{key:"_recordGopDuration",value:function(e){var t=e;this._minGopDuration||(this._minGopDuration=t),t>this._maxGopDuration&&(this._maxGopDuration=t),t<this._minGopDuration&&(this._minGopDuration=t)}},{key:"checkMaxFrames",value:function(e){"number"==typeof e&&(this._isDecodePause=e>MAX_FRAMESIZE,this._playSuccess&&this._isDecodePause&&this._decoder.pause())}},{key:"checkMinFrames",value:function(e){var t=this;if("number"==typeof e&&(this._isDecodePause=!(e<MIN_FRAMESIZE),!this._isDecodePause)){var r=this._decoder.play();void 0!==r?r.then((function(){t._playSuccess=!0})).catch((function(){t._playSuccess=!1})):setTimeout((function(){t._playSuccess=!0}),20)}}},{key:"frameRendend",value:function(e){if(e.dom){if(e.dom.width=0,e.dom.height=0,this._decoder._canvasList.length>MAX_FRAMESIZE)return;this._decoder._canvasList.push(e)}else logger.error(this.TAG,"_onRendend","imageObj. is error",e)}},{key:"checkValidBlob",value:function(e){this._filterBlob(e)}},{key:"chaseVideoFrame",value:function(e){logger.log(this.TAG,e,e.frame.dts,this.currentFragmentDts);var t=e.frame.dts;if(this._startDts=t,t===this.currentFragmentDts){if(logger.log(this.TAG,"_onChaseFrame","_inDecodeId:",this._inDecodeId,"currentFragmentDts:",this.currentFragmentDts),this._inDecodeId>0&&this._inDecodeId<t)return logger.log(this.TAG,"_onChaseFrame, _inDecodeId > 0 && _inDecodeId < startDts, _inDecodeId:",this._inDecodeId,"startDts:",t),this.stopDecode(),this._filterBlob(t),void this.startDecode();if(this._inDecodeId===t)return logger.log(this.TAG,"_onChaseFrame, _inDecodeId === startDts, startDts:",t),this.stopDecode(),void this.reStrartDecode(this._currentInfo);-1===this._inDecodeId&&(logger.log(this.TAG,"_onChaseFrame","_inDecodeId==-1"),this.startDecode())}t>this.currentFragmentDts&&(logger.log(this.TAG,"_onChaseFrame, startDts > currentFragmentDts, startDts:",t,"currentFragmentDts:",this.currentFragmentDts),this.stopDecode(),this._emptyBlobList()),t<this.currentFragmentDts&&(logger.log(this.TAG,"_onChaseFrame, startDts < currentFragmentDts, startDts:",t,"currentFragmentDts:",this.currentFragmentDts),t>this._inDecodeId&&(this._filterBlob(t),this.stopDecode(),this.startDecode()))}},{key:"init",value:function(e){this._isInit||(this._metaFPS=e.fpsNum/e.fpsDen||25,this._videoWidth=e.width,this._videoHeight=e.height,this._width=this._videoWidth,this._height=this._videoHeight,this._frameDuration=parseInt(1e3/this._metaFPS),this._isInit=!0,logger.log("".concat(this.TAG," has inited")),this._isInit=!0,this._checkReady())}},{key:"reStrartDecode",value:function(t){if(t)try{logger.log(this.TAG,"reStrartDecode"),this._isInDecoding=!0,this._inDecodeId=t.dts,this._currentInfo=t,this._decoder.startDecode(t,this._metaFPS,this._startTime),this._startTime=0}catch(e){console.error("load error",e)}}},{key:"stopDecode",value:function(){this._isInDecoding=!1,this._inDecodeId=-1,this._currentInfo=null,this._frameLengthPerFragment=0,this._decoder.stopDecode()}},{key:"startDecode",value:function(){if(this._isInDecoding)logger.log(this.TAG,"startDecode","this decoder is in decoding");else{var t=this._getBlobLength();if(this._decoder&&t){logger.log(this.TAG,"startDecode","blob url length:",t);var r=this._shiftBlob()||{};try{logger.log(this.TAG,"startDecode",r.dts,r.duration),this._isInDecoding=!0,this._inDecodeId=r.dts,this._currentInfo=r,this._decoder.startDecode(r,this._metaFPS)}catch(e){console.error(this.TAG,"startDecode","load error",e)}}}}},{key:"canSeek",value:function(e){var t=e.frame.dts;return!!(this.currentFragmentDts>=t&&this._isInDecoding)&&(this._inDecodeId!==t&&this._inDecodeId<t)}},{key:"startRemux",value:function(e){if(logger.log("startRemux samples length:",e.length),e.length){var t=this._parent._meta;t.samples=e;var r=this._remux.remux(t).videoSegment;this._onRemuxed(r)}else console.error("frame length is 0")}},{key:"canPlayType",value:function(t){if(this._decoder)try{return this._decoder.canPlayType('video/mp4;codecs="'+t.codec+'"')}catch(e){console.error(e)}}},{key:"destroy",value:function(){this._blobURLList=[],this._decoder.destroy()}},{key:"empty",value:function(){if(logger.log("empty"),this._decoder){var e=this._decoder._canvasList;return logger.log(this.TAG,"empty >>>>>>>>>>>>>>>>>>length:",e.length),e.forEach((function(e){e.dom&&(logger.log("clear >>>>>>>>>>>>>>>>>>"),e.dom.width=0,e.dom.height=0,e.dom=null)})),e.length}}},{key:"isIDLE",get:function(){return logger.log(this.TAG,"isIDEL","blob length:",this._getBlobLength(),"_isInDecoding:",this._isInDecoding,"isVideoOnRun:",this._isVideoOnRun,"_isDecodePause",this._isDecodePause),!this._getBlobLength()&&!this._isInDecoding&&this._isVideoOnRun}},{key:"ready",get:function(){return this._ready},set:function(e){this._ready=e}},{key:"remux",get:function(){return this._remux}},{key:"isInit",get:function(){return this._isInit}}]),n}(EventEmitter$1),VideoRenderFromVideo=function(t){_inherits(n,t);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck$1(this,n),(i=r.call(this,e,t)).TAG="VideoRenderFromVideo",i._videoDecodeController=new VideoDecoderController(e,_assertThisInitialized(i)),i._canAutoPlay=!0,i._videoDecode=e.videoDecode,i._chaseToFrame=null,i}return _createClass$1(n,[{key:"videoDecode",get:function(){return this._videoDecode},set:function(e){this._videoDecode=e}},{key:"_bindEvents",value:function(){var e=this;_get(_getPrototypeOf(n.prototype),"_bindEvents",this).call(this),this.on("keyFrame",this._onKeyFrame.bind(this)),this.on(Events.DECODE_EVENTS.READY,this._onReady.bind(this)),this.on(Events.DECODE_EVENTS.DECODED,this._onDecoded.bind(this)),this.on(Events.DECODE_EVENTS.PLAY_FAILED,this._onPlayFailed.bind(this)),this.on("error",this._onError.bind(this)),this.on(Events.DECODE_EVENTS.APPEND_VIDEO,this._onAppendVideo.bind(this)),this.on(Events.DECODE_EVENTS.FIRST_FRAME,this._onFirstFrame.bind(this)),this._parent.on(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME,this._onChaseVideoFrame.bind(this)),this._parent.on(Events.TIMELINE.SYNC_DTS,this._onTimeLineSyncDTS.bind(this)),window.addEventListener("unload",(function(){e._empty()}))}},{key:"_onTimeLineSyncDTS",value:function(e){this._videoDecodeController.checkValidBlob(e)}},{key:"_onChaseVideoFrame",value:function(e){this._doChaseVideoFrame(e)}},{key:"_onAppendVideo",value:function(t){try{this._parent._parent.appendChild(t)}catch(e){cosole.error(this.TAG,"onAppendVideo",e)}}},{key:"_onKeyFrame",value:function(){logger.log(this.TAG,"_onKeyFrame,  keyframe"),this._videoDecodeController.emit("keyFrame")}},{key:"_onError",value:function(e,t){console.error(this.TAG,"decoder error",e,t),t||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,this._assembleErr(e&&e.message))}},{key:"_onReady",value:function(){if(!this._frameRender){var t=Object.assign(this._config,{meta:this._meta,canvas:this._canvas,type:"2d"});try{this._frameRender=new FrameRender(t,this)}catch(e){this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,this._assembleErr(e&&e.message))}}this._startDecode()}},{key:"_onFirstFrame",value:function(e){logger.log(this.TAG,"onFirstFrame"),this._receiveFrame(e),this._firstFrame=!0}},{key:"_onDecoded",value:function(e){var t=this;if(this._inChaseFrame){if(this.chaseFrameAfter++,1===this.chaseFrameAfter&&this._chaseToFrame){if(this._parent.emit(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME_END,this._chaseToFrame),this._frameQueue.length)this._frameQueue.frames.forEach((function(e){t._videoDecodeController.frameRendend(e.buffer)}));this._frameQueue.empty(),this._videoDecodeController.checkMinFrames(this._frameQueue.length),this._timeRange.deletePassed(this._chaseToFrame.frame.dts),this._inChaseFrame=!1,this._chaseToFrame=null,console.warn(this.TAG,"onDecoded","_inChaseFrame end")}}else this.chaseFrameAfter=0;this._receiveFrame(e)}},{key:"_onPlayFailed",value:function(e){console.warn(this.TAG,"onPlayFailed, this._ready:",this._ready,",firstEmit:",e,",frame length:",this._frameQueue.length),this._ready||e||this._whenReady(),this._canAutoPlay=!1}},{key:"canSeek",value:function(e){return this._videoDecodeController.canSeek(e)}},{key:"_initDecoder",value:function(){this._isInit||(logger.log(this.TAG,"_initDecoder"),this._videoDecodeController.isInit||this._videoDecodeController.init(this._meta),this._isInit=!0)}},{key:"_receiveFrame",value:function(e){_get(_getPrototypeOf(n.prototype),"_receiveFrame",this).call(this,e),this._videoDecodeController.checkMaxFrames(this._frameQueue._frames.length)}},{key:"_setMetadata",value:function(e){logger.warn(this.TAG,"video set metadata",e),this._meta=e;var t=e.fpsNum/e.fpsDen;t?logger.log(this.TAG,"detect fps:",t):logger.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder(e)}},{key:"_doChaseVideoFrame",value:function(e){this._inChaseFrame=!0,this._chaseToFrame=e,this._videoDecodeController.chaseVideoFrame(e)}},{key:"_appendChunk",value:function(e){this._meta||this._setMetadata(e);for(var t=e.samples.slice(),r=t.length,n=0;n<r;n++){var i=t.shift();i.keyframe&&this.emit("keyFrame"),this._timeRange.append([i],this.noAudio,!1)}}},{key:"_startDecode",value:function(){this._videoDecodeController.startDecode()}},{key:"_checkToDecode",value:function(){this._startDecode()}},{key:"_startRender",value:function(){logger.log(this.TAG,"_startRender interval",this.interval),this._tickTimer.start(this.interval)}},{key:"_render",value:function(e){var t=this,r=this._frameQueue.nextFrame(),n=this.preciseVideoDts;if(r&&this._timeRange){var i=r.info;if(!i)return this._frameQueue.shift(),void console.error("not info");this._renderDts=i.dts;var a=i.dts-n;if(a<-150){this.lastPrecise;var o=this._frameQueue.frames,s=this._getDeleteFrames(o,n),l=s.deleteFrames,u=s.useFrames;return o.splice(0),u.forEach((function(e){o.push(e)})),l.forEach((function(e){t._videoDecodeController.frameRendend(e.buffer)})),this._videoDecodeController.emit("renderDelay",a,this._frameQueue._frames.length),void this._videoDecodeController.checkMinFrames(this._frameQueue.length)}if(!(!e&&a>30&&a<6e4)){Math.abs(this._lastTimeupdate-i.dts)>250&&(this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.TIMEUPDATE),this._lastTimeupdate=i.dts),logger.long&&logger.log(this.TAG,"render delay:".concat(a," , timelinePosition:").concat(n," , dts:").concat(i.dts," , cost:").concat(i.cost," , gopID:").concat(i.gopId," , rest:").concat(this._frameQueue.length,", buffer frame:").concat(this._timeRange.frameLength));var c=performance.now();this._frameRender.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize),this.hasFirstFrame||e||(this.hasFirstFrame=!0,this._parent.emit(Events.TIMELINE.PLAY_EVENT,"firstframe")),this._videoDecodeController.frameRendend(r.buffer),this._frameQueue.shift(),this._videoDecodeController.checkMinFrames(this._frameQueue.length),this._videoDecodeController.emit("renderDelay",a,this._frameQueue._frames.length),this._renderCost=performance.now()-c,e||(this.lastTime&&(this.lastPrecise,Date.now(),this.lastTime),this.lastFrameinfo=i.dts,this.lastPrecise=n,this.lastTime=Date.now(),this.lastAudioTime=this._parent.audioRender.currentTime)}}else{if(this._videoDecodeController.checkMinFrames(this._frameQueue._frames.length),this._parent._paused)return;if(!this._firstFrame)return void logger.log(this.TAG,"_render","not first frame return");var d=this._videoDecodeController;if(logger.log(this.TAG,",lack frame, _inDecoding:",this._videoDecodeController._isInDecoding,this._videoDecodeController._isDecodePause,",_frameQueue.length:",this._frameQueue.length),!this._frameQueue.length&&d.isIDLE){this._ready=!1;var h=this._parent.audioRender;console.warn(this.TAG,"trigger video waiting vdecode, preciseVideoDts:",n,h.currentTime,h.duration,h.buffered.end(0),h.baseDts),this.emit(Events.VIDEO.VIDEO_WAITING)}this._checkToDecode()}}},{key:"_updateSegmentEnd",value:function(){}},{key:"_destroy",value:function(e){this._empty(),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this,e),this._videoDecodeController.destroy()}},{key:"_doPause",value:function(){logger.log(this.TAG,">>>>>>>>doPause"),this._tickTimer.stop()}},{key:"_getDeleteFrames",value:function(e,t){var r=[],n=[];return e.forEach((function(e){e.info&&e.info.dts>t?n.push(e):e.info&&e.info.dts<=t&&r.push(e)})),{deleteFrames:r,useFrames:n}}},{key:"_empty",value:function(){this._videoDecodeController&&(this._videoDecodeController.empty(),this._frameQueue.frames.forEach((function(e){e.buffer&&e.buffer.dom&&(e.buffer.dom.width=0,e.buffer.dom.height=0,e.buffer.dom=null)})))}}]),n}(VideoBaseRender),DecodeController=function(e){_inherits(r,e);var t=_createSuper(r);function r(e){var n;return _classCallCheck$1(this,r),_defineProperty$1(_assertThisInitialized(n=t.call(this)),"_parent",null),_defineProperty$1(_assertThisInitialized(n),"_decoderReady",!1),_defineProperty$1(_assertThisInitialized(n),"_inDecoding",!1),_defineProperty$1(_assertThisInitialized(n),"_toDecodeFirstframe",!0),_defineProperty$1(_assertThisInitialized(n),"_id",(new Date).getMilliseconds()),_defineProperty$1(_assertThisInitialized(n),"_workerErrorCallback",null),_defineProperty$1(_assertThisInitialized(n),"_workerMessageCallback",null),_defineProperty$1(_assertThisInitialized(n),"_decoderWorker",null),n._parent=e,n}return _createClass$1(r,[{key:"analyse",get:function(){return this._parent.analyse}},{key:"inDecoding",get:function(){return this._inDecoding}},{key:"decoderMode",get:function(){return this._decoderMode}},{key:"decoderReady",get:function(){return this._decoderReady}},{key:"needToDecode",get:function(){return this._inDecoding?0:this._continueDecodeThreshold}},{key:"maxDecodeOnce",get:function(){return this._maxDecodeOnce}},{key:"meta",get:function(){var e;return null===(e=this._parent)||void 0===e?void 0:e._meta},set:function(e){this._parent&&(this._parent._meta=e)}},{key:"init",value:function(e,t){this._workerMessageCallback=e,this._workerErrorCallback=t,this._initWorker()}},{key:"_initWorker",value:function(){throw new Error("need override by children")}},{key:"checkToDecode",value:function(e){this.webcodec?e<=this.needToDecode&&this.doDecode():!this._inDecoding&&e<=this.needToDecode&&this.doDecode()}},{key:"doDecode",value:function(){var e=this,t=this._getFramesToDecode();t&&t.length&&this.meta&&(this._toDecodeFirstframe&&(this._toDecodeFirstframe=!1,this.analyse.addFirstFrameToDecode()),this._avccpushed||this._initDecoderWithConfiguration(this._decoderWorker,this.meta),logger.enable&&logger.log(this.TAG,"doDecode ".concat(t.length," frames")),t.forEach((function(t){e._doDecodeInternal(t)})),this._inDecoding=!0,this._decoderWorker.postMessage({msg:"finish_flag"}))}},{key:"preciseSeek",value:function(e){var t,r,n,i,a=this,o=1e3*e,s=null===(t=this._parent)||void 0===t||null===(r=t._timeRange)||void 0===r?void 0:r.getFramesForPreciseSeek(o),l=s.length;l<this.maxDecodeOnce?this.doDecode():(null===(n=this._parent)||void 0===n||null===(i=n._timeRange)||void 0===i||i.updateFrameIndexForPreciseSeek(l),logger.enable&&logger.log(this.TAG,"doDecode ".concat(s.length," frames for precise seek")),s.forEach((function(e,t){a._doDecodeInternal(e,!0,t>=l-6)})),this._inDecoding=!0,this._decoderWorker.postMessage({msg:"finish_flag"}))}},{key:"_getFramesToDecode",value:function(){var e=this._parent,t=e._timeRange,r=e._decodeEstimate;if(this._decoderReady&&t){var n=t.frameLength;if(n){var i=this._toDecodeFirstframe?getDecodeCapacaity().maxDecodeOnceFirstTime:this.maxDecodeOnce;1===n&&r.resetDecodeDot(performance.now());for(var a=[];i>0;){var o=t&&t.getFrame();if(!o)break;a.push(o),o.gopId&&o.gopId-1==0&&r.updateGopCount(),i--}return a}}}},{key:"_doDecodeInternal",value:function(e,t,r){null!=e&&e.meta&&(this.meta=e.meta,logger.warn(this.TAG,"detect metadata! flush decoder"),this._initDecoderWithConfiguration(this.__decoderWorker,e.meta));var n={dts:e.dts,pts:e.pts||e.dts+e.cts,keyframe:e.keyframe,gopId:e.gopId,id:this._id};t&&(n.preciseSeek=!0,n.output=r);var i=e.data.slice();this._decoderWorker.postMessage({msg:"decode",data:i,info:n},[i.buffer])}},{key:"_initDecoderWithConfiguration",value:function(){throw new Error("need override by children")}},{key:"flushDecoder",value:function(){this._decoderWorker.postMessage({msg:"flush"})}},{key:"destroy",value:function(){throw new Error("need override by children")}}]),r}(EventEmitter$1),encodedJs$3="IWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBlPW51bGwsdD1bXSxzPTAsYT0hMTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLChmdW5jdGlvbihvKXtzd2l0Y2goby5kYXRhLm1zZyl7Y2FzZSJjb25maWd1cmF0aW9uIjplPW5ldyBzZWxmLlZpZGVvRGVjb2Rlcih7b3V0cHV0OmZ1bmN0aW9uKG8pe2E9ITAscyYmY2xlYXJUaW1lb3V0KHMpO3ZhciBuPXQuc2hpZnQoKTtuP3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkRFQ09ERUQiLHdpZHRoOm8uZGlzcGxheVdpZHRoLGhlaWdodDpvLmRpc3BsYXlIZWlnaHQsaW5mbzpuLGJ1ZmZlcjpvfSxbb10pOm8uY2xvc2UoKSxlLmRlY29kZVF1ZXVlU2l6ZT09PXQubGVuZ3RoJiZzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJCQVRDSF9GSU5JU0hfRkxBRyJ9KX0sZXJyb3I6ZnVuY3Rpb24oZSl7Y29uc29sZS5sb2coIltXZWJjb2RlY1dvcmtlcl06IixlKSwiQ29kZWMgcmVjbGFpbWVkIGR1ZSB0byBpbmFjdGl2aXR5LiIhPT1lLm1lc3NhZ2UmJnNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkZBSUxFRCIsbWVzc2FnZTplJiZlLm1lc3NhZ2V9KX19KSxzZWxmLlZpZGVvRGVjb2Rlci5pc0NvbmZpZ1N1cHBvcnRlZChvLmRhdGEuZGF0YSkudGhlbigoZnVuY3Rpb24odCl7dC5zdXBwb3J0ZWQmJihlLmNvbmZpZ3VyZShvLmRhdGEuZGF0YSksY29uc29sZS5sb2coIltXZWJjb2RlY1dvcmtlcl06IiwiaXNDb25maWdTdXBwb3J0ZWQiLHQpKX0pKS50aGVuKChmdW5jdGlvbigpe3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkRFQ09ERVJfUkVBRFkifSkscz1zZXRUaW1lb3V0KChmdW5jdGlvbigpe2F8fHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6IkZBSUxFRCIsbWVzc2FnZToibm8gZnJhbWUgb3V0cHV0In0pfSksMmUzKX0pKS5jYXRjaCgoZnVuY3Rpb24oZSl7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZToiRkFJTEVEIixtZXNzYWdlOmUmJmUubWVzc2FnZX0pfSkpO2JyZWFrO2Nhc2UiZGVjb2RlIjp2YXIgbj1vLmRhdGEuZGF0YSxpPW8uZGF0YS5pbmZvO3QucHVzaChpKTt2YXIgZD1uLmJ5dGVMZW5ndGgtNCxjPW5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoNCkpO2Muc2V0VWludDMyKDAsZCwhMSksbi5zZXQobmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpLDApLGkua2V5ZnJhbWUmJmUuZmx1c2goKTt2YXIgcj1uZXcgc2VsZi5FbmNvZGVkVmlkZW9DaHVuayh7dHlwZTppLmtleWZyYW1lPyJrZXkiOiJkZWx0YSIsdGltZXN0YW1wOmkucHRzLGRhdGE6bn0pO2UuZGVjb2RlKHIpO2JyZWFrO2Nhc2UiZGVzdHJveSI6ZSYmKGUuZmx1c2goKSxlLmNsb3NlKCkpLGNsZWFyVGltZW91dChzKTticmVhaztjYXNlImNoZWNrRGVjb2RlIjpzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOiJDSEVDS19UT19ERUNPREUiLGRhdGE6MD09PU1hdGguYWJzKGUuZGVjb2RlUXVldWVTaXplLXQubGVuZ3RoKX0pfX0pKX0oKTsK",blob$3="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs$3)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper$3(){var e=blob$3&&(window.URL||window.webkitURL).createObjectURL(blob$3);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+encodedJs$3,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var MAX_DECODE_ONCE_DEFAULT$1=getDecodeCapacaity().maxDecodeOnceWebcodec,WebCodecDecodeController=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;_classCallCheck$1(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$1(_assertThisInitialized(e=t.call.apply(t,[this].concat(i))),"TAG","WebCodecController"),_defineProperty$1(_assertThisInitialized(e),"_decoderMode",5),_defineProperty$1(_assertThisInitialized(e),"_maxDecodeOnce",MAX_DECODE_ONCE_DEFAULT$1),_defineProperty$1(_assertThisInitialized(e),"_continueDecodeThreshold",MAX_DECODE_ONCE_DEFAULT$1/2),_defineProperty$1(_assertThisInitialized(e),"_avccpushed",!1),e}return _createClass$1(r,[{key:"webcodec",get:function(){return!0}},{key:"needToDecode",get:function(){return this._inDecoding?(this._checkToDecode(),0):this._continueDecodeThreshold}},{key:"_initWorker",value:function(){var e=this;logger.log(this.TAG,"start init webcodec worker");var t=new WorkerWrapper$3;t.onMessage=function(t){var r,n;switch(t.data.type){case"DECODER_READY":logger.log(e.TAG,"webcodec worker ready "),e._decoderReady=!0,e._workerMessageCallback({type:"DECODER_READY"});break;case"DECODED":if(e._inDecoding=!0,(null===(r=t.data)||void 0===r||null===(n=r.info)||void 0===n?void 0:n.id)!==e._id)return;e._workerMessageCallback({type:"RECEIVE_FRAME",data:t.data});break;case"BATCH_FINISH_FLAG":if(e._inDecoding=!1,!e._workerMessageCallback)return;e._workerMessageCallback({type:"BATCH_FINISH"});break;case"CHECK_TO_DECODE":e._inDecoding=t.data.data;break;case"FAILED":e._whenError(t.data.message)}},t.onError=function(t){var r,n,i=null===(r=e._parent)||void 0===r||null===(n=r._parent)||void 0===n?void 0:n._parent;i&&i.removeChild(i.querySelector("canvas")),e._whenError(t.message)},t.addEventListener("message",t.onMessage),t.addEventListener("error",t.onError),this._decoderWorker=t,this._initDecoderWithConfiguration(t,this._parent.configuration)}},{key:"_whenError",value:function(e){r.canUse=!1,this._workerErrorCallback(e)}},{key:"_initDecoderWithConfiguration",value:function(e,t){e.postMessage({msg:"configuration",data:{codec:this._parent._meta.codec,codedHeight:this._parent._meta.height,codedWidth:this._parent._meta.width,description:t}}),this._avccpushed=!0}},{key:"_checkToDecode",value:function(){this._decoderWorker.postMessage({msg:"checkDecode"})}},{key:"destroy",value:function(){var e=this._decoderWorker;e.removeEventListener("message",e.onMessage),e.removeEventListener("error",e.onError),e.postMessage({msg:"destroy"}),e.terminate(),this._decoderWorker=null}}],[{key:"isSupported",value:function(){return getDecodeCapacaity().h264WithWebcodec&&!!window.VideoDecoder&&!1!==r.canUse}}]),r}(DecodeController),encodedJs$2="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzKHNyYyl7cmV0dXJuIGZldGNoKHNyYykudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudGV4dCgpfSkpLnRoZW4oKGZ1bmN0aW9uKHRleHQpe3NlbGYuZXhwb3J0cz17fSxldmFsKHRleHQpLHNlbGYubT1leHBvcnRzLm19KSl9dmFyIE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSD0zMTQ1NzI4LGluaXRUcz0wLERlY29kZXI9ZnVuY3Rpb24oZSl7dGhpcy5pbml0ZWQ9ITEsdGhpcy5pbmZvSWQ9MCx0aGlzLnNlbGY9ZSx0aGlzLm1ldGE9dGhpcy5zZWxmLm1ldGEsdGhpcy50cz0wLHRoaXMuaW5mb2xpc3Q9W10sZS5wYXJfYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkPXRoaXMuYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkLmJpbmQodGhpcyksZS5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkPXRoaXMuYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkLmJpbmQodGhpcyl9LGRlY29kZXI7ZnVuY3Rpb24gb25Qb3N0UnVuKCl7KGRlY29kZXI9bmV3IERlY29kZXIodGhpcykpLmluaXQoKX1EZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXk9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gTW9kdWxlLkhFQVBVOC5zdWJhcnJheShlLGUrdCl9LERlY29kZXIucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgwLDEpLHRoaXMub2Zmc2V0PU1vZHVsZS5fYnJvYWR3YXlDcmVhdGVTdHJlYW0oTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIKX0sRGVjb2Rlci5wcm90b3R5cGUuYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkPWZ1bmN0aW9uKGUsdCxvLG4saSl7dmFyIHM9dGhpcy5pbmZvbGlzdC5zaGlmdCgpLHI9byxhPW8vMixjPXQsZD10LzI7aWYoIXRoaXMubWV0YXx8NDQ0IT09dGhpcy5tZXRhLmNocm9tYUZvcm1hdCYmNDIyIT09dGhpcy5tZXRhLmNocm9tYUZvcm1hdHx8KGE9byksIXN8fCFzLnByZWNpc2VTZWVrfHxzLm91dHB1dCl7dmFyIGY9dGhpcy50b1U4QXJyYXkoZSxjKnIrZCphKjIpLHU9bmV3IFVpbnQ4QXJyYXkoZi5sZW5ndGgpO3Uuc2V0KGYpO3ZhciBsPXUuYnVmZmVyO3RoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVEIix3aWR0aDp0LGhlaWdodDpvLHlMaW5lc2l6ZTpjLHV2TGluZXNpemU6ZCxpbmZvOnMsYnVmZmVyOmx9LFtsXSl9fSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQ9ZnVuY3Rpb24oKXtpZighdGhpcy5pbml0ZWQpe3RoaXMuaW5pdGVkPSEwO3ZhciBlPTA7aW5pdFRzJiYoZT1wZXJmb3JtYW5jZS5ub3coKS1pbml0VHMpLHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVSX1JFQURZIixjb3N0OmV9KX19LERlY29kZXIucHJvdG90eXBlLmRlY29kZT1mdW5jdGlvbihlLHQpe3ZhciBvPXBhcnNlSW50KChuZXcgRGF0ZSkuZ2V0VGltZSgpKSxuPW8tMWU5Kk1hdGguZmxvb3Ioby8xZTkpO3RoaXMuaW5mb2xpc3QucHVzaCh0KSx0JiZ0LmtleWZyYW1lJiYodGhpcy5pbmZvbGlzdD1bdF0sTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKG4pKSxNb2R1bGUuSEVBUFU4LnNldChlLHRoaXMub2Zmc2V0KSxNb2R1bGUuX2Jyb2Fkd2F5UGxheVN0cmVhbShlLmxlbmd0aCx0aGlzLmluZm9JZCl9LERlY29kZXIucHJvdG90eXBlLmZsdXNoPWZ1bmN0aW9uKCl7TW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKCl9LERlY29kZXIucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5RXhpdCgpfSxEZWNvZGVyLnByb3RvdHlwZS51cGRhdGVNZXRhPWZ1bmN0aW9uKGUpe3RoaXMubWV0YT1lfTt2YXIgV0FTTV9DRE5fUEFUSF9QUkVGSVg9IiI7ZnVuY3Rpb24gaW5pdChlKXtXQVNNX0NETl9QQVRIX1BSRUZJWD1lLnNwbGl0KCIvIikuc2xpY2UoMCwtMSkuam9pbigiLyIpLGluaXRUcz1wZXJmb3JtYW5jZS5ub3coKTt2YXIgdD0vYXNtLy50ZXN0KGUpO2RlY29kZXJ8fChzZWxmLmltcG9ydFNjcmlwdHM/bmV3IFByb21pc2UoKGZ1bmN0aW9uKHQsbyl7c2VsZi5jb25zb2xlfHwoc2VsZi5jb25zb2xlPXtsb2c6ZnVuY3Rpb24oKXt9LHdhcm46ZnVuY3Rpb24oKXt9LGluZm86ZnVuY3Rpb24oKXt9LGVycm9yOmZ1bmN0aW9uKCl7fX0pO3RyeXtzZWxmLmltcG9ydFNjcmlwdHMoZSksdCgpfWNhdGNoKG4pe2lmKG4ubWVzc2FnZS5pbmNsdWRlcygiTW9kdWxlIHNjcmlwdHMgZG9uJ3Qgc3VwcG9ydCBpbXBvcnRTY3JpcHRzIikpcmV0dXJuIHQoc2hpbUltcG9ydFNjcmlwdHMoZSkpO28obil9fSkpOnNoaW1JbXBvcnRTY3JpcHRzKGUpKS50aGVuKChmdW5jdGlvbigpe3JldHVybiB0Pyhjb25zb2xlLmxvZygiYXV0byBpbnN0YW5jZSBEZWNvZGVyISIpLG5ldyBQcm9taXNlKChmdW5jdGlvbihlLHQpe3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7dHJ5e29uUG9zdFJ1bi5jYWxsKHNlbGYpLGUoKX1jYXRjaChvKXt0KG8pfX0pKX0pKSk6c2VsZi5tP3NlbGYubSh7aW5zdGFudGlhdGVXYXNtOmZ1bmN0aW9uKGUsdCl7ZmV0Y2goIiIuY29uY2F0KFdBU01fQ0ROX1BBVEhfUFJFRklYLCIvZGVjb2Rlci53YXNtLmpzIikpLnRoZW4oKGZ1bmN0aW9uKGUpe3JldHVybiBlLmFycmF5QnVmZmVyKCl9KSkudGhlbigoZnVuY3Rpb24odCl7cmV0dXJuIFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKHQsZSl9KSkudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIHQoZS5pbnN0YW5jZSl9KSl9fSkudGhlbigoZnVuY3Rpb24oZSl7c2VsZi5Nb2R1bGU9ZSxvblBvc3RSdW4uY2FsbChzZWxmKX0pKTpuZXcgUHJvbWlzZSgoZnVuY3Rpb24oZSx0KXthZGRPblBvc3RSdW4ob25Qb3N0UnVuLmJpbmQoc2VsZikpLE1vZHVsZS5vblJ1bnRpbWVJbml0aWFsaXplZD1mdW5jdGlvbigpe2UoKX0sTW9kdWxlLm9uQWJvcnQ9ZnVuY3Rpb24oZSl7dChlJiZlLm1lc3NhZ2U/ZTpuZXcgRXJyb3IoIndhc20gaW5pdCBlcnJvciIpKX0sc2V0VGltZW91dCgoZnVuY3Rpb24oKXt0KG5ldyBFcnJvcigid2FzbSBsb2FkIHRpbWVvdXQiKSl9KSw2ZTMpfSkpfSkpLmNhdGNoKChmdW5jdGlvbihlKXtzZWxmLnBvc3RNZXNzYWdlKHttc2c6IklOSVRfRkFJTEVEIixsb2c6ZS5tZXNzYWdlfSl9KSl9c2VsZi5vbm1lc3NhZ2U9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5kYXRhO2lmKHQubXNnKXtpZigiaW5pdCIhPT10Lm1zZyYmInByZWxvYWQiIT09dC5tc2cmJiFkZWNvZGVyKXJldHVybjtzd2l0Y2godC5tc2cpe2Nhc2UicHJlbG9hZCI6aW5pdCh0LnVybCk7YnJlYWs7Y2FzZSJpbml0IjpzZWxmLm1ldGE9dC5tZXRhLGluaXQodC51cmwpO2JyZWFrO2Nhc2UidXBkYXRlbWV0YSI6c2VsZi5tZXRhPXQubWV0YSxkZWNvZGVyLnVwZGF0ZU1ldGEodC5tZXRhKTticmVhaztjYXNlImluaXREZWNvZGVyIjpkZWNvZGVyLmRlY29kZSh0LmRhdGEpO2JyZWFrO2Nhc2UiZGVjb2RlIjpkZWNvZGVyLmRlY29kZSh0LmRhdGEsdC5pbmZvKTticmVhaztjYXNlImZsdXNoIjpkZWNvZGVyLmZsdXNoKCk7YnJlYWs7Y2FzZSJmaW5pc2hfZmxhZyI6c2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJCQVRDSF9GSU5JU0hfRkxBRyJ9KTticmVhaztjYXNlImRlc3RvcnkiOmRlY29kZXIuZGVzdHJveSgpfX1lbHNlIHNlbGYucG9zdE1lc3NhZ2Uoe21zZzoiRVJST1I6aW52YWxpZCBtZXNzYWdlIn0pfX0pKCk7Cg==",blob$2="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs$2)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper$2(){var e=blob$2&&(window.URL||window.webkitURL).createObjectURL(blob$2);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+encodedJs$2,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var encodedJs$1="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzKHNyYyl7cmV0dXJuIGZldGNoKHNyYykudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudGV4dCgpfSkpLnRoZW4oKGZ1bmN0aW9uKHRleHQpe3NlbGYuZXhwb3J0cz17fSxldmFsKHRleHQpLHNlbGYubT1leHBvcnRzLm19KSl9dmFyIE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSD01MjQyODgwLEJBVENIX0RFQ09ERV9TSVpFPTgsaW5pdFRzPTAsRGVjb2Rlcj1mdW5jdGlvbihlKXt0aGlzLmluaXRlZD0hMSx0aGlzLmluZm9JZD0wLHRoaXMuc2VsZj1lLHRoaXMubWV0YT1lLm1ldGEsdGhpcy50cz0wLHRoaXMuaW5mb2xpc3Q9W10sZS5wYXJfYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkPXRoaXMuYnJvYWR3YXlPbkJyb2Fkd2F5SW5pdGVkLmJpbmQodGhpcyksZS5wYXJfYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkPXRoaXMuYnJvYWR3YXlPblBpY3R1cmVEZWNvZGVkLmJpbmQodGhpcyl9LGRlY29kZXI7ZnVuY3Rpb24gb25Qb3N0UnVuKCl7KGRlY29kZXI9bmV3IERlY29kZXIodGhpcykpLmluaXQoKX1EZWNvZGVyLnByb3RvdHlwZS50b1U4QXJyYXk9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gTW9kdWxlLkhFQVBVOC5zdWJhcnJheShlLGUrdCl9LERlY29kZXIucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5SW5pdCgwLDIpLHRoaXMuc3RyZWFtQnVmZmVyUHRyPU1vZHVsZS5fYnJvYWR3YXlDcmVhdGVTdHJlYW0oTUFYX1NUUkVBTV9CVUZGRVJfTEVOR1RIKSx0aGlzLnN0cmVhbUJ1ZmZlcj10aGlzLnRvVThBcnJheSh0aGlzLnN0cmVhbUJ1ZmZlclB0cixNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgpLHRoaXMuYnVmZmVyU2l6ZXNQdHI9TW9kdWxlLl9tYWxsb2MoNCpCQVRDSF9ERUNPREVfU0laRSksdGhpcy5idWZmZXJTaXplcz10aGlzLnRvVThBcnJheSh0aGlzLmJ1ZmZlclNpemVzUHRyLDQqQkFUQ0hfREVDT0RFX1NJWkUpLHRoaXMuc3RyZWFtQnVmZmVyT2Zmc2V0PTAsdGhpcy5mcmFtZUxlbnNPZmZzZXQ9MCx0aGlzLmZyYW1lTGVuc0J1ZmZlcj1uZXcgVWludDMyQXJyYXkoQkFUQ0hfREVDT0RFX1NJWkUpfSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uUGljdHVyZURlY29kZWQ9ZnVuY3Rpb24oZSx0LHIpe3ZhciBzPXRoaXMuaW5mb2xpc3Quc2hpZnQoKSxvPXIsaT1yLzIsbj10LGY9dC8yOyF0aGlzLm1ldGF8fDQ0NCE9PXRoaXMubWV0YS5jaHJvbWFGb3JtYXQmJjQyMiE9PXRoaXMubWV0YS5jaHJvbWFGb3JtYXR8fChpPXIpO3ZhciBhPXRoaXMudG9VOEFycmF5KGUsbipvK2YqaSoyKSxjPW5ldyBVaW50OEFycmF5KGEubGVuZ3RoKTtjLnNldChhKTt2YXIgZD1jLmJ1ZmZlcjt0aGlzLnNlbGYucG9zdE1lc3NhZ2Uoe21zZzoiREVDT0RFRCIsd2lkdGg6dCxoZWlnaHQ6cix5TGluZXNpemU6bix1dkxpbmVzaXplOmYsaW5mbzpzLGJ1ZmZlcjpkfSxbZF0pfSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQ9ZnVuY3Rpb24oKXtpZighdGhpcy5pbml0ZWQpe3RoaXMuaW5pdGVkPSEwO3ZhciBlPTA7aW5pdFRzJiYoZT1wZXJmb3JtYW5jZS5ub3coKS1pbml0VHMpLHRoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVSX1JFQURZIixjb3N0OmV9KX19LERlY29kZXIucHJvdG90eXBlLnN0b3JlQnVmZmVyPWZ1bmN0aW9uKGUsdCl7dCYmdC5rZXlmcmFtZSYmdGhpcy5mbHVzaCgpLHRoaXMuaW5mb2xpc3QucHVzaCh0KSx0aGlzLnN0cmVhbUJ1ZmZlci5zZXQoZSx0aGlzLnN0cmVhbUJ1ZmZlck9mZnNldCksdGhpcy5mcmFtZUxlbnNCdWZmZXJbdGhpcy5mcmFtZUxlbnNPZmZzZXRdPWUubGVuZ3RoLHRoaXMuc3RyZWFtQnVmZmVyT2Zmc2V0Kz1lLmxlbmd0aCx0aGlzLmZyYW1lTGVuc09mZnNldCs9MSx0aGlzLmJhdGNoRGVjb2RlKCl9LERlY29kZXIucHJvdG90eXBlLmJhdGNoRGVjb2RlPWZ1bmN0aW9uKGUpeyh0aGlzLmZyYW1lTGVuc09mZnNldD49QkFUQ0hfREVDT0RFX1NJWkV8fGUmJnRoaXMuZnJhbWVMZW5zT2Zmc2V0KSYmKHRoaXMuYnVmZmVyU2l6ZXMuc2V0KG5ldyBVaW50OEFycmF5KHRoaXMuZnJhbWVMZW5zQnVmZmVyLmJ1ZmZlciksMCksTW9kdWxlLl9icm9hZHdheVBsYXlTdHJlYW0xKHRoaXMuYnVmZmVyU2l6ZXNQdHIsdGhpcy5mcmFtZUxlbnNPZmZzZXQpLHRoaXMuZnJhbWVMZW5zT2Zmc2V0PTAsdGhpcy5zdHJlYW1CdWZmZXJPZmZzZXQ9MCl9LERlY29kZXIucHJvdG90eXBlLmRlY29kZT1mdW5jdGlvbihlKXt0aGlzLnN0cmVhbUJ1ZmZlci5zZXQoZSksTW9kdWxlLl9icm9hZHdheVBsYXlTdHJlYW0oZS5sZW5ndGgsMCl9LERlY29kZXIucHJvdG90eXBlLmZsdXNoPWZ1bmN0aW9uKCl7dGhpcy5iYXRjaERlY29kZSghMCksTW9kdWxlLl9icm9hZHdheUZsdXNoU3RyZWFtKCl9LERlY29kZXIucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXtNb2R1bGUuX2Jyb2Fkd2F5RXhpdCgpfSxEZWNvZGVyLnByb3RvdHlwZS51cGRhdGVNZXRhPWZ1bmN0aW9uKGUpe3RoaXMubWV0YT1lfTt2YXIgV0FTTV9DRE5fUEFUSF9QUkVGSVg9IiI7ZnVuY3Rpb24gaW5pdChlKXsoV0FTTV9DRE5fUEFUSF9QUkVGSVg9ZS5zcGxpdCgiLyIpLnNsaWNlKDAsLTEpLmpvaW4oIi8iKSxpbml0VHM9cGVyZm9ybWFuY2Uubm93KCksZGVjb2Rlcil8fChzZWxmLmltcG9ydFNjcmlwdHM/bmV3IFByb21pc2UoKGZ1bmN0aW9uKHQscil7c2VsZi5jb25zb2xlfHwoc2VsZi5jb25zb2xlPXtsb2c6ZnVuY3Rpb24oKXt9LHdhcm46ZnVuY3Rpb24oKXt9LGluZm86ZnVuY3Rpb24oKXt9LGVycm9yOmZ1bmN0aW9uKCl7fX0pO3RyeXtzZWxmLmltcG9ydFNjcmlwdHMoZSksdCgpfWNhdGNoKHMpe2lmKHMubWVzc2FnZS5pbmNsdWRlcygiTW9kdWxlIHNjcmlwdHMgZG9uJ3Qgc3VwcG9ydCBpbXBvcnRTY3JpcHRzIikpcmV0dXJuIHQoc2hpbUltcG9ydFNjcmlwdHMoZSkpO3Iocyl9fSkpOnNoaW1JbXBvcnRTY3JpcHRzKGUpKS50aGVuKChmdW5jdGlvbigpe3JldHVybiBmZXRjaChXQVNNX0NETl9QQVRIX1BSRUZJWCsiL2RlY29kZXIud29ya2VyLmpzIikudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUuYmxvYigpfSkpLnRoZW4oKGZ1bmN0aW9uKGUpe3JldHVybiBzZWxmLm0oe2xvY2F0ZUZpbGU6ZnVuY3Rpb24odCl7cmV0dXJuL1wud29ya2VyXC5qcyQvLnRlc3QodCk/VVJMLmNyZWF0ZU9iamVjdFVSTChlKTovXC53YXNtJC8udGVzdCh0KT9XQVNNX0NETl9QQVRIX1BSRUZJWCsiL2RlY29kZXIud2FzbSI6L1wubWVtJC8udGVzdCh0KT9XQVNNX0NETl9QQVRIX1BSRUZJWCsiL2RlY29kZXIuanMubWVtIjp2b2lkIDB9LG1haW5TY3JpcHRVcmxPckJsb2I6V0FTTV9DRE5fUEFUSF9QUkVGSVgrIi9kZWNvZGVyLmpzIn0pfSkpLnRoZW4oKGZ1bmN0aW9uKGUpe3NlbGYuTW9kdWxlPWUsb25Qb3N0UnVuLmNhbGwoc2VsZil9KSl9KSkuY2F0Y2goKGZ1bmN0aW9uKGUpe3NlbGYucG9zdE1lc3NhZ2Uoe21zZzoiSU5JVF9GQUlMRUQiLGxvZzplLm1lc3NhZ2V9KX0pKX1zZWxmLm9ubWVzc2FnZT1mdW5jdGlvbihlKXt2YXIgdD1lLmRhdGE7aWYoImluaXQiPT09dC5tc2d8fCJwcmVsb2FkIj09PXQubXNnfHxkZWNvZGVyKXN3aXRjaCh0Lm1zZyl7Y2FzZSJwcmVsb2FkIjppbml0KHQudXJsKSxCQVRDSF9ERUNPREVfU0laRT10LmJhdGNoRGVjb2RlQ291bnQ7YnJlYWs7Y2FzZSJpbml0IjpzZWxmLm1ldGE9dC5tZXRhLEJBVENIX0RFQ09ERV9TSVpFPXQuYmF0Y2hEZWNvZGVDb3VudCxpbml0KHQudXJsKTticmVhaztjYXNlInVwZGF0ZW1ldGEiOnNlbGYubWV0YT10Lm1ldGEsZGVjb2Rlci51cGRhdGVNZXRhKHQubWV0YSk7YnJlYWs7Y2FzZSJpbml0RGVjb2RlciI6ZGVjb2Rlci5mcmFtZUxlbnNPZmZzZXQmJmRlY29kZXIuYmF0Y2hEZWNvZGUoITApLGRlY29kZXIuZmx1c2goKSxkZWNvZGVyLmRlY29kZSh0LmRhdGEpO2JyZWFrO2Nhc2UiZGVjb2RlIjpkZWNvZGVyLnN0b3JlQnVmZmVyKHQuZGF0YSx0LmluZm8pO2JyZWFrO2Nhc2UiZmx1c2giOmRlY29kZXIuZmx1c2goKTticmVhaztjYXNlImZpbmlzaF9mbGFnIjpzZWxmLnBvc3RNZXNzYWdlKHttc2c6IkJBVENIX0ZJTklTSF9GTEFHIn0pO2JyZWFrO2Nhc2UiZGVzdG9yeSI6ZGVjb2Rlci5kZXN0cm95KCl9fX0pKCk7Cg==",blob$1="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs$1)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper$1(){var e=blob$1&&(window.URL||window.webkitURL).createObjectURL(blob$1);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+encodedJs$1,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var encodedJs="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIHNoaW1JbXBvcnRTY3JpcHRzKHNyYyl7cmV0dXJuIGZldGNoKHNyYykudGhlbigoZnVuY3Rpb24oZSl7cmV0dXJuIGUudGV4dCgpfSkpLnRoZW4oKGZ1bmN0aW9uKHRleHQpe3NlbGYuZXhwb3J0cz17fSxldmFsKHRleHQpLHNlbGYubT1leHBvcnRzLm19KSl9dmFyIE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSD0xMDQ4NTc2LGluaXRUcz0wLERlY29kZXI9ZnVuY3Rpb24oZSl7dGhpcy5pbml0ZWQ9ITEsdGhpcy5zZWxmPWUsdGhpcy5tZXRhPWUubWV0YSx0aGlzLmluZm9saXN0PVtdLGUucGFyX2Jyb2Fkd2F5T25Ccm9hZHdheUluaXRlZD10aGlzLmJyb2Fkd2F5T25Ccm9hZHdheUluaXRlZC5iaW5kKHRoaXMpLGUucGFyX2Jyb2Fkd2F5T25QaWN0dXJlRGVjb2RlZD10aGlzLmJyb2Fkd2F5T25QaWN0dXJlRGVjb2RlZC5iaW5kKHRoaXMpfSxkZWNvZGVyO2Z1bmN0aW9uIG9uUG9zdFJ1bigpeyhkZWNvZGVyPW5ldyBEZWNvZGVyKHRoaXMpKS5pbml0KCl9RGVjb2Rlci5wcm90b3R5cGUudG9VOEFycmF5PWZ1bmN0aW9uKGUsdCl7cmV0dXJuIE1vZHVsZS5IRUFQVTguc3ViYXJyYXkoZSxlK3QpfSxEZWNvZGVyLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKCl7TW9kdWxlLl9icm9hZHdheUluaXQoKSx0aGlzLnN0cmVhbUJ1ZmZlcj10aGlzLnRvVThBcnJheShNb2R1bGUuX2Jyb2Fkd2F5Q3JlYXRlU3RyZWFtKE1BWF9TVFJFQU1fQlVGRkVSX0xFTkdUSCwwKSxNQVhfU1RSRUFNX0JVRkZFUl9MRU5HVEgpfSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uUGljdHVyZURlY29kZWQ9ZnVuY3Rpb24oZSx0LG8saSxuLHMscil7dmFyIGE9dGhpcy5pbmZvbGlzdFswXTtpZighYXx8IWEua2V5ZnJhbWV8fHIpe3ZhciBjPU9iamVjdC5hc3NpZ24oe30sdGhpcy5pbmZvbGlzdC5zaGlmdCgpKSxkPW8sZj1vLzI7IXRoaXMubWV0YXx8NDQ0IT09dGhpcy5tZXRhLmNocm9tYUZvcm1hdCYmNDIyIT09dGhpcy5tZXRhLmNocm9tYUZvcm1hdHx8KGY9byk7dmFyIHU9dGhpcy50b1U4QXJyYXkoZSxpKmQrbipmKjIpLGw9bmV3IFVpbnQ4QXJyYXkodS5sZW5ndGgpO2wuc2V0KHUpO3ZhciBtPWwuYnVmZmVyO3RoaXMuc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJERUNPREVEIix3aWR0aDp0LGhlaWdodDpvLHlMaW5lc2l6ZTppLHV2TGluZXNpemU6bixpbmZvOmMsYnVmZmVyOm19LFttXSl9fSxEZWNvZGVyLnByb3RvdHlwZS5icm9hZHdheU9uQnJvYWR3YXlJbml0ZWQ9ZnVuY3Rpb24oKXt0aGlzLmluaXRlZD0hMDt2YXIgZT0wO2luaXRUcyYmKGU9cGVyZm9ybWFuY2Uubm93KCktaW5pdFRzKSx0aGlzLnNlbGYucG9zdE1lc3NhZ2Uoe21zZzoiREVDT0RFUl9SRUFEWSIsY29zdDplfSl9LERlY29kZXIucHJvdG90eXBlLmRlY29kZT1mdW5jdGlvbihlLHQpe3QmJnRoaXMuaW5mb2xpc3QucHVzaCh0KSx0JiZ0LmtleWZyYW1lJiYodGhpcy5pbmZvbGlzdD1bdF0pLHRoaXMuc3RyZWFtQnVmZmVyLnNldChlKSxNb2R1bGUuX2Jyb2Fkd2F5UGxheVN0cmVhbShlLmxlbmd0aCwwKX0sRGVjb2Rlci5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe01vZHVsZS5fYnJvYWR3YXlFeGl0KCl9LERlY29kZXIucHJvdG90eXBlLnVwZGF0ZU1ldGE9ZnVuY3Rpb24oZSl7dGhpcy5tZXRhPWV9O3ZhciBXQVNNX0NETl9QQVRIX1BSRUZJWD0iIjtmdW5jdGlvbiBpbml0KGUpe1dBU01fQ0ROX1BBVEhfUFJFRklYPWUuc3BsaXQoIi8iKS5zbGljZSgwLC0xKS5qb2luKCIvIiksaW5pdFRzPXBlcmZvcm1hbmNlLm5vdygpO3ZhciB0PS9hc20vLnRlc3QoZSk7ZGVjb2Rlcnx8KHNlbGYuaW1wb3J0U2NyaXB0cz9uZXcgUHJvbWlzZSgoZnVuY3Rpb24odCxvKXtzZWxmLmNvbnNvbGV8fChzZWxmLmNvbnNvbGU9e2xvZzpmdW5jdGlvbigpe30sd2FybjpmdW5jdGlvbigpe30saW5mbzpmdW5jdGlvbigpe30sZXJyb3I6ZnVuY3Rpb24oKXt9fSk7dHJ5e3NlbGYuaW1wb3J0U2NyaXB0cyhlKSx0KCl9Y2F0Y2goaSl7aWYoaS5tZXNzYWdlLmluY2x1ZGVzKCJNb2R1bGUgc2NyaXB0cyBkb24ndCBzdXBwb3J0IGltcG9ydFNjcmlwdHMiKSlyZXR1cm4gdChzaGltSW1wb3J0U2NyaXB0cyhlKSk7byhpKX19KSk6c2hpbUltcG9ydFNjcmlwdHMoZSkpLnRoZW4oKGZ1bmN0aW9uKCl7cmV0dXJuIHQ/KGNvbnNvbGUubG9nKCJhdXRvIGluc3RhbmNlIERlY29kZXIhIiksbmV3IFByb21pc2UoKGZ1bmN0aW9uKGUsdCl7c2V0VGltZW91dCgoZnVuY3Rpb24oKXt0cnl7b25Qb3N0UnVuLmNhbGwoc2VsZiksZSgpfWNhdGNoKG8pe3Qobyl9fSkpfSkpKTpzZWxmLm0oe2luc3RhbnRpYXRlV2FzbTpmdW5jdGlvbihlLHQpe2ZldGNoKCIiLmNvbmNhdChXQVNNX0NETl9QQVRIX1BSRUZJWCwiL2RlY29kZXIud2FzbS5qcyIpKS50aGVuKChmdW5jdGlvbihlKXtyZXR1cm4gZS5hcnJheUJ1ZmZlcigpfSkpLnRoZW4oKGZ1bmN0aW9uKHQpe3JldHVybiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZSh0LGUpfSkpLnRoZW4oKGZ1bmN0aW9uKGUpe3JldHVybiB0KGUuaW5zdGFuY2UpfSkpfX0pLnRoZW4oKGZ1bmN0aW9uKGUpe3NlbGYuTW9kdWxlPWUsb25Qb3N0UnVuLmNhbGwoc2VsZil9KSl9KSkuY2F0Y2goKGZ1bmN0aW9uKGUpe3NlbGYucG9zdE1lc3NhZ2Uoe21zZzoiSU5JVF9GQUlMRUQiLGxvZzplLm1lc3NhZ2V9KX0pKX1zZWxmLm9ubWVzc2FnZT1mdW5jdGlvbihlKXt2YXIgdD1lLmRhdGE7aWYoImluaXQiPT09dC5tc2d8fCJwcmVsb2FkIj09PXQubXNnfHxkZWNvZGVyKXN3aXRjaCh0Lm1zZyl7Y2FzZSJwcmVsb2FkIjppbml0KHQudXJsKTticmVhaztjYXNlImluaXQiOnNlbGYubWV0YT10Lm1ldGEsc2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJMT0ciLGxvZzoid29ya2VyIGluaXRlZCJ9KSxpbml0KHQudXJsKTticmVhaztjYXNlInVwZGF0ZW1ldGEiOnNlbGYubWV0YT10Lm1ldGEsZGVjb2Rlci51cGRhdGVNZXRhKHQubWV0YSk7YnJlYWs7Y2FzZSJpbml0RGVjb2RlciI6ZGVjb2Rlci5kZWNvZGUodC5kYXRhKTticmVhaztjYXNlImRlY29kZSI6ZGVjb2Rlci5kZWNvZGUodC5kYXRhLHQuaW5mbyk7YnJlYWs7Y2FzZSJmaW5pc2hfZmxhZyI6c2VsZi5wb3N0TWVzc2FnZSh7bXNnOiJCQVRDSF9GSU5JU0hfRkxBRyJ9KTticmVhaztjYXNlImRlc3RvcnkiOmRlY29kZXIuZGVzdHJveSgpfX19KSgpOwo=",blob="undefined"!=typeof window&&window.Blob&&new Blob([atob(encodedJs)],{type:"text/javascript;charset=utf-8"});function WorkerWrapper(){var e=blob&&(window.URL||window.webkitURL).createObjectURL(blob);try{return e?new Worker(e,{}):new Worker("data:application/javascript;base64,"+encodedJs,{type:"module"})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var DecoderCache=function(){function e(){_classCallCheck$1(this,e),_defineProperty$1(this,"_queue",[]),_defineProperty$1(this,"_pendingDecoder",null),_defineProperty$1(this,"TAG","DecoderCache")}return _createClass$1(e,[{key:"genDecoder",value:function(e){return this._initDecoder(e)}},{key:"_initDecoder",value:function(e){var t=this,r=getDecodeCapacaity(),n=r.preloadDecoder,i=r.maxDecodeOnceWasm;e=e||n;var a,o,s=getDecoderUrls(),l=s.H264_DECODER_URL,u=s.H265_SIMD_DECODER_URL,c=s.H265_DECODER_URL,d=s.H265_THREAD_DECODER_URL,h=1;if("h265"===e&&(simdSupported()?(a=new WorkerWrapper$2,o=u,h=2):threadSupported()&&getDecodeCapacaity().canUseThreadMode?(a=new WorkerWrapper$1,o=d,h=1):(a=new WorkerWrapper$2,o=c,h=3)),"h264"===e&&(a=new WorkerWrapper,o=l,h=3),!a)return Promise.resolve();var f=promiseDelayed();a.postMessage({msg:"preload",batchDecodeCount:i,url:o}),this._pendingDecoder=a,a.id=Date.now()+parseInt(1e3*Math.random()),a.isHevc="h265"===e,a.using=!1,a.ready=!1,logger.log(this.TAG,"start init decoder worker, id=",a.id,"hevc=",a.isHevc,"mode=",h);var p=function e(r){t._pendingDecoder=null;var n=r.data.msg;switch("DECODER_READY"!==n&&"INIT_FAILED"!==n||(a.removeEventListener("message",e),a.removeEventListener("error",y)),n){case"DECODER_READY":logger.log(t.TAG,"decoder worker inited!, id=",a.id,"cost:",r.data.cost),a.ready=!0,a.using||t._queue.push(a),f.resolve();break;case"INIT_FAILED":logger.log(t.TAG,"decoder worker init failed!",r.data.log),f.reject(r.data.log)}},y=function e(t){a.removeEventListener("message",p),a.removeEventListener("error",e),f.reject(null==t?void 0:t.message)};return a.addEventListener("message",p),a.addEventListener("error",y),f}},{key:"cacheDecoder",value:function(e){e.using=!1,e.ready=!0,e.id||(e.id=Date.now()+parseInt(1e3*Math.random())),this._queue.push(e),logger.log(this.TAG,"cache decoder, id=",e.id),"h265"===getDecodeCapacaity().preloadDecoder&&1===this._queue.filter((function(e){return!e.using&&e.isHevc})).length&&this.genDecoder("h265")}},{key:"getCachedDecoder",value:function(e){var t,r=this._queue.findIndex((function(t){return!t.using&&t.isHevc===e}));if(-1!==r&&(t=this._queue.splice(r,1)[0]),!t&&this._pendingDecoder&&(t=this._pendingDecoder,this._pendingDecoder=null),t)return t.using=!0,logger.warn(this.TAG,"get cached decoder, id=".concat(t.id,", ready=").concat(t.ready)),t}}]),e}(),decoderCache=new DecoderCache,MAX_DECODE_ONCE_DEFAULT=getDecodeCapacaity().maxDecodeOnceWasm,WasmDecodeController=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;_classCallCheck$1(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return _defineProperty$1(_assertThisInitialized(e=t.call.apply(t,[this].concat(i))),"TAG","WasmController"),_defineProperty$1(_assertThisInitialized(e),"_avccpushed",!1),_defineProperty$1(_assertThisInitialized(e),"_maxDecodeOnce",MAX_DECODE_ONCE_DEFAULT),_defineProperty$1(_assertThisInitialized(e),"_continueDecodeThreshold",MAX_DECODE_ONCE_DEFAULT/2),_defineProperty$1(_assertThisInitialized(e),"_wasmInitCost",0),_defineProperty$1(_assertThisInitialized(e),"_threadSupported",threadSupported()&&getDecodeCapacaity().canUseThreadMode),_defineProperty$1(_assertThisInitialized(e),"_simdSuppported",simdSupported()),_defineProperty$1(_assertThisInitialized(e),"_decoderMode",window.WebAssembly?3:4),e}return _createClass$1(r,[{key:"wasmInitCost",get:function(){var e;return null===(e=this._decoderWorker)||void 0===e?void 0:e._wasmInitCost}},{key:"isHevc",get:function(){var e;return null===(e=this._parent)||void 0===e?void 0:e.isHevc}},{key:"_selectDecodeWorker",value:function(){this.analyse.addWasmInit();var e,t=getDecoderUrls(),r=t.H264_DECODER_URL,n=t.H265_DECODER_URL,i=t.H265_THREAD_DECODER_URL,a=t.H265_SIMD_DECODER_URL,o=t.ASM_H264_DECODER_URL,s=t.ASM_H265_DECODER_URL;return logger.log(this.TAG,"start init wasm worker:",performance.now(),"hevc:",this.isHevc,"decoderMode:",this._decoderMode),this.isHevc?(e=1===this._decoderMode?i:2===this._decoderMode?a:3===this._decoderMode?n:s)?{decoder:1===this._decoderMode?new WorkerWrapper$1:new WorkerWrapper$2,url:e}:void this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode)):(e=4===this._decoderMode?o:r)?{decoder:new WorkerWrapper,url:e}:void this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode))}},{key:"_initWorker",value:function(){this.isHevc&&(this._threadSupported&&(this._decoderMode=1),this._simdSuppported&&(this._decoderMode=2)),this._initDecodeWorkerInternal()}},{key:"_initDecodeWorkerInternal",value:function(){var e=decoderCache.getCachedDecoder(this.isHevc);if(e)return logger.warn(this.TAG,"select decoder from cache"),this.analyse.addWasmInit(),this._avccpushed=!1,this._bindWorkerEvent(e),this._decoderWorker=e,void(e.ready&&(this._decoderReady=!0,this._initDecoderWithConfiguration(e,this.meta),this._workerMessageCallback({type:"DECODER_READY",data:e}),logger.log(this.TAG,"decoder ready!")));var t=this._selectDecodeWorker()||{},r=t.decoder,n=t.url;r&&(this._avccpushed=!1,this._bindWorkerEvent(r),r.isHevc=this.isHevc,r.postMessage({msg:"init",meta:this.meta,batchDecodeCount:MAX_DECODE_ONCE_DEFAULT,url:n}),this._decoderWorker=r)}},{key:"_bindWorkerEvent",value:function(e){var t=this,r=function(r,n){logger.log(t.TAG,"worker failed: ",r,n),t._terminateWorker(e),t._decoderWorker=null,!1===getDecodeCapacaity().wasmFallbackToAsm||4===t._decoderMode?t._workerErrorCallback(r):(t._decoderMode=1===t._decoderMode||2===t._decoderMode?3:4,t._initDecodeWorkerInternal())};e._onMessage=function(n){var i,a;switch(n.data.msg){case"DECODER_READY":if(logger.log(t.TAG,"wasm worker ready!","cost:",n.data.cost),t._decoderReady=!0,e._wasmInitCost=parseInt(n.data.cost),!t.meta)return;t._avccpushed||t._initDecoderWithConfiguration(e,t.meta),t.emit(Events.VIDEO.VIDEO_DECODER_INIT,e),t._workerMessageCallback({type:"DECODER_READY",data:e});break;case"DECODED":if(t._inDecoding=!0,(null===(i=n.data)||void 0===i||null===(a=i.info)||void 0===a?void 0:a.id)!==t._id)return;t._workerMessageCallback({type:"RECEIVE_FRAME",data:n.data});break;case"BATCH_FINISH_FLAG":if(t._inDecoding=!1,!t._workerMessageCallback)return;t._workerMessageCallback({type:"BATCH_FINISH"});break;case"INIT_FAILED":r(n.data.log,1)}},e._onError=function(e){r(e.message,2)},e.addEventListener("message",e._onMessage),e.addEventListener("error",e._onError)}},{key:"_initDecoderWithConfiguration",value:function(e,t){logger.log(this.TAG,"init decoder with configuration"),this._avccpushed=!0,e.postMessage({msg:"updatemeta",meta:t});var r=[t.rawVps||t.vps[0],t.rawSps||t.sps[0],t.rawPps||t.pps[0]].filter(Boolean),n=r.reduce((function(e,t){return e+(t.byteLength+4)}),0),i=new Uint8Array(n),a=0;r.forEach((function(e){i.set([0,0,0,1],a),a+=4,i.set(e,a),a+=e.byteLength})),e.postMessage({msg:"initDecoder",data:i})}},{key:"destroy",value:function(){if(this._decoderWorker)return getDecodeCapacaity().reuseWasmDecoder?(this._offWorkerBind(this._decoderWorker),void decoderCache.cacheDecoder(this._decoderWorker)):void this._terminateWorker(this._decoderWorker)}},{key:"_offWorkerBind",value:function(e){e.removeEventListener("message",e._onMessage),e.removeEventListener("error",e._onError),e.postMessage({msg:"flush"}),e._onMessage=null,e._onError=null,logger.log(this.TAG,"flush decoder and unbind worker event")}},{key:"_terminateWorker",value:function(e){this._offWorkerBind(e),e.postMessage({msg:"destroy"}),e.terminate(),logger.log(this.TAG,"destroy decoder worker")}}]),r}(DecodeController),DECODER_ERROR_SUBCODE=1,WEBGL_ERROR_SUBCODE=2,VideoRenderWithDecoder=function(t){_inherits(n,t);var r=_createSuper(n);function n(){var t;_classCallCheck$1(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return _defineProperty$1(_assertThisInitialized(t=r.call.apply(r,[this].concat(a))),"TAG","VideoRenderWithDecoder"),_defineProperty$1(_assertThisInitialized(t),"_hideRenderFlag",0),_defineProperty$1(_assertThisInitialized(t),"_recentMeta",null),_defineProperty$1(_assertThisInitialized(t),"_inChaseFrame",!1),_defineProperty$1(_assertThisInitialized(t),"_decoderErrorCallback",(function(e){t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,t._assembleErr(e,DECODER_ERROR_SUBCODE))})),_defineProperty$1(_assertThisInitialized(t),"_decoderMessageCallback",(function(r){var n,i,a,o=r.type,s=r.data;switch(o){case"DECODER_READY":if(t.analyse.addWasmReady(),!t._frameRender){var l=Object.assign(t._config,{meta:t._meta,canvas:t._canvas,type:t._decodeController.webcodec?"2d":""});try{t._canvas.glInstance?(t._frameRender=t._canvas.glInstance,t._frameRender.updateBind(_assertThisInitialized(t),t._meta),logger.warn(t.TAG,"reuse canvas and context")):(t._frameRender=new FrameRender(l,_assertThisInitialized(t)),logger.log(t.TAG,"create frameRender with config",l))}catch(e){t._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,t._assembleErr(e&&e.message,WEBGL_ERROR_SUBCODE))}}t._startDecode();break;case"RECEIVE_FRAME":if(t._inChaseFrame&&(null===(n=t._decodeController)||void 0===n||!n.webcodec))return;t._receiveFrame(s);break;case"BATCH_FINISH":null===(i=_assertThisInitialized(t))||void 0===i||i._decodeEstimate.resetDecodeDot(),t._inChaseFrame&&(t._inChaseFrame=!1,t._frameQueue.empty()),t._ready||t.inSeeking||null===(a=t._decodeController)||void 0===a||!a.decoderReady||t._startDecode()}})),t}return _createClass$1(n,[{key:"wasmInitCost",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.wasmInitCost}},{key:"hevcThread",get:function(){return 1===this.decodeMode}},{key:"lowlatency",get:function(){return this._parent.lowlatency}},{key:"nextFrameTime",get:function(){var e=this._frameQueue.nextFrame();return(e&&e.info&&e.info.dts||0)/1e3}},{key:"ajustSeekTime",value:function(e,t){var r;logger.log(this.TAG,"ajust seek time: ",e),this._frameQueue.empty(),null===(r=this._decodeController)||void 0===r||r.flushDecoder(),this._switchVideoBuffer(e,t)}},{key:"canSeek",value:function(){return!0}},{key:"_appendChunk",value:function(e){var t;if(!this.noVideo&&this._timeRange){if(this._meta){if(this._recentMeta.width!==e.width||this._recentMeta.height!==e.height){logger.warn(this.TAG,"metadata changed! width: ".concat(this._recentMeta.width," -> ").concat(e.width,", height: ").concat(this._recentMeta.height," -> ").concat(e.height));var r=e.samples[0];r&&(this._recentMeta=r.meta=Object.assign({},e,{samples:null}))}}else{this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.LOADEDMETADATA),this._recentMeta=this._meta=Object.assign({},e,{samples:null}),logger.warn(this.TAG,"video set metadata",this._meta,"configuration:",this.configuration);var n=e.fpsNum/e.fpsDen;n?logger.log(this.TAG,"detect fps:",n):logger.warn(this.TAG,"no detect fps,start estimate"),this._selectDecoder(),this._initDecoder()}if(this._timeRange.append(e.samples,this._isLive&&this.noAudio,!this.videoDecode),e.samples=[],!this.inSeeking){var i;if(this.isLive||this._timeRange.frameLength||this._switchVideoBuffer(this._parent.currentTime),!this._ready&&null!==(t=this._decodeController)&&void 0!==t&&t.decoderReady)!this.noAudio&&null!==(i=this._decodeController)&&void 0!==i&&i.inDecoding||this._startDecode();this.noAudio&&this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.DURATION_CHANGE)}}}},{key:"_selectDecoder",value:function(){if(!this.isHevc&&WebCodecDecodeController.isSupported())return this._decodeController=new WebCodecDecodeController(this),void(this._decodeEstimate.webcodec=!0);this._decodeController=new WasmDecodeController(this)}},{key:"_initDecoder",value:function(){var e;null===(e=this._decodeController)||void 0===e||e.init(this._decoderMessageCallback,this._decoderErrorCallback)}},{key:"_startDecode",value:function(){var e;null===(e=this._decodeController)||void 0===e||e.doDecode()}},{key:"_switchVideoBuffer",value:function(e,t){var r=this._timeRange.switchBuffer(e);if(r){var n;if(this.noAudio&&this._parent.emit(Events.TIMELINE.SYNC_DTS,this.getDtsOfTime(r.start)),t)return void(null===(n=this._decodeController)||void 0===n||n.preciseSeek(e));this._startDecode(t)}}},{key:"_checkToDecode",value:function(){var e;this.inSeeking||null===(e=this._decodeController)||void 0===e||e.checkToDecode(this._frameQueue.length)}},{key:"_render",value:function(e){var t;if(!this.noVideo){var r=this._frameQueue&&this._frameQueue.nextFrame();if(r){var n=r.info;if(!n)return this._frameQueue.shift(),void console.error("not info");this._renderDts=n.dts;var i=n.dts-this.preciseVideoDts;if(!(!e&&i>0&&i<6e4)){this._frameQueue.shift(this.preciseVideoDts),Math.abs(this._lastTimeupdate-n.dts)>250&&(this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.TIMEUPDATE,{pts:n.originPts/90}),this._lastTimeupdate=n.dts),logger.long&&logger.log(this.TAG,"render delay:".concat(i," , timelinePosition:").concat(this.preciseVideoDts," , dts:").concat(n.dts," , cost:").concat(n.cost," , gopID:").concat(n.gopId," , rest:").concat(this._frameQueue.length,", buffer frame:").concat(this._timeRange.frameLength));var a=performance.now();this._hideRenderFlag++,("visible"===document.visibilityState||this._hideRenderFlag%15)&&this._frameRender.render(r.buffer,r.width,r.height,r.yLinesize,r.uvLinesize),null!==(t=this._decodeController)&&void 0!==t&&t.webcodec&&r.buffer.close(),this._renderCost=performance.now()-a,this._checkToDecode()}}else{var o;if(logger.log(this.TAG,"lack frame, ","inDecoding:",null===(o=this._decodeController)||void 0===o?void 0:o.inDecoding),this._checkToDecode(),this.noAudio){var s;if(!this.isLive&&Math.abs(this.currentTime-this.duration)<.5)return null==this||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.TIMEUPDATE),null==this||this._emitTimelineEvents(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ENDED),void(null===(s=this._timeRange)||void 0===s||s.clean());this._timeRange.frameLength||(this._ready=!1,this.emit(Events.VIDEO.VIDEO_WAITING))}}}}},{key:"_updateSegmentEnd",value:function(e){var t;null===(t=this._timeRange)||void 0===t||t.updateSegmentEnd(e)}},{key:"_doChaseFrame",value:function(e){var t=e.frame;this._inChaseFrame=!0,this._timeRange.deletePassed(t.dts),this._frameQueue.empty(),this.noAudio&&this._parent.emit(Events.TIMELINE.SYNC_DTS,t.dts)}},{key:"_destroy",value:function(e){var t;logger.log(this.TAG,"destroy video render"),_get(_getPrototypeOf(n.prototype),"destroy",this).call(this,e),null===(t=this._decodeController)||void 0===t||t.destroy(),this._decodeController=null}}]),n}(VideoBaseRender),TOLERANCE=.1,TimeLine=function(t){_inherits(n,t);var r=_createSuper(n);function n(e,t){var i;return _classCallCheck$1(this,n),(i=r.call(this)).TAG="TimeLine",i._parent=t,i._seeking=!1,i.audioRender=AudioMseRender.isSupported()?new AudioMseRender(e,_assertThisInitialized(i)):new AudioRender(e,_assertThisInitialized(i)),i.videoRender=new VideoRenderWithDecoder(e,_assertThisInitialized(i)),i._readyStatus={audio:!1,video:!1},i._paused=!0,i._switchToMultiWorker=!1,i._lowdecodeEmited=!1,i._startPlayed=!1,i._emitReady=!1,i._lastSeekTime=1e-4,i._singleTrack=-1,i._bindEvent(),i._decodeVideo=e.video,i}return _createClass$1(n,[{key:"analyse",get:function(){return this._parent.analyse}},{key:"ready",get:function(){return this._readyStatus.video&&this._readyStatus.audio}},{key:"played",get:function(){var e=this;return{length:this.currentTime?1:0,start:function(){return 0},end:function(){return e.currentTime}}}},{key:"noAudio",get:function(){return 1===this._singleTrack||2===this._singleTrack}},{key:"isLive",get:function(){return this._parent.live}},{key:"seeking",get:function(){return this._seeking}},{key:"decodeFps",get:function(){return this.videoRender.decodeFps}},{key:"decodeCost",get:function(){return this.videoRender.decodeCost}},{key:"renderCost",get:function(){return this.videoRender.renderCost}},{key:"wasmInitCost",get:function(){return this.videoRender.wasmInitCost}},{key:"fps",get:function(){return this.videoRender.fps}},{key:"totalSize",get:function(){return this.videoRender.totalSize}},{key:"bitrate",get:function(){return this.videoRender.bitrate}},{key:"gopLength",get:function(){return this.videoRender.gopLength}},{key:"currentTime",get:function(){return this.noAudio?this.paused?this.videoRender.nextFrameTime:this.videoRender.currentTime:this.audioRender.currentTime}},{key:"timelinePosition",get:function(){return this.noAudio?performance.now()/1e3:this.audioRender.currentTime}},{key:"canvas",get:function(){return this.videoRender.canvas}},{key:"readyState",get:function(){return this.videoRender.readyState}},{key:"buffered",get:function(){var e=this;return this.noAudio?this.videoRender.buffered:this.isLive?this.audioRender.buffered:{length:this.audioRender.buffered.length,start:function(t){return Math.max(e.audioRender.buffered.start(t),e.videoRender.buffered.start(t))},end:function(t){return Math.min(e.audioRender.buffered.end(t),e.videoRender.buffered.end(t))}}}},{key:"duration",get:function(){return this.noAudio?this.videoRender.duration:this.isLive?this.audioRender.duration:Math.min(this.audioRender.duration,this.videoRender.duration)}},{key:"paused",get:function(){return this._paused},set:function(e){this._paused=e}},{key:"lowlatency",get:function(){return this._parent.lowlatency}},{key:"decoderMode",get:function(){return this.videoRender.decoderMode}},{key:"currentAudioCanAutoplay",get:function(){return this.audioRender.audioCanAutoplay}},{key:"_getController",value:function(e,t){return e?new VideoRenderFromVideo(t,this):new VideoRenderWithDecoder(t,this)}},{key:"_checkInBuffer",value:function(){for(var e=this.buffered,t=0,r=e.length;t<r;t++)if(e.start(t)<=this.currentTime+TOLERANCE&&e.end(t)>=this.currentTime)return!0;return!1}},{key:"_resetReadyStatus",value:function(){this._readyStatus.audio=!1,this._readyStatus.video=!1}},{key:"_bindEvent",value:function(){var t=this;this.on(Events.DECODE_EVENTS.REMUX,(function(e){t.videoRender.setRemux(e)})),this.on(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME_END,(function(e){t.emit(Events.DECODE_EVENTS.CHASE_AUDIO_FRAME,e)})),this.audioRender.on(Events.AUDIO.AUDIO_READY,(function(){logger.log(t.TAG,"audio ready! seeking=",t._seeking),t._seeking&&setTimeout((function(){try{var r=t.videoRender.getSeekStartPosition(t.currentTime,1/0);if(t.audioRender.isMse&&r)return getDecodeCapacaity().preciseSeek>t.duration&&t.currentTime>TOLERANCE?(t.audioRender.seekNoSideEffect({position:t.currentTime+TOLERANCE}),void t.videoRender.ajustSeekTime(t.currentTime,!0)):(t.audioRender.seekNoSideEffect({position:r.position+TOLERANCE}),void t.videoRender.ajustSeekTime(r.position));t.videoRender.ajustSeekTime(t.currentTime)}catch(e){}}),10),t._readyStatus.video&&t._startRender(),t._readyStatus.audio=!0,t._startPlayed||t.analyse.addAudioReady()})),this.audioRender.on(Events.AUDIO.AUDIO_NOT_ALLOWED_AUTOPLAY,(function(){t._emitReady&&t.pause()})),this.audioRender.on(Events.AUDIO.AUDIO_WAITING,(function(){!t.noAudio&&t.currentTime&&(logger.warn(t.TAG,"lack data, audio waiting,currentTime:",t.currentTime),t.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.TIMEUPDATE),t.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.WAITING),t.emit(Events.TIMELINE.DO_PAUSE),t._readyStatus.audio=!1)})),this.videoRender.on(Events.VIDEO.VIDEO_WAITING,(function(){logger.warn(t.TAG,"lack data, video waiting"),t.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.WAITING),t.emit(Events.TIMELINE.DO_PAUSE),t._readyStatus.video=!1})),this.videoRender.on(Events.VIDEO.VIDEO_READY,(function(){logger.log(t.TAG,"video ready!"),t._startPlayed||t.analyse.addVideoReady(),t._readyStatus.audio&&t._startRender("video"),t._readyStatus.video=!0})),this.videoRender.on(Events.VIDEO.DECODE_LOW_FPS,(function(){t.currentTime<2||(t.analyse.increaseLowDecodeCount(),t._lowdecodeEmited||(updateLowdecodeVV(),t._lowdecodeEmited=!0),t.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.LOW_DECODE))})),this.on(Events.TIMELINE.SINGLE_TRACK,(function(e){t._singleTrack=e,1!==e&&2!==e||(t._readyStatus.audio=!0),3===e&&(t._readyStatus.video=!0),t.emit(Events.TIMELINE.SYNC_DTS,0)})),this.on(Events.TIMELINE.DESTROY,(function(){t.removeAllListeners(),t.videoRender=null,t.audioRender=null})),this.on(Events.TIMELINE.DO_PLAY,(function(){t.emit(Events.TIMELINE.START_RENDER),t._paused=!1,t._lastSeekTime=1e-4,t.noAudio&&t.emit(Events.TIMELINE.SYNC_DTS,0)}))}},{key:"_startRender",value:function(e){if(!this._parent.error&&this.videoRender){if(this.noAudio&&this.emit(Events.TIMELINE.SYNC_DTS,0),this.videoRender.forceRender(),!this.isLive&&this._paused&&this.seeking&&this._checkInBuffer())return logger.log(this.TAG,"set seeking = false"),this._seeking=!1,this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.SEEKED),void logger.groupEnd();this._startPlayed||(this.analyse.addFirstframe(),this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.LOADEDDATA),this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.FIRST_FRAME),this._startPlayed=!0),logger.log(this.TAG,"emit canplay"),this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.CANPLAY),this._parent.autoplay?(logger.warn(this.TAG,"startRender: time=",this.currentTime,"paused:",this.paused,"seeking:",this.seeking),this.emit(Events.TIMELINE.START_RENDER,e)):(this._parent.autoplay=!0,this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PAUSE)),this.emit(Events.TIMELINE.READY),this._emitReady=!0,this._seeking&&this._checkInBuffer()&&(logger.log(this.TAG,"set seeking = false"),this._seeking=!1,this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.SEEKED),logger.groupEnd())}}},{key:"_checkHlsTracks",value:function(e){if(!(null==e?void 0:e.samples[0])){if(!this.buffered.length){var t=new Error("lack video sample");t.code=3,this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,t)}return!1}return!0}},{key:"appendBuffer",value:function(e,t){this.emit(Events.TIMELINE.APPEND_CHUNKS,e,t),this.noAudio&&this._seeking&&this.videoRender.ajustSeekTime(this.currentTime)}},{key:"play",value:function(){var e=this;return new Promise((function(t,r){var n=e.currentAudioCanAutoplay;e.noAudio?n=!0:e.audioRender&&e.audioRender.resume().then((function(){if(logger.log(e.TAG,"audio render resumed, pause status: ".concat(e._paused,", audioCanAutoplay:").concat(e.currentAudioCanAutoplay)),e._paused||!e.currentAudioCanAutoplay)return n=!1,void e.emit(Events.TIMELINE.DO_PAUSE);n=!0})).catch((function(){})),setTimeout((function(){return logger.log(e.TAG,"play() timer done, resumed=".concat(n,", paused=").concat(e.paused)),n?e.videoRender&&!e.videoRender.canAutoPlay?(console.warn("video render an't autoplay"),e.pause(),void t()):(e._paused=!1,void t()):e.paused?void 0:(logger.log(e.TAG,"audioCtx can't autoplay"),e.pause(),void r({name:"NotAllowedError"}))}),e.audioRender.isMse?10:60)}))}},{key:"pause",value:function(){this._paused||!this.ready&&!this._seeking||(this.emit(Events.TIMELINE.DO_PAUSE),this._paused=!0,this.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.PAUSE))}},{key:"seek",value:function(e){var t=this;if(this._seeking&&logger.groupEnd(),this.isLive){if(this.currentTime<TOLERANCE||!this.currentAudioCanAutoplay||this.paused)return;var r=this.videoRender.getSeekStartPosition(e,this._parent.preloadTime+1);if(r){if(r.position<this.currentTime)return;var n=this.audioRender.canSeek(r.position),i=this.videoRender.canSeek(r);if(!n||!i)return void logger.log(this.TAG,"seek, !!!!!!!!!can not seek, audioCanSeek:",n,"videoCanSeek:",i);logger.warn(this.TAG,"seek, chase frame to time: ",r.position,"currentTime:",this.currentTime,"duration:",this.duration),this.videoRender.videoDecode?(this.audioRender.doPause(),r.position=r.position-1.5,this.emit(Events.DECODE_EVENTS.CHASE_VIDEO_FRAME,r)):this.emit(Events.TIMELINE.CHASE_FRAME,r)}}else this._lastSeekTime!==e&&(e&&Math.abs(this._lastSeekTime-e)<=.2||(this._lastSeekTime=e,e>=this.duration&&(e=this.duration-1),e<0&&(e=0),logger.group(this.TAG,"start seek to:".concat(e,", set seeking status=true")),this._seeking=!0,this.videoRender.setSeekingStatus(!0),this.noAudio?(this.emit(Events.TIMELINE.SYNC_DTS,this.videoRender.getDtsOfTime(e)),this.videoRender.ajustSeekTime(e)):this._resetReadyStatus(),this.emit(Events.TIMELINE.DO_SEEK,e),new Promise((function(e){t.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.SEEKING),e()}))))}}]),n}(EventEmitter$1),$=_export$1,$entries=objectToArray$1.entries;$({target:"Object",stat:!0},{entries:function(e){return $entries(e)}});var AnalyseDots={FIRST_DATA:1,AUDIO_MSE_OPEN_START:2,AUDIO_MSE_OPEND:3,AUDIO_FIRSTTIME_APPENDED:4,AUDIO_READY:5,WASM_WORKER_INIT:6,WASM_WORKER_READY:7,FIRST_FRAME_TODECODE:8,VIDEO_READY:9,FIRST_FRAME:10,WAITIGN:11,SEEKING:12,SEEKED:13},AnalyseDotsFlat=Object.entries(AnalyseDots),Analyse=function(){function e(){_classCallCheck$1(this,e),_defineProperty$1(this,"_dot",[]),_defineProperty$1(this,"_currentLowDecodeCount",0)}return _createClass$1(e,[{key:"getBootStats",value:function(){var e,t=(null===(e=this._dot[0])||void 0===e?void 0:e.dot)||0;return this._dot.map((function(e){return{action:AnalyseDotsFlat.filter((function(t){return t[1]===e.action}))[0][1],dot:parseInt(e.dot-t)}}))}},{key:"getStats",value:function(e){var t,r=this.getBootStats();return{bootStats:r,bitrate:Math.abs(e.bitrate/1e3),decodeFps:e.decodeFps,fps:e.fps,playbackRate:e.playbackRate,firstframe:null===(t=r.filter((function(e){return 10===e.action}))[0])||void 0===t?void 0:t.dot,width:e.videoWidth,height:e.videoHeight,decoderMode:e.decoderMode,vv:getVV(),lowdecodeVV:getLowdecodeVV(),h265FailureRate:Number((100*getLowdecodePercent()).toFixed(2)),currentLowDecodeCount:this._currentLowDecodeCount}}},{key:"seekElapses",value:function(){for(var e=this.getBootStats(),t=[],r=0,n=0,i=e.length;n<i;n++){var a=e[n];a.action===AnalyseDots.SEEKING&&(r=a.dot),a.action===AnalyseDots.SEEKED&&t.push(a.dot-r)}return t}},{key:"addFirstData",value:function(){this._dot.push({action:AnalyseDots.FIRST_DATA,dot:this._getTimestap()})}},{key:"addAudioBoundMedia",value:function(){this._dot.push({action:AnalyseDots.AUDIO_BOUND_MEDIA,dot:this._getTimestap()})}},{key:"addAudioMseOpenStart",value:function(){this._dot.push({action:AnalyseDots.AUDIO_MSE_OPEN_START,dot:this._getTimestap()})}},{key:"addAudioMseOpend",value:function(){this._dot.push({action:AnalyseDots.AUDIO_MSE_OPEND,dot:this._getTimestap()})}},{key:"addAudioFirstTimeAppended",value:function(){this._dot.push({action:AnalyseDots.AUDIO_FIRSTTIME_APPENDED,dot:this._getTimestap()})}},{key:"addAudioReady",value:function(){this._dot.push({action:AnalyseDots.AUDIO_READY,dot:this._getTimestap()})}},{key:"addWasmInit",value:function(){this._dot.push({action:AnalyseDots.WASM_WORKER_INIT,dot:this._getTimestap()})}},{key:"addWasmReady",value:function(){this._dot.push({action:AnalyseDots.WASM_WORKER_READY,dot:this._getTimestap()})}},{key:"addFirstFrameToDecode",value:function(){this._dot.push({action:AnalyseDots.FIRST_FRAME_TODECODE,dot:this._getTimestap()})}},{key:"addVideoReady",value:function(){this._dot.push({action:AnalyseDots.VIDEO_READY,dot:this._getTimestap()})}},{key:"addFirstframe",value:function(){this._dot.push({action:AnalyseDots.FIRST_FRAME,dot:this._getTimestap()})}},{key:"addWaiting",value:function(){this._dot.push({action:AnalyseDots.WAITIGN,dot:this._getTimestap()})}},{key:"addSeeking",value:function(){this._dot.push({action:AnalyseDots.SEEKING,dot:this._getTimestap()})}},{key:"addSeeked",value:function(){this._dot.push({action:AnalyseDots.SEEKED,dot:this._getTimestap()})}},{key:"_getTimestap",value:function(){return performance.now()}},{key:"increaseLowDecodeCount",value:function(){this._currentLowDecodeCount++}},{key:"reset",value:function(){this._currentLowDecodeCount=0,this._dot=[]}}]),e}(),VIDEO_DECODE_MODE_VALUE="7",SINGLE_TRACK_TYPE={LOW_LATENCY:1,NO_AUDIO:2,NO_VIDEO:3},Parent="undefined"!=typeof HTMLElement?HTMLElement:function(){},XGVideo=function(t){_inherits(n,t);var r=_createSuper(n);function n(){var e;return _classCallCheck$1(this,n),(e=r.call(this)).TAG="XGVideo",e._proxyProps(),e._isLive=!0,e._vMeta=null,e._aMeta=null,e._resizeObserver=null,e._eventsBackup=[],e._hevc="h265"===getDecodeCapacaity().preloadDecoder,e._hevc||(e._degradeVideo=document.createElement("video")),e._debounceSeek=debounce(e._seek.bind(_assertThisInitialized(e)),300),e._onTouchEnd=e._onTouchEnd.bind(_assertThisInitialized(e)),e.analyse=new Analyse,e}return _createClass$1(n,[{key:"_proxyProps",value:function(){var t=this;Object.getOwnPropertyNames(n.prototype).forEach((function(r){if(/^__/.test(r)){var n=r.replace("__","");Object.defineProperty(t,n,{get:function(){try{return this[r]}catch(e){}return 0},set:function(t){try{this[r]=t}catch(e){}}})}}))}},{key:"addEventListener",value:function(e,t,r){_get(_getPrototypeOf(n.prototype),"addEventListener",this).call(this,e,t,r),this._degradeVideo&&this._eventsBackup.push([e,t,r])}},{key:"removeEventListener",value:function(e,t,r){_get(_getPrototypeOf(n.prototype),"removeEventListener",this).call(this,e,t,r),this._degradeVideo&&(this._eventsBackup=this._eventsBackup.filter((function(n){return!(n.eventName===e&&n.handler===t&&n.capture===r)})))}},{key:"setAttribute",value:function(e,t){var r;_get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,e,t),"src"!==e&&(null===(r=this._degradeVideo)||void 0===r||r.setAttribute(e,t))}},{key:"_init",value:function(){this.analyse.reset(),this.timeline=new TimeLine({volume:this.volume,canvas:this.querySelector("canvas"),videoContext:this.videoContext,videoDecode:this.videoDecode,maxVideoHeight:this.getAttribute("maxVideoHeight"),endLevel:parseInt(this.getAttribute("endLevel"))},this),logger.log(this.TAG,"timeline init"),this._noSleep=new NoSleep,this._logFirstFrame=!1,this._playRequest=null,this._degradeVideoUserGestured=!1,this._bindEvents(),this._vMeta&&!this.videoDecode&&this.setVideoMeta(this._vMeta),this._glCtxOptions&&(this.glCtxOptions=this._glCtxOptions),this.timeline&&(this.innerDegrade&&this.timeline.emit(Events.TIMELINE.INNER_DEGRADE),this.timeline.emit(Events.TIMELINE.SET_PLAY_MODE,this._isLive?"LIVE":"VOD"),this.timeline.emit(Events.TIMELINE.SET_PLAYBACKRATE,this.playbackRate),this.muted=this.muted)}},{key:"_bindEvents",value:function(){var e=this;this.timeline.on(Events.TIMELINE.PLAY_EVENT,(function(t,r){var n;t===VIDEO_EVENTS.LOADEDDATA&&(e.querySelector("canvas")||(logger.log(e.TAG,"_bindEvents, appendChild canvas"),e.appendChild(e.canvas)),e.canvas.style.display="block",null===(n=e.timeline)||void 0===n||n.emit(Events.TIMELINE.SET_PLAYBACKRATE,e.playbackRate));if(t!==VIDEO_EVENTS.LOADEDMETADATA&&t!==VIDEO_EVENTS.RESIZE||Promise.resolve().then((function(){e.updateVideoPostion()})),t===VIDEO_EVENTS.ERROR){if(logger.warn(e.TAG,"detect error:",null==r?void 0:r.message),e.pause(),e._disabled(!0),e.innerDegrade||5===e.decoderMode)return e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,msg:null==r?void 0:r.message,decoderMode:e.decoderMode},void e._innerDispatchEvent("lowdecode");e._err=r}if(t===VIDEO_EVENTS.LOW_DECODE)return e._disabled(),e.degradeInfo={decodeFps:e.decodeFps,bitrate:e.bitrate,wasmInitCost:e.wasmInitCost,fps:e.fps,url:e.src,decoderMode:e.decoderMode},void e._innerDispatchEvent(VIDEO_EVENTS_ARR[t],e.degradeInfo);if(t===VIDEO_EVENTS.LARGE_AV_GAP&&(e.unsyncInfo=r),t===VIDEO_EVENTS.ENDED){if(e.paused)return;e.pause()}t===VIDEO_EVENTS.PROGRESS&&e._noSleep.toPlay(),t===VIDEO_EVENTS.WAITING&&e.analyse.addWaiting(),t===VIDEO_EVENTS.SEEKING&&e.analyse.addSeeking(),t===VIDEO_EVENTS.SEEKED&&e.analyse.addSeeked(),e._innerDispatchEvent(VIDEO_EVENTS_ARR[t],r)}))}},{key:"_disabled",value:function(e){(this.innerDegrade||e)&&(e?getDecodeCapacaity().disabledWhenErrorOccur&&persistenceDisabledStatus(1):getDecodeCapacaity().evaluateVVCount||(this.decodeFps/this.fps<=.6&&this.bitrate<2e6?persistenceDisabledStatus(1):persistenceDisabledStatus(2)))}},{key:"degrade",value:function(e){var t=this;!!this.querySelector("canvas")?this.replaceChild(this._degradeVideo,this.canvas):this.appendChild(this._degradeVideo),this.destroy(),this._eventsBackup.forEach((function(e){var r,i=_slicedToArray$1(e,3),a=i[0],o=i[1],s=i[2];_get(_getPrototypeOf(n.prototype),"removeEventListener",t).call(t,a,o,s),null===(r=t._degradeVideo)||void 0===r||r.addEventListener(a,o,s)})),this._eventsBackup=[],e&&(this._degradeVideo.muted=!1,this._degradeVideo.src=e,this._degradeVideo.load())}},{key:"disconnectedCallback",value:function(){logger.log(this.TAG,"video disconnected"),document.removeEventListener("touchend",this._onTouchEnd,!0),this.destroy(!0),this._resizeObserver&&this._resizeObserver.disconnect(this)}},{key:"connectedCallback",value:function(){var e=this;logger.log(this.TAG,"video connected to document",performance.now()),this.timeline||this._init(),this.style.width="100%",this.style.height="100%",this.style.position="absolute",this.style.left="0px",this.style.top="0px",document.addEventListener("touchend",this._onTouchEnd,!0),ResizeObserver&&(this._resizeObserver=new ResizeObserver((function(t){var r;null!==(r=e.timeline)&&void 0!==r&&r.ready&&e.updateVideoPostion()})),this._resizeObserver.observe(this))}},{key:"_onTouchEnd",value:function(){playSlienceAudio(),this._degradeVideoInteract(),this._noSleep&&this._noSleep.enable()}},{key:"_degradeVideoInteract",value:function(){var e=this;if(this._degradeVideo&&(1===this.innerDegrade||3===this.innerDegrade)){if(this._degradeVideoUserGestured)return;var t=this._degradeVideo.play();t&&t.then((function(){e._degradeVideo.pause(),e._degradeVideoUserGestured=!0})).catch((function(e){console.log("degrade video: ",e.message)}))}}},{key:"play",value:function(t){var r=this;if(this.timeline){logger.log(this.TAG,"play() called, ready:".concat(this.timeline.ready,", paused:").concat(this.timeline.paused,", force:").concat(t)),this._degradeVideoInteract();var n=0;if(this.timeline.ready&&this.timeline.paused||t){if(t=t||this._isLive,this._playRequest=null,!t)return this.timeline.emit(Events.TIMELINE.DO_PLAY),this._innerDispatchEvent("play"),Promise.resolve();this.destroy(),this._init(),n=setTimeout((function(){try{r._innerDispatchEvent("waiting")}catch(e){}}),300)}return this._playRequest||!this.timeline.ready||this.timeline.paused?(logger.log(this.TAG,"request play!"),this._playRequest=this._playRequest||new Promise((function(e,t){r.timeline._paused=!1,r._innerDispatchEvent("play"),r._noSleep.enable(),r.timeline.once("ready",(function(){logger.log(r.TAG,"timeline emit ready"),clearTimeout(n),r.timeline.play().then(e).catch(t).finally((function(){r._playRequest=null}))}))})),this.autoplay=!0,this._playRequest):Promise.resolve()}}},{key:"pause",value:function(){this._playRequest=null,this.timeline&&this.timeline.pause();try{this._noSleep.disable(),pauseSlienceAudio()}catch(e){}}},{key:"load",value:function(){}},{key:"appendBuffer",value:function(e,t){if(this.timeline&&!this._err){if(!this._logFirstFrame){var r=e&&e.samples[0],n=t&&t.samples[0];if(!r&&!n)return;if(r||n){var i=(null==e?void 0:e.duration)/((null==e?void 0:e.formatTimescale)||1/0),a=(null==t?void 0:t.duration)/((null==t?void 0:t.formatTimescale)||1/0);logger.warn(this.TAG,"video firstDts:".concat(r&&r.dts," , audio firstDts:").concat(n&&n.dts," videoTrack.duration=").concat(i,", audioTrack.duration=").concat(a)),this._logFirstFrame=!0,(i||a)&&(this.setPlayMode("VOD"),this.timeline.emit(Events.TIMELINE.SET_PLAY_MODE,this._isLive?"LIVE":"VOD"),this.duration=Math.min(i||a,a||i)),this.analyse.addFirstData()}this.lowlatency&&(logger.warn(this.TAG,"single track! type=",SINGLE_TRACK_TYPE.LOW_LATENCY),this.timeline.emit(Events.TIMELINE.SINGLE_TRACK,SINGLE_TRACK_TYPE.LOW_LATENCY)),t.exist()||(logger.warn(this.TAG,"single track! type=",SINGLE_TRACK_TYPE.NO_AUDIO),this.timeline.emit(Events.TIMELINE.SINGLE_TRACK,SINGLE_TRACK_TYPE.NO_AUDIO)),e.exist()||(logger.warn(this.TAG,"single track! type=",SINGLE_TRACK_TYPE.NO_VIDEO),this.timeline.emit(Events.TIMELINE.SINGLE_TRACK,SINGLE_TRACK_TYPE.NO_VIDEO))}e.formatTimescale&&e.samples.forEach((function(t){t.dts=Math.floor(t.dts/e.formatTimescale*1e3),t.pts=Math.floor(t.pts/e.formatTimescale*1e3)})),t.formatTimescale&&t.samples.forEach((function(e){e.dts=Math.floor(e.dts/t.formatTimescale*1e3),e.pts=Math.floor(e.pts/t.formatTimescale*1e3)})),this.timeline.appendBuffer(e,t)}}},{key:"setAudioMeta",value:function(e){this._aMeta=e,this.timeline.emit(Events.TIMELINE.SET_METADATA,"audio",e)}},{key:"setVideoMeta",value:function(e){!this._isLive&&this._vMeta||(this.timeline.emit(Events.TIMELINE.SET_METADATA,"video",e),this._vMeta=e)}},{key:"setDecodeMode",value:function(e){this.setAttribute("decodeMode",e)}},{key:"setPlayMode",value:function(e){this._isLive="LIVE"===e}},{key:"endOfStream",value:function(){var e;this.currentTime&&(null===(e=this.timeline)||void 0===e||e.emit(Events.TIMELINE.END_OF_STREAM))}},{key:"updateVideoPostion",value:function(){var e;null===(e=this.timeline)||void 0===e||e.emit(Events.VIDEO.UPDATE_VIDEO_FILLTYPE,this.xgfillType,this.containerLayout)}},{key:"_innerDispatchEvent",value:function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))}},{key:"destroy",value:function(e){this.timeline&&(this._noSleep.destroy(),logger.log(this.TAG,"call destroy"),this.timeline.emit(Events.TIMELINE.DESTROY,e),this.querySelector("video")&&this.removeChild(this.querySelector("video")),this.timeline=null,this._err=null,this._noSleep=null,this._eventsBackup=null)}},{key:"updateObjectPosition",value:function(e,t){this.timeline.emit(Events.VIDEO.UPDATE_VIDEO_COVER_POSITION,this.containerLayout,e,t),this._degradeVideo&&(this._degradeVideo.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%"))}},{key:"setVideoDecode",value:function(){logger.log(this.TAG,"set videoDecode",this.videoDecode),this.videoDecode&&this.timeline&&this.timeline.videoRender&&(this.timeline.videoRender.videoDecode=this.videoDecode)}},{key:"live",get:function(){return this._isLive}},{key:"lowlatency",get:function(){return"true"===this.getAttribute("lowlatency")},set:function(e){this.setAttribute("lowlatency",e)}},{key:"autoplay",get:function(){return"true"===this.getAttribute("autoplay")},set:function(e){this.setAttribute("autoplay",e)}},{key:"__canvas",get:function(){return this.timeline.canvas}},{key:"__ended",get:function(){return Math.abs(this.currentTime-this.duration)<.5}},{key:"__width",get:function(){return this.getAttribute("width")||this.videoWidth},set:function(e){var t="number"==typeof e?"".concat(e,"px"):e;this.setAttribute("width",t),this.canvas.width=e}},{key:"__height",get:function(){return this.getAttribute("height")},set:function(e){var t="number"==typeof e?"".concat(e,"px"):e;this.setAttribute("height",t),this.canvas.height=e}},{key:"__videoWidth",get:function(){return this.canvas.width}},{key:"__videoHeight",get:function(){return this.canvas.height}},{key:"__volume",get:function(){return Number(this.getAttribute("volume"))},set:function(e){e<=0&&(e=0),e>=1&&(e=1),this.setAttribute("volume",e),this.muted||this.timeline.emit(Events.TIMELINE.UPDATE_VOLUME,e)}},{key:"__muted",get:function(){return"true"===this.getAttribute("muted")},set:function(e){this.setAttribute("muted",e),this._degradeVideoInteract(),this._noSleep.enable(),this.timeline.emit(Events.TIMELINE.UPDATE_VOLUME,e?0:this.volume)}},{key:"__currentTime",get:function(){if(!this.timeline)return 0;var e=this.timeline.currentTime,t=this.timeline.duration;return Math.min(e,t)},set:function(e){this._debounceSeek(e)}},{key:"_seek",value:function(e){this.timeline&&(this.buffered.length||this.play(),this.paused&&!this._isLive&&0===e&&this.play(),this.timeline.seek(Number(e)))}},{key:"__duration",get:function(){return this._isLive?1/0:this.timeline.duration},set:function(e){this.timeline.emit(Events.TIMELINE.SET_VIDEO_DURATION,e),this._innerDispatchEvent("durationchange")}},{key:"__seeking",get:function(){return this.timeline.seeking}},{key:"__paused",get:function(){return this.timeline.paused}},{key:"__fps",get:function(){return this.timeline.fps}},{key:"__decodeFps",get:function(){return this.timeline.decodeFps}},{key:"__decodeCost",get:function(){return parseInt(this.timeline.decodeCost)}},{key:"__renderCost",get:function(){return this.timeline.renderCost}},{key:"__wasmInitCost",get:function(){return this.timeline.wasmInitCost}},{key:"__totalSize",get:function(){return this.timeline.totalSize}},{key:"__bitrate",get:function(){return this.timeline.bitrate}},{key:"__gopLength",get:function(){return this.timeline.gopLength}},{key:"__readyState",get:function(){return this.timeline.readyState}},{key:"__buffered",get:function(){return this.timeline.buffered}},{key:"__decoderMode",get:function(){return this.timeline.decoderMode}},{key:"src",get:function(){return this.getAttribute("src")||""},set:function(e){logger.log(this.TAG,"set src ",e),this.setAttribute("src",e),this._vMeta=null,this.play(!0),this.timeline||this._init(),this._innerDispatchEvent("loadstart"),updateVV()}},{key:"currentSrc",get:function(){return this.getAttribute("src")||""}},{key:"playbackRate",get:function(){return parseFloat(this.getAttribute("playbackrate")||1)},set:function(e){var t;this.setAttribute("playbackrate",e),null===(t=this.timeline)||void 0===t||t.emit(Events.TIMELINE.SET_PLAYBACKRATE,e)}},{key:"networkState",get:function(){return 1}},{key:"preloadTime",get:function(){var e=this.getAttribute("preloadtime");if(e){var t=Number.parseFloat(e);if(t>0&&!Number.isNaN(t))return t}return 1/0},set:function(e){e&&Number(e)>0&&this.setAttribute("preloadtime",e)}},{key:"innerDegrade",get:function(){var e=this.getAttribute("innerdegrade");return parseInt(e)}},{key:"__glCtxOptions",set:function(e){this._glCtxOptions=e,this.timeline.emit(Events.TIMELINE.UPDATE_GL_OPTIONS,e)}},{key:"__error",get:function(){return this._err},set:function(e){this.timeline.emit(Events.TIMELINE.PLAY_EVENT,VIDEO_EVENTS.ERROR,e)}},{key:"degradeVideo",get:function(){return this._degradeVideo}},{key:"degradeInfo",get:function(){return this._deradeInfo},set:function(e){this._deradeInfo=e}},{key:"unsyncInfo",get:function(){return this._unsyncInfo},set:function(e){this._unsyncInfo=e}},{key:"xgfillType",get:function(){return this.parentNode.getAttribute("data-xgfill")}},{key:"containerLayout",get:function(){var e=this.parentNode;return{width:e.clientWidth,height:e.clientHeight}}},{key:"videoDecode",get:function(){return this.getAttribute("decodeMode")===VIDEO_DECODE_MODE_VALUE}},{key:"audioMedia",get:function(){var e,t;return null===(e=this.timeline)||void 0===e||null===(t=e.audioRender)||void 0===t?void 0:t.media}},{key:"getStats",value:function(){return this.analyse.getStats(this)}},{key:"getSeekElapses",value:function(){return this.analyse.seekElapses()}},{key:"dump",value:function(){var e=this.buffered;return console.log(e),new Array(e.length).fill(0).map((function(t,r){return[e.start(r),e.end(r)]}))}}],[{key:"version",get:function(){return"0.1.15"}},{key:"init",value:function(e){var t=e.h264Url,r=e.h264AsmUrl,i=e.h265AsmUrl,a=e.h265Url,o=e.h265ThreadUrl,s=e.h265SimdUrl;n.h264Url=t,n.h265Url=a,n.h265AsmUrl=i,n.h264AsmUrl=r,n.h265ThreadUrl=o,n.h265SimdUrl=s}},{key:"getDecodeCapacity",value:function(){return getDecodeCapacaity()}},{key:"getDeviceCapacity",value:function(){return getDeviceCapacity()}},{key:"setDecodeCapacity",value:function(e){setDecodeCapacity(e),e.preloadDecoder&&decoderCache.genDecoder().catch((function(){}))}},{key:"genDecoder",value:function(e){return decoderCache.genDecoder(e)}},{key:"cleanDisabled",value:function(){cleanDisabledStatus()}},{key:"isSupported",value:function(){return!!softDecodeSupported()&&!1===getDisabledStatus()}}]),n}(Parent);_defineProperty$1(XGVideo,"decoderCache",decoderCache);var H264_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/decoder/1.1.1/h264/decoder.js",ASM_H264_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/decoder/1.1.1/h264/decoder_asm.js",H265_SIMD_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/codec/high/decoder_1656041798666.js",H265_THREAD_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/codec/main/decoder.js",H265_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/codec/base/decoder.js",ASM_H265_DECODER_URL="https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/codec/high/decoder_asm.js";XGVideo.init({h264Url:H264_DECODER_URL,h264AsmUrl:ASM_H264_DECODER_URL,h265Url:H265_DECODER_URL,h265SimdUrl:H265_SIMD_DECODER_URL,h265ThreadUrl:H265_THREAD_DECODER_URL,h265AsmUrl:ASM_H265_DECODER_URL}),XGVideo.setEleName=function(e){setEleName(e);var t=function(e){_inherits(r,e);var t=_createSuper(r);function r(){return _classCallCheck$1(this,r),t.apply(this,arguments)}return _createClass$1(r)}(XGVideo);customElements.get(getEleName())||customElements.define(getEleName(),t)};try{customElements.get(getEleName())||customElements.define(getEleName(),XGVideo)}catch(e){}var defaultExtendLang=[{LANG:"en",TEXT:{GET_URL_ERR_BY_TOKEN:"Failed to get video url",PLAY_AUTH_TOKEN_EXPIRED:"Token has expired",HLS_KEY_TOKEN_EXPIRED:"Play certificate has expired"}},{LANG:"zh",TEXT:{GET_URL_ERR_BY_TOKEN:"",PLAY_AUTH_TOKEN_EXPIRED:"token",HLS_KEY_TOKEN_EXPIRED:""}},{LANG:"zh-hk",TEXT:{GET_URL_ERR_BY_TOKEN:"",PLAY_AUTH_TOKEN_EXPIRED:"Token",HLS_KEY_TOKEN_EXPIRED:""}},{LANG:"jp",TEXT:{GET_URL_ERR_BY_TOKEN:" URL ",PLAY_AUTH_TOKEN_EXPIRED:"playAuthToken",HLS_KEY_TOKEN_EXPIRED:""}}],index_min="",VePlayer=function(){function e(t){return _classCallCheck$j(this,e),this.player=null,this.mountingDom=null,this.playerContainer=null,this.mobilePanel=null,this._isFirstCreated=!0,this.sdkPlugins=[],this._sdkPlugins={},this.delayError=[],this.isFirstEmitted=!0,this._init(t),new Proxy(this,{get:function(e,t,r){var n;return"string"==typeof t&&["playerData","player","mountingDom","playerContainer","mobilePanel","_emitter","isFirstCreated"].includes(t)?Reflect.get(e,t,r):null!==(n=Reflect.get(e,t,r))&&void 0!==n?n:Reflect.get(e.getPlayerInstance(),t,r)}})}var t,r,n,i,a,o;return _createClass$k(e,[{key:"_init",value:function(e){this.playerData=new PlayerData(e),this._emitter=new EventEmitter$1,this.on(SDKEvents.TOKEN_EXPIRED,this.onTokenExpiredAction.bind(this)),this.initCheckExpire(),this._initSdkPlugins(),this.renderDom(),this.createPlayer(),this._initI18N(this.playerData.languageData)}},{key:"_initSdkPlugins",value:function(){var e=this;sdkPluginManager.init(this),_toConsumableArray$a(this.sdkPlugins).map((function(t){return sdkPluginManager.registerPlugin(t,e)}))}},{key:"initCheckExpire",value:function(){var e=this;this.checkExpireTimer=new IntervalTimer$2,this.checkExpireTimer.repeat((function(){e.onRepeat()}),this.playerData.checkExpireInterval)}},{key:"onRepeat",value:function(){var e,t=this,r=this.playerData.expireDetectType;r.indexOf("getUrlTime")>-1&&(this.getUrlTime&&null!==(e=this.player)&&void 0!==e&&e.duration&&(new Date).getTime()/1e3>this.getUrlTime+3300+this.player.duration+500&&(this.getUrlTime=0,this.emitExpireEvent()));r.indexOf("xhrStatus")>-1&&this._playOriginalUrl&&Math.random()<1/7.5&&new XHR$2({url:this._playOriginalUrl,method:"HEAD"}).catch((function(e){e&&void 0!==e.status&&(t.isFirstEmitted?(t.emitExpireEvent(),t.isFirstEmitted=!1):(t.expireCount=void 0===t.expireCount?1:t.expireCount+1,t.expireCount>3&&(t.expireCount=0,t.emitExpireEvent())))}))}},{key:"emitExpireEvent",value:function(){var e=this.player,t=(new Date).getTime()/1e3;e.emitExpireTimestamp?t-e.emitExpireTimestamp>MIN_EXPIRE_INTERVAL$1&&(e.emitExpireTimestamp=t,e.emit("MEDIA_EXPIRED")):(e.emitExpireTimestamp=t,e.emit("MEDIA_EXPIRED"))}},{key:"getUrlTimestamp",value:function(e){if(e){var t;e.startsWith("//")&&(e=location.protocol+e);try{var r,n=_createForOfIteratorHelper$5(new URL(e).searchParams);try{for(n.s();!(r=n.n()).done;){var i=_slicedToArray$7(r.value,2),a=i[0],o=i[1];if("auth_key"===a||"sign"===a){var s=parseInt(o.split("-")[0]);if(!isNaN(s)){t=s;break}}}}catch(d){n.e(d)}finally{n.f()}}catch(d){console.error(d)}try{var l,u=null===(l=new URL(e).pathname.split("/"))||void 0===l?void 0:l[2];if(u){var c=parseInt(u,16);isNaN(c)||(t=c)}}catch(d){console.error(d)}this.getUrlTime=t||(new Date).getTime()/1e3}}},{key:"on",value:function(e,t){this._emitter.on(e,t)}},{key:"emit",value:function(e,t){this._emitter.emit(e,t)}},{key:"once",value:function(e,t){this._emitter.once(e,t)}},{key:"off",value:function(e,t){this._emitter.off(e,t)}},{key:"renderDom",value:function(){var e=this.playerData,t=e.id,r=e.root,n=document.createElement("div");this.playerContainer=n;var i=r||document.querySelector("#".concat(t));i&&(i.appendChild(n),this.mountingDom=i)}},{key:"renderPoster",value:function(){if(this.playerContainer){var e=this.playerData.options,t=e.poster,r=void 0===t?"":t,n=e.width,i=e.height;r&&(this.playerContainer.style.cssText='background: url("'.concat(r,'");\n    background-size: cover;\n    width:').concat(n?n+"px":"100%",";\n    height:").concat(i?i+"px":"100%",";\n    "))}}},{key:"createPlayer",value:(o=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(){var t,r,n,i,a,o,s,l,u,c,d,h,f,p,y,m,g,v,b,_,E,T,S,$,A,w,k,I,C;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._destroyPlayer();case 2:return e.next=4,this.beforePlayerCreate();case 4:return a=this.playerData,o=a.isLive,s=a.options,l=a.plugins,u=a.isMobile,c=a.openSoftDecoding,d=a.configs,h=this.playerData.getCurrentUrl(),f=this.playerData.getCurrentStreamType()||getFormat(null==d?void 0:d.getVideoByToken),(p=getPluginConfig(d,"EncryptHlsPlugin"))||h&&f?(this._playOriginalUrl=h,this.getUrlTimestamp(h)):(console.warn("url is empty or streamType is empty: url:".concat(h,", streamType").concat(f)),this.renderPoster()),y={defaultDefinition:null===(t=this.playerData.playList[0])||void 0===t?void 0:t.definition,list:this.playerData.playList},m=createSDKPreset(o,f,u,this.playerData.openSoftDecoding,this.playerData),g=u?createPlayerOption(o):createPlayerOption$1(o),e.next=14,this.getSoftDecodingOption(c,h,f);case 14:return v=e.sent,b=this._analyzeExtendPlugins(),_=b.basicPlugins,E=void 0===_?[]:_,T=b.iconPlugins,S=void 0===T?[]:T,$=this.playerData.getLineList(),A=this.playerData.current.lineId,w=this.playerData.getDefinitionListByLineId(A),k=_objectSpread2$c(_objectSpread2$c(_objectSpread2$c(_objectSpread2$c({},g),s),v),{},{definition:y,icons:_objectSpread2$c(_objectSpread2$c({},g.icons),null!==(r=null==s?void 0:s.icons)&&void 0!==r?r:{}),MoreButtonPlugin:{iconPlugins:[].concat(_toConsumableArray$a(null!==(n=null===(i=s.MoreButtonPlugin)||void 0===i?void 0:i.iconPlugins)&&void 0!==n?n:[]),_toConsumableArray$a(S),[PlaybackRateMobilePlugin])},playerData:this.playerData}),$.length>1&&k.MoreButtonPlugin.iconPlugins.push(LineMobilePlugin),w.length>1&&k.MoreButtonPlugin.iconPlugins.push(DefinitionMobilePlugin),this.setDefaultConfigOptions(k),I=[].concat(_toConsumableArray$a(E),_toConsumableArray$a(l)),this._isFirstCreated?this._isFirstCreated=!1:(k.autoplayMuted=!1,k.ignores=[].concat(_toConsumableArray$a(null!==(C=null==k?void 0:k.ignores)&&void 0!==C?C:[]),["sdkUnmutePlugin"])),this.setHlsEncryptConfig(k,p),this.player=new PresetPlayer(_objectSpread2$c(_objectSpread2$c({el:this.playerContainer,presets:m,url:h,isLive:o},k),{},{plugins:_toConsumableArray$a(I)})),this.player.playerData=this.playerData,this._emitter.emit(SDKEvents.PLAYER_CREATED_FINISH),this.afterPlayerCreate(),e.abrupt("return",this.player);case 31:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"setHlsEncryptConfig",value:function(e,t){t&&!t.playDomain&&setPluginConfig(e,"EncryptHlsPlugin","playDomain",TOB_PLAY_DOMAIN),t&&!t.getKeyType&&setPluginConfig(e,"EncryptHlsPlugin","getKeyType","TOP"),t&&!t.keyDomain&&setPluginConfig(e,"EncryptHlsPlugin","keyDomain",TOB_KEY_DOMAIN)}},{key:"detectCodec",value:(a=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t){var r,n;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(new Lite).parseUrl(t);case 3:r=e.sent,"bytevc1"===(n=(r||{}).codec)?this.playerData.codec=CodecType.H265:"avc"===n&&(this.playerData.codec=CodecType.H264),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("detect codec error: ",e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return a.apply(this,arguments)})},{key:"setDefaultConfigOptions",value:function(e){if(this._isFirstCreated){var t=this.playerData,r=t.defaultConfig,n=t.isHitDefault;if(r){var i=null!=r?r:{},a=i.volume,o=i.startTime,s=i.DanmuPlugin,l=i.LiveSubtitlesIconPlugin;if(a&&(e.volume=e.volume?_objectSpread2$c(_objectSpread2$c({},e.volume),{},{default:a}):a),n){var u,c;if(o&&(e.startTime=o),s)e.DanmuPlugin=_objectSpread2$c(_objectSpread2$c({},null!==(u=e.DanmuPlugin)&&void 0!==u?u:{}),s);if(l)e.LiveSubtitlesIconPlugin=_objectSpread2$c(_objectSpread2$c({},null!==(c=e.LiveSubtitlesIconPlugin)&&void 0!==c?c:{}),l)}}}}},{key:"getCurrentPlayerConfig",value:function(){var e,t,r=this.playerData,n=r.isLive,i=r.current,a=i.lineId,o={type:n?"live":"vod",isLive:n,definition:i.definition,lineId:a,volume:null!==(e=this.player.volume)&&void 0!==e?e:.6};n||(o.startTime=null!==(t=this.player.video.currentTime)&&void 0!==t?t:0);return _objectSpread2$c({},o)}},{key:"_analyzeExtendPlugins",value:function(){var e,t=this.playerData.options,r=t.extendPlugin||[],n=null!==(e=null==t?void 0:t.ignore)&&void 0!==e?e:[],i=[],a=[];return r.forEach((function(e){var t=extendPlugin(e);"inner"!==t.type||n[e.pluginName]?i.push(t):a.push(t)})),{basicPlugins:i,iconPlugins:a}}},{key:"beforePlayerCreate",value:(i=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(){return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sdkPluginManager.beforePlayerCreate(this);case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"afterPlayerCreate",value:function(){var e=this.playerData.isMobile;this._mountingPlayerPanel(e),this._mountingExtendMethods(),this._bindSdkEvents(),this._bindPlayerEvents(),this._setPlayerInfo(),sdkPluginManager.afterPlayerCreate(this),this.emitDelayError()}},{key:"emitDelayError",value:function(){var e=this;setTimeout((function(){e.player&&e.delayError.forEach((function(t){var r=new Errors$1(e.player,t);e.player.emit("error",r)})),e.delayError=[]}),0)}},{key:"_setPlayerInfo",value:function(){var e,t;if(this.player){this.player.playerVersion=pkgJson.version;var r=this.playerData.getCurrentStreamType()||getFormat(null===(e=this.playerData)||void 0===e||null===(t=e.configs)||void 0===t?void 0:t.getVideoByToken);this.player.playerType||(this.player.playerType=r)}}},{key:"_mountingPlayerPanel",value:function(e){var t,r=this.playerData,n=r.options,i=r.isLive;this.player&&e&&(this.mobilePanel=new MobilePlayerPanel({config:null!==(t=n.panel)&&void 0!==t?t:{mode:i?PLAYER_MODE.INNER:PLAYER_MODE.NORMAL,isAutoChange:!0},root:this.player.root,player:this.player}),this.player.panel=this.mobilePanel)}},{key:"_bindPlayerEvents",value:function(){this.player&&(this.player.on(SDKEvents.PLAYER_REBUILD,this.createPlayer.bind(this)),this.player.on(PluginEvents.MEDIA_EXPIRED,this.onMediaExpiredAction.bind(this)),this.player.once(COMPLETE,this.emitDelayError.bind(this)))}},{key:"onMediaExpiredAction",value:function(){var e,t,r=this;if(null!==(e=this.playerData)&&void 0!==e&&e.onMediaExpired&&"function"==typeof(null===(t=this.playerData)||void 0===t?void 0:t.onMediaExpired)){var n=this.playerData.onMediaExpired();null!=n&&n.then&&n.then((function(e){return r.playNext(e)}))}}},{key:"onTokenExpiredAction",value:function(){var e,t,r=this;if(null!==(e=this.playerData)&&void 0!==e&&e.onTokenExpired&&"function"==typeof(null===(t=this.playerData)||void 0===t?void 0:t.onTokenExpired)){var n=this.playerData.onTokenExpired();null!=n&&n.then&&n.then((function(e){return r.updateAuthToken(e)}))}}},{key:"_bindSdkEvents",value:function(){var e=this;[].concat(_toConsumableArray$a(Object.values(PluginEvents)),_toConsumableArray$a(Object.values(SDKEvents)),_toConsumableArray$a(Object.values(Events$1))).forEach((function(t){"string"==typeof t&&e.player.on(t,(function(r){e._emitter.emit(t,r)}))}))}},{key:"_mountingExtendMethods",value:function(){this.player&&(this.player.changePluginsIcon=this.changePluginsIcon.bind(this))}},{key:"_offPlayerEvents",value:function(){this.player&&this.player.off(SDKEvents.PLAYER_REBUILD,this.createPlayer.bind(this))}},{key:"changePluginsIcon",value:function(e,t){var r;if(this.player){var n=this.player.getPlugin(e);if(n&&null!=n&&n.root){var i=util$2.hasClass(null==n?void 0:n.parent,"panel-icon-svg")?null==n||null===(r=n.parent)||void 0===r?void 0:r.parentNode:null==n?void 0:n.root;i&&(t?util$2.show(i,"block"):util$2.hide(i))}}}},{key:"getSdkPlugin",value:function(e){var t=this._sdkPlugins[e.toLowerCase()];return t&&t.pluginName?t:null}},{key:"switchAuthToken",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.player.config,i=r?0:this.player.currentTime,a=this.getSdkPlugin("AuthToken"),o=this.player.paused,s=this.player.state;return new Promise((function(r,l){a?a.switchAuthToken(e).then((function(){var e=t.playerData.getCurrentUrl();if(t._playOriginalUrl=e,t.player){var a=_objectSpread2$c(_objectSpread2$c(_objectSpread2$c({},n),t.playerData.options),{},{startTime:i,url:e});if(t.player.playNext(a),6===s)t.player.once("canplay",(function(){o&&t.player.pause(),r()}));else{var u=a.autoplay||a.autoplayMuted;t.player.once("canplay",(function(){u?t.player.play():t.player.pause(),r()}))}}else console.error("no player created"),l()})):(console.error("current is not playAuthToken play"),l())}))}},{key:"updateAuthToken",value:function(e){var t=this,r=this.player.config,n=this.getSdkPlugin("AuthToken");return new Promise((function(i,a){n?n.switchAuthToken(e).then((function(){var e=t.playerData.getCurrentUrl();t._playOriginalUrl=e,t.getUrlTimestamp(e),t.player?(t.player.resetState(),t.player.setConfig(_objectSpread2$c(_objectSpread2$c(_objectSpread2$c({},r),t.playerData.options),{},{url:e})),t.player.start().then((function(){return i()}))):(console.error("player not created"),a())})):(console.error("current is not playAuthToken play"),a())}))}},{key:"src",get:function(){var e;return null===(e=this.player)||void 0===e?void 0:e.src},set:function(e){this.player&&(this.player.src=e)}},{key:"switchURL",value:function(e){var t=this;this.resetUrlState(e);var r=this.player.switchURL(e),n=this.player.currentTime;return r&&r.then?r:new Promise((function(e){var r=t.player.paused&&!t.player.isError,i=function(){t.player.currentTime=n,r&&t.player.once("canplay",(function(){t.player.pause()})),e()};sniffer$1.os.isAndroid?t.once("timeupdate",(function(){i()})):t.once("canplay",(function(){i()})),t.player.play()}))}},{key:"next",value:function(e){var t,r,n=this,i=(null===(t=this.player)||void 0===t?void 0:t.currentTime)||0,a=_objectSpread2$c(_objectSpread2$c({},this.playerData.configs),{},{startTime:i,autoplay:!0},e);return null!=e&&null!==(r=e.getVideoByToken)&&void 0!==r&&r.playAuthToken&&(a.streamType=getFormat(null==e?void 0:e.getVideoByToken)||"mp4"),this.destroy().then((function(){return n._init(a)})).catch((function(e){console.error("next_error",e)}))}},{key:"playNext",value:function(e){var t,r,n,i,a,o,s,l,u=this;if(!e)return Promise.reject();var c,d=e.url,h=e.getVideoByToken,f=!(null===(t=this.player)||void 0===t||null===(r=t.plugins)||void 0===r||!r.encrypthlsplugin),p=!(null===(n=this.player)||void 0===n||null===(i=n.plugins)||void 0===i||!i.dashplugin),y=!(null===(a=this.player)||void 0===a||null===(o=a.plugins)||void 0===o||!o.mp4encryptplayer),m=null!==(s=null===(l=this.player)||void 0===l?void 0:l.currentTime)&&void 0!==s?s:0;if(d){this.resetUrlState(d);var g=this.player.config,v=this.player.state,b=_objectSpread2$c(_objectSpread2$c({},g),{},{startTime:m},e),_=this.player.paused;if(f){var E=getPluginConfig(b,"EncryptHlsPlugin");this.setHlsEncryptConfig(b,E)}return f||y?(this.player.playNext(b),new Promise((function(e){if(6===v)u.player.once("canplay",(function(){_&&u.player.pause(),e()}));else{var t=b.autoplay||b.autoplayMuted;u.player.once("canplay",(function(){t?u.player.play():u.player.pause(),e()}))}}))):6===v?this.switchURL(d):this.player.config.autoplay||this.player.config.autoplayMuted?this.player.playNext(b):(this.player.resetState(),this.player.setConfig(_objectSpread2$c(_objectSpread2$c({},g),e)),this.player.start())}return null!=h&&h.playAuthToken?(this.playerData.getCurrentStreamType()||getFormat(null===(c=this.playerData.configs)||void 0===c?void 0:c.getVideoByToken))!==(e.streamType||getFormat(null==e?void 0:e.getVideoByToken)||"mp4")?this.next(e):p?dist.url(null==h?void 0:h.playAuthToken,TOB_PLAY_DOMAIN).then((function(e){var t=getPluginConfig(u.player.config,"DASHPlugin");t.dashOpts={Data:e},u.player.plugins.dashplugin.next(u.player.currentTime,"MEDIA_EXPIRED",t,!0)})):this.switchAuthToken(h):this.next(e)}},{key:"resetUrlState",value:function(e){this.playerData.playList=[],this.playerData.initPlayData(_objectSpread2$c(_objectSpread2$c({},this.playerData.configs),{},{url:e})),this._playOriginalUrl=e,this.getUrlTimestamp(e)}},{key:"_destroyPlayer",value:(n=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(){var t,r;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._offPlayerEvents(),e.next=3,null===(t=this.mobilePanel)||void 0===t?void 0:t.destroy();case 3:return e.next=5,null===(r=this.player)||void 0===r?void 0:r.destroy();case 5:this.player=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getPlayerInstance",value:function(){return this.player}},{key:"getSoftDecodingOption",value:(r=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(t,r,n){var i,a,o,s,l,u,c,d,h,f,p;return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=XGVideo.isSupported(),o=this.playerData,s=o.enableH265Degrade,l=o.codec,u=o.configs,c=isEncryptPlay(null==u?void 0:u.getVideoByToken),d=!!(u.enableMp4MSE||getPluginConfig(this.playerData.options,"Mp4EncryptPlayer")||"mp4"===n&&(c||null!=u&&null!==(i=u.autoBitrateOpts)&&void 0!==i&&i.isOpenAutoDefi)),!t){e.next=17;break}if(!a){e.next=11;break}return l&&XGVideo.setDecodeCapacity({preloadDecoder:this.playerData.codec,wasmFallbackToAsm:!1,reuseWasmDecoder:!1,disabledWhenErrorOccur:!1}),this.setH265SoftPlayList(),e.abrupt("return",{mediaType:d?this.playerData.isCurrentH265()?"xg-video":"video":"xg-video",innerDegrade:1,codecType:null!=l?l:"h264"});case 11:this.emit(SDKEvents.NOT_SUPPORT_SOFT_DECODER),h={errorType:"decoder",errorCode:3,errorMessage:"soft decode is not support by current browser",ext:{},originError:void 0},this.delayError.push(h),console.error("soft decode is not support by current browser");case 15:e.next=39;break;case 17:if(!s||l){e.next=20;break}return e.next=20,this.detectCodec(r);case 20:if(!this.playerData.isCurrentH265()||isHevcSupported()){e.next=39;break}if(!s){e.next=35;break}if(!a){e.next=29;break}return XGVideo.setDecodeCapacity({preloadDecoder:this.playerData.codec,wasmFallbackToAsm:!1,reuseWasmDecoder:!1,disabledWhenErrorOccur:!1}),this.setH265SoftPlayList(),this.playerData.openSoftDecoding=!0,e.abrupt("return",{mediaType:d?this.playerData.isCurrentH265()?"xg-video":"video":"xg-video",innerDegrade:1,codecType:this.playerData.codec});case 29:this.emit(SDKEvents.NOT_SUPPORT_SOFT_DECODER),f={errorType:"decoder",errorCode:3,errorMessage:"soft decode is not support by current browser",ext:{},originError:void 0},this.delayError.push(f),console.error("soft decode is not support by current browser");case 33:e.next=39;break;case 35:this.emit(SDKEvents.NOT_SUPPORT_HARDWARE_DECODER),p={ext:{},originError:void 0,errorType:"decoder",errorCode:3,errorMessage:"h265 hardware decode is not supported by this browser"},this.delayError.push(p),console.error("h265 hardware decode is not supported by this browser");case 39:return e.abrupt("return",{});case 40:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"setH265SoftPlayList",value:function(){if(this.playerData.isCurrentH265()){var e=this.playerData.playList;e.length>1&&(this.playerData.playList=e.filter((function(e){var t;return(null==e||null===(t=e.codec)||void 0===t?void 0:t.toLowerCase())===CodecType.H265}))),this.playerData.initCurrent(this.playerData.playList[0])}}},{key:"_initI18N",value:function(e){var t=e.extraLangList,r=e.extendLangList;null==t||t.forEach((function(e){I18N.use(e)})),r&&I18N.extend(r),I18N.extend(defaultExtendLang)}},{key:"destroy",value:(t=_asyncToGenerator$d(_regeneratorRuntime$b().mark((function e(){return _regeneratorRuntime$b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._destroyPlayer();case 2:this.checkExpireTimer&&(this.checkExpireTimer.clear(),this.checkExpireTimer=null),this.mountingDom&&this.mountingDom.removeChild(this.playerContainer),this._emitter.removeAllListeners(),this._emitter=null,sdkPluginManager.destroy(this);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function getI18N(){return I18N}var index$1="",aisub="",aisubIcon="",index="";function OpenIcon(){return(new DOMParser).parseFromString('<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M2 0.5C0.895431 0.5 0 1.39543 0 2.5V13.5C0 14.6046 0.89543 15.5 2 15.5H16C17.1046 15.5 18 14.6046 18 13.5V2.5C18 1.39543 17.1046 0.5 16 0.5H2ZM7.49634 11.0454C8.00741 10.606 8.29061 10.0037 8.34595 9.23877H6.8811C6.84855 9.67171 6.71997 9.99235 6.49536 10.2007C6.27401 10.4058 5.93709 10.5083 5.48462 10.5083C4.98332 10.5083 4.61548 10.3309 4.3811 9.97607C4.14998 9.62126 4.03442 9.05973 4.03442 8.2915V7.75439C4.04093 7.01872 4.16463 6.47673 4.40552 6.12842C4.64966 5.77686 5.01587 5.60107 5.50415 5.60107C5.95337 5.60107 6.28703 5.70524 6.50513 5.91357C6.72648 6.11865 6.85506 6.45068 6.89087 6.90967H8.35571C8.27759 6.1154 7.98787 5.49854 7.48657 5.05908C6.98527 4.61963 6.32446 4.3999 5.50415 4.3999C4.9117 4.3999 4.39087 4.53988 3.94165 4.81982C3.49569 5.09652 3.15226 5.49528 2.91138 6.01611C2.67049 6.53695 2.55005 7.13916 2.55005 7.82275V8.25732C2.55005 9.32829 2.81047 10.1714 3.3313 10.7866C3.85539 11.3986 4.57316 11.7046 5.48462 11.7046C6.31795 11.7046 6.98853 11.4849 7.49634 11.0454ZM14.5393 11.0454C15.0504 10.606 15.3336 10.0037 15.3889 9.23877H13.9241C13.8915 9.67171 13.7629 9.99235 13.5383 10.2007C13.317 10.4058 12.9801 10.5083 12.5276 10.5083C12.0263 10.5083 11.6584 10.3309 11.4241 9.97607C11.193 9.62126 11.0774 9.05973 11.0774 8.2915V7.75439C11.0839 7.01872 11.2076 6.47673 11.4485 6.12842C11.6926 5.77686 12.0588 5.60107 12.5471 5.60107C12.9963 5.60107 13.33 5.70524 13.5481 5.91357C13.7695 6.11865 13.898 6.45068 13.9338 6.90967H15.3987C15.3206 6.1154 15.0308 5.49854 14.5295 5.05908C14.0282 4.61963 13.3674 4.3999 12.5471 4.3999C11.9547 4.3999 11.4338 4.53988 10.9846 4.81982C10.5387 5.09652 10.1952 5.49528 9.95435 6.01611C9.71346 6.53695 9.59302 7.13916 9.59302 7.82275V8.25732C9.59302 9.32829 9.85343 10.1714 10.3743 10.7866C10.8984 11.3986 11.6161 11.7046 12.5276 11.7046C13.3609 11.7046 14.0315 11.4849 14.5393 11.0454Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}function CloseIcon(){return(new DOMParser).parseFromString('<svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M7.49609 11.0454C8.00716 10.606 8.29037 10.0037 8.3457 9.23877H6.88086C6.84831 9.67171 6.71973 9.99235 6.49512 10.2007C6.27376 10.4058 5.93685 10.5083 5.48438 10.5083C4.98307 10.5083 4.61523 10.3309 4.38086 9.97607C4.14974 9.62126 4.03418 9.05973 4.03418 8.2915V7.75439C4.04069 7.01872 4.16439 6.47673 4.40527 6.12842C4.64941 5.77686 5.01562 5.60107 5.50391 5.60107C5.95312 5.60107 6.28678 5.70524 6.50488 5.91357C6.72624 6.11865 6.85482 6.45068 6.89062 6.90967H8.35547C8.27734 6.1154 7.98763 5.49854 7.48633 5.05908C6.98503 4.61963 6.32422 4.3999 5.50391 4.3999C4.91146 4.3999 4.39062 4.53988 3.94141 4.81982C3.49544 5.09652 3.15202 5.49528 2.91113 6.01611C2.67025 6.53695 2.5498 7.13916 2.5498 7.82275V8.25732C2.5498 9.32829 2.81022 10.1714 3.33105 10.7866C3.85514 11.3986 4.57292 11.7046 5.48438 11.7046C6.31771 11.7046 6.98828 11.4849 7.49609 11.0454Z" fill="white"/>\n<path d="M14.5391 11.0454C15.0501 10.606 15.3333 10.0037 15.3887 9.23877H13.9238C13.8913 9.67171 13.7627 9.99235 13.5381 10.2007C13.3167 10.4058 12.9798 10.5083 12.5273 10.5083C12.026 10.5083 11.6582 10.3309 11.4238 9.97607C11.1927 9.62126 11.0771 9.05973 11.0771 8.2915V7.75439C11.0837 7.01872 11.2074 6.47673 11.4482 6.12842C11.6924 5.77686 12.0586 5.60107 12.5469 5.60107C12.9961 5.60107 13.3298 5.70524 13.5479 5.91357C13.7692 6.11865 13.8978 6.45068 13.9336 6.90967H15.3984C15.3203 6.1154 15.0306 5.49854 14.5293 5.05908C14.028 4.61963 13.3672 4.3999 12.5469 4.3999C11.9544 4.3999 11.4336 4.53988 10.9844 4.81982C10.5384 5.09652 10.195 5.49528 9.9541 6.01611C9.71322 6.53695 9.59277 7.13916 9.59277 7.82275V8.25732C9.59277 9.32829 9.85319 10.1714 10.374 10.7866C10.8981 11.3986 11.6159 11.7046 12.5273 11.7046C13.3607 11.7046 14.0312 11.4849 14.5391 11.0454Z" fill="white"/>\n<path fill-rule="evenodd" clip-rule="evenodd" d="M0 2.5C0 1.39543 0.895431 0.5 2 0.5H16C17.1046 0.5 18 1.39543 18 2.5V13.5C18 14.6046 17.1046 15.5 16 15.5H2C0.89543 15.5 0 14.6046 0 13.5V2.5ZM2 2.3H16C16.1105 2.3 16.2 2.38954 16.2 2.5V13.5C16.2 13.6105 16.1105 13.7 16 13.7H2C1.88954 13.7 1.8 13.6105 1.8 13.5V2.5C1.8 2.38954 1.88954 2.3 2 2.3Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}function Uint8ArrayToString(e){var t=String.fromCharCode.apply(null,e);return t.slice(t.indexOf("{"),t.lastIndexOf("}")+1)}var LiveSubTitlesPlugin=function(t){_inherits$g(n,t);var r=_createSuper$j(n);function n(e){var t;return _classCallCheck$j(this,n),(t=r.call(this,e)).state={showLang:"",subTitleList:[],rtmpDtsGap:0,dtsBase:0,showingSubtitle:"",currentSub:null},t.clearLineTimer=null,t.showTimer=null,t.state.showLang=e.showLang,t}return _createClass$k(n,[{key:"beforePlayerInit",value:function(){var e=this;this.on(TIME_UPDATE,this.handleVideoTimeupdate.bind(this)),this.on(PAUSE,this.onPause.bind(this)),this.on(PLAY,this.onPlay.bind(this)),this.on(DESTROY,this.destroy.bind(this)),this.on(URL_CHANGE,this.clearRtmpDtsGap.bind(this)),this.on(SEI_PARSED,this.handleSEIParsed.bind(this)),this.on("core_event",(function(t){"core.sei"===t.eventName&&e.handleSEIParsed(t.sei,t.originPts)}))}},{key:"onPause",value:function(){this.clearSubTitle(!1)}},{key:"onPlay",value:function(){this.clearSubTitle(!0)}},{key:"destroy",value:function(){this.clearSubTitle(!0),this.off(TIME_UPDATE,this.handleVideoTimeupdate.bind(this)),this.off(SEI_PARSED,this.handleSEIParsed.bind(this)),this.off(PAUSE,this.onPause.bind(this)),this.off(PLAY,this.onPlay.bind(this)),this.off(DESTROY,this.destroy.bind(this)),this.off(URL_CHANGE,this.clearRtmpDtsGap.bind(this))}},{key:"clearRtmpDtsGap",value:function(){this.state.rtmpDtsGap=0,this.state.dtsBase=0,this.clearSubTitle(!0)}},{key:"clearSubTitle",value:function(e){if(this.state.subTitleList=[],this.state.showingSubtitle="",this.state.currentSub=null,clearTimeout(this.showTimer),clearTimeout(this.clearLineTimer),e){var t=this.find(".xgplayer-subtitles-inner");t&&this.resetDom(t)}}},{key:"getIsSoft",value:function(){var e;return"LIVE-VIDEO"===(null!==(e=this.player.video)&&void 0!==e?e:{}).tagName}},{key:"handleVideoTimeupdate",value:function(e){var t,r,n=this.player.video.currentTime,i=this.getIsSoft(),a=(null==e||null===(t=e.detail)||void 0===t?void 0:t.pts)/1e3,o=i?a:n;if(this.state.showLang&&o&&this.player.isPlaying){var s=this.findSubTitleByTime(o);s&&s.text!==this.state.showingSubtitle&&null!==(r=s.wordpiece)&&void 0!==r&&r.length&&(this.renderSubtitle(s),this.player.emit(PluginEvents.AI_SUBTITLE_MATCH,{subTitle:s,lang:this.state.showLang}),this.state.subTitleList.length>1e3&&(this.state.subTitleList=this.state.subTitleList.filter((function(e){return e.timestamp+e.duration/1e3>=o}))))}}},{key:"renderSubtitle",value:function(e){var t=this,r=this.root,n=this.find(".xgplayer-subtitles-inner"),i=this.find(".xgplayer-subtitles-helper");if(n){this.clearLineTimer&&clearTimeout(this.clearLineTimer),this.showTimer&&(clearTimeout(this.showTimer),this.showSurplus());var a=this.createNewDom(n);this.state.showingSubtitle=e.text,this.state.currentSub={subObj:e,dom:a,index:0};var o=Date.now(),s="",l=0;!function u(){var c,d=e.wordpiece,h=void 0===d?[]:d,f=e.delimiter;if(l===h.length)return s="",t.showTimer=null,void(t.clearLineTimer=setTimeout((function(){t.resetDom(n),t.clearLineTimer=null}),1e3));var p=h[l].duration-(Date.now()-o-h[l].OffsetMs);if(p<0)for(;p<0&&l<h.length-1;)s=s+f+h[l+=1].text,p=h[l].duration-(Date.now()-o-h[l].OffsetMs);else s=s+f+h[l].text;i.textContent=s;var y=null!==(c=null==r?void 0:r.offsetWidth)&&void 0!==c?c:300;i.offsetWidth>y&&(a=t.createNewDom(n),t.state.currentSub.dom=a,s=h[l].text),a.textContent=s,t.showTimer=setTimeout(u,p),l+=1,t.state.currentSub.index=l}()}}},{key:"handleSEIParsed",value:function(t,r){var n=t.dts;if(5===t.code)try{var i="string"==typeof t.content?t.content:Uint8ArrayToString(t.content),a=JSON.parse(i).rtmp_dts;if(a&&n){var o=r||n;this.state.rtmpDtsGap=a-o}}catch(e){}}},{key:"insertSubTitle",value:function(){for(var e,t=this,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];n.forEach((function(e){e.timestamp=t.adjustSubTitleTime(e.timestamp)})),(e=this.state.subTitleList).push.apply(e,n)}},{key:"setCurrentLang",value:function(e){this.state.showLang=e,this.player.emit(PluginEvents.AI_SUBTITLE_LANG_CHANGE,e)}},{key:"adjustSubTitleTime",value:function(e){var t,r,n,i,a,o,s,l;if(this.getIsSoft())return(e-this.state.rtmpDtsGap)/1e3;var u=(null===(t=this.player)||void 0===t||null===(r=t.plugins)||void 0===r?void 0:r.flvlive)||(null===(n=this.player)||void 0===n||null===(i=n.plugins)||void 0===i?void 0:i.hlslive);if(u){var c,d,h,f,p,y,m,g=null!==(c=null==u||null===(d=u._context)||void 0===d||null===(h=d.getInstance("COMPATIBILITY"))||void 0===h?void 0:h._videoLargeGap)&&void 0!==c?c:0,v=null==u||null===(f=u._context)||void 0===f?void 0:f.getInstance("MP4_REMUXER"),b=null!==(p=null!==(y=null===(m=v.remuxer)||void 0===m?void 0:m.videoDtsBase)&&void 0!==y?y:null==v?void 0:v.videoDtsBase)&&void 0!==p?p:0;return this.state.dtsBase=b-g,(e+g-b-this.state.rtmpDtsGap)/1e3}var _=(null===(a=this.player)||void 0===a||null===(o=a.plugins)||void 0===o?void 0:o.flv)||(null===(s=this.player)||void 0===s||null===(l=s.plugins)||void 0===l?void 0:l.hls);if(_){var E,T,S,$=null===(E=_.core._bufferService)||void 0===E||null===(T=E._demuxer)||void 0===T||null===(S=T._fixer)||void 0===S?void 0:S._baseDts;return this.state.dtsBase=$,(e-$-this.state.rtmpDtsGap)/1e3}return(e-this.state.rtmpDtsGap)/1e3}},{key:"findSubTitleByTime",value:function(e){var t=this,r=this.state.subTitleList,n=r.findIndex((function(r){var n=t.player,i=r.lang===t.state.showLang,a=((null==n?void 0:n.__curUrl)||n.config.url)===r.url,o=r.timestamp;return o+r.duration/1e3>=e&&o<=e&&a&&i}));if(!(n<0)){var i=r.splice(0,n+1),a=i[i.length-1];return this.splitSubTitle(a)}}},{key:"splitSubTitle",value:function(e){var t="en"===e.lang?" ":"",r=e.text.split(t);if(!e.wordpiece){var n=e.duration/r.length,i=r.map((function(e,t){return{text:e,OffsetMs:n*t,duration:n}}));return _objectSpread2$c(_objectSpread2$c({},e),{},{delimiter:t,textArr:r,wordpiece:i})}return _objectSpread2$c(_objectSpread2$c({},e),{},{delimiter:t,textArr:r})}},{key:"showSurplus",value:function(){var e,t=this;if(this.state.currentSub){var r=this.state.currentSub,n=r.index,i=r.subObj,a=r.dom,o=null!=i?i:{},s=o.wordpiece,l=o.delimiter;if(!(n>=s.length)){var u=this.find(".xgplayer-subtitles-helper"),c=this.find(".xgplayer-subtitles-inner"),d=this.root,h=null!==(e=null==d?void 0:d.offsetWidth)&&void 0!==e?e:300,f=s.length,p=a.textContent;s.slice(n,f).forEach((function(e){p=p+l+e.text,u.textContent=p,u.offsetWidth>h&&(t.state.currentSub.dom=t.createNewDom(c),p=e.text),t.state.currentSub.dom.textContent=p}))}}}},{key:"createNewDom",value:function(e){if(e){e.children.length>2&&e.firstElementChild&&e.removeChild(e.firstElementChild);var t=document.createElement("span");if(e.appendChild(t),e.children.length>2){var r=e.classList.contains("scroll-1"),n=e.classList.contains("scroll-2");r&&e.classList.replace("scroll-1","scroll-2"),n&&e.classList.replace("scroll-2","scroll-1"),r||n||e.classList.add("scroll-1")}return t}}},{key:"test",value:function(){var e=this,t=this.splitSubTitle({duration:1e4,lang:"zh",text:"    ,    ",timestamp:0,url:"xxx"});this.renderSubtitle(t),setTimeout((function(){e.test()}),1e4)}},{key:"getPlayTime",value:function(){var e=this,t=this.getIsSoft();this.on(TIME_UPDATE,(function(r){if(t){var n,i={pts:null==r||null===(n=r.detail)||void 0===n?void 0:n.pts,rtmpDtsGap:e.state.rtmpDtsGap};i.timestamp=i.pts+i.rtmpDtsGap,console.log("",i.timestamp,i)}else{var a={currentTime:1e3*e.player.video.currentTime,dtsBase:e.state.dtsBase,rtmpDtsGap:e.state.rtmpDtsGap};a.timestamp=a.currentTime+a.dtsBase+a.rtmpDtsGap,console.log("",a.timestamp,a)}}))}},{key:"resetDom",value:function(e){e&&(this.state.currentSub=null,e&&(e.innerHTML="",e.classList.remove("scroll-1","scroll-2")))}},{key:"render",value:function(){return'<xg-subtitles class="xgplayer-subtitles"><xg-subtitles-inner class="xgplayer-subtitles-inner"></xg-subtitles-inner><xg-subtitles-helper class="xgplayer-subtitles-helper"></xg-helper></xg-subtitles>'}}],[{key:"pluginName",get:function(){return"LiveSubtitlesPlugin"}},{key:"defaultConfig",get:function(){return{position:Plugin.POSITIONS.ROOT,showLang:""}}}]),n}(Plugin),POSITIONS$3=Plugin.POSITIONS,LiveSubtitlesIconPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).isMobile="mobile"===sniffer$1.device,n.isOpenState=!0,n.optionList=null,n.currentLang="",n}return _createClass$k(r,[{key:"afterCreate",value:function(){this.appendChild(".xgplayer-icon",this.icons.aiSubOpen),this.appendChild(".xgplayer-icon",this.icons.aiSubClose),this.renderOptionList(),this.initEvents(),this.currentLang=this.config.default,this.config.defaultOpen?this.open(!0):this.close()}},{key:"afterPlayerInit",value:function(){this.config.defaultOpen&&this.changeSubTitleLang(this.config.default,!0)}},{key:"registerIcons",value:function(){return{aiSubOpen:{icon:OpenIcon,class:"xgplayer-aisub-open-svg"},aiSubClose:{icon:CloseIcon,class:"xgplayer-aisub-close-svg"}}}},{key:"registerLanguageTexts",value:function(){return{sub:{jp:"AI ",en:"AI Subtitles",zh:"AI ","zh-hk":"AI "},subOpen:{jp:"",en:"Show subtitles",zh:"","zh-hk":""},subClose:{jp:"",en:"Hide subtitles",zh:"","zh-hk":""}}}},{key:"children",value:function(){return{LiveSubTitlesPlugin:{plugin:LiveSubTitlesPlugin,options:{root:this.player.root,showLang:this.currentLang}}}}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this)),this.bind(["mouseenter"],this.showPanel.bind(this)),this.bind(["mouseleave"],this.hidePanel.bind(this))}},{key:"handleButtonChange",value:function(){(this.close=this.close.bind(this),this.open=this.open.bind(this),this.isMobile)?this.showMobilePanel():(this.isOpenState?this.close:this.open)()}},{key:"showMobilePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player.panel)||void 0===e||e.showPanel(t,this.langText.sub,!0)}},{key:"renderItemList",value:function(){var e=this,t=_toConsumableArray$a(this.config.list),r=util$2.createDom("div","",{},"ai-panel-content");return t.push({key:"",showText:this.langText.subClose}),t.forEach((function(t){var n=e.renderItem(t);r.appendChild(n)})),r}},{key:"renderItem",value:function(e){var t=this,r=""===e.key&&!this.isOpenState||this.currentLang===e.key&&this.isOpenState,n=util$2.createDom("div","",{},"panel-Item ".concat(r?"select-in":""));return n.innerHTML=e.showText,n.addEventListener("click",(function(r){r.stopPropagation(),r.preventDefault(),t.changeSubTitleLang(e.key),t.updatePanel()})),n}},{key:"updatePanel",value:function(){var e,t=this.renderItemList();null===(e=this.player.panel)||void 0===e||e.updatePanel(t)}},{key:"showPanel",value:function(){var e;!this.isMobile&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.show())}},{key:"hidePanel",value:function(){var e;!this.isMobile&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.hide())}},{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isOpenState=!0,util$2.removeClass(this.root,"isClose"),util$2.addClass(this.root,"isOpen"),!e&&this.showPanel(),this.toggleSubTitle()}},{key:"close",value:function(){var e;this.isOpenState=!1,util$2.removeClass(this.root,"isOpen"),util$2.addClass(this.root,"isClose"),null===(e=this.optionList)||void 0===e||e.hide(),this.toggleSubTitle()}},{key:"renderOptionList",value:function(){var e,t=this;if(!((null===(e=this.config.list)||void 0===e?void 0:e.length)<2||this.isMobile)){var r={config:{data:this.config.list.map((function(e){return e.key===t.config.default&&(e.isCurrent=!0,e.selected=!0),e})),className:"",onItemClick:function(e,r){var n;e.stopPropagation(),e.preventDefault(),t.changeSubTitleLang(null===(n=r.to)||void 0===n?void 0:n.key)}},root:this.root};this.optionList=new OptionList(r)}}},{key:"changeSubTitleLang",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.currentLang=e,e?this.open(t):this.close()}},{key:"toggleSubTitle",value:function(){var e;null===(e=this.player.getPlugin("LiveSubtitlesPlugin"))||void 0===e||e.setCurrentLang(this.isOpenState?this.currentLang:"")}},{key:"destroy",value:function(){var e;this.unbind(["click"],this.handleButtonChange.bind(this)),this.unbind(["mouseenter"],this.showPanel.bind(this)),this.unbind(["mouseleave"],this.hidePanel.bind(this)),null===(e=this.optionList)||void 0===e||e.destroy()}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-aisub">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="subOpen">'.concat(this.langText.subOpen,"</div>\n    </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"LiveSubtitlesIconPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$3.CONTROLS_RIGHT,index:2.7,defaultOpen:!0,default:"en",list:[{key:"zh",showText:""},{key:"en",showText:"En"}]}}}]),r}(Plugin),POSITIONS$2=Plugin.POSITIONS,IS_MOBILE="mobile"===sniffer$1.device,DEFAULT_CLOSE_TYPE="text-close";function formatList(e){var t=-1;return e.map((function(e,r){e.id||e.language||(e.id=""+r),!e.url&&(e.url=e.src),!e.text&&(e.text=e.label),!e.language&&(e.language=e.srclang),void 0===e.isDefault&&(e.isDefault=e.default),(e.isDefault||e.default)&&(t<0?t=r:e.isDefault=e.default=!1)})),t}var Subtitle=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){var e;return _classCallCheck$j(this,r),(e=t.apply(this,arguments)).isOpenState=!0,e.optionList=null,e.currentLang="",e.handlerClickSwitch=function(t,r){t.stopPropagation(),t.preventDefault(),e.subTitles&&(r.type===DEFAULT_CLOSE_TYPE?e.switchOffSubtitle():e.switchSubTitle({language:r.language,id:r.id}))},e.onPlayerFocus=function(t){e.subTitles&&e.config.style.follow&&e.rePosition()},e.onPlayerBlur=function(t){e.subTitles&&e.config.style.follow&&!e.playerConfig.marginControls&&e.subTitles.root&&(e.subTitles.root.style.transform="translate(0, 0)")},e}return _createClass$k(r,[{key:"beforeCreate",value:function(e){var t=e.player.config.VttSubtitle||e.player.config.vttSubtitle||e.player.config.vttsubtitle;"Array"===util$2.typeOf(t)&&(e.config.list=t)}},{key:"afterCreate",value:function(){var e=this.config,t=e.list,n=e.style,i=e.isDefaultOpen;if(t&&!(t.length<1)){this.curIndex=-1,this.curItem=null;var a=formatList(t);_get$4(_getPrototypeOf$g(r.prototype),"afterCreate",this).call(this);var o={subTitles:t,defaultOpen:i};this.isOpenState=i,Object.keys(n).map((function(e){o[e]=n[e]})),!this.playerConfig.marginControls&&this.player.controls.root&&(this.on(PLAYER_FOCUS,this.onPlayerFocus),this.on(PLAYER_BLUR,this.onPlayerBlur)),this.subTitles=new SubTitles(o),this.subTitles.attachPlayer(this.player),this.changeTipText(),n.follow&&this.subTitles.root&&util$2.addClass(this.subTitles.root,"follow-control"),t&&0!==t.length&&(i&&a<0?(t[0].isDefault=!0,this.curIndex=0,this.curItem=t[0]):(this.curIndex=a,this.curItem=t[a]),this.appendChild(".xgplayer-icon",this.icons.vttSubOpen),this.appendChild(".xgplayer-icon",this.icons.vttSubClose),this.creatOptionList(),this.initEvents(),this.isOpenState?util$2.addClass(this.root,"isOpen"):util$2.addClass(this.root,"isClose"))}}},{key:"initEvents",value:function(){this.bind(["click"],this.handleButtonChange.bind(this)),this.bind(["mouseenter"],this.showList.bind(this)),this.bind(["mouseleave"],this.hideList.bind(this)),this._delegates=[]}},{key:"handleButtonChange",value:function(e){e.preventDefault(),e.stopPropagation(),e.delegateTarget||(IS_MOBILE?this.showMobilePanel():this.isOpenState?this.switchOffSubtitle():this.openSubtitle())}},{key:"showList",value:function(){var e;!IS_MOBILE&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.show())}},{key:"hideList",value:function(){var e;!IS_MOBILE&&this.isOpenState&&(null===(e=this.optionList)||void 0===e||e.hide())}},{key:"openSubtitle",value:function(){this.curIndex>-1&&this.curItem&&this.switchSubTitle(this.curItem)}},{key:"registerIcons",value:function(){return{vttSubOpen:{icon:OpenIcon,class:"xgplayer-vttsub-open-svg"},vttSubClose:{icon:CloseIcon,class:"xgplayer-vttsub-close-svg"}}}},{key:"registerLanguageTexts",value:function(){return{sub:{jp:"",en:"Subtitles",zh:"","zh-hk":""},subOpen:{jp:"",en:"Show subtitles",zh:"","zh-hk":""},subClose:{jp:"",en:"Hide subtitles",zh:"","zh-hk":""}}}},{key:"creatOptionList",value:function(){var e,t=this;if(!((null===(e=this.config.list)||void 0===e?void 0:e.length)<2||IS_MOBILE)){var r={config:{data:this.getList(),className:"",onItemClick:function(e,r){t.handlerClickSwitch(e,null==r?void 0:r.to)}},root:this.root};this.optionList=new OptionList(r)}}},{key:"getList",value:function(){var e=this;return this.config.list.map((function(t,r){return r===e.curIndex&&e.isOpenState?(t.isCurrent=!0,t.selected=!0):(t.isCurrent=!1,t.selected=!1),t.showText=e.getTextByLang(t),t}))}},{key:"renderOptionList",value:function(){this.optionList.renderItemList(this.getList())}},{key:"switchSubTitle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:"",language:""},r=-1;if(t&&(t.id||t.language)&&(this.config.list.map((function(e,n){e.id+""==t.id+""&&e.language+""==t.language+""&&(r=n)})),!(r<0||this.isOpenState&&r===this.curIndex)))return this.subTitles.switch(t).then((function(n){0===n.code&&(t.off=!1,t.isListUpdate=!1,t.list=[],e.curIndex=r,e.curItem=e.config.list[r],e.isOpenState=!0,util$2.removeClass(e.root,"isClose"),util$2.addClass(e.root,"isOpen"),e.renderItemList(),e.changeTipText(),e.emit("subtitle_change",t))})).catch((function(e){return console.error("switch subtitle err: ",e)}))}},{key:"switchOffSubtitle",value:function(){var e;this.subTitles.switchOff(),this.emit("subtitle_change",{off:!0,isListUpdate:!1,list:[]}),this.isOpenState=!1,util$2.removeClass(this.root,"isOpen"),util$2.addClass(this.root,"isClose"),this.renderItemList(),this.changeTipText(),null===(e=this.optionList)||void 0===e||e.hide()}},{key:"renderItemList",value:function(){IS_MOBILE?this.updatePanel():this.renderOptionList()}},{key:"updateSubtitles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var r=[];e.map((function(e){r.push(e)}));var n=formatList(r);this.curIndex=n,this.curItem=n>-1?r[n]:null;var i=n>-1;if(this.config.list=r,this.subTitles&&this.subTitles.setSubTitles(r,i,t),r.length>0){var a;if(!IS_MOBILE)null===(a=this.optionList)||void 0===a||a.show()}else{var o,s;if(this.switchOffSubtitle(),IS_MOBILE?this.showMobilePanel():null===(o=this.optionList)||void 0===o||o.show(),!IS_MOBILE)null===(s=this.optionList)||void 0===s||s.hide();this.hide()}this.renderItemList()}}},{key:"changeTipText",value:function(){this.isOpenState?this.find(".xg-tips").innerHTML=this.langText.subClose:this.find(".xg-tips").innerHTML=this.langText.subOpen}},{key:"showMobilePanel",value:function(){var e,t=this.renderPanel();null===(e=this.player.panel)||void 0===e||e.showPanel(t,this.langText.sub,!0)}},{key:"updatePanel",value:function(){var e,t=this.renderPanel();null===(e=this.player.panel)||void 0===e||e.updatePanel(t)}},{key:"renderPanel",value:function(){var e=this,t=_toConsumableArray$a(this.config.list),r=util$2.createDom("div","",{},"ai-panel-content");t.map((function(t,n){var i=_objectSpread2$c({language:t.language||t.srclang,"data-id":t.id,selected:e.isOpenState&&e.curIndex===n,showText:e.getTextByLang(t)},t),a=e.renderPanelItem(i);r.appendChild(a)}));var n={showText:this.langText.subClose,"data-type":DEFAULT_CLOSE_TYPE,selected:!this.isOpenState};return r.appendChild(this.renderPanelItem(n)),r}},{key:"renderPanelItem",value:function(e){var t=this,r=e.showText,n=e.selected,i=util$2.createDom("div","",{language:e.language,"data-id":e["data-id"],"data-type":e["data-type"]},"panel-Item ".concat(n?"select-in":""));i.innerHTML=r;var a=IS_MOBILE?"touchend":"click",o=Plugin.delegate(i,".panel-Item",a,(function(r){e["data-type"]===DEFAULT_CLOSE_TYPE?(r.stopPropagation(),r.preventDefault(),t.switchOffSubtitle()):t.handlerClickSwitch(r,e)}));return this._delegates.push(o),i}},{key:"getTextByLang",value:function(e,t,r){if(void 0===e)return"";var n=this.config.list;return!r&&(r=this.player.lang),t=!t||util$2.isUndefined(e[t])?"text":t,"number"==typeof e&&(e=n[e]),"object"===_typeof$b(e[t])?e[t][r]||e[t].zh:e[t]||""}},{key:"rePosition",value:function(){var e=this.config.style.fitVideo,t=0-this.player.controls.root.getBoundingClientRect().height;if(e){var r=this.player,n=r.video,i=r.root.getBoundingClientRect(),a=i.height,o=i.width,s=n.videoHeight,l=n.videoWidth,u=parseInt(s/l*100,10)*o/100;u>a&&(u=a);var c=(a-u)/2-t;c<0&&(this.subTitles.root.style.transform="translate(0, ".concat(c,"px)"))}else this.subTitles.root.style.transform="translate(0, ".concat(t,"px)")}},{key:"destroy",value:function(){var e;this.subTitles&&(this.subTitles.destroy(),this.subTitles=null),this.unbind(["click"],this.handleButtonChange.bind(this)),this.unbind(["mouseenter"],this.showList.bind(this)),this.unbind(["mouseleave"],this.hideList.bind(this)),null===(e=this.optionList)||void 0===e||e.destroy(),this._delegates&&this._delegates.length>0&&(this._delegates.map((function(e){Array.isArray(e)&&e.map((function(e){e.destroy&&e.destroy()})),e.destroy&&e.destroy()})),this._delegates=null),_get$4(_getPrototypeOf$g(r.prototype),"destroy",this).call(this)}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-vttsub">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="vttSubOpen">'.concat(this.langText.subOpen,"</div>\n    </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"Subtitle"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$2.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.Subtitle,list:[],isDefaultOpen:!0,style:{follow:!0,mode:"stroke",followBottom:50,fitVideo:!0,offsetBottom:4,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,line:"double",fontColor:"#fff"}}}}]),r}(Plugin),DefinitionDemotePlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).waitings=[],n.longWaitingEmitTime=0,n.waitingStartTime=0,n.playerData=null,n.isNeedShowTips=!0,n.playerData=n.playerConfig.playerData,n}return _createClass$k(r,[{key:"registerLanguageTexts",value:function(){return{definition_demote_txt:{jp:"",en:"The current network is unstable, it is recommended to switch to ",zh:"","zh-hk":""}}}},{key:"afterCreate",value:function(){this.bindCtx(),this.bindEvents()}},{key:"bindCtx",value:function(){this._count=this._count.bind(this),this._time=this._time.bind(this),this._waiting=this._waiting.bind(this),this._clearTime=this._clearTime.bind(this)}},{key:"bindEvents",value:function(){var e=this;this.on(WAITING,this._waiting),this.on(PLAYING,this._clearTime),this.on(PAUSE,this._clearTime),this.on(TIME_UPDATE,this._clearTime),this.on(PLAY,this._clearTime),this.on(CANPLAY,(function(){e.isNeedShowTips=!0})),this.config.isNeedAutoDemote&&this.player.on(PluginEvents.LONG_WAITING,this.demote.bind(this))}},{key:"_waiting",value:function(){this._count(),this._time()}},{key:"_count",value:function(){var e=Date.now();if(this.waitings.push(e),this.waitings.length===this.config.oftenWaitingCount){var t=this.waitings.shift();t&&e-t<=this.config.oftenWaitingTime&&(this.player.emit(PluginEvents.OFTEN_WAITING),this.clearState())}}},{key:"_time",value:function(){var e=this;if(this.timer)console.log("waiting,waiting:",Date.now()-this.waitingStartTime);else{this.waitingStartTime=Date.now();var t=this.player.currentTime;this.timer=setTimeout((function(){e.player&&e.player.currentTime<=t+.1&&(console.log("waiting ".concat(e.config.longWaitingTime," ")),e.player.emit(PluginEvents.LONG_WAITING),e.clearState())}),this.config.longWaitingTime)}}},{key:"_clearTime",value:function(){this.waitingStartTime&&console.log("waiting:",Date.now()-this.waitingStartTime),this.clearState()}},{key:"clearState",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.waitings.length>0&&(this.waitings=[]),this.waitingStartTime&&(this.waitingStartTime=0)}},{key:"demote",value:function(){if(this.playerData){var e=this.playerData.getNextDefinition(!0,this.config.demotePriority),t=null==e?void 0:e[0];if(t){var r=t.definition;if(r){var n=this.playerData.current.definition;if(this.player.emit(PluginEvents.DEFINITION_DEMOTE,{currentDef:n,willChangeDef:r,next:t}),"auto"===n){var i=t.url;this.changeUrl(i)}else r!==n&&this.showToast(t)}}}}},{key:"changeUrl",value:function(e){this.player&&e&&(this.player.config.url=e,this.player.switchURL(e,!1),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:e,from:"definition_demote"}))}},{key:"showToast",value:function(e){var t,r=this,n=null===(t=this.player)||void 0===t?void 0:t.getPlugin("sdkToastPlugin");if(n&&this.isNeedShowTips){var i=this.i18n[e.definitionTextKey]||e.definitionTextKey||e.definition,a=util$2.createDom("div",this.langText.definition_demote_txt,void 0,"toast-txt"),o=util$2.createDom("span",i,void 0,"toast-txt-bt");a.appendChild(o);var s=n.add(a,5e3,!0);o.addEventListener("click",(function(){r.playerData&&(r.playerData.current.definition=e.definition,n.remove(s))})),this.isNeedShowTips=!1,setTimeout((function(){r.isNeedShowTips=!0}),3e4)}}},{key:"destroy",value:function(){this.clearState()}}],[{key:"pluginName",get:function(){return"DefinitionDemotePlugin"}},{key:"defaultConfig",get:function(){return{oftenWaitingCount:3,oftenWaitingTime:5e3,longWaitingTime:5e3,isNeedAutoDemote:!1,demotePriority:[]}}}]),r}(Plugin),formatTime=function(e){var t=Math.floor(e/3600),r=e%3600,n=Math.floor(r/60),i=Math.round(r%60);return t>0?(n<10&&(n="0"+n),i<10&&(i="0"+i),"".concat(t,":").concat(n,":").concat(i)):(i<10&&(i="0"+i),"".concat(n,":").concat(i))},POSITIONS$1=Plugin.POSITIONS,UpperLimit=604800,MinMoveTime=6,TimeShiftPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){var e;return _classCallCheck$j(this,r),(e=t.apply(this,arguments)).isMobile="mobile"===sniffer$1.device,e.playedBar=null,e.cachedBar=null,e.innerBar=null,e.progressBtn=null,e.progressPoint=null,e.backLiveBt=null,e.cardDomList=[],e.initTime=0,e.liveGap=0,e.shiftTimeGap=0,e.isProgressMoving=!1,e.isPlayTimeShift=!1,e.liveUrl="",e.onBodyClick=function(e){e.preventDefault(),e.stopPropagation(),util$2.event(e)},e}return _createClass$k(r,[{key:"duration",get:function(){var e,t=this.liveGap+Math.floor(Date.now()/1e3-this.initTime),r=(null!==(e=this.config)&&void 0!==e?e:{}).maxMoveTime;return r&&t>r?r:t>UpperLimit?UpperLimit:t}},{key:"registerLanguageTexts",value:function(){return{BACKLIVE:{jp:"",en:"Back to live",zh:"","zh-hk":""}}}},{key:"updateLang",value:function(){this.backLiveBt&&(this.backLiveBt.innerHTML=this.langText.BACKLIVE)}},{key:"afterCreate",value:function(){this.liveUrl=this.player.config.url,this.playedBar=this.find(".xgplayer-progress-played"),this.cachedBar=this.find(".xgplayer-progress-cache"),this.progressBtn=this.find(".xgplayer-progress-btn"),this.progressPoint=this.find(".xgplayer-shift-progress-point"),this.innerBar=this.find(".xgplayer-progress-inner"),this.createBackLiveBtDom(),this.clacTime(),this.initEvents(),this.bindDomEvents(),this.isMobile||this.createTimeShiftCard()}},{key:"clacTime",value:function(){var e,t=null!==(e=this.config)&&void 0!==e?e:{},r=t.livingStartTime,n=t.currentTime;this.initTime=Math.floor(Date.now()/1e3),this.liveGap=Math.floor(n-r)}},{key:"initEvents",value:function(){this.on(TIME_UPDATE,this.handleTimeUpdate.bind(this))}},{key:"bindDomEvents",value:function(){if(this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.tipsUpdate=this.tipsUpdate.bind(this),this.isMobile){this.bind("touchstart",this.handleMouseDown);var e=this.player.controls;e&&(e.root&&e.root.addEventListener("touchmove",util$2.stopPropagation),e.center&&e.center.addEventListener("touchend",util$2.stopPropagation))}else this.bind("mousedown",this.handleMouseDown),this.bind("mouseenter",this.handleMouseEnter)}},{key:"handleTimeUpdate",value:function(){this.isProgressMoving||this.progressUpdate()}},{key:"handleMouseDown",value:function(e){if(e.target!==this.backLiveBt){this.onBodyClick(e),this.focus(),util$2.addClass(this.progressBtn,"active");var t=this.computeTime(e);this.updateShiftTime(t.percent),this.isProgressMoving=!0,this.isMobile?(this.bind("touchmove",this.handleMouseMove),this.bind("touchend",this.handleMouseUp)):(document.addEventListener("mousemove",this.handleMouseMove,!1),document.addEventListener("mouseup",this.handleMouseUp,!1))}}},{key:"handleMouseMove",value:function(e){this.onBodyClick(e);var t=this.computeTime(e);this.updateShiftTime(t.percent)}},{key:"handleMouseUp",value:function(e){this.onBodyClick(e),this.isProgressMoving=!1,util$2.removeClass(this.progressBtn,"active"),this.changeTimeUrl(),this.isMobile?(this.unbind("touchmove",this.handleMouseMove),this.unbind("touchend",this.handleMouseUp)):(document.removeEventListener("mousemove",this.handleMouseMove,!1),document.removeEventListener("mouseup",this.handleMouseUp,!1))}},{key:"handleMouseEnter",value:function(e){this.bind("mouseleave",this.handleMouseLeave),this.bind("mousemove",this.tipsUpdate),this.tipsUpdate(e),this.focus()}},{key:"handleMouseLeave",value:function(){this.unbind("mouseleave",this.handleMouseLeave),this.unbind("mousemove",this.tipsUpdate),this.blur()}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),util$2.addClass(this.root,"active")}},{key:"blur",value:function(){this.player.controls.recoverAutoHide(),util$2.removeClass(this.root,"active")}},{key:"computeTime",value:function(e){var t,r,n,i=this.player,a=this.root.getBoundingClientRect(),o=a.width,s=a.height,l=a.top,u=a.left,c=util$2.getEventPos(e,i.zoom);90===i.rotateDeg?(t=s,r=l,n=c.clientY):(t=o,r=u,n=c.clientX);var d=n-r,h=(d=d>t?t:d<0?0:d)/t;return{percent:h=h<0?0:h>1?1:h,offset:d,width:t,left:r,e:e}}},{key:"tipsUpdate",value:function(e){var t=this.computeTime(e),r=Math.floor(this.duration*(1-t.percent));this.progressPoint.style.left="".concat(100*t.percent,"%"),this.progressPoint.innerHTML="-".concat(formatTime(r))}},{key:"updateShiftTime",value:function(e){this.shiftTimeGap=Math.floor(this.duration*(1-e)),this.progressUpdate()}},{key:"getCurrentProgress",value:function(){return Math.floor(this.duration-this.shiftTimeGap)}},{key:"progressUpdate",value:function(){var e=this.getCurrentProgress()/this.duration;this.progressBtn.style.left="".concat(100*e,"%"),this.playedBar.style.width="".concat(100*e,"%"),this.cardProcessUpdate()}},{key:"changeTimeShift",value:function(e){var t=this.calcCardProcess(e);t<0||(this.updateShiftTime(t),this.changeTimeUrl())}},{key:"changeTimeUrl",value:function(){var e=this.config.timeShiftUrl,t="";this.isPlayTimeShift=!0,this.toggleBackButton();var r=this.shiftTimeGap<MinMoveTime?MinMoveTime:this.shiftTimeGap;t=e?e.replace("{}",r):addUrlParam(this.liveUrl,{timeshift:r}),this.player.src=t,this.player.config.url=t,this.player.emit(PluginEvents.TIME_SHIFT_CHANGE,!0),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{shiftUrl:t,from:PluginEvents.TIME_SHIFT_CHANGE})}},{key:"createBackLiveBtDom",value:function(){var e,t=this;if(this.backLiveBt)return this.backLiveBt;this.backLiveBt=util$2.createDom("xg-back-live-bt",this.langText.BACKLIVE,void 0,"xgplayer-back-live-bt"),this.backLiveBt.addEventListener("click",(function(e){t.onBodyClick(e),t.backLive()})),null===(e=this.player.root)||void 0===e||e.appendChild(this.backLiveBt)}},{key:"backLive",value:function(){this.liveUrl&&(this.player.src=this.liveUrl,this.player.config.url=this.liveUrl,this.shiftTimeGap=0,this.isPlayTimeShift=!1,this.toggleBackButton(),this.player.emit(PluginEvents.TIME_SHIFT_CHANGE,!1),this.player.emit(PluginEvents.PlAY_URL_CHANGE,{url:this.liveUrl,from:PluginEvents.TIME_SHIFT_CHANGE}))}},{key:"toggleBackButton",value:function(){this.backLiveBt&&(this.backLiveBt.style.display=this.isPlayTimeShift?"flex":"none")}},{key:"updateCardList",value:function(e){this.config.cardList=_toConsumableArray$a(e),this.clearCardDom(),this.createTimeShiftCard()}},{key:"clearCardDom",value:function(){var e=this;this.cardDomList.forEach((function(t){t.dom&&e.innerBar.contains(t.dom)&&e.innerBar.removeChild(t.dom)})),this.cardDomList=[]}},{key:"createTimeShiftCard",value:function(){var e,t=this;(null===(e=this.config.cardList)||void 0===e?void 0:e.length)<=0||this.config.cardList.forEach((function(e){t.renderCard(e)}))}},{key:"renderCard",value:function(e){if(e.img){var t=util$2.createDom("xg-card","",void 0,"xgplayer-shift-progress-card"),r=util$2.createDom("img","",{src:e.img},"xgplayer-shift-progress-card-img"),n=util$2.createDom("div","",void 0,"xgplayer-shift-progress-card-point");t.appendChild(r),t.appendChild(n),this.cardDomList.push(_objectSpread2$c(_objectSpread2$c({},e),{},{dom:t}))}}},{key:"cardProcessUpdate",value:function(){var e=this;0!==this.cardDomList.length&&this.cardDomList.forEach((function(t){if(t.dom){var r=e.calcCardProcess(t.timestamp);if(!(r>1)){var n=e.innerBar.contains(t.dom);r<0?n&&e.innerBar.removeChild(t.dom):(n||e.innerBar.appendChild(t.dom),t.dom.style.left="".concat(100*r,"%"))}}}))}},{key:"calcCardProcess",value:function(e){var t,r=null!==(t=this.config)&&void 0!==t?t:{},n=r.maxMoveTime,i=r.livingStartTime,a=this.liveGap+Math.floor(Date.now()/1e3-this.initTime);return n&&a>n&&(i=a-n),e<i?-1:(e-i)/this.duration}},{key:"destroy",value:function(){if(this.off(TIME_UPDATE,this.handleTimeUpdate.bind(this)),this.isMobile){this.unbind("touchstart",this.handleMouseDown);var e=this.player.controls;e&&(e.root&&e.root.removerEventListener("touchmove",util$2.stopPropagation),e.center&&e.center.removerEventListener("touchend",util$2.stopPropagation))}else this.unbind("mousedown",this.handleMouseDown),this.unbind("mouseenter",this.handleMouseEnter);var t;this.backLiveBt&&(null===(t=this.player.root)||void 0===t||t.removeChild(this.backLiveBt),this.backLiveBt=null)}},{key:"render",value:function(){if(this.config.disable)return"";var e=this.player.controls?this.player.controls.config.mode:"";return'\n      <xg-progress class="xgplayer-progress '.concat("bottom"===e?"xgplayer-progress-bottom":"",' xgplayer-shift">\n        <xg-outer class="xgplayer-progress-outer">\n          <xg-inners class="progress-list">\n            <xg-inner class="xgplayer-progress-inner" style="flex: 1">\n              <xg-cache class="xgplayer-progress-cache" style="width: 100%;"></xg-cache>\n              <xg-played class="xgplayer-progress-played" style="width: 100%;"></xg-played>\n            </xg-inner>\n          </xg-inners>\n          <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n          <xg-point class="xgplayer-shift-progress-point">00:00</xg-point>\n        </xg-outer>\n      </xg-progress>\n    ')}}],[{key:"pluginName",get:function(){return"TimeShiftPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS$1.CONTROLS_CENTER,livingStartTime:Date.now()/1e3,maxMoveTime:0,currentTime:Date.now()/1e3,timeShiftUrl:"",cardList:[]}}}]),r}(Plugin),debug$1="object"===("undefined"==typeof process?"undefined":_typeof$b(process))&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=console).error.apply(e,["SEMVER"].concat(r))}:function(){},debug_1=debug$1,SEMVER_SPEC_VERSION="2.0.0",MAX_LENGTH$1=256,MAX_SAFE_INTEGER$1=Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH=16,constants={SEMVER_SPEC_VERSION:SEMVER_SPEC_VERSION,MAX_LENGTH:MAX_LENGTH$1,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER$1,MAX_SAFE_COMPONENT_LENGTH:MAX_SAFE_COMPONENT_LENGTH},re$1={exports:{}};!function(e,t){var r=constants.MAX_SAFE_COMPONENT_LENGTH,n=debug_1,i=(t=e.exports={}).re=[],a=t.src=[],o=t.t={},s=0,l=function(e,t,r){var l=s++;n(e,l,t),o[e]=l,a[l]=t,i[l]=new RegExp(t,r?"g":void 0)};l("NUMERICIDENTIFIER","0|[1-9]\\d*"),l("NUMERICIDENTIFIERLOOSE","[0-9]+"),l("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),l("MAINVERSION","(".concat(a[o.NUMERICIDENTIFIER],")\\.")+"(".concat(a[o.NUMERICIDENTIFIER],")\\.")+"(".concat(a[o.NUMERICIDENTIFIER],")")),l("MAINVERSIONLOOSE","(".concat(a[o.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(a[o.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(a[o.NUMERICIDENTIFIERLOOSE],")")),l("PRERELEASEIDENTIFIER","(?:".concat(a[o.NUMERICIDENTIFIER],"|").concat(a[o.NONNUMERICIDENTIFIER],")")),l("PRERELEASEIDENTIFIERLOOSE","(?:".concat(a[o.NUMERICIDENTIFIERLOOSE],"|").concat(a[o.NONNUMERICIDENTIFIER],")")),l("PRERELEASE","(?:-(".concat(a[o.PRERELEASEIDENTIFIER],"(?:\\.").concat(a[o.PRERELEASEIDENTIFIER],")*))")),l("PRERELEASELOOSE","(?:-?(".concat(a[o.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(a[o.PRERELEASEIDENTIFIERLOOSE],")*))")),l("BUILDIDENTIFIER","[0-9A-Za-z-]+"),l("BUILD","(?:\\+(".concat(a[o.BUILDIDENTIFIER],"(?:\\.").concat(a[o.BUILDIDENTIFIER],")*))")),l("FULLPLAIN","v?".concat(a[o.MAINVERSION]).concat(a[o.PRERELEASE],"?").concat(a[o.BUILD],"?")),l("FULL","^".concat(a[o.FULLPLAIN],"$")),l("LOOSEPLAIN","[v=\\s]*".concat(a[o.MAINVERSIONLOOSE]).concat(a[o.PRERELEASELOOSE],"?").concat(a[o.BUILD],"?")),l("LOOSE","^".concat(a[o.LOOSEPLAIN],"$")),l("GTLT","((?:<|>)?=?)"),l("XRANGEIDENTIFIERLOOSE","".concat(a[o.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),l("XRANGEIDENTIFIER","".concat(a[o.NUMERICIDENTIFIER],"|x|X|\\*")),l("XRANGEPLAIN","[v=\\s]*(".concat(a[o.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIER],")")+"(?:".concat(a[o.PRERELEASE],")?").concat(a[o.BUILD],"?")+")?)?"),l("XRANGEPLAINLOOSE","[v=\\s]*(".concat(a[o.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(a[o.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(a[o.PRERELEASELOOSE],")?").concat(a[o.BUILD],"?")+")?)?"),l("XRANGE","^".concat(a[o.GTLT],"\\s*").concat(a[o.XRANGEPLAIN],"$")),l("XRANGELOOSE","^".concat(a[o.GTLT],"\\s*").concat(a[o.XRANGEPLAINLOOSE],"$")),l("COERCE","".concat("(^|[^\\d])(\\d{1,").concat(r,"})")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:$|[^\\d])"),l("COERCERTL",a[o.COERCE],!0),l("LONETILDE","(?:~>?)"),l("TILDETRIM","(\\s*)".concat(a[o.LONETILDE],"\\s+"),!0),t.tildeTrimReplace="$1~",l("TILDE","^".concat(a[o.LONETILDE]).concat(a[o.XRANGEPLAIN],"$")),l("TILDELOOSE","^".concat(a[o.LONETILDE]).concat(a[o.XRANGEPLAINLOOSE],"$")),l("LONECARET","(?:\\^)"),l("CARETTRIM","(\\s*)".concat(a[o.LONECARET],"\\s+"),!0),t.caretTrimReplace="$1^",l("CARET","^".concat(a[o.LONECARET]).concat(a[o.XRANGEPLAIN],"$")),l("CARETLOOSE","^".concat(a[o.LONECARET]).concat(a[o.XRANGEPLAINLOOSE],"$")),l("COMPARATORLOOSE","^".concat(a[o.GTLT],"\\s*(").concat(a[o.LOOSEPLAIN],")$|^$")),l("COMPARATOR","^".concat(a[o.GTLT],"\\s*(").concat(a[o.FULLPLAIN],")$|^$")),l("COMPARATORTRIM","(\\s*)".concat(a[o.GTLT],"\\s*(").concat(a[o.LOOSEPLAIN],"|").concat(a[o.XRANGEPLAIN],")"),!0),t.comparatorTrimReplace="$1$2$3",l("HYPHENRANGE","^\\s*(".concat(a[o.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(a[o.XRANGEPLAIN],")")+"\\s*$"),l("HYPHENRANGELOOSE","^\\s*(".concat(a[o.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(a[o.XRANGEPLAINLOOSE],")")+"\\s*$"),l("STAR","(<|>)?=?\\s*\\*"),l("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),l("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(re$1,re$1.exports);var opts=["includePrerelease","loose","rtl"],parseOptions$1=function(e){return e?"object"!==_typeof$b(e)?{loose:!0}:opts.filter((function(t){return e[t]})).reduce((function(e,t){return e[t]=!0,e}),{}):{}},parseOptions_1=parseOptions$1,numeric=/^[0-9]+$/,compareIdentifiers$1=function(e,t){var r=numeric.test(e),n=numeric.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1},rcompareIdentifiers=function(e,t){return compareIdentifiers$1(t,e)},identifiers={compareIdentifiers:compareIdentifiers$1,rcompareIdentifiers:rcompareIdentifiers},debug=debug_1,MAX_LENGTH=constants.MAX_LENGTH,MAX_SAFE_INTEGER=constants.MAX_SAFE_INTEGER,re=re$1.exports.re,t=re$1.exports.t,parseOptions=parseOptions_1,compareIdentifiers=identifiers.compareIdentifiers,SemVer$1=function(){function e(r,n){if(_classCallCheck$j(this,e),n=parseOptions(n),r instanceof e){if(r.loose===!!n.loose&&r.includePrerelease===!!n.includePrerelease)return r;r=r.version}else if("string"!=typeof r)throw new TypeError("Invalid Version: ".concat(r));if(r.length>MAX_LENGTH)throw new TypeError("version is longer than ".concat(MAX_LENGTH," characters"));debug("SemVer",r,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;var i=r.trim().match(n.loose?re[t.LOOSE]:re[t.FULL]);if(!i)throw new TypeError("Invalid Version: ".concat(r));if(this.raw=r,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>MAX_SAFE_INTEGER||this.major<0)throw new TypeError("Invalid major version");if(this.minor>MAX_SAFE_INTEGER||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>MAX_SAFE_INTEGER||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<MAX_SAFE_INTEGER)return t}return e})):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}return _createClass$k(e,[{key:"format",value:function(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}},{key:"toString",value:function(){return this.version}},{key:"compare",value:function(t){if(debug("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}},{key:"compareMain",value:function(t){return t instanceof e||(t=new e(t,this.options)),compareIdentifiers(this.major,t.major)||compareIdentifiers(this.minor,t.minor)||compareIdentifiers(this.patch,t.patch)}},{key:"comparePre",value:function(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var r=0;do{var n=this.prerelease[r],i=t.prerelease[r];if(debug("prerelease compare",r,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return compareIdentifiers(n,i)}while(++r)}},{key:"compareBuild",value:function(t){t instanceof e||(t=new e(t,this.options));var r=0;do{var n=this.build[r],i=t.build[r];if(debug("prerelease compare",r,n,i),void 0===n&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===n)return-1;if(n!==i)return compareIdentifiers(n,i)}while(++r)}},{key:"inc",value:function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(0===compareIdentifiers(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: ".concat(e))}return this.format(),this.raw=this.version,this}}]),e}(),semver=SemVer$1,SemVer=semver,compare$1=function(e,t,r){return new SemVer(e,r).compare(new SemVer(t,r))},compare_1=compare$1,compare=compare_1,gte=function(e,t,r){return compare(e,t,r)>=0},gte_1=gte,TO_NATIVE_API_NAME={v1:"byteview_live_bridge",v2:"lark_vc_live_bridge"},TO_WEB_API_NAME={v1:"byteview_live_event",v2:"lark_vc_live_bridge"},IsInLark=window.navigator.userAgent.indexOf("Lark")>-1,GapLarkVersion="5.1.0";function getLarkVersion(){var e,t,r;if(IsInLark){var n=null===(e=window)||void 0===e||null===(t=e.navigator)||void 0===t||null===(r=t.userAgent)||void 0===r?void 0:r.match(/ Lark\/(\d+\.\d+\.\d+)/i);if(n)return n[1]}}var EventName=function(e){return e.UNKNOWN_NATIVE_EVENT="UNKNOWN_NATIVE_EVENT",e.SWITCH_NORMAL_WINDOW="SWITCH_NORMAL_WINDOW",e.SWITCH_MINI_WINDOW="SWITCH_MINI_WINDOW",e}(EventName||{}),CallNativeEvent=function(e){return e[e.Unknown=0]="Unknown",e[e.LiveReady=1]="LiveReady",e[e.LiveStart=2]="LiveStart",e[e.LivePause=3]="LivePause",e[e.LiveEnd=4]="LiveEnd",e[e.LiveError=5]="LiveError",e[e.LiveMuted=6]="LiveMuted",e[e.LiveStreamChange=7]="LiveStreamChange",e[e.DanmakuChange=8]="DanmakuChange",e[e.JsReady=9]="JsReady",e}(CallNativeEvent||{}),CallWebEvent=function(e){return e[e.Unknown=0]="Unknown",e[e.SwitchNormalMode=1]="SwitchNormalMode",e[e.SwitchMiniMode=2]="SwitchMiniMode",e[e.ContainerModeChange=3]="ContainerModeChange",e}(CallWebEvent||{}),ContainerMode=function(e){return e[e.Unknown=0]="Unknown",e[e.Normal=1]="Normal",e[e.Mini=2]="Mini",e}(ContainerMode||{}),LarkJsBridge=function(){function e(){var t=this;_classCallCheck$j(this,e),this.emitter=new eventemitter3.exports.EventEmitter,this.currentHost="",this.currentLarkVersion="",this.currentLiveId="",this.isInAndroid=!1,this.isInIOS=!1,this.isInLark=!1,this.isInitialized=!1,this.useV2=!1,this.handleContainerModeChange=function(e,r){var n,i;switch(e){case CallWebEvent.SwitchMiniMode:i=EventName.SWITCH_MINI_WINDOW;break;case CallWebEvent.SwitchNormalMode:i=EventName.SWITCH_NORMAL_WINDOW;break;case CallWebEvent.ContainerModeChange:i=(null==r||null===(n=r.params)||void 0===n?void 0:n.mode)===ContainerMode.Normal?EventName.SWITCH_NORMAL_WINDOW:EventName.SWITCH_MINI_WINDOW;break;default:i=EventName.SWITCH_NORMAL_WINDOW}window.addEventListener("resize",(function e(){t.emitter.emit(i,r),window.removeEventListener("resize",e)}))},this.init()}return _createClass$k(e,[{key:"init",value:function(e){this.initVariables(e),this.initNativeCallWebCallback()}},{key:"initVariables",value:function(e){if(console.log(IsInLark),IsInLark){var t,r=null!==(t=null==e?void 0:e.liveId)&&void 0!==t?t:"";if(this.isInitialized)return void(this.currentLiveId=r);var n=getLarkVersion();this.currentLiveId=r,this.currentHost="https://".concat(window.location.host),this.currentLarkVersion=null!=n?n:"0.0.0",this.isInAndroid=!!sniffer$1.os.isAndroid,this.isInIOS=!!sniffer$1.os.isIos,this.isInLark=IsInLark&&"mobile"===sniffer$1.device,this.useV2=gte_1(this.currentLarkVersion,GapLarkVersion)}}},{key:"initNativeCallWebCallback",value:function(){var e=this;this.isInLark&&(this.isInitialized||(this.isInitialized=!0,window.LarkWebViewJavaScriptBridge=window.LarkWebViewJavaScriptBridge||{nativeCallBack:function(t){var r=t.callbackID,n=void 0===r?"":r,i=t.data,a=void 0===i?{}:i;if([TO_WEB_API_NAME.v1,TO_WEB_API_NAME.v2].includes(n)){var o=a.live_event,s=void 0===o?CallWebEvent.Unknown:o;s&&e.callWebHandler(s,a)}}}))}},{key:"callWebHandler",value:function(e,t){switch(e){case CallWebEvent.SwitchNormalMode:case CallWebEvent.SwitchMiniMode:case CallWebEvent.ContainerModeChange:this.handleContainerModeChange(e,t)}}},{key:"genTransferNativeData",value:function(e,t){return this.useV2?this.generateCallNativeDataV2(e,t):this.generateCallNativeDataV1(e,t)}},{key:"generateCallNativeDataV1",value:function(e,t){if(this.currentLiveId)return{apiName:TO_NATIVE_API_NAME.v1,data:{live_host:this.currentHost,live_id:this.currentLiveId,stream_link:t.stream_link,live_action:e,muted:t.muted,danmaku_active:t.danmaku_active}}}},{key:"generateCallNativeDataV2",value:function(e,t){return{apiName:TO_NATIVE_API_NAME.v2,callbackID:TO_NATIVE_API_NAME.v2,data:{live_event:e,version:this.currentLarkVersion,params:_objectSpread2$c({live_host:this.currentHost},t)},extra:"v2"}}},{key:"postMessage",value:function(e,t){if(this.isInLark&&(this.isInAndroid||this.isInIOS)){var r=this.genTransferNativeData(e,t);if(r){var n,i,a,o,s,l,u;if(this.isInIOS)null===(n=window)||void 0===n||null===(i=n.webkit)||void 0===i||null===(a=i.messageHandlers)||void 0===a||null===(o=a.invokeNative)||void 0===o||o.postMessage(r);if(this.isInAndroid)null===(s=window)||void 0===s||null===(l=s.Lark_Bridge)||void 0===l||null===(u=l.invokeNative)||void 0===u||u.call(l,JSON.stringify(r))}}}},{key:"addEventListener",value:function(e,t){this.emitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.emitter.removeListener(e,t)}},{key:"destroy",value:function(){this.emitter.removeAllListeners()}}]),e}(),NativeWindowPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){var e;return _classCallCheck$j(this,r),(e=t.apply(this,arguments)).isFirstLoad=!0,e.larkJsBridge=new LarkJsBridge,e.handleReady=function(){e.postMessage(CallNativeEvent.LiveReady)},e.handlePlay=function(){e.postMessage(CallNativeEvent.LiveStart)},e.handlePause=function(){e.postMessage(CallNativeEvent.LivePause)},e.handleError=function(){e.postMessage(CallNativeEvent.LiveError)},e.handleMuted=function(){e.postMessage(CallNativeEvent.LiveMuted)},e.handleDanmakuChange=function(){e.postMessage(CallNativeEvent.DanmakuChange)},e.handleLoadedData=function(){e.isFirstLoad?e.isFirstLoad=!1:e.postMessage(CallNativeEvent.LiveStreamChange)},e.handleMiniMode=function(){e.player&&(e.handleDanmaku(!1),e.player.root&&util$2.addClass(e.player.root,"xgplayer-mini-mode"),e.player.emit(PluginEvents.LARKWINDOW_CHANGE,!0))},e.handleNormalMode=function(){e.player&&(e.handleDanmaku(!0),e.player.root&&util$2.removeClass(e.player.root,"xgplayer-mini-mode"),e.player.emit(PluginEvents.LARKWINDOW_CHANGE,!1))},e}return _createClass$k(r,[{key:"afterCreate",value:function(){var e,t,r;null===(e=this.larkJsBridge)||void 0===e||e.postMessage(CallNativeEvent.JsReady,{}),this.player&&(this.player.on("ready",this.handleReady),this.player.on("play",this.handlePlay),this.player.on("pause",this.handlePause),this.player.on("error",this.handleError),this.player.on("volumechange",this.handleMuted),this.player.on("danmaku_click",this.handleDanmakuChange),this.player.on("loadeddata",this.handleLoadedData),null===(t=this.larkJsBridge)||void 0===t||t.addEventListener(EventName.SWITCH_MINI_WINDOW,this.handleMiniMode),null===(r=this.larkJsBridge)||void 0===r||r.addEventListener(EventName.SWITCH_NORMAL_WINDOW,this.handleNormalMode))}},{key:"destroy",value:function(){var e,t,r,n;this.player.off("ready",this.handleReady),this.player.off("play",this.handlePlay),this.player.off("pause",this.handlePause),this.player.off("error",this.handleError),this.player.off("volumechange",this.handleMuted),this.player.off("danmaku_click",this.handleDanmakuChange),this.player.off("loadeddata",this.handleLoadedData),null===(e=this.larkJsBridge)||void 0===e||e.postMessage(CallNativeEvent.LiveEnd,{}),null===(t=this.larkJsBridge)||void 0===t||t.removeEventListener(EventName.SWITCH_MINI_WINDOW,this.handleMiniMode),null===(r=this.larkJsBridge)||void 0===r||r.removeEventListener(EventName.SWITCH_NORMAL_WINDOW,this.handleNormalMode),null===(n=this.larkJsBridge)||void 0===n||n.destroy()}},{key:"postMessage",value:function(e,t){if(this.larkJsBridge){var r,n,i,a,o=this.player.config.url||"",s={stream_link:null!=o&&o.startsWith("https:")?o:"https:".concat(o),muted:this.player.muted,danmaku_active:null!==(r=null===(n=this.player)||void 0===n||null===(i=n.plugins)||void 0===i||null===(a=i.danmu)||void 0===a?void 0:a.isOpen)&&void 0!==r&&r};this.larkJsBridge.postMessage(e,_objectSpread2$c(_objectSpread2$c({},s),t))}}},{key:"handleDanmaku",value:function(e){var t=this;this.player&&this.player.danmu&&e&&setTimeout((function(){var e,r;null===(e=(r=t.player.danmu).resize)||void 0===e||e.call(r)}),300)}}],[{key:"pluginName",get:function(){return"nativeWindowPlugin"}}]),r}(BasePlugin);function GetMirrorSvg(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8.5 0.199997C8.5 0.0895386 8.5896 0 8.69995 0H9.30005C9.4104 0 9.5 0.0895386 9.5 0.199997V1.8C9.5 1.91046 9.4104 2 9.30005 2H8.69995C8.5896 2 8.5 1.91046 8.5 1.8V0.199997Z" fill="white"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 1.95424C0 1.85173 0.0773926 1.76582 0.179443 1.75529L7.27954 1.02277C7.34546 1.01596 7.40649 1.04182 7.44751 1.08664C7.47998 1.12207 7.5 1.16936 7.5 1.22171V14.7783C7.5 14.8969 7.39746 14.9894 7.27954 14.9773L0.179443 14.2447C0.0773926 14.2342 0 14.1483 0 14.0458V1.95424ZM1.5 12.873V3.12701L6 2.66273V13.3373L1.5 12.873Z" fill="white"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M18 1.95424C18 1.85173 17.9226 1.76582 17.8206 1.75529L10.7205 1.02277C10.6025 1.01059 10.5 1.10313 10.5 1.22171V14.7783C10.5 14.8969 10.6025 14.9894 10.7205 14.9773L17.8206 14.2447C17.9226 14.2342 18 14.1483 18 14.0458V1.95424ZM16.5 3.12701L12 2.66273V13.3373L16.5 12.873V3.12701Z" fill="white"/>\n    <path d="M8.69995 3C8.5896 3 8.5 3.08954 8.5 3.2V4.8C8.5 4.91046 8.5896 5 8.69995 5H9.30005C9.32642 5 9.35156 4.9949 9.37451 4.98564C9.39111 4.97896 9.40674 4.97011 9.4209 4.95944C9.46899 4.92293 9.5 4.8651 9.5 4.8V3.2C9.5 3.14664 9.47925 3.09818 9.44507 3.06232C9.40869 3.02393 9.35718 3 9.30005 3H8.69995Z" fill="white"/>\n    <path d="M8.5 6.2C8.5 6.08954 8.5896 6 8.69995 6H9.30005C9.34277 6 9.38232 6.01344 9.41479 6.03635C9.46631 6.07254 9.5 6.13234 9.5 6.2V7.8C9.5 7.85072 9.48096 7.89703 9.44995 7.9323C9.41821 7.96826 9.37354 7.99272 9.32373 7.99861C9.31592 7.99953 9.30811 8 9.30005 8H8.69995C8.5896 8 8.5 7.91046 8.5 7.8V6.2Z" fill="white"/>\n    <path d="M8.53711 9.08395C8.51367 9.11667 8.5 9.15674 8.5 9.20001V10.8C8.5 10.9105 8.5896 11 8.69995 11H9.30005C9.4104 11 9.5 10.9105 9.5 10.8V9.20001C9.5 9.08954 9.4104 9 9.30005 9H8.69995C8.68384 9 8.66821 9.00189 8.65332 9.00546C8.60571 9.01688 8.5647 9.04529 8.53711 9.08395Z" fill="white"/>\n    <path d="M8.5 12.2C8.5 12.1371 8.52905 12.081 8.57446 12.0443C8.60864 12.0166 8.65234 12 8.69995 12H9.30005C9.4104 12 9.5 12.0895 9.5 12.2V13.8C9.5 13.8664 9.46753 13.9253 9.41772 13.9616C9.38477 13.9857 9.34399 14 9.30005 14H8.69995C8.5896 14 8.5 13.9105 8.5 13.8V12.2Z" fill="white"/>\n    <path d="M8.69995 15C8.5896 15 8.5 15.0895 8.5 15.2V15.8C8.5 15.9105 8.5896 16 8.69995 16H9.30005C9.4104 16 9.5 15.9105 9.5 15.8V15.2C9.5 15.0895 9.4104 15 9.30005 15H8.69995Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}function ExitMirrorSvg(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8.5 0.2C8.5 0.0895431 8.58954 0 8.7 0H9.3C9.41046 0 9.5 0.0895431 9.5 0.2V1.8C9.5 1.91046 9.41046 2 9.3 2H8.7C8.58954 2 8.5 1.91046 8.5 1.8V0.2Z" fill="white"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 1.95424C0 1.85173 0.0775055 1.76582 0.179474 1.7553L7.27947 1.02276C7.39742 1.01059 7.5 1.10313 7.5 1.2217V14.7783C7.5 14.8969 7.39742 14.9894 7.27947 14.9773L0.179474 14.2447C0.0775053 14.2342 0 14.1483 0 14.0458V1.95424ZM1.5 12.873V3.12702L6 2.66273V13.3373L1.5 12.873Z" fill="white"/>\n    <path d="M17.8205 1.7553C17.9225 1.76582 18 1.85173 18 1.95424V14.0458C18 14.1483 17.9225 14.2342 17.8205 14.2447L10.7205 14.9773C10.6026 14.9894 10.5 14.8969 10.5 14.7783V1.2217C10.5 1.10313 10.6026 1.01059 10.7205 1.02276L17.8205 1.7553Z" fill="white"/>\n    <path d="M8.7 3C8.58954 3 8.5 3.08954 8.5 3.2V4.8C8.5 4.91046 8.58954 5 8.7 5H9.3C9.41046 5 9.5 4.91046 9.5 4.8V3.2C9.5 3.08954 9.41046 3 9.3 3H8.7Z" fill="white"/>\n    <path d="M8.5 6.2C8.5 6.08954 8.58954 6 8.7 6H9.3C9.41046 6 9.5 6.08954 9.5 6.2V7.8C9.5 7.91046 9.41046 8 9.3 8H8.7C8.58954 8 8.5 7.91046 8.5 7.8V6.2Z" fill="white"/>\n    <path d="M8.7 9C8.58954 9 8.5 9.08954 8.5 9.2V10.8C8.5 10.9105 8.58954 11 8.7 11H9.3C9.41046 11 9.5 10.9105 9.5 10.8V9.2C9.5 9.08954 9.41046 9 9.3 9H8.7Z" fill="white"/>\n    <path d="M8.5 12.2C8.5 12.0895 8.58954 12 8.7 12H9.3C9.41046 12 9.5 12.0895 9.5 12.2V13.8C9.5 13.9105 9.41046 14 9.3 14H8.7C8.58954 14 8.5 13.9105 8.5 13.8V12.2Z" fill="white"/>\n    <path d="M8.7 15C8.58954 15 8.5 15.0895 8.5 15.2V15.8C8.5 15.9105 8.58954 16 8.7 16H9.3C9.41046 16 9.5 15.9105 9.5 15.8V15.2C9.5 15.0895 9.41046 15 9.3 15H8.7Z" fill="white"/>\n</svg>\n',"image/svg+xml").firstChild}var POSITIONS=Plugin.POSITIONS,MirrorStateKeys={GetMirror:"getMirror",ExitMirror:"exitMirror"},MirrorPlugin=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).isEnableMirror=!0,n.isEnableMirror=n.config.defaultEnable,n}return _createClass$k(r,[{key:"afterCreate",value:function(){this.config.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.updateMirrorState(this.isEnableMirror))}},{key:"registerIcons",value:function(){var e;return _defineProperty$j(e={},MirrorStateKeys.GetMirror,{icon:GetMirrorSvg,class:"xg-get-mirror"}),_defineProperty$j(e,MirrorStateKeys.ExitMirror,{icon:ExitMirrorSvg,class:"xg-exit-mirror"}),e}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e[MirrorStateKeys.GetMirror]),t.appendChild(e[MirrorStateKeys.ExitMirror])}},{key:"registerLanguageTexts",value:function(){return{getMirror:{jp:"",en:"Turn on mirroring",zh:"","zh-hk":""},exitMirror:{jp:"",en:"Turn off mirroring",zh:"","zh-hk":""}}}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.isEnableMirror?this.action(!1):this.action(!0)}},{key:"action",value:function(e){this.isEnableMirror=e,this.updateMirrorState(this.isEnableMirror),this.player.emit(PluginEvents.MIRROR_CHANGE,this.isEnableMirror)}},{key:"updateMirrorState",value:function(e){var t=this.player;e?t.addClass("xgplayer-mirror"):t.removeClass("xgplayer-mirror"),this.animate(e)}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","enable"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){this.changeLangTextKey(this.find(".xg-tips"),e?MirrorStateKeys.ExitMirror:MirrorStateKeys.GetMirror)}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class=\'xgplayer-mirror-icon\'>\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="mirror">'.concat(this.langText[MirrorStateKeys.GetMirror],"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"mirrorPlugin"}},{key:"defaultConfig",get:function(){return{position:POSITIONS.CONTROLS_RIGHT,index:CONTROL_ICON_INDEX.mirrorPlugin,disable:!1,defaultEnable:!1}}}]),r}(Plugin);function retPromise(e){return e&&e.then?e:new Promise((function(t){t(e)}))}var MemoryPlay=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(e){var n;return _classCallCheck$j(this,r),(n=t.call(this,e)).memoryId="",n.canJump=!1,n.saveTimeFun=util$2.checkIsFunction(n.config.saveTime)?n.config.saveTime:n.saveTimeByStorage,n.getTimeFun=util$2.checkIsFunction(n.config.getTime)?n.config.getTime:n.getTimeByStorage,n.startTime=0,n.memoryId=n.config.memoryId,n.showToast=n.showToast.bind(_assertThisInitialized$g(n)),n}return _createClass$k(r,[{key:"registerLanguageTexts",value:function(){return{preText:{jp:"",en:"Has located for you to ",zh:"","zh-hk":""}}}},{key:"children",value:function(){return{toast:ToastPlugin}}},{key:"afterCreate",value:function(){this.once(CANPLAY,this.showToast)}},{key:"beforePlayerInit",value:function(){return this.memoryId||(this.playerConfig.vid?this.memoryId=this.playerConfig.vid:this.player.url&&(this.memoryId=this.player.url.replace(/\?.*$/,""))),this.setSave(),this.getTime()}},{key:"destroy",value:function(){0!==this.player.currentTime&&this.player.currentTime!==this.player.duration&&this.saveTimeFun(this.memoryId,this.player.currentTime)}},{key:"getTime",value:function(){var e=this;return new Promise((function(t){retPromise(e.getTimeFun(e.memoryId)).then((function(r){var n=parseFloat(r);isNaN(n)||0===n?console.warn("the time got is invalid",r):(e.startTime=n,e.canJump=!0,e.playerConfig.startTime=e.startTime,"mobile"===sniffer$1.device&&e.player.once("canplay",(function(){e.player.currentTime=e.startTime}))),t()})).catch((function(e){console.error("getTime function occur error",e),t()}))}))}},{key:"setSave",value:function(){var e=this;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&0!==e.player.currentTime&&e.player.currentTime!==e.player.duration&&e.saveTimeFun(e.memoryId,e.player.currentTime)})),document.addEventListener("pagehide",(function(){0!==e.player.currentTime&&e.player.currentTime!==e.player.duration&&e.saveTimeFun(e.memoryId,e.player.currentTime)})),window.addEventListener("beforeunload",(function(){0!==e.player.currentTime&&e.player.currentTime!==e.player.duration&&e.saveTimeFun(e.memoryId,e.player.currentTime)}))}},{key:"showToast",value:function(){if(this.canJump){var e,t=null===(e=this.player)||void 0===e?void 0:e.getPlugin("sdkToastPlugin");if(!t)return;var r=util$2.format(this.startTime);t.add("".concat(this.langText.preText).concat(r),4e3,!0)}}},{key:"saveTimeByStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"getTimeByStorage",value:function(e){return localStorage.getItem(e)}}],[{key:"pluginName",get:function(){return"memoryPlay"}},{key:"defaultConfig",get:function(){return{getTime:null,saveTime:null,memoryId:""}}}]),r}(Plugin),LiveInfoPanel=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){var e;return _classCallCheck$j(this,r),(e=t.apply(this,arguments))._infoItems=[],e}return _createClass$k(r,[{key:"streamType",get:function(){return this.playerConfig.playerData.getCurrentStreamType()}},{key:"afterCreate",value:function(){var e=this;["flv","hls"].includes(this.streamType)?(this.player.on("error",(function(){return e._handleError()})),this.player.on("loadeddata",(function(){return e._handleLoadedData()}))):this.close()}},{key:"registerLanguageTexts",value:function(){return{DECODEFPS:{en:"decodeFps",zh:""},DECODECOST:{en:"decodeCost",zh:""},FORMAT:{en:"format",zh:""},FPS:{en:"fps",zh:""},BITRATE:{en:"birate",zh:""},GOP:{en:"GOP",zh:"GOP"},RESOLUTION:{en:"resolution",zh:""},ENCODETYPE:{en:"encodeType",zh:""},BUFFEREND:{en:"bufferEnd",zh:"buffer"},CURRENTTIME:{en:"currentTime",zh:""}}}},{key:"_getDefaultInfo",value:function(e){var t={h265Title:{key:"h265Title",label:"H265",type:"title"},decodeEfficiency:{key:"decodeEfficiency",label:"",labelTextKey:"DECODEFPS",value:e.decodeFps,render:function(e){return e+"frames/s"}},decodeCost:{key:"decodeCost",label:"",labelTextKey:"DECODECOST",value:e.decodeFps,render:function(e){return e?(1e3/e).toFixed()+"ms":""}}};return _objectSpread2$c({format:{key:"format",label:"",labelTextKey:"FORMAT",value:e.format},framerate:{key:"framerate",label:"",labelTextKey:"FPS",value:e.fps,render:function(e){return"".concat(e," fps")}},bitrate:{key:"bitrate",label:"",labelTextKey:"BITRATE",value:e.bitrate,render:function(e){return"".concat(e/1e3," kbps")}},gop:{key:"gop",label:"GOP",labelTextKey:"GOP",value:e.gop,render:function(e){return"".concat(e," frames")}},resolution:{key:"resolution",label:"",labelTextKey:"RESOLUTION",value:{width:e.width,height:e.height},render:function(e){return"".concat(e.width," * ").concat(e.height)}},encodeType:{key:"encodeType",label:"",labelTextKey:"ENCODETYPE",value:e.encodeType},bufferEnd:{key:"bufferEnd",label:"buffer",labelTextKey:"BUFFEREND",value:e.bufferEnd},currentTime:{key:"currentTime",label:"",labelTextKey:"CURRENTTIME",value:e.currentTime,render:function(e){return e?e.toFixed(6)+"s":""}}},e.isOpenSoftDecoding&&this.config.showH265Info?t:{})}},{key:"_init",value:function(){var e=this,t=this._initDom(this._getInfoListData());this._infoItems=new Proxy(t,{set:function(t,r,n){return e._updateDom(t[r].dom,n),Reflect.set(t,r,n)}}),this._tick()}},{key:"_getStats",value:function(){var e,t;return"flv"===this.streamType?null===(e=this.player.plugins.flv)||void 0===e?void 0:e.getStats():"hls"===this.streamType?null===(t=this.player.plugins.hls)||void 0===t?void 0:t.getStats():{}}},{key:"_getInfoListData",value:function(){var e=this._getStats()||{};return this._getDefaultInfo(Object.assign(e,{format:"".concat(this.streamType,"_live"),isOpenSoftDecoding:"live-video"==this.playerConfig.mediaType}))}},{key:"_initDom",value:function(e){var t=this,r=this.find(".veplayer-livepanel-container");return r.innerHTML="",Object.values(e).forEach((function(e){var n=util$2.createDom("veplayer-livepanel-div","",void 0,"veplayer-livepanel-container-row");"title"===e.type?t._updateTitle(n,e):t._updateDom(n,e),r.appendChild(n),e.dom=n})),e}},{key:"_updateTitle",value:function(e,t){e.innerHTML="";var r=util$2.createDom("veplayer-livepanel-span",t.label,void 0,"veplayer-livepanel-container-row-title");e.appendChild(r)}},{key:"_updateDom",value:function(e,t){e.innerHTML="";var r=util$2.createDom("veplayer-livepanel-span",this._renderLabel(t),void 0,"veplayer-livepanel-container-row-label");if(e.appendChild(r),"title"!==t.type){var n=util$2.createDom("veplayer-livepanel-span",this._renderValue(t));e.appendChild(n)}}},{key:"_renderLabel",value:function(e){return e.labelTextKey&&this.langText[e.labelTextKey]}},{key:"_renderValue",value:function(e){return e.render?e.render(e.value):e.value}},{key:"_handleDataChange",value:function(){var e=this,t=this._getInfoListData();Object.values(this._infoItems).forEach((function(r){"title"!==r.type&&e._renderValue(r)!==e._renderValue(t[r.key])&&(e._infoItems[r.key]=_objectSpread2$c(_objectSpread2$c({},r),t[r.key]))}))}},{key:"_tick",value:function(){var e=this;this._pollTimer=setTimeout((function(){clearTimeout(e._pollTimer),e._poll(),e._tick()}),500)}},{key:"_poll",value:function(){this._handleDataChange()}},{key:"destroy",value:function(){clearTimeout(this._pollTimer)}},{key:"_handleError",value:function(){this._close()}},{key:"_handleLoadedData",value:function(){this.config.visible&&this._open()}},{key:"_open",value:function(){var e=this.find(".veplayer-livepanel-container");util$2.removeClass(e,"veplayer-livepanel-hidden"),this._init()}},{key:"_close",value:function(){var e=this.find(".veplayer-livepanel-container");util$2.addClass(e,"veplayer-livepanel-hidden"),clearTimeout(this._pollTimer)}},{key:"open",value:function(){this._open(),this.config.visible=!0}},{key:"close",value:function(){this._close(),this.config.visible=!1}},{key:"render",value:function(){return'\n    <xg-livepanel class="xgplayer-livepanel">\n        <xg-livepanel-container class="veplayer-livepanel-container '.concat(!this.config.visible&&"veplayer-livepanel-hidden",'">\n    </xg-livepanel-container></xg-livepanel>\n    ')}}],[{key:"pluginName",get:function(){return"LiveInfoPanel"}},{key:"defaultConfig",get:function(){return{visible:!0,showH265Info:!1}}}]),r}(Plugin),VePlayerUmd=function(e){_inherits$g(r,e);var t=_createSuper$j(r);function r(){return _classCallCheck$j(this,r),t.apply(this,arguments)}return _createClass$k(r)}(VePlayer);return VePlayerUmd.LiveSubtitlesIconPlugin=LiveSubtitlesIconPlugin,VePlayerUmd.LiveSubtitlesPlugin=LiveSubTitlesPlugin,VePlayerUmd.DefinitionDemotePlugin=DefinitionDemotePlugin,VePlayerUmd.TimeShiftPlugin=TimeShiftPlugin,VePlayerUmd.LarkWindowPlugin=NativeWindowPlugin,VePlayerUmd.MirrorPlugin=MirrorPlugin,VePlayerUmd.MemoryPlay=MemoryPlay,VePlayerUmd.Subtitle=Subtitle,VePlayerUmd.Service=dist,VePlayerUmd.LiveInfoPanel=LiveInfoPanel,VePlayerUmd.Event=Event$2,VePlayerUmd.getI18N=getI18N,VePlayerUmd}));
